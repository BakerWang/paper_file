<!DOCTYPE html>
<html lang="en">
<head>
<title>看黑客如何玩转DNS泛解析 | E安全</title>
<meta name="description" content="网络创立之初，所有的访问都是通过IP地址来实现的，因web等协议与应用的兴起，有了域名，再通过IP去访问一方面不太容易记，另一方面因负载、CDN等方面的原因，单纯使用IP地址访问会带来一些问题。">
<meta name="keywords" content="黑客,DNS泛解析,网络安全">
<meta charset="UTF-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
<link rel="shortcut icon" href="https://www.easyaq.com/img/elogo.png">
<link rel="stylesheet" href="https://www.easyaq.com/css/base.css">
<link rel="stylesheet" href="https://www.easyaq.com/css/deteal.css">
<link rel="stylesheet" href="https://www.easyaq.com/css/right_list.css">
<link rel="stylesheet" href="https://www.easyaq.com/css/v2.0/weave.css">
<link rel="stylesheet" href="https://www.easyaq.com/css/deteal_slider.css">


<!--js部分-->
<script src="https://www.easyaq.com/js/v2.0/scorll.js"></script>
<script type="text/javascript" src="https://www.easyaq.com/ueditor/third-party/SyntaxHighlighter/shCore.js"></script>
<script charset="utf-8" type="text/javascript" src="https://www.easyaq.com/js/v2.0/animate.js"></script>
<script charset="utf-8" type="text/javascript" src="https://www.easyaq.com/js/deteal_slider.js"></script>
<link rel="stylesheet" type="text/css" href="https://www.easyaq.com/ueditor/third-party/SyntaxHighlighter/shCoreDefault.css">
</head>
<body>
	<link rel="stylesheet" href="https://www.easyaq.com/css/v2.0/base.css">
<link rel="stylesheet" id="esafe-pc-css" href="https://www.easyaq.com/css/pagination.css" type="text/css" media="all">
<link href="https://www.easyaq.com/css/font-awesome.min.css" rel="stylesheet">
<!--顶部条css-->
<link rel="stylesheet" href="https://www.easyaq.com/css/top-common.css">
<!--登陆框css-->
<link rel="stylesheet" type="text/css" href="https://www.easyaq.com/css/loginbox.css" />
<link rel="stylesheet" type="text/css" href="https://www.easyaq.com/css/logincontent.css">

<!--登陆遮罩-->
<div class="loginmask" style="opacity: 0.8; display: none;"></div>
<div class="swiper_wrap_box">
	<div class="swiper_wrap_head">
		<i></i>新闻快讯
	</div>
	<div class="swiper_wrap">

		<ul class="font_inner">
			<li><a href="https://www.easyaq.com/news/651427722.shtml" title="你真的需要杀毒软件吗？老司机分享电脑裸奔到底该注意什么？" target="_blank">你真的需要杀毒软件吗？老司机分享电脑裸奔到底该注意什么？</a></li>
			<li><a href="https://www.easyaq.com/news/1620389285.shtml" title="以色列政府网站被黑客组织“匿名者”成功入侵" target="_blank">以色列政府网站被黑客组织“匿名者”成功入侵</a></li>
			<li><a href="https://www.easyaq.com/news/735966211.shtml" title="公安部第三研究所称：公民网络电子身份标识拟载入手机卡" target="_blank">公安部第三研究所称：公民网络电子身份标识拟载入手机卡</a></li>
			<li><a href="https://www.easyaq.com/news/1356696844.shtml" title="美国Equifax数据泄露事件形势进一步恶化：被曝今年3月曾遭黑客入侵" target="_blank">美国Equifax数据泄露事件形势进一步恶化：被曝今年3月曾遭黑客入侵</a></li>
			<li><a href="https://www.easyaq.com/news/1282896050.shtml" title="全球虚拟化软件企业VMware在线发布多处漏洞补丁修复程序" target="_blank">全球虚拟化软件企业VMware在线发布多处漏洞补丁修复程序</a></li>
			</ul>
		<a href="javascript:void(0)" class="lt">&lt;</a> <a href="javascript:void(0)" class="gt">&gt;</a>
	</div>

	<!-- 		这里是登录部分开始 -->
	<div class="login-wrap1 y">
		<div class="menu-heading">
			<a class="member-login" target="_blank"> <span> <img class="avatar-pic" src="https://www.easyaq.com/images/noLogin.png" id="avatar-pic"></span> <span class="member-name"
					style="max-width: 130px !important; padding-left: 15px; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; course: hand;" title="帐号" id="avatar-name">账号</span>
				</a>
			<span class="angle angle-b"></span>
		</div>
		<div class="menu-body">
			<div class="menu-body-panel login-detail-wrap">
				<i class="icon icon-arrow-t"></i>
				<div class="item" style="padding: 0;">
					<a href="https://www.easyaq.com/tg" id="qmenu" target="_blank"><span class="icon icon-kuaijie"></span>投稿</a>
				</div>
				<div class="item openlogin">
					<a><span class="icon icon-login" onClick="return false;"></span>登录</a>
				</div>
				<div class="item">
					<a href="https://www.easyaq.com/userlogout?memberId="><span class="icon icon-login" onClick="return false;"></span>退出</a>
				</div>
			</div>
		</div>
	</div>
	<div class="login-wrap1 y">
		<div class="menu-heading" style="padding-right: 0;">
			<span><img src="https://www.easyaq.com/images/search.png"></span> <span class="member-name" style="max-width: 130px !important; padding-left: 10px; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; course: hand;" title="帐号" id="avatar-name">搜索</span> <span
				class="angle angle-b"></span>
		</div>
		<div class="menu-body">
			<div id="scbar" class="menu-body-panel cl">
				<i class="icon icon-arrow-t"></i>
				<form action="https://www.easyaq.com/search" method="GET" id="searchForm">
					<input type="hidden" name="orderflag" value="0" id="sType">
					<table>
						<tbody>
							<tr>
								<td style="position: absolute"><input type="text" name="keywords" id="scbar_txt" autocomplete="off" class="xg1" placeholder="请输入搜索内容"></td>
								<td style="position: absolute; right: 20px"><button type="submit" name="searchsubmit" id="scbar_btn" class="pn pnc" value="true">&nbsp;&nbsp;</button></td>
							</tr>
						</tbody>
					</table>
				</form>
			</div>
		</div>
	</div>
	<!-- 		这里是登录部分结束 -->
	<!--登陆弹出框-->
	<div class="jq22-container" id="loginalert">
		<div class="login-wrap">
			<div class="login-html">
				<input id="tab-1" type="radio" name="tab" class="sign-in" checked> <label for="tab-1" class="tab">微信登陆</label> <input id="tab-2" type="radio" name="tab" class="sign-up"> <label for="tab-2" class="tab">账号登陆</label> <input id="tab-3" type="radio" name="tab" class="sign-code">
				<label for="tab-3" class="tab">注册账号</label>
				<div class="login-form">
					<!--微信登陆-->
					<div class="sign-in-htm">
						<div class="group">
							<div style="padding: 10px 30px" id="weixin_login">
							</div>
						</div>
					</div>
					<!--账号登陆-->
					<div class="sign-up-htm">
						<form id="login_form">
							<div class="group">
								<label for="user" class="label">用户名/手机号</label> <input id="user" type="text" class="input" name="handset">
							</div>
							<div class="group">
								<label for="pass" class="label">密码</label> <input id="pass" type="password" class="input" data-type="password" name="password">
							</div>
							<div id="error_tips" style="margin-left: 50px; color: #ff0000;"></div>

							<div class="group">
								<button id="btn_login" type="button" class="button" value="注册">登录</button>
							</div>
						</form>
						<div class="thirdlogin">
							<div style="margin-top: 20px; border-top: solid 1px #efefef; padding-top: 10px;">
								<h4 style="text-align: center;">用第三方帐号直接登录</h4>
								<ul>
									<li id="sinal"><a href="https://api.weibo.com/oauth2/authorize?client_id=2016968448&redirect_uri=http://www.easyaq.com/thirdlogin/weibo&state=dec60e8a-8254-411a-b399-376b9b775fca">微博账号登录</a></li>
									<li id="qql"><a href="https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id=101345424&redirect_uri=http%3A%2F%2Fwww.easyaq.com%2Fthirdlogin%2Fqq&scope=get_user_info&state=dec60e8a-8254-411a-b399-376b9b775fca">QQ账号登录</a></li>

								</ul>
								<div class="clear"></div>
							</div>
						</div>
					</div>
					<!--注册账号-->
					<div class="sign-code-htm">
						<form id="register_form">
							<div class="group">
								<label for="user" class="label">手机号</label> <input id="user" type="text" class="input" name="phone"> <font color="red" class="errortips" id="phone_msg"></font>
							</div>
							<div class="group" style="position: relative">
								<label for="pass" class="label">验证码</label> <input id="code" type="text" class="input" name="validcode">
								<button type="button" onclick="getValidCode(this)" style="position: absolute; top: 23px; right: 0px; border: none; border-left: solid 1px #efefef; background-color: transparent; height: 30px; width: 100px; cursor: pointer">获取验证码</button>
								<font color="red" class="errortips" id="validcode_msg"></font>
							</div>
							<div class="group">
								<label for="pass" class="label">设置密码</label> <input type="password" class="input" data-type="password" name="password"> <font color="red" class="errortips" id="password_msg"></font>
							</div>
							<div class="group">
								<label for="pass" class="label">确认密码</label> <input id="pass" type="password" class="input" data-type="password" name="password2"> <font color="red" class="errortips" id="password2_msg"></font>
							</div>
							<div class="group">
								<label for="pass" class="label">昵称(必填)</label> <input type="text" class="input" name="nickname"> <font color="red" class="errortips" id="nickname_msg"></font>
							</div>
							<div class="group">
								<button id="register_btn" type="button" class="button" value="注册">注册</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--/登陆弹出框-->
</div>

<div class="logo_ad">
	<!--logo-->
	<a href="https://www.easyaq.com/" title="E安全门户网站"><img class="Elogo" src="https://www.easyaq.com/img/v2.0/splogo.png" title="E安全门户网站" alt="E安全门户网站"></a>
</div>
<!--导航开始-->
<div class="E_nav">
	<ul class="E_nav_li">
		<li class="E_nav_li_active"><a href="https://www.easyaq.com/" title="E安全门户网站">首页</a></li>
		<li><a href="https://www.easyaq.com/data" target="_blank" title="安全资料">资料</a></li>
		<li><a href="https://www.easyaq.com/course" target="_blank" title="安全课程">课程</a></li>
		<li><a href="https://www.easyaq.com/warn" target="_blank" title="安全预警">预警</a></li>
		<li><a href="https://www.easyaq.com/special/" target="_blank" title="安全专题">专题</a></li>
		<li><a href="https://www.easyaq.com/live" target="_blank" title="图文直播">直播</a></li>
		<li><a href="https://www.easyaq.com/activity" target="_blank" title="安全活动">活动</a></li>
		<li><a href="https://www.easyaq.com/app" target="_blank" title="E安全APP">客户端</a></li>
		<li class="nav_tougao"><a href="https://www.easyaq.com/tg" target="_blank" title="E安全投稿">投稿</a> <i class="hoticon"></i></li>
	</ul>
	<ul class="E_nav_class">
		<li>
				<a href="https://www.easyaq.com/" title="E安全类别-最新======" target="_blank">最新</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/2.shtml" title="E安全类别-国内======" target="_blank">国内</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/3.shtml" title="E安全类别-国际======" target="_blank">国际</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/16.shtml" title="E安全类别-数据泄露======" target="_blank">数据泄露</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/12.shtml" title="E安全类别-网络战======" target="_blank">网络战</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/1.shtml" title="E安全类别-行业======" target="_blank">行业</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/14.shtml" title="E安全类别-报告======" target="_blank">报告</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/11.shtml" title="E安全类别-观点======" target="_blank">观点</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/19.shtml" title="E安全类别-预警======" target="_blank">预警</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/989.shtml" title="E安全类别-人工智能======" target="_blank">人工智能</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/20.shtml" title="E安全类别-招聘======" target="_blank">招聘</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/4.shtml" title="E安全类别-云计算======" target="_blank">云计算</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/5.shtml" title="E安全类别-大数据======" target="_blank">大数据</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/6.shtml" title="E安全类别-程序员======" target="_blank">程序员</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/7.shtml" title="E安全类别-系统======" target="_blank">系统</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/8.shtml" title="E安全类别-专家======" target="_blank">专家</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/9.shtml" title="E安全类别-融资======" target="_blank">融资</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/10.shtml" title="E安全类别-人物======" target="_blank">人物</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/15.shtml" title="E安全类别-工具======" target="_blank">工具</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/13.shtml" title="E安全类别-安全基础设施======" target="_blank">安全基础设施</a>
					</li>
		<li>
				<a href="https://www.easyaq.com/type/17.shtml" title="E安全类别-推广======" target="_blank">推广</a>
					</li>
		</ul>
</div>
<!--导航结束-->
<!--文字滚动-->
<!--登陆弹出框-->
<script src="https://www.easyaq.com/js/jquery-2.2.1.min.js"></script>
<script src="https://www.easyaq.com/js/jquery.easing.min.js"></script>
<script src="https://www.easyaq.com/js/custom.js"></script>
<script src="https://www.easyaq.com/js/nav3.js"></script>
<!--/登陆弹出框-->
<!-- 这里是登录 -->
<script src="//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"></script>
<!--文字滚动结束-->
<div style="display: none;">
	<script src="https://s5.cnzz.com/z_stat.php?id=5847145&web_id=5847145"></script>
</div>
<div class="Emain w">
		<div class="deteal_block">
		
		    <div class="w-slider" id="js_slider">
		        <div class="slider">
		            <div class="slider-main" id="slider_main_block">
		                <div class="slider-main-img">
		                   <img src="https://www.easyaq.com/img/top_banner.png" alt="" >
		                </div>
		                <div class="slider-main-img">
		                    <img src="https://www.easyaq.com/img/app_top_banner.png" alt="">
		
		                </div>
		            </div>
		        </div>		      
    		</div>
			
			<div class="Emain_left">
				<div class="article_tittle">
				<div class="path bt"><i class="home_icon"><a href="https://www.easyaq.com/"></a></i><a href="https://www.easyaq.com/" title="E安全">首页</a> > <a href="https://www.easyaq.com/type/6.shtml">程序员</a> > <a href="https://www.easyaq.com/news/1236158380.shtml" title="E安全">正文</a></div>
				<div class="inner">
					<h1 style="font-size:25px;font-weight:bold;line-height:32px;">看黑客如何玩转DNS泛解析</h1>
					<ul class="lab">
						<li><a href="https://www.easyaq.com/samesource/freebuf.shtml" title="E安全资讯来源-FreeBuf">
							<img src="https://cdn.easyaq.com/@/image/video/FILE_492qpzg451a2h8.jpg" alt="E安全资讯来源-FreeBuf"/>
							</a></li>
						<li><a href="https://www.easyaq.com/samesource/freebuf.shtml" target="_blank" title="E安全资讯来源 | FreeBuf">FreeBuf</a></li>/
						<li><a href="https://www.easyaq.com/type/6.shtml" target="_blank" title="E安全 | 程序员">程序员</a></li>/
						<li><a href="javascript:void">2017-05-11 15:00</a></li>
					</ul>
				</div>
			</div>
				<div class="content-text">
		
					<p style="text-align:justify;"><strong>网络创立之初，大部分的访问都是通过IP地址来实现的，因web等协议与应用的兴起，有了域名，再通过IP去访问一方面不太容易记，另一方面因负载、CDN等方面的原因，单纯使用IP地址访问会带来一些问题。因此域名产生了，通过域名访问，中间设备只认识IP，因此最终还是解析到相应的IP地址去访问。这个用来解析的协议称作DNS，主要功能为将域名解析到相应的IP地址。</strong></p><p style="text-align:justify;"><strong>DNS的创造是网络大师的一大杰作，通过DNS</strong><strong>广大网民可以通过域名来访问相应的网站。</strong>这样只需要记住域名就可以了，不需要记住繁琐的IP地址。如我们经常访问的<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>，其DNS解析过程如下：</p><p style="text-align: center;"><a href="https://www.easyaq.com/go?url=http://image.3001.net/images/20170511/1494487491473.png"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494125146024926.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></a></p><p style="text-align:justify;">上图可以看到，<strong>DNS的解析非常轻巧，使用UDP 协议，一个DNS</strong><strong>查询包，一个响应包，两个包搞定，简洁轻巧，效率高。</strong>但是在实际过程中经常会遇到一个问题：输入域名的时候如<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>，一不小心多输入一个w变成w<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>，这样的话，可以正常解析吗？我做了一下实验，在浏览器输入w<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>，浏览器直接报错“无法访问此网站”</p><p style="text-align: center;"><a href="https://www.easyaq.com/go?url=http://image.3001.net/images/20170511/14944875014465.png"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494125261040781.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></a></p><p style="text-align:justify;">我们来看看DNS的解析流程，客户端进行了一次DNS查询，DNS服务器查询以后返回一个结果“NO such name&nbsp;A w<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>”，可以看到DNS服务器进行查询后，查找不到这样的结果。</p><p style="text-align: center;"><a href="https://www.easyaq.com/go?url=http://image.3001.net/images/20170511/14944875139994.png"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494125353089263.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></a></p><p style="text-align:justify;">为什么w<a href="https://www.easyaq.com/go?url=http://www.vants.org">www.vants.org</a>解析不到相应的IP？原因很简单，DNS没有相应的配置，但是在现实中，肯定经常存在用户输入错误域名前缀的情况，如果网站服务方考虑的足够人性化，完全可以配置一个DNS解析记录，配置一个默认解析结果。在DNS实现中，的确有这样一套机制，这个称作DNS泛解析。</p><p style="text-align:justify;">既然有DNS泛解析这样一套机制，在实际生活中肯定会存在相应的应用。那么我们来亲测一下，首先拿google开刀，随机输入一个子域名看看能不能正常解析，解析不了；再测试一下度娘，也解析不了。</p><p style="text-align: center;"><img src="https://cdn.easyaq.com/@/20170511/1494494204296049586.jpg" title="看黑客如何玩转DNS泛解析-E安全" alt="看黑客如何玩转DNS泛解析-E安全"/></p><p style="text-align:justify;">两大寡头都不支持泛解析，继续找下小站，公司渗透大牛很不屑的扔给我一批开了泛解析的域名，随便测试一个，可以解析到主站的IP上。</p><p style="text-align: center;"><a href="https://www.easyaq.com/go?url=http://image.3001.net/images/20170511/14944875406194.png"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494125841044991.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></a></p><p style="text-align:justify;">既然泛解析有这么人性化的应用，那么像google、度娘为什么不打开DNS泛解析？这肯定是考虑到安全与运维成本等方面。DNS泛解析还存在安全问题？的确存在！上图中的泛解析是解析到主站的IP，如果泛解析的IP被解析到其他的IP，或者是黑客的IP呢？</p><p style="text-align:justify;">有这种情况？的确，在实际工作中多次遇到这种情况。前天发现一政府的门户网站通过度娘搜索子域名时，搜索到301000个站点，通过搜索的结果直接点击进入，发现有很多子域名都跳转到博彩网站。</p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494125939047132.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126091098687.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align:justify;">通过ping测试，发现主站解析到61.191.*.*，而泛解析却被解析到23.105.65.113，这个IP是美国的IP。DNS的泛解析结果肯定被黑客恶意修改了。</p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126191057123.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126242008219.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126361036981.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align:justify;">既然被DNS被泛解析到恶意的IP，并且有这么多解析记录，那么用户为什么一直没有发现这个问题？这令我百思不得其解。直到有一次在浏览器中输入一个随机子域名访问时，竟然跳转到正常主站页面上去了。既然可以根据用户的访问条件(通过搜索或直接输入)在博彩与正常主站之间跳转，那么在23.105.65.113这个页面肯定存在一个判断的条件，触发这些条件时跳转到博彩网站，没有触发时跳转到正常页面。一般情况下，都是通过JS来做识别和跳转的，这样只要过滤相应的JS脚本即可，直接分析23.105.65.113页面源码，过滤&lt;script src= &nbsp;果然找到相应的JS脚本。</p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126471064618.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126664082892.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align:justify;">看一下这个js内容，判断条件很简单，http的包头referrer字段，只要referrer字段中有c或者n就跳转到win.an888.top，否则就跳转到www.*.gov.cn。这样的话就解释了直接打开随机子域名跳转到正常页面而通过百度搜索时跳转到博彩页面的疑问。如果通过直接访问随机子域名会跳转到主站页面，不容易被管理人员发现，但是通过搜索访问时会有referrer字段，只要字段中有c或者n就会跳转到博彩网站。</p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126715018397.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align: center;">通过百度搜索访问时有referrer字段</p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126825013979.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/></p><p style="text-align: center;">直接访问无referrer字段</p><p style="text-align:justify;">注：因截图时，相关网站的DNS泛解析已被关闭，所以截图测试的的是主站。但是原理是一样：通过搜索引擎搜索时都会带有referrer字段，直接访问时不会带有referrer字段。</p><p style="text-align:justify;">另外，黑客为什么设置带有c或者n时作为判断跳转的条件，一般情况下都通过搜索查找相应子域名时，referrer都会带有.com或者.cn这样的字段，c和n比较容易触发跳转条件。</p><p style="text-align:justify;">黑产利用泛解析导致访问子域名为博彩网站的过程如下：</p><p style="text-align:justify;">1.&nbsp;首先黑客肯定要拿到用户域名的管理权限。有的用户的域名管理是放在运营商那边的，有的是自己来管理的。怎么拿到相应管理权限，爆破、社工、XSS、注入。。。。。不是本次分析的重点就不一一介绍</p><p style="text-align:justify;">2.&nbsp;在域名设置中，增加泛解析设置。设置为：RR,*.域名.com/cn……，A记录，解析结果为黑客IP:23.105.65.113</p><p style="text-align:justify;">3.&nbsp;23.105.65.113页面中加入JS脚本</p><pre><code>&lt;script src=&quot;http://www.xc969.com/js/ah.js&quot;&gt;&lt;/script&gt;<br/></code></pre><p style="text-align:justify;">4.&nbsp;设置JS跳转判断条件，</p><pre><code>var&nbsp;ref=document.referrer;if(ref.indexOf(&quot;c&quot;)&gt;=0||ref.indexOf(&quot;n&quot;)&gt;=0)
{location.href=&quot;http://win.an888.top/&quot;;}else{location.href=&quot;http://www.相关网站.gov.cn/&quot;;}<br/></code></pre><p style="text-align:justify;">5. 用户访问触发泛解析时，根据JS判断条件(referer中有c或者n)返回win.an888.top否则返回正常的网站页面。</p><p style="text-align:justify;">那么通过百度搜索到这么多的页面是如何生成的？<br/></p><p style="text-align: center;"><img alt="看黑客如何玩转DNS泛解析-E安全" src="https://cdn.easyaq.com/@/20170511/1494494126990044996.jpg" title="看黑客如何玩转DNS泛解析-E安全" width="95%"/><br/></p><p style="text-align:justify;">一般都是黑客生成相应的子域名，然后通过流量较大的网站去链接，当搜索引擎爬虫去爬流量较大的网站时，就会爬到这些子域名。</p><p style="text-align:justify;">下面看一段在实际中遇到的根据爬虫返回特定页面的案例：</p><pre class="brush:bash;toolbar:false">&lt;%&nbsp;定义方法函数function&nbsp;Getbot()
dim&nbsp;s_agent
GetBot=&quot;&quot;s_agent=Request.ServerVariables(&quot;HTTP_USER_AGENT&quot;)if&nbsp;instr(1,s_agent,&quot;googlebot&quot;,1)&nbsp;&gt;&nbsp;0&nbsp;thenGetBot=&quot;google&quot;end&nbsp;ifif&nbsp;instr(1,s_agent,&quot;baiduspider&quot;,1)&nbsp;&gt;&nbsp;0&nbsp;thenGetBot=&quot;baidu&quot;end&nbsp;ifend&nbsp;function%&gt;
&lt;style&nbsp;type=&quot;text/css&quot;&gt;
&lt;!–
.STYLE1&nbsp;{color:&nbsp;#FF0000}–&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;table&nbsp;width=&quot;751&quot;&nbsp;height=&quot;512&quot;&gt;
&lt;tr&gt;
&lt;td&nbsp;height=&quot;132&quot;&nbsp;bgcolor=&quot;#00CCFF&quot;&gt;&lt;div&nbsp;align=&quot;center&quot;&gt;网页头文件(可以是导航栏、图片获其他内容)&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&nbsp;height=&quot;311&quot;&gt;网页内容部分&lt;/td&gt;
&lt;/tr&gt;
&lt;%if&nbsp;GetBot=&quot;baidu&quot;&nbsp;or&nbsp;GetBot=&quot;google&quot;&nbsp;thenResponse.Write&nbsp;&quot;&lt;a&nbsp;href=’http://bbs.acehat.com’&gt;(友链一)黑帽&lt;/a&gt;&lt;a&nbsp;
href=’http://bbs.acehat.com’&gt;(友链二)黑帽论坛&lt;/a&gt;&quot;elseResponse.Write&quot;不做处理，或输出任意&quot;end&nbsp;if%&gt;</pre><p style="text-align:justify;">上面的代码意思为:如果发现访问网站的User_agent为baiduspider或者googlebot则为其返回的页面为’<a href="https://www.easyaq.com/go?url=http://bbs.acehat.com">http://bbs.acehat.com</a>’&gt;(友链一)黑帽和<a href="https://www.easyaq.com/go?url=http://bbs.acehat.com">http://bbs.acehat.com</a>’&gt;(友链二)黑帽论坛，不是百度和谷歌爬虫的话则“不做处理，或输出任意”。<br/></p><p style="text-align:justify;"><strong>总结：</strong>初次碰到这种情况时，首先怀疑是的网站被黑，访问相关子域名时跳转到博彩网站，后来再仔细看了下，用户不可能注册这么多的子域名，后来才注意到DNS解析结果的变动。<br/></p><p>可见，<strong>DNS</strong><strong>泛解析是一把双刃剑，配置好的话可以提高用户体验，配置不好的话很容易被黑客利用。</strong>另外，经常遇到过运营商在DNS里做过手脚，当用户输入不存在的域名时都会跳转到他们设置好的游戏、搜索类网站。</p><div id="adpush" style="width: 100%; text-align: center;"></div>
					<div class="bdsharebuttonbox">
						<a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin"
							data-cmd="weixin"></a>
					</div>
					<script>
						
						window._bd_share_config = {
							"common" : {
								"bdSnsKey" : {},
								"bdText" : "",
								"bdMini" : "2",
								"bdPic" : "",
								"bdStyle" : "0",
								"bdSize" : "16"
							},
							"share" : {},
							"image" : {
								"viewList" : [ "qzone", "tsina", "tqq",
										"renren", "weixin" ],
								"viewText" : "分享到：",
								"viewSize" : "16"
							},
							"selectShare" : {
								"bdContainerClass" : null,
								"bdSelectMiniList" : [ "qzone", "tsina", "tqq",
										"renren", "weixin" ]
							}
						};
						with (document)
							0[(getElementsByTagName('head')[0] || body)
									.appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='
									+ ~(-new Date() / 36e5)];
					</script>
					<div class="nextnews">
						<p>
								上一篇 : <a href="https://www.easyaq.com/news/2091739710.shtml">80后夫妻一年卖出1600多万条个人信息 特大侵犯公民个人信息案在通开庭审理</a>
							</p>
						<p>
								下一篇 : <a href="https://www.easyaq.com/news/729147600.shtml">共享充电宝被黑客200块改装 竟可盗隐私窥图片</a>
							</p>
						</div>
					<div class="mylike">
						<div class="like_lab">您可能感兴趣的资讯</div>
						<div class="like_news">
									<a href="https://www.easyaq.com/news/2087717948.shtml" title="别以为黑客离你很远：一份月收入75W美金的灰产"><img src="https://cdn.easyaq.com/@/20170727/1501147015952059642.jpg?imageView2/1/w/270/h/152" alt="别以为黑客离你很远：一份月收入75W美金的灰产" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/2087717948.shtml" title="别以为黑客离你很远：一份月收入75W美金的灰产">别以为黑客离你很远：一份月收入75W美金的灰产</a>
										</h5>
									</div>
								</div>
							
						<div class="like_news">
									<a href="https://www.easyaq.com/news/1489485798.shtml" title="伊朗黑客成功窃取美国导弹设计软件"><img src="https://cdn.easyaq.com/@/20170720/1500544787038057830.jpg?imageView2/1/w/270/h/152" alt="伊朗黑客成功窃取美国导弹设计软件" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/1489485798.shtml" title="伊朗黑客成功窃取美国导弹设计软件">伊朗黑客成功窃取美国导弹设计软件</a>
										</h5>
									</div>
								</div>
							
						<div class="like_news">
									<a href="https://www.easyaq.com/news/2109448420.shtml" title="Linux文件管理器现“Bad Taste”漏洞,通过恶意MSI文件运行恶意代码"><img src="https://cdn.easyaq.com/@/20170720/1500564535781024818.jpg?imageView2/1/w/270/h/152" alt="Linux文件管理器现“Bad Taste”漏洞,通过恶意MSI文件运行恶意代码" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/2109448420.shtml" title="Linux文件管理器现“Bad Taste”漏洞,通过恶意MSI文件运行恶意代码">Linux文件管理器现“Bad Taste”漏洞,通过恶意MSI文件运行恶意代码</a>
										</h5>
									</div>
								</div>
							
						<div class="like_news">
									<a href="https://www.easyaq.com/news/343315162.shtml" title="CIA计划销毁已泄露的相关机密文件"><img src="https://cdn.easyaq.com/@/20170719/1500457905910043675.jpg?imageView2/1/w/270/h/152" alt="CIA计划销毁已泄露的相关机密文件" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/343315162.shtml" title="CIA计划销毁已泄露的相关机密文件">CIA计划销毁已泄露的相关机密文件</a>
										</h5>
									</div>
								</div>
							
						<div class="like_news">
									<a href="https://www.easyaq.com/news/627559216.shtml" title="FBI和DHS调查发现：黑客多使用网络钓鱼攻击能源行业"><img src="https://cdn.easyaq.com/@/20170718/1500372064673018682.jpg?imageView2/1/w/270/h/152" alt="FBI和DHS调查发现：黑客多使用网络钓鱼攻击能源行业" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/627559216.shtml" title="FBI和DHS调查发现：黑客多使用网络钓鱼攻击能源行业">FBI和DHS调查发现：黑客多使用网络钓鱼攻击能源行业</a>
										</h5>
									</div>
								</div>
							
						<div class="like_news">
									<a href="https://www.easyaq.com/news/469744846.shtml" title="中共中央宣传部、中共中央组织部、中央网信办联合印发《关于规范党员干部网络行为的意见》的通知"><img src="https://cdn.easyaq.com/@/20170801/1501577192143039571.jpg?imageView2/1/w/270/h/152" alt="中共中央宣传部、中共中央组织部、中央网信办联合印发《关于规范党员干部网络行为的意见》的通知" title=""></a>
									<div class="like_tittle">
										<h5>
											<a href="https://www.easyaq.com/news/469744846.shtml" title="中共中央宣传部、中共中央组织部、中央网信办联合印发《关于规范党员干部网络行为的意见》的通知">中共中央宣传部、中共中央组织部、中央网信办联合印发《关于规范党员干部网络行为的意见》的通知</a>
										</h5>
									</div>
								</div>
							
						</div>
					<!--畅言评论-->
				<div id="SOHUCS" class="comment" style="width: 90%"></div>
				</div>
			</div>
			<div class="Emain_right">
				<div class="deteal_class bgwhite">
					<img src="https://www.easyaq.com/images/class.png" alt="">
					<div class="class_name">
						<a href="">程序员资讯</a>
					</div>
					<div class="class_art">
						<i class="class_num"></i>共有<a href="https://www.easyaq.com/type/6.shtml" target="_blank" title="E安全 | 程序员">51</a>篇相关文章
					</div>
				</div>

				<!--相关资讯-->
				<div class="rank bgwhite" id="rank">
					<div class="block_head">
						相关<span class="rd">资讯</span>
						<div class="triangle"></div>
						<div class="more">
							<a href="https://www.easyaq.com/" title="E安全-相关资讯"></a>
						</div>
					</div>
					<ul class="hotlist_block" id="rankinfo">
					<li class="hotlist bt">
							<a href="https://www.easyaq.com/news/993.shtml" title="外媒指责中国黑客通过福布斯网站展开网络攻击" target="_blank">
								<img src="https://cdn.easyaq.com/@/image/info/IMG_6b61w5y5v15yrp_640_294.jpg?imageView2/1/w/250/h/154" alt="外媒指责中国黑客通过福布斯网站展开网络攻击" title="外媒指责中国黑客通过福布斯网站展开网络攻击">
							</a>
							<a href="https://www.easyaq.com/news/993.shtml" title="外媒指责中国黑客通过福布斯网站展开网络攻击" target="_blank">外媒指责中国黑客通过福布斯网站展开网络攻击</a>
						</li>
					<li class="hotlist bt">
							<a href="https://www.easyaq.com/news/2132425727.shtml" title="中国互联网发展基金会网络安全专项基金 网络安全优秀人才奖评选结果公示" target="_blank">
								<img src="https://cdn.easyaq.com/@/image/video/4143f0e5-f7c7-4e03-a0c3-a5e9f67bdcf7.jpg?imageView2/1/w/250/h/154" alt="中国互联网发展基金会网络安全专项基金 网络安全优秀人才奖评选结果公示" title="中国互联网发展基金会网络安全专项基金 网络安全优秀人才奖评选结果公示">
							</a>
							<a href="https://www.easyaq.com/news/2132425727.shtml" title="中国互联网发展基金会网络安全专项基金 网络安全优秀人才奖评选结果公示" target="_blank">中国互联网发展基金会网络安全专项基金 网络安全优秀人才奖评选结果公示</a>
						</li>
					<li class="hotlist bt">
							<a href="https://www.easyaq.com/news/1012289879.shtml" title="《精灵宝可梦：GO》迟迟不上线 开发商CEO推特被黑客攻击" target="_blank">
								<img src="https://cdn.easyaq.com/@/image/video/bed4c9c5-69ae-44ca-83df-2246caa1a39c.jpg?imageView2/1/w/250/h/154" alt="《精灵宝可梦：GO》迟迟不上线 开发商CEO推特被黑客攻击" title="《精灵宝可梦：GO》迟迟不上线 开发商CEO推特被黑客攻击">
							</a>
							<a href="https://www.easyaq.com/news/1012289879.shtml" title="《精灵宝可梦：GO》迟迟不上线 开发商CEO推特被黑客攻击" target="_blank">《精灵宝可梦：GO》迟迟不上线 开发商CEO推特被黑客攻击</a>
						</li>
					<li class="hotlist bt">
							<a href="https://www.easyaq.com/news/679498658.shtml" title="黑客在暗网再次兜售2亿Yahoo用户数据" target="_blank">
								<img src="https://cdn.easyaq.com/@/image/video/68ada89f-c4a2-4f1c-a0c9-89752fead91c.jpg?imageView2/1/w/250/h/154" alt="黑客在暗网再次兜售2亿Yahoo用户数据" title="黑客在暗网再次兜售2亿Yahoo用户数据">
							</a>
							<a href="https://www.easyaq.com/news/679498658.shtml" title="黑客在暗网再次兜售2亿Yahoo用户数据" target="_blank">黑客在暗网再次兜售2亿Yahoo用户数据</a>
						</li>
					<li class="hotlist bt">
							<a href="https://www.easyaq.com/news/1392017740.shtml" title="意大利国家安全框架——网络安全与情报模型" target="_blank">
								<img src="https://cdn.easyaq.com/@/image/video/a25810f3-a1ba-4156-9b88-87e15d421d0c.jpg?imageView2/1/w/250/h/154" alt="意大利国家安全框架——网络安全与情报模型" title="意大利国家安全框架——网络安全与情报模型">
							</a>
							<a href="https://www.easyaq.com/news/1392017740.shtml" title="意大利国家安全框架——网络安全与情报模型" target="_blank">意大利国家安全框架——网络安全与情报模型</a>
						</li>
					</ul>
				</div>
				
				<!--热门关键词-->
				<div class="hotword mt20 bgwhite">
					<div class="block_head">
						热门<span class="rd">关键词</span>
						<div class="triangle"></div>
						<div class="more">
							<a href="https://www.easyaq.com/"></a>
						</div>
					</div>
					<ul class="hotwordlist" id="hottingWord">
						
					</ul>
				</div>

				<img id="erweima" src="https://www.easyaq.com/img/v2.0/erweima.png" alt="E安全" title="E安全" class="mt20">

			</div>
		</div>
	</div>
	<div class="gotop" id="gotop"></div>
	<!--footer-->
	<style>
.bottom {
	width: 100%;
	height: 50px;
	line-height: 50px;
	clear:both;
	max-width: 1200px;
	margin: 0 auto;
}
.bottom ul li {
	
	float: right;
	margin: 0px 5px;
}
.bottom ul li a {
	color: #f1f1f1;
}
</style>
<footer id="dibu" style="background-color: #fff; margin: 0 auto;clear:both">
	<div
		style="background: url(/img/nav_bg.png) repeat-x">
		<div class="bottom">
			<span rel="external nofollow" style="color: #f1f1f1; float: left">© Copyright 2017 - 北京易安乾坤信息科技有限公司&E安全. <a href="http://www.miibeian.gov.cn/" target="_blank"><img src="/img/ICP.gif" style="margin-top:8px;color:white;"/>京ICP备16011365号-3</a></span>
			<ul class="botul" >
				<li><a href="https://www.easyaq.com/about">关于我们</a></li>
				<li><a href="https://www.easyaq.com/join">加入我们</a></li>
				<li><a href="https://www.easyaq.com/cbuteinstruction">文章投稿</a></li>
				<li style="list-style:none;"><a href="https://www.easyaq.com/cooperation">商务合作</a></li>
			</ul>
		</div>
	</div>
</footer>
<div style="display: none">
	<!-- 这个是站长统计的代码 -->
	<script src="https://s5.cnzz.com/z_stat.php?id=5847145&web_id=5847145"></script>
</div>
<script>
	(function() {
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = "https://zz.bdstatic.com/linksubmit/push.js";
		} else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
</script>
</body>

<script>
var erweima = document.getElementById("erweima");
var erweima_top = erweima.offsetTop;
window.onscroll = function() {
	if (scroll().top > erweima_top) {
		erweima.className = " mt20 bgwhite fix";

	} else {
		erweima.className = "mt20 bgwhite";
	}
};
</script>
<script src="https://www.easyaq.com/js/v2.0/newsdetail.js"></script>
<script>
	$(function() {
		SyntaxHighlighter.all();
		//       返回顶部
		$(window).scroll(function() {
			if ($(this).scrollTop() > 500) {
				$("#gotop").fadeIn();
			} else {
				$("#gotop").fadeOut();
			}
		});
		$("#gotop").click(function() {
			$("html,body").animate({
				scrollTop : 0
			}, "normal");
			return false;
		});
		//        返回顶部结束
	});
</script>

<script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js"></script>
	<script type="text/javascript">
		window.changyan.api.config({
			appid : 'cysqseu5p',
			conf : '476e28689355585e1c3dc46663dab201'
		});
	</script>
	<script>
		$(function() {
			//友情链接
			$.ajax({
				type : "GET",
				//dataType : "json",
				url : "https://www.easyaq.com/infoadpush",

				success : function(retData) {
					if (retData.retCode == "1") {//表明已经从数据库成功读取到数据
						$("#adpush").html("");//先清空
						$.each(retData.retObj, function(index, data) {//遍历天排行、周排行、月排行
							// 						if(index==0){
							// 							$("#adpush").append(data.content);							
							// 						}

							$("#adpush").append(data.content);
							$("#adpush img").css("width", "100%");
						});

					}
				},

				failure : function(d) {
					bootbox.alert("友情链接获取失败");
				},
			//complete:clearWait()
			});
		});
	</script>
</html>