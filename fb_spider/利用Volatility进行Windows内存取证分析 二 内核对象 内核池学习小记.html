<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
                              _.._        ,------------.
                           ,'      `.    ( We want you! )
                          /  __) __` \    `-,----------'
                         (  (`-`(-')  ) _.-'
                         /)  \  = /  (
                        /'    |--' .  \
                       (  ,---|  `-.)__`
                        )(  `-.,--'   _`-.
                       '/,'          (  Uu",
                        (_       ,    `/,-' )
                        `.__,  : `-'/  /`--'
                          |     `--'  |
                          `   `-._   /
                           \        (
                           /\ .      \.  freebuf
                          / |` \     ,-\
                         /  \| .)   /   \
                        ( ,'|\    ,'     :
                        | \,`.`--"/      }
                        `,'    \  |,'    /
                       / "-._   `-/      |
                       "-.   "-.,'|     ;
                      /        _/["---'""]
                     :        /  |"-     '
                     '           |      /
                                 `      |
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  利用Volatility进行Windows内存取证分析(二)：内核对象、内核池学习小记 - FreeBuf.COM | 关注黑客与极客</title>
<meta name="description" content="*本文原创作者：ExpLife，本文属FreeBuf原创奖励计划，未经许可禁止转载    
简介
windows下内存取证的内容概括起来讲就是检测系统中有没有恶意程序,有没有隐藏进程,有没有隐藏文件,有没有隐藏服务,有没有隐藏的驱…" />
<meta name="keywords" content="Volatility, Windows内存取证, 最全安全工具信息,安全工具下载地址,安全工具排行, 系统安全解决方案,系统安全软件排行,系统安全技术" />
<meta name="baidu-site-verification" content="nKKKqQxp6R" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta property="qc:admins" content="6620477777662552566375" />
<link rel='stylesheet' id='wpfp-css' href='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.css' type='text/css' />
<link rel='stylesheet' id='wp-recentcomments-css'  href='http://static.3001.net/css/recentcomments/wp-recentcomments.css?ver=2.2.3' type='text/css' media='screen' />
<link rel='stylesheet' id='mycred-widget-css'  href='http://www.freebuf.com/buf/plugins/gold/assets/css/widget.css?ver=1.3.2.1' type='text/css' media='all' />
<script type='text/javascript' src='http://static.3001.net/js/header/jquery.min.js?ver=3.6.1'></script>
<script type='text/javascript' src='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.js?ver=3.6.1'></script>
<link rel='prev' title='深圳市安络科技有限公司招聘渗透测试工程师' href='http://www.freebuf.com/jobs/124926.html' />
<link rel='next' title='安全抽象：网络安全生态系统从复杂臃肿到有效自动化的发展之道' href='http://www.freebuf.com/articles/neopoints/125175.html' />
<link rel='canonical' href='http://www.freebuf.com/sectool/124800.html' />
<link rel='shortlink' href='http://www.freebuf.com/?p=124800' />

<link rel="stylesheet" href="http://static.3001.net/css/highslide/highslide.css" type="text/css" />
<script type="text/javascript" src="http://static.3001.net/js/highslide/highslide-with-html.packed.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
    hs.graphicsDir = "http://www.freebuf.com/buf/plugins/auto-highslide/images/graphics/";
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.addSlideshow({
        interval: 5000,
        repeat: true,
        useControls: true,
        fixedControls: "fit",
        overlayOptions: {
            opacity: 0.75,
            position: "bottom center",
            hideOnMouseOut: true

        }

    });
});
</script>
          <script language="JavaScript" type="text/javascript" src="http://www.freebuf.com/buf/plugins/cartpauj-pm/js/script.js"></script>
      <link rel="stylesheet" type="text/css" href="http://www.freebuf.com/buf/plugins/cartpauj-pm/style/style.css" />
      <script type="text/javascript" src="http://www.freebuf.com/buf/plugins/simditor/highlight/highlight.pack.js"></script><link type="text/css" rel="stylesheet" href=" http://www.freebuf.com/buf/plugins/simditor/highlight/styles/default.css" />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<link rel="shortcut icon" href="http://static.freebuf.com/images/favicon.ico" />
<link rel="stylesheet" href="http://static.3001.net/css/new/header.css" />
<link href="http://static.3001.net/css/new/bootstrap.min.css?ver=2016051701" rel="stylesheet" media="screen">
    <!--轮播图-->
    <link href="http://static.3001.net/css/new/swiper-3.4.2.min.css" rel="stylesheet" type="text/css">
    <link href="http://static.3001.net/css/new/style.css?ver=20170912568" rel="stylesheet" type="text/css">
    <style type="text/css">
#contenttxt hr {
  display: block;
  height: 0px;
  border: 0;
  border-top: 1px solid #ccc;
  margin: 15px 0;
  padding: 0;
}
#contenttxt table {
  width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 15px 0;
}
#contenttxt table thead {
  background-color: #f9f9f9;
}
#contenttxt table td, #contenttxt table th {
  min-width: 40px;
  height: 30px;
  border: 1px solid #ccc;
  vertical-align: top;
  padding: 2px 4px;
  text-align: left;
  box-sizing: border-box;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
#contenttxt table td.active, #contenttxt table th.active {
  background-color: #ffffee;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
</style>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery-2.0.3.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/bootstrap.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/slider.js?2016022501.1" type="text/javascript"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery.sticky.js" type="text/javascript"></script>
<script src="http://static.3001.net/js/focus/bjqs-1.3.min.js" type="text/javascript" ></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/mosaic.1.0.1.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="http://static.3001.net/js/new/setint.js"></script>
    <!--轮播图-->
    <script src="http://static.3001.net/js/colum/swiper-3.4.2.min.js"></script>
<!--[if lt IE 9]>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/html5shiv.min.js"></script>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/respond.min.js"></script>
<![endif]-->
    <style>
        @font-face {font-family: 'iconfont';
            src: url('http://static.3001.net/iconfont/iconfont.eot'); /* IE9*/
            src: url('http://static.3001.net/iconfont/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
            url('http://static.3001.net/iconfont/iconfont.woff') format('woff'), /* chrome、firefox */
            url('http://static.3001.net/iconfont/iconfonticonfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
            url('http://static.3001.net/iconfont/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
        }
    </style>
</head>

<body>
<!----------header---------->
<!--头部导航-->
<div id="undefined-sticky-wrapper" class="sticky-wrapper is-sticky">
    <div class="main-header">
        <div class="header">
            <div class="header-container clearfix">
                                <div class="header-logo"><a href="http://www.freebuf.com"></a></div>
                                        <!-- column -->
                        <div class="nav">
                            <ul class="nav-child clearfix">
                                <li class=" index">
                                    <a href="http://www.freebuf.com">首页</a></li>
                                <li data-value="read-menu">
                                    <a href="#">分类阅读<b class="triangle-down triangle-down-04"></b></a>
                                </li>
                                <li data-value="wenku-menu"><a href="javascript:;" target="_blank">文库<b class="triangle-down triangle-down-04"></b></a></li>
                                <li>
                                    <a href="http://zhuanlan.freebuf.com" target="_blank">专栏</a><b class="icon-betr"></b>
                                </li>
                                <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                                <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                                <li data-value="company-menu"><a href="javascript:;" >企业服务<b class="triangle-down triangle-down-04"></b></a></li>
                                <li data-value="user-menu"><a href="javascript:;" >用户服务<b class="triangle-down triangle-down-04"></b></a></li>
                            </ul>
                        </div>
                                        <div class="header-right">
                                    <div class="loginSign login-before">
                        <a href="https://account.tophant.com/register.html" class="login-btn">注册</a>
                        |
                        <a href="http://www.freebuf.com/oauth" class="sign-btn">登录</a>
                    </div>
                                    <!--搜索-->
                    <div class="search-form-inner clearfix">
                        <i class="searchdisplayico"></i>
                        <div class="form-group has-active search-col search-form-text">
                            <form id="hpsform-new" class="navbar-search navbar-form" onsubmit="return dispatch();">
                                <div class="form-group">
                                    <input id="bigq" class="input form-control" type="text" placeholder="关键字查找" autocomplete="off" title="关键字查找" name="q">
                                    <button class="submit" type="submit"></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!--<script>
                        $('.search-form-inner .searchdisplayico').click(function(event) {
                            var evt = evt || event;
                            evt.stopPropagation();
                            $(this).siblings('.search-col').addClass('active');
                        });
                        $('.search-form-inner .search-col').click(function(event) {
                            var evt = evt || event;
                            evt.stopPropagation();
                            $('.search-form-inner .search-col').addClass('active');
                        });
                        $(document).click(function() {
                            $('.search-form-inner .search-col').removeClass('active');
                        });
                    </script>-->
                                    <div class="btn-publish">
                        <a href="#">投稿</a>
                        <div class="btn-publish-child">
                            <ul class="btn-child clearfix">
                                <li><a href="http://my.freebuf.com/post/edit/" target="_blank">文章撰写</a></li>
                                <li><hr/></li>
                                <li><a href="http://my.freebuf.com/post/article/" target="_blank">投稿管理</a></li>
                                                        </ul>
                        </div>
                    </div>
                </div>
                <div class="nav-small">
                    <a href="#">&#xe634;</a>
                    <ul class="nav-child clearfix">
                                                        <li class=" index">
                                    <a href="http://www.freebuf.com">首页</a></li>
                                <li class="read-classify">
                                    <a href="#">分类阅读<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2 read-classify clearfix">
                                        <li>
                                            <strong>黑客</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                                <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                                <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                                <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                                <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                                <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                                <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                                <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                                <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                                <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                                <a href="http://www.freebuf.com/ics-articles" target="_blank">工控安全</a>
                                            </div>
                                        </li>
                                        <li>
                                            <strong>极客</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                                <a href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                                            </div>
                                        </li>
                                        <li>
                                            <strong>特色</strong>
                                            <div class="nav-item">
                                                <a href="http://www.freebuf.com/news/special" target="_blank">头条</a>
                                                <a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a>
                                                <a href="http://www.freebuf.com/fevents" target="_blank">活动</a>
                                                <a href="http://www.freebuf.com/video" target="_blank">视频</a>
                                                <a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a>
                                                <a href="http://www.freebuf.com/jobs" target="_blank">招聘</a>
                                                <a href="http://www.freebuf.com/paper/" target="_blank">报告</a>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="http://zhuanlan.freebuf.com/" target="_blank">专栏</a></li>
                                <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                                <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                                <li>
                                    <a href="javascript:;" target="_blank">企业服务<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="https://www.vulbox.com/bounties/item-9-0-1" target="_blank"><strong>企业SRC</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://company.freebuf.com" target="_blank"><strong>企业空间</strong></a>
                                        </li>
                                        <li>
                                            <a href="https://www.vulbox.com/" target="_blank"><strong>安全测试</strong></a>
                                        </li>
                                        <li>
                                            <a href="https://www.riskivy.com/" target="_blank"><strong>风险感知</strong></a>
                                        </li>

                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:;" target="_blank">用户服务<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="http://www.freebuf.com/newsend" target="_blank"><strong>有奖投稿</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://zhuanlan.freebuf.com" target="_blank">
                                        </li>
                                        <li>
                                            <a href="https://www.vulbox.com/bounties/detail-72" target="_blank"><strong>提交漏洞</strong></a>
                                        </li>
                                        <li class="last">
                                            <a href="https://www.vulbox.com/bounties" target="_blank"><strong>参与众测</strong></a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:;" target="_blank">文库<b class="icon-arrow"></b></a>
                                    <ul class="nav-child2">
                                        <li>
                                            <a href="http://www.freebuf.com/wenku" target="_blank"><strong>文库</strong></a>
                                        </li>
                                        <li>
                                            <a href="http://www.freebuf.com/special-subject" target="_blank"><strong>专题</strong></a>
                                        </li>
                                    </ul>
                                </li>
                                                    <li><a href="http://my.freebuf.com/post/edit" target="_blank">投稿</a></li>
                                                    <li><a href="https://account.tophant.com/register.html" class="login-btn">注册</a>
                            </li>
                            <li><a href="http://www.freebuf.com/oauth" class="sign-btn">登录</a></li>
                                            </ul>
                </div>
            </div>
            <div class="dropdown-menu read-menu" id="read-menu">
                <div class="container">
                    <ul class="menu clearfix">
                        <li>
                            <strong>黑客</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                <a class="last" href="http://www.freebuf.com/ics-articles" target="_blank">工控安全</a>
                            </div>
                        </li>
                        <li>
                            <strong>极客</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                <a class="last" href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                            </div>
                        </li>
                        <li>
                            <strong>特色</strong>
                            <div class="nav-item">
                                <a href="http://www.freebuf.com/news/special" target="_blank">头条</a>
                                <a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a>
                                <a href="http://www.freebuf.com/fevents" target="_blank">活动</a>
                                <a href="http://www.freebuf.com/video" target="_blank">视频</a>
                                <a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a>
                                <a href="http://www.freebuf.com/jobs" target="_blank">招聘</a>
                                <a class="last" href="http://www.freebuf.com/paper/" target="_blank">报告</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="dropdown-menu company-menu" id="company-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="https://www.vulbox.com/bounties/item-9-0-1" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-src.png"></span>
                                <span class="name">企业SRC</span>
                                <span class="intro">全/半托管式互联网漏洞收集管理</span>
                            </a>
                        </li>
                        <li>
                            <a href="http://company.freebuf.com" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-company.png"></span>
                                <span class="name">企业空间</span>
                                <span class="intro">为企业定制信息安全专属门户</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.vulbox.com/" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-safety.png"></span>
                                <span class="name">安全测试</span>
                                <span class="intro">国内领先的互联网安全众测服务</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="https://www.riskivy.com/" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-risk.png"></span>
                                <span class="name">风险感知</span>
                                <span class="intro">基于IT资产的自动化安全监控</span>
                            </a>
                        </li>

                    </ul>
                </div>
            </div>
            <div class="dropdown-menu user-menu" id="user-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="http://www.freebuf.com/newsend" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-write.png"></span>
                                <span class="name">有奖投稿</span>
                                <span class="intro">与整个行业分享你的经验与见解</span>
                            </a>
                        </li>
                        <li>
                            <a href="http://zhuanlan.freebuf.com" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-column.png"></span>
                                <span class="name">申请专栏</span>
                                <span class="intro">自由创作，打造自主内容品牌</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.vulbox.com/bounties/detail-72" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-leak.png"></span>
                                <span class="name">提交漏洞</span>
                                <span class="intro">与数万白帽一起，让互联网更安全</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="https://www.vulbox.com/bounties" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-test.png"></span>
                                <span class="name">参与众测</span>
                                <span class="intro">挖洞开启自由职业之路</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="dropdown-menu wenku-menu" id="wenku-menu">
                <div class="container">
                    <ul class="menu">
                        <li>
                            <a href="http://www.freebuf.com/wenku" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-write.png"></span>
                                <span class="name">文库</span>
                                <span class="intro">最全的FB百科</span>
                            </a>
                        </li>
                        <li class="last">
                            <a href="http://www.freebuf.com/special-subject" target="_blank">
                                <span class="img"><img src="http://image.3001.net/images/header/icon-test.png"></span>
                                <span class="name">专题</span>
                                <span class="intro">浓缩的安全精华汇总</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------header end---------->
<!--<script type="application/javascript">
    var  _value_tab = '';
    $(function(){
        var _that = '', _show_flag = 0;
        $('.header .header-container .nav .nav-child > li:not(input[data-value])').mouseover(function() {
            $('.header .dropdown-menu').stop().slideUp(50);
        });
        $('.header').mouseout(function() {
            $('.header .dropdown-menu').stop().slideUp(50);
        });
        /*$('.header .header-container .nav .nav-child > li').mouseover(function() {
         _value_tab = $(this).attr('data-value');
         $('#'+_value_tab).siblings('.dropdown-menu').stop().slideUp(50);
         $('#'+_value_tab).stop().slideDown(100);
         });*/
        $(".header .header-container .nav .nav-child > li").hoverDelay({
            hoverDuring: 500,
            hoverEvent: function(){
                $('#'+_value_tab).siblings('.dropdown-menu').stop().slideUp(50);
                $('#'+_value_tab).stop().slideDown(100);
            }
        });
        $('.header .dropdown-menu').mouseover(function() {
            _value_tab = $(this).attr('id');
            _that = this;
            $('.nav-child li[data-value="'+_value_tab+'"]').addClass('hover');
            $(this).stop().slideDown(50);
        }).mouseout(function() {
            $('.nav-child li[data-value="'+_value_tab+'"]').removeClass('hover');
            $(_that).stop().slideUp(50);
        });

        $(".nav-small .nav-child > li").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();

            if($(this).find('.nav-child2').is(":hidden")) {
                _show_flag = 1;
                $(this).find('.nav-child2').slideDown();
                $(this).find('.icon-arrow').addClass('bottom');
            }else {
                _show_flag = 0;
                $(this).find('.nav-child2').slideUp();
                $(this).find('.icon-arrow').removeClass('bottom');
            }
            $(this).siblings().find('.nav-child2').slideUp();
            $(this).siblings().find('.icon-arrow').removeClass('bottom');
        });
        //头部投稿按钮hover状态展开菜单
        $(".btn-publish-child > ul > li").hover(function(){
            $(this).addClass("active");
            $(this).siblings().removeClass("active");
        });

        $(document).click(function(event){
            var ev = ev || event;
            $(".login-after").find(".login-after-child").hide();
        });
        //点击用户信息，出现下拉菜单
        $("#user-info").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();
            $(".login-after").find(".login-after-child").toggle();
        });
        //顶部导航
        $(".nav-small").click(function(){
            $(this).find(".nav-child").slideToggle();
        });
        var that = '';
        $('.header .header-container .nav .nav-child > li').mouseover(function() {
            that = this;
            $(this).find('.dropdown-menu').stop().slideDown(200);
        }).mouseout(function() {
            $(that).find('.dropdown-menu').stop().slideUp(200);
        });
    });
    $(".nav-small .nav-child > li").click(function(event){
        var ev = ev || event;
        ev.stopPropagation();
        $(this).siblings('li').find('.dropdown-menu').hide();
        $(this).find(".dropdown-menu").toggle();
    });
    //鼠标经过(hover)事件的延时处理
    (function($){
        $.fn.hoverDelay = function(options){
            var defaults = {
                hoverDuring: 100,
                outDuring: 100,
                hoverEvent: function(){
                    $.noop();
                },
                outEvent: function(){
                    $.noop();
                }
            };
            var sets = $.extend(defaults,options || {});
            var hoverTimer, outTimer;
            return $(this).each(function(){
                $(this).hover(function(){
                    _value_tab = $(this).attr('data-value');
                    clearTimeout(outTimer);
                    hoverTimer = setTimeout(sets.hoverEvent, sets.hoverDuring);
                },function(){
                    clearTimeout(hoverTimer);
                    outTimer = setTimeout(sets.outEvent, sets.outDuring);
                });
            });
        }
    })(jQuery);
</script>-->
<script type="text/javascript" src="http://static.3001.net/js/header/header.js"></script><script>
    jQuery(window).load(function(){
      if(jQuery(window).width()>480){
        jQuery(".main-header").sticky({ topSpacing: 0 });
      }else{
        jQuery(".main-header nav").removeClass("navbar-fixed-top");
      }
      jQuery("#mar-right").sticky({ topSpacing: 105,bottomSpacing: 410 });
    });
</script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/layer.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/pretty/prettify.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/header/lazyload.js"></script>
<script type="text/javascript" charset="utf-8">
      jQuery(function() {
          jQuery("img").lazyload({
              effect : "fadeIn"
          });
      });
 </script>
<script type="text/javascript">
    window.onload = function(){
        prettyPrint();
    }
</script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
var va = "您已经点亮过了";
function acv_vote(id,option, m){
  if( m==null) m =''; m = m + '';
  jQuery('#acv_stat_'+m+id).html('Loading...');
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option="+option+"&ID="+id;
  jQuery.get(url,function(d){
    d =d.split('|');var s='#acv_stat_'+m+d[0];
    var sele = '#cos_support-'+m+id,unsele = '#cos_unsupport-'+m+id,tpjs = 'javascript:alert(va)';
    jQuery( s ).html( d[1] );jQuery(s).fadeOut(400,function(){jQuery(s).fadeIn();});
    if( d[2] == 1 ){ jQuery(sele).html(jQuery(sele).html()*1+1); }
    if( d[2] == -1 ){ jQuery(unsele).html(jQuery(unsele).html()*1+1); }
    jQuery('#vote4-'+id).attr('href',tpjs);jQuery('#vote4-2'+id).attr('href',tpjs);
    jQuery('#votea-'+id).attr('href',tpjs);jQuery('#votea-2'+id).attr('href',tpjs);
  });
}
  
$(document).on("mouseenter",".comment-tools",function(){
  $(this).find(".btn-report").show();
  $(this).find(".btn-report").addClass("hover");
}).on("mouseleave",".comment-tools",function(){
  var $_this = $(this);
  $(this).find(".btn-report").removeClass("hover");
  if(!$(this).find(".dropup").hasClass('open')){
    $(this).find(".btn-report").hide(); 
    $_this.find(".dropdown-menu").css("display","none");
  }else{
    setTimeout(function(){
      if(!$_this.find(".btn-report").hasClass("hover")){
        $_this.find(".dropup").removeClass("open");
        $_this.find(".dropdown-menu").css("display","none");
        $_this.find(".btn-report").hide(); 
      }
    },"500");
  }
})

$(document).on("click",".click_report",function(){
  $(this).parent().parent().css("display","none");
  var id = $(this).attr("data-id");
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option=0&ID="+id;
  $_this = $(this);
  jQuery.get(url,function(d){
    d =d.split('|');
    if(d[1]=='您已经点过灯了'){
      d[1] = '您已经举报过了';
    }
    if(d[1]=='Thank you'){
      d[1] = '举报成功';
    }
    $_this.parent().parent().parent().find(".btn-report").text(d[1]);
    $_this.parent().parent().parent().find(".btn-report").css("display","block");
  })
})

$(document).on("click",".btn-report",function(){
  if($(this).parent().hasClass('open')){
    $(this).parent().find(".dropdown-menu").css("display","block");
  }else{
    $(this).parent().find(".dropdown-menu").css("display","none");
  }
})
//]]>
</script>
<div class="column-article" data-column="">
            <div class="container pad-top35">
        <div class="row clearfix">
            <div class="col-md-9" id="getWidth">
                                    <div class="reletive search-xs-wrap">
                    <div class="form-group has-active search-col search-xs">
                        <form id="hpsform-new" class="navbar-search navbar-form" onsubmit="return dispatch()">
                            <div class="form-group">
                                <input id="q" class="input form-control" type="text" placeholder="关键字查找" autocomplete="off" title="关键字查找" name="q">
                                <button class="submit" type="submit"></button>
                            </div>
                        </form>
                    </div>
                </div>
                    <script type="text/javascript">
                        var dispatch = function () {
                            console.log(123)
                            var q = document.getElementById("q");
                            if (q.value == "") {
                                q = document.getElementById("bigq");
                            }
                            if (q.value != "") {
                                window.open('http://www.freebuf.com/?s=' + q.value, "_blank");
                                return false;
                            } else {
                                return false;
                            }
                        }
                    </script>
                                <div class="article-wrap panel panel-default">
                                                            <div class="articlecontent">
                                                    <div class="title">
                                <h2>
                                    利用Volatility进行Windows内存取证分析(二)：内核对象、内核池学习小记                                </h2>
                                <div class="property">
                                                                            <span class="name"><a href="http://www.freebuf.com/author/explife" title="由 ExpLife 发布" rel="author">ExpLife</a></span>
                                                                        <span class="icon-f"></span>
                                    <span class="time">2017-01-17</span>
                                                                                                                <span class="rmb"><img title="现金奖励" src="http://image.3001.net/images/new/icon-m.jpg"/></span>
                                                                        <span class="look">共<strong>191016</strong>人围观
                                        ，发现 <strong>8</strong> 个不明物体 </span>                                      </span>
                                                                <span class="tags">
                                      <a href="http://www.freebuf.com/./sectool">工具</a><a href="http://www.freebuf.com/./articles/system">系统安全</a></span>
                                    <span class="tags_01"></span>
                                </div>
                            </div>
                                                                                                <div id="contenttxt">
                            <p><b style="color: rgb(239, 71, 71);">*本文原创作者：ExpLife，本文属FreeBuf原创奖励计划，未经许可禁止转载</b>    </p>
<h2>简介</h2>
<p><b style="color: rgb(0, 176, 80);">windows下内存取证的内容概括起来讲就是检测系统中有没有恶意程序,有没有隐藏进程,有没有隐藏文件,有没有隐藏服务,有没有隐藏的驱动,有没有隐藏网络端口等等.而进程,文件,驱动等等部件在内存中是以内核对象的形式独立存在的。而通常形形色色的rootkit会尝试修改操作系统的内部数据结构来达到隐藏自身的目的.安全研究员要想在内存取证中做到游刃有余,就需要对windows各种内存对象相关概念进行深入的了解。</b></p>
<h2>windows执行体对象</h2>
</p>
<p> 大量的内存取证涉及到查找定位和分析执行体对象.Windows绝大多数代码是由C语言编写,其中大量使用了C语言的结构体来组织相关数据和属性.这里面有些结构体被称之为执行体对象,因为这些结构体是由Windows对象管理器(即由NT内核模块实现的一个内核组件)进行管理的(创建,保护,删除等等).严格意义上来说,只有当操作系统为一个结构体准备了用于管理诸如名称,访问控制,引用计数这些数据的各种头部的时候,该结构体才是真正意义上的执行体对象.换句话说,也就是所有的执行体对象都是结构体,但是并不是所有的结构体都是执行体对象.因为执行体对象是对象管理器分配并创建的,所以所有的执行体对象都有类似的特征.例如,所有的执行体对象都有前置头,而由其他子系统比如TCP/IP栈(tcpip.sys)分配的结构体就没有这些头.</p>
<p>表2-1中列举出了大部分与内存取证相关的执行体对象类型.我们应该逐一对这些对象类型进行熟悉.实际上,Volatility框架中至少有一个插件能够分析以下列表中列举出的每个对象.</p>
</p>
<pre><code><p>表2-1:取证相关的Windows对象</p><p>对象名称 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;结构 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;描述</p><p>File &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_FILE_OBJECT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;一个打开的文件的实例代表一个进程或者一个内核模块访问了这个文件,包括权限,存储文件内容和名称的那部分内存区域</p><p>Process &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _EPROCESS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 让所有的线程在一个私有的虚拟地址空间执行以及保存打开相应资源(譬如:文件,注册表键值等等)的句柄的一个容器</p><p>SymbolicLink &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_OBJECT_SYMBOLIC_LINK &nbsp; &nbsp; 被创建用来支持别名,这些别名可以来用帮助映射网络共享路径,可移动媒体设备驱动信件</p><p>Token &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _TOKEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;存储进程和线程的安全上下文信息(例如安全标识符[SID]和特权级别)</p><p>Thread &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_ETHREAD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;代表一个进程中可被调度执行的实体以及其CPU上下文的一个对象</p><p>Mutant &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_KMUTANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;代表互斥体,典型地用来同步操作或者针对特定资源的访问控制的一个对象</p><p>WindowStation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tagWINDOWSTATION &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;针对进程,桌面,剪切板,原子表的一个安全边界</p><p>Desktop &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tagDESKTOP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;代表可显示屏幕并且包含其用户对象,例如窗口,菜单,按钮的一个对象</p><p>Driver &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_DRIVER_OBJECT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;代表一个已经加载的内核模式驱动程序的映像,并且包含该驱动的输入/输出控制处理例程指针</p><p>Key &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _CM_KEY_BODY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;一个打开的注册表键的实例,并且包含该键值及其数据信息</p><p>Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_OBJECT_TYPE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;通过元数据来描述所有其他对象常见属性的一个对象</p></code></pre>
</p>
<p>我们可以使用微软官方的工具包SysInternals中的WinObj这款工具来查看指定版本的Windows中完整的执行体对象列表.</p>
<p>该工具包的下载地址:<a href="https://download.sysinternals.com/files/SysinternalsSuite.zip" target="_blank">https://download.sysinternals.com/files/SysinternalsSuite.zip</a></p>
<h3>对象头</h3>
<p> 所有的执行体对象之间一个最显著的特征的就是拥有一个对象头(_OBJECT_HEADER)以及零个或者多个可选的头.对象头在内存中位于执行体对象结构的前面.同样,可选头都是按固定的顺序排列在对象头的前面的.抽象的内存布局图2-1:</p>
<p style="text-align: center;"><img alt="1.png" data-original="http://image.3001.net/images/20170109/1483948030223.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="526" height="529">    </p>
<noscript><img alt="1.png" src="http://image.3001.net/images/20170109/1483948030223.png!small" width="526" height="529">    </p></noscript>
<p style="text-align: center;">图2-1</p>
<p>如图所示,如果给出了_OBJECT_HEADER地址的话,我们就能找到执行体对象结构(例如上图中的_FILE_OBJECT),反之亦然,很简单因为二者是直接紧挨着的;并且各个操作系统中_OBJECT_HEADER的大小都是一致的.可选头的存在与否依赖于对象头的InfoMask成员.我们首先一起来看一下64位Windows 7中对象头的完整结构.</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_OBJECT_HEADER")</p><p>'_OBJECT_HEADER' (56 bytes)</p><p>0x0 : PointerCount ['long long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 包含了该对象的指针总数,包括内核模式引用的</p><p>0x8 : HandleCount ['long long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;包含该对象打开句柄的数量</p><p>0x8 : NextToFree ['pointer64', ['void']]</p><p>0x10 : Lock ['_EX_PUSH_LOCK']</p><p>0x18 : TypeIndex ['unsigned char'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 该值告诉我们该对象的类型(例如,进程,线程,文件)</p><p>0x19 : TraceFlags ['unsigned char']</p><p>0x1a : InfoMask ['unsigned char'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;该值告诉我们是否存在哪种可选头&nbsp;</p><p>0x1b : Flags ['unsigned char']</p><p>0x20 : ObjectCreateInfo ['pointer64', ['_OBJECT_CREATE_INFORMATION']]</p><p>0x20 : QuotaBlockCharged ['pointer64', ['void']]</p><p>0x28 : SecurityDescriptor ['pointer64', ['void']] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;储存该对象安全限制的信息,例如,哪些用户可以对它以读,写,删除等方式进行访问</p><p>0x30 : Body ['_QUAD'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;该成员仅仅是一个占位符,代表包含在该对象中结构的起始位置</p></code></pre>
</p>
<h3>可选头</h3>
<p> 一个对象的可选头包含了用于描述该对象各种类型的元数据.很明显,因为它们是可选的,所以并不是所有的类型的对象都拥有可选头;甚至于相同类型对象的不同实例也可能包含可选头的不同组合.例如,内核并不会跟踪Idle和System进程的配额统计(资源的使用状况),所以这两个_EPROCESS对象就没有_OBJECT_HEADER_QUOTA_INFO头.此外,一个被多个进程共享的互斥体仅仅需要一个名称.因此,已命名的互斥体将拥有一个_OBJECT_HEADER_NAME_INFO头,而未命名的互斥体则没有.虽然很多可选头能够用于内存取证,但是安全研究员最常分析的还是名称头.</p>
<p>表2-2中列举出了64位Windows 7系统下可用的可选头.如果某个对象的_OBJECT_HEADER.InfoMask值被设置为了位掩码这一列的值,那么相应的可选头就会存在.由前面的描述我们可以得知,可选头位于_OBJECT_HEADER起始地址的负偏移处.精确的距离依赖于其他头的存在以及它们的大小(表2-2中的大小这一列).</p>
</p>
<pre><code><p>表2-2:64位Windows 7中的可选头</p><p>名称 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 结构 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;位掩码 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 大小(按字节) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 描述</p><p>Creator Info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _OBJECT_HEADER_CREATOR_INFO &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 储存着该对象创建者的信息</p><p>Name Info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_OBJECT_HEADER_NAME_INFO &nbsp; &nbsp; &nbsp; 0x2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 储存该对象的名称</p><p>Handle Info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_OBJECT_HEADER_HANDLE_INFO &nbsp; &nbsp; 0x4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 维护进程打开句柄相应数据的对象</p><p>Quota Info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _OBJECT_HEADER_QUOTA_INFO &nbsp; &nbsp; &nbsp;0x8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 跟踪使用情况和资源统计</p><p>Process Info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _OBJECT_HEADER_PROCESS_INFO &nbsp; &nbsp;0x10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 标识拥有进程</p></code></pre>
</p>
<p>注意:从Windows 8和Windows Server 2012开始,引入了一个包含审计信息(_OBJECT_HEADER_AUDIT_INFO)新的可选头,位掩码为0&#215;40.</p>
<p>关于各版本操作系统中对象头格式的变化可以参考下面文章:</p>
<p><a href="http://www.codemachine.com/article_objectheader.html">http://www.codemachine.com/article_objectheader.html</a></p>
<h3>对象类型对象</h3>
<p> _OBJECT_HEADER的TypeIndex成员是nt!ObTypeIndexTable&#8211;(一个类型对象_OBJECT_TYPE的数组)的索引.从表2-1我们可以得知,类型对象包含了可以用来描述所有其他对象常见属性的元数据.该数据对于内存取证来说至关重要,因为我们可以用它来确定跟随在_OBJECT_HEADER后面对象的类型.例如,进程句柄表项指向了对象头.因此,当我们枚举句柄表中项的时候,跟随在对象头后面数据的类型是任意的-它可能是_FILE_OBJECT,_EPROCESS,或者其他的执行体对象.我们可以通过定位TypeIndex的值,然后找到该索引对应的_OBJECT_TYPE,然后得到其Name成员.对象类型的名称和结构名称的映射关系见表2-1:</p>
<p>64位Windows 7中的对象类型结构如下:</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_OBJECT_TYPE")</p><p>'_OBJECT_TYPE' (208 bytes)</p><p>0x0 : TypeList ['_LIST_ENTRY']</p><p>0x10 : Name ['_UNICODE_STRING'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 对象类型名称的Unicode字符串(Process,File,Key等等)</p><p>0x20 : DefaultObject ['pointer64', ['void']]</p><p>0x28 : Index ['unsigned char']</p><p>0x2c : TotalNumberOfObjects ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 存在于该系统中的特定对象类型对象的总数</p><p>0x30 : TotalNumberOfHandles ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 此特定类型对象打开句柄的总数</p><p>0x34 : HighWaterNumberOfObjects ['unsigned long']</p><p>0x38 : HighWaterNumberOfHandles ['unsigned long']</p><p>0x40 : TypeInfo ['_OBJECT_TYPE_INITIALIZER'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;一个_OBJECT_TYPE_INITIALIZER结构,告诉我们用于分配这些对象实例内存的类型(例如,分页还是非分页内存)</p><p>0xb0 : TypeLock ['_EX_PUSH_LOCK'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0xb8 : Key ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;一个4字节的标签用于唯一标识分配包含特定类型对象的内存</p><p>0xc0 : CallbackList ['_LIST_ENTRY'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p></code></pre>
</p>
<p> TypeInfo和Key成员为内存取证提供了两条非常有价值的线索&#8211;它们可以告诉我们去分页还是非分页内存中寻找,然后通过特殊的4字节标记来定位特定对象的类型(例如,所有的进程或者所有的文件)的所有实例.下面我们通过为Volatility的volshell(类似于python的命令行,我们可以通过该插件提供的方法来实现特定的功能)插件编写一个简短的脚本来导出这些信息:</p>
<p>在编写这个脚本之前,我们首先进入volshell这个插件的控制台,然后输入hh()命令查看一下帮助文档:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 volshell</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Current context: System @ 0xfffffa8000caf990, pid=4, ppid=0 DTB=0x187000</p><p>Welcome to volshell! Current memory image is:</p><p>file:///opt/volatility/demo.vmem</p><p>To get help, type 'hh()'</p><p>&gt;&gt;&gt; hh()</p><p>Use addrspace() for Kernel/Virtual AS</p><p>Use addrspace().base for Physical AS</p><p>Use proc() to get the current process object</p><p>&nbsp; and proc().get_process_address_space() for the current process AS</p><p>&nbsp; and proc().get_load_modules() for the current process DLLs</p><p>addrspace() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Get the current kernel/virtual address space.&nbsp;</p><p>cc(offset=None, pid=None, name=None, physical=False) : Change current shell context.</p><p>db(address, length=128, space=None) &nbsp; &nbsp; &nbsp;: Print bytes as canonical hexdump.</p><p>dd(address, length=128, space=None) &nbsp; &nbsp; &nbsp;: Print dwords at address.</p><p>dis(address, length=128, space=None, mode=None) : Disassemble code at a given address.</p><p>dq(address, length=128, space=None) &nbsp; &nbsp; &nbsp;: Print qwords at address.</p><p>dt(objct, address=None, space=None, recursive=False, depth=0) : Describe an object or show type info.</p><p>find(needle, max=1, shift=0, skip=0, count=False, length=128) :&nbsp;</p><p>getmods() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Generator for kernel modules (scripting).</p><p>getprocs() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Generator of process objects (scripting).</p><p>hh(cmd=None) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Get help on a command.</p><p>list_entry(head, objname, offset=-1, fieldname=None, forward=True, space=None) : Traverse a _LIST_ENTRY.</p><p>modules() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Print loaded modules in a table view.</p><p>proc() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Get the current process object.</p><p>ps() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Print active processes in a table view.</p><p>sc() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Show the current context.</p><p>For help on a specific command, type 'hh(&lt;command&gt;)'</p><p>&gt;&gt;&gt;&nbsp;</p></code></pre>
</p>
<p>我们来逐一看一下该插件提供的方法:</p>
</p>
<pre><code><p>addrspace():用于获取当前内核或者虚拟地址空间</p><p>addrspace().base:用于获取当前物理地址空间</p><p>cc(offset=None, pid=None, name=None, physical=False):用于改变当前shell的上下文</p><p>db(address, length=128, space=None): 以16进制dump的形式打印该地址处的字节</p><p>dd(address, length=128, space=None): 打印该地址处的双字节</p><p>dis(address, length=128, space=None, mode=None): 打印该地址处的反汇编代码</p><p>dq(address, length=128, space=None): 打印该地址处的四字节</p><p>dt(objct, address=None, space=None, recursive=False, depth=0): 描述一个对象或者显示类型信息</p><p>getmods(): 内核模块生成器(脚本化)</p><p>getprocs(): 进程对象生成器(脚本化)</p><p>hh(cmd=None): 获取一个命令的帮助</p><p>list_entry(head, objname, offset=-1, fieldname=None, forward=True, space=None): 遍历一个_LIST_ENTRY</p><p>modules(): 以表格的视图打印已加载的模块</p><p>proc(): 获取当前进程对象</p><p>proc().get_process_address_space(): 获取当前进程的地址空间</p><p>proc().get_load_modules(): 获取当前进程已加载的DLL</p><p>ps(): 以表格的视图打印处于活动状态的进程</p><p>sc(): 显示当前上下文</p></code></pre>
</p>
<p>遍历ObTypeIndexTable表获取各种类型对象信息的脚本如下:</p>
</p>
<pre><code><p>kernel_space = addrspace()</p><p>ObTypeIndexTable = 0xfffff80004032300</p><p>ptrs = obj.Object(theType = "Array", targetType = "Pointer", offset = ObTypeIndexTable, count = 100, vm = kernel_space)</p><p>for i, ptr in enumerate(ptrs):</p><p>	objtype = ptr.dereference_as("_OBJECT_TYPE")</p><p>	if objtype.is_valid():</p><p>		print i, str(objtype.Name), "in",str(objtype.TypeInfo.PoolType),"with key",str(objtype.Key)</p></code></pre>
</p>
<p>该脚本需要重点说明的地方:</p>
<p>第二行,由于ObTypeIndexTable这个类型索引表在windows内核是以一个全局变量导出的,所以我们可以通过windbg双机调试,然后通过dd ObTypeIndexTable查看该表的首地址.笔者这里配置了实验虚拟机是64位的windows 7,而该表的首地址通过图2-2可知为0xfffff80004032300</p>
<p style="text-align: center;"><img alt="2.png" data-original="http://image.3001.net/images/20170109/14839483969308.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="483">    </p>
<noscript><img alt="2.png" src="http://image.3001.net/images/20170109/14839483969308.png!small" width="690" height="483">    </p></noscript>
<p style="text-align: center;">图2-2</p>
<p>然后第三行是构造一个首地址为ObTypeIndexTable,元素个数为100的指针数组对象.这个函数并不是volshell提供的,而是Volatility框架中obj包中实现的一个函数,如图2-3可知,Object这个函数是一个变参的函数,因为最后一个形参是**kwargs,这就表示后面的变参会组成一个字典传递进去.如果想知道可以其详细的调用方法可以查看一下该函数参考引用.如图2-4,可以看到该函数的各种调用例子,红色框框标注出来的正是我们想要的形式.</p>
<p style="text-align: center;"><img alt="3.png" data-original="http://image.3001.net/images/20170109/14839485069052.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="479">    </p>
<noscript><img alt="3.png" src="http://image.3001.net/images/20170109/14839485069052.png!small" width="690" height="479">    </p></noscript>
<p style="text-align: center;">图2-3</p>
<p style="text-align: center;"><img alt="4.png" data-original="http://image.3001.net/images/20170109/14839485264278.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="399">    </p>
<noscript><img alt="4.png" src="http://image.3001.net/images/20170109/14839485264278.png!small" width="690" height="399">    </p></noscript>
<p style="text-align: center;">图2-4</p>
<p>然后下面的for循环结合enumerate这个迭代函数实现对ptrs这个数组的遍历,dereference_as这个方法是将空指针类型解释为指向_OBJECT_TYPE的指针,这样我们就可以访问_OBJECT_TYPE中成员了,例如,对象类型名称,内核池的类型,以及4字节的标记.脚本执行得到的信息如下:</p>
</p>
<pre><code><p>2 Type in NonPagedPool with key ObjT</p><p>3 Directory in PagedPool with key Dire</p><p>4 SymbolicLink in PagedPool with key Symb</p><p>5 Token in PagedPool with key Toke</p><p>6 Job in NonPagedPool with key Job&nbsp;</p><p>7 Process in NonPagedPool with key Proc</p><p>8 Thread in NonPagedPool with key Thre</p><p>9 UserApcReserve in NonPagedPool with key User</p><p>10 IoCompletionReserve in NonPagedPool with key IoCo</p><p>11 DebugObject in NonPagedPool with key Debu</p><p>12 Event in NonPagedPool with key Even</p><p>13 EventPair in NonPagedPool with key Even</p><p>14 Mutant in NonPagedPool with key Muta</p><p>15 Callback in NonPagedPool with key Call</p><p>16 Semaphore in NonPagedPool with key Sema</p><p>17 Timer in NonPagedPool with key Time</p><p>18 Profile in NonPagedPool with key Prof</p><p>19 KeyedEvent in PagedPool with key Keye</p><p>20 WindowStation in NonPagedPool with key Wind</p><p>21 Desktop in NonPagedPool with key Desk</p><p>22 TpWorkerFactory in NonPagedPool with key TpWo</p><p>23 Adapter in NonPagedPool with key Adap</p><p>24 Controller in NonPagedPool with key Cont</p><p>25 Device in NonPagedPool with key Devi</p><p>26 Driver in NonPagedPool with key Driv</p><p>27 IoCompletion in NonPagedPool with key IoCo</p><p>28 File in NonPagedPool with key File</p><p>29 TmTm in NonPagedPool with key TmTm</p><p>30 TmTx in NonPagedPool with key TmTx</p><p>31 TmRm in NonPagedPool with key TmRm</p><p>32 TmEn in NonPagedPool with key TmEn</p><p>33 Section in PagedPool with key Sect</p><p>34 Session in NonPagedPool with key Sess</p><p>35 Key in PagedPool with key Key&nbsp;</p><p>36 ALPC Port in NonPagedPool with key ALPC</p><p>37 PowerRequest in NonPagedPool with key Powe</p><p>38 WmiGuid in NonPagedPool with key WmiG</p><p>39 EtwRegistration in NonPagedPool with key EtwR</p><p>40 EtwConsumer in NonPagedPool with key EtwC</p><p>41 FilterConnectionPort in NonPagedPool with key Filt</p><p>42 FilterCommunicationPort in NonPagedPool with key Filt</p><p>43 PcwObject in PagedPool with key PcwO</p></code></pre>
</p>
<p>我们这里用的是一个硬编码的地址,但是有可能大家在自己的机器下通过windbg进行双机调试的时候会发现输入x nt!ObTypeIndexTable或者dd nt!ObTypeIndexTable得到的值不一样.那么我们可以来试一试objtypescan这个插件,这个插件中并没有用到硬编码的地址,但是依然可以得到跟上面脚本类似的结果,如下:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 objtypescan</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Offset &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nObjects &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nHandles Key &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PoolType &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>------------------ ------------------ ------------------ -------- ------------------------------ --------------------</p><p>0x000000003eecd630 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Filt &nbsp; &nbsp; FilterCommunicationPort &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003f29f2d0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x15 PcwO &nbsp; &nbsp; PcwObject &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003f5b6b80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Filt &nbsp; &nbsp; FilterConnectionPort &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fe813a0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x5ff &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x555 EtwR &nbsp; &nbsp; EtwRegistration &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fe823a0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x5 EtwC &nbsp; &nbsp; EtwConsumer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fe83900 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x36 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x35 Keye &nbsp; &nbsp; KeyedEvent &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003fe83a50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Prof &nbsp; &nbsp; Profile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fe91860 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Call &nbsp; &nbsp; Callback &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003febb3f0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x35b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x361 Sema &nbsp; &nbsp; Semaphore &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fed02d0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x64 TpWo &nbsp; &nbsp; TpWorkerFactory &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fed0420 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xa &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2a Desk &nbsp; &nbsp; Desktop &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fed0570 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x47 Wind &nbsp; &nbsp; WindowStation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003fed7630 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x9b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x9b Time &nbsp; &nbsp; Timer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff35900 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x388 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x383 Key &nbsp; &nbsp; &nbsp;Key &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003ff39d50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2d6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2d2 ALPC &nbsp; &nbsp; ALPC Port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff3ef30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2 Powe &nbsp; &nbsp; PowerRequest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff45080 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x117 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x5 Symb &nbsp; &nbsp; SymbolicLink &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003ff45730 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 IoCo &nbsp; &nbsp; IoCompletionReserve &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff45880 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 User &nbsp; &nbsp; UserApcReserve &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff459d0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x233 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x3f7 Thre &nbsp; &nbsp; Thread &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff45b20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xfd Proc &nbsp; &nbsp; Process &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff45c70 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1 Job &nbsp; &nbsp; &nbsp;Job &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff45e90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x3e2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x20f Toke &nbsp; &nbsp; Token &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003ff46a50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Debu &nbsp; &nbsp; DebugObject &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff59860 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x198 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x1a4 Muta &nbsp; &nbsp; Mutant &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff5e570 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xe59 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xeba Even &nbsp; &nbsp; Event &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff5f570 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Even &nbsp; &nbsp; EventPair &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 TmTx &nbsp; &nbsp; TmTx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65750 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x7 TmTm &nbsp; &nbsp; TmTm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff658a0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xab7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x30a File &nbsp; &nbsp; File &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff659f0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x72 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x6e IoCo &nbsp; &nbsp; IoCompletion &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65b40 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x76 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Driv &nbsp; &nbsp; Driver &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65c90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x21f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Devi &nbsp; &nbsp; Device &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65de0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Cont &nbsp; &nbsp; Controller &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff65f30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x24 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 Adap &nbsp; &nbsp; Adapter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff66660 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xf Sess &nbsp; &nbsp; Session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff66c90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x307 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x153 Sect &nbsp; &nbsp; Section &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003ff66de0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 TmEn &nbsp; &nbsp; TmEn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff66f30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xe TmRm &nbsp; &nbsp; TmRm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ff7f320 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x16 WmiG &nbsp; &nbsp; WmiGuid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NonPagedPool &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0x000000003ffb7a00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x28 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x63 Dire &nbsp; &nbsp; Directory &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PagedPool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003ffb7b50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x2a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0 ObjT &nbsp; &nbsp; Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NonPagedPool</p></code></pre>
</p>
<p>左边对的这个地址是位于内核内存中的_OBJECT_TYPE结构的地址.我们可以发现该objtypescan这个插件打印的结果与我们通过volshell脚本遍历nt!ObTypeIndexTable得到的结果中包含的信息是相同的,但是顺序不太一样.&nbsp;通过以上打印出来的信息,我们可以得知进程对象位于非分页内存中,令牌对象位于分页内存中.因此,我们可以推断出内存中会总是包含_EPROCESS对象,而有些_TOKEN对象可能会被交换到磁盘上面去.此外,我们尝试在内存中寻找实际的对象的时候就有一个潜在的特征码(Proc是标识进程的,Toke是标识令牌的)可以扫描了.当然,我们可能还需要比这四字节更加健壮的特征码,不然的话可能就会遭遇误报.为了减少误报,我们就需要来了解下一个概念-内核池的分配.</p>
<h2>内核池分配</h2>
<p> 内核池是可以被分割为更小块的用于存储任何类型的数据&#8211;内核模式组件(NT内核模块,第三方设备驱动等等),请求的一系列内存.与堆比较相似,每个分配的块都有一个包含统计和调试信息的头(_POOL_HEADER),我们可以使用这些额外的数据来推断出该内存块属于哪个驱动程序,并且我们还可以在一定程序上推断出包含该分配内存的结构或者对象的类型.这不仅对解决内存泄漏和内存破坏的问题有帮助,而且对内存取证也是很有功效的.深入理解内核池的技术细节,不仅仅对内存取证有用,对于内核池的漏洞利用也是非常有帮助的.关于如何进行内核池方面的漏洞利用可以扩展阅读Tarjei    Mandt的这篇文章-Kernel Pool Exploitation on Windows.7 by Tarjei Mandt:<a href="http://www.mista.nu/research/MANDT-kernelpool-PAPER.pdf" target="_blank">http://www.mista.nu/research/MANDT-kernelpool-PAPER.pdf</a></p>
<p style="text-align: center;"><img alt="5.png" data-original="http://image.3001.net/images/20170109/14839486897088.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="613">    </p>
<noscript><img alt="5.png" src="http://image.3001.net/images/20170109/14839486897088.png!small" width="690" height="613">    </p></noscript>
<p style="text-align: center;">图5 2-5 位于池中的执行体对象</p>
<p>64位Windows 7系统,内核池的头结构如下:</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_POOL_HEADER")</p><p>&nbsp;'_POOL_HEADER' (16 bytes)</p><p>0x0 &nbsp; : BlockSize &nbsp; &nbsp; ['BitField', {'end_bit': 24, 'start_bit': 16, 'native_type': 'unsigned long'}] &nbsp; &nbsp; &nbsp;分配总的大小,包含池头部,对象头部,以及其他可选的头部</p><p>0x0 &nbsp; : PoolIndex &nbsp; &nbsp; ['BitField', {'end_bit': 16, 'start_bit': 8, 'native_type': 'unsigned long'}]</p><p>0x0 &nbsp; : PoolType &nbsp; &nbsp; &nbsp;['BitField', {'end_bit': 32, 'start_bit': 24, 'native_type': 'unsigned long'}] &nbsp; &nbsp; &nbsp;系统内存的类型(分页,非分页的,等等)</p><p>0x0 &nbsp; : PreviousSize &nbsp;['BitField', {'end_bit': 8, 'start_bit': 0, 'native_type': 'unsigned long'}]</p><p>0x0 &nbsp; : Ulong1 &nbsp; &nbsp; &nbsp; &nbsp;['unsigned long']</p><p>0x4 &nbsp; : PoolTag &nbsp; &nbsp; &nbsp; ['unsigned long'] &nbsp; 一个4字节的值,通常由ASCII码字符组成,唯一的表示该分配产生的代码路径.在Win8和Win2012中,其中一个字符可能会被修改为保护位</p><p>0x8 &nbsp; : AllocatorBackTraceIndex &nbsp; &nbsp; &nbsp; &nbsp;['unsigned short']</p><p>0x8 &nbsp; : ProcessBilled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;['pointer64', ['_EPROCESS']] &nbsp; &nbsp; &nbsp; &nbsp;</p><p>0xa &nbsp; : PoolTagHash &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;['unsigned short']</p></code></pre>
</p>
<h3>内核池分配的API函数</h3>
<p> 在创建一个执行体对象实例之前,操作系统会从内核池中分配一块足够大的内存来存放对象和它的头部.通常在分配内核池的时候使用的最多的API函数是ExAllocatePoolWithTag,关于该函数的详细介绍请见MSDN:<a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff544520(v=vs.85).aspx" target="_blank">https://msdn.microsoft.com/en-us/library/windows/hardware/ff544520(v=vs.85).aspx</a>,函数原型如下:</p>
</p>
<pre><code><p>PVOID ExAllocatePoolWithTag(</p><p>&nbsp; _In_ POOL_TYPE PoolType,</p><p>&nbsp; _In_ SIZE_T &nbsp; &nbsp;NumberOfBytes,</p><p>&nbsp; _In_ ULONG &nbsp; &nbsp; Tag</p><p>);</p></code></pre>
</p>
<p> PoolType这个参数指定了用于分配的系统内存的类型.NonPagedPool(0)和PagedPool(1)是枚举类型的值,分别表示非分页内存和分页内存.之前我们已经知道了,并不是所有的执行体对象类型都用的是非分页内存-我们可以通过定位特定对象的_OBJECT_TYPE.TypeInfo.PoolType成员来加以区分.这里还有一些其他的标志大家可能用来控制该内存是否可执行,是否缓存对其等等.更详细的信息请参考:<a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff559707(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/hardware/ff559707(v=vs.85).aspx</a>.</p>
<p> NumberOfBytes这个参数指定了要分配的字节数.驱动程序可以在调用ExAllocatePoolWithTag的时候直接指定需要存储在内存块中数据的大小.但是执行体对象就有点不同了,根据我们前面了解的知识,因为它们需要额外的空间来存储对象头以及可选头.位于内核中名称为ObCreateObject的这个函数是所有执行体对象被创建的关键点.它决定了被请求结构的大小(例如,64位Windows 7中_EPROCESS的大小为1232字节),并且在调用ExAllocatePoolWithTag之前_OBJECT_HEADER和其他可选头的大小会被加进去.</p>
<p>    Tag参数指定了一个4字节的值,通常由ASCII码字符组成,唯一的表示该分配产生的代码路径.就执行体对象的这种情况来说,标志是从_OBJECT_TYPE.Key成员得到的-这就解释了为什么特定类型的所有对象的标志都一样.</p>
<p> 假设某个进程想要使用Windows API函数来创建一个新的文件,将会按照以下步骤进行:</p>
</p>
<pre><code><p>1.该进程调用CreateFileA(ASCII)或者CreateFileW(Unicode)-二者都是由kernel32.dll导出的.</p><p>2.创建文件的API转入ntdll.dll,然后在其中会通过系统调用进入内核,接着到达原生态的NtCreateFile函数处.</p><p>3.NtCreateFile将调用ObCreateObject来请求一个新的文件对象类型.</p><p>4.ObCreateObject计算_FILE_OBJECT的大小,包含需要为它的可选头额外准备的空间.</p><p>5.ObCreateObject找到文件对象对应的_OBJECT_TYPE结构,并且确实是分配分页内存还是非分页内存,还有需要用到的四字节标记.</p><p>6.指定合适的大小,内存类型,标记从而调用ExAllocatePollWithTag.</p></code></pre>
</p>
<p> 经过以上步骤以后,一个全新的_FILE_OBJECT就存在于内存中了,并且该分配的内存被指定的四字节值标记了.这还没完呢,还有一个指向对象头的指针会被添加到调用进程的句柄表中,并且一个系统范围内的池标记会在跟踪数据库中得到相应的更新,以及_FILE_OBJECT的各个成员会被该文件所创建的路径和要求的访问权限(例如,读,写,删除)初始化.</p>
</p>
<p> 使用相同的大小,标记以及内存类型的顺序分配不一定在内存中就是连续排列的.虽然操作系统会尝试将类似大小的内存块组在一起.如果所请求的大小没有可利用的空闲块,内核就会从下一个最大尺寸的组中选择一个块.这样的结果就我们就会看到包含相同类型对象的内存分配被分散到了整个内核池中.此外,这允许小一点的结构占据之前用于存储更大一些结构的内存块&#8212;如果内存没有进行适当的清理的话,那么创建一个松散空间的条件就得不到满足.</p>
<p> 更详细的信息,请参见Andreas Schuster的The Impact of Windows Pool AllocationStrategies on Memory Forensics: <a href="http://dfrws.org/2008/proceedings/p58-schuster.pdf" target="_blank">http://dfrws.org/2008/proceedings/p58-schuster.pdf</a></p>
<h3>释放和重用</h3>
<p> 继续一个进程创建一个新文件的例子,_FILE_OBJECT相应的生命周期(例如,位于物理内存中的时间)依赖于多种因素.最重要的一个因素就是进程在读或者写完新的文件以后多久调用CloseHandle.在这个时间点,如果没有其他进程正在使用这个文件对象的话,这块内存将被释放回内核池的空闲链表中,而它可以基于不同的目的进行重分配.在等待被重分配或者在新数据被写入到内存块之间的这段时间,许多源_FILE_OBJECT依然是保存完整的.在此状态下的内存块会持续多长时间取决于系统的活动等级.如果机器正在猛烈抖动,并且正在被请求的内存块的大小小于等于_FILE_OBJECT的大小的话,它将很快被覆盖.除此之外,该对象可以在进程创建这个文件结束后持续存在几天或者几周.在过去,有童鞋经常会问:在一个网络连接关闭后,为了能够保留证据,我们必须在多久之内获取内存转储?答案是,它是不可预测的,每台机器都有可能不一样.这里重申一下,当池内存块被释放的时候,它们只是简单的被标记为了空闲,不会立即被覆盖.这个概念同样可以被应用于磁盘取证.当一个NTFS文件被删除的时候,仅仅只是主文件表(MFT)项被修改以反映状态的改变.而该文件的内容会保持不变一直到扇区被重新分配给新的文件并且发生写操作时.基于以上事实,我们在已经被操作系统释放的内存中找到执行体对象.也就是说,不仅仅是正在处于活动状态的执行体对象我们可以定位到,我们还可以找到过去存在的系统资源.</p>
<h3>池标记扫描</h3>
<p> 池标记扫描或者简单点儿说池扫描,是指寻找基于前面提到的四字节标记分配的内存.例如,要查找进程对象,我们可以找到指向活动进程的双向链表起始地址的内核符号,然后遍历该链表中的项.另一种选择,池扫描,涉及到搜索整个内存dump文件中的Proc标记(与_EPROCESS相关的四字节标记).后面这种方式的好处在于我们可以找到历史项目(不再运行的进程或者已经结束运行的进程),还有可以挫败某些rootkit隐藏技术,例如,直接内核对象修改(DKOM),该技术依赖与修改活动对象的链表.</p>
<p> 当我们执行池标记扫描的时候,四字节的标记只是我们的一个出发点.如果我们完全依赖于这四字节的标记,会得到大量的误报.所以,Volatility构建了一个更加强大的特征码.这是以我们前面介绍过的知识为基础的.例如,分配的大小以及内存的类型(分页,非分页)在减少误报中扮演了一个重要角色.如果我们正在寻找一个100字节的_EPROCESS,而我们在一个30字节的分配内存中找到了Proc,显然它不可能是一个真正的进程,因为该内存块太小了.</p>
<p>除了(标记,大小,内存类型)这些初始指标以外,Volatility池扫描器的基础设施还允许我们为每种对象类型添加自定义的约束条件.例如,如果一个进程创建的时间戳应该非零,我们可以以这个条件来配置扫描器.这样扫描器就只会报告创建时间非零的项了.</p>
<h3>池标记源</h3>
<p> 表2-3列举出了Volatility通过池扫描用于寻找所列举执行体对象的初始指标.该表中的最小大小在添加_EPROCESS(针对进程),_OBJECT_HEADER和_POOL_HEADER的时候会用于计算.</p>
</p>
<pre><code><p>表2-3: 	Volatility现有的插件里用到的池标记数据(针对从Windows XP 到 7)</p><p>对象 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;标记 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;标记(受保护的) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;最小大小(Win7 x64) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;内存类型 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 插件</p><p>Process(进程) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Proc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pro\xe3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1304 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; psscan</p><p>Threads(线程) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Thrd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Thr\xe4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1248 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; thrdscan</p><p>Desktops(桌面) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Desk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Des\xeb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  296 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; deskscan</p><p>Window Stations(窗口站) &nbsp; &nbsp; Wind &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Win\xe4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  224 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wndscan</p><p>Mutants(突变体) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mute &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mut\xe5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mutantscan</p><p>File Objects(文件) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Fil\xe5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  288 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filescan</p><p>Drivers(驱动) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Driv &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Dri\xf6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  408 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; driverscan</p><p>Symbolic Links(符号链接) &nbsp; &nbsp;Link &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Lin\xeb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  104 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (Nonpaged)非分页 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;symlinkscan</p></code></pre>
</p>
<p> 虽然表2-3中的数据是通过查看Volatility的源代码得到的,但是理解从哪里可以获取这些原始信息也是非常重要的.例如,当一个新版本的Windows发布的时候我们需要调整某些域</p>
<p>或者创建一个现有的Volatility插件没有涵盖到的用于查找执行体对象的池扫描器.此外,如果一个恶意内核驱动程序分配内核池用以存储它的数据(配置信息,命令和控制数据包,需要隐藏的系统资源的名称等等),那么我们就需要一种方法来获取内存块中的这些指标.</p>
<p> 还有,我们可能会注意到表2-3中的标记(受保护的)这一列.关于内核池标记最不常见的一个复杂特性就是受保护位.当我们通过ExFreePoolWithTag释放一个内核池的时候,我们必须设置跟ExAllocatePoolWithTag一样的标记.这项技术是操作系统用来防止驱动程序意外释放内存而设计的.如果传递给释放函数的标记不匹配,那么系统将抛出一个异常.这对与内存取证来说有很大的影响,因为这样的话我们就需要寻找受保护的内核池标记.</p>
<p> 内核池标记中受保护的位并不是所有的内存分配都会设置,仅限与某些执行体对象类型.此外,从Windows 8和Windows Server 2012开始,貌似内核池标记中受保护位取消了.关于受保护的位更详细的信息可以参考这篇文章:<a href="http://msmvps.com/blogs/windrvr/archive/2007/06/15/tag-you-re-it.aspx" target="_blank">http://msmvps.com/blogs/windrvr/archive/2007/06/15/tag-you-re-it.aspx</a>&nbsp;</p>
<h3>池标记文件</h3>
<p> 正如之前所提到的,微软创建池标记是为了调试和审计的目的.因此,Windows驱动开发包(DDK或者WDK)和Windows调试工具的安装目录中可以找到一个名为pooltag.txt的文件,这个文件我们可以用于查找.例如,给定一个池标记,我们可以确定该内存分配的目的以及拥有这块内存的内核驱动.因为该文件中包含有描述信息,所以我们也可以从诸如&#8221;进程对象&#8221;或者&#8221;文件对象&#8221;这样的关键字入手,进而找出其池标记.图2-6是从WDK 7600中找到的pooltag.txt文件中截取出来的部分内容:</p>
<p style="text-align: center;"><img alt="6.png" data-original="http://image.3001.net/images/20170109/14839489538329.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="411">        </p>
<noscript><img alt="6.png" src="http://image.3001.net/images/20170109/14839489538329.png!small" width="690" height="411">        </p></noscript>
</p>
<p style="text-align: center;">图2-6</p>
</p>
<p> 高亮显示的这一行表示进程对象使用是Proc作为池标记,并且是有nt!ps(NT内核模块的进程子系统)分配的.现在我们知道了进程对象的池标记,我们还需要找到内存分配的合适大小以及内存的类型(分页,非分页).pooltag.txt文件仅包含微软的内核模式组件的池标记.它并不包含第三方或者恶意驱动程序的池标记.这里有一个在线的用于提交池标记描述信息的数据库:<a href="http://alter.org.ua/docs/win/pooltag,">http://alter.org.ua/docs/win/pooltag,</a>注意这个网站上面的信息是匿名提交的,所以准确性得不到保证.</p>
</p>
<h3>PoolMon工具</h3>
</p>
<p> PoolMon(<a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff550442(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/hardware/ff550442(v=vs.85).aspx</a>)是微软的驱动开发包(DDK)中附带的一个内存池监视工具.它会实时更新当前运行系统的池标记以及以下一些信息:</p>
</p>
<pre><code><p>* 内存类型(分页或者非分页)</p><p>* 分配的个数</p><p>* 释放的个数</p><p>* 分配占用的字节总数</p><p>* 每次分配的平均字节数</p></code></pre>
</p>
</p>
<p>一个使用PooMon输出结果的示例如图2-7所示.-b开关会按数据的字节数进行排序,以至于内存比较密集的标记会先被列出来.</p>
</p>
<p style="text-align: center;"><img alt="7.png" data-original="http://image.3001.net/images/20170109/14839490262019.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="549">            </p>
<noscript><img alt="7.png" src="http://image.3001.net/images/20170109/14839490262019.png!small" width="690" height="549">            </p></noscript>
</p>
<p style="text-align: center;">图2-7</p>
</p>
<p> 正如我们所看到的,CM31在字节数中排名最高.因为从系统启动开始,就有52383次调用ExAllocatePoolWithTag并设置CM31标记,它们其中2006个已经被释放了.当前分配的块中有50377个块不同,总共消耗237424640字节(接近226M)的内存.平均每次分配4712个字节.CM25这个标记在CM31后面不远处,用了大约12M内存.在标记名称中的CM代表配置管理器-这是一个用于管理Windows注册表的内核组件.因此,我们可以得出一个结论,至少有238MB的内存被预留用与存储注册表的键值和数据.不要想当然的从内存dump中提取出这所有的238MB内容,因为这些标记都是位于分页内存中的,它们其中的某些数据可能已经被交换到磁盘上去了.</p>
</p>
<p>    另一个我们感兴趣的点就是关于File标记(这些内存被分配用以存储_FILE_OBJECT结构).正如PoolMon所显示的,自从上次系统重启已经有超过2000000块内存已经被创建了,这是合情合理的,因为每次文件被创建或者打开的时候就会有_FILE_OBJECT被分配.但是由于文件对象非常小,所以总共才消耗了5.2MB内存(平均每次分配396个字节).</p>
</p>
<p> 通过阅读PoolMon的输出信息我们不仅了解了操作系统内部的工作原理,同时还对pooltag.txt的信息进行了补充.将二者结合起来,我们就有了池标记,描述信息,拥有者内核驱动,分配的大小,以及内存类型-我们用以扫描内存dump文件中各个分配实例所需要的一切信息现在都有了.</p>
</p>
<p> Windows内核调试器同样能够帮助我们确定相关的池标记.例如,!poolfind命令可以搜索我们指定的池标记并且诶告诉我们内存类型以及大小.用法如下所示</p>
</p>
<pre><code><p>kd&gt; !poolfind Proc</p><p>Searching NonPaged pool (fffffa8000c02000 : ffffffe000000000) for Tag: Proc</p><p>*fffffa8000c77000 size: 430 previous size: 0 (Allocated) Proc (Protected)</p><p>*fffffa8001346000 size: 430 previous size: 0 (Allocated) Proc (Protected)</p><p>*fffffa8001361000 size: 430 previous size: 0 (Allocated) Proc (Protected)</p><p>*fffffa800138f7a0 size: 430 previous size: 30 (Free) Pro.</p><p>*fffffa80013cb1e0 size: 430 previous size: c0 (Allocated) Proc (Protected)</p><p>*fffffa80013e4460 size: 430 previous size: f0 (Allocated) Proc (Protected)</p><p>*fffffa80014fd000 size: 430 previous size: 0 (Allocated) Proc (Protected)</p><p>*fffffa800153ebd0 size: 10 previous size: 70 (Free) Pro.</p><p>省略</p></code></pre>
</p>
</p>
<p>为了简介以上输出只截取了一部分,在显示结果中,当前已分配的块有6个,还有2个被标记为释放了.已释放块中有一个的尺寸与已分配块的尺寸相同(430),而另一个却很小(10).因此,很可能位于0xfffffa800138f7a0地址处的已释放块包含了一个已结束的_EPROCESS;而位于0xfffffa800153ebd0地址处的块已经被另作它用了.</p>
</p>
<h3>池跟踪器表</h3>
</p>
<p>因为PoolMon主要是用于提供池标记统计的实时情况更新,所以它必须运行在一个处于运行状态的系统中.但是如果你只有内存dump怎么办?幸运的是,内存通常会包含PoolMon统计信息中的那些数据.</p>
</p>
<p>它们可以通过存储活动进程链表以及已加载模块链表的相同内核调试器数据块(_KDDEBUGGER_DATA64)来访问.尤其是,PoolTrackTable成员指向了一个_POOL_TRACKER_TABLE结构的数组-每一个都对应于正在使用中的唯一池标记.64位Windows 7下该结构的形式如下:</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_POOL_TRACKER_TABLE")</p><p>'_POOL_TRACKER_TABLE' (40 bytes)</p><p>0x0 : Key ['long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;这就是4字节的标记</p><p>0x4 : NonPagedAllocs ['long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 非分页内存中分配了多少字节</p><p>0x8 : NonPagedFrees ['long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;非分页内存中释放了多少字节</p><p>0x10 : NonPagedBytes ['unsigned long long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 非分页内存中总共消耗了多少字节&nbsp;</p><p>0x18 : PagedAllocs ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;分页内存中分配了多少字节</p><p>0x1c : PagedFrees ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 分页内存中释放了多少字节</p><p>0x20 : PagedBytes ['unsigned long long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;分页内存中总共消耗了多少字节</p></code></pre>
</p>
</p>
<p>正如我们所看到的,每一个跟踪器表都有一个Key,也就是四字节的标记.剩下的成员告诉我们分页以及非分页内存各自的分配,释放,消耗的总字节数情况.虽然这些信息不是实时更新的(但是这依然是有实际意义的,因为系统已经不再运行了),我们至少可以确定刚获取内存dump时的状态.下面是一个使用pooltracker插件并且设置了几个执行体对象标记作为过滤选项的示例.以Np开头的列名表示非分页内存,以Pg开头的列名表示分页内存:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 pooltracker --tags=Proc,File,Driv,Thre</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Tag &nbsp; &nbsp;NpAllocs NpFrees &nbsp;NpBytes &nbsp;PgAllocs PgFrees &nbsp;PgBytes &nbsp;Driver &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reason</p><p>------ -------- -------- -------- -------- -------- -------- -------------------- ------</p><p>Thre &nbsp; &nbsp; &nbsp; 1322 &nbsp; &nbsp; &nbsp;759 &nbsp; 717760 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>File &nbsp; &nbsp; &nbsp;72717 &nbsp; &nbsp;69974 &nbsp; 910480 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Proc &nbsp; &nbsp; &nbsp; &nbsp; 63 &nbsp; &nbsp; &nbsp; 21 &nbsp; &nbsp;55712 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Driv &nbsp; &nbsp; &nbsp; &nbsp;147 &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;70736 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; </p></code></pre>
</p>
<p>我们可以得知这所有的这4个标记都是位于非分页内存中的,因为只有(NpAllocs,NpFrees,NpBytes)这3列非零.为了确定每次大约分配了多大尺寸,我们可以用当前分配数除以总字节数.例如,对于Thre标记(线程对象)来说,平均大小为717760 / (1322 &#8211; 759) = 1 275字节.因此,想要找到所有包含线程的内存分配,我们需要在非分页内存中寻找至少占1275个字节,并且被Thre标记所标记的内存块.</p>
</p>
<p> 这里有几个对于池跟踪器表非常重要的点:</p>
</p>
</p>
<pre><code><p>* 过滤选项:如果我们运行pooltracker插件的时候没有指定--tags参数,那么将显示所有池标记的统计信息.</p><p>* 详细显示: 我们可以通过使用--tagfile选项来从pooltag.txt文件中集齐所有的数据,因此输出中会有带有描述信息的标签以及拥有者驱动.</p><p>* 支持的系统:Windows在XP和2003后面版本的系统才开始向池跟踪器表中写入统计信息.因此,pooltracker插件只能工作在Vista以上版本的操作系统.</p><p>* 限制:池跟踪器表仅仅记录统计信息;它并不记录所有带有特定标记的分配内存的地址信息.</p></code></pre>
</p>
</p>
<p>下面我们来看一个利用池扫描来进行枚举内存中进程的一个插件psscan,关于该插件的是如何利用池标记扫描的原理请参见源代码.首先查看一下该插件的帮助.</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 psscan --help</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Usage: Volatility - A memory forensics analysis platform.</p><p>Options:</p><p>&nbsp; -h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;list all available options and their default values.</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Default values may be set in the configuration file</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (/etc/volatilityrc)</p><p>&nbsp; --conf-file=/root/.volatilityrc</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; User based configuration file</p><p>&nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Debug volatility</p><p>&nbsp; --plugins=PLUGINS &nbsp; &nbsp; Additional plugin directories to use (colon separated)</p><p>&nbsp; --info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Print information about all registered objects</p><p>&nbsp; --cache-directory=/root/.cache/volatility</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Directory where cache files are stored</p><p>&nbsp; --cache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Use caching</p><p>&nbsp; --tz=TZ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sets the (Olson) timezone for displaying timestamps</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; using pytz (if installed) or tzset</p><p>&nbsp; -f FILENAME, --filename=FILENAME</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Filename to use when opening an image</p><p>&nbsp; --profile=Win7SP1x64 &nbsp;Name of the profile to load (use --info to see a list</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; of supported profiles)</p><p>&nbsp; -l file:///opt/volatility/demo.vmem, --location=file:///opt/volatility/demo.vmem</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A URN location from which to load an address space</p><p>&nbsp; -w, --write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable write support</p><p>&nbsp; --dtb=DTB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DTB Address</p><p>&nbsp; --shift=SHIFT &nbsp; &nbsp; &nbsp; &nbsp; Mac KASLR shift address</p><p>&nbsp; --output=text &nbsp; &nbsp; &nbsp; &nbsp; Output in this format (support is module specific, see</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the Module Output Options below)</p><p>&nbsp; --output-file=OUTPUT_FILE</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write output in this file</p><p>&nbsp; -v, --verbose &nbsp; &nbsp; &nbsp; &nbsp; Verbose information</p><p>&nbsp; -g KDBG, --kdbg=KDBG &nbsp;Specify a KDBG virtual address (Note: for 64-bit</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Windows 8 and above this is the address of</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; KdCopyDataBlock)</p><p>&nbsp; --force &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Force utilization of suspect profile</p><p>&nbsp; --cookie=COOKIE &nbsp; &nbsp; &nbsp; Specify the address of nt!ObHeaderCookie (valid for</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Windows 10 only)</p><p>&nbsp; -k KPCR, --kpcr=KPCR &nbsp;Specify a specific KPCR address</p><p>&nbsp; -V, --virtual &nbsp; &nbsp; &nbsp; &nbsp; Scan virtual space instead of physical</p><p>&nbsp; -W, --show-unallocated</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Skip unallocated objects (e.g. 0xbad0b0b0)</p><p>&nbsp; -A START, --start=START</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The starting address to begin scanning</p><p>&nbsp; -G LENGTH, --length=LENGTH</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Length (in bytes) to scan from the starting address</p><p>Module Output Options: dot, greptext, html, json, sqlite, text, xlsx</p><p>---------------------------------</p><p>Module PSScan</p><p>---------------------------------</p><p>Pool scanner for process objects</p></code></pre>
</p>
</p>
<p>我们来看一下该插件的最后四个选项的含义:</p>
</p>
<pre><code><p>-V/--virtual:当扫描池分配的时候,我们可以使用虚拟地址空间或者物理地址空间.默认情况下,Volatility使用物理地址空间,因为它涵盖的内存会</p><p>尽可能的多-甚至是当前不在内核页表中的块.这可以确保从内存中的松散空间中恢复对象.设置-V/--virtual这个选项仅仅只会扫描当前内核已经映射</p><p>的活动分页.</p><p>-W/--show-unallocated:该选项控制插件是否显示已经被操作系统明确标记为未分配的对象.详情请参考Andreas Schuster的文章:http://computer.forensikblog.de/</p><p>en/2009/04/0xbad0b0b0.html</p><p>-A START, --start=START 和 -G LENGTH, --length=LENGTH:如果我们只想扫描指定范围的内存而不是所有内存,那么可以使用该选项来指定内存范围的起始地址和</p><p>长度.这个地址确定了物理或者虚拟内存(依赖与是否-V/--virtual标志设置了)的位置.</p></code></pre>
</p>
</p>
<p>ppscan插件可用于扫描内存dump中进程列表,它有一个有意思的地方在于可以扫描已经结束的进程.这就可以引用于一个场景了:一个攻击人员已经获取了内网中的某台主机</p>
</p>
<p>shell权限,然后他想进一步扩大战果,势必要进行内网扫描,看看有哪些存活的主机,那么他就有可能用到ipconfig,ping这些命令.而安全研究员在获取到该主机的内存dump的时候,攻击人员的操作可能已经结束了.</p>
</p>
<p>这里笔者模拟的这种场景,将msf的反弹后门植入到测试用的Win7SP1x64系统中,然后通过Meterpreter的shell执行ipconfig查看受控主机网络适配器信息.然后对抓取到的内存dump执行如下枚举进程的命令:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 psscan</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Offset(P) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PID &nbsp; PPID PDB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Time created &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Time exited &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>------------------ ---------------- ------ ------ ------------------ ------------------------------ ------------------------------</p><p>0x00000000065edb30 cmd.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3348 &nbsp; 1624 0x000000003c852000 2017-01-09 03:23:45 UTC+0000 &nbsp; 2017-01-09 03:24:01 UTC+0000 &nbsp;</p><p>0x0000000027684530 SearchProtocol &nbsp; &nbsp; 2588 &nbsp; 2352 0x0000000027598000 2017-01-07 17:18:55 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x00000000285b16b0 WmiPrvSE.exe &nbsp; &nbsp; &nbsp; 2944 &nbsp; &nbsp;636 0x000000002782a000 2017-01-07 17:19:02 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x0000000029126060 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp;2756 &nbsp; &nbsp;520 0x0000000026e9f000 2017-01-07 17:18:56 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x0000000029b9d3b0 wmpnetwk.exe &nbsp; &nbsp; &nbsp; 2460 &nbsp; &nbsp;520 0x000000002981a000 2017-01-07 17:18:52 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000002a989b30 SearchIndexer. &nbsp; &nbsp; 2352 &nbsp; &nbsp;520 0x000000002a594000 2017-01-07 17:18:51 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000002b3feb30 SearchFilterHo &nbsp; &nbsp; 2608 &nbsp; 2352 0x0000000029fa3000 2017-01-07 17:18:55 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x00000000306b6b30 VSSVC.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2276 &nbsp; &nbsp;520 0x000000002b70e000 2017-01-07 17:18:48 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x0000000030784060 vmtoolsd.exe &nbsp; &nbsp; &nbsp; 1652 &nbsp; 1624 0x000000003233a000 2017-01-07 17:18:45 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x00000000325f7340 taskhost.exe &nbsp; &nbsp; &nbsp; 2480 &nbsp; &nbsp;520 0x000000001f36a000 2017-01-09 03:23:12 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x00000000337125c0 dllhost.exe &nbsp; &nbsp; &nbsp; &nbsp; 964 &nbsp; &nbsp;520 0x0000000027d00000 2017-01-07 17:18:43 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x00000000372319e0 dllhost.exe &nbsp; &nbsp; &nbsp; &nbsp;1164 &nbsp; &nbsp;520 0x0000000036e79000 2017-01-07 17:18:42 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d601060 VGAuthService. &nbsp; &nbsp; 1312 &nbsp; &nbsp;520 0x00000000092d8000 2017-01-07 17:18:29 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d72e560 dwm.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1588 &nbsp; &nbsp;864 0x0000000038985000 2017-01-07 17:18:32 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d73f5f0 explorer.exe &nbsp; &nbsp; &nbsp; 1624 &nbsp; 1580 0x000000003a6b8000 2017-01-07 17:18:33 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d80b8e0 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 824 &nbsp; &nbsp;520 0x0000000010036000 2017-01-07 17:18:23 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d81fb30 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 864 &nbsp; &nbsp;520 0x0000000010344000 2017-01-07 17:18:23 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d835b30 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 888 &nbsp; &nbsp;520 0x0000000010149000 2017-01-07 17:18:23 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d85a060 msdtc.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1148 &nbsp; &nbsp;520 0x0000000031e87000 2017-01-07 17:18:44 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d86b060 audiodg.exe &nbsp; &nbsp; &nbsp; &nbsp; 976 &nbsp; &nbsp;824 0x000000000d99c000 2017-01-07 17:18:24 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d897290 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 312 &nbsp; &nbsp;520 0x000000000ef55000 2017-01-07 17:18:25 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d8c1060 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 532 &nbsp; &nbsp;520 0x000000000e95f000 2017-01-07 17:18:25 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d935930 spoolsv.exe &nbsp; &nbsp; &nbsp; &nbsp;1072 &nbsp; &nbsp;520 0x000000000ca70000 2017-01-07 17:18:26 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d948100 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp;1100 &nbsp; &nbsp;520 0x000000000cb58000 2017-01-07 17:18:27 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d969aa0 WmiPrvSE.exe &nbsp; &nbsp; &nbsp; 2140 &nbsp; &nbsp;636 0x0000000030fcc000 2017-01-07 17:18:46 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003d9dab30 taskhost.exe &nbsp; &nbsp; &nbsp; 1496 &nbsp; &nbsp;520 0x00000000078ef000 2017-01-07 17:18:32 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003da812e0 winlogon.exe &nbsp; &nbsp; &nbsp; &nbsp;456 &nbsp; &nbsp;408 0x000000000af80000 2017-01-07 17:18:11 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003daa5860 vmtoolsd.exe &nbsp; &nbsp; &nbsp; 1428 &nbsp; &nbsp;520 0x0000000039f97000 2017-01-07 17:18:31 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003dae0b30 lsass.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 528 &nbsp; &nbsp;424 0x00000000130d1000 2017-01-07 17:18:13 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003dae6b30 services.exe &nbsp; &nbsp; &nbsp; &nbsp;520 &nbsp; &nbsp;424 0x000000001161d000 2017-01-07 17:18:13 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003daecb30 lsm.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 536 &nbsp; &nbsp;424 0x000000001315b000 2017-01-07 17:18:13 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003db9c820 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 636 &nbsp; &nbsp;520 0x0000000011363000 2017-01-07 17:18:20 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003dba3b30 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp; 724 &nbsp; &nbsp;520 0x000000000f18d000 2017-01-07 17:18:22 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003dbbcb30 vmacthlp.exe &nbsp; &nbsp; &nbsp; &nbsp;692 &nbsp; &nbsp;520 0x0000000010efe000 2017-01-07 17:18:21 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003df5b5a0 WmiApSrv.exe &nbsp; &nbsp; &nbsp; 1048 &nbsp; &nbsp;520 0x000000001fca7000 2017-01-07 17:19:05 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003df695c0 csrss.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 416 &nbsp; &nbsp;408 0x0000000014ffa000 2017-01-07 17:18:10 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003df6d420 wininit.exe &nbsp; &nbsp; &nbsp; &nbsp; 424 &nbsp; &nbsp;356 0x0000000013606000 2017-01-07 17:18:10 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003e15ab30 csrss.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 364 &nbsp; &nbsp;356 0x000000000c680000 2017-01-07 17:18:07 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003f05b650 smss.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;280 &nbsp; &nbsp; &nbsp;4 0x000000001a282000 2017-01-07 17:17:58 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003f26bb30 svchost.exe &nbsp; &nbsp; &nbsp; &nbsp;1224 &nbsp; &nbsp;520 0x0000000009d1e000 2017-01-07 17:18:28 UTC+0000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>0x000000003fc6bb30 conhost.exe &nbsp; &nbsp; &nbsp; &nbsp;3532 &nbsp; &nbsp;364 0x000000000d0ff000 2017-01-09 03:24:11 UTC+0000 &nbsp; 2017-01-09 03:24:11 UTC+0000 &nbsp;</p><p>0x000000003fc71b30 cmd.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3524 &nbsp; 1428 0x000000000ab2e000 2017-01-09 03:24:11 UTC+0000 &nbsp; 2017-01-09 03:24:11 UTC+0000 &nbsp;</p><p>0x000000003fe43060 ipconfig.exe &nbsp; &nbsp; &nbsp; 3544 &nbsp; 3524 0x000000002b48b000 2017-01-09 03:24:11 UTC+0000 &nbsp; 2017-01-09 03:24:11 UTC+0000 &nbsp;</p><p>0x000000003fe5e520 conhost.exe &nbsp; &nbsp; &nbsp; &nbsp;3356 &nbsp; &nbsp;416 0x000000003c2e3000 2017-01-09 03:23:45 UTC+0000 &nbsp; 2017-01-09 03:24:01 UTC+0000 &nbsp;</p><p>0x000000003ff2c990 System &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp;0 0x0000000000187000 2017-01-07 17:17:57 UTC+0000&nbsp;</p></code></pre>
</p>
</p>
<p>输出中可以看到有5个进程带有退出时间,也就是说这些进程已经结束了.这里conhost这个进程我们不用关心,它是命令行程序宿主进程,一般来说有一个cmd就有一个conhost.那么剩下的就是cmd和ipconfig了.一般来说ipconfig.exe执行只需要几秒钟(或者时间更短),所以我们会感觉该命令在启动以后很快就退出了.如果我们遍历操作系统内部的活动进程列表,我们就看不到这个进程,因为它在我们获取内存dump之前已经结束了但是利用池标记扫描技术在物理地址空间中进行一番扫描,我们还是能够发掘攻击人员针对这台主机进行网络侦查的一些蛛丝马迹,因为使用到了ipconfig这个命令.这个示例是池标记扫描的最常见的例子之一.后面我们还会接触到运用池扫描技术来检测内核级别的rootkit.        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
</p>
<h3>池扫描的限制</h3>
</p>
<p>未使用池标记的内存:ExAllocatePoolWithTag是微软推荐内核驱动以及内核模式组件用来分配内存的API函数,但是并不是唯一的选择.编写驱动的时候还可以使ExAllocatePool这个函数已经过时了,但是在很多版本的Windows中仍然可以使用.这个API函数在分配内存的时候并不带池标记-也就是说我们不太好跟踪或者扫描这种内存了.</p>
</p>
<p>误报:因为池扫描技术是依赖与匹配和启发式算法,所以误报是在所难免的.</p>
</p>
<p>大池内存分配:池标记扫描技术仅仅针对小于4096字节的内存块.幸运的是,所有的执行体对象的大小都小于4096.</p>
</p>
<p>任意的池标记:一个驱动在分配内存的时候用的最多的一个标记是&#8221;Ddk &#8220;.这个标记在整个操作系统中随处可见,并且第三方代码没有指定池标记的时候,操作系统也会帮我们加上.换句话说,如果一个恶意驱动使用了&#8221;Ddk &#8220;作为池标记,那么该内存块将会和其他内存块混合在一起.</p>
</p>
<p>伪造的池标记: 来自Walters&amp;Petroni的一篇文章:(<a href="https://www.blackhat.com/presentations/bh-dc-07/Walters/Paper/bh-dc-07-Walters-WP.pdf" target="_blank">https://www.blackhat.com/presentations/bh-dc-07/Walters/Paper/bh-dc-07-Walters-WP.pdf</a>)一个驱动伪造一个对象来误导安全研究院,从而拖延了研究员取证的时间.</p>
</p>
<p>修改池标记:因为池标记的引入是为了便于我们调试,它们的改变与否并不会影响操作系统的稳定性.所有有些内核级别的Rootkit会尝试修改池标记(或者_POOL_HEADER中的其他值,比如,内存块的大小,内存类型),这对于实际运行的系统来说并没有什么明显的差异,但是这种修改会影响Volatility池扫描器的正常运作.</p>
</p>
<p>由于池扫描的以上这些限制,所以后面我们还会接触到其他的几种进程扫描技术.</p>
</p>
<h3>大页池</h3>
</p>
<p>正如之前所提到的,Windows内核会尝试将相似大小的内存块组合在一起.但是,如果请求的大小超过了一个分页(4096字节),那么这块内存将会从一个特殊的池中(大页池)</p>
</p>
<p>进行分配.但是这种情况下,_POOL_HEADER,位于小一点的内存分配基地址处的四字节池标记这里压根就不存在.因为找不到池标记,所以池扫描器针对这种内存将会失败.</p>
</p>
<p>图2-8显示这两种内存块之间的差异.</p>
</p>
<p style="text-align: center;"><img alt="8.png" data-original="http://image.3001.net/images/20170109/14839493163539.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" width="690" height="475">            </p>
<noscript><img alt="8.png" src="http://image.3001.net/images/20170109/14839493163539.png!small" width="690" height="475">            </p></noscript>
</p>
<p style="text-align: center;">图2-8</p>
</p>
<p>正如我们所看到的,大页池并不存储_POOL_HEADER结构.为了研究这个结论,我们可以编写一个POC,这个POC就是一个挂钩ObCreateObject API函数并且递增用于存储_EPROCESS对象内存块大小的内核驱动程序.正如我们所猜测的那样,Volatility的ppscan插件无法找到新的进程,因为Proc标记不存在.此路行不通,我们换种思路,我们可以从图2-8中看出大页跟踪器表是直接指向大页池中的对象的.</p>
</p>
<h3>大页跟踪器表</h3>
</p>
<p> 大页跟踪器表跟我们之前提到的池跟踪器表明显不同.池跟踪器表(_POOL_TRACKER_TABLE)是针对小内存块的,其中存储了内存分配的数量以及字节使用情况统计等信息;但是并没有告诉我们所有内存分配的地址(因此需要扫描).大页跟踪器表恰恰相反,不存储统计信息,但是其中包含了内存分配的地址.如果我们可以找到大页跟踪器表,它们就可以帮助我们找到位于内核内存中的大内存池块.不幸的是,指向_POOL_TRACKER_BIG_PAGES结构数组的内核符号nt!PoolBigPageTable既没有被导出也没有被拷贝到内核调试器数据块中.但是我们会发现这个符号与nt!PoolTrackTable(被拷贝到了内核调试器数据块中)有紧密的关系.因此,只要我们能找到池跟踪器表,我们就能很容易的找到大页跟踪器表.</p>
</p>
<p>    以下是64位下的Windows 7中大页跟踪器表的结构:</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_POOL_TRACKER_BIG_PAGES")</p><p>'_POOL_TRACKER_BIG_PAGES' (24 bytes)</p><p>0x0 : Va ['pointer64', ['void']] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 虚拟地址的缩写形式,指向了该内存分配的基地址</p><p>0x8 : Key ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;池标记,记住这个池标记跟Va指向的内存分配完全没有关系</p><p>0xc : PoolType ['unsigned long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 内存类型(分页或者非分页)</p><p>0x10 : NumberOfBytes ['unsigned long long'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;该内存分配的大小</p></code></pre>
</p>
</p>
<h3>大池插件</h3>
</p>
<p>我们可以使用bigpools来获取内存dump中由大内核池分配的内存块的信息.示例如下:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 bigpools</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Allocation &nbsp; &nbsp; &nbsp; &nbsp; Tag &nbsp; &nbsp; &nbsp;PoolType &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NumberOfBytes</p><p>------------------ -------- -------------------------- -------------</p><p>-</p><p>0xfffff8a003747000 CM31 &nbsp; &nbsp; PagedPoolCacheAligned &nbsp; &nbsp; &nbsp;0x1000L</p><p>0xfffff8a00f9a8001 CM31 &nbsp; &nbsp; PagedPoolCacheAligned &nbsp; &nbsp; &nbsp;0x1000L</p><p>0xfffff8a004a4f000 CM31 &nbsp; &nbsp; PagedPoolCacheAligned &nbsp; &nbsp; &nbsp;0x1000L</p><p>0xfffff8a00861d001 CM31 &nbsp; &nbsp; PagedPoolCacheAligned &nbsp; &nbsp; &nbsp;0x1000L</p><p>0xfffffa8002fca000 Cont &nbsp; &nbsp; NonPagedPool 0x1000L</p><p>0xfffff8a00a47a001 CM53 &nbsp; &nbsp; PagedPool 0x1000L</p><p>0xfffff8a00293c000 CMA? &nbsp; &nbsp; PagedPool 0x1000L</p><p>0xfffff8a00324a000 CM25 &nbsp; &nbsp; PagedPool 0x1000L</p><p>省略</p></code></pre>
</p>
</p>
<p>这些内存分配的列告诉了我们这些内存分配是从内核内存中的什么地址开始的.如果想查看这些内存范围中的内容的话,可以通过volshell插件转储这些地址处的数据.我们可以看到某些内存分配的起始地址是以1结尾的(0xfffff8a00f9a8001),并且位于分页内存中;但是我们可以通过研究统计得知,1意味着被标记为了释放.因此,我们尝试显示这些地址处的数据的时候,会发现它们并不是包含我们所期望的值(基于池标记).例如,比较几个CM31块:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 volshell</p><p>Volatility Foundation Volatility Framework 2.6</p><p>Current context: process System, pid=4, ppid=0 DTB=0x187000</p><p>Welcome to volshell! Current memory image is:</p><p>To get help, type 'hh()'</p><p>&gt;&gt;&gt; db(0xfffff8a003747000, length=0x1000)</p><p>0xfffff8a003747000 6862 696e 00b0 1000 0010 0000 0000 0000 hbin............</p><p>0xfffff8a003747010 0000 0000 0000 0000 0000 0000 0000 0000 ................</p><p>0xfffff8a003747020 e0ff ffff 766b 0400 0400 0080 0100 0000 ....vk..........</p><p>0xfffff8a003747030 0400 0000 0100 0000 3134 3036 0000 0000 ........1406....</p><p>0xfffff8a003747040 e0ff ffff 766b 0400 0400 0080 0300 0000 ....vk..........</p><p>0xfffff8a003747050 0400 0000 0100 1000 3134 3039 90ae 1000 ........1409....</p><p>0xfffff8a003747060 e0ff ffff 766b 0400 0400 0080 0000 0000 ....vk..........</p><p>省略</p><p>&gt;&gt;&gt; db(0xfffff8a00f9a8001, length=0x1000)</p><p>Memory unreadable at fffff8a00f9a8001</p><p>&gt;&gt;&gt; db(0xfffff8a00861d001, length=0x1000)</p><p>0xfffff8a00861d001 0081 034d 6d53 7478 0025 0025 0042 00c0 ...MmStx.%.%.B..</p><p>0xfffff8a00861d011 180d 1a00 0000 00c0 0430 6b4c 0380 fac0 .........0kL....</p><p>0xfffff8a00861d021 0430 6b4c 0380 fac0 0430 6b4c 0380 fac0 .0kL.....0kL....</p><p>0xfffff8a00861d031 0430 6b4c 0380 fac0 0430 6b4c 0380 fac0 .0kL.....0kL....</p><p>0xfffff8a00861d041 0430 6b4c 0380 fac0 0430 6b4c 0380 fac0 .0kL.....0kL....</p><p>0xfffff8a00861d051 0430 6b4c 0380 fac0 0430 6b4c 0380 fac0 .0kL.....0kL....</p><p>省略</p></code></pre>
</p>
</p>
<p>第一个地址(0xfffff8a003747000)在开头的地方包含hbin以及几个vk实例.我们之前提到过,CM31中的CM代表配置管理器,用于管理内核中的注册表组件,其中的.hbin和vk是注册表HBIN块以及相应值的特征码.第二个(0xfffff8a00f9a8001)和第三个(0xfffff8a00861d001)地址都被标记为了释放,但是这二者之间有明显的不同.其中一个是不可访问,很可能已经被置换到磁盘上去了-因为它们是位于分页内存中的.而另一个可能已经被重分配或者覆盖了,因为hbin特征码已经找不到了.</p>
</p>
<h3>探索大页池</h3>
</p>
<p>在一个正常系统中,会有成千上万的内存块会从大页池中分配,所以我们可以需要使用&#8211;tags选项来为该插件设置过滤规则(用逗号把标记分开).如果我们不进行过滤</p>
</p>
<p>的话,也可以将插件输出的重定向到一个文本文件中,然后基于标记出现的频率来进行排序.示例如下:</p>
</p>
<pre><code><p>root@kali:/opt/volatility# python vol.py -f demo.vmem --profile=Win7SP1x64 bigpools &gt; bigpools.txt</p><p>$ awk '{print $2}' bigpools.txt | sort | uniq -c | sort -rn</p><p>9009 CM31</p><p>3142 CM53</p><p>2034 CM25</p><p>1757 PfTt : Pf Translation tables</p><p>1291 Cont : Contiguous physical memory allocations for device drivers</p><p>940 MmSt : Mm section object prototype ptes</p><p>540 MmAc : Mm access log buffers</p><p>529 CMA?</p><p>442 MmRe : ASLR relocation blocks</p><p>432 CM16</p><p>237 Obtb : object tables via EX handle.c</p><p>105 Pp</p><p>99 SpSy</p><p>78 InPa : Inet Port Assignments</p><p>省略</p></code></pre>
</p>
</p>
<p>以上池标记的描述信息不是命令自动生成的,是查找了pooltag.txt然后添加进去的.根据以上描述,我们会发现大页池中包含一些非常有意思的东西- 从转换表到内存管理器(Mm)页表项(PTE)以及访问日志,地址空间布局随机化(ASLR)的相关细节,句柄表(对象表)和Internet端口分配.要弄明白这些数据我们需要理解这些结构的格式以及其宿主驱动程序，但是了解了这些描述信息以及知道到哪里去找这些内存块也同样有助于我们对其中原理的深入研究.</p>
</p>
<h3>分发头扫描</h3>
</p>
<p>有几中执行体对象类型(例如进程,线程,互斥体)是可以进行同步操作的.这也就意味着其他线程可以同步或者等待这些对象的启动,完成,或者执行其他类型的动作.为了启用这一功能,内核会将关于该对象当前状态的信息存储到一个叫做_DISPATCHER_HEADER的子结构中,该结构位于执行体对象结构的非常靠前的地方(比方说,偏移零处).更加重要的一点是,该头部中包含了几个与特定版本Windows操作系统相关的值,所以我们可以为每个配置文件构建一个特征码用于查找.关于分发头在内存取证中的用途的更详细信息请参见Andreas        Schuster的文章Searching for Processes and Threads in Microsoft Windows MemoryDumps (<a href="http://www.dfrws.org/2006/proceedings/2-Schuster.pdf" target="_blank">http://www.dfrws.org/2006/proceedings/2-Schuster.pdf</a>).</p>
</p>
<p> 以下是32位Windows XP SP2系统中的分发头结构:</p>
</p>
<pre><code><p>&gt;&gt;&gt; dt("_DISPATCHER_HEADER")</p><p>'_DISPATCHER_HEADER' (16 bytes)</p><p>0x0 : Type ['unsigned char']</p><p>0x1 : Absolute ['unsigned char']</p><p>0x2 : Size ['unsigned char']</p><p>0x3 : Inserted ['unsigned char']</p><p>0x4 : SignalState ['long']</p><p>0x8 : WaitListHead ['_LIST_ENTRY']</p></code></pre>
</p>
</p>
<p> Andreas Schuster发现Absolute和Inserted这两个域在Windows 2000,XP,以及2003系统中总是为零.Type和Size这两个域是硬编码的值,分别指定了对象类型以及对象的大小.例如,在32位的Windows XP系统中,Type为3表示进程,并且Size为0x1b,并且以四字节\x03\x00\x1b\x00做了标记.跟池标记很相似,我们可以通过扫描内存dump寻找该特征码的实例从而找到所有_EPROCESS对象.早期的名为PTFinder(<a href="http://computer.forensikblog.de/en/2007/11/ptfinder-version-0305.html" target="_blank">http://computer.forensikblog.de/en/2007/11/ptfinder-version-0305.html</a>)的内存取证工具就是基于这个原理的.</p>
</p>
<p> 分发头扫描技术的不利之处在于它只能帮我们扫描同步的对象.例如,文件对象不能同步,所以它们并没有内嵌_DISPATCHER_HEADER.因此,我们不能通过这种方式来定位_FILE_OBJECT实例.此外,从Windows 2003开始,_DISPATCHER_HEADER结构的成员已经被扩展到了10个而不是6个;并且Windows 7已经多达了30个.引入了这么多的成员,它为我们构建一个稳定的特征码带来了不确定性.</p>
</p>
<p> 利用分发头扫描进程的例子我们可以在Volatility的源代码中找到,即contrib/plugins/pspdispscan.py这个文件.它仅仅是做为32位Windows XP上面的一个POC存在.</p>
</p>
<h2>总结</h2>
</p>
<p>Windows对象管理器在管理许多内核对象的时候起到了至关重要的作用.我们只有深入了解Windows对象管理器的内部机理,然后再配合强大的工具,在分析恶意代码的时候才能做到游刃有余.</p>
</p>
<p>由于命令较多,为了便于以后查找,这里将命令汇总了一下:</p>
</p>
<pre><code><p>volshell控制台中的命令:</p><p>dt("_OBJECT_HEADER")</p><p>dt("_OBJECT_TYPE")</p><p>dt("_POOL_HEADER")</p><p>dt("_POOL_TRACKER_TABLE")</p><p>dt("_POOL_TRACKER_BIG_PAGES")</p><p>dt("_DISPATCHER_HEADER")</p><p>db(0xfffff8a003747000, length=0x1000)</p><p>db(0xfffff8a00f9a8001, length=0x1000)</p><p>db(0xfffff8a00861d001, length=0x1000)</p><p>

Volatility框架的插件命令:

python vol.py -f demo.vmem --profile=Win7SP1x64 volshell

python vol.py -f demo.vmem --profile=Win7SP1x64 objtypescan</p><p>python vol.py -f demo.vmem --profile=Win7SP1x64 pooltracker --tags=Proc,File,Driv,Thre<span style="font-size: 13px">                </span></p><p>python vol.py -f demo.vmem --profile=Win7SP1x64 bigpools &gt; bigpools.txt

python vol.py -f demo.vmem --profile=Win7SP1x64 psscan</p><p>
windbg调试器的命令:

kd&gt; !poolfind Proc


内存取证常用命令:


python vol.py -f demo.vmem --profile=Win7SP1x64 psscan     --   扫描进程列表用的,该插件基于内核池扫描技术,所以可以扫描出某些已经结束了的进程,明显攻击者在进行内网渗透时候执行的某些系统命令所对应的进程我们能够扫描出来.</p></code></pre>
</p>
<h2>参考链接&nbsp;</h2>
</p>
<p>The Art of Memory Forensics</p>
</p>
<p>深入解析Windows操作系统</p>
</p>
<p><a href="http://www.volatilityfoundation.org/">http://www.volatilityfoundation.org/</a> </p>
</p>
<p><a href="https://github.com/volatilityfoundation/volatility">https://github.com/volatilityfoundation/volatility</a>&nbsp;</p>
</p>
<p><span style="color: rgb(239, 71, 71);"><b>*本文原创作者：ExpLife，本文属FreeBuf原创奖励计划，未经许可禁止转载</b>        </span>    </p>
                                                    </div>
                        <div class="article-oper article-oper-new">
                            <style>
                                @font-face {font-family: 'iconfont';
                                    src: url('http://static.3001.net/iconfonts/iconfont.eot'); /* IE9*/
                                    src: url('http://static.3001.net/iconfonts/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
                                    url('http://static.3001.net/iconfonts/iconfont.woff') format('woff'), /* chrome、firefox */
                                    url('http://static.3001.net/iconfonts/iconfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
                                    url('http://static.3001.net/iconfonts/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
                                }
                            </style>
                            <div class="share-new clearfix">
                                <div class="share-author">
                                                                            <a href="http://www.freebuf.com/author/ExpLife" title="由 ExpLife 发布" rel="author">
                                            <img src="http://image.3001.net/2016/12/36522794bde280e8b265b628e5c962fa.jpeg" width="50" height="50" alt="ExpLife" class="avatar avatar-50 wp-user-avatar wp-user-avatar-50 photo" />                                            <!--							<img src="http://image.3001.net/2015/06/17.jpg" alt="ArthurKiller">-->
                                        </a>
                                        <div class="share-author-info">
                                                                                        <a class="author-name" href="http://www.freebuf.com/author/ExpLife">ExpLife</a>
                                            <!--<span class="icon-f"></span>-->
                                            <span>
                                <i class="colour-red">
                                    5                                </i>
                                篇文章</span>
                                            <span>等级：
                                <i class="colour-green">3</i>级
                            </span>
                                        </div>
                                                                                                        </div>
                                <div class="user-center clearfix">
                                                                            <a href="http://www.freebuf.com/author/ExpLife" data-toggle="tooltip" data-placement="top" title="个人主页" class="home" target="_blank"></a>
                                                                        <a href="http://www.freebuf.com/user/pm?pmaction=newmessage&to=ExpLife" data-toggle="tooltip" data-placement="top" title="私信" class="letter" target="_blank"></a>
                                </div>
                                <div class="share-ctrl clearfix">
                                                                        <div class="bdsharebuttonbox clearfix bdshare-button-style1-24 columnstatus"
                                         data-bd-bind="1489991449190" data-column="" data-title="利用Volatility进行Windows内存取证分析(二)：内核对象、内核池学习小记" data-name="">
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="tsina" title="分享到新浪微博" id="tsina"></a>
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="weixin" title="分享到微信" id="weixin"></a>
                                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="qzone" title="分享到QQ空间" id="qzone"></a>
                                       <!-- _shareUrlWeibo = 'http://service.weibo.com/share/share.php?url=http://'+encodeURIComponent(_json[i].url)+'&title='+encodeURIComponent(_json[i].title)+'-FreeBuf涓撴爮路'+_json[i].columnName;
                                        _shareUrlZone = 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://'+encodeURIComponent(_json[i].url)+'&title='+_json[i].title+'-FreeBuf涓撴爮路'+_json[i].columnName;
                                        _shareSrc = 'http://s.jiathis.com/qrcode.php?url=http://'+_json[i].url;-->
                                        <span class="share-line">|</span>
                                    </div>
                                </div>
                                <div class="user-ctrl clearfix">
                                                                            <a href="http://www.freebuf.com/oauth" id="collect" data-toggle="tooltip" data-placement="top" title="收藏" ></a>
                                                                        <a href="#respond" data-toggle="tooltip" data-placement="top" title="评论" id="comments"></a>
                                                                        <!--					<a href="#" title="文章纠正">&#xe6e3;</a>-->
                                    <span class="share-line">|</span>
                                    <span class="info-alert"></span>
                                </div>
                            </div>
                            <script>
                                var column = $('.columnstatus').attr('data-column');
                                var text = '';
                                if(column){
                                    var title = $('.columnstatus').attr('data-title');
                                    var name = $('.columnstatus').attr('data-name');
                                    text = title+' - FreeBuf专栏·'+name;
                                }
                                window._bd_share_config={
                                    "common": {
                                        "bdSnsKey": {},
                                        "bdText": text,
                                        "bdMini": "2",
                                        "bdMiniList": ["qzone", "tsina", "weixin"],
                                        "bdPic": "",
                                        "bdStyle": "1",
                                        "bdSize": "24"
                                    },
                                    "share":{},
                                };
                                with(document)0[
                                    (getElementsByTagName('head')[0]||body).
                                    appendChild(createElement('script')).
                                        src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)
                                    ];
                                //控制垂直方向分享模块的定位
                                function shareFixVertical(){
                                    var offsetTop = jQuery(".article-oper").get(0).offsetTop;
                                    var win_h = jQuery(window).height();
                                    var win_w = jQuery(window).width();
                                    var scrollTop = document.body.scrollTop||document.documentElement.scrollTop;
                                    var _height = offsetTop-scrollTop;
                                    var _flag = $('.column-article').attr('data-column');
                                    if(_flag == 1) {
                                        if(_height>=win_h-660&&win_w>975){
                                            var _width = jQuery("#getWidth").innerWidth()-30;
                                            var _left = jQuery("#getWidth").offset().left+15;
                                            jQuery(".share-new").addClass("fixed");
                                            jQuery(".fixed").css({
                                                width:_width,
                                                left:_left
                                            });

                                        }else{
                                            jQuery(".share-new").removeClass("fixed");
                                            jQuery(".share-new").css({
                                                width: "100%"
                                            });
                                        }
                                    }else {
                                        if(_height>=win_h-255&&win_w>975){
                                            var _width = jQuery("#getWidth").innerWidth()-30;
                                            var _left = jQuery("#getWidth").offset().left+15;
                                            jQuery(".share-new").addClass("fixed");
                                            jQuery(".fixed").css({
                                                width:_width,
                                                left:_left
                                            });

                                        }else{
                                            jQuery(".share-new").removeClass("fixed");
                                            jQuery(".share-new").css({
                                                width: "100%"
                                            });
                                        }
                                    }
                                }
                                //控制水平方向分享模块的定位
                                function shareFixHorizontal(){
                                    var _width = jQuery("#getWidth").innerWidth()-30;
                                    var _left = jQuery("#getWidth").get(0).offsetLeft+15;
                                    var win_w = document.documentElement.clientWidth || document.body.clientWidth;
                                    jQuery(".fixed").css({
                                        width:_width,
                                        left:_left
                                    });
                                    if(win_w< 975){
                                        jQuery(".share-new").css({
                                            width: "100%",
                                            left: "0"
                                        });
                                    }else{
                                        var _width = jQuery("#getWidth").innerWidth()-30;
                                        var _left = jQuery("#getWidth").get(0).offsetLeft+15;
                                        jQuery(".fixed").css({
                                            width:_width,
                                            left:_left
                                        });
                                    }
                                }
                                function click(){
                                    var _w = jQuery(window).width();
                                    jQuery(document).click(function(e){
                                        if(jQuery(e.target).attr("id")=="weixin"){
                                            if(_w <= 760) {
                                                jQuery("#bdshare_weixin_qrcode_dialog").hide();
                                                layer.open({
                                                    title: '提示',
                                                    btnAlign: 'c',
                                                    content: '请使用手机浏览器自带的分享功能分享该页面',
                                                    area: '260px'
                                                });
                                            }else {
                                                jQuery("#bdshare_weixin_qrcode_dialog").show();
                                            }
                                        }else {
                                            jQuery("#bdshare_weixin_qrcode_dialog").hide();
                                        }
                                    });
                                }

                                jQuery(window).on("load",function(){
                                    shareFixVertical();
                                    click();
                                });

                                jQuery(window).on("scroll",function(){
                                    //判断滚轮方向
                                    var agent = navigator.userAgent;
                                    if (/.*Firefox.*/.test(agent)) {
                                        document.addEventListener("DOMMouseScroll", function(e) {
                                            e = e || window.event;
                                            var detail = e.detail;
                                            if (detail > 0) {
                                                $(".share-new").removeClass("fixed");
                                                $(".share-new").css({
                                                    width: "100%"
                                                });
                                                $('.main-header .header').removeClass('op1');
                                                $('.main-header .header').addClass('op0');
                                            } else {
                                                shareFixVertical();
                                                $('.main-header .header').removeClass('op0');
                                                $('.main-header .header').addClass('op1');
                                            }
                                        });
                                    } else {
                                        document.onmousewheel = function(e) {
                                            e = e || window.event;
                                            var wheelDelta = e.wheelDelta;
                                            if (wheelDelta > 0) {
                                                shareFixVertical();
                                                $('.main-header .header').removeClass('op0');
                                                $('.main-header .header').addClass('op1');
                                            } else {
                                                $(".share-new").removeClass("fixed");
                                                $(".share-new").css({
                                                    width: "100%"
                                                });
                                                $('.main-header .header').removeClass('op1');
                                                $('.main-header .header').addClass('op0');
                                            }
                                        }
                                    }
                                });


                                jQuery(window).on("resize",function(){
                                    shareFixHorizontal();
                                    click();
                                })

                                //tooltips提示
                                $(function () { $("[data-toggle='tooltip']").tooltip(); });
                            </script>
                        </div>
                                                                                                                            <div class="article-pager ">
                                <ul>
                                    <li class="previous"><span>上一篇：</span><a href="http://www.freebuf.com/sectool/125037.html" rel="prev">一款能在GitHub代码库中探测密钥的工具：Truffle Hog</a>                                    </li>
                                    <li class="next"><span>下一篇：</span>
                                        <a href="http://www.freebuf.com/articles/system/125177.html" rel="next">扩充僵尸网络至企业内网核心区</a>                                    </li>
                                </ul>
                            </div>
                                            </div>
                </div>
                <div class="comment-list">
      <div class="main-tit02">
		<a rel="nofollow" class="btnbtn-default btn-comment" href="#respond">发表评论</a>
        <h3>已有 <span class="color_red">8</span> 条评论
      </div>
      <ul>
         <li class="comment even thread-even depth-1" id="li-comment-207145">
    <div id="comment-207145">
        <div class="photo">     <img src="http://image.3001.net/images/headimg/pic1.png">     </div>
    <div class="tit"> 
	    <span class="name"> ddd </span>
        		<span class="explain">  </span>
		<span class="time">&nbsp;2017-01-17</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-207145','207145', 'respond','124800' ) " href="?replytocom=207145#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">1楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>干货，太干了</p>
<div class="comment-tools">
<div class="vote" id="vote-207145"><span id="acv_stat_207145"></span><a class="ilike_icon"  id="vote4-207145" href="javascript:acv_vote(207145,1);">亮了</a>(<span id="cos_support-207145">2</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="207145" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="207145" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="207145" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="207145" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="207145" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-lzldhu odd alt thread-odd thread-alt depth-1" id="li-comment-207153">
    <div id="comment-207153">
        <div class="photo"> <a href="http://www.freebuf.com/author/lzldhu">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/lzldhu" target="_blank">lzldhu&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(1级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-01-17</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-207153','207153', 'respond','124800' ) " href="?replytocom=207153#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">2楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>够详细的 <img src='http://image.3001.net/images/index/smilies/icon_surprised.gif' alt=':eek:' class='wp-smiley' /> </p>
<div class="comment-tools">
<div class="vote" id="vote-207153"><span id="acv_stat_207153"></span><a class="ilike_icon"  id="vote4-207153" href="javascript:acv_vote(207153,1);">亮了</a>(<span id="cos_support-207153">2</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="207153" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="207153" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="207153" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="207153" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="207153" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-evilknight even thread-even depth-1" id="li-comment-207311">
    <div id="comment-207311">
        <div class="photo"> <a href="http://www.freebuf.com/author/evilknight">
    <img src="http://image.3001.net/2015/05/QQ-Photo20141012173337.jpg"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/evilknight" target="_blank">evilknight&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(2级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-01-18</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-207311','207311', 'respond','124800' ) " href="?replytocom=207311#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">3楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>好细。。。。不错</p>
<div class="comment-tools">
<div class="vote" id="vote-207311"><span id="acv_stat_207311"></span><a class="ilike_icon"  id="vote4-207311" href="javascript:acv_vote(207311,1);">亮了</a>(<span id="cos_support-207311">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="207311" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="207311" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="207311" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="207311" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="207311" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-arch-vile odd alt thread-odd thread-alt depth-1" id="li-comment-207475">
    <div id="comment-207475">
        <div class="photo"> <a href="http://www.freebuf.com/author/Arch Vile">
    <img src="http://image.3001.net/images/20170701/14988693742784.png!video"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/Arch Vile" target="_blank">Arch Vile&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(3级)</span>
				<span class="explain"> 这家伙太懒了，还未填写个人描述！ </span>
		<span class="time">&nbsp;2017-01-19</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-207475','207475', 'respond','124800' ) " href="?replytocom=207475#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">4楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>Windows的对象管理结构一直在改，每个系统都有差距，真心头疼</p>
<div class="comment-tools">
<div class="vote" id="vote-207475"><span id="acv_stat_207475"></span><a class="ilike_icon"  id="vote4-207475" href="javascript:acv_vote(207475,1);">亮了</a>(<span id="cos_support-207475">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="207475" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="207475" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="207475" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="207475" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="207475" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-attack_eg even thread-even depth-1" id="li-comment-227936">
    <div id="comment-227936">
        <div class="photo"> <a href="http://www.freebuf.com/author/attack_eg">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/attack_eg" target="_blank">attack_eg&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(1级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-08-23</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-227936','227936', 'respond','124800' ) " href="?replytocom=227936#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">5楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>还没看懂，先顶一下！</p>
<div class="comment-tools">
<div class="vote" id="vote-227936"><span id="acv_stat_227936"></span><a class="ilike_icon"  id="vote4-227936" href="javascript:acv_vote(227936,1);">亮了</a>(<span id="cos_support-227936">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="227936" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="227936" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="227936" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="227936" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="227936" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-attack_eg odd alt thread-odd thread-alt depth-1" id="li-comment-228037">
    <div id="comment-228037">
        <div class="photo"> <a href="http://www.freebuf.com/author/attack_eg">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/attack_eg" target="_blank">attack_eg&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(1级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-08-24</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-228037','228037', 'respond','124800' ) " href="?replytocom=228037#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">6楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>请问，是怎样通过扫描_OBJECT_TYPE中Key（4字节特征码），最后找到实际的对象体的。<br />
按照大神的文章画出的示意图，这个问题没弄懂：<a href=http://image.3001.net/images/20170824/15035376906209.png target="_blank" title="" data_ue_src=http://image.3001.net/images/20170824/15035376906209.png class="highslide-image" onclick="return hs.expand(this);"><strong style="color: rgb(38, 38, 38);"></strong><strong><img data-original=http://image.3001.net/images/20170824/15035376906209.png data-original="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"/></strong></a></p>
<noscript><img data-original=http://image.3001.net/images/20170824/15035376906209.png src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"/></noscript>
<div class="comment-tools">
<div class="vote" id="vote-228037"><span id="acv_stat_228037"></span><a class="ilike_icon"  id="vote4-228037" href="javascript:acv_vote(228037,1);">亮了</a>(<span id="cos_support-228037">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="228037" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="228037" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="228037" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="228037" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="228037" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-attack_eg even thread-even depth-1" id="li-comment-228603">
    <div id="comment-228603">
        <div class="photo"> <a href="http://www.freebuf.com/author/attack_eg">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/attack_eg" target="_blank">attack_eg&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(1级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-08-30</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-228603','228603', 'respond','124800' ) " href="?replytocom=228603#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">7楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>弄明白了， 首先应该根据4字节特征码找到特定执行体对象（如进程对象）的类型对象（_OBJECT_TYPE），之后在类型对象中包含管理执行体对象的链表首指针。</p>
<div class="comment-tools">
<div class="vote" id="vote-228603"><span id="acv_stat_228603"></span><a class="ilike_icon"  id="vote4-228603" href="javascript:acv_vote(228603,1);">亮了</a>(<span id="cos_support-228603">1</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="228603" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="228603" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="228603" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="228603" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="228603" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
<li class="comment byuser comment-author-attack_eg odd alt thread-odd thread-alt depth-1" id="li-comment-228604">
    <div id="comment-228604">
        <div class="photo"> <a href="http://www.freebuf.com/author/attack_eg">
    <img src="http://www.freebuf.com/buf/plugins/wp-user-avatar/images/wp-user-avatar-96x96.png"></a>
     </div>
    <div class="tit"> 
	    <span class="name"> <a href="http://www.freebuf.com/author/attack_eg" target="_blank">attack_eg&nbsp;</a>  </span>
        		
		<span class="icon-f"> </span>
		<span class="rank">(1级)</span>
				<span class="explain">  </span>
		<span class="time">&nbsp;2017-08-30</span>
		<span class="time">
                    </span>
        <span class="useragent_output_custom"></span>
        <span class="useragent_output_custom"></span> 
		<span class="reply">
		        <!-- 正常情况 -->
           <a onclick="return addComment.moveForm( 'comment-228604','228604', 'respond','124800' ) " href="?replytocom=228604#respond" class="comment-reply-link" rel="nofollow">回复</a>
        	    </span>
		<span class="floor">8楼</span>
	</div>
	    <div class="txt">
	  <p class="useragent_output_custom"></p>
      <p>这篇文章是《The Art of Memory Forensics》其中一段的翻译。 为啥不标记出来。。。写原创不害臊吗</p>
<div class="comment-tools">
<div class="vote" id="vote-228604"><span id="acv_stat_228604"></span><a class="ilike_icon"  id="vote4-228604" href="javascript:acv_vote(228604,1);">亮了</a>(<span id="cos_support-228604">0</span>)</div>
<div class="dropup"><a class="dropdown-toggle btn-report" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none;"> 举报</a>
<ul class="dropdown-menu" style="display:none;bottom:auto;">
<li><a data-id="228604" class="click_report" href="javascript:;">广告等垃圾信息</a></li>
<li><a data-id="228604" class="click_report" href="javascript:;">不友善内容</a></li>
<li><a data-id="228604" class="click_report" href="javascript:;">违反法律法规的内容</a></li>
<li><a data-id="228604" class="click_report" href="javascript:;">不宜公开讨论的政治内容</a></li>
<li><a data-id="228604" class="click_report" href="javascript:;">其他</a></li>
</ul></div>
</div>
	</div></div>
</li><!-- #comment-## -->
      </ul>
      <div class="commentnav page01" style="padding-top:10px; text-align: center;">
               </div>
	  
<script src="http://www.freebuf.com/buf/themes/freebuf/js/ajaxfileupload.js" type="text/javascript"></script>
<div id="respond" class="comment-box">
<input type="file" id="uploadUnit" name="upfile" class="hidden" value="">
    <form action="http://www.freebuf.com/wp-comments-post.php" method="post" id="commentform">
        <div id="comment-author-info">
	    <div class="login-other">
		  <div class="login_button login_icon_sina" title="使用新浪微博登陆" onclick="login_button_click('sina')"></div>
          <div class="login_button login_icon_qq" title="使用腾讯QQ登陆" onclick="login_button_click('qq')"></div></div>
        <div class="login-input">
	    <p><label for="author">昵称</label>
		          <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p><span>必须</span><span>您当前尚未登录。<a  class="simplemodal-login" href="http://www.freebuf.com/oauth" title="登陆">登陆？</a><a  href="https://account.tophant.com/register.html" target="_blank">注册</a></span></div>
		<div class="login-input">
		  <p><label for="email">邮箱</label><input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required /></p>
		<span>必须（保密）</span>
		</div>
    </div>

        <div id="test" class="post-area">
      <div class="holiday"></div>
	    <div class="comment-editor">
			<a id="comment-smiley" href="javascript:;">表情</a><a href="javascript:;" id="imageThumb">插图</a>
	    </div>
        <div id="smileys" >
           <a title="mrgreen" href="javascript:grin(':mrgreen:')"><img src="http://image.3001.net/images/index/smilies/icon_mrgreen.gif" /></a><a title="razz" href="javascript:grin(':razz:')"><img src="http://image.3001.net/images/index/smilies/icon_razz.gif" /></a><a title="sad" href="javascript:grin(':sad:')"><img src="http://image.3001.net/images/index/smilies/icon_sad.gif" /></a><a title="smile" href="javascript:grin(':smile:')"><img src="http://image.3001.net/images/index/smilies/icon_smile.gif" /></a><a title="oops" href="javascript:grin(':oops:')"><img src="http://image.3001.net/images/index/smilies/icon_redface.gif" /></a><a title="grin" href="javascript:grin(':grin:')"><img src="http://image.3001.net/images/index/smilies/icon_biggrin.gif" /></a><a title="eek" href="javascript:grin(':eek:')"><img src="http://image.3001.net/images/index/smilies/icon_surprised.gif" /></a><a title="???" href="javascript:grin(':???:')"><img src="http://image.3001.net/images/index/smilies/icon_confused.gif" /></a><a title="cool" href="javascript:grin(':cool:')"><img src="http://image.3001.net/images/index/smilies/icon_cool.gif" /></a><a title="lol" href="javascript:grin(':lol:')"><img src="http://image.3001.net/images/index/smilies/icon_lol.gif" /></a><a title="mad" href="javascript:grin(':mad:')"><img src="http://image.3001.net/images/index/smilies/icon_mad.gif" /></a><a title="twisted" href="javascript:grin(':twisted:')"><img src="http://image.3001.net/images/index/smilies/icon_twisted.gif" /></a><a title="roll" href="javascript:grin(':roll:')"><img src="http://image.3001.net/images/index/smilies/icon_rolleyes.gif" /></a><a title="wink" href="javascript:grin(':wink:')"><img src="http://image.3001.net/images/index/smilies/icon_wink.gif" /></a><a title="idea" href="javascript:grin(':idea:')"><img src="http://image.3001.net/images/index/smilies/icon_idea.gif" /></a><a title="arrow" href="javascript:grin(':arrow:')"><img src="http://image.3001.net/images/index/smilies/icon_arrow.gif" /></a><a title="neutral" href="javascript:grin(':neutral:')"><img src="http://image.3001.net/images/index/smilies/icon_neutral.gif" /></a><a title="cry" href="javascript:grin(':cry:')"><img src="http://image.3001.net/images/index/smilies/icon_cry.gif" /></a><a title="?" href="javascript:grin(':?:')"><img src="http://image.3001.net/images/index/smilies/icon_question.gif" /></a><a title="evil" href="javascript:grin(':evil:')"><img src="http://image.3001.net/images/index/smilies/icon_evil.gif" /></a><a title="shock" href="javascript:grin(':shock:')"><img src="http://image.3001.net/images/index/smilies/icon_eek.gif" /></a><a title="!" href="javascript:grin(':!:')"><img src="http://image.3001.net/images/index/smilies/icon_exclaim.gif" /></a>        </div>
         <textarea name="comment" id="comment" cols="100%" rows="7" tabindex="4" style="overflow-x:hidden; overflow-y:hidden; border:0; width:100%;" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById('submit').click();return false};"></textarea>
    </div>
      <div class="subcon but">
      <input class="btn btn-success" type="submit" name="submit" id="submit" tabindex="5" value="提交评论(Ctrl+Enter)" />
      <a rel="nofollow" class="btn btn-default" id="cancel-comment-reply-link" href="javascript:;">取消</a>
      <div class="checkbox"><input type='hidden' name='comment_post_ID' value='124800' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
<label for="comment_mail_notify" class="comment_mail"><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked"/>有人回复时邮件通知我</label></div>
      </div>
    <input name="Token" id="Token" type="hidden" value="so8uy5" />
  </form>
  </div>
</div>	  
<div class="commentshow">
<div class="comments-loading">Loading...</div>
</div>
<script language="javascript">
jQuery(document).ready(function($){ //Begin jQuery
    $('.reply').click(function() {
    var atid = '"#' + $(this).parent().attr("id") + '"';
    var atname = $(this).parent().find('span:first').text();
    $("#comment").val("@" + atname + " ").focus();
});
    $('.cancel-comment-reply a').click(function() { //点击取消回复评论清空评论框的内容
    $("#comment").val('');
});
}) 

jQuery(document).ready(function($) {
    $body = (window.opera) ? (document.compatMode == "CSS1Compat" ? $('html') : $('body')) : $('html,body');//commentnav ajax
    $(document).on('click', '.commentnav a', function(e) {
        e.preventDefault();
        $.ajax({
            type: "GET",
            url: $(this).attr('href'),
            beforeSend: function() {
                $('.commentnav').remove();
                $('.comment-list').remove();
                $('.comments-loading').slideDown();
            },
            dataType: "html",
            success: function(out) {
                result = $(out).find('.comment-list');
                nextlink = $(out).find('.commentnav');
                $('.comments-loading').slideUp(550);
                $('.comments-loading').after(result.fadeIn(800));
                $(".comment-list img").each(function(){
                  var url = $(this).attr("data-original");
                  $(this).attr("src",url);
                })
            }
        });
    });    
});
</script>            </div>
                    <div class="col-md-3 visible-md-block visible-lg-block">
                <div class="panel panel-default">
                    <div class="author-top">
                         <div class="author-wrap">
                            <div class="author-header"><img src="http://image.3001.net/2016/12/36522794bde280e8b265b628e5c962fa.jpeg" width="96" height="96" alt="ExpLife" class="avatar avatar-100 wp-user-avatar wp-user-avatar-100 photo" />                            </div>
                            <p class="name"><a href="http://www.freebuf.com/author/explife" title="由 ExpLife 发布" rel="author">ExpLife</a><span></span></p>
                            <p class="signature">Freebuf社区:ExpLife
Github:https://github.com/ExpLife</p>
                            <p class="art-com clearfix">
                                <span class="aut-article">
                                    <a href="/author/ExpLife"target="_blank">
                                        <i>5</i>
                                        <i>文章数</i>
                                    </a>
                                </span>
                                <span class="aut-comment">
                                    <a href="/author/ExpLife?comment=1" target="_blank">
                                        <i>27</i>
                                        <i>评论数</i>
                                    </a>
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="author-bottom">
                        <div class="author-wrap">
                            <h3 class="last-title">最近文章</h3>
                            <div class="last-item-wrap">
                                                                        <div class="last-item">
                                            <a href="http://www.freebuf.com/sectool/124800.html" target="_blank"><span class="point"></span>利用Volatility进行Windows内存取证分析(二)：内核对象、内核池学习小记</a>
                                            <p class="last-time">2017.01.17</p>
                                        </div>
                                                                            <div class="last-item">
                                            <a href="http://www.freebuf.com/sectool/124690.html" target="_blank"><span class="point"></span>利用Volatility进行Windows内存取证分析(一)：初体验</a>
                                            <p class="last-time">2017.01.10</p>
                                        </div>
                                                                            <div class="last-item">
                                            <a href="http://www.freebuf.com/articles/system/123816.html" target="_blank"><span class="point"></span>布谷鸟沙箱初体验</a>
                                            <p class="last-time">2016.12.26</p>
                                        </div>
                                                                </div>
                        </div>

                        <div class="more-wrap">
                            <a href="http://www.freebuf.com/author/ExpLife" target="_blank" class="btn-new">浏览更多</a>
                        </div>
                    </div>
                </div>
                                <div class="panel panel-default">
                    <div class="read visible-md-block visible-lg-block">
                        <div class="main-tit02">
                            <h3>相关阅读</h3>
                        </div>
                        <ul>
  <li><a href="http://www.freebuf.com/articles/system/26936.html" target="_blank">利用Volatility查找系统中的恶意DLL</a></li>
  
  <li><a href="http://www.freebuf.com/sectool/124690.html" target="_blank">利用Volatility进行Windows内存取证分析(一)：初体验</a></li>
  </ul><ul>
  <li><a href="http://www.freebuf.com/sectool/118802.html" target="_blank" title=渗透测试神器Burp Suite v1.7.08发布（含下载）>渗透测试神器Burp Suite v1.7.08发布（含下载）</a></li>
  
  <li><a href="http://www.freebuf.com/articles/system/135196.html" target="_blank" title=WannaCry勒索病毒详细解读>WannaCry勒索病毒详细解读</a></li>
  
  <li><a href="http://www.freebuf.com/sectool/113594.html" target="_blank" title=sshhipot：一款高交互的SSH蜜罐>sshhipot：一款高交互的SSH蜜罐</a></li>
  </ul>                    </div>
                </div>
                <!--<div class="ad-wrap"><a href="http://www.ijiami.cn/?freebuf.com" target="_blank"><img width="100%" src="http://image.3001.net/images/20141201/14174039186901.jpg"></a></div>-->
                <div class="panel panel-default rec-spe">
                    <div class="main-tit03 colour-blue">
                        <h3>特别推荐</h3>
                    </div>
                                                    <div class="rec-img"><a href="http://www.freebuf.com/ad?id=3" target="_blank"><img
                                            src="http://image.3001.net/2017/05/14a10c5c919d154dddbee79e3a944143-220x150.png" width="220"></a></div>
                                                </div>
                <div id="mar-right">
                    <!--<div class="read visible-lg-block">
        <div class="main-tit04">
          <h3>商城新品</h3>
        </div>
        <div id="slider" class="nivoSlider">  </div>
      </div>-->
                    <div class="panel panel-default code"><img src="http://image.3001.net/images/new/code.jpg" width="192"
                                                               height="192">
                        <p>关注我们 分享每日精选文章</p>
                    </div>
                </div>
            </div>
                </div>
                    <div class="row marvellous visible-lg-block">
                <h3>不容错过</h3>
                <ul>
                                                <li><a href="http://www.freebuf.com/sectool/53487.html" rel="bookmark"
                                   title="国产SQL注入漏洞测试工具 &#8211; 超级SQL注入工具（SSQLInjection）">国产SQL注入漏洞测试工具 &#8211; 超级SQL注入工具（SSQLInjection）</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/shack2" title="由 shack2 发布" rel="author">shack2</a></span>
                                                                        <span class="time">2014-12-04</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/news/108366.html" rel="bookmark"
                                   title="一家中国广告公司，如何利用恶意软件感染全球8500万台手机">一家中国广告公司，如何利用恶意软件感染全球8500万台手机</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/%e6%ac%a7%e9%98%b3%e6%b4%8b%e8%91%b1" title="由 欧阳洋葱 发布" rel="author">欧阳洋葱</a></span>
                                                                        <span class="time">2016-07-06</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/articles/network/126702.html" rel="bookmark"
                                   title="【新手指南】浅谈拒绝服务攻击的原理与防御（1）:普通拒绝服务攻击">【新手指南】浅谈拒绝服务攻击的原理与防御（1）:普通拒绝服务攻击</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/%e9%bb%91%e6%88%88%e7%88%be" title="由 黑戈爾 发布" rel="author">黑戈爾</a></span>
                                                                        <span class="time">2017-02-16</span></p>
                            </li>
                                                    <li><a href="http://www.freebuf.com/articles/terminal/99611.html" rel="bookmark"
                                   title="惊：黑客居然可以看到正在做“羞羞的事”的你！">惊：黑客居然可以看到正在做“羞羞的事”的你！</a>
                                <p>                                        <span class="name"><a href="http://www.freebuf.com/author/firefrank" title="由 FireFrank 发布" rel="author">FireFrank</a></span>
                                                                        <span class="time">2016-03-22</span></p>
                            </li>
                                                            </ul>
            </div>
            </div>
</div>
<script type="text/javascript">
  $(window).load(function() {
    $('#slider').nivoSlider();
  });
  $('#contenttxt img').removeAttr('height');
  $('#contenttxt img').wrap(function(){
    if(!$(this).parent().attr('href')){
      var imgurl = $(this).attr('data-original');
      if(imgurl.substr(-6)=='!small'){
        imgurl = imgurl.substring(0,imgurl.length-6);
      }
      return '<a href="' + imgurl + '" class="highslide-image" onclick="return hs.expand(this);" target="_blank"></a>';
    }
  })
</script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/comments-ajax.js" type="text/javascript"></script>
<script type="text/javascript" src="http://static.3001.net/js/focus/jquery.nivo.slider.pack.js"></script>
<!----------footer---------->
<div class="footer">
  <div class="container">
    <div class="footer-list ">
      <h3>FREEBUF</h3>
      <ul>
        <li><a href="http://www.freebuf.com/dis">免责声明</a></li>
        <li><a href="http://www.freebuf.com/news/others/864.html">关于我们</a></li>
        <li><a href="http://www.freebuf.com/jobs/40386.html">加入我们</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>广告及服务</h3>
      <ul>
        <li><a target="_blank" href="mailto:root@freebuf.com">寻求报道</a></li>
        <li><a href="http://www.freebuf.com/advertise">广告合作</a></li>
        <li><a target="_blank" href="mailto:help@freebuf.com">联系我们</a></li>
        <li><a href="http://www.freebuf.com/friends">友情链接</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>关注我们</h3>
      <ul>
        <li><div class="weixin-pannel weixin"><a class="qr" href="javascript:viod(0);"><span class="g-icon-qr1">官方微信</span><i></i></a></div></li>
        <li><a rel="nofollow" target="_blank" href="http://weibo.com/freebuf">新浪微博</a></li>
        <li><a rel="nofollow" target="_blank" href="http://t.qq.com/freebuf">腾讯微博</a></li>
        <li><a rel="nofollow" target="_blank" href="http://twitter.com/freebuf">Twitter</a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <h3>赞助商</h3>
      <ul>
        <li style="padding:6px 0 10px;"><a rel="nofollow" target="_blank" href="http://www.aliyun.com/?freebuf"><img src="http://image.3001.net/images/ad/ali.png"></a></li>
        <li><a rel="nofollow" target="_blank" href="http://www.upyun.com/?freebuf"><img src="http://image.3001.net/images/ad/upyun.png"></a></li>
        <li style="padding:6px 0 10px;"><a rel="nofollow" target="_blank" href="https://www.trustasia.com/?freebuf"><img src="http://image.3001.net/images/ad/ad-yzcx.png"></a></li>
      </ul>
    </div>
    <div class="footer-list ">
      <ul>
      </ul>
    </div>
    <div class="footer-logo  pull-right"><img src="http://image.3001.net/images/index/freebufrobot_shendanjie.png" ></div>
  </div>
  <div class="copyright"><div class="container"><p>Copyright &copy; 2017 WWW.FREEBUF.COM All Rights Reserved <a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn">沪ICP备13033796号</a></p><span><a rel="nofollow" target="_blank" href="http://click.aliyun.com/m/1336/?freebuf"><img src="http://image.3001.net/images/new/icon-aly.png"></a></span></div></div>
</div>
<div class="bottom_tools"><a id="scrollUp" href="javascript:;" title="飞回顶部"></a></div>
<!----------footer end----------> 
<script src="http://static.3001.net/js/new/backtop.js"></script>
<script type="text/javascript">
jQuery(function(){	
	jQuery('.tabPanes ul li').click(function(){
		jQuery(this).addClass('hit').siblings().removeClass('hit');
		jQuery('.panesl>div:eq('+jQuery(this).index()+')').show().siblings().hide();	
	})
	jQuery('.vulbox-nav').click(function(e) { 
        e.stopPropagation(); 
    });  
})
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fcc53db168808048541c6735ce30421f5' type='text/javascript'%3E%3C/script%3E"));
</script>
<img alt='css.php' src="http://www.freebuf.com/buf/plugins/cc/css.php?k=3cb185a485c81b23211eb80b75a406fd&amp;o=i&amp;t=1013343618" width='1' height='1' /><script type="text/javascript">
jQuery(function() {
    jQuery(".simditor pre").each(function(i, block){
        hljs.highlightBlock(block);    
    });
    hljs.initHighlightingOnLoad();
});
</script>
<script>
/* <![CDATA[ */
var rcGlobal = {
	serverUrl		:'http://www.freebuf.com',
	infoTemp		:'%REVIEWER% on %POST%',
	loadingText		:'Loading',
	noCommentsText	:'No comments',
	newestText		:'&laquo; 最新',
	newerText		:'&laquo; 新一点',
	olderText		:'旧一点 &raquo;',
	showContent		:'1',
	external		:'1',
	avatarSize		:'32',
	avatarPosition	:'left',
	anonymous		:'Anonymous'
};
/* ]]> */
</script>
<script type='text/javascript' src='http://static.3001.net/js/recentcomments/wp-recentcomments-jquery.js?ver=2.2.3'></script>
</body>
</html>
