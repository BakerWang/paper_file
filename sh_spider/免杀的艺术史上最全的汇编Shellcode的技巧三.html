<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>免杀的艺术：史上最全的汇编Shellcode的技巧（三） - 嘶吼 RoarTalk &#8211; 回归最本质的信息安全,互联网安全新媒体,4hou.com</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta property="wb:webmaster" content="4517e8fe39b18975" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="description" content="我们在上一篇提到要要自定义shellcode，不过由于这是个复杂的过程，我们只能专门写一篇了，本文，我们将会给大家介绍shellcode的基本概念，shellcode在编码器及解码器中的汇编以及几种绕过安全检测的解决方案，例如…" />
    <meta name="keywords" content="免杀" />
        <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon.ico" rel="shortcut icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_114.png" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_76.png" sizes="76x76" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_120.png" sizes="120x120" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_152.png" sizes="152x152" rel="apple-touch-icon">

    <!-- 引入 lib -->
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/jquery.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.jquery.min.js"></script>
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.min.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <!--[if lt IE 11]>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/html5shiv.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/respond.js"></script>
    <![endif]-->
    <!-- 引入 css js -->
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/css/style.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/public.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/main.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/index-more.js"></script>
    </head>
<body>
<style type="text/css">
.memberlistanimate{width: 122px}
.memberlistanimateleave{width: 122px}
.nameheader{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width: 78px;display: block;}
</style>

<header class="header">
            <article class="header_center">
                <div class="logowrap">
            <a href="http://www.4hou.com"><div class="logo icons"></div></a>
            <h1>回归最本质的信息安全</h1>
        </div>
        <div class="login">
            <form action="/" class="navbar-form inSearch " name="searchform" onsubmit="return checksubmit()">
                <div class="br">
                    <span class="in-btn icons"></span>
                    <input type="text" name="s" id="search" class="animated">
                    <div class="clear icons"></div>
                </div>
                <div id="submitBtnplace" class="icons animated" value=""></div>
                <!--<input type="submit" id="submitBtn" class="icons animated" value="">-->
            </form>
                            <!--登录注册按钮-->
                 <div id="register">
                     <a href="http://www.4hou.com/register" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">注册</a>
                 </div>
                 <div id="sing">
                      <a href="http://www.4hou.com/login" class="pzh_login">登录</a>
                 </div>

                 <div class="burger2 menu" id="burger">
                  <div class="icon"></div>
                 </div>

            
           <!-- <div id="register">注册</div>
            <div id="sing">登录</div>
            <div class="burger2 menu" id="burger">
                <div class="icon"></div>
            </div>-->
        </div>
    </article>
</header>
<nav class="navbox animated">
    <section class="navbox_cen">
        <article class="navboxleft">
            <ul class="nav navbar-nav index-nav" id="inNav">
					<li>
							<li class="cat-item cat-item-18"><a href="http://www.4hou.com/category/info" >资讯</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://www.4hou.com/category/technology" >技术</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://www.4hou.com/category/xactivity" >活动</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://www.4hou.com/category/vulnerable" >漏洞</a>
</li>
					</li>
                    <li class="cat-item cat-item-29"><a href="http://www.4hou.com/piao" >嘶票</a>
                    </li>
            </ul>
        </article>
        <article class="navboxright">
            <div class="contrib"> <a href="http://www.4hou.com/contribute" class="tougao" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">投稿</a></div>
        </article>
    </section>
</nav>
<div id="modelbg"></div>
    <style>


    ::selection {
    background:#fea283;
    color:#fff;
}
::-moz-selection {
    background:#fea283;
    color:#fff;
}
::-webkit-selection {
    background:#fea283;
    color:#fff;
}


        .article_cen p img{height: auto !important;}
        .commentlist .children{width: 90%; padding-right: 15px; border-color: transparent ;}
        .commentname,.commenteml{width: 60%; margin-left:5% ;margin-bottom: 30px;border-bottom: 1px solid #dbdbdb;}
        .article_cen ol li{list-style-type: decimal;}
         .article_cen ol li p{overflow: inherit;}
        .commentname label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commentname input{width: 50%;border: none; outline: none;}
        .commenteml label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commenteml input{width: 50%;border: none; outline: none;}
        #zooming{display: none;width: 100%;height: 100%; position: fixed;z-index: 999;left: 0px; top: 0px; background-color: rgba(0,0,0,.6);}
        .zoomaniatae{display: block !important;}
        .imgcon{}
        #imgcon{position: absolute;left: 50%; top: 20%;max-width: 80%}
        .article_cen img{cursor: pointer;}
        #zooming{cursor: pointer;}
        .imgconadimate{animation:imgcon 0.5s 1 forwards;
        -webkit-animation:imgcon 0.5s 1 forwards;}
        .article_authorbox{    width: 222px;min-height: 214px;
        padding-bottom: 20px;
        float: right;
        position: relative;}
        .interested{position: relative;}
        .interested>h1{font-size: 18px; font-weight: 900; position: absolute; top: -36px;color: #5e5e5e}
       .user-comment span{font-size: 13px; position: relative; top: 2px;}
        .article_authoradd{position: fixed;}
        .stratend{background:url(http://www.4hou.com/wp-content/themes/4houv2/img/starend.png); !important;background-size: contain !important;}
        .wpfp-span{opacity: 0;width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-link{width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-span img{display: none;}
        .interested{width: 222px;padding-bottom: 20px;background-color: #fff;margin-top: 70px; padding-bottom: 10px; padding-top: 10px;border: 1px solid #f5c2b1}
        .interested li{width: 100%;position: relative;padding-top: 8px; padding-bottom: 8px;  line-height: 24px; padding-left: 20px;padding-right: 14px}
        .interested li i{width: 6px;height: 6px;border-radius: 50%; background-color: #f63;position: absolute; left: 8px; top: 18px;}
        .interested li a{color: #666;font-size: 14px; line-height: 18px;}
        .interested li:hover{background-color: #f9e7e3;-moz-transition: all 0.4s ease-in-out;
        .footer{position: relative;z-index: 99}   
        .article_authorbox_top{position: relative;} 
        

        -o-transition: all 0.4s ease-in-out; -webkit-transition: all 0.4s ease-in-out; transition: all 0.4s ease-in-out;}
    
        @-webkit-keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        @keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        .asideanimate{animation:asideanimate 1s 1 forwards;
        -webkit-animation:asideanimate 1s 1 forwards; position: fixed;}
        @-webkit-keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        @keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        .asideanimateleave{animation:asideanimateleave 1s 1 forwards;
        -webkit-animation:asideanimateleave 1s 1 forwards;}
        @-webkit-keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @media screen and (max-width:650px) {
            .member_list{right: -30px !important;top: 34px !important;}
            .article_authorbox{display: none;}
            .nameheader{display: none;}
            .shang_box{width: 90%; margin-left:-45% }
            #imgcon{width: 90% !important; margin-left: -45% !important;max-width: inherit !important}
            .dy{padding: 12px 15px!important;font-size: 14px !important; line-height: 22px !important;}
        }
        .article_author{float:none !important;padding-top: 1px;}
        .article_cen pre{color: #666 !important; line-height: 26px; background-color: #f1f1f1}
        .articlecontent blockquote>p{ color: #666; font-size: 16px; }
    </style>
    <section class="articlewrap">
        <article class="articlecontent">
            <div class="article_top">
                <h1 class="art_title">免杀的艺术：史上最全的汇编Shellcode的技巧（三）</h1>
                <p class="art_time">2017年3月22日发布</p>
                <div class="art_nav">
                    <!--<a href="">翻译文章</a>
                    <span>／</span>
                    <a href="">新闻</a>
                    <span>／</span>
                    <a href="">原创</a>-->
                                        <a href="http://www.4hou.com">首页 </a></a>
                    <span>／</span>
                    <a href="http://www.4hou.com/category/technology">技术</a>
                    <span>／</span>
                    <a href="">正文</a>

                    </ul>
                </div>
                <div class="art_type">
                    <div class="newtype">
                        <div class="read ">
                            <i class="icons"></i>
                            <span>5,160</span>
                        </div>
                        <div class="comment ">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                        <div class="Praise">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                    </div>
                </div>
            </div>
             <p class="dy" style="padding: 24px 60px;font-size: 16px;line-height: 30px;color: #808080;background-color: #f6f6f6;"><span style="font-weight: bold;">导语：</span>本文，我们将会给大家介绍shellcode的基本概念，shellcode在编码器及解码器中的汇编以及几种绕过安全检测的解决方案。</p>

            <div class="article_cen">
                <!--文章摘要-->
               
                <p><p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817641628396.jpg" title="1489817641628396.jpg" alt="1489817641628396.jpg" width="660" height="361" border="0" vspace="0" style="width: 660px;height: 361px"/><noscript><img src="/uploads/20170318/1489817641628396.jpg" title="1489817641628396.jpg" alt="1489817641628396.jpg" width="660" height="361" border="0" vspace="0" style="width: 660px;height: 361px"/></noscript></p>
<p>我们在上一篇提到要要自定义shellcode，不过由于这是个复杂的过程，我们只能专门写一篇了，本文，我们将会给大家介绍shellcode的基本概念，shellcode在编码器及解码器中的汇编以及几种绕过安全检测的解决方案，例如如何绕过微软的 EMET（一款用以减少软件漏洞被利用的安全软件）。为了理解本文的内容，大家需要具了解x86汇编知识和基本文件格式（如COFF和PE）。</p>
<p><span style="font-size: 20px;"><strong>专业术语</strong></span></p>
<p><strong>进程环境块（PEB）</strong>：PEB(Process Environment Block)是Windows NT操作系统中的一种数据结构。由于PEB仅在Windows NT操作系统内部使用，其大多数字段不面向其他操作系统，所以PEB就不是一个透明的数据结构。微软已在其MSDN Library技术开发文档中开始修改PEB的结构属性。它包含了映像加载器、堆管理器和其他的windows系统DLL所需要的信息，因为需要在用户模式下修改PEB中的信息，所以必须位于用户空间。PEB存放进程信息，每个进程都有自己的 PEB 信息。准确的 PEB 地址应从系统的 EPROCESS 结构的 1b0H 偏移处获得，但由于 EPROCESS在进程的核心内存区，所以程序不能直接访问。</p>
<p><strong>导入地址表（IAT）</strong>：IAT （Import Address Table）由于导入函数就是被程序调用但其执行代码又不在程序中的函数，这些函数的代码位于一个或者多个DLL 中，当PE 文件被装入内存的时候，Windows 装载器才将DLL 装入，并将调用导入函数的指令和函数实际所处的地址联系起来(动态连接)，这操作就需要导入表完成.其中导入地址表就指示函数实际地址。</p>
<p><strong>数据执行保护（DEP）</strong>：与防病毒程序不同，数据执行保护（DEP）是一组对内存区域进行监控的硬件和软件技术，DEP技术的目的并不是防止在计算机上安装有害程序。 而是监视你的已安装程序，帮助确定它们是否正在安全地使用系统内存。在Microsoft Windows XP Service Pack 2（SP2）和Microsoft Windows XP Tablet PC的2005版中，DEP是通过硬件和软件来运行的。DEP的主要优点是阻止代码在数据页中运行。通常，代码不会在默认堆和堆栈中执行。而硬件可以强制DEP检测在这些位置运行的代码，当运行发生异常时，软件就可以通过DEP阻止恶意代码利用Windows中的异常处理机制。</p>
<p><strong>stdcall调用约定</strong>：__stdcall调用约定相当于16位动态库中经常使用的PASCAL调用约定。调用约定是用来清理堆栈的，和__cdecl类似，stdcall调用约定也是按从右至左的顺序压参数入栈，由调用者把参数弹出栈。stdcall调用是把函数参数列表的前三个参数放入寄存器eax,edx,ecx</p>
<p>。返回值存储在EAX寄存器中。 stdcall是Microsoft Win32 API和Open Watcom C ++的标准调用约定。stdcall是微软win32 API和open Watcom C++的标准调用约定。</p>
<p>Shellcodes在网络安全领域起着非常重要的作用，它们被广泛应用于许多恶意软件和漏洞。那么，为什么shellcode会如此受到恶意程序的欢迎？&nbsp;</p>
<p>Shellcode实际是一段代码（也可以是填充数据），是用来发送到服务器利用特定漏洞的代码，一般可以获取权限。另外，Shellcode一般是作为数据发送给受攻击服务器的， Shellcode是溢出程序和蠕虫病毒的核心。</p>
<p>之所以命名为shellcode，是因为shellcode运行完以后都会返回一个命令行shell，但如今几乎所有的编译器生成的程序都能转化为shellcode。因为编写shellcode涉及到深入理解目标架构和操作系统的汇编语言。虽然我们可以在网上找到很多开源的shellcode，但为了达到不同的使用目的，每个安全研究员都会自己编写一个各自的shellcode，同时重新编写的过程也是理解shellcode的过程。</p>
<p>所以，本文的目标就是要教你如何在不同的检测环境下，重编自己的shellcode。</p>
<p><span style="font-size: 20px;"><strong>基本的Shellcode编程</strong></span></p>
<p>与Windows不同，为不同操作系统而编写的shellcode需要不同的编写方法，比如基于UNIX的操作系统提供了通过int 0x80接口与内核通信的直接方式，基于UNIX的操作系统中的所有系统调用都有唯一的编号，比如int 0x80就代表系统调用时设置中断向量号0x80的中断描述符，内核使用给定的数字和参数执行系统调用，但是这里会有一个问题，Windows系统并没有直接的内核接口，这意味着系统调用必须有精确内存地址（函数指针），但经过硬编码的函数地址并不能完全解决这个问题，因为Windows系统的每个函数地址会因为版本中甚至配置不同而发生变化，所以，shellcod e的编写一定要考虑系统的版本，如果要在Windows上编写不受系统版本影响的shellcode，我们只要解决地址问题，这可以通过在运行时动态地找到函数地址来实现。</p>
<p><span style="font-size: 20px;"><strong>解决寻址问题</strong></span></p>
<p>在本文中，我们将会使用解析PEB的方法来解决寻址的问题，简单来说，该方法就是使用PEB数据结构来定位基地址的加载DLL，从而解析出EAT及其函数地址，目前几乎所有的不受系统版本影响的shellcode的编写都是用这个技术得到Windows API函数地址的。</p>
<p>在解析PEB的方法中，我们利用“FS”段寄存器，“FS”段寄存器可以指向在微软系统环境中线程环境块（TEB）的基地址，TEB是在用户模式中分配和初始化的内存块，TEB耗用一个内存页（4KB），主要包括：线程异常处理链首、线程本地存储数据以及由GDI和OpenGL图形使用的一些数据结构，当在内存区运行shellcode时，我们需要将TEB向前偏移48字节，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817657448162.png" title="1489817657448162.png" alt="1.png"/><noscript><img src="/uploads/20170318/1489817657448162.png" title="1489817657448162.png" alt="1.png"/></noscript></p>
<p>如下图所示，现在我们就找到了PEB的结构体指针，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817666375900.png" title="1489817666375900.png" alt="1489817666375900.png" width="660" height="766" border="0" vspace="0" style="width: 660px;height: 766px"/><noscript><img src="/uploads/20170318/1489817666375900.png" title="1489817666375900.png" alt="1489817666375900.png" width="660" height="766" border="0" vspace="0" style="width: 660px;height: 766px"/></noscript></p>
<p>在获得PEB的结构体指针后，现在我们将PEB结构的起始位置向前偏移12个字节，以便获得PEB块内的LDR数据结构的地址，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817674855149.png" title="1489817674855149.png" alt="3.png"/><noscript><img src="/uploads/20170318/1489817674855149.png" title="1489817674855149.png" alt="3.png"/></noscript></p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817681890296.png" title="1489817681890296.png" alt="4.png"/><noscript><img src="/uploads/20170318/1489817681890296.png" title="1489817681890296.png" alt="4.png"/></noscript></p>
<p>LDR数据结构包含关于进程已加载模块的信息，如果我们把LDR数据结构再进一步移动20个字节，我们就可以获得进程dll中的 “InMemoryOrderModuleList” 加载模块，</p>
<p><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817689431862.png" title="1489817689431862.png" alt="5.png"/><noscript><img src="/uploads/20170318/1489817689431862.png" title="1489817689431862.png" alt="5.png"/></noscript></p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817694475663.png" title="1489817694475663.png" alt="6.png"/><noscript><img src="/uploads/20170318/1489817694475663.png" title="1489817694475663.png" alt="6.png"/></noscript></p>
<p>现在我们的指针指向InMemoryOrderModuleList，它是一个LIST_ENTRY结构，Windows将这个结构定义为一个“包含加载的进程模块的双向链表头”。列表中的每个项都是一个指向LDR_DATA_TABLE_ENTRY结构的指针，这个结构是我们的主要目标，它包含加载的DLL（模块）的全名和基地址，因为加载的模块的顺序可以改变，我们应该检查全名，以便选择正确的DLL，其中包含函数正在寻找，这可以很容易做到从LDR_DATA_TABLE_ENTRY开始向前移动40个字节，如果DLL名称匹配我们正在寻找的，我们可以继续，在LDR_DATA_TABLE_ENTRY内向前移动16个字节，我们现在终于有基地加载的DLL的地址，</p>
<p>现在PEB的指针指向了InMemoryOrderModuleList，InMemoryOrderModuleList是一个LIST_ENTRY结构，微软将其定义为“包含加载进程模块的双向链表头”。</p>
<p>由于InMemoryOrderModuleList字段是一个指针，指向LDR_DATA_TABLE_ENTRY 结构体上的LIST_ENTRY字段。但是它不是指向LDR_DATA_TABLE_ENTRY 起始位置的指针，而是指向这个结构的InMemoryOrderLinks字段。所以我们需要想办法让InMemoryOrderModuleList指向LDR_DATA_TABLE_ENTRY。</p>
<p>LDR_DATA_TABLE_ENTRY包含加载模块的所有地址和名称，因为模块加载的顺序可能改变，我们在加载的时候，应该校验加载模块的全名，以便选择包含我们要查找的函数的动态库。我们可以把LDR_DATA_TABLE_ENTRY向前位移40个字节，如果DLL名称匹配，则证明是我们需要的动态库，然后我们继续把LDR_DATA_TABLE_ENTRY向前位移16个字节，就能得到具有基地址的加载模块了。</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817704942020.png" title="1489817704942020.png" alt="7.png"/><noscript><img src="/uploads/20170318/1489817704942020.png" title="1489817704942020.png" alt="7.png"/></noscript></p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817712403663.png" title="1489817712403663.png" alt="8.png"/><noscript><img src="/uploads/20170318/1489817712403663.png" title="1489817712403663.png" alt="8.png"/></noscript></p>
<p>至此，我们就完成了获得函数地址的第一步，现在我们有了包含所需函数的DLL的基地址，所以，我们就必须解析DLL的导出地址表，以便能找到所需的函数地址，导出地址表位于能在PE头部的可选位置内，从基址向前移60个字节，我们就得到了含有DLL的PE头的内存地址，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817719611075.gif" title="1489817719611075.gif" alt="9.gif"/><noscript><img src="/uploads/20170318/1489817719611075.gif" title="1489817719611075.gif" alt="9.gif"/></noscript></p>
<p>最后我们需要用“模块基地址+ PE头地址+ 120字节”这个公式计算出地址表的地址，至此，地址表的地址就被导出了，在得到EAT地址后，我们就可以访问由DLL导出的所有函数，IMAGE_EXPORT_DIRECTORY的结构如下所示，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817727477200.gif" title="1489817727477200.gif" alt="10.gif"/><noscript><img src="/uploads/20170318/1489817727477200.gif" title="1489817727477200.gif" alt="10.gif"/></noscript></p>
<p>此结构包含导出函数的地址，名称和数量，使用相同大小的遍历统计计算，可以在此结构内获得所需的函数地址，当然，导出函数的顺序可能会因系统版本不同而异，因此我们要在获取函数地址之前，对函数名称进行校验，在确定函数名称之后，函数地址的计算就好比计算几个Windows数据结构的大小，因为你可以理解这个方法是关于计算几个Windows数据结构的大小，并在内存中遍历，不过在计算函数地址时，真正的挑战是要建立一个可靠的名称比较机制来选择正确的DLL和函数，如果PEB解析技术太难实现，我们还会为你介绍一种更简单的方法。</p>
<p><span style="font-size: 20px;"><strong>Hash API</strong></span></p>
<p>metasploit项目中几乎所有的shellcode都使用一个名为Hash API的汇编块，它是由Stephen Fewer编写的一段代码，自2009年被公布以来，大多数Windows的Windows shellcode就一直在使用它。这个汇编块使得解析PEB结构更容易，它使用基本的PEB解析逻辑和一些额外的Hash算法来快速找到所需的函数，通过计算ROR13函数和模块名的哈希值，可以让这个汇编块的使用起来更加容易，Hash API的汇编块使用stdcall调用约定时，所需的函数参数需要包含ROR13函数名的哈希值和包含该函数的DLL名，在得到我们所需要的参数和函数哈希值之后，如前面所述，这时就该解析PEB块，并找到模块名称了，然后计算ROR13哈希值并将其保存到堆栈，最后再把这个哈希值移动到DLL的导出地址表并计算每个函数名称的ROR13哈希值，ROR13哈希值等于每个函数名称哈希值和模块名称哈希值的和，&nbsp;</p>
<p>如果匹配到我们要找的哈希值，意味着想要的函数被找到了，最后Hash API会使用栈上的参数跳转到找到的函数地址执行。虽然我们最后会得到一段非常简洁实用的代码，但由于其广泛的使用，一些杀毒软件已经可以检测到它了，甚至连一些杀毒软件已经把使用ROR13哈希的列入到恶意程序黑名单了，不过配合使用一些编码机制，目前该方法还是能绕过杀毒软件的。</p>
<p>不过我们还是能找到其他方法来找寻找到API函数地址。</p>
<p><span style="font-size: 20px;"><strong>编码器和解码器的设计</strong></span></p>
<p>在开始设计之前，我们要先像大家讲清楚，单独使用这个编码器课不会产生完全不可检测的shellcode，因为在运行shellcode之后，解码器将直接运行并将整个shellcode解码为其原始形式，这当然不能绕过具有动态分析机制的杀毒软件了，</p>
<p>解码器逻辑非常简单，它将使用随机生成的多字节XOR键来解码shellcode，在解码操作之后它将执行它，在将shellcode放置在解码器头部之前，应该使用多字节XOR密钥加密， shellcode和XOR键应放在“&lt;Shellcode&gt;”，“&lt;Key&gt;”标签内，</p>
<p>解码器的逻辑非常简单，就是使用一个随机生成的多字节XOR密钥来解码shellcode，在解码操作完成后运行shellcode，在将shellcode放置在解码器头部之前，应该使用多字节XOR密钥来对shellcode加密，这时shellcode和XOR密钥就分别位于“&lt;Shellcode&gt;”和”&lt;Key&gt;”标签内。</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817741404015.png" title="1489817741404015.png" alt="1489817741404015.png" width="644" height="772" border="0" vspace="0" style="width: 644px;height: 772px"/><noscript><img src="/uploads/20170318/1489817741404015.png" title="1489817741404015.png" alt="1489817741404015.png" width="644" height="772" border="0" vspace="0" style="width: 644px;height: 772px"/></noscript></p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817751286115.png" title="1489817751286115.png" alt="11.2.png"/><noscript><img src="/uploads/20170318/1489817751286115.png" title="1489817751286115.png" alt="11.2.png"/></noscript></p>
<p>我们在此使用了JMP及CALL的指令来获得shellcode和密钥的地址，然后在shellcode和密钥的每个字节都要执行一次逻辑XOR操作，每次解密密钥运行到末尾时，JMP及CALL指令都会把密钥重置为起始地址，在完成解码操作之后，JMP及CALL指令将调用跳转到shellcode，使用字节更长的XOR密钥来增加shellcode的随机性，但如此反复的操作也增加代码块信息熵的大小。</p>
<p>因此要避免使用太长的解密密钥，经过我们的测试，使用基本的逻辑运算如XOR，NOT，ADD，SUB，ROR，ROL，就能得到几百种编码shellcode的方法，而这些经过编码的shellcode更是能产生无限可能的shellcode运行方式，杀毒软件在解码序列之前检测到shellcode的概率很低，不过自从杀软开发出了启发式引擎以后，就能够检测到shellcode的解密循环过程。目前，安全测试人员在编写shellcode编码器时，还没有能够找到用于绕过用于检测解码循环的静态方法的有效方式。</p>
<p><span style="font-size: 20px;"><strong>干扰寄存器的办法</strong></span></p>
<p>在x86架构中，所有寄存器都有特定的用途，例如ECX代表扩展计数器寄存器，它通常用作循环计数器，当我们在任何编译语言中编写一个基本循环条件时，编译器可能使用ECX寄存器作为循环计数器变量，这样代码块内连续增加的ECX寄存器就很容易触发杀毒软件的启发式引擎检测机制，解决这个问题的方法很简单，不把ECX寄存器用作循环计数器，但是这个办法对于所有的其它类型的代码片段（如函数epilogue/prologue等）也非常有效。由于很多代码识别机制取决于寄存器使用，所以我们可以通过干扰寄存器的办法来降低编写汇编代码时被检测到的风险。</p>
<p><span style="font-size: 20px;"><strong>垃圾混淆代码</strong></span></p>
<p>目前几乎每个杀毒软件都有办法来识别代码块内的解码器，据我们统计，大概有可能有几百种方法。但不管是哪种方法，最终都要生成用于静态地检查的代码块签名，所以为了避免被检测到，我们可以使用解码器代码内部的随机NOP指令来绕过静态签名分析，不过不一定非要使用NOP指令，可以是任何保持原始代码功能的指令，其目的最终是向代码块总添加垃圾指令，以打破代码块内的恶意签名，不过也要注意垃圾指令的大小，因为过多的垃圾混淆代码会让恶意程序的信息熵变大。</p>
<p>NOP指令的代码如下：</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817765370598.png" title="1489817765370598.png" alt="12.1.png"/><noscript><img src="/uploads/20170318/1489817765370598.png" title="1489817765370598.png" alt="12.1.png"/></noscript></p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817777413742.png" title="1489817777413742.png" alt="12.2.png"/><noscript><img src="/uploads/20170318/1489817777413742.png" title="1489817777413742.png" alt="12.2.png"/></noscript></p>
<p>从上图可以看出，唯一的改变在于EAX和ECX寄存器，由于在垃圾混淆代码时，负责对shellcode索引计数的寄存器是EAX，并且在每个XOR和MOV指令之间都会插入一些NOP填充，由于我们测试时使用的是 “windows/meterpreter/reverse_tcp ”命令，所以在加密之后shellcode有一个10字节长的随机XOR密钥，这些都会存放在解码器内，使用nasm -f bin Decoder.asm命令将解码器汇编成二进制格式（不要忘了移除shellcode中的换行符，否则nasm不能执行汇编命令）。</p>
<p>下面是杀毒软件对编码前的shellcode扫描的结果，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817788714621.png" title="1489817788714621.png" alt="13.png"/><noscript><img src="/uploads/20170318/1489817788714621.png" title="1489817788714621.png" alt="13.png"/></noscript></p>
<p>不出所料，大量的杀软扫描器能检测到编码之前的shellcode。让我们再来看看编码后的扫描结果，</p>
<p style="text-align: center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170318/1489817797115943.png" title="1489817797115943.png" alt="14.png"/><noscript><img src="/uploads/20170318/1489817797115943.png" title="1489817797115943.png" alt="14.png"/></noscript></p>
<p><span style="font-size: 20px;"><strong>巧妙利用杀软的缓解技术</strong></span></p>
<p>虽然可以用很多办法实现免杀，但杀软的防范漏洞缓解技术却将免杀的技术推向了一个全新的水平。微软在2009年发布了增强缓解体验工具包（EMET），EME是加固Windows防止恶意程序利用操作系统或软件安全漏洞的最有效方法之一，它有几个保护机制，</p>
<pre class="brush:html;toolbar:false">动态数据执行保护（DEP）
结构异常处理程序覆盖保护（SEHOP）
NullPage分配
堆喷射保护
导出地址表地址过滤（EAF）
强制ASLR
导出地址表访问过滤（EAF&nbsp;+）
ROP缓解措施
加载库检查
内存保护检查
调用者检查
堆栈翻转（Stack&nbsp;pivot）
Attack&nbsp;Surface&nbsp;Reduction（ASR）</pre>
<p>在这些缓解中，EAF，EAF +和调用者检查是我们最关注的三种技术，如前所述，metasploit框架中几乎所有的shellcode都使用Stephen Fewer的Hash API，并且由于Hash API应用了PEB 及EAT解析技术，EMET可以轻松检测和阻止shellcodes的运行 。</p>
<p><span style="font-size: 20px;"><strong>绕过EMET</strong></span></p>
<p>调用者检查可以检测到EMET内发生的Windows API调用，并阻止Win API函数中的RET和 JMP指令，以便阻止所有ROP方式的漏洞利用，在HASH API中，在找到需要的API函数地址后，会使用JMP指令执行函数，但这会触发EMET的调用者检查，所以为了绕过调用者检查，应该避免使用指向Win API函数的JMP和RET指令，我们要用CALL指令替换JMP指令来指向Win API函数，从理论上讲Hash API应该能绕过调用者检查，但是当我们查看EAF及EAF+缓解机制时，Hash API却使用被调用的代码阻止程序访问导出地址表（EAT），并且还会检查堆栈寄存器是否在允许的边界内，或者尝试检测特定代码块的MZ / PE报头和KERNELBASE，这是一种非常有效的用于防止EAT解析技术的方法，但EATEAT不是唯一一个包含函数地址的结构，由于导入地址表（IAT）也保存有应用程序使用的Win API函数地址，如果恶意应用程序获取了所需的函数，则可以收集IAT结构内的函数地址。一个名为Joshua Pitts的网络安全研究员最近开发了一种新的IAT解析方法，即在导入地址表中获取LoadLibraryA和GetProcAddress Windows API函数，在获取这些函数地址后，可以从任何库中提取任何函数。</p>
                <div class="foot_description" style="background-color: #fff;">
                    本文参考来源于pentest，如若转载，请注明来源于嘶吼：                        <a href="http://www.4hou.com/technology/3893.html" target=_blank>http://www.4hou.com/technology/3893.html</a>
                                    </div>


                 </p>
            </div>
            <div class="article_con">
                <!--文章内容-->
            </div>
            <div class="post-like">
                <a href="javascript:;" data-action="ding" target=_blank data-id="3893" class="favorite">
                <div class="zanbox">
                    <dd class="zanbefor"></dd>
                    <dd class="zanafter"></dd>
                </div>
                <span class="zantext">点赞</span>
                <span class="count">
            0</span>
                </a>
            </div>
            <div class="active_bottom">
                <ul>
                    <a class="Sina" href="http://service.weibo.com/share/share.php?url=http://www.4hou.com/technology/3893.html" title="分享到新浪微博" target="_blank"><li class="sinahover"></li></a>
                    <a onclick="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+encodeURIComponent(document.location.href));return false;" title="分享到QQ空间" class="WeChat" href="javascript:void(0)" target="_blank"><li class="kj"></li></a>
                    <a onclick="dashangToggle()" class="friend" title="分享到微信、朋友圈等" target="_blank"><li class="wx"></li></a>

                </ul>
                <div class="strat icons"><span class='wpfp-span'><img src='http://img.4hou.com/wp-content/plugins/wp-favorite-posts/img/star.png' alt='Favorite' title='Favorite' class='wpfp-img' /><a class='wpfp-link' href='?wpfpaction=add&amp;postid=3893' title='收藏' rel='nofollow'>收藏</a></span></div>
                <div class="hide_box"></div>
                <div class="shang_box">
                    <a class="shang_close" href="javascript:void(0)" onClick="dashangToggle()" title="关闭"><img src="http://img.4hou.com/wp-content/themes/4houv2/images/close.jpg" alt="取消" /></a>
                    <img class="shang_logo" width="120px" src="http://img.4hou.com/wp-content/themes/4houv2/images/logo.png" alt="嘶吼" />
                    <div class="shang_tit">
                        <p>感谢您的支持，我会继续努力的!</p>
                    </div>
                    <div class="shang_payimg">
                        <img src="http://www.4hou.com/wp-content/themes/4houv2/qrcode.php?url=http%3A%2F%2Fwww.4hou.com%2Ftechnology%2F3893.html" alt="扫码支持" title="扫一扫" />
                    </div>

                    <div class="shang_info">
                        <p>打开<span id="shang_pay_txt">微信</span>扫一扫后点击右上角即可分享哟</p>
                    </div>
                </div>
            </div>
            
            <div class="avatarbottomwrap">
                 <div class="avatarboxleft">
                        <div class="avatarbottom">
                           
                            <a class="upload-img"><img alt='xiaohui' src='http://img.4hou.com/wp-content/uploads/2017/06/4645ece03f124d9c2bb9-96x96.png' class='avatar avatar-96 photo' height='96' width='96' /></a>
                        </div>
                        <h1 class="authornamebottom"><a href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                                xiaohui                                                            <i class="mem_level"></i>
                             </a></h1>
                        <p class="authorzybottom">嘶吼编辑</p>

                        <div class="authorbottombox">
                            <!--<div class="gzbtn">关注</div>
                            <div class="sxbtn">私信</div>-->
                                                            <span class="gzbtn"  style="cursor: pointer;" onclick="location.href='/mybox?action=reply&to_user=xiaohui&type=send'">发私信</span>
                                                    </div>
                 </div>
                <div class="authorother">
                 <a class="morearticle" href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                             </a>
                    <div class="swiper-container">

                                                    <div class="swiper-wrapper">
                               
                                <div class="swiper-slide">
                                                                        <div><a href="http://www.4hou.com/technology/7667.html" target=_blank>
                                            <img data-original="/uploads/20170915/1505460611763833.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7638.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/dcf441e3e17ab9ef68ff.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7657.html" target=_blank>
                                            <img data-original="/uploads/20170915/1505404839986320.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7600.html" target=_blank>
                                            <img data-original="/uploads/20170908/1504854270386868.png?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                    </div>
                            </div>
                                        </div>
                </div>
                <script type="text/javascript">
                    function dashangToggle(){
                        $(".hide_box").fadeToggle();
                        $(".shang_box").fadeToggle();
                    }
                </script>
                <script> 
                    var mySwiper = new Swiper('.swiper-container', {
                        direction : 'vertical',
                        pagination : '.swiper-pagination',
                        paginationClickable :true,
                        spaceBetween : 20
                    })
                </script>
            </div>
                            <div class="review" style="margin-bottom:80px;">
    <h3 id="reply-title" class="comment-reply-title">发表评论 <small></h3>
    <form action="http://www.4hou.com/wp-comments-post.php" method="post" id="commentform">
        <p class="commentname"><label for="author">昵称</label>
            <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p>
        <p class="commenteml">
            <label for="email">邮箱</label>
            <input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required />
        </p>
        <p class="comment-form-comment">
           <label for="comment">评论</label>
           <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea>
        </p>

        <p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
        <input type='hidden' name='comment_post_ID' value="3893" id='comment_post_ID' />
            <input type='hidden' name='comment_parent' id='comment_parent' value='0' />
        </p>
    </form>
					
<div class="new-review">
   <ol class="commentlist">
      </ol>
   <div class="hr clearfix">&nbsp;</div>
</div>
</div>             
        </article>

        <!--作者其他文章-->
        <aside class="article_authorbox">
          <div class="article_authorbox_top">
                <div class="article_author">
            <div class="article_author_avatar">
                 <a class="upload-img"><img alt='xiaohui' src='http://img.4hou.com/wp-content/uploads/2017/06/4645ece03f124d9c2bb9-96x96.png' class='avatar avatar-96 photo' height='96' width='96' /></a>
            </div>
            <h1 class="article_author_name"><a href="http://www.4hou.com/member?Author=xiaohui" class="upload-img" target=_blank>
                    xiaohui                                    <i class="mem_level"></i>
                </a></h1>
            <p class="article_author_type">嘶吼编辑 </p>
            <div class="article_author_bottom">
                                        <span class="send-info" onclick="location.href='/mybox?action=reply&to_user=xiaohui&type=send'">发私信</span>
                         
            </div>
          </div>  
            <div class="interested">
                <h1>可能喜欢</h1>
                                                    <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7667.html" target="_blank">小心找工作时被挖坑，有人利用 LinkedIn 发送钓鱼链接</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7653.html" target="_blank">一次服务器被攻击的应急行动</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7646.html" target="_blank">一个Tor浏览器0day漏洞价值100万美元，其中的隐情是……</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7660.html" target="_blank">Elasticsearche僵尸网络：超过4000台服务器遭到两款POS 恶意软件感染</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7669.html" target="_blank">渗透挑战赛：从SQL注入到管理员权限</a> 
                </li> 
                                                </div>
       </div>

          
        </aside>
    </section>
    <div id="zooming">
        <img src="" id="imgcon">
    </div>
    <script>
        $(document).ready(function() {
            $.fn.postLike = function() {
                if ($(this).hasClass('done')) {
                    return false;
                } else {
                    $(this).addClass('done');
                    var id = $(this).data("id"),
                        action = $(this).data('action'),
                        rateHolder = $(this).children('.count');
                    var ajax_data = {
                        action: "bigfa_like",
                        um_id: id,
                        um_action: action
                    };
                    $.post("/wp-admin/admin-ajax.php", ajax_data,
                        function(data) {
                            $(rateHolder).html(data);
                        });
                    return false;
                }
            };
            $(document).on("click", ".favorite",
                function() {
                    $(this).postLike();
                });


            $("img").attr("title","");
            var altcon=$(".art_title").text();
            $("img").attr("alt",altcon);
            // 图片放大
            $(".article_cen").find('img').on("click",function(){
                var imgsrc=$(this).attr("src");
                var winthimg=$(this).width();
                var zooming=winthimg*1.2;
                $("#imgcon").css({width:zooming});
                $("#imgcon").css({marginLeft:-zooming/2});
                $("#imgcon").attr("src",imgsrc);
                $("#zooming").addClass("zoomaniatae");
                $("#imgcon").addClass("imgconadimate");
            });
            $("#zooming").on("click",function(){
                $("#imgcon").removeClass("imgconadimate");
                $("#zooming").removeClass("zoomaniatae");

            });

            $(window).scroll(function(){
                var scrtop=$(window).scrollTop();
                if(scrtop>450){
                    $(".article_authorbox_top").removeClass("asideanimateleave").addClass('asideanimate')
                    // $(".interested").hide()
                }
                else if(scrtop<450&&scrtop>350){
                     $(".article_authorbox_top").addClass("asideanimateleave").removeClass('asideanimate')
                     $(".interested").show()

                }
            });
            var start=$(".strat .wpfp-span .wpfp-link").text()
            if(start=="已收藏"){
                $(".strat").addClass("stratend")
            }else{
                $(".strat").removeClass("stratend")
            }

            $(".avatar-96").width(72);
            $(".avatar-96").height(72);
            $(".avatar-120").width(50);
            $(".avatar-120").height(50);

        });
    </script>
<style type="text/css">
.footer{height:auto; background-color: #282828}
.footer_about{width: 1200px;height: 50px;padding-top: 26px; margin: 0 auto;border-bottom-color: transparent !important; position: relative;}
.footer_about>a{font-size: 16px;height: 16px !important;line-height: 16px !important; float: left; padding-right: 18px; border-right:1px solid #ccc;}
.last-child-a{border:none !important}
.footer_bottom_cen p{ margin-top: 5px; margin-right: 25px;text-align: left; margin-bottom: 6px;float: left;}
.footer_bottom_cen>div{width: 450px;float: left;margin-right: 8px}
.footer_bottom{height: 74px}
.footerlogos{width: 130px; height: 24px; position: absolute;right: 10%; top:24px;}
.footerlogos dd{float: left; margin-right: 20px;cursor: pointer;}
.footerlogos dd a{display: block;width: 100%; height: 100%}
.wechartlogo{width: 20px; height: 20px; background-position:-227px 0px;}
.weibologo{width: 20px; height: 20px; background-position:-269px 0px;}
.zhihulogo{width: 20px; height: 20px; background-position:-361px 0px;}
.wechartlogo i{width: 80px;height: 78px;background-size: contain !important; right: 137px;display: none;opacity: 1;background: url(http://www.4hou.com/wp-content/themes/4houv2/img/wechatqr.png) no-repeat;position: absolute;top: -28px;}
.wechartlogo:hover i{display: block;}
.footer_bottom{width: 1200px; background-color: #282828; margin:0 auto } 
.footer_bottom_cen>div img{float: left; margin-right: 4px;margin-top: 4px; margin-left: 4px;width: 66px;}
.footer_bottom_cen{width: 100%}
.cloudserver{float: right !important; margin: 0 auto !important;width: 385px !important; margin-top: -31px}
.cloudserver img{float: left;}
.cloudserver dd{float: left;}
@media screen and (max-width:1260px) {
    .footer{width: 100%; padding: 0px 20px;}
    .footer_about{width: 100%}
    .footer_bottom{width: 100%}
    .footer_bottom div{width: 100%;display: none;}
}
@media screen and (max-width:660px) {
    .footer_about{padding-top: 14px; margin-bottom: 22px;}
    .footerlogos{display: none;}
    .footer_bottom{height: 44px;}

}
</style>
<footer class="footer">
    <div class="footer_about">
        <a href="/about" target=_blank>关于我们</a>
        <!--<a href="">加入我们</a>-->
        <a href="/submit" target=_blank>我要投稿</a>
        <a href="/service" target=_blank>广告及服务</a>
        <a href="/partner" target=_blank class="last-child-a">友情链接</a>
        <div class="footerlogos">
                <dd class="wechartlogo icons">
                  <i></i>
                </dd>
                <dd class="weibologo icons">
                 <a href="http://weibo.com/u/6069423878" target=_blank></a>
                </dd>
                <dd class="zhihulogo icons">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank></a>
                    
                </dd>
        </div>
    </div>

    <section class="footer_bottom">
        <article class="footer_bottom_cen">
            <p>©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;&nbsp;京ICP备16063439号</p>
            <p class="mobilefooter">©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;|&nbsp;&nbsp;京ICP备16063439号</p>
            <div class="cloudserver">
                <span>本站由</span>
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud1.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/ucloud.png">
                <span>提供云计算服务</span>
            </div>
        </article>
    </section>
    <section class="footer_top" style="display:none">
        <article class="footer_top_cen">
            <div class="homeqrcode">
                <dd class="icons"></dd>
                <div class="wb">
                    <a href="http://weibo.com/u/6069423878" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼传媒</p>
                    </a>
                </div>

                <div class="sh">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼</p>
                    </a>
                </div>
            </div>
            
            <h1>合作伙伴</h1>
            <div class="footer_friend">
                <a href="http://www.xinhuanet.com/talking/chinasafety/" target=_blank>新华网安全中国</a>
                <a href="http://jaq.alibaba.com/" target=_blank>阿里聚安全</a>
                <a href="http://www.seclover.com/" target=_blank>四叶草安全</a>
                <a href="https://sec.vip.com/" target=_blank>唯品会安全应急响应中心</a>
                <a href="https://www.duoyinsu.com/" target=_blank>安识科技</a>
                <a href="http://xianzhi.aliyun.com" target=_blank>云盾先知</a>
                <a href="http://www.ardsec.com/" target=_blank>兴华永恒</a>
                <a href="https://www.sobug.com/" target=_blank>SOBUG</a>
            </div>
        </article>
    </section>
    
</footer>
<aside class="side" >
    <div class="side_top icons "></div>
    <div class="iconbox">
        <div class="side_wechart icons iconhover">微信
            <dd></dd>
        </div>
        <a href="http://weibo.com/u/6069423878" target=_blank><div class="side_webo icons iconhover">微博</div></a>
        <a href="http://www.4hou.com/feed/" target=_blank><div class="side_rss icons iconhover">RSS</div></a>
        <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank><div class="side_zh icons iconhover">知乎</div></a>
    </div>
    <div class="side_bottom icons"></div>
    
</aside>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ac201c14c3d2a4747423252be421e1bc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-91554508-1', 'auto');
    ga('send', 'pageview');

</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</body>
</html>