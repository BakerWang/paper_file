<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>保护内网域安全之扫描Active Directory特权和特权帐户（二） - 嘶吼 RoarTalk &#8211; 回归最本质的信息安全,互联网安全新媒体,4hou.com</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta property="wb:webmaster" content="4517e8fe39b18975" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="description" content="大多数组织使用组策略将Active Directory组添加到计算机上的本地组中（通常为管理员组）。使用PowerView，我们可以轻松发现在工作站和服务器上具有管理权限的AD组（这是非常典型的用例）。在下面的截图中，我们看到…" />
    <meta name="keywords" content="Active Directory 安全, 内网渗透" />
        <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon.ico" rel="shortcut icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_114.png" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_76.png" sizes="76x76" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_120.png" sizes="120x120" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_152.png" sizes="152x152" rel="apple-touch-icon">

    <!-- 引入 lib -->
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/jquery.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.jquery.min.js"></script>
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.min.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <!--[if lt IE 11]>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/html5shiv.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/respond.js"></script>
    <![endif]-->
    <!-- 引入 css js -->
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/css/style.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/public.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/main.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/index-more.js"></script>
    </head>
<body>
<style type="text/css">
.memberlistanimate{width: 122px}
.memberlistanimateleave{width: 122px}
.nameheader{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width: 78px;display: block;}
</style>

<header class="header">
            <article class="header_center">
                <div class="logowrap">
            <a href="http://www.4hou.com"><div class="logo icons"></div></a>
            <h1>回归最本质的信息安全</h1>
        </div>
        <div class="login">
            <form action="/" class="navbar-form inSearch " name="searchform" onsubmit="return checksubmit()">
                <div class="br">
                    <span class="in-btn icons"></span>
                    <input type="text" name="s" id="search" class="animated">
                    <div class="clear icons"></div>
                </div>
                <div id="submitBtnplace" class="icons animated" value=""></div>
                <!--<input type="submit" id="submitBtn" class="icons animated" value="">-->
            </form>
                            <!--登录注册按钮-->
                 <div id="register">
                     <a href="http://www.4hou.com/register" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">注册</a>
                 </div>
                 <div id="sing">
                      <a href="http://www.4hou.com/login" class="pzh_login">登录</a>
                 </div>

                 <div class="burger2 menu" id="burger">
                  <div class="icon"></div>
                 </div>

            
           <!-- <div id="register">注册</div>
            <div id="sing">登录</div>
            <div class="burger2 menu" id="burger">
                <div class="icon"></div>
            </div>-->
        </div>
    </article>
</header>
<nav class="navbox animated">
    <section class="navbox_cen">
        <article class="navboxleft">
            <ul class="nav navbar-nav index-nav" id="inNav">
					<li>
							<li class="cat-item cat-item-18"><a href="http://www.4hou.com/category/info" >资讯</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://www.4hou.com/category/technology" >技术</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://www.4hou.com/category/xactivity" >活动</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://www.4hou.com/category/vulnerable" >漏洞</a>
</li>
					</li>
                    <li class="cat-item cat-item-29"><a href="http://www.4hou.com/piao" >嘶票</a>
                    </li>
            </ul>
        </article>
        <article class="navboxright">
            <div class="contrib"> <a href="http://www.4hou.com/contribute" class="tougao" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">投稿</a></div>
        </article>
    </section>
</nav>
<div id="modelbg"></div>
    <style>


    ::selection {
    background:#fea283;
    color:#fff;
}
::-moz-selection {
    background:#fea283;
    color:#fff;
}
::-webkit-selection {
    background:#fea283;
    color:#fff;
}


        .article_cen p img{height: auto !important;}
        .commentlist .children{width: 90%; padding-right: 15px; border-color: transparent ;}
        .commentname,.commenteml{width: 60%; margin-left:5% ;margin-bottom: 30px;border-bottom: 1px solid #dbdbdb;}
        .article_cen ol li{list-style-type: decimal;}
         .article_cen ol li p{overflow: inherit;}
        .commentname label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commentname input{width: 50%;border: none; outline: none;}
        .commenteml label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commenteml input{width: 50%;border: none; outline: none;}
        #zooming{display: none;width: 100%;height: 100%; position: fixed;z-index: 999;left: 0px; top: 0px; background-color: rgba(0,0,0,.6);}
        .zoomaniatae{display: block !important;}
        .imgcon{}
        #imgcon{position: absolute;left: 50%; top: 20%;max-width: 80%}
        .article_cen img{cursor: pointer;}
        #zooming{cursor: pointer;}
        .imgconadimate{animation:imgcon 0.5s 1 forwards;
        -webkit-animation:imgcon 0.5s 1 forwards;}
        .article_authorbox{    width: 222px;min-height: 214px;
        padding-bottom: 20px;
        float: right;
        position: relative;}
        .interested{position: relative;}
        .interested>h1{font-size: 18px; font-weight: 900; position: absolute; top: -36px;color: #5e5e5e}
       .user-comment span{font-size: 13px; position: relative; top: 2px;}
        .article_authoradd{position: fixed;}
        .stratend{background:url(http://www.4hou.com/wp-content/themes/4houv2/img/starend.png); !important;background-size: contain !important;}
        .wpfp-span{opacity: 0;width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-link{width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-span img{display: none;}
        .interested{width: 222px;padding-bottom: 20px;background-color: #fff;margin-top: 70px; padding-bottom: 10px; padding-top: 10px;border: 1px solid #f5c2b1}
        .interested li{width: 100%;position: relative;padding-top: 8px; padding-bottom: 8px;  line-height: 24px; padding-left: 20px;padding-right: 14px}
        .interested li i{width: 6px;height: 6px;border-radius: 50%; background-color: #f63;position: absolute; left: 8px; top: 18px;}
        .interested li a{color: #666;font-size: 14px; line-height: 18px;}
        .interested li:hover{background-color: #f9e7e3;-moz-transition: all 0.4s ease-in-out;
        .footer{position: relative;z-index: 99}   
        .article_authorbox_top{position: relative;} 
        

        -o-transition: all 0.4s ease-in-out; -webkit-transition: all 0.4s ease-in-out; transition: all 0.4s ease-in-out;}
    
        @-webkit-keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        @keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        .asideanimate{animation:asideanimate 1s 1 forwards;
        -webkit-animation:asideanimate 1s 1 forwards; position: fixed;}
        @-webkit-keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        @keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        .asideanimateleave{animation:asideanimateleave 1s 1 forwards;
        -webkit-animation:asideanimateleave 1s 1 forwards;}
        @-webkit-keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @media screen and (max-width:650px) {
            .member_list{right: -30px !important;top: 34px !important;}
            .article_authorbox{display: none;}
            .nameheader{display: none;}
            .shang_box{width: 90%; margin-left:-45% }
            #imgcon{width: 90% !important; margin-left: -45% !important;max-width: inherit !important}
            .dy{padding: 12px 15px!important;font-size: 14px !important; line-height: 22px !important;}
        }
        .article_author{float:none !important;padding-top: 1px;}
        .article_cen pre{color: #666 !important; line-height: 26px; background-color: #f1f1f1}
        .articlecontent blockquote>p{ color: #666; font-size: 16px; }
    </style>
    <section class="articlewrap">
        <article class="articlecontent">
            <div class="article_top">
                <h1 class="art_title">保护内网域安全之扫描Active Directory特权和特权帐户（二）</h1>
                <p class="art_time">2017年7月28日发布</p>
                <div class="art_nav">
                    <!--<a href="">翻译文章</a>
                    <span>／</span>
                    <a href="">新闻</a>
                    <span>／</span>
                    <a href="">原创</a>-->
                                        <a href="http://www.4hou.com">首页 </a></a>
                    <span>／</span>
                    <a href="http://www.4hou.com/category/penetration">内网渗透</a>
                    <span>／</span>
                    <a href="">正文</a>

                    </ul>
                </div>
                <div class="art_type">
                    <div class="newtype">
                        <div class="read ">
                            <i class="icons"></i>
                            <span>13,630</span>
                        </div>
                        <div class="comment ">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                        <div class="Praise">
                            <i class="icons"></i>
                            <span>5</span>
                        </div>
                    </div>
                </div>
            </div>
             <p class="dy" style="padding: 24px 60px;font-size: 16px;line-height: 30px;color: #808080;background-color: #f6f6f6;"><span style="font-weight: bold;">导语：</span>大多数组织使用组策略将Active Directory组添加到计算机上的本地组中（通常为管理员组）。使用PowerView，我们可以轻松发现在工作站和服务器上具有管理权限的AD组（这是非常典型的用例）。</p>

            <div class="article_cen">
                <!--文章摘要-->
               
                <p><p style="text-align: left;">大多数组织使用组策略将Active Directory组添加到计算机上的本地组中（通常为管理员组）。使用PowerView，我们可以轻松发现在工作站和服务器上具有管理权限的AD组（这是非常典型的用例）。</p>
<p style="text-align: left;">在下面的截图中，我们看到企业组织已经配置了以下GPO：</p>
<p style="text-align: left;">GPO：“将服务器管理员添加到本地管理员组”&nbsp;<br /> 本地组：管理员组<br /> AD组：服务器管理员（示例中显示了SID）</p>
<p style="text-align: left;">GPO：“将工作站管理员添加到本地管理员组”&nbsp;<br /> 本地组：管理员组<br /> AD组：工作站管理员（示例中显示了SID）</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682483454408.png" title="1497682483454408.png" alt="1497682483454408.png" width="700" height="334" border="0" vspace="0" style="width: 700px; height: 334px;"/><noscript><img src="/uploads/20170617/1497682483454408.png" title="1497682483454408.png" alt="1497682483454408.png" width="700" height="334" border="0" vspace="0" style="width: 700px; height: 334px;"/></noscript></p>
<p style="text-align: left;">我们还可以使用PowerView来确定哪些AD组对OU具有对计算机的管理权限。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682492855671.png" title="1497682492855671.png" alt="1497682492855671.png" width="700" height="281" border="0" vspace="0" style="width: 700px; height: 281px;"/><noscript><img src="/uploads/20170617/1497682492855671.png" title="1497682492855671.png" alt="1497682492855671.png" width="700" height="281" border="0" vspace="0" style="width: 700px; height: 281px;"/></noscript></p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>Active Directory对象权限（ACL）</strong></span></p>
<p style="text-align: left;">与文件系统权限类似，Active Directory对象也具有权限。</p>
<p style="text-align: left;">这些权限称为访问控制列表（ACL）。设置对象的权限使用了一种名为<a href="https://blogs.technet.microsoft.com/askds/2008/04/18/the-security-descriptor-definition-language-of-love-part-1/" target="_blank" textvalue="安全描述符定义语言">安全描述符定义语言</a>&nbsp;<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd981030(v=vs.85).aspx">（SDDL</a>）的隐晦格式，如下所示：</p>
<pre class="brush:html;toolbar:false">D：PAI（D;&nbsp;OICI;&nbsp;FA&nbsp;;;;&nbsp;BG）（A;&nbsp;OICI;&nbsp;FA&nbsp;;;;&nbsp;BA）（A;&nbsp;OICIIO;&nbsp;FA&nbsp;;;;&nbsp;CO）（A;&nbsp;OICI;&nbsp;FA&nbsp;;;;&nbsp;SY）（A;&nbsp;OICI;&nbsp;FA&nbsp;;;;&nbsp;BU）</pre>
<p style="text-align: left;">上述格式是由GUI翻译，以提供更方便友好的使用格式（见下面的屏幕截图）。</p>
<p style="text-align: left;">每个Active Directory对象都具有在其上配置的权限，显式定义或从其父对象继承（通常为OU或域），并且可以将权限定义为允许或拒绝对象及其属性的权限。</p>
<p style="text-align: left;">执行<a href="https://trimarcsecurity.com/security-services" target="_blank" textvalue="Active Directory安全性评估">Active Directory安全性评估</a>时，我们扫描Active Directory的AD ACL，并根据AD对象（如域，OU，安全组等）上的委派来识别具有特权权限的帐户或用户组。</p>
<p style="text-align: left;">Active Directory中的每个对象都具有应用于其本身的默认权限，以及继承和任何显式权限。默认情况下，Authenticated Users对AD中的对象具有读权限，因此可以轻松地收集其大多数属性和对象，AD对象及其属性和定义的权限。</p>
<p style="text-align: left;">关于AD ACL的一个简要说明。系统容器中有一个名为“&nbsp;<a href="https://adsecurity.org/?p=1906" target="_blank" textvalue="AdminSDHolder">AdminSDHolder</a>&nbsp;”&nbsp;的对象，它只有一个目的：成为域中具有高级权限的对象（及其成员）的权限模板对象。</p>
<p style="text-align: left;">·SDProp Protected Objects (Windows Server 2008 &amp; Windows Server 2008 R2):</p>
<pre class="brush:html;toolbar:false">Account&nbsp;Operators
Administrator
Administrators
Backup&nbsp;Operators
Domain&nbsp;Admins
Domain&nbsp;Controllers
Enterprise&nbsp;Admins
Krbtgt
Print&nbsp;Operators
Read-only&nbsp;Domain&nbsp;Controllers
Replicator
Schema&nbsp;Admins
Server&nbsp;Operators</pre>
<p style="text-align: left; margin-top: 15px;">大约每60分钟，PDC模拟器会运行一个进程来枚举所有这些受保护的对象及其成员，然后标记<a href="https://adsecurity.org/?p=1906" target="_blank" textvalue="AdminSDHolder">AdminSDHolder</a>对象上配置的<a href="https://adsecurity.org/?p=1906" target="_blank" textvalue="权限">权限</a>（并将admin属性设置为1）。这确保了特权组和帐户能够受到保护，免受不当的AD权限委派。</p>
<p style="text-align: left;">在AD对象的自定义权限的检查是非常困难的。例如，下图显示了OU上的权限。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682506119965.png" title="1497682506119965.png" alt="1497682506119965.png" width="700" height="516" border="0" vspace="0" style="width: 700px; height: 516px;"/><noscript><img src="/uploads/20170617/1497682506119965.png" title="1497682506119965.png" alt="1497682506119965.png" width="700" height="516" border="0" vspace="0" style="width: 700px; height: 516px;"/></noscript></p>
<p style="text-align: left;">这个OU的委派有一个严重的问题，下图中高亮显示的部分。<br /> 从下图可以看到具有完全控制权限的域控制器授权给了此OU的所有对象及其中包含的所有对象。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682516503937.png" title="1497682516503937.png" alt="1497682516503937.png" width="700" height="516" border="0" vspace="0" style="width: 700px; height: 516px;"/><noscript><img src="/uploads/20170617/1497682516503937.png" title="1497682516503937.png" alt="1497682516503937.png" width="700" height="516" border="0" vspace="0" style="width: 700px; height: 516px;"/></noscript></p>
<p style="text-align: left;">攻击者<a href="https://msdn.microsoft.com/en-us/library/system.directoryservices.activedirectoryrights(v=vs.110).aspx" target="_blank" textvalue="对提供特权操作">对提供特权操作</a>的权限最感兴趣。这些ACL包括如下几个：</p>
<p style="text-align: left;">·&nbsp;<a href="https://msdn.microsoft.com/en-us/library/ms684355(v=vs.85).aspx" target="_blank" textvalue="Replicating Directory Changes All">Replicating Directory Changes All</a>：<a href="https://msdn.microsoft.com/en-us/library/ms683985(v=vs.85).aspx" target="_blank" textvalue="扩展权限">扩展权限</a>，提供复制对象的所有数据的能力，包括密码数据（我称之为域控制器模拟权限），可为AD用户和计算机“<a href="https://adsecurity.org/?p=1729" target="_blank" textvalue="&nbsp;DCSync">&nbsp;DCSync</a>&nbsp;”密码数据提供“<a href="https://adsecurity.org/?p=1729" target="_blank" textvalue="&nbsp;DCSync">&nbsp;DCSync</a>&nbsp;”功能。示例：FIM，Riverbed，SharePoint和其他应用程序通常<a href="https://support.microsoft.com/en-us/help/303972/how-to-grant-the-replicating-directory-changes-permission-for-the-microsoft-metadirectory-services-adma-service-account" target="_blank" textvalue="在根域上授予权限给这些服务的服务账户">在根域上授予权限给这些服务的服务账户</a>。如果攻击者可以猜测到该密码（或者可能通过<a href="https://adsecurity.org/?p=3458" target="_blank" textvalue="&nbsp;Kerberoasting破解">&nbsp;Kerberoasting破解</a>），那么他们现在就拥有该域的控制权限，因为它们可以为所有AD用户和计算机（包括域管理员和域控制器）提供DCSync密码散列。</p>
<p style="text-align: left;">·&nbsp;GenericAll：GenericAll =完全控制<br /> 权限创建或删除子项，删除子树，读取和写入属性，检查子对象和对象本身，从目录中添加和删除对象，并使用扩展权限进行读取或写入。<br /> 它提供对象和所有属性的完整权限，包括LAPS本地管理员密码和BitLocker恢复密钥等机密属性。在许多情况下，不需要完全控制权，但是比确定所需的实际权利更容易进行委派和工作。<br /> 示例：服务器组可以被委派给具有计算机对象与服务器关联的OU中的所有计算机对象上的完全控制。</p>
<p style="text-align: left;">·&nbsp;&nbsp;GenericWrite：提供对所有属性的写访问权限。<br /> 有权读取此对象的权限，写入此对象上的所有属性，并对该对象执行所有验证的写入。</p>
<p style="text-align: left;">·&nbsp;&nbsp;WriteDACL：提供修改对象上的安全性的能力，可以导致对象的完全控制。<br /> 在对象安全描述符中修改DACL的权限。<br /> 示例：可以授予服务帐户在AD中执行授权的权利。如果攻击者可以猜测到这个密码（或者可能通过Kerberoasting来破解它），那么他们现在就可以对关联的对象设置自己的权限，这些权限可以导致完全控制一个可能涉及LAPS受控本地管理员密码的对象。</p>
<p style="text-align: left;">·&nbsp;Self：&nbsp;&nbsp;提供执行<a href="https://msdn.microsoft.com/en-us/library/cc223513.aspx" target="_blank" textvalue="验证写入">验证写入</a>的能力。<br /> 执行受验证的写入权限控制的操作的权利。<br /> 验证的写入包括以下属性：</p>
<pre class="brush:html;toolbar:false">Self-Membership(bf9679c0-0de6-11d0-a285-00aa003049e2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;member&nbsp;attribute)
Validated-DNS-Host-Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(72e39547-7b18-11d1-adef-00c04fd8d5cd&nbsp;/&nbsp;dNSHostName&nbsp;attribute)
Validated-MS-DS-Additional-DNS-Host-Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(80863791-dbe9-4eb8-837e-7f0ab55d9ac7&nbsp;/&nbsp;msDS-AdditionalDnsHostName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attribute)
Validated-MS-DS-Behavior-Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(d31a8757-2447-4545-8081-3bb610cacbf2&nbsp;/&nbsp;msDS-Behavior-Version&nbsp;attribute)
Validated-SPN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(f3a64788-5306-11d1-a9c5-0000f80367c1&nbsp;/&nbsp;servicePrincipalName&nbsp;attribute)</pre>
<p style="text-align: left;">·&nbsp;&nbsp;WriteOwner：：提供获取对象所有权的功能。对象的所有者可以获得对象的<a href="https://technet.microsoft.com/en-us/library/dd125370(v=ws.10).aspx" target="_blank" textvalue="完全控制权限">完全控制权限</a>。<br /> 承担对象所有权的权利。用户必须是对象受托人。用户无法将所有权转让给其他用户。</p>
<p style="text-align: left;">·&nbsp;WriteProperty：通常与特定属性/属性信息配对。示例：委托帮助台用户组修改特定AD对象属性（如成员（修改组成员身份）），“显示名称”，“描述”，“电话号码”等）的功能。</p>
<p style="text-align: left;">·&nbsp;&nbsp;CreateChild：提供创建指定类型（或“全部”）对象的功能。</p>
<p style="text-align: left;">·&nbsp;&nbsp;DeleteChild：提供删除指定类型（或“全部”）对象的功能。</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://msdn.microsoft.com/en-us/library/ms683985(v=vs.85).aspx" target="_blank" textvalue="扩展权限">扩展权限</a>：这是一个有趣的权限，因为它如果提供了明显超出范围的附加权限。示例：对计算机对象的所有扩展权限都<a href="https://adsecurity.org/?p=3164" target="_blank" textvalue="可以提供对LAPS本地管理员密码属性的读访问权限">可以提供对LAPS本地管理员密码属性的读访问权限</a>。</p>
<p style="text-align: left;">Andy Robbin的（<a href="https://twitter.com/_wald0">@ _Wald0</a>）<a href="https://wald0.com/?p=112" target="_blank" textvalue="博文描述了这些权限可以被滥用的一些方式">博文描述了这些权限可以被滥用的一些方式</a>。</p>
<p style="text-align: left;">创建和链接域中的GPO的能力应被视为有效的域管理员权限，因为它提供了修改安全设置，安装软件，配置用户和计算机登录（以及启动/关闭）脚本以及运行命令的能力。</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/cc978262.aspx">管理组策略链接</a>（LinkGPO）：提供将Active Directory中的现有组策略对象链接到定义权限的域，OU或站点的功能。默认情况下，GPO创建者的所有者拥有此权限。</p>
<p style="text-align: left;">·&nbsp;&nbsp;创建GPO：默认情况下，AD组的组策略创建者的所有者拥有此权限。可以通过组策略管理控制台（GPMC）进行委派。</p>
<p style="text-align: left;">PowerView提供了搜索AD权限以获取更多有趣权限的功能。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682527606053.png" title="1497682527606053.png" alt="1497682527606053.png" width="700" height="387" border="0" vspace="0" style="width: 700px; height: 387px;"/><noscript><img src="/uploads/20170617/1497682527606053.png" title="1497682527606053.png" alt="1497682527606053.png" width="700" height="387" border="0" vspace="0" style="width: 700px; height: 387px;"/></noscript></p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682538794963.png" title="1497682538794963.png" alt="1497682538794963.png" width="700" height="384" border="0" vspace="0" style="width: 700px; height: 384px;"/><noscript><img src="/uploads/20170617/1497682538794963.png" title="1497682538794963.png" alt="1497682538794963.png" width="700" height="384" border="0" vspace="0" style="width: 700px; height: 384px;"/></noscript></p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>SID History</strong></span></p>
<p style="text-align: left;"><a href="https://msdn.microsoft.com/en-us/library/ms679833%28v=vs.85%29.aspx" target="_blank" textvalue="SID历史记录">SID历史记录</a>是支持<a href="https://technet.microsoft.com/en-us/library/cc779590%28v=ws.10%29.aspx" target="_blank" textvalue="迁移方案的属性">迁移方案的属性</a>。每个用户帐户都有一个关联的<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa379571%28v=vs.85%29.aspx" target="_blank" textvalue="安全标识符（SID）">安全标识符（SID）</a>，用于跟踪安全主体和连接到资源时帐户的访问权限。SID历史记录允许另一个帐户的访问权限被有效的克隆到另一个帐户。这是非常有用的一种做法，以确保用户在从一个域移动（迁移）到另一个域时能够保留原有的访问权限。由于在创建新帐户时用户的SID发生了更改，所以旧的SID需要映射到新的帐户。当域A中的用户迁移到域B时，将在DomainB中创建新的用户帐户，并将DomainA用户的SID添加到DomainB的用户帐户的SID历史记录属性中。这样就可以确保DomainB用户仍可以访问DomainA中的资源。</p>
<p style="text-align: left;">这意味着如果帐户在其SID History属性中包含了具有特权的帐户或用户组，<a href="https://adsecurity.org/?p=1772" target="_blank" textvalue="则该帐户将分配到这些帐户或组的所有权限，不管它们是直接还是间接分配">则该帐户将分配到这些帐户或组的所有权限，不管它们是直接还是间接分配</a>。如果攻击者获得对该帐户的控制权，则它们具有所有相关的访问权限。在SIDHistory中通过SID提供的权限可能不够明显，因此很容易发生遗漏。</p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>组策略权限</strong></span></p>
<p style="text-align: left;">此权限用于在Active Directory中创建，配置和链接组策略对象（GPO）。将GPO链接到OU时，GPO中的设置将应用于该OU中的相应对象（用户/计算机）。</p>
<p style="text-align: left;">可以配置GPO的权限，将GPO修改权限委派给任何安全主体。</p>
<p style="text-align: left;">如果在链接到该域的组策略上配置了自定义权限，并且攻击者获得对具有修改访问权限的帐户的访问权限，则该域可能会被入侵。攻击者修改GPO设置以运行代码或安装恶意软件。这种访问级别的影响取决于GPO链接的位置。如果GPO链接到域或域控制器容器，则它们拥有该域的完整权限。如果GPO链接到工作站或服务器OU，则影响可能不太一样;&nbsp;然而，在所有工作站或服务器上运行代码的能力，可能仍然会导致域被入侵。</p>
<p style="text-align: left;">扫描GPO权限可以识别出哪些GPO被不正确地配置，并扫描GPO链接在哪里影响了域的安全性。</p>
<p style="text-align: left;">一个有趣的事实：组策略的创建者保留了对GPO的修改权限。可能的结果是域管理员需要为域设置审核策略，但是发现OU管理员已经创建了具有所需设置的GPO。因此，域管理员将此GPO链接到将该设置应用于域中所有计算机的根域中。问题是如果该OU管理员帐户遭到入侵，那么OU管理员仍然可以修改现在链接到根域提供升级路径的GPO上。下图显示了具有GPO编辑权限的OU管理员“Han Solo”。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170617/1497682548482258.png" title="1497682548482258.png" alt="1497682548482258.png" width="700" height="474" border="0" vspace="0" style="width: 700px; height: 474px;"/><noscript><img src="/uploads/20170617/1497682548482258.png" title="1497682548482258.png" alt="1497682548482258.png" width="700" height="474" border="0" vspace="0" style="width: 700px; height: 474px;"/></noscript></p>
<p style="text-align: left;"><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">PowerView</a>&nbsp;&nbsp;提供了一种快速扫描所有域的GPO权限的方法：</p>
<p style="text-align: left;">Get &#8211; NetGPO&nbsp; |&nbsp; ％{ Get &#8211; ObjectAcl&nbsp; &#8211; ResolveGUIDs&nbsp; &#8211; Name&nbsp; $ _ 。名称}</p>
<p style="text-align: left;">参考：&nbsp;&nbsp;<a href="http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/">滥用GPO权限</a></p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>用户权限分配</strong></span></p>
<p style="text-align: left;"><a href="https://technet.microsoft.com/en-us/library/bb457125.aspx">用户权限分配</a>经常在计算机GPO中进行配置，并定义了计算机的几个权限。</p>
<p style="text-align: left;">域控制器通常配置为在应用了域控制器容器的默认域控制器策略中进行用户权限分配。 分析与域控制器链接的GPO，可以提供DC和域被提升权限的安全主体的有关的有用信息。</p>
<p style="text-align: left;"><a href="https://technet.microsoft.com/en-us/library/bb457125.aspx">这些分配的策略包括</a>：</p>
<pre class="brush:html;toolbar:false">·SeTrustedCredManAccessPrivilege：访问凭据管理器作为受信任的呼叫者
·SeNetworkLogonRight：从网络访问此计算机
·SeTcbPrivilege：作为操作系统的一部分
·SeMachineAccountPrivilege：将工作站添加到域
·SeIncreaseQuotaPrivilege：调整进程的内存配额
·SeInteractiveLogonRight：允许本地登录
·SeRemoteInteractiveLogonRight：允许通过远程桌面服务登录
·SeBackupPrivilege：备份文件和目录
·SeChangeNotifyPrivilege：绕过遍历检查
·SeSystemtimePrivilege：更改系统时间
·SeTimeZonePrivilege：更改时区
·SeCreatePagefilePrivilege：创建页面文件
·SeCreateTokenPrivilege：创建一个令牌对象
·SeCreateGlobalPrivilege：创建全局对象
·SeCreatePermanentPrivilege：创建永久共享对象
·SeCreateSymbolicLinkPrivilege：创建符号链接
·SeDebugPrivilege：调试程序
·SeDenyNetworkLogonRight：拒绝从网络访问此计算机
·SeDenyBatchLogonRight：拒绝作为批处理作业登录
·SeDenyServiceLogonRight：拒绝作为服务登录
·SeDenyInteractiveLogonRight：拒绝本地登录
·SeDenyRemoteInteractiveLogonRight：拒绝通过远程桌面服务登录
·SeEnableDelegationPrivilege：启用计算机和用户帐户以进行授权
·SeRemoteShutdownPrivilege：从远程系统强制关闭
·SeAuditPrivilege：生成安全审核
·SeImpersonatePrivilege：认证后模拟客户端
·SeIncreaseWorkingSetPrivilege：增加一个进程工作集
·SeIncreaseBasePriorityPrivilege：增加调度优先级
·SeLoadDriverPrivilege：加载和卸载设备驱动程序
·SeLockMemoryPrivilege：在内存中锁定页面
·SeBatchLogonRight：作为批处理作业登录
·SeServiceLogonRight：作为服务登录
·SeSecurityPrivilege：管理审核和安全日志
·SeRelabelPrivilege：修改对象标签
·SeSystemEnvironmentPrivilege：修改固件环境值
·SeManageVolumePrivilege：执行卷维护任务
·SeProfileSingleProcessPrivilege：配置文件单进程
·SeSystemProfilePrivilege：配置文件系统性能
·SeUndockPrivilege：从工作站中移除电脑
·SeAssignPrimaryTokenPrivilege：替换进程级令牌
·SeRestorePrivilege：恢复文件和目录
·SeShutdownPrivilege：关闭系统
·SeSyncAgentPrivilege：同步目录服务数据
·SeTakeOwnershipPrivilege：获取文件或其他对象的所有权</pre>
<p style="text-align: left;">这个列表中有一些有趣的策略（特别是适用于域控制器的GPO）：</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/dn221980(v=ws.11).aspx" target="_blank" textvalue="允许本地登录">允许本地登录</a>并<a href="https://technet.microsoft.com/en-us/library/dn221985(v=ws.11).aspx" target="_blank" textvalue="允许登录远程桌面服务">允许登录远程桌面服务</a>：提供登录权限。</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/cc957161.aspx" target="_blank" textvalue="管理审核和安全日志">管理审核和安全日志</a>：提供查看事件日志中的所有事件（包括安全事件）并清除事件日志的功能。<br /> 有趣的事实：Exchange Server需要这样的权限，这意味着如果攻击者在Exchange服务器上获得系统权限，则可以清除域控制器上的安全日志。</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/dn221988(v=ws.11).aspx" target="_blank" textvalue="同步目录服务数据">同步目录服务数据</a>：“此策略设置确定了哪些用户和组具有同步所有目录服务数据的权限，而不管对象和属性的保护。使用LDAP目录同步（dirsync）服务需要此权限。域控制器本身就具有此用户权限，因为同步过程是在域控制器上的系统帐户的上下文中运行。“<br /> 这意味着在域控制器上对此用户的访问权限可能能够运行<a href="https://adsecurity.org/?p=1729" target="_blank" textvalue="DCSync">DCSync</a>。</p>
<p style="text-align: left;">·&nbsp;&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/dn221977(v=ws.11).aspx" target="_blank" textvalue="允许计算机和用户帐户被委托进行授权">允许计算机和用户帐户被委托进行授权</a>：提供在域中的计算机和用户上配置委派的功能。<br /> 有趣的事实：这提供了在计算机或用户帐户上设置<a href="https://adsecurity.org/?p=1667" target="_blank" textvalue="Kerberos委派的">Kerberos委派的</a>功能。</p>
<p style="text-align: left;">·&nbsp;&nbsp;&nbsp;<a href="https://technet.microsoft.com/en-us/library/dn221967(v=ws.11).aspx" target="_blank" textvalue="验证后模仿一个客户端">验证后模仿一个客户端</a>：这个看起来是一些很有趣的东西，它可以&#8230;</p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>把它们放在一起</strong></span></p>
<p style="text-align: left;">为了有效地识别具有特权访问权限的所有帐户，重要的是要确保所有渠道都被探索以有效地识别权限。这意味着防御者需要检查AD对象的许可细节，从组织单位（OU）开始，然后分支到安全组。</p>
<p style="text-align: left;">要检查的事情如下：</p>
<pre class="brush:html;toolbar:false">·枚举默认组（包括子组）的组成员。确定需要什么权限并删除其他没用的权限。
·扫描Active&nbsp;Directory（特别是OU和安全组）进行自定义委派。
·扫描具有SIDHistory的帐户（仅在从一个域到另一个域的主动迁移期间才需要）。
·查看适用于域控制器，服务器和工作站的GPO中的用户权限分配。
·查看将AD组添加到本地组的GPO，并确保仍然需要这些组，并且权限级别是适当的。</pre>
<p style="text-align: left;">用于检查Active Directory权限的工具：</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://github.com/BloodHoundAD/BloodHound" target="_blank" textvalue="Bloodhound">Bloodhound</a></p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1" target="_blank" textvalue="PowerView">PowerView</a>&nbsp;( Bloodhound中的一个模块 )</p>
<p style="text-align: left;">·&nbsp;&nbsp;<a href="https://blogs.technet.microsoft.com/pfesweplat/2013/05/13/take-control-over-ad-permissions-and-the-ad-acl-scanner-tool/" target="_blank" textvalue="AD ACL Scanner">AD ACL Scanner</a></p>
<p style="text-align: left;"><strong>参考</strong></p>
<p style="text-align: left;">· &nbsp; BloodHound 1.3 &#8211; ACL攻击路径更新<br /> https://wald0.com/?p=112</p>
<p style="text-align: left;">· &nbsp; 使用PowerView滥用Active Directory权限<br /> http://www.harmj0y.net/blog/redteaming/abusing-active-directory-permissions-with-powerview/</p>
<p style="text-align: left;">· &nbsp;滥用GPO权限<br /> http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/</p>
<p style="text-align: left;">· &nbsp;AD DS所有者权限<br /> https://technet.microsoft.com/en-us/library/dd125370(v=ws.10).aspx</p>
<p style="text-align: left;">· &nbsp;安全描述符定义语言<br /> https://msdn.microsoft.com/en-us/library/windows/desktop/dd981030(v=vs.85).aspx</p>
<p style="text-align: left;">· &nbsp;Active Directory权限持久＃15：利用AdminSDHolder和SDProp（Re）获得域管理员权限<br /> https://adsecurity.org/?p=1906</p>
<p style="text-align: left;">· &nbsp;安全描述符定义语言（第1部分）<br /> https://blogs.technet.microsoft.com/askds/2008/04/18/the-security-descriptor-definition-language-of-love-part-1/</p>
<p style="text-align: left;">· &nbsp;ActiveDirectoryRights枚举<br /> https://msdn.microsoft.com/en-us/library/system.directoryservices.activedirectoryrights(v=vs.110).aspx</p>
<ul style="margin-top:0" type="disc" class=" list-paddingleft-2">
<li>
<p style="text-align: left;"><a href="https://github.com/BloodHoundAD/BloodHound">Bloodhound</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">PowerView</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://blogs.technet.microsoft.com/pfesweplat/2013/05/13/take-control-over-ad-permissions-and-the-ad-acl-scanner-tool/">AD ACL &nbsp; &nbsp; &nbsp;Scanner</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://adsecurity.org/?p=1772">AD Security: SIDHistory</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://technet.microsoft.com/en-us/library/bb457125.aspx">User Rights &nbsp; &nbsp; &nbsp;Assignments</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://technet.microsoft.com/en-us/library/dn579255(v=ws.11).aspx">Active &nbsp; &nbsp; &nbsp;Directory Security Groups</a></p>
</li>
<li>
<p style="text-align: left;"><a href="https://msdn.microsoft.com/en-us/library/system.directoryservices.activedirectoryrights(v=vs.110).aspx">ActiveDirectoryRights &nbsp; &nbsp; &nbsp;Enumeration</a></p>
</li>
</ul>
                <div class="foot_description" style="background-color: #fff;">
                    本文翻译自：https://adsecurity.org/?p=3658，如若转载，请注明来源于嘶吼：                        <a href="http://www.4hou.com/penetration/5529.html" target=_blank>http://www.4hou.com/penetration/5529.html</a>
                                    </div>


                 </p>
            </div>
            <div class="article_con">
                <!--文章内容-->
            </div>
            <div class="post-like">
                <a href="javascript:;" data-action="ding" target=_blank data-id="5529" class="favorite">
                <div class="zanbox">
                    <dd class="zanbefor"></dd>
                    <dd class="zanafter"></dd>
                </div>
                <span class="zantext">点赞</span>
                <span class="count">
            5</span>
                </a>
            </div>
            <div class="active_bottom">
                <ul>
                    <a class="Sina" href="http://service.weibo.com/share/share.php?url=http://www.4hou.com/penetration/5529.html" title="分享到新浪微博" target="_blank"><li class="sinahover"></li></a>
                    <a onclick="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+encodeURIComponent(document.location.href));return false;" title="分享到QQ空间" class="WeChat" href="javascript:void(0)" target="_blank"><li class="kj"></li></a>
                    <a onclick="dashangToggle()" class="friend" title="分享到微信、朋友圈等" target="_blank"><li class="wx"></li></a>

                </ul>
                <div class="strat icons"><span class='wpfp-span'><img src='http://img.4hou.com/wp-content/plugins/wp-favorite-posts/img/star.png' alt='Favorite' title='Favorite' class='wpfp-img' /><a class='wpfp-link' href='?wpfpaction=add&amp;postid=5529' title='收藏' rel='nofollow'>收藏</a></span></div>
                <div class="hide_box"></div>
                <div class="shang_box">
                    <a class="shang_close" href="javascript:void(0)" onClick="dashangToggle()" title="关闭"><img src="http://img.4hou.com/wp-content/themes/4houv2/images/close.jpg" alt="取消" /></a>
                    <img class="shang_logo" width="120px" src="http://img.4hou.com/wp-content/themes/4houv2/images/logo.png" alt="嘶吼" />
                    <div class="shang_tit">
                        <p>感谢您的支持，我会继续努力的!</p>
                    </div>
                    <div class="shang_payimg">
                        <img src="http://www.4hou.com/wp-content/themes/4houv2/qrcode.php?url=http%3A%2F%2Fwww.4hou.com%2Fpenetration%2F5529.html" alt="扫码支持" title="扫一扫" />
                    </div>

                    <div class="shang_info">
                        <p>打开<span id="shang_pay_txt">微信</span>扫一扫后点击右上角即可分享哟</p>
                    </div>
                </div>
            </div>
            
            <div class="avatarbottomwrap">
                 <div class="avatarboxleft">
                        <div class="avatarbottom">
                           
                            <a class="upload-img"><img alt='李白' src='http://img.4hou.com/wp-content/uploads/2017/06/b08c1c8edfe23d6947c6-96x96.jpg' class='avatar avatar-96 photo' height='96' width='96' /></a>
                        </div>
                        <h1 class="authornamebottom"><a href="http://www.4hou.com/member?Author=李白" class="upload-img" target=_blank>
                                李白                             </a></h1>
                        <p class="authorzybottom">你的血让我诗性大发</p>

                        <div class="authorbottombox">
                            <!--<div class="gzbtn">关注</div>
                            <div class="sxbtn">私信</div>-->
                                                            <span class="gzbtn"  style="cursor: pointer;" onclick="location.href='/mybox?action=reply&to_user=李白&type=send'">发私信</span>
                                                    </div>
                 </div>
                <div class="authorother">
                 <a class="morearticle" href="http://www.4hou.com/member?Author=李白" class="upload-img" target=_blank>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                             </a>
                    <div class="swiper-container">

                                                    <div class="swiper-wrapper">
                               
                                <div class="swiper-slide">
                                                                        <div><a href="http://www.4hou.com/penetration/7529.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/ea4947354fe7343c1a48.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/penetration/7016.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/08/3a09aada8e42a9eee4c6.png?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/penetration/5529.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/06/5fa8c99bdaed7d956c84.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/mobile/5425.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/06/5fa8c99bdaed7d956c84.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                    </div>
                            </div>
                                        </div>
                </div>
                <script type="text/javascript">
                    function dashangToggle(){
                        $(".hide_box").fadeToggle();
                        $(".shang_box").fadeToggle();
                    }
                </script>
                <script> 
                    var mySwiper = new Swiper('.swiper-container', {
                        direction : 'vertical',
                        pagination : '.swiper-pagination',
                        paginationClickable :true,
                        spaceBetween : 20
                    })
                </script>
            </div>
                            <div class="review" style="margin-bottom:80px;">
    <h3 id="reply-title" class="comment-reply-title">发表评论 <small></h3>
    <form action="http://www.4hou.com/wp-comments-post.php" method="post" id="commentform">
        <p class="commentname"><label for="author">昵称</label>
            <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p>
        <p class="commenteml">
            <label for="email">邮箱</label>
            <input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required />
        </p>
        <p class="comment-form-comment">
           <label for="comment">评论</label>
           <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea>
        </p>

        <p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
        <input type='hidden' name='comment_post_ID' value="5529" id='comment_post_ID' />
            <input type='hidden' name='comment_parent' id='comment_parent' value='0' />
        </p>
    </form>
					
<div class="new-review">
   <ol class="commentlist">
      </ol>
   <div class="hr clearfix">&nbsp;</div>
</div>
</div>             
        </article>

        <!--作者其他文章-->
        <aside class="article_authorbox">
          <div class="article_authorbox_top">
                <div class="article_author">
            <div class="article_author_avatar">
                 <a class="upload-img"><img alt='李白' src='http://img.4hou.com/wp-content/uploads/2017/06/b08c1c8edfe23d6947c6-96x96.jpg' class='avatar avatar-96 photo' height='96' width='96' /></a>
            </div>
            <h1 class="article_author_name"><a href="http://www.4hou.com/member?Author=李白" class="upload-img" target=_blank>
                    李白                </a></h1>
            <p class="article_author_type">你的血让我诗性大发 </p>
            <div class="article_author_bottom">
                                        <span class="send-info" onclick="location.href='/mybox?action=reply&to_user=李白&type=send'">发私信</span>
                         
            </div>
          </div>  
            <div class="interested">
                <h1>可能喜欢</h1>
                                                    <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7667.html" target="_blank">小心找工作时被挖坑，有人利用 LinkedIn 发送钓鱼链接</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7653.html" target="_blank">一次服务器被攻击的应急行动</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7646.html" target="_blank">一个Tor浏览器0day漏洞价值100万美元，其中的隐情是……</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7660.html" target="_blank">Elasticsearche僵尸网络：超过4000台服务器遭到两款POS 恶意软件感染</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7669.html" target="_blank">渗透挑战赛：从SQL注入到管理员权限</a> 
                </li> 
                                                </div>
       </div>

          
        </aside>
    </section>
    <div id="zooming">
        <img src="" id="imgcon">
    </div>
    <script>
        $(document).ready(function() {
            $.fn.postLike = function() {
                if ($(this).hasClass('done')) {
                    return false;
                } else {
                    $(this).addClass('done');
                    var id = $(this).data("id"),
                        action = $(this).data('action'),
                        rateHolder = $(this).children('.count');
                    var ajax_data = {
                        action: "bigfa_like",
                        um_id: id,
                        um_action: action
                    };
                    $.post("/wp-admin/admin-ajax.php", ajax_data,
                        function(data) {
                            $(rateHolder).html(data);
                        });
                    return false;
                }
            };
            $(document).on("click", ".favorite",
                function() {
                    $(this).postLike();
                });


            $("img").attr("title","");
            var altcon=$(".art_title").text();
            $("img").attr("alt",altcon);
            // 图片放大
            $(".article_cen").find('img').on("click",function(){
                var imgsrc=$(this).attr("src");
                var winthimg=$(this).width();
                var zooming=winthimg*1.2;
                $("#imgcon").css({width:zooming});
                $("#imgcon").css({marginLeft:-zooming/2});
                $("#imgcon").attr("src",imgsrc);
                $("#zooming").addClass("zoomaniatae");
                $("#imgcon").addClass("imgconadimate");
            });
            $("#zooming").on("click",function(){
                $("#imgcon").removeClass("imgconadimate");
                $("#zooming").removeClass("zoomaniatae");

            });

            $(window).scroll(function(){
                var scrtop=$(window).scrollTop();
                if(scrtop>450){
                    $(".article_authorbox_top").removeClass("asideanimateleave").addClass('asideanimate')
                    // $(".interested").hide()
                }
                else if(scrtop<450&&scrtop>350){
                     $(".article_authorbox_top").addClass("asideanimateleave").removeClass('asideanimate')
                     $(".interested").show()

                }
            });
            var start=$(".strat .wpfp-span .wpfp-link").text()
            if(start=="已收藏"){
                $(".strat").addClass("stratend")
            }else{
                $(".strat").removeClass("stratend")
            }

            $(".avatar-96").width(72);
            $(".avatar-96").height(72);
            $(".avatar-120").width(50);
            $(".avatar-120").height(50);

        });
    </script>
<style type="text/css">
.footer{height:auto; background-color: #282828}
.footer_about{width: 1200px;height: 50px;padding-top: 26px; margin: 0 auto;border-bottom-color: transparent !important; position: relative;}
.footer_about>a{font-size: 16px;height: 16px !important;line-height: 16px !important; float: left; padding-right: 18px; border-right:1px solid #ccc;}
.last-child-a{border:none !important}
.footer_bottom_cen p{ margin-top: 5px; margin-right: 25px;text-align: left; margin-bottom: 6px;float: left;}
.footer_bottom_cen>div{width: 450px;float: left;margin-right: 8px}
.footer_bottom{height: 74px}
.footerlogos{width: 130px; height: 24px; position: absolute;right: 10%; top:24px;}
.footerlogos dd{float: left; margin-right: 20px;cursor: pointer;}
.footerlogos dd a{display: block;width: 100%; height: 100%}
.wechartlogo{width: 20px; height: 20px; background-position:-227px 0px;}
.weibologo{width: 20px; height: 20px; background-position:-269px 0px;}
.zhihulogo{width: 20px; height: 20px; background-position:-361px 0px;}
.wechartlogo i{width: 80px;height: 78px;background-size: contain !important; right: 137px;display: none;opacity: 1;background: url(http://www.4hou.com/wp-content/themes/4houv2/img/wechatqr.png) no-repeat;position: absolute;top: -28px;}
.wechartlogo:hover i{display: block;}
.footer_bottom{width: 1200px; background-color: #282828; margin:0 auto } 
.footer_bottom_cen>div img{float: left; margin-right: 4px;margin-top: 4px; margin-left: 4px;width: 66px;}
.footer_bottom_cen{width: 100%}
.cloudserver{float: right !important; margin: 0 auto !important;width: 385px !important; margin-top: -31px}
.cloudserver img{float: left;}
.cloudserver dd{float: left;}
@media screen and (max-width:1260px) {
    .footer{width: 100%; padding: 0px 20px;}
    .footer_about{width: 100%}
    .footer_bottom{width: 100%}
    .footer_bottom div{width: 100%;display: none;}
}
@media screen and (max-width:660px) {
    .footer_about{padding-top: 14px; margin-bottom: 22px;}
    .footerlogos{display: none;}
    .footer_bottom{height: 44px;}

}
</style>
<footer class="footer">
    <div class="footer_about">
        <a href="/about" target=_blank>关于我们</a>
        <!--<a href="">加入我们</a>-->
        <a href="/submit" target=_blank>我要投稿</a>
        <a href="/service" target=_blank>广告及服务</a>
        <a href="/partner" target=_blank class="last-child-a">友情链接</a>
        <div class="footerlogos">
                <dd class="wechartlogo icons">
                  <i></i>
                </dd>
                <dd class="weibologo icons">
                 <a href="http://weibo.com/u/6069423878" target=_blank></a>
                </dd>
                <dd class="zhihulogo icons">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank></a>
                    
                </dd>
        </div>
    </div>

    <section class="footer_bottom">
        <article class="footer_bottom_cen">
            <p>©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;&nbsp;京ICP备16063439号</p>
            <p class="mobilefooter">©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;|&nbsp;&nbsp;京ICP备16063439号</p>
            <div class="cloudserver">
                <span>本站由</span>
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud1.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/ucloud.png">
                <span>提供云计算服务</span>
            </div>
        </article>
    </section>
    <section class="footer_top" style="display:none">
        <article class="footer_top_cen">
            <div class="homeqrcode">
                <dd class="icons"></dd>
                <div class="wb">
                    <a href="http://weibo.com/u/6069423878" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼传媒</p>
                    </a>
                </div>

                <div class="sh">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼</p>
                    </a>
                </div>
            </div>
            
            <h1>合作伙伴</h1>
            <div class="footer_friend">
                <a href="http://www.xinhuanet.com/talking/chinasafety/" target=_blank>新华网安全中国</a>
                <a href="http://jaq.alibaba.com/" target=_blank>阿里聚安全</a>
                <a href="http://www.seclover.com/" target=_blank>四叶草安全</a>
                <a href="https://sec.vip.com/" target=_blank>唯品会安全应急响应中心</a>
                <a href="https://www.duoyinsu.com/" target=_blank>安识科技</a>
                <a href="http://xianzhi.aliyun.com" target=_blank>云盾先知</a>
                <a href="http://www.ardsec.com/" target=_blank>兴华永恒</a>
                <a href="https://www.sobug.com/" target=_blank>SOBUG</a>
            </div>
        </article>
    </section>
    
</footer>
<aside class="side" >
    <div class="side_top icons "></div>
    <div class="iconbox">
        <div class="side_wechart icons iconhover">微信
            <dd></dd>
        </div>
        <a href="http://weibo.com/u/6069423878" target=_blank><div class="side_webo icons iconhover">微博</div></a>
        <a href="http://www.4hou.com/feed/" target=_blank><div class="side_rss icons iconhover">RSS</div></a>
        <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank><div class="side_zh icons iconhover">知乎</div></a>
    </div>
    <div class="side_bottom icons"></div>
    
</aside>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ac201c14c3d2a4747423252be421e1bc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-91554508-1', 'auto');
    ga('send', 'pageview');

</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</body>
</html>