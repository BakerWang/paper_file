<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>悄然崛起的挖矿机僵尸网络：打服务器挖价值百万门罗币 - 嘶吼 RoarTalk &#8211; 回归最本质的信息安全,互联网安全新媒体,4hou.com</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta property="wb:webmaster" content="4517e8fe39b18975" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="description" content="第一部分 背景360互联网安全中心监测到一种利用被入侵服务器进行门罗币挖矿的僵尸网络，该僵尸网络控制的服务器数量高峰时单日达到两万多台。僵尸网络建立初期利用“永恒之蓝”漏洞攻击武器入侵一定数量的计算机并以…" />
    <meta name="keywords" content="" />
        <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon.ico" rel="shortcut icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_114.png" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_76.png" sizes="76x76" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_120.png" sizes="120x120" rel="apple-touch-icon">
    <link href="http://img.4hou.com/wp-content/themes/4houv2/images/favicon_152.png" sizes="152x152" rel="apple-touch-icon">

    <!-- 引入 lib -->
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/jquery.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.jquery.min.js"></script>
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/swiper.min.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <!--[if lt IE 11]>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/html5shiv.min.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/lib/respond.js"></script>
    <![endif]-->
    <!-- 引入 css js -->
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/css/style.css">
    <link rel="stylesheet" href="http://www.4hou.com/wp-content/themes/4houv2/lib/allmin.css">
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/public.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/main.js"></script>
    <script src="http://www.4hou.com/wp-content/themes/4houv2/js/index-more.js"></script>
    </head>
<body>
<style type="text/css">
.memberlistanimate{width: 122px}
.memberlistanimateleave{width: 122px}
.nameheader{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width: 78px;display: block;}
</style>

<header class="header">
            <article class="header_center">
                <div class="logowrap">
            <a href="http://www.4hou.com"><div class="logo icons"></div></a>
            <h1>回归最本质的信息安全</h1>
        </div>
        <div class="login">
            <form action="/" class="navbar-form inSearch " name="searchform" onsubmit="return checksubmit()">
                <div class="br">
                    <span class="in-btn icons"></span>
                    <input type="text" name="s" id="search" class="animated">
                    <div class="clear icons"></div>
                </div>
                <div id="submitBtnplace" class="icons animated" value=""></div>
                <!--<input type="submit" id="submitBtn" class="icons animated" value="">-->
            </form>
                            <!--登录注册按钮-->
                 <div id="register">
                     <a href="http://www.4hou.com/register" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">注册</a>
                 </div>
                 <div id="sing">
                      <a href="http://www.4hou.com/login" class="pzh_login">登录</a>
                 </div>

                 <div class="burger2 menu" id="burger">
                  <div class="icon"></div>
                 </div>

            
           <!-- <div id="register">注册</div>
            <div id="sing">登录</div>
            <div class="burger2 menu" id="burger">
                <div class="icon"></div>
            </div>-->
        </div>
    </article>
</header>
<nav class="navbox animated">
    <section class="navbox_cen">
        <article class="navboxleft">
            <ul class="nav navbar-nav index-nav" id="inNav">
					<li>
							<li class="cat-item cat-item-18"><a href="http://www.4hou.com/category/info" >资讯</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://www.4hou.com/category/technology" >技术</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://www.4hou.com/category/xactivity" >活动</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://www.4hou.com/category/vulnerable" >漏洞</a>
</li>
					</li>
                    <li class="cat-item cat-item-29"><a href="http://www.4hou.com/piao" >嘶票</a>
                    </li>
            </ul>
        </article>
        <article class="navboxright">
            <div class="contrib"> <a href="http://www.4hou.com/contribute" class="tougao" data-event-category="Referral to Signup" data-event-action="click" data-event-label="Signup Menu button / Header">投稿</a></div>
        </article>
    </section>
</nav>
<div id="modelbg"></div>
    <style>


    ::selection {
    background:#fea283;
    color:#fff;
}
::-moz-selection {
    background:#fea283;
    color:#fff;
}
::-webkit-selection {
    background:#fea283;
    color:#fff;
}


        .article_cen p img{height: auto !important;}
        .commentlist .children{width: 90%; padding-right: 15px; border-color: transparent ;}
        .commentname,.commenteml{width: 60%; margin-left:5% ;margin-bottom: 30px;border-bottom: 1px solid #dbdbdb;}
        .article_cen ol li{list-style-type: decimal;}
         .article_cen ol li p{overflow: inherit;}
        .commentname label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commentname input{width: 50%;border: none; outline: none;}
        .commenteml label{font-size: 16px;color: #666; margin-right: 10px;line-height: 32px;}
        .commenteml input{width: 50%;border: none; outline: none;}
        #zooming{display: none;width: 100%;height: 100%; position: fixed;z-index: 999;left: 0px; top: 0px; background-color: rgba(0,0,0,.6);}
        .zoomaniatae{display: block !important;}
        .imgcon{}
        #imgcon{position: absolute;left: 50%; top: 20%;max-width: 80%}
        .article_cen img{cursor: pointer;}
        #zooming{cursor: pointer;}
        .imgconadimate{animation:imgcon 0.5s 1 forwards;
        -webkit-animation:imgcon 0.5s 1 forwards;}
        .article_authorbox{    width: 222px;min-height: 214px;
        padding-bottom: 20px;
        float: right;
        position: relative;}
        .interested{position: relative;}
        .interested>h1{font-size: 18px; font-weight: 900; position: absolute; top: -36px;color: #5e5e5e}
       .user-comment span{font-size: 13px; position: relative; top: 2px;}
        .article_authoradd{position: fixed;}
        .stratend{background:url(http://www.4hou.com/wp-content/themes/4houv2/img/starend.png); !important;background-size: contain !important;}
        .wpfp-span{opacity: 0;width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-link{width:100%; height: 100%;display: block; left: 0px; top: 0px; }
        .wpfp-span img{display: none;}
        .interested{width: 222px;padding-bottom: 20px;background-color: #fff;margin-top: 70px; padding-bottom: 10px; padding-top: 10px;border: 1px solid #f5c2b1}
        .interested li{width: 100%;position: relative;padding-top: 8px; padding-bottom: 8px;  line-height: 24px; padding-left: 20px;padding-right: 14px}
        .interested li i{width: 6px;height: 6px;border-radius: 50%; background-color: #f63;position: absolute; left: 8px; top: 18px;}
        .interested li a{color: #666;font-size: 14px; line-height: 18px;}
        .interested li:hover{background-color: #f9e7e3;-moz-transition: all 0.4s ease-in-out;
        .footer{position: relative;z-index: 99}   
        .article_authorbox_top{position: relative;} 
        

        -o-transition: all 0.4s ease-in-out; -webkit-transition: all 0.4s ease-in-out; transition: all 0.4s ease-in-out;}
    
        @-webkit-keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        @keyframes imgcon{
            0%{ opacity:0; -webkit-transform:scale3d(.3, .3, .3); transform:scale3d(.3, .3, .3) }
            50%{ opacity:1 }
        }
        .asideanimate{animation:asideanimate 1s 1 forwards;
        -webkit-animation:asideanimate 1s 1 forwards; position: fixed;}
        @-webkit-keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        @keyframes asideanimate{
            0%{ opacity:0; -webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
            50%{ opacity:1 }
        }
        .asideanimateleave{animation:asideanimateleave 1s 1 forwards;
        -webkit-animation:asideanimateleave 1s 1 forwards;}
        @-webkit-keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @keyframes asideanimateleave{
            0%{ opacity:1; -webkit-transform:translate3d(0,0, 0); transform:translate3d(0, 0, 0) }
            50%{ opacity:0;-webkit-transform:translate3d(0,-20%, 0); transform:translate3d(0, -20%, 0) }
        }
        @media screen and (max-width:650px) {
            .member_list{right: -30px !important;top: 34px !important;}
            .article_authorbox{display: none;}
            .nameheader{display: none;}
            .shang_box{width: 90%; margin-left:-45% }
            #imgcon{width: 90% !important; margin-left: -45% !important;max-width: inherit !important}
            .dy{padding: 12px 15px!important;font-size: 14px !important; line-height: 22px !important;}
        }
        .article_author{float:none !important;padding-top: 1px;}
        .article_cen pre{color: #666 !important; line-height: 26px; background-color: #f1f1f1}
        .articlecontent blockquote>p{ color: #666; font-size: 16px; }
    </style>
    <section class="articlewrap">
        <article class="articlecontent">
            <div class="article_top">
                <h1 class="art_title">悄然崛起的挖矿机僵尸网络：打服务器挖价值百万门罗币</h1>
                <p class="art_time">2017年9月4日发布</p>
                <div class="art_nav">
                    <!--<a href="">翻译文章</a>
                    <span>／</span>
                    <a href="">新闻</a>
                    <span>／</span>
                    <a href="">原创</a>-->
                                        <a href="http://www.4hou.com">首页 </a></a>
                    <span>／</span>
                    <a href="http://www.4hou.com/category/info/news">新闻</a>
                    <span>／</span>
                    <a href="">正文</a>

                    </ul>
                </div>
                <div class="art_type">
                    <div class="newtype">
                        <div class="read ">
                            <i class="icons"></i>
                            <span>29,114</span>
                        </div>
                        <div class="comment ">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                        <div class="Praise">
                            <i class="icons"></i>
                            <span>0</span>
                        </div>
                    </div>
                </div>
            </div>
             <p class="dy" style="padding: 24px 60px;font-size: 16px;line-height: 30px;color: #808080;background-color: #f6f6f6;"><span style="font-weight: bold;">导语：</span>僵尸网络建立初期利用“永恒之蓝”漏洞攻击武器入侵一定数量的计算机并以此作为僵尸网络发展的基础，之后这些计算机扫描其他计算机的1433端口（msSQL服务端口），尝试爆破目标计算机的msSQL服务，一旦爆破成功则登陆SQL Server执行恶意代码</p>

            <div class="article_cen">
                <!--文章摘要-->
               
                <p><p style="text-align: left;"><span style="font-size: 20px;"><strong>第一部分 背景</strong></span></p>
<p style="text-align: left;">360互联网安全中心监测到一种利用被入侵服务器进行门罗币挖矿的僵尸网络，该僵尸网络控制的服务器数量高峰时单日达到两万多台。僵尸网络建立初期利用“永恒之蓝”漏洞攻击武器入侵一定数量的计算机并以此作为僵尸网络发展的基础，之后这些计算机扫描其他计算机的1433端口（msSQL服务端口），尝试爆破目标计算机的msSQL服务，一旦爆破成功则登陆SQL Server执行恶意代码。目标计算机被僵尸网络控制之后同样会通过1433端口入侵其他计算机，僵尸网络因此不断扩大控制范围，最终形成现在这样的规模。</p>
<p style="text-align: left;">僵尸网络的蔓延离不开强大的Bot程序，通过代码同源性可以发现该家族的Bot程序的诞生最早可追溯到2014年。在2014年到2017年之间， Bot程序进行多次版本更新，最早的版本只是简单的入侵与远程控制，从2017年4月的版本开始， Bot程序借鉴多款扫描器、爆破工具以及著名僵尸网络mirai的实现，添加了多种针对不同协议的扫描爆破模块，并且实现了一套针对msSQL的“入侵+利用+传播”的攻击模块。Bot程序版本更替及传播量如下图所示。（图示中xx.x.x.x.x(x)表示的是Bot程序的版本，例如17.1.0.0.2(1)表示2017年编译的1.0.0.2版本的Bot程序变种1）</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421216145377.png" title="1504421216145377.png" alt="1-1.png"/><noscript><img src="/uploads/20170903/1504421216145377.png" title="1504421216145377.png" alt="1-1.png"/></noscript></p>
<p style="text-align: center;">图1-1 Bot程序版本更替及感染量概览图</p>
<p style="text-align: left;">从图1-1中可以看出，Bot程序自4月底开始传播量开始出现爆发式增长，这正是作者利用“永恒之蓝”漏洞攻击武器进行僵尸网络建立的时间段。此外，Bot程序有一套完善的更新体系，当Bot程序检测到有新版本发布之后，将自动更新至最新版本。从图1种也不难看出，新版本传播量增加之后，老版本的传播量也相应地下降。</p>
<p style="text-align: left;">Bot程序当前的主要目的是安装门罗币挖矿机，利用服务器资源挖矿。截止目前，作者的门罗币钱包已经有高达1975枚门罗币，当前约合人民币167万。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421225884340.png" title="1504421225884340.png" alt="1-2.png"/><noscript><img src="/uploads/20170903/1504421225884340.png" title="1504421225884340.png" alt="1-2.png"/></noscript></p>
<p style="text-align: center;">图1-2 作者门罗币钱包概况</p>
<p style="text-align: left;">Bot程序高度模块化，集合了多种不同的功能，并且具有完善的更新和持久驻留机制。</p>
<p style="text-align: left;">对Bot程序的分析将有助于了解该僵尸网络的传播机制。本文将通过对Bot程序的详细分析，挖掘该僵尸网络的工作原理，并据此讨论服务器在面对该僵尸网络时所需的预防措施以及防御策略。</p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>第二部分 Bot程序分析</strong></span></p>
<p style="text-align: left;">本文选用Bot程序2017年4月份编译的1.0.0.2版本作为分析的样本，样本MD5：10ace2e06cc8b5656d38eb2e6ed4f079。</p>
<p style="text-align: left;">Bot程序由main模块，update模块，Scanner模块，Cracker模块，ServerAgent模块和cService模块6个模块构成，模块之间互有联系，相互协作。以下将对每个模块执行的功能进行分析。</p>
<p style="text-align: left;"><strong>1.&nbsp;&nbsp;main模块分析</strong></p>
<p style="text-align: left;">Bot程序是以控制台形式存在的，在介绍main模块之前先介绍Bot程序所接收的启动参数以及参数对应的功能。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170904/1504504997595808.png" title="1504504997595808.png" alt="0.png"/><noscript><img src="/uploads/20170904/1504504997595808.png" title="1504504997595808.png" alt="0.png"/></noscript></p>
<p style="text-align: center;">表2-1-1 Bot程序所接收的参数及对应的功能</p>
<p style="text-align: left;">这些启动参数满足以下几条规则：</p>
<p style="text-align: left;">1.当存在“-start”，“-stop”，“-create”和“-delete”中的多个时，只有第一个参数是有效的，因此作者引入“-run”参数配合“-create”参数以完成创建服务并启动服务的操作。</p>
<p style="text-align: left;">2.“-delete”参数在删除Bot服务之前会关闭该服务。</p>
<p style="text-align: left;">3.当未指定“-syn”参数时默认扫描器为TCP_CONNECT模式。</p>
<p style="text-align: left;">4.当同时存在“-srv”和“-cli”时只有第一个参数是是有效的，两者都不存在时默认为“-srv”。</p>
<p style="text-align: left;">5.当程序启动参数包含“-s”时，将以服务形式执行main模块，否则以控制台形式执行main模块。</p>
<p style="text-align: left;">main模块主要是进行一些准备工作以及配置并启用其他模块。在程序准备工作方面，主要包括以下几部分。</p>
<p style="text-align: left;">（1）获取系统信息。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421234456684.png" title="1504421234456684.png" alt="2-1-1.png"/><noscript><img src="/uploads/20170903/1504421234456684.png" title="1504421234456684.png" alt="2-1-1.png"/></noscript></p>
<p style="text-align: center;">图2-1-1 获取系统信息</p>
<p style="text-align: left;">（2）判断系统类型是否为Server。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421244506312.png" title="1504421244506312.png" alt="2-1-2.png"/><noscript><img src="/uploads/20170903/1504421244506312.png" title="1504421244506312.png" alt="2-1-2.png"/></noscript></p>
<p style="text-align: center;">图2-1-2 判断系统类型</p>
<p style="text-align: left;">（3）结束并禁用Network list Service和Network Location Awareness。Network list Service用于识别计算机已连接的网络，收集和存储这些网络的属性，并在更改这些属性时通知应用程序；Network Location Awareness用于收集并保存网络配置和位置信息，并在信息改动时通知应用程序。Bot程序关闭并禁用这些服务以防止自身的网络通信被记录。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421254675254.png" title="1504421254675254.png" alt="2-1-3.png"/><noscript><img src="/uploads/20170903/1504421254675254.png" title="1504421254675254.png" alt="2-1-3.png"/></noscript></p>
<p style="text-align: center;">图2-1-3 结束并禁用Network list Service和Network Location Awareness</p>
<p style="text-align: left;">（4）结束并禁用SharedAccess和MpsSvc（Intemet连接共享和防火墙服务）以保障Bot程序的网络通信能够正常进行，并且删除日志文件。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421262241842.png" title="1504421262241842.png" alt="2-1-4.png"/><noscript><img src="/uploads/20170903/1504421262241842.png" title="1504421262241842.png" alt="2-1-4.png"/></noscript></p>
<p style="text-align: center;">图2-1-4结束并禁用SharedAccess和MpsSvc</p>
<p style="text-align: left;">完成初始化工作之后，main模块将创建新线程执行update模块。update模块检查Bot程序版本并根据情况进行更新。同时，main模块还作为Scanner模块，Cracker模块和ServerAgent模块的入口。</p>
<p style="text-align: left;"><strong>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; update模块分析</strong></p>
<p style="text-align: left;">update模块是Bot程序进行自更新的模块。当程序执行main模块时，将创建线程执行update模块进行版本检查及必要的更新。update模块每6小时进行一次更新检查。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421287371797.png" title="1504421287371797.png" alt="2-2-1.png"/><noscript><img src="/uploads/20170903/1504421287371797.png" title="1504421287371797.png" alt="2-2-1.png"/></noscript></p>
<p style="text-align: center;">图2-2-1 创建线程执行update模块</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421296808412.png" title="1504421296808412.png" alt="2-2-2.png"/><noscript><img src="/uploads/20170903/1504421296808412.png" title="1504421296808412.png" alt="2-2-2.png"/></noscript></p>
<p style="text-align: center;">图2-2-2 调用Sleep函数以定期执行update模块</p>
<p style="text-align: left;">进行更新检查时，update模块首先获取程序当前的版本号，之后通过博客地址“http://blog.sina.com.cn/s/blog_16fb721c50102x6hw.html”获得加密后的C&amp;C的ip地址。将加密后的ip地址去除首尾的分隔符（***和@@@），经过base64解密并与0x36异或之后得到真实的ip地址（在本样本中，C&amp;C ip地址为67.229.144.218，以下简称为“ip”）。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421306973489.png" title="1504421306973489.png" alt="2-2-3.png"/><noscript><img src="/uploads/20170903/1504421306973489.png" title="1504421306973489.png" alt="2-2-3.png"/></noscript></p>
<p style="text-align: center;">图2-2-3 博客中加密的ip地址</p>
<p style="text-align: left;">http://ip:8888/ver.txt中存放最新的Bot程序版本号，update模块读取该版本号并与当前Bot程序的版本号进行对比。当两者相同时，则认为程序已经更新到最新版本，继续执行后续功能；当两者不同时，则对程序进行更新。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421314454189.png" title="1504421314454189.png" alt="2-2-4.png"/><noscript><img src="/uploads/20170903/1504421314454189.png" title="1504421314454189.png" alt="2-2-4.png"/></noscript></p>
<p style="text-align: center;">图2-2-4 对比Bot程序版本和最新版本号</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421348736086.png" title="1504421348736086.png" alt="2-2-5(1).png"/><noscript><img src="/uploads/20170903/1504421348736086.png" title="1504421348736086.png" alt="2-2-5(1).png"/></noscript></p>
<p style="text-align: center;">图2-2-5 最新的版本号</p>
<p style="text-align: left;">若Bot程序未更新到最新版本，则进行更新。最新版本的Bot程序通过路径C://windows/system下的更新程序cabs.exe获取。若cabs.exe不存在，则Bot程序将从http://ip:8888/ups.rar下载cab.exe，并启动该程序进行更新。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421363738510.png" title="1504421363738510.png" alt="2-2-5.png"/><noscript><img src="/uploads/20170903/1504421363738510.png" title="1504421363738510.png" alt="2-2-5.png"/></noscript></p>
<p style="text-align: center;">图2-2-5 下载更新程序cab.exe并启动更新</p>
<p style="text-align: left;">cabs.exe会判断当前计算机系统是否为Windows Server，只有当当前计算机系统为Windows Server时才会执行更新。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421399119777.png" title="1504421399119777.png" alt="2-2-6.png"/><noscript><img src="/uploads/20170903/1504421399119777.png" title="1504421399119777.png" alt="2-2-6.png"/></noscript></p>
<p style="text-align: center;">图2-2-6 判断当前系统是否为Windows Server</p>
<p style="text-align: left;">如果当前计算机系统为Windows Server，则访问http://ip:8888/update.txt获取最新的下载列表，并将下载列表下载到c:windowssystem路径下，命名为upslist.txt。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421388311944.png" title="1504421388311944.png" alt="2-2-7.png"/><noscript><img src="/uploads/20170903/1504421388311944.png" title="1504421388311944.png" alt="2-2-7.png"/></noscript></p>
<p style="text-align: center;">图2-2-7 下载下载列表</p>
<p style="text-align: left;">下载列表中包含两个文件ps.jpg和my1.html。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421410255895.png" title="1504421410255895.png" alt="2-2-8.png"/><noscript><img src="/uploads/20170903/1504421410255895.png" title="1504421410255895.png" alt="2-2-8.png"/></noscript></p>
<p style="text-align: center;">图2-2-8 下载列表内容</p>
<p style="text-align: left;">ps.jpg是末尾拼接了一个PE文件的图片。该PE文件就是最新版本的Bot程序。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421418469328.png" title="1504421418469328.png" alt="2-2-9.png"/><noscript><img src="/uploads/20170903/1504421418469328.png" title="1504421418469328.png" alt="2-2-9.png"/></noscript></p>
<p style="text-align: center;">图2-2-9 藏有最新版本Bot程序的图片</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421429657199.png" title="1504421429657199.png" alt="2-2-10.png"/><noscript><img src="/uploads/20170903/1504421429657199.png" title="1504421429657199.png" alt="2-2-10.png"/></noscript></p>
<p style="text-align: center;">图2-2-10 图片中监测到的PE文件特征</p>
<p style="text-align: left;">my1.html是一个批处理脚本，功能与Cracker:mssql模块释放的批处理脚本123.dat基本相同，主要是创建一些需要的文件夹并为之后Cracker模块配置环境。</p>
<p style="text-align: left;">完成下载之后，cabs.exe会结束Bot程序的进程和服务，更新相关文件之后再重启Bot进程和服务。</p>
<p style="text-align: left;"><strong>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scanner模块分析</strong></p>
<p style="text-align: left;">scanner模块修改自masscan（github：https://github.com/robertdavidgraham/masscan）。masscan是一个快速、灵活的端口扫描器，在windows下发包速度可达到每秒30万包。</p>
<p style="text-align: left;">在调用scanner模块进行扫描之前，Bot程序会配置一个excludefile，该文件指定ip段黑名单，在该范围中的ip地址将不会被扫描。ip黑名单以字符串的形式存放在Bot程序的资源段中，scanner模块在临时文件夹下创建excludefile，读取资源后将ip黑名单写入excludefile。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421439535223.png" title="1504421439535223.png" alt="2-3-1.png"/><noscript><img src="/uploads/20170903/1504421439535223.png" title="1504421439535223.png" alt="2-3-1.png"/></noscript></p>
<p style="text-align: center;">图2-3-1 读取ip黑名单资源并写入excludefile</p>
<p style="text-align: left;">在Bot程序2017年四月份编译的1.0.0.2版本和五月份编译的1.0.0.3版本的其中一个变种中未发现ip黑名单，在五月份编译的1.0.0.3版本的另一个变种中发现了ip黑名单。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421448466379.png" title="1504421448466379.png" alt="2-3-2.png"/><noscript><img src="/uploads/20170903/1504421448466379.png" title="1504421448466379.png" alt="2-3-2.png"/></noscript></p>
<p style="text-align: center;">图2-3-2 存放在Bot程序资源段中的ip黑名单</p>
<p style="text-align: left;">对于每一个a类ip，scaner模块排除掉部分b段。由于全网扫描容易遭到监控，通过排除部分ip地址可以减少被发现的风险。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421457295566.png" title="1504421457295566.png" alt="2-3-3.png"/><noscript><img src="/uploads/20170903/1504421457295566.png" title="1504421457295566.png" alt="2-3-3.png"/></noscript></p>
<p style="text-align: center;">图2-3-3 scanner模块排除部分ip地址后扫描全网</p>
<p style="text-align: left;">scanner模块能够扫描的端口包括1433端口，3306端口，135端口，22端口，445端口，23端口，80端口和3389端口。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421466905580.png" title="1504421466905580.png" alt="2-3-4.png"/><noscript><img src="/uploads/20170903/1504421466905580.png" title="1504421466905580.png" alt="2-3-4.png"/></noscript></p>
<p style="text-align: center;">图2-3-4 部分scanner模块扫描的端口</p>
<p style="text-align: left;">scanner模块可通过两种模式进行端口扫描，分别是TCP_SYN扫描和TCP_CONNECT扫描。使用何种扫描模式由参数“-syn”决定，如果启动参数包含“-syn”则选择使用TCP_SYN模式进行端口扫描，否则选择TCP_CONNECT模式进行端口扫描。当选择TCP_SYN模式进行端口扫描时，Bot程序只发送SYN帧，端口开放回应SYN&amp;ACK帧，端口关闭回应RST帧，；当选择TCP_CONNECT模式进行端口扫描时，Bot程序尝试连接目标端口，端口开放则连接成功，否则连接失败。</p>
<p style="text-align: left;">Scanner模块创建的最大扫描线程数由“-t”参数决定，“-t”的最大值为1800。在scanner模块创建扫描线程的同时会同时创建名为“CrackerWMI”的线程，但是在Bot程序发送的数据包中并未发现目的端口为135（wmi服务使用的端口）的数据包，推测可能是作者预留的尚未完善的功能。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421476154535.png" title="1504421476154535.png" alt="2-3-5.png"/><noscript><img src="/uploads/20170903/1504421476154535.png" title="1504421476154535.png" alt="2-3-5.png"/></noscript></p>
<p style="text-align: center;">图2-3-5 两种不同的扫描模式</p>
<p style="text-align: left;">scanner模块会记录开放特定端口的ip地址，并且与ServerAgent模块和Cracker模块进行交互完成“端口扫描+爆破+入侵”一系列工作。</p>
<p style="text-align: left;"><strong>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ServerAgent模块分析</strong></p>
<p style="text-align: left;">ServerAgent模块由两部分功能组成。一是向C&amp;C发送扫描结果；二是对端口扫描和爆破进行相应的配置工作。</p>
<p style="text-align: left;">ServerAgent模块在scanner模块扫描过程中连接C&amp;C。当scanner模块扫描到开放的端口之后，ServerAgent模块将把对应的ip地址和端口号发送至C&amp;C。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421487611576.png" title="1504421487611576.png" alt="2-4-1.png"/><noscript><img src="/uploads/20170903/1504421487611576.png" title="1504421487611576.png" alt="2-4-1.png"/></noscript></p>
<p style="text-align: center;">图2-4-1 ServerAgent模块连接C&amp;C</p>
<p style="text-align: left;">此外，ServerAgent模块下载密码字典并为Cracker模块配置密码字典，当scanner模块扫描到某ip地址的特定端口为开放状态时，将通过该字典进行爆破。字典的下载地址为http://ip:8888/wpd.dat，当下载完成之后，ServerAgent模块将从http://ip:8888/wpdmd5.txt获取正确的密码字典的MD5值并与下载的字典wpd.dat的MD5值进行对比以确定下载文件的正确性。下载的密码字典wpd.dat是经过加密的，ServerAgent模块读取密钥“cm9vdCpwd2Q=”，对密钥进行base64解密后，使用其解密wpt.dat。解密后的wpd.dat部分内容如下图所示。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421495661995.png" title="1504421495661995.png" alt="2-4-2.png"/><noscript><img src="/uploads/20170903/1504421495661995.png" title="1504421495661995.png" alt="2-4-2.png"/></noscript></p>
<p style="text-align: center;">图2-4-2 密码字典的部分内容</p>
<p style="text-align: left;">wpd.dat实际上是一个xml文件，里面包含mysql，mssql，telnet，wmi，ssh，rdp的密码字典以及不同的入侵方式执行的shell。此外，wpd.dat中存在一个名为ports的键，当该键的某个子健键值为1时，ServerAgent模块将配置scanner模块使其扫描该子键对应的端口。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421506120292.png" title="1504421506120292.png" alt="2-4-3.png"/><noscript><img src="/uploads/20170903/1504421506120292.png" title="1504421506120292.png" alt="2-4-3.png"/></noscript></p>
<p style="text-align: center;">图2-4-3 ports键概览</p>
<p style="text-align: left;">在默认的wpd.dat中，只有mssql子键的值设为1，因此scanner模块只扫描mssql服务对应的端口（端口号1433）。黑客可以通过配置wpd.dat文件增加、减少、修改扫描端口的数目和类别。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421517413788.png" title="1504421517413788.png" alt="2-4-4.png"/><noscript><img src="/uploads/20170903/1504421517413788.png" title="1504421517413788.png" alt="2-4-4.png"/></noscript></p>
<p style="text-align: center;">图2-4-4 从抓包数据发现Bot程序只扫描1433端口</p>
<p style="text-align: left;">有趣的是，ServerAgent模块选择随机的ip段作为每一轮扫描的ip范围，这和mirai僵尸网络的做法十分相似。如下所示，get_random_ip函数生成的随机ip段为220.176.171.93~220.182.171.87，因此本轮扫描中scanner模块对该ip段进行扫描。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421527531495.png" title="1504421527531495.png" alt="2-4-5.png"/><noscript><img src="/uploads/20170903/1504421527531495.png" title="1504421527531495.png" alt="2-4-5.png"/></noscript></p>
<p style="text-align: center;">图2-4-5 ServerAgent模块计算并选取随机ip段</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421541223049.png" title="1504421541223049.png" alt="2-4-6.png"/><noscript><img src="/uploads/20170903/1504421541223049.png" title="1504421541223049.png" alt="2-4-6.png"/></noscript></p>
<p style="text-align: center;">图2-4-6 测试中生成的随机ip段</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421556667324.png" title="1504421556667324.png" alt="2-4-7.png"/><noscript><img src="/uploads/20170903/1504421556667324.png" title="1504421556667324.png" alt="2-4-7.png"/></noscript></p>
<p style="text-align: center;">图2-4-7 从抓包数据中发现此轮扫描中Bot程序扫描其随机生成的ip段</p>
<p style="text-align: left;"><strong>5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cracker模块分析</strong></p>
<p style="text-align: left;">Cracker模块是Bot程序中最重要的模块。该模块用于入侵目标计算机并在目标计算机上执行恶意代码。Cracker模块分为多个小模块，在分析的样本中包括Cracker:CCTV，Cracker:mssql， Cracker:RDP，Cracker:Telnet四个小模块。按照入侵的端口的不同，Cracker模块提供不同的攻击方式。下面将介绍每一种攻击的实现。</p>
<p style="text-align: left;">5.1&nbsp; Cracker:mssql</p>
<p style="text-align: left;">由于Bot程序默认的密码字典wpd.dat中指定扫描的服务为msSQL，因此Cracker:mssql模块是所有Cracker模块中功能最为完善的。在大部分被感染的服务器的msSQL服务中都可以发现该模块所执行的恶意动作。</p>
<p style="text-align: left;">Cracker:mssql模块首先使用爆破字典爆破目标的msSQL服务。如果成功爆破目标，则登陆SQL Server执行下一步操作。</p>
<p style="text-align: left;">登陆SQL Server之后，需要在SQL Server中获得执行shell的权限，因此Cracker:mssql模块使用多种方式尝试获得执行shell的权限，包括：</p>
<p style="text-align: left;">1.&nbsp;&nbsp;恢复xp_cmdshell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421569680951.png" title="1504421569680951.png" alt="2-5-1.png"/><noscript><img src="/uploads/20170903/1504421569680951.png" title="1504421569680951.png" alt="2-5-1.png"/></noscript></p>
<p style="text-align: center;">图2-5-1 恢复xp_cmdshell</p>
<p style="text-align: left;">2. &nbsp;开启被禁止的xp_cmdshell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421580443542.png" title="1504421580443542.png" alt="2-5-2.png"/><noscript><img src="/uploads/20170903/1504421580443542.png" title="1504421580443542.png" alt="2-5-2.png"/></noscript></p>
<p style="text-align: center;">图2-5-2 开启xp_cmdshell</p>
<p style="text-align: left;">3. &nbsp;xp_cmdshell被删除后，使用SP_OACreate执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421591248944.png" title="1504421591248944.png" alt="2-5-3.png"/><noscript><img src="/uploads/20170903/1504421591248944.png" title="1504421591248944.png" alt="2-5-3.png"/></noscript></p>
<p style="text-align: center;">图2-5-3 使用SP_OACreate执行shell</p>
<p style="text-align: left;">4.&nbsp;&nbsp;开启CLR enabled选项，使用SQL Server CLR执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421601125598.png" title="1504421601125598.png" alt="2-5-4.png"/><noscript><img src="/uploads/20170903/1504421601125598.png" title="1504421601125598.png" alt="2-5-4.png"/></noscript></p>
<p style="text-align: center;">图2-5-4 开启CLR enabled选项</p>
<p style="text-align: left;">5.&nbsp;&nbsp;注册regsvr32.dll执行远端代码所需的组件，使用regsvr32.dll执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421611936674.png" title="1504421611936674.png" alt="2-5-5.png"/><noscript><img src="/uploads/20170903/1504421611936674.png" title="1504421611936674.png" alt="2-5-5.png"/></noscript></p>
<p style="text-align: center;">图2-5-5 注册相关组件</p>
<p style="text-align: left;">6.&nbsp;&nbsp;通过沙盒执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421621855736.png" title="1504421621855736.png" alt="2-5-6.png"/><noscript><img src="/uploads/20170903/1504421621855736.png" title="1504421621855736.png" alt="2-5-6.png"/></noscript></p>
<p style="text-align: center;">图2-5-6 通过沙盒执行shell</p>
<p style="text-align: left;">7.&nbsp;&nbsp;开启SQL Agent服务，使用SQL Agent服务执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421632337742.png" title="1504421632337742.png" alt="2-5-7.png"/><noscript><img src="/uploads/20170903/1504421632337742.png" title="1504421632337742.png" alt="2-5-7.png"/></noscript></p>
<p style="text-align: center;">图2-5-7 开启SQL Agent服务</p>
<p style="text-align: left;">Cracker:mssql模块所执行的主要功能主要包括以下几方面：</p>
<p style="text-align: left;">1.&nbsp;&nbsp;在c:windowssystem32wbem下创建批处理文件123.dat，并在该文件中写入内容。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421643706783.png" title="1504421643706783.png" alt="2-5-8.png"/><noscript><img src="/uploads/20170903/1504421643706783.png" title="1504421643706783.png" alt="2-5-8.png"/></noscript></p>
<p style="text-align: center;">图2-5-8 创建123.bat</p>
<p style="text-align: left;">该批处理文件执行的功能包括对一些程序运行所涉及到的文件和文件夹进行权限设置；使用regsvr32.dll执行远端代码；判断是否存在item.dat，若存在则调用rundll32执行该程序。item.dat是修改自PCShare（github：https://github.com/isuhao/pcshare）的远程控制程序，C&amp;C通过item.dat控制Bot。</p>
<p style="text-align: left;">2.&nbsp;创建文件PerfStringse.ini，并在该文件中写入内容。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421654888790.png" title="1504421654888790.png" alt="2-5-9.png"/><noscript><img src="/uploads/20170903/1504421654888790.png" title="1504421654888790.png" alt="2-5-9.png"/></noscript></p>
<p style="text-align: center;">图2-5-9 创建PerfStringse.ini</p>
<p style="text-align: left;">该文件是个组策略模板文件，主要是禁止一些涉及到的文件的访问权限。在创建该模板文件之后调用secedit.exe配置组策略。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421664256076.png" title="1504421664256076.png" alt="2-5-10.png"/><noscript><img src="/uploads/20170903/1504421664256076.png" title="1504421664256076.png" alt="2-5-10.png"/></noscript></p>
<p style="text-align: center;">图2-5-10 调用secedit.exe配置组策略</p>
<p style="text-align: left;">3.&nbsp;&nbsp;在c:windowssystem下创建文件myusa.dvr，并在文件中写入内容。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421671523655.png" title="1504421671523655.png" alt="2-5-11.png"/><noscript><img src="/uploads/20170903/1504421671523655.png" title="1504421671523655.png" alt="2-5-11.png"/></noscript></p>
<p style="text-align: center;">图2-5-11 创建myusa.dvr</p>
<p style="text-align: left;">myusa.dvr是个ftp下载脚本，主要功能是从down.mys2016.info下载文件1.dat到本地c:windowssystem路径下，命名为myusago.dvr；下载1.bat到本地c:windowssystem路径下，命名为backs.bat。</p>
<p style="text-align: left;">myusago.dvr也是个ftp下载脚本，从down.mys2016.info下载多个文件到本地；backs.bat用于记录系统时间并写入1.txt中。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421681457022.png" title="1504421681457022.png" alt="2-5-12.png"/><noscript><img src="/uploads/20170903/1504421681457022.png" title="1504421681457022.png" alt="2-5-12.png"/></noscript></p>
<p style="text-align: center;">图2-5-12 myusago.dvr内容</p>
<p style="text-align: left;">下载的文件中，item.dat是C&amp;C用于控制Bot的远程控制软件；ms.rar实际上就是Bot程序的更新程序cab.exe；ss.bat和Cracker:mssql模块释放的123.bat是同一个文件；未找到op7key.rar文件，猜测与爆破字典类似。</p>
<p style="text-align: left;">从myusago.dvr下载的文件不难看出，Bot程序除了执行Cracker:mssql模块中硬编码的恶意代码之外，还通过云端下载相应的恶意程序，这保障与Bot程序相关联的恶意代码能够持续驻留。在分析的过程中我们发现，用于进行环境配置和程序运行控制的123.bat批处理脚本是更新最为频繁的，从2017年4月份起更新次数超过了10次。</p>
<p style="text-align: left;">myusago.dvr和myusa.dvr将作为ftp的参数写入命令行中并加入SQL Agent的Job中，每天执行一次。</p>
<p style="text-align: left;">4.&nbsp;&nbsp;将Bot程序加入SQL Agent的job中，并附带参数“-syn 1000”。每次SQL Agent启动时Bot程序也将启动。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421691507433.png" title="1504421691507433.png" alt="2-5-13.png"/><noscript><img src="/uploads/20170903/1504421691507433.png" title="1504421691507433.png" alt="2-5-13.png"/></noscript></p>
<p style="text-align: center;">图2-5-13 将Bot程序加入SQL Agent的Job中</p>
<p style="text-align: left;">5.&nbsp;&nbsp;以Job的形式每20分钟运行一次C：Progra~1mainsoftinstall.exe。该程序是一个挂机赚分软件。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421702383864.png" title="1504421702383864.png" alt="2-5-14.png"/><noscript><img src="/uploads/20170903/1504421702383864.png" title="1504421702383864.png" alt="2-5-14.png"/></noscript></p>
<p style="text-align: center;">图2-5-14 以Job形式执行install.exe</p>
<p style="text-align: left;">6.&nbsp;&nbsp;以Job的形式每20分钟执行C:windowsdebug，C:Progra~1shengda和C:Progra~1kugou2010路径下的所有exe。从我们的监控中发现，Bot程序所释放的挖矿机以及能给黑客带来直接收益的程序都存在于这几个路径中，黑客通过定时启动这些程序保证收益的源源不断。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421713281705.png" title="1504421713281705.png" alt="2-5-15.png"/><noscript><img src="/uploads/20170903/1504421713281705.png" title="1504421713281705.png" alt="2-5-15.png"/></noscript></p>
<p style="text-align: center;">图2-5-15 定时执行C:windowsdebug下的exe</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421722610658.png" title="1504421722610658.png" alt="2-5-16.png"/><noscript><img src="/uploads/20170903/1504421722610658.png" title="1504421722610658.png" alt="2-5-16.png"/></noscript></p>
<p style="text-align: center;">图2-5-16 定时执行C:Progra~1shengda下的exe</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421732996365.png" title="1504421732996365.png" alt="2-5-17.png"/><noscript><img src="/uploads/20170903/1504421732996365.png" title="1504421732996365.png" alt="2-5-17.png"/></noscript></p>
<p style="text-align: center;">图2-5-17 定时执行C:Progra~1kugou2010下的exe</p>
<p style="text-align: left;">7.&nbsp;&nbsp;创建ftp下载脚本msinfo.dat，该脚本从down.mys2016.info下载文件到C:windowsdebug路径下，并命名为bss.exe。之后通过批处理脚本msinfo.bat调用ftp执行下载脚本，下载完成后启动bss.exe，并删除这两个脚本。bss.exe疑似是个远控木马。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421741629523.png" title="1504421741629523.png" alt="2-5-18.png"/><noscript><img src="/uploads/20170903/1504421741629523.png" title="1504421741629523.png" alt="2-5-18.png"/></noscript></p>
<p style="text-align: center;">图2-5-18 msinfo.dat内容</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421749818573.png" title="1504421749818573.png" alt="2-5-19.png"/><noscript><img src="/uploads/20170903/1504421749818573.png" title="1504421749818573.png" alt="2-5-19.png"/></noscript></p>
<p style="text-align: center;">图2-5-19 msinfo.bat内容</p>
<p style="text-align: left;">8.&nbsp;&nbsp;将item.dat和123.bat加入启动项中。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421761967131.png" title="1504421761967131.png" alt="2-5-20.png"/><noscript><img src="/uploads/20170903/1504421761967131.png" title="1504421761967131.png" alt="2-5-20.png"/></noscript></p>
<p style="text-align: center;">图2-5-20 将item.dat加入启动项中</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421772775971.png" title="1504421772775971.png" alt="2-5-21.png"/><noscript><img src="/uploads/20170903/1504421772775971.png" title="1504421772775971.png" alt="2-5-21.png"/></noscript></p>
<p style="text-align: center;">图2-5-21 将123.bat加入启动项中</p>
<p style="text-align: left;">9.&nbsp;&nbsp;&nbsp;确定权限允许之后，删除SQL用户，并设置SQL SA（超级管理员）帐户及密码，同时添加多个SQL帐户。完成这步操作之后，黑客正式接管该计算机的SQL Server，管理员无法再通过之前的帐户登录SQL Server。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421784193632.png" title="1504421784193632.png" alt="2-5-22.png"/><noscript><img src="/uploads/20170903/1504421784193632.png" title="1504421784193632.png" alt="2-5-22.png"/></noscript></p>
<p style="text-align: center;">图2-5-22 添加SQL SA</p>
<p style="text-align: left;">Cracker:mssql模块还通过SQL Server执行多段shellcode，大部分的shellcode都以SQL Agent的Job形式存在并定期执行。</p>
<p style="text-align: left;">第一段shellcode使用wmi中的ActiveScriptEventConsumer类执行脚本代码。该脚本读取http://www.cyg2016.xyz:8888/test.html网页内容，并根据网页内容获取第二组网址，下载文件并执行。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421797228510.png" title="1504421797228510.png" alt="2-5-23.png"/><noscript><img src="/uploads/20170903/1504421797228510.png" title="1504421797228510.png" alt="2-5-23.png"/></noscript></p>
<p style="text-align: center;">图2-5-23 第一段shellcode内容</p>
<p style="text-align: left;">下载的文件包括更新程序cabs.exe和挖矿机lsmosee.exe。挖矿机修改自xmr-stak（github：https://github.com/fireice-uk/xmr-stak-cpu），以32位形式编译，作者在此挖矿机中添加了一个模块，当需要64位挖矿机时，该模块将从C&amp;C下载64位的挖矿机lsmose.exe到本地执行。本样本中，32位挖矿机的路径为“C:windowshelp”，而64位挖矿机的路径修改为“C:windowsdebug”。由于作者添加了SQL Agent的Job，使“C:windowsdebug”路径下的exe文件每20分钟执行一次，猜测作者将挖矿机保存到此目录下是为了保证挖矿机能够稳定运行。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421811615410.png" title="1504421811615410.png" alt="2-5-24.png"/><noscript><img src="/uploads/20170903/1504421811615410.png" title="1504421811615410.png" alt="2-5-24.png"/></noscript></p>
<p style="text-align: center;">图2-5-24 下载挖矿机和更新程序</p>
<p style="text-align: left;">第二段shellcode使用js脚本执行恶意代码，脚本功能与第一段shellcode中的jscript代码相同。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421827663473.png" title="1504421827663473.png" alt="2-5-25.png"/><noscript><img src="/uploads/20170903/1504421827663473.png" title="1504421827663473.png" alt="2-5-25.png"/></noscript></p>
<p style="text-align: center;">图2-5-25 第二段shellcode内容</p>
<p style="text-align: left;">第三段shellcode同样使用wmi脚本执行jscript代码，所执行的功能与创建的批处理文件123.bat的功能相同，猜测作者此举为了防止文件123.bat被杀毒软件清除而执行的备用方案。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421851585204.png" title="1504421851585204.png" alt="2-5-26.png"/><noscript><img src="/uploads/20170903/1504421851585204.png" title="1504421851585204.png" alt="2-5-26.png"/></noscript></p>
<p style="text-align: center;">图2-5-26 第三段shellcode内容</p>
<p style="text-align: left;">第四段shellcode是第三段shellcode的js版本。不难发现，作者对于每段shellcode都准备了wmi和js两种版本，以确保脚本执行的稳定性。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421863931461.png" title="1504421863931461.png" alt="2-5-27.png"/><noscript><img src="/uploads/20170903/1504421863931461.png" title="1504421863931461.png" alt="2-5-27.png"/></noscript></p>
<p style="text-align: center;">图2-5-27 第四段shellcode内容</p>
<p style="text-align: left;">第五段shellcode通过恢复cmdshell，恢复SP_OACreate等方式保证能通过SQL Server执行shell，猜测作者通过Job定期执行这段shellcode以保证shell能长期存活。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421875847164.png" title="1504421875847164.png" alt="2-5-28.png"/><noscript><img src="/uploads/20170903/1504421875847164.png" title="1504421875847164.png" alt="2-5-28.png"/></noscript></p>
<p style="text-align: center;">图2-5-28 第五段shellcode内容</p>
<p style="text-align: left;">第六段shellcode删除C:Documents and SettingsDefault UserLocal SettingsTemporary Internet FilesContent.IE5路径下的文件。由于下载文件时都会在该目录下留下对应的tmp文件，作者此举是为了防止用户通过该目录发现可疑文件，可见作者对痕迹的清理十分细心。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421892359844.png" title="1504421892359844.png" alt="2-5-29.png"/><noscript><img src="/uploads/20170903/1504421892359844.png" title="1504421892359844.png" alt="2-5-29.png"/></noscript></p>
<p style="text-align: center;">图2-5-29 第六段shellcode内容</p>
<p style="text-align: left;">第七段shellcode使用js脚本访问http://www.cyg2016.xyz:8888/kill.html，该页面是个文件名列表。脚本搜寻系统中是否存在与该页面返回的文件名相同的文件，若存在则结束对应进程并将文件删除。这些文件大多数是一些其他入侵者释放的挖矿机。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421921875917.png" title="1504421921875917.png" alt="2-5-30.png"/><noscript><img src="/uploads/20170903/1504421921875917.png" title="1504421921875917.png" alt="2-5-30.png"/></noscript></p>
<p style="text-align: center;">图2-5-30 第七段shellcode内容</p>
<p style="text-align: left;">透过这些文件名我们发现了一个有趣的现象，在被删除的文件中包含了一些和Bot程序释放的挖矿机文件名十分相似的文件，例如C:windowsdebuglsmosee.exe（Bot程序释放的挖矿机是c:windowshelplsmosee.exe和C:windowsdebuglsmose.exe）。是作者通过这样的方式进行更新，淘汰旧的挖矿机，还是其他入侵者利用Bot程序定时执行C:windowsdebug路径下程序的特性坐收渔翁之利就不得而知了。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421933930425.png" title="1504421933930425.png" alt="2-5-31.png"/><noscript><img src="/uploads/20170903/1504421933930425.png" title="1504421933930425.png" alt="2-5-31.png"/></noscript></p>
<p style="text-align: center;">图2-5-31 待删除文件列表</p>
<p style="text-align: left;">第八段shellcode将123.bat加入启动项中，此处不再赘述。</p>
<p style="text-align: left;">第九段shellcode从http://down.mys2016.info:280下载文件到C:WINDOWS路径下，并命名为ps.exe。ps.exe实际上是PsExec，一款强大的远程执行工具，黑客在每台入侵的计算中部署该工具，使每台计算机成为一个控制端，方便构建一个庞大的僵尸网络。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421946735417.png" title="1504421946735417.png" alt="2-5-32.png"/><noscript><img src="/uploads/20170903/1504421946735417.png" title="1504421946735417.png" alt="2-5-32.png"/></noscript></p>
<p style="text-align: center;">图2-5-32 第九段shellcode内容</p>
<p style="text-align: left;">第十段shellcode主要是完成SQL提权的一系列操作。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421955368408.png" title="1504421955368408.png" alt="2-5-33.png"/><noscript><img src="/uploads/20170903/1504421955368408.png" title="1504421955368408.png" alt="2-5-33.png"/></noscript></p>
<p style="text-align: center;">图2-5-33 第十段shellcode内容</p>
<p style="text-align: left;">第十一段shellcode是利用SQL Server CLR执行shell的payload，从payload中可以发现其访问http://www.cyg2016.xyz:8888/clr.txt并执行该页面中返回的内容。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421963385423.png" title="1504421963385423.png" alt="2-5-34.png"/><noscript><img src="/uploads/20170903/1504421963385423.png" title="1504421963385423.png" alt="2-5-34.png"/></noscript></p>
<p style="text-align: center;">图2-5-34 payload的部分内容</p>
<p style="text-align: left;">该页面和http://www.cyg2016.xyz:8888/test.html一致，即下载更新程序和挖矿机到计算机中并运行。</p>
<p style="text-align: left;">Cracker:mssql模块完成了Bot程序几乎所有要完成的功能，包括更新、挖矿、清除同类程序、定时任务以及SQL Server管理员账户的设置。由于作者目前的密码字典中将mssql作为唯一攻击目标，因此Cracker:mssql模块如此完善也是可以理解的。若之后作者开启了其他攻击方式，其他的Cracker模块也将变得更加完善。</p>
<p style="text-align: left;">5.2 &nbsp;Cracker:Telnet</p>
<p style="text-align: left;">Cracker:Telnet模块是除了Cracker:mssql模块之外较为完善的一个模块。作者充分利用mirai僵尸网络的优点构建了一套类似于mirai的Telnet入侵模块。</p>
<p style="text-align: left;">在执行Cracker:Telnet模块之前，Bot程序在ServerAgent模块中配置Telnet入侵攻击的payload。ServerAgent模块会根据不同的平台架构从资源段中读取payload并将其转化为十六进制字节码的形式。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421974417584.png" title="1504421974417584.png" alt="2-5-35.png"/><noscript><img src="/uploads/20170903/1504421974417584.png" title="1504421974417584.png" alt="2-5-35.png"/></noscript></p>
<p style="text-align: center;">图2-5-35 从资源段读取payload</p>
<p style="text-align: left;">在payload中我们发现一些mirai相关的标识，通过对比发现Bot程序所使用的payload就是mirai僵尸网络的payload（github：https://github.com/jgamblin/Mirai-Source-Code/tree/master/loader/bins），这些payload适用于不同的平台架构（arm，arm7，m68k，mips，mpsl，ppc，sh4，spc，x86）。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421981421524.png" title="1504421981421524.png" alt="2-5-36.png"/><noscript><img src="/uploads/20170903/1504421981421524.png" title="1504421981421524.png" alt="2-5-36.png"/></noscript></p>
<p style="text-align: center;">图2-5-36 payload中mirai的相关标识</p>
<p style="text-align: left;">除了payload与mirai相同之外，Cracker:Telnet模块也基本修改自mirai源码，包含密码爆破功能和入侵功能。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421990281443.png" title="1504421990281443.png" alt="2-5-37.png"/><noscript><img src="/uploads/20170903/1504421990281443.png" title="1504421990281443.png" alt="2-5-37.png"/></noscript></p>
<p style="text-align: center;">图2-5-37 Cracker:Telnet模块中的mirai特征</p>
<p style="text-align: left;">mirai在通过Telnet入侵之前会配置一个ip地址用于作为report服务器地址，用于返回扫描结果，在分析中我们也发现了一个疑似report服务器ip地址。如果Bot程序的启动参数中包含“-srv”，则ServerAgent模块会从密码字典中读取名为telnetip的子键的键值，该键值是个ip地址，之后被传入Cracker:Telnet模块中。如果启动参数中包含“-cli”，Bot程序会从当前目录下的wpdconfig.ini文件中读取ip地址。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504421999527845.png" title="1504421999527845.png" alt="2-5-38.png"/><noscript><img src="/uploads/20170903/1504421999527845.png" title="1504421999527845.png" alt="2-5-38.png"/></noscript></p>
<p style="text-align: center;">图2-5-38 密码字典中的report服务器地址</p>
<p style="text-align: left;">由于Cracker:Telnet模块与mirai相差无几，在此不再赘述，感兴趣的读者可以查看mirai源码（github：https://github.com/jgamblin/Mirai-Source-Code）。</p>
<p style="text-align: left;">5.3 &nbsp;Cracker:RDP</p>
<p style="text-align: left;">Cracker:RDP模块修改自hydra（github：https://github.com/vanhauser-thc/thc-hydra）的RDP部分。hydra是一款支持多种网络服务的强大的暴力破解工具，Cracker:RDP模块使用了其源码中的rdp.c文件，用于对开放了RDP服务端口的计算机进行爆破。不同于Cracker:mssql模块和Cracker:Telnet模块，Cracker:RDP模块只是进行爆破而未加入任何入侵以及代码执行的功能。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422008865141.png" title="1504422008865141.png" alt="2-5-39.png"/><noscript><img src="/uploads/20170903/1504422008865141.png" title="1504422008865141.png" alt="2-5-39.png"/></noscript></p>
<p style="text-align: center;">图2-5-39 Cracker:RDP模块扫描端口</p>
<p style="text-align: left;">5.4 &nbsp;Cracker:CCTV</p>
<p style="text-align: left;">Cracker:CCTV模块是一个CCTV摄像头入侵模块。该模块会向http://Targetip:port/shell?&#8230;（…的内容猜测是用户名&amp;密码）发送GET请求，一旦请求返回的状态值不为400，401，403，404或500，则认为该ip地址和端口号对应的CCTV摄像头可以被入侵。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422016315367.png" title="1504422016315367.png" alt="2-5-40.png"/><noscript><img src="/uploads/20170903/1504422016315367.png" title="1504422016315367.png" alt="2-5-40.png"/></noscript></p>
<p style="text-align: center;">图2-5-40 Cracker:CCTV模块扫描CCTV摄像头</p>
<p style="text-align: left;">由于在密码字典wpd.dat中并没有配置CCTV相关的键值,猜测该模块是和Cracker:Telnet模块结合使用的。由于mirai中含有识别特定IOT设备的代码，而Cracker:Telnet模块又是修改自mirai，猜测当Cracker:Telnet模块发现某台设备为CCTV摄像机时则通过Cracker:CCTV模块进行入侵。</p>
<p style="text-align: left;">5.5 其他模块</p>
<p style="text-align: left;">在Bot程序早期的版本中（2016年10月编译的版本）还发现了Cracker:MySQL模块，Cracker:SSH模块和Cracker:WMI模块，这些模块的功能都是在被入侵的计算机中执行shell。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422063623943.png" title="1504422063623943.png" alt="2-5-41.png"/><noscript><img src="/uploads/20170903/1504422063623943.png" title="1504422063623943.png" alt="2-5-41.png"/></noscript></p>
<p style="text-align: center;">图2-5-41 Cracker:MySQL模块</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422073455548.png" title="1504422073455548.png" alt="2-5-41(1).png"/><noscript><img src="/uploads/20170903/1504422073455548.png" title="1504422073455548.png" alt="2-5-41(1).png"/></noscript></p>
<p style="text-align: center;">图2-5-41 Cracker:WMI模块</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422083119190.png" title="1504422083119190.png" alt="2-5-41(2).png"/><noscript><img src="/uploads/20170903/1504422083119190.png" title="1504422083119190.png" alt="2-5-41(2).png"/></noscript></p>
<p style="text-align: center;">图2-5-41 Cracker:WMI模块</p>
<p style="text-align: left;">不过这几个模块在之后的版本中都被移除了，而原本功能简单的Cracker:mssql模块在之后的版本中得到了完善。</p>
<p style="text-align: left;"><strong>6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cService模块分析</strong></p>
<p style="text-align: left;">cService模块用于管理Bot服务，Bot服务是Service形式的Bot程序。</p>
<p style="text-align: left;">当Bot程序的启动参数中包含“-create”时，cService模块创建名为“xWinWpdSrv”的服务，该服务以“-s –syn 1500”作为启动参数启动Bot程序。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422095437086.png" title="1504422095437086.png" alt="2-6-1.png"/><noscript><img src="/uploads/20170903/1504422095437086.png" title="1504422095437086.png" alt="2-6-1.png"/></noscript></p>
<p style="text-align: center;">图2-6-1 创建Bot服务</p>
<p style="text-align: left;">当Bot程序的启动参数包含“-delete”时，cService模块删除“xWinWpdSrv”服务。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422108259377.png" title="1504422108259377.png" alt="2-6-2.png"/><noscript><img src="/uploads/20170903/1504422108259377.png" title="1504422108259377.png" alt="2-6-2.png"/></noscript></p>
<p style="text-align: center;">图2-6-2 删除Bot服务</p>
<p style="text-align: left;">当Bot程序的启动参数包含“-start”时，cService模块启动“xWinWpdSrv”服务。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422116401973.png" title="1504422116401973.png" alt="2-6-3.png"/><noscript><img src="/uploads/20170903/1504422116401973.png" title="1504422116401973.png" alt="2-6-3.png"/></noscript></p>
<p style="text-align: center;">图2-6-3 启动Bot服务</p>
<p style="text-align: left;">当Bot程序的启动参数包含“-stop”时，cService模块停止“xWinWpdSrv”服务。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422125328799.png" title="1504422125328799.png" alt="2-6-4.png"/><noscript><img src="/uploads/20170903/1504422125328799.png" title="1504422125328799.png" alt="2-6-4.png"/></noscript></p>
<p style="text-align: center;">图2-6-4 停止Bot服务</p>
<p style="text-align: left;">Bot程序模块众多，并且各模块之间关系紧密，相互配合。此外，Bot程序与其他组件相辅相成，以保证攻击者对计算机的持久控制以及僵尸网络的不断壮大。以下将用一个关系图描述Bot程序与其他组件之间的关联。</p>
<p style="text-align:center"><img src="http://img.4hou.com/wp-content/themes/4houv2/img/lazy.gif" data-original="/uploads/20170903/1504422134811131.png" title="1504422134811131.png" alt="2-6-5.png"/><noscript><img src="/uploads/20170903/1504422134811131.png" title="1504422134811131.png" alt="2-6-5.png"/></noscript></p>
<p style="text-align: center;">图2-6-5 Bot程序与其他组件关系图</p>
<p style="text-align: left;"><span style="font-size: 20px;"><strong>第三部分 防御总结</strong></span></p>
<p style="text-align: left;">从僵尸网络当前的攻击重点来看，防范其通过1433端口入侵计算机是非常有必要的。此外，Bot程序还有多种攻击方式尚未使用，这些攻击方式可能在未来的某一天被开启，因此也需要防范可能发生的攻击。对此，我们总结以下几个防御策略：</p>
<p style="text-align: left;">1.对于未遭到入侵的服务器，注意msSQL，RDP，Telnet等服务的弱口令问题。如果这些服务设置了弱口令，需要尽快修改；</p>
<p style="text-align: left;">2.对于无需使用的服务不要随意开放，开放的服务是黑客入侵的前提。对于必须使用的服务，注意相关服务的弱口令问题；</p>
<p style="text-align: left;">3.特别注意445端口的开放情况。由于黑客曾经使用永恒之蓝漏洞入侵计算机，不排除黑客故技重施。及时打上补丁更新操作系统是非常有必要的。</p>
<p style="text-align: left;">4.关注服务器运行状况，注意CPU占用率和进程列表和网络流量情况可以及时发现系统存在的异常。此外，注意系统账户情况，禁用不必要的账户。</p>
<p style="text-align: left;">5.对于网络摄像头持有者，建议修改默认密码以防止黑客直接使用默认密码爆破。</p>
<p style="text-align: left;">该僵尸网络现今主要依靠端口扫描和弱口令爆破进行传播，但其在“永恒之蓝”漏洞攻击武器出现之初就利用该武器入侵了一定数量的计算机，可见其对于最新曝光的漏洞利用以及攻击方法的掌握十分迅速，因此需时刻警惕其可能发起的重大攻击。</p>
<p style="text-align: left;">附录</p>
<p style="text-align: left;">1. 相关文件MD5</p>
<pre class="brush:html;toolbar:false">042ac6f93597e80112a1c42fdb79e3df&nbsp;
42c0b80fe0a28401f2b64a522f1dea84&nbsp;
d7378a709dc4deb1a034676c43de503a&nbsp;
ad0496f544762a95af11f9314e434e94&nbsp;
5707f1e71da33a1ab9fe2796dbe3fc74&nbsp;
5af3bab901735575d5d0958921174b17&nbsp;
6a936ad69c708f3ac70da2f76b8b619e&nbsp;
fe04395c95cdd102aeabbf6b915c1a5e&nbsp;
f068b7be8685c91bddbb186f6fad7962&nbsp;
10ace2e06cc8b5656d38eb2e6ed4f079&nbsp;
a38a1e11f7222f7c48aaf33e20c78f48&nbsp;
6b13994f83dad0d45764911a88564a7b&nbsp;
f249446c28ab983c395ca4e198db3528&nbsp;
7b7b1c2a2201aebf22aaf8fe7901c0e9&nbsp;
ca748d5eac754e0b0026474ae7a51f3f&nbsp;
e81e96be9d90a1a1a0871196d0374c26&nbsp;
75f6543447b4726c56d183951526b379&nbsp;
98d615c222293ca937ab4b1b4a7c8118&nbsp;
c3a5859a5d438ff3f62d81ec3894d9ca</pre>
<p>2. 相关ip地址和域名</p>
<pre class="brush:html;toolbar:false">67.229.144.218&nbsp;
13.59.110.123&nbsp;
209.58.186.145&nbsp;
www.cyg2016.xyz&nbsp;
js.mys2016.infodown.mys2016.info&nbsp;
ftp.oo000oo.mewmi.oo000oo.clubdown.oo000oo.club&nbsp;
js.f4321y.comup.f4321y.com&nbsp;
wmi.mykings.topjs.mykings.pw&nbsp;
xmr.5b6b7b.rujs.5b6b7b.ru&nbsp;
64.myxmr.pw</pre>
<p style="text-align: left;">3. 密码字典</p>
<pre class="brush:html;toolbar:false">root&nbsp;
root&nbsp;&nbsp;&nbsp;root&nbsp;
root&nbsp;&nbsp;&nbsp;123&nbsp;
root&nbsp;&nbsp;&nbsp;123456&nbsp;
phpmind&nbsp;&nbsp;&nbsp;phpmind&nbsp;
root&nbsp;&nbsp;&nbsp;admin123&nbsp;
root&nbsp;&nbsp;&nbsp;password&nbsp;
root&nbsp;&nbsp;&nbsp;root123&nbsp;
root&nbsp;&nbsp;&nbsp;123456*a&nbsp;
mysqld&nbsp;&nbsp;&nbsp;654321*a&nbsp;
msSQL</pre>
<pre class="brush:html;toolbar:false">sa&nbsp;
sa&nbsp;sa&nbsp;
sa&nbsp;123&nbsp;
sa&nbsp;123456&nbsp;
sa&nbsp;password&nbsp;
sa&nbsp;525464&nbsp;
sa&nbsp;shabixuege!@#&nbsp;
vice&nbsp;vice&nbsp;
sa&nbsp;3xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
sa&nbsp;4xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;3xqan7,mm`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;3xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;3xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4xqan7,mm`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
sa&nbsp;4xqbn7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4xqbn7,mm`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
sa&nbsp;4yqbn7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4yqbn7,mm`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
sa&nbsp;4yqbm7,m`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
mssqla&nbsp;4yqbm7,mm`~!@&nbsp;~#$%^&amp;*(),.;&nbsp;
kisadmin&nbsp;ypbwkfyjhyhgzj&nbsp;
hbv7&nbsp;zXJl@mwZ&nbsp;
bwsa&nbsp;bw99588399&nbsp;
ps&nbsp;740316&nbsp;
uep&nbsp;U_tywg_2008&nbsp;
sa&nbsp;sa123&nbsp;
sa&nbsp;sasa&nbsp;
sa&nbsp;12345&nbsp;
sa&nbsp;sunshine&nbsp;
sa&nbsp;trustno1&nbsp;
sa&nbsp;111111&nbsp;
sa&nbsp;iloveyou&nbsp;
sa&nbsp;sql2005&nbsp;
sa&nbsp;DiscoJack&nbsp;
sa&nbsp;1&nbsp;
401hk&nbsp;401hk!@#&nbsp;
sa&nbsp;admin@123&nbsp;
sa&nbsp;sa2008&nbsp;
sa&nbsp;123123&nbsp;
sa&nbsp;1111&nbsp;
sa&nbsp;1234&nbsp;
sa&nbsp;12345678&nbsp;
sa&nbsp;1234567890&nbsp;
sa&nbsp;passw0wd&nbsp;
sa&nbsp;abc&nbsp;
sa&nbsp;abc123&nbsp;
sa&nbsp;abcdefg&nbsp;
sysdba&nbsp;masterkey&nbsp;
sa&nbsp;bing_1433&nbsp;xing&nbsp;
sa&nbsp;^_^$$wanniMaBI::&nbsp;1433&nbsp;vl&nbsp;
sa&nbsp;sapassword&nbsp;
sa&nbsp;linwen5555&nbsp;
su&nbsp;vice_1433&nbsp;vice&nbsp;
sa&nbsp;Aa123456&nbsp;
sa&nbsp;ABCabc123&nbsp;
sa&nbsp;sqlpassword&nbsp;
sa&nbsp;1qaz2wsx&nbsp;
sa&nbsp;1qaz!QAZ&nbsp;
sa&nbsp;sql2008</pre>
<pre class="brush:html;toolbar:false">!!Huawei&nbsp;@HuaweiHgw&nbsp;
system&nbsp;ping&nbsp;;sh&nbsp;
root&nbsp;1001chin&nbsp;
root&nbsp;xc3511&nbsp;
root&nbsp;vizxv&nbsp;
admin&nbsp;admin&nbsp;
5up&nbsp;5up&nbsp;
root&nbsp;
root&nbsp;jvbzd&nbsp;
root&nbsp;root&nbsp;
root&nbsp;123&nbsp;
root&nbsp;hg2x0&nbsp;
root&nbsp;123456&nbsp;
admin&nbsp;admin1234&nbsp;
root&nbsp;admin&nbsp;
superadmin&nbsp;Is$uper@dmin&nbsp;
admin&nbsp;
support&nbsp;support&nbsp;
admin&nbsp;123456&nbsp;
1234&nbsp;1234&nbsp;
Admin&nbsp;Admin&nbsp;
admin&nbsp;ho4uku6at&nbsp;
admin&nbsp;123&nbsp;
admin&nbsp;1234567&nbsp;
admin&nbsp;12345&nbsp;
root&nbsp;12345&nbsp;
admin&nbsp;root&nbsp;
e8telnet&nbsp;e8telnet&nbsp;
telecomadmin&nbsp;nE7jA%5m&nbsp;
e8ehomeasb&nbsp;e8ehomeasb&nbsp;
telnetadmin&nbsp;telnetadmin&nbsp;
e8ehome&nbsp;e8ehome&nbsp;
Zte521&nbsp;Zte521&nbsp;
root&nbsp;Zte521&nbsp;
user&nbsp;password&nbsp;
admin&nbsp;password&nbsp;
root&nbsp;password&nbsp;
user&nbsp;user&nbsp;
root&nbsp;888888&nbsp;
root&nbsp;grouter&nbsp;
root&nbsp;666666&nbsp;
guest&nbsp;12345&nbsp;
admin&nbsp;ZmqVfoSIP&nbsp;
admin&nbsp;888888&nbsp;
admin&nbsp;guest&nbsp;
admin&nbsp;666666&nbsp;
Admin&nbsp;111111&nbsp;
admin&nbsp;oelinux123&nbsp;
Administrator&nbsp;meinsm&nbsp;
adminlvjh&nbsp;adminlvjh123&nbsp;
default&nbsp;antslq&nbsp;
root&nbsp;telnet&nbsp;
guest&nbsp;admin&nbsp;
netgear&nbsp;netgear&nbsp;
realtek&nbsp;realtek&nbsp;
root&nbsp;88888888&nbsp;
service&nbsp;service&nbsp;
root&nbsp;cat1029&nbsp;
system&nbsp;system&nbsp;
root&nbsp;oelinux123&nbsp;
root&nbsp;tl789&nbsp;
telnet&nbsp;telnet&nbsp;
root&nbsp;GM8182&nbsp;
user&nbsp;qweasdzx&nbsp;
root&nbsp;hunt5759&nbsp;
root&nbsp;rootpassword&nbsp;
zte&nbsp;zte&nbsp;
root&nbsp;cisco&nbsp;
root&nbsp;telecomadmin&nbsp;
root&nbsp;12345678&nbsp;
root&nbsp;default&nbsp;
huawei&nbsp;admin@huawei.com&nbsp;
root&nbsp;solokey&nbsp;
root&nbsp;twe8ehome&nbsp;
dvr&nbsp;dvr&nbsp;
supervisor&nbsp;supervisor&nbsp;
root&nbsp;1234567890&nbsp;
root&nbsp;0123456789&nbsp;
root&nbsp;rootroot&nbsp;
Manager&nbsp;manager&nbsp;
admin&nbsp;admin888&nbsp;
useradmin&nbsp;useradmin&nbsp;
ubnt&nbsp;ubnt&nbsp;
root&nbsp;dvr&nbsp;
cusadmin&nbsp;highspeed&nbsp;
cisco&nbsp;cisco&nbsp;
admin&nbsp;smcadmin&nbsp;
h3c&nbsp;h3c&nbsp;
admin&nbsp;benq1234&nbsp;
admin&nbsp;12345678&nbsp;
root&nbsp;PASSWD&nbsp;
root&nbsp;passwd&nbsp;
ROOT&nbsp;PASSWD&nbsp;
huawei&nbsp;huawei&nbsp;
root&nbsp;h3c&nbsp;
root&nbsp;nmgx_wapia&nbsp;
toor&nbsp;toor&nbsp;
Huawei&nbsp;Huawei&nbsp;
admin&nbsp;private&nbsp;
root&nbsp;private</pre>
<pre class="brush:html;toolbar:false">root&nbsp;
root&nbsp;root&nbsp;
root&nbsp;123&nbsp;
root&nbsp;123456&nbsp;
root&nbsp;i826y3tz&nbsp;
root&nbsp;password&nbsp;
ubnt&nbsp;ubnt&nbsp;
ubnt&nbsp;admin&nbsp;
root&nbsp;gwevrk7f@qwSX$fd</pre>
<pre class="brush:html;toolbar:false">administrator</pre>
<pre class="brush:html;toolbar:false">administrator&nbsp;123&nbsp;
administrator&nbsp;123456&nbsp;
administrator&nbsp;
administrator&nbsp;1234&nbsp;
administrator&nbsp;12345&nbsp;
administrator&nbsp;5201314&nbsp;
administrator&nbsp;1qaz2wsx&nbsp;
administrator&nbsp;Aa123456&nbsp;
administrator&nbsp;qwe123!@#&nbsp;
administrator&nbsp;qwe!@#&nbsp;
administrator&nbsp;123qweqwe&nbsp;
administrator&nbsp;654321&nbsp;
administrator&nbsp;admin&nbsp;
administrator&nbsp;0&nbsp;
administrator&nbsp;password&nbsp;
administrator&nbsp;123123&nbsp;
piress&nbsp;adminlv123&nbsp;
administrator&nbsp;p@ssw0rd&nbsp;
administrator&nbsp;112233&nbsp;
administrator&nbsp;!@#123&nbsp;
administrator&nbsp;1qaz2wsx3edc&nbsp;
administrator&nbsp;!@#qwe&nbsp;
administrator&nbsp;zxcvbnm&nbsp;
administrator&nbsp;login&nbsp;
administrator&nbsp;admin123&nbsp;
administrator&nbsp;3389&nbsp;
administrator&nbsp;pass</pre>
                <div class="foot_description" style="background-color: #fff;">
                    本文为 360安全卫士 授权嘶吼发布，如若转载，请注明原文地址：                        <a href="http://www.4hou.com/info/news/7532.html" target=_blank>http://www.4hou.com/info/news/7532.html</a>
                                    </div>


                 </p>
            </div>
            <div class="article_con">
                <!--文章内容-->
            </div>
            <div class="post-like">
                <a href="javascript:;" data-action="ding" target=_blank data-id="7532" class="favorite">
                <div class="zanbox">
                    <dd class="zanbefor"></dd>
                    <dd class="zanafter"></dd>
                </div>
                <span class="zantext">点赞</span>
                <span class="count">
            0</span>
                </a>
            </div>
            <div class="active_bottom">
                <ul>
                    <a class="Sina" href="http://service.weibo.com/share/share.php?url=http://www.4hou.com/info/news/7532.html" title="分享到新浪微博" target="_blank"><li class="sinahover"></li></a>
                    <a onclick="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+encodeURIComponent(document.location.href));return false;" title="分享到QQ空间" class="WeChat" href="javascript:void(0)" target="_blank"><li class="kj"></li></a>
                    <a onclick="dashangToggle()" class="friend" title="分享到微信、朋友圈等" target="_blank"><li class="wx"></li></a>

                </ul>
                <div class="strat icons"><span class='wpfp-span'><img src='http://img.4hou.com/wp-content/plugins/wp-favorite-posts/img/star.png' alt='Favorite' title='Favorite' class='wpfp-img' /><a class='wpfp-link' href='?wpfpaction=add&amp;postid=7532' title='收藏' rel='nofollow'>收藏</a></span></div>
                <div class="hide_box"></div>
                <div class="shang_box">
                    <a class="shang_close" href="javascript:void(0)" onClick="dashangToggle()" title="关闭"><img src="http://img.4hou.com/wp-content/themes/4houv2/images/close.jpg" alt="取消" /></a>
                    <img class="shang_logo" width="120px" src="http://img.4hou.com/wp-content/themes/4houv2/images/logo.png" alt="嘶吼" />
                    <div class="shang_tit">
                        <p>感谢您的支持，我会继续努力的!</p>
                    </div>
                    <div class="shang_payimg">
                        <img src="http://www.4hou.com/wp-content/themes/4houv2/qrcode.php?url=http%3A%2F%2Fwww.4hou.com%2Finfo%2Fnews%2F7532.html" alt="扫码支持" title="扫一扫" />
                    </div>

                    <div class="shang_info">
                        <p>打开<span id="shang_pay_txt">微信</span>扫一扫后点击右上角即可分享哟</p>
                    </div>
                </div>
            </div>
            
            <div class="avatarbottomwrap">
                 <div class="avatarboxleft">
                        <div class="avatarbottom">
                           
                            <a class="upload-img"><img alt='360安全卫士' src='http://img.4hou.com/wp-content/uploads/2017/06/837963f5c83ace913607-96x96.jpg' class='avatar avatar-96 photo' height='96' width='96' /></a>
                        </div>
                        <h1 class="authornamebottom"><a href="http://www.4hou.com/member?Author=360安全卫士" class="upload-img" target=_blank>
                                360安全卫士                                                            <i class="mem_level"></i>
                             </a></h1>
                        <p class="authorzybottom">360安全卫士官方账号</p>

                        <div class="authorbottombox">
                            <!--<div class="gzbtn">关注</div>
                            <div class="sxbtn">私信</div>-->
                                                            <span class="gzbtn"  style="cursor: pointer;" onclick="location.href='/mybox?action=reply&to_user=360安全卫士&type=send'">发私信</span>
                                                    </div>
                 </div>
                <div class="authorother">
                 <a class="morearticle" href="http://www.4hou.com/member?Author=360安全卫士" class="upload-img" target=_blank>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                             </a>
                    <div class="swiper-container">

                                                    <div class="swiper-wrapper">
                               
                                <div class="swiper-slide">
                                                                        <div><a href="http://www.4hou.com/info/news/7640.html" target=_blank>
                                            <img data-original="/uploads/20170914/1505361302514047.png?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7579.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/5b720555de5a9a4f0d26.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/technology/7531.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/831a27cc5575363fdedd.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                        <div><a href="http://www.4hou.com/info/news/7532.html" target=_blank>
                                            <img data-original="http://img.4hou.com/wp-content/uploads/2017/09/a0138bc620abfb05a00a.jpg?imageView2/1/w/140/h/104/format/png"  class="wp-post-image"width="140" height="104"  />                                        </a></div>
                                                                    </div>
                            </div>
                                        </div>
                </div>
                <script type="text/javascript">
                    function dashangToggle(){
                        $(".hide_box").fadeToggle();
                        $(".shang_box").fadeToggle();
                    }
                </script>
                <script> 
                    var mySwiper = new Swiper('.swiper-container', {
                        direction : 'vertical',
                        pagination : '.swiper-pagination',
                        paginationClickable :true,
                        spaceBetween : 20
                    })
                </script>
            </div>
                            <div class="review" style="margin-bottom:80px;">
    <h3 id="reply-title" class="comment-reply-title">发表评论 <small></h3>
    <form action="http://www.4hou.com/wp-comments-post.php" method="post" id="commentform">
        <p class="commentname"><label for="author">昵称</label>
            <input type="text" name="author" id="author" value="" size="14" tabindex="1" aria-required='true' placeholder = "请输入昵称" required />
        </p>
        <p class="commenteml">
            <label for="email">邮箱</label>
            <input type="text" name="email" id="email" value="" size="25" tabindex="2" aria-required='true' placeholder = "请输入邮箱地址" required />
        </p>
        <p class="comment-form-comment">
           <label for="comment">评论</label>
           <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea>
        </p>

        <p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
        <input type='hidden' name='comment_post_ID' value="7532" id='comment_post_ID' />
            <input type='hidden' name='comment_parent' id='comment_parent' value='0' />
        </p>
    </form>
					
<div class="new-review">
   <ol class="commentlist">
      </ol>
   <div class="hr clearfix">&nbsp;</div>
</div>
</div>             
        </article>

        <!--作者其他文章-->
        <aside class="article_authorbox">
          <div class="article_authorbox_top">
                <div class="article_author">
            <div class="article_author_avatar">
                 <a class="upload-img"><img alt='360安全卫士' src='http://img.4hou.com/wp-content/uploads/2017/06/837963f5c83ace913607-96x96.jpg' class='avatar avatar-96 photo' height='96' width='96' /></a>
            </div>
            <h1 class="article_author_name"><a href="http://www.4hou.com/member?Author=360安全卫士" class="upload-img" target=_blank>
                    360安全卫士                                    <i class="mem_level"></i>
                </a></h1>
            <p class="article_author_type">360安全卫士官方账号 </p>
            <div class="article_author_bottom">
                                        <span class="send-info" onclick="location.href='/mybox?action=reply&to_user=360安全卫士&type=send'">发私信</span>
                         
            </div>
          </div>  
            <div class="interested">
                <h1>可能喜欢</h1>
                                                    <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7667.html" target="_blank">小心找工作时被挖坑，有人利用 LinkedIn 发送钓鱼链接</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7653.html" target="_blank">一次服务器被攻击的应急行动</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7646.html" target="_blank">一个Tor浏览器0day漏洞价值100万美元，其中的隐情是……</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/info/news/7660.html" target="_blank">Elasticsearche僵尸网络：超过4000台服务器遭到两款POS 恶意软件感染</a> 
                </li> 
                                <li>
                    <i></i>
                    <a href="http://www.4hou.com/technology/7669.html" target="_blank">渗透挑战赛：从SQL注入到管理员权限</a> 
                </li> 
                                                </div>
       </div>

          
        </aside>
    </section>
    <div id="zooming">
        <img src="" id="imgcon">
    </div>
    <script>
        $(document).ready(function() {
            $.fn.postLike = function() {
                if ($(this).hasClass('done')) {
                    return false;
                } else {
                    $(this).addClass('done');
                    var id = $(this).data("id"),
                        action = $(this).data('action'),
                        rateHolder = $(this).children('.count');
                    var ajax_data = {
                        action: "bigfa_like",
                        um_id: id,
                        um_action: action
                    };
                    $.post("/wp-admin/admin-ajax.php", ajax_data,
                        function(data) {
                            $(rateHolder).html(data);
                        });
                    return false;
                }
            };
            $(document).on("click", ".favorite",
                function() {
                    $(this).postLike();
                });


            $("img").attr("title","");
            var altcon=$(".art_title").text();
            $("img").attr("alt",altcon);
            // 图片放大
            $(".article_cen").find('img').on("click",function(){
                var imgsrc=$(this).attr("src");
                var winthimg=$(this).width();
                var zooming=winthimg*1.2;
                $("#imgcon").css({width:zooming});
                $("#imgcon").css({marginLeft:-zooming/2});
                $("#imgcon").attr("src",imgsrc);
                $("#zooming").addClass("zoomaniatae");
                $("#imgcon").addClass("imgconadimate");
            });
            $("#zooming").on("click",function(){
                $("#imgcon").removeClass("imgconadimate");
                $("#zooming").removeClass("zoomaniatae");

            });

            $(window).scroll(function(){
                var scrtop=$(window).scrollTop();
                if(scrtop>450){
                    $(".article_authorbox_top").removeClass("asideanimateleave").addClass('asideanimate')
                    // $(".interested").hide()
                }
                else if(scrtop<450&&scrtop>350){
                     $(".article_authorbox_top").addClass("asideanimateleave").removeClass('asideanimate')
                     $(".interested").show()

                }
            });
            var start=$(".strat .wpfp-span .wpfp-link").text()
            if(start=="已收藏"){
                $(".strat").addClass("stratend")
            }else{
                $(".strat").removeClass("stratend")
            }

            $(".avatar-96").width(72);
            $(".avatar-96").height(72);
            $(".avatar-120").width(50);
            $(".avatar-120").height(50);

        });
    </script>
<style type="text/css">
.footer{height:auto; background-color: #282828}
.footer_about{width: 1200px;height: 50px;padding-top: 26px; margin: 0 auto;border-bottom-color: transparent !important; position: relative;}
.footer_about>a{font-size: 16px;height: 16px !important;line-height: 16px !important; float: left; padding-right: 18px; border-right:1px solid #ccc;}
.last-child-a{border:none !important}
.footer_bottom_cen p{ margin-top: 5px; margin-right: 25px;text-align: left; margin-bottom: 6px;float: left;}
.footer_bottom_cen>div{width: 450px;float: left;margin-right: 8px}
.footer_bottom{height: 74px}
.footerlogos{width: 130px; height: 24px; position: absolute;right: 10%; top:24px;}
.footerlogos dd{float: left; margin-right: 20px;cursor: pointer;}
.footerlogos dd a{display: block;width: 100%; height: 100%}
.wechartlogo{width: 20px; height: 20px; background-position:-227px 0px;}
.weibologo{width: 20px; height: 20px; background-position:-269px 0px;}
.zhihulogo{width: 20px; height: 20px; background-position:-361px 0px;}
.wechartlogo i{width: 80px;height: 78px;background-size: contain !important; right: 137px;display: none;opacity: 1;background: url(http://www.4hou.com/wp-content/themes/4houv2/img/wechatqr.png) no-repeat;position: absolute;top: -28px;}
.wechartlogo:hover i{display: block;}
.footer_bottom{width: 1200px; background-color: #282828; margin:0 auto } 
.footer_bottom_cen>div img{float: left; margin-right: 4px;margin-top: 4px; margin-left: 4px;width: 66px;}
.footer_bottom_cen{width: 100%}
.cloudserver{float: right !important; margin: 0 auto !important;width: 385px !important; margin-top: -31px}
.cloudserver img{float: left;}
.cloudserver dd{float: left;}
@media screen and (max-width:1260px) {
    .footer{width: 100%; padding: 0px 20px;}
    .footer_about{width: 100%}
    .footer_bottom{width: 100%}
    .footer_bottom div{width: 100%;display: none;}
}
@media screen and (max-width:660px) {
    .footer_about{padding-top: 14px; margin-bottom: 22px;}
    .footerlogos{display: none;}
    .footer_bottom{height: 44px;}

}
</style>
<footer class="footer">
    <div class="footer_about">
        <a href="/about" target=_blank>关于我们</a>
        <!--<a href="">加入我们</a>-->
        <a href="/submit" target=_blank>我要投稿</a>
        <a href="/service" target=_blank>广告及服务</a>
        <a href="/partner" target=_blank class="last-child-a">友情链接</a>
        <div class="footerlogos">
                <dd class="wechartlogo icons">
                  <i></i>
                </dd>
                <dd class="weibologo icons">
                 <a href="http://weibo.com/u/6069423878" target=_blank></a>
                </dd>
                <dd class="zhihulogo icons">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank></a>
                    
                </dd>
        </div>
    </div>

    <section class="footer_bottom">
        <article class="footer_bottom_cen">
            <p>©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;&nbsp;京ICP备16063439号</p>
            <p class="mobilefooter">©2017 北京嘶吼文化传媒有限公司&nbsp;&nbsp;|&nbsp;&nbsp;京ICP备16063439号</p>
            <div class="cloudserver">
                <span>本站由</span>
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/bdcloud1.png">
                <img src="http://img.4hou.com/wp-content/themes/4houv2/img/ucloud.png">
                <span>提供云计算服务</span>
            </div>
        </article>
    </section>
    <section class="footer_top" style="display:none">
        <article class="footer_top_cen">
            <div class="homeqrcode">
                <dd class="icons"></dd>
                <div class="wb">
                    <a href="http://weibo.com/u/6069423878" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼传媒</p>
                    </a>
                </div>

                <div class="sh">
                    <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank>
                    <i class="icons"></i>
                    <p>关注嘶吼</p>
                    </a>
                </div>
            </div>
            
            <h1>合作伙伴</h1>
            <div class="footer_friend">
                <a href="http://www.xinhuanet.com/talking/chinasafety/" target=_blank>新华网安全中国</a>
                <a href="http://jaq.alibaba.com/" target=_blank>阿里聚安全</a>
                <a href="http://www.seclover.com/" target=_blank>四叶草安全</a>
                <a href="https://sec.vip.com/" target=_blank>唯品会安全应急响应中心</a>
                <a href="https://www.duoyinsu.com/" target=_blank>安识科技</a>
                <a href="http://xianzhi.aliyun.com" target=_blank>云盾先知</a>
                <a href="http://www.ardsec.com/" target=_blank>兴华永恒</a>
                <a href="https://www.sobug.com/" target=_blank>SOBUG</a>
            </div>
        </article>
    </section>
    
</footer>
<aside class="side" >
    <div class="side_top icons "></div>
    <div class="iconbox">
        <div class="side_wechart icons iconhover">微信
            <dd></dd>
        </div>
        <a href="http://weibo.com/u/6069423878" target=_blank><div class="side_webo icons iconhover">微博</div></a>
        <a href="http://www.4hou.com/feed/" target=_blank><div class="side_rss icons iconhover">RSS</div></a>
        <a href="https://zhuanlan.zhihu.com/roartalk" target=_blank><div class="side_zh icons iconhover">知乎</div></a>
    </div>
    <div class="side_bottom icons"></div>
    
</aside>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?ac201c14c3d2a4747423252be421e1bc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-91554508-1', 'auto');
    ga('send', 'pageview');

</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</body>
</html>