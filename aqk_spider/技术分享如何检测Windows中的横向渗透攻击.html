<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】如何检测Windows中的横向渗透攻击 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="横向移动,内网渗透,windows安全,windows渗透"/>
    
        <meta name="description" content="横向渗透攻击技术是复杂网络攻击中广泛使用的一种技术，特别是在高级持续威胁（Advanced Persistent Threats，APT）中更加热衷于使用这种攻击方法。攻击者可以利用这些技术，以被攻陷的系统为跳板，访问其他主机。本文我们向大家介绍了如何在Windows Vista/7以及Server 2008系统中检测基于NTLM和Kerberos协议的横向渗透攻击。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】如何检测Windows中的横向渗透攻击</h2>
                <div class="article-msg">
                    <span class="time">2017-05-10 10:08:36</span>
                    
                                        <span class="read">阅读：14594次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3830"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3830" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf"
                             target="_blank">来源： europa.eu</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2819002922" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t0104d1b8b4ca36e961.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2819002922" style="color:#848e99;">興趣使然的小胃</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong><img src="http://p2.qhimg.com/t0139d8ec6cafdbfd26.jpg" title="t0139d8ec6cafdbfd26.jpg" alt="http://p2.qhimg.com/t0139d8ec6cafdbfd26.jpg"/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">翻译：</span><a href="http://bobao.360.cn/member/contribute?uid=2819002922" target="_blank" textvalue="興趣使然的小胃"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192);"><strong>興趣使然的小胃</strong></span></a></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; word-break: break-all; text-indent: 2em; background-color: rgb(255, 255, 255);"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><span style="font-size: 18px;">预估稿费：300RMB</span></span></strong></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong><br/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong>一、前言</strong></span><br/></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">横向渗透攻击技术是复杂网络攻击中广泛使用的一种技术，特别是在高级持续威胁（Advanced Persistent Threats，APT）中更加热衷于使用这种攻击方法。</span></strong></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">攻击者可以利用这些技术，以被攻陷的系统为跳板，访问其他主机，获取包括邮箱、共享文件夹或者凭证信息在内的敏感资源。攻击者可以利用这些敏感信息，进一步控制其他系统、提升权限或窃取更多有价值的凭证。借助此类攻击，攻击者最终可能获取域控的访问权限，完全控制基于Windows系统的基础设施或与业务相关的关键账户。</span></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这份白皮书中，我们向大家介绍了如何在Windows Vista/7以及Server 2008系统中检测基于NTLM和Kerberos协议的横向渗透攻击。Windows 10引入了许多额外的安全机制，因此我们准备单独发布另一份白皮书，介绍如何检测Windows 10中的横向渗透攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">微软发布过一篇文章，文中介绍了凭证窃取攻击的相关资料以及如何防范这类攻击。除了本文介绍的防御措施之外，我们强烈建议大家根据微软给出的建议对系统进行加固。需要注意的是，这类攻击不仅仅针对Windows系统，其他的基础设施（如使用Kerberos的UNIX环境或单点登录环境）也会受到类似攻击的影响。虽然本文仅仅针对Windows系统提出了检测横向渗透攻击的方法，大家可以举一反三，在保存适当日志的其他环境中使用类似方式检测横向渗透攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">此外，感谢微软MSRC（Microsoft Security Response Center，微软安全响应中心）对本文内容的校对和细节验证。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong>二、背景</strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">2.1 什么是Windows横向渗透攻击</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本文中，横向渗透攻击指的是攻击者以某台Windows主机为跳板，利用已窃取的某个账户（如普通用户或服务账户）的有效凭证，建立到目标Windows主机的连接。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">源主机通常是目标Windows环境中的一台已被攻陷的主机。在大多数情况下，攻击者会通过包含恶意附件的钓鱼邮件或恶意网站链接，攻陷第一台主机作为跳板。一旦攻击成功，攻击者通常会通过命令控制（Command-and-Control，C2）服务器以及反弹的shell控制目标主机。权限提升成功后，攻击者可以提取存储在源主机中的凭证信息，开展后续的横向渗透攻击，其中包括：</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、获取源主机的凭证信息</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者可以通过定制工具，访问Windows凭证存储区或内存，以获取任何有效的凭证信息（键盘记录器也可以完成相同任务，但这不在本文的讨论范围内）。本文只讨论与NT哈希和Kerberos凭证有关的内容。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者可能会获取到被攻陷源主机中保存的任何凭证，比如那些正在使用的凭证、曾经使用过的凭证（比如已缓存的凭证）以及内存中尚未清除的凭证（未安装更新时）。攻击者最感兴趣的是目标环境中的高权限账户凭证，比如帮助台（help-desk）账户、域管、高权限服务账户以及本地管理员账户，如果密码被重复使用或者密码生成算法是可预测的，那么攻击环境就更加理想。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、通过窃取的凭证访问其他主机或资源</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">成功窃取凭证后，攻击者可以使用这些凭证访问其他资源，比如其他主机或服务器（例如Exchange邮箱账户）。攻击者所使用的技术包括基于NT哈希的哈希传递（pass-the-hash，以下简称PtH）攻击以及基于Kerberos票据的票据传递攻击（pass-the-ticket，以下简称PtT）。读者可以参考附录B中的[1][2][3]，了解这些攻击的更多细节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">以下是有关凭证窃取和重放攻击的一些说明：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、任何用户访问被攻陷的主机后，都可能在其内存中留下凭证信息，在未及时安装补丁时，相关凭证会被攻击者导出。Windows之所以在内存中缓存这些凭证，主要是为了提供诸如单点登录（single-sign-on）的功能，在这种场景下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（1）在受限管理模式下使用Network Logon或RDP方式登录被控主机时，用户账户凭证不会被泄露。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（2）其他登录方式会暴露账户凭证，包括本地账户、域账户以及服务账户在内的凭证都会受到影响。读者可以参考本文2.3节内容了解更多细节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、受影响的凭证不仅仅包括明文的用户名和密码，还包括NT哈希、Kerberos票据以及Kerberos密钥，这些凭证可以被攻击者用来请求Kerberos TGTs（Ticket Granting Ticket），作为有效凭证开展横向渗透攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、攻击者需要管理员权限以访问本地Windows凭证存储区或内存中的凭证信息（例如Windows安全账户管理器、凭证管理器或者本地安全授权子系统服务进程（及LSASS.exe）中存储的凭证）。如果当前账户权限较低，攻击者可以通过本地提权漏洞获取高权限。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、横向渗透攻击的目标不单单是另一个工作站，也可以是其他资源，比如Exchange服务器上的邮箱或业务系统。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、横向渗透攻击使用的是标准的协议，比如Kerberos和NTLM协议，这样一来我们无法通过创建单条Windows事件或网络入侵检测系统（IDS）规则来检测这类攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6、横向渗透攻击的一个优点就是攻击者可以抓取凭证信息并在后续攻击中使用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">7、不仅仅只有Windows会受到横向渗透攻击影响，其他使用单点登录的身份认证协议都会面临相同问题。任何单点登录解决方案都需要以某种有效的方式保存凭证信息，以便在其他服务的认证过程中可以重复使用这些凭证。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.2 使用横向渗透攻击的典型APT场景</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">通常情况下，APT攻击会不断从某个工作站连接到另一个工作站，以获取越来越高的账户权限，直到他们得到域管账户的凭证为止。接下来攻击者通常会访问域控，导出Windows域中的所有凭证。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">APT中使用横向渗透攻击的典型场景如下图所示：</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t01ba52b83f0ed34cec.png" title="t01b5b6ab81bbe6d0af.png" alt="http://p5.qhimg.com/t01b5b6ab81bbe6d0af.png"/></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图1. APT攻击中使用横向渗透攻击的典型场景</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.3 凭证缓存</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">就如上文所述，当用户使用RDP方式连接工作站（RestrictedAdmin模式除外），或者在工作站中使用runas命令时，包括域用户或者域管在内的凭证信息都会缓存在工作站的内存中。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">以某个典型场景为例，当前有某个user1账户已经登录到某台主机中，此时另一个user2账户（管理员）正在登陆同一台主机。在这种情况下，user2在主机中缓存的票据不仅对user1而言是可见的，对已经掌握该主机控制权的攻击者而言也是可见的。user2在当前主机中缓存的Kerberos TGT票据情况如下表所示：</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01daefbb75c0455db4.png" title="t01e0ca7f2415c9f20e.png" alt="http://p5.qhimg.com/t01e0ca7f2415c9f20e.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">注：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[1] 如果user2正确注销，则远程主机上不会保存票据信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[2] 如果远程会话没有被正确关闭，那么user2的票据就会保留在远程主机中。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[3] 右键菜单中以管理员身份（user2）运行cmd.exe.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[4] 使用的是已缓存的域密码，比如没有接入域环境的笔记本电脑就属于这种场景。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[5] 在以user2身份运行的命令提示符中，使用“net use”命令。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[6] 使用“net use \\target\c$”命令，在弹出的对话框中输入user2凭证信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[7] 在域控的日志中会包含4768事件，但有趣的是user2的TGT票据并不会被缓存，相反的是，本地主机内存中会保存user1的一个CIFS服务票据，以便访问共享文件夹。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要注意的是，我们并没有测试所有的登录类型，但在某些场景下，高权限用户（如user2）还是可以访问工作站主机。微软给出了一份更详尽的资料，梳理了哪些可复用的凭证信息会暴露在目标主机中。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">上表中，在Windows系统中，右键使用的“以管理员身份运行”功能时（会弹出UAC窗口），用户会得到管理员所有的访问令牌。如果管理员使用runas命令运行某个应用程序（如cmd.exe），情况会有所不同，具体情况如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、右键使用“以管理员身份运行”运行应用程序时，程序退出后，已缓存的NT哈希以及票据仍然会保留在内存中；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、使用“runas /user:\\dom\user2”命令时，程序退出后，内存中的凭证会被清除。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">有趣的是，在最后一种场景中（即交互式登录后，以管理员身份运行），netlogon服务并不需要重新输入密码！</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于上表的测试用例，有几点情况需要说明：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、所有的测试都基于非特权的交互式会话（即使用user1的控制台登录）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、网络登录状态没有永久保持。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、委派功能打开和关闭的情况下，我们都做了测试。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、在注销测试中，不管注销过程中目标账户会话是被正确关闭还是被保留，测试结果都不变。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.4 哈希传递与票据传递</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">横向渗透测试中，使用哈希传递（Pass-the-Hash，以下简称PtH）或者票据传递（Pass-the-Ticket，以下简称PtT）时，情况会有所不同，具体如下表所示：</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t0132ff40c6f7c0ef69.png" title="t016140270716e959a2.png" alt="http://p4.qhimg.com/t016140270716e959a2.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">有几个结论比较有趣，如：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、攻击者需要管理员权限以窃取凭证，但不需要管理员权限就能使用Kerberos票据。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、密码更改并不会导致Kerberos票据失效。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">三、检测Windows中的横向渗透攻击</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong><span style="font-size: 18px; color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">3.1 通用法则</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">合法的SMB连接与使用PtH和PtT攻击建立的连接并没有什么不同。事实上，攻击者发动这类攻击时并没有利用协议的漏洞，因此，我们没有预先定义的规则来检测此类攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然而，攻击者的攻击行为会存在某些异常特征。例如，如果某个域管账户（如my-admin）只能在某台特定的工作站中使用，那么在其他工作站中使用这个域管账户就显得非常可疑，意味着域环境中可能存在横向渗透攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此，我们有可能能通过监控Windows事件检测横向渗透攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们用来检测攻击的主要法则为：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“如果检测到用户账户来自于不正常或非授权系统，或者在不正常或非授权系统中使用，我们判断这种情况下存在横向渗透攻击”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们需要注意以下几点：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、这条法则并不能覆盖所有的横向渗透攻击（某些特权账户的使用检测起来比较困难）。因此，我们需要维护一张包含合法的“用户/工作站/IP地址”三元组的列表，检测不在此表中的账户使用情况。此外，单独使用三元组列表并不能检测所有的攻击场景（比如，攻击者发起的来自合法的用户/工作站的资源访问请求）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、这些法则能否有效应用，主要由已有的策略、活动目录结构以及网络隔离机制共同决定。我们需要制定策略，监控专用主机（如专用OU、管理员工作站）上账户的使用情况。我们手头上必须维护一份包含这类工作站的清单。如果这些账户和工作站所使用的策略非常明确，那么我们在检测横向渗透攻击时的效率也会越高，也能避免误报。网络隔离机制将有助于识别横向渗透攻击，特别是对于Kerberos而言，这种隔离机制更加有效，因为Kerberos并没有在相关日志事件中提供具体的主机名信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、为了检测使用本地账户（如本地管理员）的横向渗透攻击，我们需要收集所有可能成为目标的工作站中的日志（4624/4625事件），在某些情况下这个任务很难完成。但这对域账户来说不成问题，因为主要的Windows事件都存储在域控上。微软引入了两个SID，通过设置GPO（Group Policy Object，组策略对象）规则，可以限制本地管理员账户在横向渗透攻击中的使用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本文后半部分中，我们会向读者介绍使用PtH和PtT进行横向渗透攻击时所产生的日志事件，以及我们可以设定哪些规则来检测这些攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.2 约定及假设</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本文重点关注的横向渗透攻击场景中，攻击者使用了某个管理员账户（如ADMIN），从其他工作站（而不是ADMIN所属的ADMIN-WS工作站）开始横向渗透。所使用的规则可以稍微调整，以检测其他攻击场景（如使用服务账户或者其他特权账户进行攻击）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本文的案例中，我们有几个假设条件，如：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、我们可以通过查询活动目录识别域管账户（命令为：net group “Domain Admins” /domain）；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、ADMIN属于管理员组，熟悉环境的攻击者可以挑选其他合适的命名约定；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、管理员工作站可以通过以下方式识别：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（1）通过工作站的主机名识别。比如通过域中维护的OU（Organizational Unit，组织单元）或主机列表，或者通过命名约定（如admin-ws-1、admin-ws-2等）加以识别。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（2）通过IP地址识别。比如这些工作站具有专用的(V)LAN地址，或这些工作站为跳转服务器，管理员在连接到其他系统前必须登录这些工作站。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、ADMIN-WS为ADMIN所属的工作站或跳转服务器。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.3 检测NTLM横向渗透攻击（PtH）</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.3.1 日志中的相关事件</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用NTLM凭证时，本地以及域控（如果使用的是域用户的话）上生成的所有日志条目如图2所示。详细的日志事件可参考6.1节内容。</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t01181e4bd4351d2c6c.png" title="t01fb882869782c29f1.png" alt="http://p5.qhimg.com/t01fb882869782c29f1.png"/></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2. 与NTLM凭证有关的事件</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">被攻陷的工作站（infected-ws）中会生成4648事件：“试图使用显式凭据登录（A logon was attempted usingexplicit credentials）”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">所生成的日志事件与攻击者的具体操作有关。在这种场景中，攻击者已经事先将NT哈希注入到目标主机中，之后通过“psexec.exe \\Target cmd.exe”命令，打开目标主机上的命令提示符。读者可以参考附录C查看更多细节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">被攻陷的工作站的日志对安全取证来说非常有用，但对主动检测PtH攻击来说用处不大。在这种场景中，我们可以从日志中得知横向渗透攻击的目标主机（clean-ws）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">域控上的日志中会生成两个4776事件：“域控试图验证某个用户凭证的有效性（The domain controller attempted to validate the credentials for an account）”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第一个4776事件与域控对目标主机（clean-ws$）的验证过程有关。这个事件对检测PtH来说用处不大。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第二个4776事件表明，域控正在验证某个账户（my-admin）的有效性，此时该账户正在访问目标工作站（clean-ws$）。这个事件可以用作检测横向渗透攻击是否存在的指示器，也是监控整个环境的关键要素。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">目标主机（clean-ws）的日志中会记录4624事件：“成功登录帐户（An account was successfully logged on）”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个事件表明，目标账户（my-admin）已经成功登录到目标工作站（clean-ws）。这个事件也可以用来检测横向渗透攻击，但我们需要收集所有工作站上的所有特定日志。如果工作站或服务器的数量不多，这个事件还是能发挥作用的。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">无论如何，该事件与登录失败事件（4625事件）对于安全取证来说非常有用，因为我们可以通过这些事件了解登录的类型（本例中为网络登录，Network logon），以及攻击者从哪台主机（本例中为infected-ws）发起连接。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">目标主机的日志中会记录4634/4647事件：“账户被注销/用户启动注销过程（An account was/initiated logged off）”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个事件表明攻击者的注销登录动作。对于安全取证来说，这个事件非常有用，安全人员可以结合登录ID值、4624事件以及这个事件，检测攻击行动的会话全流程。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.3.2 通用检测方法</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这部分的内容是介绍我们在检测NTLM型横向渗透攻击时，需要在各个主机中收集的事件，以及所需要关心的具体值。正如上文所述，我们需要重点关注域控（DC）上的4776事件，其他关键系统中的4624（登录成功）以及4625（登录失败）事件也值得关注。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t013c58b6900b28186e.png" title="t015c69aec95ca95416.png" alt="http://p1.qhimg.com/t015c69aec95ca95416.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">注意：不要忽视工作站事件日志的重要性，特别是与敏感账户或者特权账户有关的那些事件日志。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.4 检测Kerberos横向渗透攻击（PtT）</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.4.1 日志中的相关事件</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在Kerberos认证过程中，本地主机以及域控（如果使用的是域用户的话）上生成的所有日志条目如图3所示，详细的事件信息可以参考6.2节内容。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">与PtH攻击不同，PtT攻击场景中并没有生成4648事件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">域控的日志中会记录4768事件，即：Kerberos身份验证票证请求（A Kerberos authentication ticket (TGT) was requested）事件。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t0126c42d73bd194bb5.png" title="t01138151db45a29d2c.png" alt="http://p9.qhimg.com/t01138151db45a29d2c.png"/></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图3. 与NTLM凭证使用有关的事件</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者向域控申请Kerberos TGT票据时就会生成4768事件。在PtT攻击中，我们可能不会在日志中找到这个事件，因为攻击者在这之前已经窃取了TGT票据，不需要向Kerberos分发中心或者域控申请新的TGT票据，只需要利用已窃取的票据即可完成PtH攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">域控的日志中会记录4769事件，即：Kerberos 服务票证请求（A Kerberos service ticket was requested）事件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者请求访问目标系统或资源时（本例中为clean-ws$）会生成该事件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个事件可以用作检测横向渗透攻击是否存在的指示器，也是在整个环境中需要监控的主要事件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">目标主机（clean-ws）的日志中会记录4624事件，即：成功登录帐户（An account was successfully logged on）事件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个事件表明某个账户（my-admin）已成功登录到目标主机（clean-ws）。我们有可能利用这个事件主动检测横向渗透攻击，但前提是需要收集所有工作站上的相关日志。如果工作站或服务器的数量不多，这个事件也能够发挥作用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">无论如何，这个事件和登录失败（4625）事件对安全取证来说非常有用，因为它提供了具体的登录类型（本例中为网络登录）以及发起登录连接的来源主机（本例中为infected-ws）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4634/4647事件的含义分别为：帐户被注销/用户启动注销过程。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这两个事件与攻击者的注销过程有关。安全取证工作中，可以利用这两个事件，结合4624事件中的登录ID值，检测攻击行动的会话全流程。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.4.2 通用检测方法</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这部分的内容是介绍我们在检测PtT型横向渗透攻击时，需要在各个主机中收集的事件，以及需要关心的具体值。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">正如上文所述，我们需要重点关注域控（DC）上的4769以及4768事件。需要注意的是，这一次我们只能检查其中的IP地址信息，因为Kerberos事件中并没有提供具体的主机名。在启用DHCP的环境中，这个限制条件给我们带来了不小的挑战，如果DHCP租用时间较短，我们面临的将会是一个动态变化的网络环境。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">关键系统中的4624事件以及4625（登录失败）事件也值得我们关注。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t01930a8c3eeb4d0cc1.png" title="t017d482f1f67bd757e.png" alt="http://p6.qhimg.com/t017d482f1f67bd757e.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们使用这种方法可能会检测出假阳性结果：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">比如某个管理员（例如help desk）正在打开远程主机上的应用（例如，在远程访问中，通过cmd.exe运行”runas administrator”命令），这种情况下有可能会生成4768事件。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.4.3 检测黄金票据（Golden Ticket）</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们发表了一份白皮书，介绍了Kerberos黄金票据的相关知识，读者可以查阅参考资料了解更多细节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.5 需要监控的主要账户</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">本文中描述的监控规则主要是基于域管账户，我们也可以监控其他重要账户，以快速检测横向渗透攻击是否存在，这些账户包括：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、服务账户（比如，备份账户）；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、很少使用的账户；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、应急使用的账户；</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、关键业务账户。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.6 需要注意的其他事件</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们建议大家可以参考NSA发表的一份参考资料，其中介绍了检测潜在攻击时可能有用的其他一些事件。这个参考资料不单单针对横向渗透攻击，同时也覆盖了许多日志事件以及攻击类型。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">四、附录A-相关定义</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">哈希传递攻击（Pass-the-hash，PtH）：PtH是一种黑客技术，攻击者可以利用该技术，使用事先窃取的用户密码的NTLM以及LM哈希，完成对远程服务器或者服务的身份验证，而常规的验证流程中需要输入明文密码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">票据传递攻击（Pass-the-ticket，PtT）：与PtH情况类似，但PtT使用的是Kerberos票据，而不是NT哈希。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">凭证（Credential）：可以用来证实某人身份的标识以及相关密钥。根据此定义，凭证的类型不仅仅局限于明文密码，同样也包括Windows的NTLM哈希或者Kerberos票据（与实际使用的Windows认证协议有关）。在某些情况下，Windows会缓存凭证信息，以提供单点登录功能。这篇文章主要关注的是Kerberos票据凭证（Ticket-Granting-Tickets，TGT）。读者可以阅读参考资料[1]，了解与Windows凭证类型（表4）以及凭证缓存有关的更多细节信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">TGT以及ST Kerberos票据：Ticket-Granting-Tickets（TGT）以及Service Tickets（ST，服务票据）是Kerberos协议的一部分，读者可以阅读参考资料[2]，了解Kerberos以及相关的票据细节信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">KDC：密钥分发中心（Key distribution Center）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">五、附录B-参考资料</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><a href="http://www. microsoft.com/pth" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">[1] 如何防御哈希传递攻击以及其他凭证窃取技术</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="http://technet.microsoft.com/en-us/library/cc739058(v=ws.10).aspx" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[2] Kerberos认证技术细节</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="http://technet.microsoft.com/en-us/library/bb727066.aspx#ECAA" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[3] 遭受攻击后如何恢复活动目录</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="http://technet.microsoft.com/en-us/library/dn408190.aspx" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[4] 凭证保护及管理</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/Default.aspx" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[5] Windows事件说明</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="http://www.microsoft.com/download/details.aspx?id=50034" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[6] Windows 7以及2008中的安全事件</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="https://www.iad.gov/iad/library/reports/spotting-the-adversary-with-windows-event-log-monitoring.cfm" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[7] 如何发现攻击活动</span></a></p><p style="text-indent: 2em; text-align: left;"><a href="http://cert.europa.eu/static/WhitePapers/UPDATED%20-%20CERT-EU_Security_Whitepaper_2014-007_Kerberos_Golden_Ticket_Protection_v1_4.pdf" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[8] 如何防御Kerberos黄金票据攻击</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">六、附录C-具体事件说明</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这部分内容主要是介绍Windows日志以及log2timeline日志中与PtH以及PtT攻击有关的具体事件，具体场景为：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、被攻陷的工作站：USER-WS（IP地址为192.168.89.101）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、目标用户：my-admin</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、目标主机：admin-ws（IP地址为192.168.89.102）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、域名：corp.pass.thehash</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.1 网络登录（Network Logon）以及PtH事件</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.1.1 域控中的相关事件</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Time:&nbsp;06:32:56
Event:&nbsp;4776
Event&nbsp;content:
-&nbsp;PackageName&nbsp;=&nbsp;MICROSOFT_AUTHENTICATION_PACKAGE_V1_0
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;Workstation&nbsp;=&nbsp;USER-WS
-&nbsp;Status&nbsp;=&nbsp;0x00000000
Command:&nbsp;`psexec.exe&nbsp;\\admin-ws&nbsp;cmd.exe`
Comment:&nbsp;The&nbsp;domain&nbsp;controller&nbsp;attempted&nbsp;to&nbsp;validate&nbsp;the&nbsp;credentials&nbsp;for&nbsp;an&nbsp;account
Time:&nbsp;06:33:37
Event:&nbsp;4776
Event&nbsp;content:
-&nbsp;PackageName&nbsp;=&nbsp;MICROSOFT_AUTHENTICATION_PACKAGE_V1_0
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;Workstation&nbsp;=&nbsp;USER-WS
-&nbsp;Status&nbsp;=&nbsp;0x00000000
Command:&nbsp;robocopy.exe&nbsp;c:\goodies\sch&nbsp;\\admin-ws\c$
Comment:&nbsp;The&nbsp;domain&nbsp;controller&nbsp;attempted&nbsp;to&nbsp;validate&nbsp;the&nbsp;credentials&nbsp;for&nbsp;an&nbsp;account
Time:&nbsp;06:34:16
Event:&nbsp;4776
Event&nbsp;content:
-&nbsp;PackageName&nbsp;=&nbsp;MICROSOFT_AUTHENTICATION_PACKAGE_V1_0
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;Workstation&nbsp;=&nbsp;USER-WS
-&nbsp;Status&nbsp;=&nbsp;0x00000000
Command:&nbsp;at.exe&nbsp;\\admin-ws&nbsp;06:35&nbsp;c:\schedule.bat
Comment:&nbsp;The&nbsp;domain&nbsp;controller&nbsp;attempted&nbsp;to&nbsp;validate&nbsp;the&nbsp;credentials&nbsp;for&nbsp;an&nbsp;account</pre><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">6.1.2 来源主机中的相关事件（user-ws）</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Time:&nbsp;06:32:44
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;USER-WS$
-&nbsp;SubjectDomainName&nbsp;=&nbsp;CORP
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000000003e7&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;TargetUserName&nbsp;=&nbsp;SYSTEM
TargetDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000001046e9
-&nbsp;LogonType&nbsp;=&nbsp;9
-&nbsp;LogonProcessName&nbsp;=&nbsp;seclogo
-&nbsp;AuthenticationPackageName&nbsp;=&nbsp;Negotiate
-&nbsp;WorkstationName&nbsp;=&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}
-&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=&nbsp;-&nbsp;KeyLength&nbsp;=&nbsp;0&nbsp;ProcessId&nbsp;=&nbsp;0x00000000000003b4
-&nbsp;ProcessName&nbsp;=&nbsp;C:/Windows/System32/svchost.exe&nbsp;IpAddress&nbsp;=&nbsp;::1&nbsp;IpPort&nbsp;=&nbsp;0
Command:&nbsp;sekurlsa::pth&nbsp;/user:my-admin&nbsp;/domain:corp&nbsp;/ntlm:[nt&nbsp;hash]&nbsp;/run:cmd.exe
Comment:&nbsp;Succesful&nbsp;logon,&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000001046e9
Time:&nbsp;06:32:44
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;SYSTEM&nbsp;SubjectDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9
-&nbsp;PrivilegeList&nbsp;=&nbsp;SeCreateTokenPrivilege&nbsp;SeAssignPrimaryTokenPrivilege&nbsp;SeTcbPrivilege
SeSecurityPrivilege&nbsp;SeTakeOwnershipPrivilege&nbsp;SeLoadDriverPrivilege&nbsp;SeBackupPrivilege
SeRestorePrivilege&nbsp;SeDebugPrivilege&nbsp;SeAuditPrivilege&nbsp;SeSystemEnvironmentPrivilege
SeImpersonatePrivilege
Comment:&nbsp;Special&nbsp;privileges&nbsp;assigned&nbsp;to&nbsp;new&nbsp;logon,&nbsp;as&nbsp;above.&nbsp;LogonId&nbsp;=&nbsp;0x00000000001046e9
Time:&nbsp;06:32:55
Event:&nbsp;4648
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;SYSTEM&nbsp;SubjectDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetUserName&nbsp;=&nbsp;--------&nbsp;TargetDomainName&nbsp;=&nbsp;----&nbsp;TargetLogonGuid&nbsp;=
{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetServerName&nbsp;=&nbsp;admin-ws.corp.pass.thehash&nbsp;TargetInfo&nbsp;=&nbsp;admin-ws.corp.pass.thehash
-&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000004&nbsp;ProcessName&nbsp;=
-&nbsp;IpAddress&nbsp;=&nbsp;-&nbsp;IpPort&nbsp;=&nbsp;-
Command:&nbsp;psexec.exe&nbsp;\\admin-ws&nbsp;cmd.exe
Comment:&nbsp;A&nbsp;logon&nbsp;was&nbsp;attempted&nbsp;using&nbsp;explicit&nbsp;credentials.&nbsp;This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a
process&nbsp;attempts&nbsp;to&nbsp;log&nbsp;on&nbsp;an&nbsp;account&nbsp;by&nbsp;explicitly&nbsp;specifying&nbsp;that&nbsp;accounts&nbsp;credentials.
This&nbsp;most&nbsp;commonly&nbsp;occurs&nbsp;in&nbsp;batch-type&nbsp;configurations&nbsp;such&nbsp;as&nbsp;scheduled&nbsp;tasks,&nbsp;or&nbsp;when
using&nbsp;the&nbsp;RUNAS&nbsp;command.&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9
Time:&nbsp;06:32:55
Event:&nbsp;4648
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;SYSTEM&nbsp;SubjectDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetUserName&nbsp;=&nbsp;--------&nbsp;TargetDomainName&nbsp;=&nbsp;----&nbsp;TargetLogonGuid&nbsp;=
{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetServerName&nbsp;=&nbsp;admin-ws.corp.pass.thehash&nbsp;TargetInfo&nbsp;=&nbsp;admin-ws.corp.pass.thehash
ProcessId&nbsp;=&nbsp;0x0000000000000998
-&nbsp;ProcessName&nbsp;=&nbsp;C:/goodies/PsExec.exe
-&nbsp;IpAddress&nbsp;=&nbsp;-&nbsp;IpPort&nbsp;=&nbsp;-
Comment:&nbsp;LogonId&nbsp;=&nbsp;0x00000000001046e9
Time:&nbsp;06:33:35
Event:&nbsp;4648
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;SYSTEM&nbsp;SubjectDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetUserName&nbsp;=&nbsp;--------&nbsp;TargetDomainName&nbsp;=&nbsp;----&nbsp;TargetLogonGuid&nbsp;=
{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetServerName&nbsp;=&nbsp;admin-ws.corp.pass.thehash&nbsp;TargetInfo&nbsp;=&nbsp;admin-ws.corp.pass.thehash
-&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000004&nbsp;ProcessName&nbsp;=
-&nbsp;IpAddress&nbsp;=&nbsp;-&nbsp;IpPort&nbsp;=&nbsp;-
Command:&nbsp;robocopy.exe&nbsp;c:\goodies\sch&nbsp;\\admin-ws\c$
Comment:&nbsp;A&nbsp;logon&nbsp;was&nbsp;attempted&nbsp;using&nbsp;explicit&nbsp;credentials.&nbsp;LogonId&nbsp;=&nbsp;0x00000000001046e9
Time:&nbsp;06:34:15
Event:&nbsp;4648
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-18&nbsp;SubjectUserName&nbsp;=&nbsp;SYSTEM&nbsp;SubjectDomainName&nbsp;=&nbsp;NT&nbsp;AUTHORITY
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000001046e9&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetUserName&nbsp;=&nbsp;--------&nbsp;TargetDomainName&nbsp;=&nbsp;----&nbsp;TargetLogonGuid&nbsp;=
{00000000-0000-0000-0000-000000000000}
-&nbsp;TargetServerName&nbsp;=&nbsp;admin-ws.corp.pass.thehash&nbsp;TargetInfo&nbsp;=&nbsp;admin-ws.corp.pass.thehash
-&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000004&nbsp;ProcessName&nbsp;=
-&nbsp;IpAddress&nbsp;=&nbsp;-&nbsp;IpPort&nbsp;=&nbsp;-
Command:&nbsp;at.exe&nbsp;\\admin-ws&nbsp;08:00&nbsp;c:\schedule.bat
Comment:&nbsp;A&nbsp;logon&nbsp;was&nbsp;attempted&nbsp;using&nbsp;explicit&nbsp;credentials.LogonId&nbsp;=&nbsp;0x00000000001046e9</pre><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">6.1.3 目标主机中的相关事件（admin-ws）</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Time:&nbsp;06:32:55
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;SubjectUserName&nbsp;=&nbsp;my-admin
-&nbsp;SubjectDomainName&nbsp;=&nbsp;CORP&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000000f133c&nbsp;PrivilegeList&nbsp;=
SeSecurityPrivilege&nbsp;SeBackupPrivilege&nbsp;SeRestorePrivilege&nbsp;SeTakeOwnershipPrivilege
SeDebugPrivilege&nbsp;SeSystemEnvironmentPrivilege&nbsp;SeLoadDriverPrivilege
SeImpersonatePrivilege
Comment:&nbsp;Special&nbsp;privileges&nbsp;assigned&nbsp;to&nbsp;new&nbsp;logon.
Time:&nbsp;06:32:55
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-0-0&nbsp;SubjectUserName&nbsp;=&nbsp;-&nbsp;SubjectDomainName&nbsp;=&nbsp;-&nbsp;SubjectLogonId&nbsp;=
0x0000000000000000&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f133c
-&nbsp;LogonType&nbsp;=&nbsp;3
-&nbsp;LogonProcessName&nbsp;=&nbsp;NtLmSsp
-&nbsp;AuthenticationPackageName&nbsp;=&nbsp;NTLM&nbsp;WorkstationName&nbsp;=&nbsp;USER-WS
-&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=
NTLM&nbsp;V1&nbsp;KeyLength&nbsp;=&nbsp;128&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000000&nbsp;ProcessName&nbsp;=&nbsp;-&nbsp;IpAddress&nbsp;=
192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49286
Command:&nbsp;psexec.exe&nbsp;\\admin-ws&nbsp;cmd.exe
Comment:&nbsp;Succesful&nbsp;logon.&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f133c
Time:&nbsp;06:33:32
Event:&nbsp;4634
Event&nbsp;content:
-&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f133c
-&nbsp;LogonType&nbsp;=&nbsp;3
Comment:&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f133c
Time:&nbsp;06:33:35
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;SubjectUserName&nbsp;=&nbsp;my-admin
-&nbsp;SubjectDomainName&nbsp;=&nbsp;CORP
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000000f2736
-&nbsp;PrivilegeList&nbsp;=&nbsp;SeSecurityPrivilege&nbsp;SeBackupPrivilege&nbsp;SeRestorePrivilege
SeTakeOwnershipPrivilege&nbsp;SeDebugPrivilege&nbsp;SeSystemEnvironmentPrivilege
SeLoadDriverPrivilege&nbsp;SeImpersonatePrivilege
Time:&nbsp;06:33:35
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-0-0&nbsp;SubjectUserName&nbsp;=&nbsp;-&nbsp;SubjectDomainName&nbsp;=&nbsp;-&nbsp;SubjectLogonId&nbsp;=
0x0000000000000000&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f2736
-&nbsp;LogonType&nbsp;=&nbsp;3
-&nbsp;LogonProcessName&nbsp;=&nbsp;NtLmSsp
-&nbsp;AuthenticationPackageName&nbsp;=&nbsp;NTLM
-&nbsp;WorkstationName&nbsp;=&nbsp;USER-WS
-&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=
NTLM&nbsp;V1&nbsp;KeyLength&nbsp;=&nbsp;128&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000000&nbsp;ProcessName&nbsp;=&nbsp;-
-&nbsp;IpAddress&nbsp;=&nbsp;192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49298
Command:&nbsp;robocopy.exe&nbsp;c:\goodies\sch&nbsp;\\admin-ws\c$
Time:&nbsp;06:34:02
Event:&nbsp;4634
Event&nbsp;content:
-&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f2736
-&nbsp;LogonType&nbsp;=&nbsp;3
Time:&nbsp;06:34:15
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;SubjectUserName&nbsp;=&nbsp;my-admin&nbsp;SubjectDomainName&nbsp;=&nbsp;CORP
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000000f309b
-&nbsp;PrivilegeList&nbsp;=&nbsp;SeSecurityPrivilege&nbsp;SeBackupPrivilege&nbsp;SeRestorePrivilege
SeTakeOwnershipPrivilege&nbsp;SeDebugPrivilege&nbsp;SeSystemEnvironmentPrivilege
SeLoadDriverPrivilege&nbsp;SeImpersonatePrivilege&nbsp;LogonId&nbsp;=&nbsp;0x00000000000f309b
Time:&nbsp;06:34:15
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-0-0&nbsp;SubjectUserName&nbsp;=&nbsp;-&nbsp;SubjectDomainName&nbsp;=&nbsp;-&nbsp;SubjectLogonId&nbsp;=
0x0000000000000000&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f309b
-&nbsp;LogonType&nbsp;=&nbsp;3
-&nbsp;LogonProcessName&nbsp;=&nbsp;NtLmSsp
-&nbsp;AuthenticationPackageName&nbsp;=&nbsp;NTLM
-&nbsp;WorkstationName&nbsp;=&nbsp;USER-WS
-&nbsp;LogonGuid&nbsp;=&nbsp;{00000000-0000-0000-0000-000000000000}&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=
NTLM&nbsp;V1&nbsp;KeyLength&nbsp;=&nbsp;128&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000000&nbsp;ProcessName&nbsp;=&nbsp;-
-&nbsp;IpAddress&nbsp;=&nbsp;192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49299
Command:&nbsp;at.exe&nbsp;\\admin-ws&nbsp;08:00&nbsp;c:\schedule.bat
Comment:&nbsp;LogonId&nbsp;=&nbsp;0x00000000000f309b
Time:&nbsp;06:34:26
Event:&nbsp;4634
Event&nbsp;content:
-&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1105
-&nbsp;TargetUserName&nbsp;=&nbsp;my-admin
-&nbsp;TargetDomainName&nbsp;=&nbsp;CORP
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000000f309b
-&nbsp;LogonType&nbsp;=&nbsp;3
Comment:&nbsp;LogonId&nbsp;=&nbsp;0x00000000000f309b</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">6.2 Kerberos认证和PtT事件</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.2.1 域控中的相关事件</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们可以在域控中看到4769事件：来自于user-ws主机的IP地址（192.168.86.101）请求了Kerberos服务票据，以便访问admin-ws主机。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要注意的是，我们在域控中没有找到4768事件（Kerberos TGT请求事件），因为攻击者已经事先窃取了票据，然后重新注入该票据发起攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Time:&nbsp;14:11:12
Event:&nbsp;4769
Event&nbsp;content:
-&nbsp;TargetUserName&nbsp;=&nbsp;myadmin@corp
-&nbsp;TargetDomainName&nbsp;=&nbsp;corp
-&nbsp;ServiceName&nbsp;=&nbsp;ADMIN-WS$
-&nbsp;ServiceSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-1107
-&nbsp;TicketOptions&nbsp;=&nbsp;0x40810000
-&nbsp;TicketEncryptionType&nbsp;=&nbsp;0x00000012
-&nbsp;IpAddress&nbsp;=&nbsp;::ffff:192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49407
-&nbsp;Status&nbsp;=&nbsp;0x00000000
-&nbsp;LogonGuid&nbsp;=&nbsp;{B757831E-D810-CDCC-C1C2-804BB3A2FB2C}
-&nbsp;TransmittedServices&nbsp;=&nbsp;-
Command:&nbsp;net&nbsp;use&nbsp;\\admin-ws</pre><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">6.2.2 目标主机（admin-ws）中的事件</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们在目标主机中可以找到与账户成功登陆有关的两个事件（4624事件）。与域控上的情况类似，这些事件都与黄金票据攻击无关。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Time:&nbsp;14:11:12
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-0-0&nbsp;SubjectUserName&nbsp;=&nbsp;-&nbsp;SubjectDomainName&nbsp;=&nbsp;-&nbsp;SubjectLogonId&nbsp;=
0x0000000000000000
-&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-500&nbsp;TargetUserName&nbsp;=&nbsp;myadmin
TargetDomainName&nbsp;=&nbsp;corp
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x000000000051f916
-&nbsp;LogonType&nbsp;=&nbsp;3&nbsp;LogonProcessName&nbsp;=&nbsp;Kerberos&nbsp;AuthenticationPackageName&nbsp;=&nbsp;Kerberos
-&nbsp;WorkstationName&nbsp;=
-&nbsp;LogonGuid&nbsp;=&nbsp;{A0706C8D-9BC6-F4D5-1226-FA2A48BB58D9}&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=&nbsp;-
KeyLength&nbsp;=&nbsp;0&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000000&nbsp;ProcessName&nbsp;=&nbsp;-
-&nbsp;IpAddress&nbsp;=&nbsp;192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49406
Command:&nbsp;net&nbsp;use&nbsp;\\admin-ws
Time:&nbsp;14:11:12
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-500&nbsp;SubjectUserName&nbsp;=&nbsp;myadmin
-&nbsp;SubjectDomainName&nbsp;=
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x000000000051f916
-&nbsp;PrivilegeList&nbsp;=&nbsp;SeSecurityPrivilege&nbsp;SeBackupPrivilege&nbsp;SeRestorePrivilege
SeTakeOwnershipPrivilege&nbsp;SeDebugPrivilege&nbsp;SeSystemEnvironmentPrivilege&nbsp;SeLoadDriverPrivilege
SeImpersonatePrivilege
Command:&nbsp;net&nbsp;use&nbsp;\\admin-ws
Time:&nbsp;14:11:39
Event:&nbsp;4624
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-0-0&nbsp;SubjectUserName&nbsp;=&nbsp;-&nbsp;SubjectDomainName&nbsp;=&nbsp;-&nbsp;SubjectLogonId&nbsp;=
0x0000000000000000
-&nbsp;TargetUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-500&nbsp;TargetUserName&nbsp;=&nbsp;myadmin
TargetDomainName&nbsp;=&nbsp;corp
-&nbsp;TargetLogonId&nbsp;=&nbsp;0x00000000005204ad
-&nbsp;LogonType&nbsp;=&nbsp;3&nbsp;LogonProcessName&nbsp;=&nbsp;Kerberos&nbsp;AuthenticationPackageName&nbsp;=&nbsp;Kerberos
-&nbsp;WorkstationName&nbsp;=
-&nbsp;LogonGuid&nbsp;=&nbsp;{B504E2E8-3007-1C03-F480-011559C08D34}&nbsp;TransmittedServices&nbsp;=&nbsp;-&nbsp;LmPackageName&nbsp;=&nbsp;-
KeyLength&nbsp;=&nbsp;0&nbsp;ProcessId&nbsp;=&nbsp;0x0000000000000000&nbsp;ProcessName&nbsp;=&nbsp;-
-&nbsp;IpAddress&nbsp;=&nbsp;192.168.89.101&nbsp;IpPort&nbsp;=&nbsp;49409
Command:&nbsp;psexec.exe&nbsp;\\admin-ws&nbsp;cmd.exe
Time:&nbsp;14:11:39
Event:&nbsp;4672
Event&nbsp;content:
-&nbsp;SubjectUserSid&nbsp;=&nbsp;S-1-5-21-2976932740-3244455291-537790045-500&nbsp;SubjectUserName&nbsp;=&nbsp;myadmin
SubjectDomainName&nbsp;=
-&nbsp;SubjectLogonId&nbsp;=&nbsp;0x00000000005204ad
-&nbsp;PrivilegeList&nbsp;=&nbsp;SeSecurityPrivilege&nbsp;SeBackupPrivilege&nbsp;SeRestorePrivilege
SeTakeOwnershipPrivilege&nbsp;SeDebugPrivilege&nbsp;SeSystemEnvironmentPrivilege&nbsp;SeLoadDriverPrivilege
SeImpersonatePrivilege
Command:&nbsp;psexec.exe&nbsp;\\admin-ws&nbsp;cmd.exe</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">6.3 附录D-Windows安全（Security）事件</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这部分主要介绍了本文中所提到的安全事件细节，参考了微软的官方定义[5][6]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4624事件：成功登录帐户。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
Logon&nbsp;Type:&nbsp;%9
New&nbsp;Logon:
Security&nbsp;ID:&nbsp;%5
Account&nbsp;Name:&nbsp;%6
Account&nbsp;Domain:&nbsp;%7
Logon&nbsp;ID:&nbsp;%8
Logon&nbsp;GUID:&nbsp;%13
Process&nbsp;Information:
Process&nbsp;ID:&nbsp;%17
Process&nbsp;Name:&nbsp;%18
Network&nbsp;Information:
Workstation&nbsp;Name:&nbsp;%12
Source&nbsp;Network&nbsp;Address:&nbsp;%19
Source&nbsp;Port:&nbsp;%20
Detailed&nbsp;Authentication&nbsp;Information:
Logon&nbsp;Process:&nbsp;%10
Authentication&nbsp;Package:&nbsp;%11
Transited&nbsp;Services:&nbsp;%14
Package&nbsp;Name&nbsp;(NTLM&nbsp;only):&nbsp;%15
Key&nbsp;Length:&nbsp;%16
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a&nbsp;logon&nbsp;session&nbsp;is&nbsp;created.&nbsp;It&nbsp;is&nbsp;generated&nbsp;on&nbsp;the&nbsp;computer&nbsp;that&nbsp;was&nbsp;accessed.
The&nbsp;subject&nbsp;fields&nbsp;indicate&nbsp;the&nbsp;account&nbsp;on&nbsp;the&nbsp;local&nbsp;system&nbsp;which&nbsp;requested&nbsp;the&nbsp;logon.&nbsp;This&nbsp;is&nbsp;most&nbsp;commonly&nbsp;a&nbsp;service&nbsp;such&nbsp;as&nbsp;the&nbsp;Server&nbsp;service,&nbsp;or&nbsp;a&nbsp;local&nbsp;process&nbsp;such&nbsp;as&nbsp;Winlogon.exe
or&nbsp;Services.exe.
The&nbsp;logon&nbsp;type&nbsp;field&nbsp;indicates&nbsp;the&nbsp;kind&nbsp;of&nbsp;logon&nbsp;that&nbsp;occurred.&nbsp;The&nbsp;most&nbsp;common&nbsp;types&nbsp;are&nbsp;2&nbsp;(interactive)&nbsp;and&nbsp;3&nbsp;(network).
The&nbsp;New&nbsp;Logon&nbsp;fields&nbsp;indicate&nbsp;the&nbsp;account&nbsp;for&nbsp;whom&nbsp;the&nbsp;new&nbsp;logon&nbsp;was&nbsp;created,&nbsp;i.e.&nbsp;the&nbsp;account&nbsp;that&nbsp;was&nbsp;logged&nbsp;on.
The&nbsp;network&nbsp;fields&nbsp;indicate&nbsp;where&nbsp;a&nbsp;remote&nbsp;logon&nbsp;request&nbsp;originated.&nbsp;Workstation&nbsp;name&nbsp;is&nbsp;not&nbsp;always&nbsp;available&nbsp;and&nbsp;may&nbsp;be&nbsp;left&nbsp;blank&nbsp;in&nbsp;some&nbsp;cases.
The&nbsp;authentication&nbsp;information&nbsp;fields&nbsp;provide&nbsp;detailed&nbsp;information&nbsp;about&nbsp;this&nbsp;specific&nbsp;logon&nbsp;request.
-&nbsp;Logon&nbsp;GUID&nbsp;is&nbsp;a&nbsp;unique&nbsp;identifier&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;correlate&nbsp;this&nbsp;event&nbsp;with&nbsp;a&nbsp;KDC&nbsp;event.
-&nbsp;Transited&nbsp;services&nbsp;indicate&nbsp;which&nbsp;intermediate&nbsp;services&nbsp;have&nbsp;participated&nbsp;in&nbsp;this&nbsp;logon&nbsp;request.
-&nbsp;Package&nbsp;name&nbsp;indicates&nbsp;which&nbsp;sub-protocol&nbsp;was&nbsp;used&nbsp;among&nbsp;the&nbsp;NTLM&nbsp;protocols.
-&nbsp;Key&nbsp;length&nbsp;indicates&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;generated&nbsp;session&nbsp;key.&nbsp;This&nbsp;will&nbsp;be&nbsp;0&nbsp;if&nbsp;no&nbsp;session&nbsp;key&nbsp;was&nbsp;requested.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4625事件：帐户登录失败。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
Logon&nbsp;Type:&nbsp;%11
Account&nbsp;For&nbsp;Which&nbsp;Logon&nbsp;Failed:
Security&nbsp;ID:&nbsp;%5
Account&nbsp;Name:&nbsp;%6
Account&nbsp;Domain:&nbsp;%7
Failure&nbsp;Information:
Failure&nbsp;Reason:&nbsp;%9
Status:&nbsp;%8
Sub&nbsp;Status:&nbsp;%10
Process&nbsp;Information:
Caller&nbsp;Process&nbsp;ID:&nbsp;%18
Caller&nbsp;Process&nbsp;Name:&nbsp;%19
Network&nbsp;Information:
Workstation&nbsp;Name:&nbsp;%14
Source&nbsp;Network&nbsp;Address:&nbsp;%20
Source&nbsp;Port:&nbsp;%21
Detailed&nbsp;Authentication&nbsp;Information:
Logon&nbsp;Process:&nbsp;%12
Authentication&nbsp;Package:&nbsp;%13
Transited&nbsp;Services:&nbsp;%15
Package&nbsp;Name&nbsp;(NTLM&nbsp;only):&nbsp;%16
Key&nbsp;Length:&nbsp;%17
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a&nbsp;logon&nbsp;request&nbsp;fails.&nbsp;It&nbsp;is&nbsp;generated&nbsp;on&nbsp;the&nbsp;computer&nbsp;where&nbsp;access&nbsp;was&nbsp;attempted.
The&nbsp;Subject&nbsp;fields&nbsp;indicate&nbsp;the&nbsp;account&nbsp;on&nbsp;the&nbsp;local&nbsp;system&nbsp;which&nbsp;requested&nbsp;the&nbsp;logon.&nbsp;This&nbsp;is&nbsp;most&nbsp;commonly&nbsp;a&nbsp;service&nbsp;such&nbsp;as&nbsp;the&nbsp;Server&nbsp;service,&nbsp;or&nbsp;a&nbsp;local&nbsp;process&nbsp;such&nbsp;as&nbsp;Winlogon.exe
or&nbsp;Services.exe.
The&nbsp;Logon&nbsp;Type&nbsp;field&nbsp;indicates&nbsp;the&nbsp;kind&nbsp;of&nbsp;logon&nbsp;that&nbsp;was&nbsp;requested.&nbsp;The&nbsp;most&nbsp;common&nbsp;types&nbsp;are&nbsp;2&nbsp;(interactive)&nbsp;and&nbsp;3&nbsp;(network).
The&nbsp;Process&nbsp;Information&nbsp;fields&nbsp;indicate&nbsp;which&nbsp;account&nbsp;and&nbsp;process&nbsp;on&nbsp;the&nbsp;system&nbsp;requested&nbsp;the&nbsp;logon.
The&nbsp;Network&nbsp;Information&nbsp;fields&nbsp;indicate&nbsp;where&nbsp;a&nbsp;remote&nbsp;logon&nbsp;request&nbsp;originated.&nbsp;Workstation&nbsp;name&nbsp;is&nbsp;not&nbsp;always&nbsp;available&nbsp;and&nbsp;may&nbsp;be&nbsp;left&nbsp;blank&nbsp;in&nbsp;some&nbsp;cases.
The&nbsp;authentication&nbsp;information&nbsp;fields&nbsp;provide&nbsp;detailed&nbsp;information&nbsp;about&nbsp;this&nbsp;specific&nbsp;logon&nbsp;request.
-&nbsp;Transited&nbsp;services&nbsp;indicate&nbsp;which&nbsp;intermediate&nbsp;services&nbsp;have&nbsp;participated&nbsp;in&nbsp;this&nbsp;logon&nbsp;request.
-&nbsp;Package&nbsp;name&nbsp;indicates&nbsp;which&nbsp;sub-protocol&nbsp;was&nbsp;used&nbsp;among&nbsp;the&nbsp;NTLM&nbsp;protocols.
-&nbsp;Key&nbsp;length&nbsp;indicates&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;generated&nbsp;session&nbsp;key.&nbsp;This&nbsp;will&nbsp;be&nbsp;0&nbsp;if&nbsp;no&nbsp;session&nbsp;key&nbsp;was&nbsp;requested.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4634事件：帐户被注销。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
Logon&nbsp;Type:&nbsp;%5
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a&nbsp;logon&nbsp;session&nbsp;is&nbsp;destroyed.&nbsp;It&nbsp;may&nbsp;be&nbsp;positively&nbsp;correlated&nbsp;with&nbsp;a&nbsp;logon&nbsp;event&nbsp;using&nbsp;the&nbsp;Logon&nbsp;ID&nbsp;value.&nbsp;Logon&nbsp;IDs&nbsp;are&nbsp;only&nbsp;unique&nbsp;between&nbsp;reboots&nbsp;on&nbsp;the&nbsp;same&nbsp;computer.
Event&nbsp;ID:&nbsp;4647
User&nbsp;initiated&nbsp;logoff.
Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a&nbsp;logoff&nbsp;is&nbsp;initiated&nbsp;but&nbsp;the&nbsp;token&nbsp;reference&nbsp;count&nbsp;is&nbsp;not&nbsp;zero&nbsp;and&nbsp;the&nbsp;logon&nbsp;session&nbsp;cannot&nbsp;be&nbsp;destroyed.&nbsp;No&nbsp;further&nbsp;user-initiated&nbsp;activity&nbsp;can&nbsp;occur.&nbsp;This&nbsp;event&nbsp;can&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;logoff&nbsp;event.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4648事件：试图使用显式凭据登录。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
Logon&nbsp;GUID:&nbsp;%5
Account&nbsp;Whose&nbsp;Credentials&nbsp;Were&nbsp;Used:
Account&nbsp;Name:&nbsp;%6
Account&nbsp;Domain:&nbsp;%7
Logon&nbsp;GUID:&nbsp;%8
Target&nbsp;Server:
Target&nbsp;Server&nbsp;Name:&nbsp;%9
Additional&nbsp;Information:&nbsp;%10
Process&nbsp;Information:
Process&nbsp;ID:&nbsp;%11
Process&nbsp;Name:&nbsp;%12
Network&nbsp;Information:
Network&nbsp;Address:&nbsp;%13
Port:&nbsp;%14
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;when&nbsp;a&nbsp;process&nbsp;attempts&nbsp;to&nbsp;log&nbsp;on&nbsp;an&nbsp;account&nbsp;by&nbsp;explicitly&nbsp;specifying&nbsp;that&nbsp;accounts&nbsp;credentials.&nbsp;This&nbsp;most&nbsp;commonly&nbsp;occurs&nbsp;in&nbsp;batch-type&nbsp;configurations&nbsp;such&nbsp;as&nbsp;scheduled&nbsp;tasks,&nbsp;or&nbsp;when&nbsp;using&nbsp;the&nbsp;RUNAS&nbsp;command.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4672事件：分配给新的登录特权。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Subject:
Security&nbsp;ID:&nbsp;%1
Account&nbsp;Name:&nbsp;%2
Account&nbsp;Domain:&nbsp;%3
Logon&nbsp;ID:&nbsp;%4
Privileges:&nbsp;%5</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4768事件：Kerberos 身份验证票证 (TGT) 请求。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Account&nbsp;Information:
Account&nbsp;Name:&nbsp;%1
Supplied&nbsp;Realm&nbsp;Name:&nbsp;%2
User&nbsp;ID:&nbsp;%3
Service&nbsp;Information:
Service&nbsp;Name:&nbsp;%4
Service&nbsp;ID:&nbsp;%5
Network&nbsp;Information:
Client&nbsp;Address:&nbsp;%10
Client&nbsp;Port:&nbsp;%11
Additional&nbsp;Information:
Ticket&nbsp;Options:&nbsp;%6
Result&nbsp;Code:&nbsp;%7
Ticket&nbsp;Encryption&nbsp;Type:&nbsp;%8
Pre-Authentication&nbsp;Type:&nbsp;%9
Certificate&nbsp;Information:
Certificate&nbsp;Issuer&nbsp;Name:&nbsp;%12
Certificate&nbsp;Serial&nbsp;Number:&nbsp;%13
Certificate&nbsp;Thumbprint:&nbsp;%14
Certificate&nbsp;information&nbsp;is&nbsp;only&nbsp;provided&nbsp;if&nbsp;a&nbsp;certificate&nbsp;was&nbsp;used&nbsp;for&nbsp;pre-authentication.
Pre-authentication&nbsp;types,&nbsp;ticket&nbsp;options,&nbsp;encryption&nbsp;types&nbsp;and&nbsp;result&nbsp;codes&nbsp;are&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4120.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4769事件：Kerberos 服务票证请求。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Account&nbsp;Information:
Account&nbsp;Name:&nbsp;%1
Account&nbsp;Domain:&nbsp;%2
Logon&nbsp;GUID:&nbsp;%10
Service&nbsp;Information:
Service&nbsp;Name:&nbsp;%3
Service&nbsp;ID:&nbsp;%4
Network&nbsp;Information:
Client&nbsp;Address:&nbsp;%7
Client&nbsp;Port:&nbsp;%8
Additional&nbsp;Information:
Ticket&nbsp;Options:&nbsp;%5
Ticket&nbsp;Encryption&nbsp;Type:&nbsp;%6
Failure&nbsp;Code:&nbsp;%9
Transited&nbsp;Services:&nbsp;%11
This&nbsp;event&nbsp;is&nbsp;generated&nbsp;every&nbsp;time&nbsp;access&nbsp;is&nbsp;requested&nbsp;to&nbsp;a&nbsp;resource&nbsp;such&nbsp;as&nbsp;a&nbsp;computer&nbsp;or&nbsp;a&nbsp;Windows&nbsp;service.&nbsp;The&nbsp;service&nbsp;name&nbsp;indicates&nbsp;the&nbsp;resource&nbsp;to&nbsp;which&nbsp;access&nbsp;was&nbsp;requested.
This&nbsp;event&nbsp;can&nbsp;be&nbsp;correlated&nbsp;with&nbsp;Windows&nbsp;logon&nbsp;events&nbsp;by&nbsp;comparing&nbsp;the&nbsp;Logon&nbsp;GUID&nbsp;fields&nbsp;in&nbsp;each&nbsp;event.&nbsp;The&nbsp;logon&nbsp;event&nbsp;occurs&nbsp;on&nbsp;the&nbsp;machine&nbsp;that&nbsp;was&nbsp;accessed,&nbsp;which&nbsp;is&nbsp;often&nbsp;a&nbsp;different&nbsp;machine&nbsp;than&nbsp;the&nbsp;domain&nbsp;controller&nbsp;which&nbsp;issued&nbsp;the&nbsp;service&nbsp;ticket.
Ticket&nbsp;options,&nbsp;encryption&nbsp;types,&nbsp;and&nbsp;failure&nbsp;codes&nbsp;are&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4120.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">4776事件：域控试图验证帐户凭据</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Authentication&nbsp;Package:&nbsp;%1
Logon&nbsp;Account:&nbsp;%2
Source&nbsp;Workstation:&nbsp;%3
Error&nbsp;Code:&nbsp;%4</pre></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="http://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf" target="_blank">原文链接：http://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】如何检测Windows中的横向渗透攻击 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3830" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
