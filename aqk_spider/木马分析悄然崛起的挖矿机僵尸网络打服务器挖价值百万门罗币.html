<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【木马分析】悄然崛起的挖矿机僵尸网络：打服务器挖价值百万门罗币 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="僵尸网络,挖矿,门罗币"/>
    
        <meta name="description" content="360互联网安全中心监测到一种利用被入侵服务器进行门罗币挖矿的僵尸网络，该僵尸网络控制的服务器数量高峰时单日达到两万多台。僵尸网络建立初期利用“永恒之蓝”漏洞攻击武器入侵一定数量的计算机并以此作为僵尸网络发展的基础。本文选用Bot程序2017年4月份编译的1.0.0.2版本作为分析的样本"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【木马分析】悄然崛起的挖矿机僵尸网络：打服务器挖价值百万门罗币</h2>
                <div class="article-msg">
                    <span class="time">2017-09-01 20:51:37</span>
                    
                                        <span class="read">阅读：10376次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_4351"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="4351" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 安全客</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2515404167" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t01cc856584b7ed76c0.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2515404167" style="color:#848e99;">360安全卫士</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center;"><img src="http://p1.qhimg.com/t01273428a584fea3db.jpg" title="t01273428a584fea3db.jpg" alt="http://p1.qhimg.com/t01273428a584fea3db.jpg"/></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">第一部分 背景</span></strong></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"></span></strong></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">360互联网安全中心监测到一种利用被入侵服务器进行门罗币挖矿的僵尸网络，该僵尸网络控制的服务器数量高峰时单日达到两万多台。僵尸网络建立初期利用“<span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(255, 0, 0);"><strong>永恒之蓝</strong></span>”漏洞攻击武器入侵一定数量的计算机并以此作为僵尸网络发展的基础，之后这些计算机扫描其他计算机的1433端口（msSQL服务端口），尝试爆破目标计算机的msSQL服务，一旦爆破成功则登陆SQL Server执行恶意代码。目标计算机被僵尸网络控制之后同样会通过1433端口入侵其他计算机，僵尸网络因此不断扩大控制范围，最终形成现在这样的规模。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">僵尸网络的蔓延离不开强大的Bot程序，通过代码同源性可以发现该家族的Bot程序的诞生最早可追溯到2014年。在2014年到2017年之间， Bot程序进行多次版本更新，最早的版本只是简单的入侵与远程控制，从2017年4月的版本开始， Bot程序借鉴多款扫描器、爆破工具以及著名僵尸网络mirai的实现，添加了多种针对不同协议的扫描爆破模块，并且实现了一套针对msSQL的“入侵+利用+传播”的攻击模块。Bot程序版本更替及传播量如下图所示。（图示中xx.x.x.x.x(x)表示的是Bot程序的版本，例如17.1.0.0.2(1)表示2017年编译的1.0.0.2版本的Bot程序变种1）</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t01dbe583948929141a.png" title="t014d954858293383bd.png" alt="http://p0.qhimg.com/t014d954858293383bd.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图1-1 Bot程序版本更替及感染量概览图</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">从图1-1中可以看出，Bot程序自4月底开始传播量开始出现爆发式增长，这正是作者利用“永恒之蓝”漏洞攻击武器进行僵尸网络建立的时间段。此外，Bot程序有一套完善的更新体系，当Bot程序检测到有新版本发布之后，将自动更新至最新版本。从图1种也不难看出，新版本传播量增加之后，老版本的传播量也相应地下降。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Bot程序当前的主要目的是安装门罗币挖矿机，利用服务器资源挖矿。截止目前，作者的门罗币钱包已经有高达1975枚门罗币，当前约合人民币167万。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t011c06eea11a9e08a8.png" title="t016d7a519760e8d986.png" alt="http://p9.qhimg.com/t016d7a519760e8d986.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图1-2 作者门罗币钱包概况</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Bot程序高度模块化，集合了多种不同的功能，并且具有完善的更新和持久驻留机制。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对Bot程序的分析将有助于了解该僵尸网络的传播机制。本文将通过对Bot程序的详细分析，挖掘该僵尸网络的工作原理，并据此讨论服务器在面对该僵尸网络时所需的预防措施以及防御策略。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第二部分 Bot程序分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">本文选用Bot程序2017年4月份编译的1.0.0.2版本作为分析的样本，样本MD5：<strong>10ace2e06cc8b5656d38eb2e6ed4f079</strong>。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Bot程序由<strong>main</strong>模块，<strong>update</strong>模块，<strong>Scanner</strong>模块，<strong>Cracker</strong>模块，<strong>ServerAgent</strong>模块和<strong>cService</strong>模块6个模块构成，模块之间互有联系，相互协作。以下将对每个模块执行的功能进行分析。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1. main模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Bot程序是以控制台形式存在的，在介绍main模块之前先介绍Bot程序所接收的启动参数以及参数对应的功能。</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p7.qhimg.com/t010d113efdc7050a8d.png" title="t01d7796b87ed03ed81.png" alt="http://p1.qhimg.com/t01d7796b87ed03ed81.png"/></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">表2-1-1 Bot程序所接收的参数及对应的功能</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这些启动参数满足以下几条规则：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1.当存在“-start”，“-stop”，“-create”和“-delete”中的多个时，只有第一个参数是有效的，因此作者引入“-run”参数配合“-create”参数以完成创建服务并启动服务的操作。&nbsp;</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.“-delete”参数在删除Bot服务之前会关闭该服务。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.当未指定“-syn”参数时默认扫描器为<strong>TCP_CONNECT</strong>模式。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4.当同时存在“-srv”和“-cli”时只有第一个参数是是有效的，两者都不存在时默认为“-srv”。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.当程序启动参数包含“-s”时，将以服务形式执行main模块，否则以控制台形式执行main模块。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">main模块主要是进行一些准备工作以及配置并启用其他模块。在程序准备工作方面，主要包括以下几部分。</span></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（1）获取系统信息。</span></strong></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01c6a83754ff9fd935.png" title="t0157fe2455f08e8247.png" alt="http://p7.qhimg.com/t0157fe2455f08e8247.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-1-1 获取系统信息</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(227, 108, 9);">（2）判断系统类型是否为Server。</span></strong></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01d8f8da83e20d4666.png" title="t012f7d7c2f3c705af8.png" alt="http://p9.qhimg.com/t012f7d7c2f3c705af8.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-1-2 判断系统类型</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(227, 108, 9);">（3）结束并禁用Network list Service和Network Location Awareness</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">。Network list Service用于识别计算机已连接的网络，收集和存储这些网络的属性，并在更改这些属性时通知应用程序；Network Location Awareness用于收集并保存网络配置和位置信息，并在信息改动时通知应用程序。Bot程序关闭并禁用这些服务以防止自身的网络通信被记录。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t0103bce29d2da9309c.png" title="t012e7af8ef6f3ae236.png" alt="http://p2.qhimg.com/t012e7af8ef6f3ae236.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-1-3 结束并禁用Network list Service和Network Location Awareness</span></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（4）结束并禁用SharedAccess和MpsSvc（Intemet连接共享和防火墙服务）以保障Bot程序的网络通信能够正常进行，并且删除日志文件。</span></strong></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t0131c96778dcb6c7f4.png" title="t01491a81c503b2c900.png" alt="http://p1.qhimg.com/t01491a81c503b2c900.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-1-4结束并禁用SharedAccess和MpsSvc</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">完成初始化工作之后，main模块将创建新线程执行update模块。update模块检查Bot程序版本并根据情况进行更新。同时，main模块还作为Scanner模块，Cracker模块和ServerAgent模块的入口。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. update模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">update模块是Bot程序进行自更新的模块。当程序执行main模块时，将创建线程执行update模块进行版本检查及必要的更新。update模块每6小时进行一次更新检查。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t011ceec7e1f58986ff.png" title="t01c6a5a4eab0853b4f.png" alt="http://p6.qhimg.com/t01c6a5a4eab0853b4f.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-1 创建线程执行update模块</span></p><p style="text-indent: 2em; text-align: center;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t01a819221db0b4147d.png" title="t01d906a338c57279a3.png" alt="http://p7.qhimg.com/t01d906a338c57279a3.png"/></span></p><p style="text-indent: 2em; text-align: center;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-2 调用Sleep函数以定期执行update模块</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">进行更新检查时，update模块首先获取程序当前的版本号，之后通过博客地址“<strong>http://blog.sina.com.cn/s/blog_16fb721c50102x6hw.html</strong>”获得加密后的C&amp;C的ip地址。将加密后的ip地址去除首尾的分隔符（***和@@@），经过base64解密并与0x36异或之后得到真实的ip地址（在本样本中，C&amp;C ip地址为67.229.144.218，以下简称为“ip”）。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t011cc5539bb912a503.png" title="t01c8918271270c0dda.png" alt="http://p1.qhimg.com/t01c8918271270c0dda.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-3 博客中加密的ip地址</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">http://ip:8888/ver.txt</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">中存放最新的Bot程序版本号，update模块读取该版本号并与当前Bot程序的版本号进行对比。当两者相同时，则认为程序已经更新到最新版本，继续执行后续功能；当两者不同时，则对程序进行更新。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t015121c83f9317426d.png" title="t01ef75275db865a74d.png" alt="http://p1.qhimg.com/t01ef75275db865a74d.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-4 对比Bot程序版本和最新版本号</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t014278dc71ad1faa79.png" title="t019750239f74987300.png" alt="http://p6.qhimg.com/t019750239f74987300.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-5 最新的版本号</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">若Bot程序未更新到最新版本，则进行更新。最新版本的Bot程序通过路径<strong>C://windows/system</strong>下的更新程序cabs.exe获取。若cabs.exe不存在，则Bot程序将从<strong>http://ip:8888/ups.rar</strong>下载cab.exe，并启动该程序进行更新。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p9.qhimg.com/t01d6257398a99c3bdf.png" title="t01c274db679f4eeef6.png" alt="http://p1.qhimg.com/t01c274db679f4eeef6.png"/>&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-6 下载更新程序cab.exe并启动更新</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">cabs.exe会判断当前计算机系统是否为<strong>Windows Server</strong>，只有当当前计算机系统为Windows Server时才会执行更新。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t01ea44a68cf862dd7e.png" title="t0125882534be9861ad.png" alt="http://p0.qhimg.com/t0125882534be9861ad.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-7 判断当前系统是否为Windows Server</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果当前计算机系统为Windows Server，则访问<strong>http://ip:8888/update.txt</strong>获取最新的下载列表，并将下载列表下载到<strong>c:\\windows\\system</strong>路径下，命名为upslist.txt。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p0.qhimg.com/t017657f619a30fb946.png" title="t0189e269cf69ccae55.png" alt="http://p6.qhimg.com/t0189e269cf69ccae55.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-8 下载下载列表</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">下载列表中包含两个文件ps.jpg和my1.html。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t0113c705851700cc47.png" title="t01e0f0e07a941b44b6.png" alt="http://p0.qhimg.com/t01e0f0e07a941b44b6.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-9 下载列表内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">ps.jpg是末尾拼接了一个PE文件的图片。该PE文件就是最新版本的Bot程序。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t014537634675b75637.png" title="t015455c28c9fcb1eba.png" alt="http://p2.qhimg.com/t015455c28c9fcb1eba.png"/><img src="http://p2.qhimg.com/t01ac7cb9bc6347e022.png" title="t015455c28c9fcb1eba.png" alt="http://p6.qhimg.com/t015455c28c9fcb1eba.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-10 藏有最新版本Bot程序的图片</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t0187f5c5d7d2cfd1af.png" title="t01ef049dfa739a390b.png" alt="http://p8.qhimg.com/t01ef049dfa739a390b.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-2-11 图片中监测到的PE文件特征</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">my1.html是一个批处理脚本，功能与Cracker:mssql模块释放的批处理脚本123.dat基本相同，主要是创建一些需要的文件夹并为之后Cracker模块配置环境。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">完成下载之后，cabs.exe会结束Bot程序的进程和服务，更新相关文件之后再重启Bot进程和服务。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. scanner模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">scanner模块修改自masscan（github：<a href="https://github.com/robertdavidgraham/masscan" target="_self">https://github.com/robertdavidgraham/masscan</a>）。masscan是一个快速、灵活的端口扫描器，在windows下发包速度可达到每秒30万包。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在调用scanner模块进行扫描之前，Bot程序会配置一个excludefile，该文件指定ip段黑名单，在该范围中的ip地址将不会被扫描。ip黑名单以字符串的形式存放在Bot程序的资源段中，scanner模块在临时文件夹下创建excludefile，读取资源后将ip黑名单写入excludefile。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t0100ac0122b9d3deb3.png" title="t0191c706fd02e126aa.png" alt="http://p6.qhimg.com/t0191c706fd02e126aa.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-3-1 读取ip黑名单资源并写入excludefile</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; white-space: pre;"></span>在Bot程序2017年四月份编译的1.0.0.2版本和五月份编译的1.0.0.3版本的其中一个变种中未发现ip黑名单，在五月份编译的1.0.0.3版本的另一个变种中发现了ip黑名单。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t017ee15a523208aaa2.png" title="t011a001514f8b91760.png" alt="http://p5.qhimg.com/t011a001514f8b91760.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-3-2 存放在Bot程序资源段中的ip黑名单</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于每一个a类ip，scaner模块排除掉部分b段。由于全网扫描容易遭到监控，通过排除部分ip地址可以减少被发现的风险。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t01eb18beaf46fad693.png" title="t011c7b343778626ddc.png" alt="http://p9.qhimg.com/t011c7b343778626ddc.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-3-3 scanner模块排除部分ip地址后扫描全网</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">scanner模块能够扫描的端口包括<strong>1433端口，3306端口，135端口，22端口，445端口，23端口，80端口和3389端口</strong>。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01f2481071f8fe6576.png" title="t01d4546271c8faa62e.png" alt="http://p8.qhimg.com/t01d4546271c8faa62e.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-3-4 部分scanner模块扫描的端口</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">scanner模块可通过两种模式进行端口扫描，分别是<strong>TCP_SYN</strong>扫描和<strong>TCP_CONNECT</strong>扫描。使用何种扫描模式由参数“-syn”决定，如果启动参数包含“-syn”则选择使用<strong>TCP_SYN</strong>模式进行端口扫描，否则选择<strong>TCP_CONNECT</strong>模式进行端口扫描。当选择<strong>TCP_SYN</strong>模式进行端口扫描时，Bot程序只发送SYN帧，端口开放回应SYN&amp;ACK帧，端口关闭回应RST帧；当选择TCP_CONNECT模式进行端口扫描时，Bot程序尝试连接目标端口，端口开放则连接成功，否则连接失败。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Scanner模块创建的最大扫描线程数由“-t”参数决定，“-t”的最大值为1800。在scanner模块创建扫描线程的同时会同时创建名为“CrackerWMI”的线程，但是在Bot程序发送的数据包中并未发现目的端口为135（wmi服务使用的端口）的数据包，推测可能是作者预留的尚未完善的功能。&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01e74437c99a947c21.png" title="t015b609b10120a553d.png" alt="http://p7.qhimg.com/t015b609b10120a553d.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-3-5 两种不同的扫描模式</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">scanner模块会记录开放特定端口的ip地址，并且与<strong>ServerAgent</strong>模块和<strong>Cracker</strong>模块进行交互完成“端口扫描+爆破+入侵”一系列工作。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4. ServerAgent模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">ServerAgent模块由两部分功能组成。一是向C&amp;C发送扫描结果；二是对端口扫描和爆破进行相应的配置工作。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">ServerAgent模块在scanner模块扫描过程中连接C&amp;C。当scanner模块扫描到开放的端口之后，ServerAgent模块将把对应的ip地址和端口号发送至C&amp;C。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01cecfe72ddecdcc8e.png" title="t01f83123a9f4f9e044.png" alt="http://p0.qhimg.com/t01f83123a9f4f9e044.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-1 ServerAgent模块连接C&amp;C</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">此外，<strong>ServerAgent</strong>模块下载密码字典并为Cracker模块配置密码字典，当scanner模块扫描到某ip地址的特定端口为开放状态时，将通过该字典进行爆破。字典的下载地址<strong>http://ip:8888/wpd.dat</strong>，当下载完成之后，<strong>ServerAgent</strong>模块将从<strong>http://ip:8888/wpdmd5.txt</strong>获取正确的密码字典的MD5值并与下载的字典wpd.dat的MD5值进行对比以确定下载文件的正确性。下载的密码字典wpd.dat是经过加密的，<strong>ServerAgent</strong>模块读取密钥“<strong>cm9vdCpwd2Q=</strong>”，对密钥进行base64解密后，使用其解密wpt.dat。解密后的wpd.dat部分内容如下图所示。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t0113d92cc2720ba2aa.png" title="t0101bc18eee87c545a.png" alt="http://p5.qhimg.com/t0101bc18eee87c545a.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-2 密码字典的部分内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">wpd.dat实际上是一个xml文件，里面包含mysql，mssql，telnet，wmi，ssh，rdp的密码字典以及不同的入侵方式执行的shell。此外，wpd.dat中存在一个名为ports的键，当该键的某个子健键值为1时，<strong>ServerAgent</strong>模块将配置<strong>scanner</strong>模块使其扫描该子键对应的端口。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t0149475c7a224366a4.png" title="t01b695a5ddac314f04.png" alt="http://p7.qhimg.com/t01b695a5ddac314f04.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-3 ports键概览</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在默认的wpd.dat中，只有mssql子键的值设为1，因此<strong>scanner</strong>模块只扫描mssql服务对应的端口（端口号1433）。黑客可以通过配置wpd.dat文件增加、减少、修改扫描端口的数目和类别。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t019d809e6a8bc9ca5b.png" title="t0118b7b42fc88fe8f9.png" alt="http://p9.qhimg.com/t0118b7b42fc88fe8f9.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-4 从抓包数据发现Bot程序只扫描1433端口</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">有趣的是，<strong>ServerAgent</strong>模块选择随机的ip段作为每一轮扫描的ip范围，这和<strong>mirai</strong>僵尸网络的做法十分相似。如下所示，<strong>get_random_ip</strong>函数生成的随机ip段为220.176.171.93~220.182.171.87，因此本轮扫描中<strong>scanner</strong>模块对该ip段进行扫描。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t01535ad562bd7cbede.png" title="t01da230748519c4888.png" alt="http://p3.qhimg.com/t01da230748519c4888.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-5 ServerAgent模块计算并选取随机ip段</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p8.qhimg.com/t018efaac3085818b1e.png" title="t013f5ef6fc7e70bd32.png" alt="http://p1.qhimg.com/t013f5ef6fc7e70bd32.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-6 测试中生成的随机ip段</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t0126406b6d0037e07b.png" title="t01473c0f208f549c8e.png" alt="http://p4.qhimg.com/t01473c0f208f549c8e.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-4-7 从抓包数据中发现此轮扫描中Bot程序扫描其随机生成的ip段</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5. Cracker模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker模块是Bot程序中最重要的模块。该模块用于入侵目标计算机并在目标计算机上执行恶意代码。Cracker模块分为多个小模块，在分析的样本中包括<strong>Cracker:CCTV</strong>，<strong>Cracker:mssql</strong>， <strong>Cracker:RDP</strong>，<strong>Cracker:Telnet</strong>四个小模块。按照入侵的端口的不同，Cracker模块提供不同的攻击方式。下面将介绍每一种攻击的实现。</span></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.1 &nbsp;Cracker:mssql</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于Bot程序默认的密码字典wpd.dat中指定扫描的服务为msSQL，因此<strong>Cracker:mssql</strong>模块是所有Cracker模块中功能最为完善的。在大部分被感染的服务器的msSQL服务中都可以发现该模块所执行的恶意动作。</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:mssql</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">模块首先使用爆破字典爆破目标的msSQL服务。如果成功爆破目标，则登陆SQL Server执行下一步操作。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">登陆SQL Server之后，需要在SQL Server中获得执行shell的权限，因此<strong>Cracker:mssql</strong>模块使用多种方式尝试获得执行shell的权限，包括：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1. 恢复xp_cmdshell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p8.qhimg.com/t01a2fa9b5dae56b2a9.png" title="t010c943a94e89c575d.png" alt="http://p0.qhimg.com/t010c943a94e89c575d.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-1 恢复xp_cmdshell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. 开启被禁止的xp_cmdshell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t014687587ea3439548.png" title="t01f53e4ddc40d6e639.png" alt="http://p0.qhimg.com/t01f53e4ddc40d6e639.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-2 开启xp_cmdshell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. xp_cmdshell被删除后，使用SP_OACreate执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t0195faf3f351a4364e.png" title="t01b67fcfa661c17c00.png" alt="http://p1.qhimg.com/t01b67fcfa661c17c00.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-3 使用SP_OACreate执行shell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4. 开启CLR enabled选项，使用SQL Server CLR执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t01a6aa1cc5c0b9f411.png" title="t01a58e65ce4db6316f.png" alt="http://p4.qhimg.com/t01a58e65ce4db6316f.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-4 开启CLR enabled选项</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5. 注册<strong>regsvr32.dll</strong>执行远端代码所需的组件，使用<strong>regsvr32.dll</strong>执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t0132ddf328edf977f8.png" title="t0193749b1948b73441.png" alt="http://p8.qhimg.com/t0193749b1948b73441.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-5 注册相关组件</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6. 通过沙盒执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t0109fb3c94762c3f58.png" title="t01e364a301b86bff6f.png" alt="http://p9.qhimg.com/t01e364a301b86bff6f.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-6 通过沙盒执行shell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">7. 开启SQL Agent服务，使用SQL Agent服务执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t01fb62927d1f4090bc.png" title="t01be0da6e6f83feb91.png" alt="http://p6.qhimg.com/t01be0da6e6f83feb91.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-7 开启SQL Agent服务</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:mssql</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">模块所执行的主要功能主要包括以下几方面：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1. 在<strong>c:\\windows\system32\wbem</strong>下创建批处理文件123.dat，并在该文件中写入内容。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t015705778a3005e78a.png" title="t012f22df6c0fa3ef29.png" alt="http://p3.qhimg.com/t012f22df6c0fa3ef29.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-8 创建123.bat</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; white-space: pre;"></span>该批处理文件执行的功能包括对一些程序运行所涉及到的文件和文件夹进行权限设置；使用regsvr32.dll执行远端代码；判断是否存在item.dat，若存在则调用rundll32执行该程序。item.dat是修改自PCShare（github：<a href="https://github.com/isuhao/pcshare" target="_self"><strong>https://github.com/isuhao/pcshare</strong></a>）的远程控制程序，C&amp;C通过item.dat控制Bot。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. 创建文件PerfStringse.ini，并在该文件中写入内容。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t01b30ec6bd6bd2dd74.png" title="t0158ee429b8cd0fbc6.png" alt="http://p0.qhimg.com/t0158ee429b8cd0fbc6.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-9 创建PerfStringse.ini</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">该文件是个组策略模板文件，主要是禁止一些涉及到的文件的访问权限。在创建该模板文件之后调用secedit.exe配置组策略。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t011addfa0a0acbfd91.png" title="t01d8a3abfc1bbbf33e.png" alt="http://p3.qhimg.com/t01d8a3abfc1bbbf33e.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-10 调用secedit.exe配置组策略</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. 在<strong>c:\\windows\system</strong>下创建文件myusa.dvr，并在文件中写入内容。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t019aaedf4fd0d4950c.png" title="t01e06015e08873bb46.png" alt="http://p7.qhimg.com/t01e06015e08873bb46.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-11 创建myusa.dvr</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">myusa.dvr是个ftp下载脚本，主要功能是从<strong>down.mys2016.info</strong>下载文件1.dat到本地<strong>c:\\windows\system</strong>路径下，命名为<strong>myusago.dvr</strong>；下载1.bat到本地<strong>c:\\windows\system</strong>路径下，命名为backs.bat。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">myusago.dvr也是个ftp下载脚本，从down.mys2016.info下载多个文件到本地；backs.bat用于记录系统时间并写入1.txt中。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t015580251389e3b395.png" title="t0166976a7a7a7a8bfa.png" alt="http://p2.qhimg.com/t0166976a7a7a7a8bfa.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-12 myusago.dvr内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">下载的文件中，item.dat是C&amp;C用于控制Bot的远程控制软件；ms.rar实际上就是Bot程序的更新程序cab.exe；ss.bat和Cracker:mssql模块释放的123.bat是同一个文件；未找到op7key.rar文件，猜测与爆破字典类似。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">从myusago.dvr下载的文件不难看出，Bot程序除了执行Cracker:mssql模块中硬编码的恶意代码之外，还通过云端下载相应的恶意程序，这保障与Bot程序相关联的恶意代码能够持续驻留。在分析的过程中我们发现，用于进行环境配置和程序运行控制的123.bat批处理脚本是更新最为频繁的，从2017年4月份起更新次数超过了10次。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">myusago.dvr和myusa.dvr将作为ftp的参数写入命令行中并加入SQL Agent的Job中，每天执行一次。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4. 将Bot程序加入SQL Agent的job中，并附带参数“-syn 1000”。每次SQL Agent启动时Bot程序也将启动。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t01477fa38ea1bf51ae.png" title="t01c377a6d12d4f78ae.png" alt="http://p3.qhimg.com/t01c377a6d12d4f78ae.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-13 将Bot程序加入SQL Agent的Job中</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5. 以Job的形式每20分钟运行一次<strong>C：\\Progra~1\mainsoft\install.exe</strong>。该程序是一个挂机赚分软件。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t011e65dcf8cab43b44.png" title="t01598db416b878af02.png" alt="http://p8.qhimg.com/t01598db416b878af02.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-14 以Job形式执行install.exe</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6. 以Job的形式每20分钟执行<strong>C:\\windows\debug</strong>，<strong>C:\\Progra~1\\shengda</strong>和<strong>C:\\Progra~1\\kugou2010</strong>路径下的所有exe。从我们的监控中发现，Bot程序所释放的挖矿机以及能给黑客带来直接收益的程序都存在于这几个路径中，黑客通过定时启动这些程序保证收益的源源不断。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t0102f021635baac934.png" title="t011da7dfa91f8946fb.png" alt="http://p2.qhimg.com/t011da7dfa91f8946fb.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-15 定时执行C:\\windows\debug下的exe</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t01e9666a1215ec7137.png" title="t016918bc57a43ba6d7.png" alt="http://p3.qhimg.com/t016918bc57a43ba6d7.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-16 定时执行C:\\Progra~1\\shengda下的exe</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t01d99378f38f67f102.png" title="t011138a6fbf3e6ac29.png" alt="http://p2.qhimg.com/t011138a6fbf3e6ac29.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-17 定时执行C:\\Progra~1\\kugou2010下的exe</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">7. 创建ftp下载脚本msinfo.dat，该脚本从down.mys2016.info下载文件到<strong>C:\\windows\debug</strong>路径下，并命名为bss.exe。之后通过批处理脚本msinfo.bat调用ftp执行下载脚本，下载完成后启动bss.exe，并删除这两个脚本。bss.exe疑似是个远控木马。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t01cb81c0c3875c5a7f.png" title="t010030e40f50255f98.png" alt="http://p7.qhimg.com/t010030e40f50255f98.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-18 msinfo.dat内容</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t01b4c2cc609030f6c0.png" title="t0165cb4f5fe7f7f86a.png" alt="http://p8.qhimg.com/t0165cb4f5fe7f7f86a.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-19 msinfo.bat内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">8. 将item.dat和123.bat加入启动项中。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t01d4b77f5ed2d4fea2.png" title="t014a55ef65648df70f.png" alt="http://p5.qhimg.com/t014a55ef65648df70f.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-20 将item.dat加入启动项中</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t014acd506a7b6558ae.png" title="t0152e6547a303b4df6.png" alt="http://p7.qhimg.com/t0152e6547a303b4df6.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-21 将123.bat加入启动项中</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">9. 确定权限允许之后，删除SQL用户，并设置SQL SA（超级管理员）帐户及密码，同时添加多个SQL帐户。完成这步操作之后，黑客正式接管该计算机的SQL Server，管理员无法再通过之前的帐户登录SQL Server。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t01c081394c9abe21e5.png" title="t01f431a3c7983aaac5.png" alt="http://p1.qhimg.com/t01f431a3c7983aaac5.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-22 添加SQL SA</span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:mssql</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">模块还通过SQL Server执行多段shellcode，大部分的shellcode都以SQL Agent的Job形式存在并定期执行。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第一段shellcode使用wmi中的<strong>ActiveScriptEventConsumer</strong>类执行脚本代码。该脚本读取<strong>http://www.cyg2016.xyz:8888/test.html</strong>网页内容，并根据网页内容获取第二组网址，下载文件并执行。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t012cbcf9567f973349.png" title="t01cc51bf0f523db29c.png" alt="http://p2.qhimg.com/t01cc51bf0f523db29c.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-23 第一段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">下载的文件包括更新程序cabs.exe和挖矿机lsmosee.exe。挖矿机修改自xmr-stak（github：<a href="https://github.com/fireice-uk/xmr-stak-cpu">https://github.com/fireice-uk/xmr-stak-cpu</a>&nbsp; ），以32位形式编译，作者在此挖矿机中添加了一个模块，当需要64位挖矿机时，该模块将从C&amp;C下载64位的挖矿机lsmose.exe到本地执行。本样本中，32位挖矿机的路径为“C:\\windows\help”，而64位挖矿机的路径修改为“C:\\windows\debug”。由于作者添加了SQL Agent的Job，使“C:\\windows\debug”路径下的exe文件每20分钟执行一次，猜测作者将挖矿机保存到此目录下是为了保证挖矿机能够稳定运行。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t019a7e039eb11a4953.png" title="t0118c55b6f56998881.png" alt="http://p5.qhimg.com/t0118c55b6f56998881.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-24 下载挖矿机和更新程序</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第二段shellcode使用js脚本执行恶意代码，脚本功能与第一段shellcode中的jscript代码相同。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t01e87b6929c06b2cc2.png" title="t019d7c7021a093664f.png" alt="http://p7.qhimg.com/t019d7c7021a093664f.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-25 第二段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第三段shellcode同样使用wmi脚本执行jscript代码，所执行的功能与创建的批处理文件123.bat的功能相同，猜测作者此举为了防止文件123.bat被杀毒软件清除而执行的备用方案。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t011949473812b2b9c2.png" title="t01714f4630a895a9d7.png" alt="http://p8.qhimg.com/t01714f4630a895a9d7.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-26 第三段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第四段shellcode是第三段shellcode的js版本。不难发现，作者对于每段shellcode都准备了wmi和js两种版本，以确保脚本执行的稳定性。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t0189f4bbf5db935e98.png" title="t01a5b41130d0de83d3.png" alt="http://p8.qhimg.com/t01a5b41130d0de83d3.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-27 第四段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第五段shellcode通过恢复cmdshell，恢复SP_OACreate等方式保证能通过SQL Server执行shell，猜测作者通过Job定期执行这段shellcode以保证shell能长期存活。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t010258b322c6aa73c9.png" title="t01ee2d5c6bbd53c862.png" alt="http://p5.qhimg.com/t01ee2d5c6bbd53c862.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-28 第五段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第六段shellcode删除<strong>C:\\Documents and Settings\Default User\Local Settings\Temporary Internet Files\Content.IE5</strong>路径下的文件。由于下载文件时都会在该目录下留下对应的tmp文件，作者此举是为了防止用户通过该目录发现可疑文件，可见作者对痕迹的清理十分细心。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t01ee2d6e6b33393075.png" title="t01b28a3938cbf03605.png" alt="http://p9.qhimg.com/t01b28a3938cbf03605.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-29 第六段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第七段shellcode使用js脚本访问http://www.cyg2016.xyz:8888/kill.html，该页面是个文件名列表。脚本搜寻系统中是否存在与该页面返回的文件名相同的文件，若存在则结束对应进程并将文件删除。这些文件大多数是一些其他入侵者释放的挖矿机。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01f9c20d50dea186b3.png" title="t01146bc1a726a1654d.png" alt="http://p2.qhimg.com/t01146bc1a726a1654d.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-30 第七段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">透过这些文件名我们发现了一个有趣的现象，在被删除的文件中包含了一些和Bot程序释放的挖矿机文件名十分相似的文件，例如C:\\windows\debug\lsmosee.exe（Bot程序释放的挖矿机是c:\\windows\help\lsmosee.exe和C:\\windows\debug\lsmose.exe）。是作者通过这样的方式进行更新，淘汰旧的挖矿机，还是其他入侵者利用Bot程序定时执行C:\\windows\debug路径下程序的特性坐收渔翁之利就不得而知了。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t01c1ee6786642bcc7c.png" title="t01f4594734e36e87ce.png" alt="http://p4.qhimg.com/t01f4594734e36e87ce.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-31 待删除文件列表</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第八段shellcode将123.bat加入启动项中，此处不再赘述。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第九段shellcode从http://down.mys2016.info:280下载文件到C:\\WINDOWS路径下，并命名为ps.exe。ps.exe实际上是PsExec，一款强大的远程执行工具，黑客在每台入侵的计算中部署该工具，使每台计算机成为一个控制端，方便构建一个庞大的僵尸网络。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p8.qhimg.com/t012ceb3213b86efe1d.png" title="t01a4700a5ee34b69c4.png" alt="http://p1.qhimg.com/t01a4700a5ee34b69c4.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-32 第九段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第十段shellcode主要是完成SQL提权的一系列操作。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t0196448a41f4fca3c9.png" title="t0155280bae2732f982.png" alt="http://p3.qhimg.com/t0155280bae2732f982.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-33 第十段shellcode内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第十一段shellcode是利用SQL Server CLR执行shell的payload，从payload中可以发现其访问http://www.cyg2016.xyz:8888/clr.txt并执行该页面中返回的内容。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t013c44b9c906614209.png" title="t01a616b188e078bb3e.png" alt="http://p4.qhimg.com/t01a616b188e078bb3e.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-34 payload的部分内容</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">该页面和http://www.cyg2016.xyz:8888/test.html一致，即下载更新程序和挖矿机到计算机中并运行。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:mssql模块完成了Bot程序几乎所有要完成的功能，包括更新、挖矿、清除同类程序、定时任务以及SQL Server管理员账户的设置。由于作者目前的密码字典中将mssql作为唯一攻击目标，因此Cracker:mssql模块如此完善也是可以理解的。若之后作者开启了其他攻击方式，其他的Cracker模块也将变得更加完善。</span></p><p style="text-indent: 2em;"><span style="color: rgb(227, 108, 9);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.2 &nbsp;Cracker:Telnet</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:Telnet模块是除了Cracker:mssql模块之外较为完善的一个模块。作者充分利用mirai僵尸网络的优点构建了一套类似于mirai的Telnet入侵模块。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在执行Cracker:Telnet模块之前，Bot程序在ServerAgent模块中配置Telnet入侵攻击的payload。ServerAgent模块会根据不同的平台架构从资源段中读取payload并将其转化为十六进制字节码的形式。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t01a84b7f152753b968.png" title="t01d4c6683301008f77.png" alt="http://p7.qhimg.com/t01d4c6683301008f77.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-35 从资源段读取payload</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在payload中我们发现一些mirai相关的标识，通过对比发现Bot程序所使用的payload就是mirai僵尸网络的payload（github：<a href="https://github.com/jgamblin/Mirai-Source-Code/tree/master/loader/bins">https://github.com/jgamblin/Mirai-Source-Code/tree/master/loader/bins</a>&nbsp; ），这些payload适用于不同的平台架构（arm，arm7，m68k，mips，mpsl，ppc，sh4，spc，x86）。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t01aa39358dc7761b6e.png" title="t0163e7a087957763db.png" alt="http://p6.qhimg.com/t0163e7a087957763db.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-36 payload中mirai的相关标识</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">除了payload与mirai相同之外，<strong>Cracker:Telnet</strong>模块也基本修改自mirai源码，包含密码爆破功能和入侵功能。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t01717d57e4354655ce.png" title="t01311a20a1e244fdda.png" alt="http://p6.qhimg.com/t01311a20a1e244fdda.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-37 Cracker:Telnet模块中的mirai特征</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">mirai在通过Telnet入侵之前会配置一个ip地址用于作为report服务器地址，用于返回扫描结果，在分析中我们也发现了一个疑似report服务器ip地址。如果Bot程序的启动参数中包含“-srv”，则ServerAgent模块会从密码字典中读取名为telnetip的子键的键值，该键值是个ip地址，之后被传入Cracker:Telnet模块中。如果启动参数中包含“-cli”，Bot程序会从当前目录下的wpdconfig.ini文件中读取ip地址。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t010596ac32b69d6072.png" title="t01b5a531a72fa3f52c.png" alt="http://p6.qhimg.com/t01b5a531a72fa3f52c.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-38 密码字典中的report服务器地址</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于Cracker:Telnet模块与mirai相差无几，在此不再赘述，感兴趣的读者可以查看mirai源码（github：<a href="https://github.com/jgamblin/Mirai-Source-Code">https://github.com/jgamblin/Mirai-Source-Code</a>&nbsp; ）。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.3 &nbsp;Cracker:RDP</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:RDP模块修改自hydra（github：<a href="https://github.com/vanhauser-thc/thc-hydra">https://github.com/vanhauser-thc/thc-hydra</a>&nbsp; ）的RDP部分。hydra是一款支持多种网络服务的强大的暴力破解工具，<strong>Cracker:RDP</strong>模块使用了其源码中的rdp.c文件，用于对开放了RDP服务端口的计算机进行爆破。不同于Cracker:mssql模块和Cracker:Telnet模块，Cracker:RDP模块只是进行爆破而未加入任何入侵以及代码执行的功能。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t0120cf9fc82653a3c3.png" title="t01a62ed5b6c3a7e643.png" alt="http://p6.qhimg.com/t01a62ed5b6c3a7e643.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-39 Cracker:RDP模块扫描端口</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.4 &nbsp;Cracker:CCTV</span></strong></span></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cracker:CCTV</span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">模块是一个CCTV摄像头入侵模块。该模块会向</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">http://Targetip:port/shell?...</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"> （…的内容猜测是用户名&amp;密码）发送GET请求，一旦请求返回的状态值不为400，401，403，404或500，则认为该ip地址和端口号对应的CCTV摄像头可以被入侵。</span><br/></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t016702757d9967bd6d.png" title="t01dce0eca478a4ec25.png" alt="http://p6.qhimg.com/t01dce0eca478a4ec25.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-40 Cracker:CCTV模块扫描CCTV摄像头</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于在密码字典wpd.dat中并没有配置CCTV相关的键值,猜测该模块是和<strong>Cracker:Telnet</strong>模块结合使用的。由于mirai中含有识别特定IOT设备的代码，而<strong>Cracker:Telnet</strong>模块又是修改自mirai，猜测当<strong>Cracker:Telnet</strong>模块发现某台设备为CCTV摄像机时则通过<strong>Cracker:CCTV</strong>模块进行入侵。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.5 其他模块</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在Bot程序早期的版本中（2016年10月编译的版本）还发现了Cracker:MySQL模块，Cracker:SSH模块和Cracker:WMI模块，这些模块的功能都是在被入侵的计算机中执行shell。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t016d82f4857e256523.png" title="t01d3b9d6a6d33cb895.png" alt="http://p6.qhimg.com/t01d3b9d6a6d33cb895.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-41 Cracker:MySQL模块</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t01142bc4698834b793.png" title="t0174e12d86aba814cd.png" alt="http://p5.qhimg.com/t0174e12d86aba814cd.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-42 Cracker:SSH模块</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t0194da55fb5b9da36f.png" title="t0156418ecee17a7634.png" alt="http://p1.qhimg.com/t0156418ecee17a7634.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-5-43 Cracker:WMI模块</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">不过这几个模块在之后的版本中都被移除了，而原本功能简单的<strong>Cracker:mssql</strong>模块在之后的版本中得到了完善。</span></p><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6. cService模块分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">cService模块用于管理Bot服务，Bot服务是Service形式的Bot程序。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当Bot程序的启动参数中包含“-create”时，cService模块创建名为“xWinWpdSrv”的服务，该服务以“-s –syn 1500”作为启动参数启动Bot程序。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t0104ca1dc5d81c9fd3.png" title="t01d0c0d38d17503d4e.png" alt="http://p9.qhimg.com/t01d0c0d38d17503d4e.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-6-1 创建Bot服务</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当Bot程序的启动参数包含“-delete”时，cService模块删除“xWinWpdSrv”服务。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t01d1c1194ebdd03d5e.png" title="t018cfe57c7ec17f8dc.png" alt="http://p4.qhimg.com/t018cfe57c7ec17f8dc.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-6-2 删除Bot服务</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当Bot程序的启动参数包含“-start”时，cService模块启动“xWinWpdSrv”服务。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t01f3c29678b3f07bf1.png" title="t01aaddfcfa4cde2ace.png" alt="http://p9.qhimg.com/t01aaddfcfa4cde2ace.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-6-3 启动Bot服务</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当Bot程序的启动参数包含“-stop”时，cService模块停止“xWinWpdSrv”服务。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t014840a656c6ed76c4.png" title="t015ee224fd6ff875b8.png" alt="http://p4.qhimg.com/t015ee224fd6ff875b8.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-6-4 停止Bot服务</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Bot程序模块众多，并且各模块之间关系紧密，相互配合。此外，Bot程序与其他组件相辅相成，以保证攻击者对计算机的持久控制以及僵尸网络的不断壮大。以下将用一个关系图描述Bot程序与其他组件之间的关联。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t01146e91a4868a8df0.png" title="t011c0915cb8e86b948.png" alt="http://p2.qhimg.com/t011c0915cb8e86b948.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图2-6-5 Bot程序与其他组件关系图</span></p><p style="text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">第三部分 防御总结</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">从僵尸网络当前的攻击重点来看，防范其通过1433端口入侵计算机是非常有必要的。此外，Bot程序还有多种攻击方式尚未使用，这些攻击方式可能在未来的某一天被开启，因此也需要防范可能发生的攻击。对此，我们总结以下几个防御策略：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1.对于未遭到入侵的服务器，注意msSQL，RDP，Telnet等服务的弱口令问题。如果这些服务设置了弱口令，需要尽快修改；</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.对于无需使用的服务不要随意开放，开放的服务是黑客入侵的前提。对于必须使用的服务，注意相关服务的弱口令问题；</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.特别注意445端口的开放情况。由于黑客曾经使用永恒之蓝漏洞入侵计算机，不排除黑客故技重施。及时打上补丁更新操作系统是非常有必要的。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4.关注服务器运行状况，注意CPU占用率和进程列表和网络流量情况可以及时发现系统存在的异常。此外，注意系统账户情况，禁用不必要的账户。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.对于网络摄像头持有者，建议修改默认密码以防止黑客直接使用默认密码爆破。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">该僵尸网络现今主要依靠端口扫描和弱口令爆破进行传播，但其在“永恒之蓝”漏洞攻击武器出现之初就利用该武器入侵了一定数量的计算机，可见其对于最新曝光的漏洞利用以及攻击方法的掌握十分迅速，因此需时刻警惕其可能发起的重大攻击。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">附录</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">1. 相关文件MD5</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 0, 0);">MD5</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">042ac6f93597e80112a1c42fdb79e3df
42c0b80fe0a28401f2b64a522f1dea84
d7378a709dc4deb1a034676c43de503a
ad0496f544762a95af11f9314e434e94
5707f1e71da33a1ab9fe2796dbe3fc74
5af3bab901735575d5d0958921174b17
6a936ad69c708f3ac70da2f76b8b619e
fe04395c95cdd102aeabbf6b915c1a5e
f068b7be8685c91bddbb186f6fad7962
10ace2e06cc8b5656d38eb2e6ed4f079
a38a1e11f7222f7c48aaf33e20c78f48
6b13994f83dad0d45764911a88564a7b
f249446c28ab983c395ca4e198db3528
7b7b1c2a2201aebf22aaf8fe7901c0e9
ca748d5eac754e0b0026474ae7a51f3f
e81e96be9d90a1a1a0871196d0374c26
75f6543447b4726c56d183951526b379
98d615c222293ca937ab4b1b4a7c8118
c3a5859a5d438ff3f62d81ec3894d9ca</pre><p style="text-indent: 2em;"><strong style="color: rgb(0, 112, 192); text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. 相关ip地址和域名</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">ip地址、域名</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">67.229.144.218
13.59.110.123
209.58.186.145
www.cyg2016.xyz
js.mys2016.info
down.mys2016.info
ftp.oo000oo.me
wmi.oo000oo.club
down.oo000oo.club
js.f4321y.com
up.f4321y.com
wmi.mykings.top
js.mykings.pw
xmr.5b6b7b.ru
js.5b6b7b.ru
64.myxmr.pw</pre><p style="text-indent: 2em;"><strong style="color: rgb(0, 112, 192); text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. 密码字典</span></strong></p><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(247, 150, 70);">MySQL</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">root
root&nbsp;root
root&nbsp;123
root&nbsp;123456
phpmind&nbsp;phpmind
root&nbsp;admin123
root&nbsp;password
root&nbsp;root123
root&nbsp;123456*a
mysqld&nbsp;654321*a</pre><p style="text-indent: 2em;"><strong style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(247, 150, 70);">msSQL</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">sa
sa&nbsp;sa
sa&nbsp;123
sa&nbsp;123456
sa&nbsp;password
sa&nbsp;525464
sa&nbsp;shabixuege!@#
vice&nbsp;vice
sa&nbsp;3xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;
sa&nbsp;4xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;3xqan7,mm`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;3xqan7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;3xqan7,n`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4xqan7,mm`~!@&nbsp;~#$%^&amp;*(),.;
sa&nbsp;4xqbn7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4xqbn7,mm`~!@&nbsp;~#$%^&amp;*(),.;
sa&nbsp;4yqbn7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4yqbn7,mm`~!@&nbsp;~#$%^&amp;*(),.;
sa&nbsp;4yqbm7,m`~!@&nbsp;~#$%^&amp;*(),.;
mssqla&nbsp;4yqbm7,mm`~!@&nbsp;~#$%^&amp;*(),.;
kisadmin&nbsp;ypbwkfyjhyhgzj
hbv7&nbsp;zXJl@mwZ
bwsa&nbsp;bw99588399
ps&nbsp;740316
uep&nbsp;U_tywg_2008
sa&nbsp;sa123
sa&nbsp;sasa
sa&nbsp;12345
sa&nbsp;sunshine
sa&nbsp;trustno1
sa&nbsp;111111
sa&nbsp;iloveyou
sa&nbsp;sql2005
sa&nbsp;DiscoJack
sa&nbsp;1
401hk&nbsp;401hk!@#
sa&nbsp;admin@123
sa&nbsp;sa2008
sa&nbsp;123123
sa&nbsp;1111
sa&nbsp;1234
sa&nbsp;12345678
sa&nbsp;1234567890
sa&nbsp;passw0wd
sa&nbsp;abc
sa&nbsp;abc123
sa&nbsp;abcdefg
sysdba&nbsp;masterkey
sa&nbsp;bing_1433&nbsp;xing
sa&nbsp;^_^$$wanniMaBI::&nbsp;1433&nbsp;vl
sa&nbsp;sapassword
sa&nbsp;linwen5555
su&nbsp;vice_1433&nbsp;vice
sa&nbsp;Aa123456
sa&nbsp;ABCabc123
sa&nbsp;sqlpassword
sa&nbsp;1qaz2wsx
sa&nbsp;1qaz!QAZ
sa&nbsp;sql2008</pre><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(247, 150, 70);">Telnet</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">!!Huawei&nbsp;@HuaweiHgw
system&nbsp;ping&nbsp;;sh
root&nbsp;1001chin
root&nbsp;xc3511
root&nbsp;vizxv
admin&nbsp;admin
5up&nbsp;5up
root
root&nbsp;jvbzd
root&nbsp;root
root&nbsp;123
root&nbsp;hg2x0
root&nbsp;123456
admin&nbsp;admin1234
root&nbsp;admin
superadmin&nbsp;Is$uper@dmin
admin
support&nbsp;support
admin&nbsp;123456
1234&nbsp;1234
Admin&nbsp;Admin
admin&nbsp;ho4uku6at
admin&nbsp;123
admin&nbsp;1234567
admin&nbsp;12345
root&nbsp;12345
admin&nbsp;root
e8telnet&nbsp;e8telnet
telecomadmin&nbsp;nE7jA%5m
e8ehomeasb&nbsp;e8ehomeasb
telnetadmin&nbsp;telnetadmin
e8ehome&nbsp;e8ehome
Zte521&nbsp;Zte521
root&nbsp;Zte521
user&nbsp;password
admin&nbsp;password
root&nbsp;password
user&nbsp;user
root&nbsp;888888
root&nbsp;grouter
root&nbsp;666666
guest&nbsp;12345
admin&nbsp;ZmqVfoSIP
admin&nbsp;888888
admin&nbsp;guest
admin&nbsp;666666
Admin&nbsp;111111
admin&nbsp;oelinux123
Administrator&nbsp;meinsm
adminlvjh&nbsp;adminlvjh123
default&nbsp;antslq
root&nbsp;telnet
guest&nbsp;admin
netgear&nbsp;netgear
realtek&nbsp;realtek
root&nbsp;88888888
service&nbsp;service
root&nbsp;cat1029
system&nbsp;system
root&nbsp;oelinux123
root&nbsp;tl789
telnet&nbsp;telnet
root&nbsp;GM8182
user&nbsp;qweasdzx
root&nbsp;hunt5759
root&nbsp;rootpassword
zte&nbsp;zte
root&nbsp;cisco
root&nbsp;telecomadmin
root&nbsp;12345678
root&nbsp;default
huawei&nbsp;admin@huawei.com
root&nbsp;solokey
root&nbsp;twe8ehome
dvr&nbsp;dvr
supervisor&nbsp;supervisor
root&nbsp;1234567890
root&nbsp;0123456789
root&nbsp;rootroot
Manager&nbsp;manager
admin&nbsp;admin888
useradmin&nbsp;useradmin
ubnt&nbsp;ubnt
root&nbsp;dvr
cusadmin&nbsp;highspeed
cisco&nbsp;cisco
admin&nbsp;smcadmin
h3c&nbsp;h3c
admin&nbsp;benq1234
admin&nbsp;12345678
root&nbsp;PASSWD
root&nbsp;passwd
ROOT&nbsp;PASSWD
huawei&nbsp;huawei
root&nbsp;h3c
root&nbsp;nmgx_wapia
toor&nbsp;toor
Huawei&nbsp;Huawei
admin&nbsp;private
root&nbsp;private</pre><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(247, 150, 70);">ssh</span></strong></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">root
root&nbsp;root
root&nbsp;123
root&nbsp;123456
root&nbsp;i826y3tz
root&nbsp;password
ubnt&nbsp;ubnt
ubnt&nbsp;admin
root&nbsp;gwevrk7f@qwSX$fd</pre><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(247, 150, 70);">wmi</span></strong></p><pre class="brush:plain;toolbar:false">administrator</pre><p style="text-indent: 2em;"><span style="color: rgb(247, 150, 70);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">RDP</span></strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">administrator&nbsp;123
administrator&nbsp;123456
administrator
administrator&nbsp;1234
administrator&nbsp;12345
administrator&nbsp;5201314
administrator&nbsp;1qaz2wsx
administrator&nbsp;Aa123456
administrator&nbsp;qwe123!@#
administrator&nbsp;qwe!@#
administrator&nbsp;123qweqwe
administrator&nbsp;654321
administrator&nbsp;admin
administrator&nbsp;0
administrator&nbsp;password
administrator&nbsp;123123
piress&nbsp;adminlv123
administrator&nbsp;p@ssw0rd
administrator&nbsp;112233
administrator&nbsp;!@#123
administrator&nbsp;1qaz2wsx3edc
administrator&nbsp;!@#qwe
administrator&nbsp;zxcvbnm
administrator&nbsp;login
administrator&nbsp;admin123
administrator&nbsp;3389
administrator&nbsp;pass</pre><p style="text-indent: 2em;"><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/4351.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【木马分析】悄然崛起的挖矿机僵尸网络：打服务器挖价值百万门罗币 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="4351" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/5x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="16448" user-name="Helen" href="javascript:;">
                Helen            </a>
                        <span class="comment-time">2017-09-02 13:16:52</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="16448">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_16448" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">图1-1的下载传播那些是怎么统计出来的？</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="4351" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
