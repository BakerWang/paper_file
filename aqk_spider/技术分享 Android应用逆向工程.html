<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】Android应用逆向工程 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="Android,逆向"/>
    
        <meta name="description" content="本文介绍了通过逆向工程对目标APP进行动态与静态分析的方法，内容涉及到hooking，inspeckage，字节码修改等。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】Android应用逆向工程</h2>
                <div class="article-msg">
                    <span class="time">2017-09-20 10:26:46</span>
                    
                                        <span class="read">阅读：231次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_4428"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="4428" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://offensivepentest.com/2017/08/26/android-application-reverse-engineering/"
                             target="_blank">来源： offensivepentest.com</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2722694252" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2722694252" style="color:#848e99;">L0phTg</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center;"><img src="http://p8.qhimg.com/t01ee71e888c7d378da.jpg" title="t01bcef4dc10e8be25b.jpg" alt="http://p8.qhimg.com/t01bcef4dc10e8be25b.jpg"/></p><p><br/></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; background: white; text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-weight: 900; font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">译者：</span><a href="http://bobao.360.cn/member/contribute?uid=2722694252" target="_blank" style="color: rgb(0, 112, 192); font-weight: 900; font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-decoration: underline;"><span style="color: rgb(0, 112, 192); font-weight: 900; font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">L0phTg</span></a></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; background: white; text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-weight: 900; font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">预估稿费：260RMB</span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; background: white; text-indent: 2em;"><span style="color: rgb(0, 112, 192); font-weight: 900; font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p><p style="text-indent: 2em;"><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>序</strong></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">阅读本文最好花费</span><strong style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">45Min</strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">~</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">你经常在用 Burp 拦截信息的时候很迷茫么？你经常在分析用加密的数据进行通信的App，对于需要理解它的数据而疑惑么？在本文，我将会分享很多方法来用于逆向分析APK。我们将会对目标APP采用动态和静态的分析方法。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我创建了一个简单的APP作为分析目标，它的功能只是单纯地对我们输入的数据进行验证，如果用户输入正确的话，将会在屏幕上显示“Congratulations“。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们先看一下这个应用的源代码以便于我们一会儿能够将它与反编译后的APK代码进行比较。</span></p><pre class="brush:java;toolbar:false">package&nbsp;com.punsec.demo;

import&nbsp;android.os.Bundle;
import&nbsp;android.support.v7.app.AppCompatActivity;
import&nbsp;android.util.Base64;
import&nbsp;android.view.View;
import&nbsp;android.widget.Button;
import&nbsp;android.widget.EditText;
import&nbsp;android.widget.TextView;

import&nbsp;javax.crypto.SecretKey;

public&nbsp;class&nbsp;MainActivity&nbsp;extends&nbsp;AppCompatActivity&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;TextView&nbsp;result;
&nbsp;&nbsp;&nbsp;&nbsp;EditText&nbsp;input;
&nbsp;&nbsp;&nbsp;&nbsp;Button&nbsp;button;

&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;onCreate(Bundle&nbsp;savedInstanceState)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.onCreate(savedInstanceState);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setContentView(R.layout.activity_main);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;=&nbsp;(EditText)&nbsp;findViewById(R.id.input);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;(TextView)&nbsp;findViewById(R.id.result);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button&nbsp;=&nbsp;(Button)&nbsp;findViewById(R.id.ok);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button.setOnClickListener(new&nbsp;View.OnClickListener()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onClick(View&nbsp;v)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;a&nbsp;=&nbsp;input.getText().toString();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;b&nbsp;=&nbsp;getString(R.string.a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretKey&nbsp;secretKey&nbsp;=&nbsp;Util.a(new&nbsp;String(Base64.decode(getString(R.string.b),&nbsp;Base64.DEFAULT)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte&nbsp;e[]&nbsp;=&nbsp;Util.a(a,&nbsp;secretKey);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;er&nbsp;=&nbsp;Base64.encodeToString(e,&nbsp;Base64.DEFAULT).trim();

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(er.equals(b))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.setText(getString(R.string.d));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.setText(getString(R.string.e));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(&quot;EXCEPTION:&quot;,&nbsp;e.getMessage());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个应用使用下面的这个辅助类来执行一些重要的操作：</span></p><pre class="brush:java;toolbar:false">package&nbsp;com.punsec.demo;

import&nbsp;java.io.UnsupportedEncodingException;
import&nbsp;java.security.InvalidAlgorithmParameterException;
import&nbsp;java.security.InvalidKeyException;
import&nbsp;java.security.MessageDigest;
import&nbsp;java.security.NoSuchAlgorithmException;
import&nbsp;java.security.spec.InvalidKeySpecException;
import&nbsp;java.security.spec.InvalidParameterSpecException;

import&nbsp;javax.crypto.BadPaddingException;
import&nbsp;javax.crypto.Cipher;
import&nbsp;javax.crypto.IllegalBlockSizeException;
import&nbsp;javax.crypto.NoSuchPaddingException;
import&nbsp;javax.crypto.SecretKey;
import&nbsp;javax.crypto.spec.SecretKeySpec;


class&nbsp;Util&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;SecretKey&nbsp;a(String&nbsp;secret)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;NoSuchAlgorithmException,&nbsp;InvalidKeySpecException
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageDigest&nbsp;md&nbsp;=&nbsp;MessageDigest.getInstance(&quot;MD5&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;md.update(secret.getBytes());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;digest&nbsp;=&nbsp;md.digest();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuilder();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(byte&nbsp;b&nbsp;:&nbsp;digest)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(String.format(&quot;%02x&quot;,&nbsp;(0xFF&nbsp;&amp;&nbsp;b)));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;SecretKeySpec(sb.toString().substring(0,16).getBytes(),&nbsp;&quot;AES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;byte[]&nbsp;a(String&nbsp;message,&nbsp;SecretKey&nbsp;secret)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;NoSuchAlgorithmException,&nbsp;NoSuchPaddingException,&nbsp;InvalidKeyException,&nbsp;InvalidParameterSpecException,&nbsp;IllegalBlockSizeException,&nbsp;BadPaddingException,&nbsp;UnsupportedEncodingException
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cipher&nbsp;cipher&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cipher&nbsp;=&nbsp;Cipher.getInstance(&quot;AES/ECB/PKCS5Padding&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cipher.init(Cipher.ENCRYPT_MODE,&nbsp;secret);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cipher.doFinal(message.getBytes(&quot;UTF-8&quot;));
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;String&nbsp;a(byte[]&nbsp;cipherText,&nbsp;SecretKey&nbsp;secret)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;NoSuchPaddingException,&nbsp;NoSuchAlgorithmException,&nbsp;InvalidParameterSpecException,&nbsp;InvalidAlgorithmParameterException,&nbsp;InvalidKeyException,&nbsp;BadPaddingException,&nbsp;IllegalBlockSizeException,&nbsp;UnsupportedEncodingException
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cipher&nbsp;cipher&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cipher&nbsp;=&nbsp;Cipher.getInstance(&quot;AES/ECB/PKCS5Padding&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cipher.init(Cipher.DECRYPT_MODE,&nbsp;secret);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;String(cipher.doFinal(cipherText),&nbsp;&quot;UTF-8&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">你可以下载已经编译好的APK From -&gt; <a href="https://offensivepentest.com/downloads/CrackMe.apk" target="_self">CrackMe</a></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们进行下一步的操作之前，先列举分析所需的背景知识:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">一个已经root的安卓设备或者虚拟机（虽然并不是所有的分析方法都需要root权限，但是有一个root的设备是不错的）。</span></p><p style="text-indent: 2em;"><a href="https://www.frida.re/" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Frida</span></a></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Python</span></p><p style="text-indent: 2em;"><a href="https://github.com/ac-pm/Inspeckage" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Inspeckage</span></a></p><p style="text-indent: 2em;"><a href="https://github.com/rovo89/Xposed" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Xposed Framework</span></a></p><p style="text-indent: 2em;"><a href="https://ibotpeaches.github.io/Apktool/" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">APKTool</span></a></p><p style="text-indent: 2em;"><a href="https://bintray.com/vaibhavpandeyvpz/generic/apkstudio/view" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">APKStudio</span></a></p><p style="text-indent: 2em;"><a href="http://bytecodeviewer.com/" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">ByteCodeViewer</span></a></p><p style="text-indent: 2em;"><a href="https://sourceforge.net/projects/dex2jar/" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Dex2Jar</span></a></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">JarSigner(Java JDK)</span></p><p style="text-indent: 2em;"><a href="http://jd.benow.ca/" target="_self"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">JD-JUI</span></a></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="https://www.askideas.com/media/36/I-Cannot-Brain-Today-I-Has-The-Dumb-Funny-Cat-Meme-Image.jpg" target="_self">Brain</a></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们将会使用的三种分析方法：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">动态分析和Hooking.
二进制文件Patch（byte&nbsp;code修改).
静态分析和代码复制.</pre><p style="text-indent: 2em;"><br/></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">动态/运行时环境 分析和函数Hooking:</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们需要使用的分析工具: Frida, dex2jar, JD-GUI.</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">用 Frida分析:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">到底什么是Frida ?</span></p><pre class="brush:plain;toolbar:false">It&#39;s&nbsp;Greasemonkey&nbsp;for&nbsp;native&nbsp;apps,&nbsp;or,&nbsp;put&nbsp;in&nbsp;more&nbsp;technical&nbsp;terms,&nbsp;it’s&nbsp;a&nbsp;dynamic&nbsp;code&nbsp;instrumentation&nbsp;toolkit.&nbsp;It&nbsp;lets&nbsp;you&nbsp;inject&nbsp;snippets&nbsp;of&nbsp;JavaScript&nbsp;or&nbsp;your&nbsp;own&nbsp;library&nbsp;into&nbsp;native&nbsp;apps&nbsp;on&nbsp;Windows,&nbsp;macOS,&nbsp;Linux,&nbsp;iOS,&nbsp;Android,&nbsp;and&nbsp;QNX.&nbsp;Frida&nbsp;also&nbsp;provides&nbsp;you&nbsp;with&nbsp;some&nbsp;simple&nbsp;tools&nbsp;built&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;Frida&nbsp;API.&nbsp;These&nbsp;can&nbsp;be&nbsp;used&nbsp;as-is,&nbsp;tweaked&nbsp;to&nbsp;your&nbsp;needs,&nbsp;or&nbsp;serve&nbsp;as&nbsp;examples&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;the&nbsp;API.</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">用简单的术语来说，它能够被用来Hook函数调用，注入你自己的代码未来能够来修改应用本身的执行流程。我们将会使用它来通过检测和来识别不同的变量。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了能够安装Frida，我们可以将手机开启USB调试之后用数据线连接电脑，并且在电脑端运行</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">#&nbsp;check&nbsp;adb&nbsp;devices&nbsp;whether&nbsp;connected&nbsp;or&nbsp;not
adb&nbsp;devices
#&nbsp;push/copy&nbsp;the&nbsp;latest&nbsp;frida&nbsp;server&nbsp;to&nbsp;phone
adb&nbsp;push&nbsp;frida-server-10.4.0-android-arm&nbsp;/data/local/tmp/frida
#&nbsp;set&nbsp;permissions&nbsp;for&nbsp;frida,&nbsp;grant&nbsp;SU&nbsp;permissions&nbsp;if&nbsp;prompted
adb&nbsp;shell&nbsp;su&nbsp;-c&nbsp;&quot;chmod&nbsp;755&nbsp;/data/local/tmp/frida&quot;
#&nbsp;start&nbsp;frida&nbsp;server&nbsp;on&nbsp;android&nbsp;device
adb&nbsp;shell&nbsp;su&nbsp;-c&nbsp;&quot;./data/local/tmp/frida&nbsp;&amp;&quot;
#&nbsp;install&nbsp;frida-python&nbsp;on&nbsp;your&nbsp;Windows/Mac/Linux&nbsp;device
pip&nbsp;install&nbsp;--user&nbsp;frida</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">运行了上面的命令之后，我们的Frida Server就已经运行在了我们的电脑上，让我们来检验一下，打开终端，运行python:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">Python&nbsp;2.7.10&nbsp;(default,&nbsp;Feb&nbsp;&nbsp;7&nbsp;2017,&nbsp;00:08:15)
Type&nbsp;&quot;help&quot;,&nbsp;&quot;copyright&quot;,&nbsp;&quot;credits&quot;&nbsp;or&nbsp;&quot;license&quot;&nbsp;for&nbsp;more&nbsp;information.
&gt;&gt;&gt;&nbsp;import&nbsp;frida
&gt;&gt;&gt;&nbsp;frida.get_usb_device()
Device(id=&quot;802b7421&quot;,&nbsp;name=&quot;LG&nbsp;SCH-XXXX&quot;,&nbsp;type=&#39;tether&#39;)</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了方便以后的分析，现在让我们创建一个python脚本:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:python;toolbar:false">import&nbsp;frida,&nbsp;sys,&nbsp;time

encrypted&nbsp;=&nbsp;None

def&nbsp;on_message(message,&nbsp;data):
&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;encrypted
&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;encrypted:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encrypted&nbsp;=&nbsp;message[&#39;payload&#39;][&#39;encrypted&#39;]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[+]&nbsp;Received&nbsp;str&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;encrypted)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
&nbsp;&nbsp;&nbsp;&nbsp;except:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;if&nbsp;message[&#39;type&#39;]&nbsp;==&nbsp;&#39;send&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[*]&nbsp;{0}&#39;.format(message[&#39;payload&#39;]))
&nbsp;&nbsp;elif&nbsp;message[&#39;type&#39;]&nbsp;==&nbsp;&#39;error&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;&#39;encrypted&#39;&nbsp;undefined&quot;&nbsp;in&nbsp;message[&#39;description&#39;]:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[!]&nbsp;Encrypted&nbsp;value&nbsp;not&nbsp;updated&nbsp;yet,&nbsp;try&nbsp;to&nbsp;rotate&nbsp;the&nbsp;device&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[!]&nbsp;&#39;&nbsp;+&nbsp;message[&#39;description&#39;])
&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;message
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
jscode&nbsp;=&nbsp;open(&#39;punsec.js&#39;).read()
print(&#39;[+]&nbsp;Running&#39;)
process_name&nbsp;=&nbsp;&#39;com.punsec.demo&#39;
device&nbsp;=&nbsp;frida.get_usb_device()
try:
&nbsp;&nbsp;&nbsp;&nbsp;pid&nbsp;=&nbsp;device.get_process(process_name).pid
&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[+]&nbsp;Process&nbsp;found&#39;)
except&nbsp;frida.ProcessNotFoundError:
&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[+]&nbsp;Starting&nbsp;process&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;pid&nbsp;=&nbsp;device.spawn([process_name])
&nbsp;&nbsp;&nbsp;&nbsp;device.resume(pid)
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(1)
process&nbsp;=&nbsp;device.attach(pid)
script&nbsp;=&nbsp;process.create_script(jscode)
script.on(&#39;message&#39;,&nbsp;on_message)
script.load()
while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(1)
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;encrypted:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.post({&#39;type&#39;:&#39;encrypted&#39;,&#39;value&#39;:encrypted})
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break
sys.stdin.read()</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">让我们慢慢讲一些这些代码:</span><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个Encrypted变量最初是一个无类型的对象，它不久之后就会被脚本来将它更新为一个加密的值。这个 on_message 函数是一个回调函数能够被 frida 的 javascript 代码来利用，在javascript代码之中，我们将注入到我们程序的进程中来回调我们的python代码。这个回调函数能够被通过在javascript代码中的send() 函数来执行。下一个变量是jscode, 它能够将我们的js代码注入到程序的进程中。为了更方便我们阅读，js代码被写到另一个文件中。Process_name变量是我们的进程名字。我们能够通过在adb shell中运行 &quot;ps&quot; 命令 &quot;pm list packages&quot; 命令得到我们应用的进程名字。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个 device 变量是来连接我们的USB设备(手机)的。Try except 用于处理异常(万一目标程序还没有在我们的设备上运行的话，就会产生异常)。在知道了运行程序的UID后，我们可以挂接到目标程序上，并且在目标进程上注入jscode。通过使用js的 send() 函数，脚本就会开始注册我们的回调函数。下面是 while 循环，可以看到frida实际上是有多么的强大，在这个循环中，我们检测是否encrypted变量它的类型已经不是None了，如果它的类型发生了改变，脚本的post()函数将会发送一个信息将我们的js代码注入到目标进程，并且信息将会被在js代码中的recv() 函数所处理。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在开始下一步的操作之前，我们需要对目标apk进行静态分析。我们首先要反编译apk并且将java bytecode转换为.java格式的代码来阅读。在这里，我们使用的分析工具是dex2jar。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;./d2j-dex2jar.sh&nbsp;CrackMe.apk
dex2jar&nbsp;CrackMe.apk&nbsp;-&gt;&nbsp;./CrackMe-dex2jar.jar</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在让我们通过JD-GUI来分析刚才生成的CrackMe-dex2jar.jar文件</span></p><p style="text-indent: 2em; text-align: center;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t017af7f50a7c320927.png" title="t01758c6872abc21682.png" alt="http://p4.qhimg.com/t01758c6872abc21682.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看到反编译后的代码与原始的java代码还是有很大的不同的。我们来分析一下不同的地方：首先可以很明显的看到资源 id由原来的R.x.x变换称为了数字格式的。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">正如我们上面看到的，MainActivity只包含一个 onCreate() 函数。我们首先来看一下android应用的生命周期： &nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p9.qhimg.com/t01ac9fce0966ee766f.png" title="t018128e0287158e34f.png" alt="http://p1.qhimg.com/t018128e0287158e34f.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看到: onCreate() 函数在app启动之后就运行。为了保持应用的实际功能，我们现在就在hook这个函数，来执行对原始函数的调用，能够获取到目前activity的上下文来得到一些字符串的值，就像下面这一行一样：</span></p><pre class="brush:java;toolbar:false">String&nbsp;str&nbsp;=&nbsp;MainActivity.this.getString(2131099669);</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在让我们创建punsec.js文件，来得到这些值。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&quot;encrypted&quot;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
});</pre><p style="text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Java.perform() </span></strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">是 frida 定义的，它的功能是：告诉frida server来运行已经包装好的js代码。<strong> Java.use() </strong>是一个包装器为了能够动态的加载packages到我们的目标进程中。为了下一步的需要，我们将会使用<strong>send() </strong>回调函数来发送数据到我们的python程序中。现在运行着的python脚本给我们返回了这样的信息：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Starting&nbsp;process
[+]&nbsp;Received&nbsp;str&nbsp;:&nbsp;vXrMphqS3bWfIGT811/V2Q==</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">要记住，要想<strong>onCreate() </strong>函数触发，必须要执行回调函数，也就是在启动进程之后，必须要让它在后台运行后再打开程序，请参考上面的Activity生命周期。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们也看到了代码中有几个调用来执行 <strong>Base64.decode()</strong> 和通过数字id来得到string, 我们可能也会需要这些值，所以让我们来修改一下我们的代码</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;encrypted&#39;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;base64&nbsp;=&nbsp;Java.use(&#39;android.util.Base64&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;base64.decode.overload(&#39;java.lang.String&#39;,&nbsp;&#39;int&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Encoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;x);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;=&nbsp;new&nbsp;Buffer(base64.decode(x,&nbsp;y));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Decoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;buf.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64.decode(x,&nbsp;y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
});</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">再一次运行我们的python程序将会得到下面的输出:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Process&nbsp;found
[*]&nbsp;Base64&nbsp;Encoded&nbsp;:&nbsp;TXlTdXBlclNlY3JldEwzM3RQYXNzdzByZA==
[*]&nbsp;Base64&nbsp;Decoded&nbsp;:&nbsp;MySuperSecretL33tPassw0rd</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Hmm, 似乎我们已经成功了。不要着急，现在让我们再来仔细看一下我们的反编译代码:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">if&nbsp;(Base64.encodeToString(
Util.a(paramAnonymousView,&nbsp;
Util.a(new&nbsp;String(
Base64.decode(MainActivity.this.getString(2131099683),&nbsp;0)
)
)
),&nbsp;
0).trim().equals(str))</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在上面的代码中，有两次对<strong> Util.a</strong> 函数的调用但是都采用的不同的参数类型，我们已经hook了 <strong>Base64.decode()</strong> 函数，所以现在让我们用下面的代码对<strong> Util.a() </strong>创建一个 hook :</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;encrypted&#39;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;base64&nbsp;=&nbsp;Java.use(&#39;android.util.Base64&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;base64.decode.overload(&#39;java.lang.String&#39;,&nbsp;&#39;int&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Encoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;x);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;=&nbsp;new&nbsp;Buffer(base64.decode(x,&nbsp;y));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Decoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;buf.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64.decode(x,&nbsp;y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Util&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.Util&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;Util.a.implementation;
&nbsp;
});</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">运行我们的python代码，然后可以得到以下的输出:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Process&nbsp;found
[!]&nbsp;Error:&nbsp;a():&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;overload,&nbsp;use&nbsp;.overload(&lt;signature&gt;)&nbsp;to&nbsp;choose&nbsp;from:
.overload(&#39;java.lang.String&#39;)
.overload(&#39;java.lang.String&#39;,&nbsp;&#39;javax.crypto.SecretKey&#39;)
.overload(&#39;[B&#39;,&nbsp;&#39;javax.crypto.SecretKey&#39;)</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这似乎出现了一点错误。看起来是我们的Util类中有函数重载(有相同的方法名称但是拥有不同的参数)。为了克服这个问题, frida提供给我们额外的方法 <strong>overload()</strong>，通过这个方法，我们可以显式地设置哪个方法来 override/hook。我们将会 hook <strong>Util.a(String, SecretKey)</strong>函数(因为它是一个负责加密的函数)来为了进行下一步分析:</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p8.qhimg.com/t01b905ec629ffd448b.png" title="t0128b78c1a066033d7.png" alt="http://p8.qhimg.com/t0128b78c1a066033d7.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但是我们怎么样才能识别出这是一个加密函数的呢？首先可以看到这个函数的返回类型是byte，很显然意味着并没有返回一个string类型，同时，本地密码初始化为1来作为第一个参数传递:</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t0190069cd4e662c0b0.png" title="t018bcc34b43286c297.png" alt="http://p9.qhimg.com/t018bcc34b43286c297.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">现在，让我们来修改我们的js代码为了能够合理地hook这个函数:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;encrypted&#39;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;base64&nbsp;=&nbsp;Java.use(&#39;android.util.Base64&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;base64.decode.overload(&#39;java.lang.String&#39;,&nbsp;&#39;int&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Encoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;x);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;=&nbsp;new&nbsp;Buffer(base64.decode(x,&nbsp;y));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Base64&nbsp;Decoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;buf.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64.decode(x,&nbsp;y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Util&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.Util&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;Util.a.overload(&#39;java.lang.String&#39;,&nbsp;&#39;javax.crypto.SecretKey&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;UserInput&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;x);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.a(x,y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
});</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">再次运行我们的python程序，观察输出有哪些改变:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Process&nbsp;found
[*]&nbsp;Base64&nbsp;Encoded&nbsp;:&nbsp;TXlTdXBlclNlY3JldEwzM3RQYXNzdzByZA==
[*]&nbsp;Base64&nbsp;Decoded&nbsp;:&nbsp;MySuperSecretL33tPassw0rd
[*]&nbsp;UserInput&nbsp;:&nbsp;wrongSecretTest</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">极好的，我们现在可以拦截我们的输出了。现在我们可以发现 Util 类还有一个函数<strong> Util.a(byte, SecretKey)</strong> 一直没有在app中使用，通过分析可以看到这是一个解密函数。所以现在我们该如何做呢？ 加密函数已经接收到了密钥，所以我们可以在解密函数中利用，但是我们还需要第一个参数。第一个参数是一个 base64 解密的string 变量。所以让我们来修改我们的代码，为了能够在我们的 js中收到这个参数，并且过掉这个解密函数，这样的话，我们就能解密最终的Key来完成这次挑战。现在最后一次修改我们的js代码:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;encrypted&#39;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;base64&nbsp;=&nbsp;Java.use(&#39;android.util.Base64&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;base64.decode.overload(&#39;java.lang.String&#39;,&nbsp;&#39;int&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;send(&#39;Base64&nbsp;Encoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;x);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;var&nbsp;buf&nbsp;=&nbsp;new&nbsp;Buffer(base64.decode(x,&nbsp;y));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;send(&#39;Base64&nbsp;Decoded&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;buf.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64.decode(x,&nbsp;y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Util&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.Util&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;Util.a.overload(&#39;java.lang.String&#39;,&nbsp;&#39;javax.crypto.SecretKey&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recv(&#39;encrypted&#39;,&nbsp;function&nbsp;onMessage(payload)&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encrypted&nbsp;=&nbsp;payload[&#39;value&#39;];&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cipher&nbsp;=&nbsp;base64.decode(encrypted,&nbsp;0);&nbsp;//&nbsp;call&nbsp;the&nbsp;above&nbsp;base64&nbsp;method
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secret&nbsp;=&nbsp;this.a(cipher,&nbsp;y);&nbsp;//&nbsp;call&nbsp;decrypt&nbsp;method
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Decrypted&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;secret)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.a(secret,y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
});</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们把一个 <strong>recv() </strong>调用放在了函数中以便于可以收到我们写的python程序中已经存储的加密string。现在解密这个已经被加密过的base64密钥并且和密钥一起发送到解密函数中。现在让我们再一次运行我们的python程序：</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Process&nbsp;found
[!]&nbsp;Encrypted&nbsp;value&nbsp;not&nbsp;updated&nbsp;yet,&nbsp;try&nbsp;to&nbsp;rotate&nbsp;the&nbsp;device
[+]&nbsp;Received&nbsp;str&nbsp;:&nbsp;vXrMphqS3bWfIGT811/V2Q==
[*]&nbsp;Decrypted&nbsp;:&nbsp;knb*AS234bnm*0</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">woah, 我们得到了key。这也会覆盖掉任何的用户输入并将其替换为解密的string, 所以现在每一个用户输入都是起作用的: &nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"><img src="http://p8.qhimg.com/t019c8ffb907a10c4f2.png" title="t01761b72e57aa46b2d.png" alt="http://p7.qhimg.com/t01761b72e57aa46b2d.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">现在我们不仅用实际的secret覆盖了用户输入，而且还覆盖了实际的secret phrase为了通过这个挑战。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">假使我们的apk应用中没有解密函数，我们该怎么办呢？ 不必担心，我们能巧妙的将js代码插入到package中来执行解密操作并且用必要的参数覆盖这个方法，或者我们还可以用下面的python代码来解密:</span></p><pre class="brush:python;toolbar:false">import&nbsp;frida,&nbsp;sys,&nbsp;time,&nbsp;md5
from&nbsp;Crypto.Cipher&nbsp;import&nbsp;AES

encrypted&nbsp;=&nbsp;None
secretKey&nbsp;=&nbsp;None


def&nbsp;decrypt(encrypted,&nbsp;key):
&nbsp;&nbsp;key&nbsp;=&nbsp;md5.new(key).hexdigest()[:16]
&nbsp;&nbsp;cipher&nbsp;=&nbsp;AES.new(key)
&nbsp;&nbsp;decrypted&nbsp;=&nbsp;cipher.decrypt(encrypted.decode(&#39;base64&#39;))[:14]

&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(1,len(encrypted.decode(&#39;base64&#39;))/16):
&nbsp;&nbsp;&nbsp;&nbsp;cipher&nbsp;=&nbsp;AES.new(key,&nbsp;AES,&nbsp;encodedEncrypted.decode(&#39;base64&#39;)[(i-1)*16:i*16])
&nbsp;&nbsp;&nbsp;&nbsp;decrypted&nbsp;+=&nbsp;cipher.decrypt(encodedEncrypted.decode(&#39;base64&#39;)[i*16:])[:16]

&nbsp;&nbsp;return&nbsp;decrypted.strip()

def&nbsp;on_message(message,&nbsp;data):
&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;encrypted,&nbsp;secretKey
&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;encrypted:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encrypted&nbsp;=&nbsp;message[&#39;payload&#39;][&#39;encrypted&#39;]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;secretKey:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secretKey&nbsp;=&nbsp;message[&#39;payload&#39;][&#39;secretKey&#39;]
&nbsp;&nbsp;&nbsp;&nbsp;except:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;message[&#39;type&#39;]&nbsp;==&nbsp;&#39;send&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[*]&nbsp;{0}&#39;.format(message[&#39;payload&#39;]))
&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;message[&#39;type&#39;]&nbsp;==&nbsp;&#39;error&#39;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&#39;ReferenceError&#39;&nbsp;in&nbsp;message[&#39;description&#39;]:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[!]&nbsp;Rotate&nbsp;the&nbsp;device&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[!]&nbsp;&#39;&nbsp;+&nbsp;message[&#39;description&#39;])
&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;message
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
jscode&nbsp;=&nbsp;open(&#39;punsec.js&#39;).read()

print(&#39;[+]&nbsp;Running&#39;)

process_name&nbsp;=&nbsp;&#39;com.punsec.demo&#39;
device&nbsp;=&nbsp;frida.get_usb_device()

try:
&nbsp;&nbsp;&nbsp;&nbsp;pid&nbsp;=&nbsp;device.get_process(process_name).pid
&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[+]&nbsp;Process&nbsp;found&#39;)
except&nbsp;frida.ProcessNotFoundError:
&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;[+]&nbsp;Starting&nbsp;process&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;pid&nbsp;=&nbsp;device.spawn([process_name])
&nbsp;&nbsp;&nbsp;&nbsp;device.resume(pid)
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(1)

process&nbsp;=&nbsp;device.attach(pid)

script&nbsp;=&nbsp;process.create_script(jscode)
script.on(&#39;message&#39;,&nbsp;on_message)
script.load()
while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(0.2)
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;encrypted&nbsp;and&nbsp;secretKey:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.post({&#39;type&#39;:&#39;encrypted&#39;,&#39;value&#39;:decrypt(encrypted,&nbsp;secretKey)})
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break
sys.stdin.read()</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们更新后的js代码:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:js;toolbar:false">Java.perform(function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;MainActivity&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.MainActivity&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;MainActivity.onCreate.implementation&nbsp;=&nbsp;function(a)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.onCreate(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;encrypted&#39;:this.getString(2131099669)});
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;base64&nbsp;=&nbsp;Java.use(&#39;android.util.Base64&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;base64.decode.overload(&#39;java.lang.String&#39;,&nbsp;&#39;int&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;=&nbsp;new&nbsp;Buffer(base64.decode(x,&nbsp;y));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send({&#39;secretKey&#39;:&nbsp;buf.toString()});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;base64.decode(x,&nbsp;y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Util&nbsp;=&nbsp;Java.use(&#39;com.punsec.demo.Util&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;Util.a.overload(&#39;java.lang.String&#39;,&nbsp;&#39;javax.crypto.SecretKey&#39;).implementation&nbsp;=&nbsp;function(x,&nbsp;y)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recv(&#39;encrypted&#39;,&nbsp;function&nbsp;onMessage(payload)&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secret&nbsp;=&nbsp;payload[&#39;value&#39;];&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send(&#39;Decrypted&nbsp;:&nbsp;&#39;&nbsp;+&nbsp;secret)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.a(secret,y);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
});</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在运行我们的python程序:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">$&nbsp;python&nbsp;punsec.py
[+]&nbsp;Running
[+]&nbsp;Process&nbsp;found
[*]&nbsp;{u&#39;secretKey&#39;:&nbsp;u&#39;MySuperSecretL33tPassw0rd&#39;}
[!]&nbsp;Rotate&nbsp;the&nbsp;device
[*]&nbsp;{u&#39;encrypted&#39;:&nbsp;u&#39;vXrMphqS3bWfIGT811/V2Q==&#39;}
[*]&nbsp;{u&#39;secretKey&#39;:&nbsp;u&#39;MySuperSecretL33tPassw0rd&#39;}
[*]&nbsp;Decrypted&nbsp;:&nbsp;knb*AS234bnm*0</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"><br/></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">用 Inspeckage 来分析</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们将会使用到Inspeckage, Xposed Framework 和 ApkStudio/ByteCodeViewer.</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Inspeckage – Android Package Inspector</span></p><pre class="brush:plain;toolbar:false">Inspeckage&nbsp;is&nbsp;a&nbsp;tool&nbsp;developed&nbsp;to&nbsp;offer&nbsp;dynamic&nbsp;analysis&nbsp;of&nbsp;Android&nbsp;applications.&nbsp;By&nbsp;applying&nbsp;hooks&nbsp;to&nbsp;functions&nbsp;of&nbsp;the&nbsp;Android&nbsp;API,&nbsp;Inspeckage&nbsp;will&nbsp;help&nbsp;you&nbsp;understand&nbsp;what&nbsp;an&nbsp;Android&nbsp;application&nbsp;is&nbsp;doing&nbsp;at&nbsp;runtime.</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Inspeckage可以让你来用简单的web接口进行分析。Inspeckage需要你安装Inspeckage Xposed module并且在 Xpose 框架中激活它。在你的android设备上启动Inspeckage App并且选择我们的目标应用并且在Inspeckage Webserver中浏览。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p4.qhimg.com/t016152e0013935706d.png" title="t016104191f5c9af169.png" alt="http://p3.qhimg.com/t016104191f5c9af169.png"/>&nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p6.qhimg.com/t016fc220b3b7bb543d.png" title="t0173bb9f54502f065b.png" alt="http://p8.qhimg.com/t0173bb9f54502f065b.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">打开自动刷新开关，点击在webserver上的设置按钮并且关闭一些Actvity检测就像下面这张图一样，最后点击 start App 并且刷新页面。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p9.qhimg.com/t01c243279b03fcd668.png" title="t01e1772d7de66fa734.png" alt="http://p9.qhimg.com/t01e1772d7de66fa734.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">一旦我们的App在手机上运行，就在App上输入测试的数据并点击ok按钮，然后观察Inspeckage webserver上的通知(注意要开启自动刷新):</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t01dea274f9a7233536.png" title="t01da2d54c122281d77.png" alt="http://p1.qhimg.com/t01da2d54c122281d77.png"/></span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t01212b8a79fb4928c3.png" title="t012906ab015afa11da.png" alt="http://p2.qhimg.com/t012906ab015afa11da.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这两张截图都显示出了我们使用了frida方法。用 Inspeckage分析是相当简单的，你可以检测app执行的文件系统Activities, SQL队列操作，在这背后使用的是和我们使用frida方法相同的概念: 在加密，文件系统，hash等操作函数上进行hook，但是在这里，我们可以执行函数hook吗? 当然了，正如你在最后一个标签上看到的，它提供了一个hook选项。但是随之而来的问题是：它不像frida那样，Inseckage没有提供对重载的方法的覆盖，现在点击hook标签并且创建一个hook来验证我们的想 法: &nbsp;</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p7.qhimg.com/t01fd1266c050933682.png" title="t01ae56138a57221fbc.png" alt="http://p8.qhimg.com/t01ae56138a57221fbc.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">所以现在为了能够创建一个有效的hook，我们将会使用 ByteCodeViewer 或者 APKStudio 来修改apk中的 bytecode(字节码)。下面这是我们对字节码的patch:</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p1.qhimg.com/t010d616872d99b3e2a.png" title="t01c0b1b1b0c0590149.png" alt="http://p6.qhimg.com/t01c0b1b1b0c0590149.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">(注意：当打开apk的时候，取消选择&quot;Decode Resource&quot;，否则你将会遇到下面这些问题)</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">ERROR:&nbsp;9-patch&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-mdpi-v4\abc_list_divider_mtrl_alpha.9.png&nbsp;malformed.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;have&nbsp;one-pixel&nbsp;frame&nbsp;that&nbsp;is&nbsp;either&nbsp;transparent&nbsp;or&nbsp;white.
ERROR:&nbsp;Failure&nbsp;processing&nbsp;PNG&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-mdpi-v4\abc_list_divider_mtrl_alpha.9.png
ERROR:&nbsp;9-patch&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-hdpi-v4\abc_list_divider_mtrl_alpha.9.png&nbsp;malformed.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;have&nbsp;one-pixel&nbsp;frame&nbsp;that&nbsp;is&nbsp;either&nbsp;transparent&nbsp;or&nbsp;white.
ERROR:&nbsp;Failure&nbsp;processing&nbsp;PNG&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-hdpi-v4\abc_list_divider_mtrl_alpha.9.png
ERROR:&nbsp;9-patch&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-xhdpi-v4\abc_list_divider_mtrl_alpha.9.png&nbsp;malformed.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;have&nbsp;one-pixel&nbsp;frame&nbsp;that&nbsp;is&nbsp;either&nbsp;transparent&nbsp;or&nbsp;white.
ERROR:&nbsp;Failure&nbsp;processing&nbsp;PNG&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-xhdpi-v4\abc_list_divider_mtrl_alpha.9.png
ERROR:&nbsp;9-patch&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-xxhdpi-v4\abc_list_divider_mtrl_alpha.9.png&nbsp;malformed.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;have&nbsp;one-pixel&nbsp;frame&nbsp;that&nbsp;is&nbsp;either&nbsp;transparent&nbsp;or&nbsp;white.
ERROR:&nbsp;Failure&nbsp;processing&nbsp;PNG&nbsp;image&nbsp;C:\Users\labuser\Desktop\CrackMe\res\drawable-xxhdpi-v4\abc_list_divider_mtrl_alpha.9.png</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在上面那副截图中，可以看到第168行，我们通过识别第168行的参数类型和返回值，成功的识别出了这就是加密函数，在第197行，这个被赋值为1的变量也是我们之前看到的。我们已经把这个函数的名字改成了b ,并且解密函数名称改为c。现在为了保证我们的app可以正常运行，我们需要在MainActivity的字节码上做出相同的更新:</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t01187d48b490c8a9c3.png" title="t01b04aba044061d922.png" alt="http://p9.qhimg.com/t01b04aba044061d922.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">现在我们的任务已经完成了，可以创建一个<strong>keystore</strong>来对我们的apk进行签名。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:ps;toolbar:false">C:\Program&nbsp;Files\Java\jdk1.8.0_144\bin&gt;keytool&nbsp;-genkey&nbsp;-v&nbsp;-keystore&nbsp;C:\users\labuser\Desktop\my.keystore&nbsp;-alias&nbsp;alias_na
me&nbsp;-keyalg&nbsp;RSA&nbsp;-keysize&nbsp;2048&nbsp;-validity&nbsp;10000
Enter&nbsp;keystore&nbsp;password:
Re-enter&nbsp;new&nbsp;password:
What&nbsp;is&nbsp;your&nbsp;first&nbsp;and&nbsp;last&nbsp;name?
&nbsp;&nbsp;[Unknown]:
What&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;your&nbsp;organizational&nbsp;unit?
&nbsp;&nbsp;[Unknown]:
What&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;your&nbsp;organization?
&nbsp;&nbsp;[Unknown]:
What&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;your&nbsp;City&nbsp;or&nbsp;Locality?
&nbsp;&nbsp;[Unknown]:
What&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;your&nbsp;State&nbsp;or&nbsp;Province?
&nbsp;&nbsp;[Unknown]:
What&nbsp;is&nbsp;the&nbsp;two-letter&nbsp;country&nbsp;code&nbsp;for&nbsp;this&nbsp;unit?
&nbsp;&nbsp;[Unknown]:
Is&nbsp;CN=Unknown,&nbsp;OU=Unknown,&nbsp;O=Unknown,&nbsp;L=Unknown,&nbsp;ST=Unknown,&nbsp;C=Unknown&nbsp;correct?
&nbsp;&nbsp;[no]:&nbsp;&nbsp;yes
Generating&nbsp;2,048&nbsp;bit&nbsp;RSA&nbsp;key&nbsp;pair&nbsp;and&nbsp;self-signed&nbsp;certificate&nbsp;(SHA256withRSA)&nbsp;with&nbsp;a&nbsp;validity&nbsp;of&nbsp;10,000&nbsp;days
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for:&nbsp;CN=Unknown,&nbsp;OU=Unknown,&nbsp;O=Unknown,&nbsp;L=Unknown,&nbsp;ST=Unknown,&nbsp;C=Unknown
Enter&nbsp;key&nbsp;password&nbsp;for&nbsp;&lt;alias_name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RETURN&nbsp;if&nbsp;same&nbsp;as&nbsp;keystore&nbsp;password):
[Storing&nbsp;C:\users\labuser\Desktop\my.keystore]
C:\Program&nbsp;Files\Java\jdk1.8.0_144\bin&gt;jarsigner&nbsp;-verbose&nbsp;-sigalg&nbsp;SHA1withRSA&nbsp;-digestalg&nbsp;SHA1&nbsp;-keystore&nbsp;C:\users\labuser\Desktop\my.keystore&nbsp;C:\users\labuser\Desktop\CrackMe.apk&nbsp;alias_name</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">将已经签名的apk安装到设备上。重启Inspeckage，开始hook来验证是否我们的修改已经起作用了。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p7.qhimg.com/t01f474be241cc56d34.png" title="t014cfef591c59a554d.png" alt="http://p3.qhimg.com/t014cfef591c59a554d.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">极好地，我们的修改是完美的，现在我们可以对目标函数<strong>Util.b() </strong>下hook。选择这个函数并且点击 Add hook 按钮。现在让我们点击ok按钮并且观察Inspeckage Server的通知。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p5.qhimg.com/t019845f392b8416f56.png" title="t01d2cdc1d1d2b7419e.png" alt="http://p7.qhimg.com/t01d2cdc1d1d2b7419e.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们可以看到Inspeckage已经成功地从已经hook的函数中截取到数据并且提供给我们了函数的参数和返回值。现在点击 Replace 按钮并且配置如下的选项。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t017b0658e42a1681f6.png" title="t0119b1baa41cb66136.png" alt="http://p1.qhimg.com/t0119b1baa41cb66136.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这里我们将第一个参数传递给了我们的加密函数，这个函数拥有我们已经用frida识别出来的秘密值。无论什么时候进行输入测试(大小写敏感)，Hook都会替换数据并且传递我们提供的值，然后将Congratulations再一次显示在我们的屏幕上。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p8.qhimg.com/t013e82b79efa49c4f3.png" title="t01ac761cc5ce136716.png" alt="http://p8.qhimg.com/t01ac761cc5ce136716.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">二进制补丁（字节码修改）</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在这个方法中，我们将会使用<strong>ApkStudio</strong>和<strong>Jarsigner</strong>。 我们将会通过修改反编译的Apk，之后重新编译它来修改程序的逻辑。启动 ApkStudio并且再次加载文件( 记住要取消选择&quot;Decode Resources&quot;复选框)，之后在MainActivity$1.smali中定位到程序代码中进行比较的位置</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t01a441e52a3a16852f.png" title="t01dbb510b5c3c8cc60.png" alt="http://p7.qhimg.com/t01dbb510b5c3c8cc60.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们可以在第113行看到程序会比较两个不同的值来执行检测，如果比较失败了，会显示&quot;Umm, Try Again&quot;。但是如果程序总是将两个相同的值进行比较会怎么样呢？在这种情况下，程序将会跳过else条件直接返回true。所以现在让我们将代码修改后重新编译并对我们的Apk进行签名，然后做测试。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p4.qhimg.com/t01bf2e4f8b4b680ceb.png" title="t01d65509f0f0c8bcef.png" alt="http://p6.qhimg.com/t01d65509f0f0c8bcef.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">再一次运行应用验证是否程序是否通过了原来的程序逻辑。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">静态分析和代码复制</span></strong></span></p><p style="text-indent: 2em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><hr/><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在这个方法中，我们将会使用<strong>Android Studio/IntelliJ </strong>和<strong> ByteCodeViewer</strong>来进行静态代码分析。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Static&nbsp;analysis
Also&nbsp;called&nbsp;static&nbsp;code&nbsp;analysis,&nbsp;is&nbsp;a&nbsp;method&nbsp;of&nbsp;computer&nbsp;program&nbsp;debugging&nbsp;that&nbsp;is&nbsp;done&nbsp;by&nbsp;examining&nbsp;the&nbsp;code&nbsp;without&nbsp;executing&nbsp;the&nbsp;program.&nbsp;The&nbsp;process&nbsp;provides&nbsp;an&nbsp;understanding&nbsp;of&nbsp;the&nbsp;code&nbsp;structure,&nbsp;and&nbsp;can&nbsp;help&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;code&nbsp;adheres&nbsp;to&nbsp;industry&nbsp;standards.</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">启动 ByteCodeViewer(BCV) 并且等待它来安装依赖项。一旦安装好了之后，我们将可以直接在它里面打开apk文件。在BCV中，点击File-&gt;Add 并且选择 CrackMe.apk，然后让它完成加载这个文件。点击<strong>View-&gt;Pane1-&gt;Procyon-&gt;java</strong> 和<strong>View-&gt;Pane2-&gt;Smali/Dex-&gt;Samli/Dex</strong> 。你的界面将会看起来和下面的一样</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p3.qhimg.com/t0169b5db07390c7fe9.png" title="t014eedb5b3ff374fdf.png" alt="http://p9.qhimg.com/t014eedb5b3ff374fdf.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在第9行，我们可以看到&quot;final String string2 = this.this$0.getString(2131099669);&quot;。在当前活动上下文的getString()方法，可以使用&quot;this&quot;，&quot;MainActivity.this &quot;或者&quot;getApplicationContext() &quot; 通过一个整数值来得到资源值。这些数字id的索引在R类中被创建，所以我们将会在R$string.class 中寻找资源id，BCV可以将内容识别为xml 文件格式。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t0127a50619a607dcac.png" title="t01af30ac1cabe0bfd9.png" alt="http://p8.qhimg.com/t01af30ac1cabe0bfd9.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们可以看到这个整数值被分配给a，现在我们不得不对a在strings.xml中做一个查找，你可以在BCV中通过展开<strong>CrackMe.apk-&gt;Decoded Resources-&gt;res-&gt;values-&gt;strings.xml </strong>。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p2.qhimg.com/t01e55406c413cd4794.png" title="t0140acc06e930cce4b.png" alt="http://p9.qhimg.com/t0140acc06e930cce4b.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">有时候BCV打开文件会呈现出二进制形式而不是xml格式，对于这种情况，我们可以点击File-&gt;Save As Zip ，然后解压zip并且在编辑器中打开strings.xml。</span></p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">&nbsp;<img src="http://p0.qhimg.com/t015973be323327c6bd.png" title="t015973be323327c6bd.png" alt="http://p0.qhimg.com/t015973be323327c6bd.png"/></span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">极好的，我们已经找到了这个字符串。我们将会用这个方法恢复所有的字符串并且保存它们。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">2131099669&nbsp;-&gt;&nbsp;a&nbsp;-&gt;&nbsp;vXrMphqS3bWfIGT811/V2Q==
2131099683&nbsp;-&gt;&nbsp;b&nbsp;-&gt;&nbsp;TXlTdXBlclNlY3JldEwzM3RQYXNzdzByZA==
2131099685&nbsp;-&gt;&nbsp;d&nbsp;-&gt;&nbsp;Congratulations
2131099686&nbsp;-&gt;&nbsp;e&nbsp;-&gt;&nbsp;Umm,&nbsp;Try&nbsp;again</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们将会使用IntelliJ来写我们的代码来试图实现逆向原始函数的功能，通过从BCV反编译后的文件中复制代码。 当所有的代码让在一块的时候，它将会看起来像下面的代码</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:java;toolbar:false">import&nbsp;javax.crypto.Cipher;
import&nbsp;javax.crypto.SecretKey;
import&nbsp;javax.crypto.spec.SecretKeySpec;
import&nbsp;java.security.MessageDigest;
import&nbsp;java.util.Base64;
class&nbsp;Decrypt&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String&nbsp;args[])&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;a&nbsp;=&nbsp;&quot;vXrMphqS3bWfIGT811/V2Q==&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;b&nbsp;=&nbsp;&quot;TXlTdXBlclNlY3JldEwzM3RQYXNzdzByZA==&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;new_b&nbsp;=&nbsp;new&nbsp;String(Base64.getDecoder().decode(b));

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;array&nbsp;=&nbsp;Base64.getDecoder().decode(a);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;decoded&nbsp;=&nbsp;decrypt(array,&nbsp;getKey(new_b));

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;Decoded&nbsp;:&nbsp;&quot;&nbsp;+&nbsp;decoded);
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;String&nbsp;decrypt(byte[]&nbsp;array,&nbsp;SecretKey&nbsp;secretKey)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;decoded&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cipher&nbsp;instance&nbsp;=&nbsp;Cipher.getInstance(&quot;AES/ECB/PKCS5Padding&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.init(2,&nbsp;secretKey);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decoded&nbsp;=&nbsp;new&nbsp;String(instance.doFinal(array),&nbsp;&quot;UTF-8&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}catch&nbsp;(Exception&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;do&nbsp;something
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;decoded;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;SecretKey&nbsp;getKey(String&nbsp;s)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretKeySpec&nbsp;secretKeySpec&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageDigest&nbsp;instance&nbsp;=&nbsp;MessageDigest.getInstance(&quot;MD5&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.update(s.getBytes());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;digest&nbsp;=&nbsp;instance.digest();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuilder();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;length&nbsp;=&nbsp;digest.length,&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;++i)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(String.format(&quot;%02x&quot;,&nbsp;digest[i]&nbsp;&amp;&nbsp;0xFF));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secretKeySpec&nbsp;=&nbsp;new&nbsp;SecretKeySpec(sb.toString().substring(0,&nbsp;16).getBytes(),&nbsp;&quot;AES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;do&nbsp;something
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;secretKeySpec;
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">将文件命名为<strong>Decrypt.java</strong> 并保存文件。我们需要编译这个文件，然后运行它来检测我们的代码是否起作用了。</span><br/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:bash;toolbar:false">//&nbsp;create&nbsp;new&nbsp;file
$&nbsp;nano&nbsp;Decrypt.java
//&nbsp;compile&nbsp;file
$&nbsp;javac&nbsp;Decrypt.java
//&nbsp;run&nbsp;file
$&nbsp;java&nbsp;Decrypt
Decoded&nbsp;:&nbsp;knb*AS234bnm*0</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们可以在python代码中做同样的事情，就像先前frida那样，但是有时候复制代码是更简单的，因为只需要做很小的修改就可以使它运行。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们已经描述了所提到的所有工具和方法，现在是时候喝杯咖啡了。</span></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://offensivepentest.com/2017/08/26/android-application-reverse-engineering/" target="_blank">原文链接：https://offensivepentest.com/2017/08/26/android-application-reverse-engineering/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】Android应用逆向工程 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="4428" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="f5cf3505bc2b36b659ad8209bd047511">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
