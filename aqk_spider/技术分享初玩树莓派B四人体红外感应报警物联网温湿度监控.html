<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】初玩树莓派B（四） 人体红外感应报警&物联网温湿度监控 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="树莓派,单片机,嵌入式,树莓派入门"/>
    
        <meta name="description" content="树莓派入门教程连载系列"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】初玩树莓派B（四） 人体红外感应报警&amp;物联网温湿度监控</h2>
                <div class="article-msg">
                    <span class="time">2016-10-13 11:06:12</span>
                                        <span class="read">阅读：22448次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3096"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3096" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://bbs.pediy.com/showthread.php?t=212957"
                             target="_blank">来源： IamHuskar@看雪论坛</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align:center"><img src="http://p6.qhimg.com/t01476ca5cb989238ae.jpg" title="t012b94eebd37fe09f3.jpg" alt="http://p4.qhimg.com/t012b94eebd37fe09f3.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><p style="white-space: normal; text-indent: 2em;"><strong><span style="line-height: 25px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; background-color: rgb(255, 255, 255);">传送门</span></strong></p><hr style="white-space: normal;"/><p style="white-space: normal;"><a href="http://bobao.360.cn/learning/detail/3051.html" _src="http://bobao.360.cn/learning/detail/3051.html"></a></p><p style="margin-top: 0px; margin-bottom: 0px; white-space: normal; padding: 0px; font-size: 18px; line-height: 32px; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); text-decoration: underline;"></span></p><p style="text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3085.html" target="_blank" textvalue="【技术分享】初玩树莓派B（一） 基本介绍&amp;安装操作系统" style="text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（一） 基本介绍&amp;安装操作系统</strong></span></a></p><p style="text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3087.html" target="_blank" style="text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（二） 实用配置(vnc和串口)&amp;GPIO操作点亮LED灯</strong></span></a></p><p style="text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3093.html" target="_blank" style="text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（三） 控制蜂鸣器演奏乐曲</strong></span></a></p><p style="margin-top: 0px; margin-bottom: 0px; white-space: normal; padding: 0px; font-size: 18px; line-height: 32px; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="text-decoration: none; color: rgb(0, 112, 192);"></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong><br/></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><strong>人体红外感应报警</strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">前面的LED灯我们操作使用的GPIO的输出功能,这次我们终于需要用到GPIO的输入功能了。由于这个人体红外感应模块的使用比较简单。所以我们实验完毕以后配合前面的蜂鸣器一起，做一个简单的人体感应报警器。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1. HC-SR501 感应模块简介</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们采用 HC-SR501型号的人体红外感应器来探测人体。更加详细的参数参考模块的使用说明书。</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t0132788226d1f8bfd6.png" title="t01c7df4d9ab4e99d21.png" alt="http://p7.qhimg.com/t01c7df4d9ab4e99d21.png"/></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01061f9aca3736a1b3.png" title="t01b88f814c26c6ca21.png" alt="http://p8.qhimg.com/t01b88f814c26c6ca21.png"/></p><p style="text-align:center"><img src="http://p4.qhimg.com/t0164d46ee2bc262548.png" title="t012a0228e48937d5df.png" alt="http://p4.qhimg.com/t012a0228e48937d5df.png"/></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0199362468518f0c49.png" title="t01fd0e403ab61ec716.png" alt="http://p5.qhimg.com/t01fd0e403ab61ec716.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">对照前面的参数以及电路图，找到下面的左右针脚正负极，中间的PIN为感应输出，感应到人体时，输出3.3V高电平，检测不到信号时输出0。同时还要求工作电压在4.5V-20V之间。恰好树莓派的P1编号中第2，4号PIN都是5V的电压，满足要求，所以这次我们要接5V的电压。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">参数调节旋钮是用来扭动控制一些参数的。比如探测的延时时间，灵敏度等等。具体可以参看 HC -SR501的说明书。这里我们都使用默认值。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但是有一个关键的L H模式调节阀门要介绍一下，右上角有三个针脚，按照我实物照片，假定从上到下为123 。还有一个黄色的套接头，图中套接头接通了2 3号，代表了H模式，这个套接头是可以拔下来的，然后插到上面来，接通1 2号，代表了L模式。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">L模式是不可重复触发，当探测到一次人体时，输出一次高电平，保持一段时间恢复低电平，在此期间如果还是检测到了人体也不再延长这个高电平的时间。等到低电平的封锁时间（前面默认是2.5S）过了以后才又开始检测。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">H模式是可以重复触发，如果一直感应到人体时，会一直输出高电平，直到探测不到人体后保持小段时间然后恢复低电平。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. GPIO输入的上拉和下拉</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于学习软件的人来说，软件的世界只有0和1，所以我接触硬件之前也是这么认为的。所以我在使用人体红外感应的时候遇到了一个问题，我认为只要设置GPIO的模式为INPUT，后面只需要读取针脚的状态0,1就行了。结果我遇到一个问题。当我在设置比如pin22（wiringpi标号为6）为INPUT模式，接上一根线后，这一条线另一端什么都不接，按理说这时应该输入为0V，但是我尝试读取发现并不是一直保持低电平，而是一会儿高，一会低，用手握住另外一端就会输出高电平。当我接pin3（wiringPi 标号为8）却始终是高电平。不得不查询各种资料，发现还有上拉和下拉这种说法。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当我们给一个针脚接入GND，那么就是低电平，如果我们给一个针脚3.3V，那么就是高电平，状态是很确定的。如果我们什么都不接，那么这个针脚处于悬浮状态，很容易受到外接的干扰，可能是高也可能是低，也可能是处于高和低之间的状态。这时候我们就要明确指定这个针脚应该处于高或者低，不能让他处于悬浮状态。接入一个上拉电阻能够让这个针脚处于明确的高电平状态，接入一个下拉电阻能够让他处于明确的低电平状态。前面我们用作输出的时候都是明确给定了输出的高低状态。关于上拉电阻和下拉电阻，有一篇英文解释写的很不错，我也是参考这篇来看的，里面的测试大家也可以用树莓派测试一下。（<a href="http://www.bit-101.com/blog/?p=3813" _src="http://www.bit-101.com/blog/?p=3813">http://www.bit-101.com/blog/?p=3813</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">PIN3始终处于高电平状态是因为。这个PIN口是用于树莓派I2C设备的，内部外接了一个物理的上拉电阻。所以他的状态一直是高电平，作为INPUT不能使用这个PIN。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">PIN22 时高时低就是由于处于悬浮状态。所以我们要使用这个PIN就比如为他明确指定悬浮的时候是高还是低。wiringpi通过pullUpDnControl来控制这个变量。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. 接线以及测试</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">模块左边的针脚1接P1编号的PIN2 为5V的正极，模块右边的针脚3的负极接PIN6，模块中间的针脚2输出线接PIN22（wiringPi就是标号6）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">接线图如下：</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t016cb5622bc15259f4.png" title="t017daf09c206414ebc.png" alt="http://p7.qhimg.com/t017daf09c206414ebc.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">图中我连蜂鸣器也接上去了。当我们检测到人体的时候。使用前一节的beep函数发出警告声音。</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们先初步检测一下模块有没有工作正常。测试HC-SR501不同的模式。选择的H模式，套接头接下面两个脚。也就是可以重复触发，检测到人体，一直处于高电平。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01b110c495194ad96f.png" title="t016dedd555876d8f80.png" alt="http://p8.qhimg.com/t016dedd555876d8f80.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看出中间是连续的检测，也就是高电平的时间随着人的活动延长了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果选择的L模式，套接头接上面两个脚。也就是不可以重复触发，检测到人体，输出高电平一段时间，后续一小段时间内检测到也不再延长这个高电平时间，必须等到锁定时间过了才会再次检测。</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t018a1ed9091d0698ac.png" title="t017443a37571a99fcd.png" alt="http://p6.qhimg.com/t017443a37571a99fcd.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看出中间高电平的时间不是持续的。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">检测的代码很简单：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">代码:</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:cpp;toolbar:false">#include&nbsp;&lt;wiringPi.h&gt;&nbsp;
#include&nbsp;&lt;unistd.h&gt;&nbsp;
#include&nbsp;&lt;stdbool.h&gt;&nbsp;
#include&nbsp;&lt;stdio.h&gt;&nbsp;
#define&nbsp;INFRAREDPIN&nbsp;6&nbsp;
int&nbsp;main()&nbsp;
{&nbsp;
&nbsp;int&nbsp;AnyBodyHere=0;&nbsp;
&nbsp;wiringPiSetup();&nbsp;
//设置为输入模式
&nbsp;pinMode(INFRAREDPIN,INPUT);&nbsp;
&nbsp;//很重要。控制默认情况下此PIN处于下拉低电平状态
&nbsp;pullUpDnControl(INFRAREDPIN,PUD_DOWN);&nbsp;
&nbsp;while(true)&nbsp;
&nbsp;{&nbsp;
&nbsp;&nbsp;//每一秒检测依次状态
&nbsp;&nbsp;delay(1000);&nbsp;
&nbsp;&nbsp;//读取当前pin的输入状态
&nbsp;&nbsp;AnyBodyHere=digitalRead(INFRAREDPIN);&nbsp;
&nbsp;&nbsp;if(AnyBodyHere)&nbsp;
&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;There&nbsp;is&nbsp;somebody&nbsp;here\n&quot;);&nbsp;
&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;else&nbsp;
&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;There&nbsp;is&nbsp;no&nbsp;one&nbsp;here\n&quot;);&nbsp;
&nbsp;&nbsp;}&nbsp;
&nbsp;}&nbsp;
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们稍微修改一下。在检测到人体的时候使用第五节的beep函数执行报警的操作，这里我们选择使用H模式，持续感应，感应到以后使用beep发声。这样就简单实现了人体感应后自动报警。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">具体代码下载<span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);">infrared.c</span>参考。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">物联网温湿度监控</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这一节用温湿度传感器接入中移动物联网上报家中的温湿度。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1. dht11传感器使用简介</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">DHT11数字温湿度传感器是一款含有已校准数字信号输出的温湿度复合传感器。我购买的dht11只有三个针脚分别是 VCC &nbsp;DATA GND，(有些是四阵脚的,多一个NC空脚)。</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t0120f2bfa260f8a28e.jpg" title="t01fca32385b495343d.jpg" alt="http://p5.qhimg.com/t01fca32385b495343d.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">常用电路图：</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t01aa72261a3454c467.png" title="t01c72cae385487647d.png" alt="http://p1.qhimg.com/t01c72cae385487647d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">前面我们已经玩了一些常用模块，接线都比较熟悉了。正极接3.3V，负极接GND，DATA(OUT)针脚我接了物理的11号针脚，对应于WiringPi标号是0,同时为DATA针脚接入一个5K欧姆的上拉电阻，使得空闲状态的时候为高电平。</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t01e2b6ce291acc00e9.png" title="t01c734a3c7ead6ab2e.png" alt="http://p3.qhimg.com/t01c734a3c7ead6ab2e.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于之前使用的一些模块，我们只需要知道高低电平就可以了，现在要得到的是温度和湿度的具体数据，那么如何通过DATA针脚得到温度和湿度呢？通过DATA针脚采用单总线格式进行数据通讯。依次完整的数据传输为40bit，先读出来的是高位的数据。40bit数据的格式是：8bit湿度整数数据+8bit湿度小数数据+8bit温度整数数据+8bit温度小数数据+8bit校验和。如果数据是准确的，那么8bit湿度整 8bit湿度整数数据+8bit湿度小数数据+8bit温度整数数据+8bit温度小数数据的结果的末8位等于8bit校验和。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">通讯过程如下，主机首先向传感器发送开始信号，等开始信号发送完毕以后。dht11发送响应信号，依次传回40bit的数据，随后进入空闲状态。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">沟通握手过程如下，初始空闲状态DATA为高电平，主机将DATA拉低等待DHT11响应，拉低的时间必须大于18ms保证DHT11可以检测到这个状态。随后dht11等待开始信号结束，主机可以通过拉高电平20-40us表明信号结束。以后就可以准备读取dht11的响应信号了。dht11会发送80us的低电平来响应然后dht11再次将电平拉高持续80us表示后面的数据传输要开始了。</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t01ed15e2969467e6bc.jpg" title="t01443bea99c857bd10.jpg" alt="http://p2.qhimg.com/t01443bea99c857bd10.jpg"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">通讯过程如下：dht11每次传输1bit数据的过程是先拉低电平50us。随后拉高电平，高电平的时间长短决定了这1bit的数据是0还是1。当最后一个bit的数据传输完毕以后，dht11拉低电平50ms。随后上拉电阻拉高进入空闲状态。一次数据传输过程完毕。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">传输0的过程：</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t013d73be62e240d619.png" title="t01f3370c2482c218ca.png" alt="http://p9.qhimg.com/t01f3370c2482c218ca.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">传输1的过程：</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t0158a0b6b0950ed189.png" title="t0153f8f732b052598d.png" alt="http://p5.qhimg.com/t0153f8f732b052598d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">关键部分代码如下。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">代码:</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:cpp;toolbar:false">/*
当检测到的状态不是state的时候就返回。
如果参数state是HIGH，那么需要等到检测到LOW的时候返回。
返回值代表了状态改变所用的时间计数。
返回值如果是-1&nbsp;表明和设备通讯出现了错误，需要重新开始通讯。
*/
int&nbsp;loopCheckUntilStateChange(int&nbsp;state)
{
&nbsp;&nbsp;//初始时间计数为0
&nbsp;&nbsp;int&nbsp;count=0;
&nbsp;&nbsp;//读取针脚的状态
&nbsp;&nbsp;while(digitalRead(DHT11PIN)==state)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//如果状态没变那么计数加1
&nbsp;&nbsp;&nbsp;&nbsp;count++;
&nbsp;&nbsp;&nbsp;&nbsp;//如果计数超过了最大的计数，表明通讯错误，需要重新开始
&nbsp;&nbsp;&nbsp;&nbsp;if(count&gt;MAX_COUNT)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;
&nbsp;&nbsp;&nbsp;&nbsp;//延时1微秒。
&nbsp;&nbsp;&nbsp;&nbsp;delayMicroseconds(1);
&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;return&nbsp;count;
}
/*
读取DHT11。如果读取成功，返回true，否则false。将温度放到&nbsp;ptemp，将湿度放到
phumi
*/
bool&nbsp;readDHT11(float*&nbsp;ptemp,float*&nbsp;phumi)
{
&nbsp;&nbsp;int&nbsp;count=0,ibit=0;
&nbsp;&nbsp;bool&nbsp;bret=false;
&nbsp;&nbsp;//保存电平改变所用的时间计数
&nbsp;&nbsp;int&nbsp;bitsz[40]={0};
&nbsp;&nbsp;//保存读取到的4个温湿度数据和1个校验码
&nbsp;&nbsp;int&nbsp;data[5]={0};
&nbsp;&nbsp;//首先设置为输出模式
&nbsp;&nbsp;pinMode(DHT11PIN,OUTPUT);
&nbsp;&nbsp;//写入低电平
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digitalWrite(DHT11PIN,LOW);
&nbsp;&nbsp;//低电平至少持续18ms。保证能够DHT检测到这个初始信号
&nbsp;&nbsp;delay(20);
&nbsp;&nbsp;//随后主机将电平拉高，通知DHT信号结束
&nbsp;&nbsp;digitalWrite(DHT11PIN,HIGH);
&nbsp;&nbsp;//将针脚转为输入模式，等待DHT的响应。
&nbsp;&nbsp;pinMode(DHT11PIN,INPUT);
&nbsp;&nbsp;//经过20-40us，我们需要等待DHT将电平从高电平拉低
&nbsp;&nbsp;if(loopCheckUntilStateChange(HIGH)&lt;0)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;}
&nbsp;&nbsp;//DHT的响应信号低电平持续80us，等待DHT再次由低拉高
&nbsp;&nbsp;if(loopCheckUntilStateChange(LOW)&lt;0)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;}
&nbsp;&nbsp;//高电平将持续80us,等待DHT将高电平拉低。开始传输数据
&nbsp;&nbsp;if(loopCheckUntilStateChange(HIGH)&lt;0)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;}
&nbsp;&nbsp;//数据传输开始。每次传输一个bit。一共40bit。5字节
&nbsp;&nbsp;for(ibit=0;ibit&lt;40;ibit++)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//每个bit传输由50us的低电平开始。变为高电平就是开始传输0或者1了。
&nbsp;&nbsp;&nbsp;&nbsp;if(loopCheckUntilStateChange(LOW)&lt;0)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;//这次我们要检测高电平到低电平经过了多少个计数的count
&nbsp;&nbsp;&nbsp;&nbsp;//以此来决定这一bit是0还是1
&nbsp;&nbsp;&nbsp;&nbsp;count=loopCheckUntilStateChange(HIGH);
&nbsp;&nbsp;&nbsp;&nbsp;//如果小于0，出错了
&nbsp;&nbsp;&nbsp;&nbsp;if(count&lt;0)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;//将高电平持续的count保存在bitsz里面。
&nbsp;&nbsp;&nbsp;&nbsp;bitsz[ibit]=count;
&nbsp;&nbsp;}
/*
定义了区别&nbsp;0&nbsp;和1&nbsp;的count&nbsp;阈值。这个阈值要根据实际情况和你写的函数调整。
比如&nbsp;loopCheckUntilStateChange里面如果没有delayMicroseconds(1);完全跑CPU，那么count值会比较大。
如果有delayMicroseconds(1)那么这个值会小一些。
*/
#define&nbsp;THRESHOLD&nbsp;20
&nbsp;&nbsp;for(ibit=0;ibit&lt;40;ibit++)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;/*
&nbsp;&nbsp;&nbsp;&nbsp;将data左移1位，因为ibit的传输是从高位到低位
&nbsp;&nbsp;&nbsp;&nbsp;每次填充后就要移动一次。
&nbsp;&nbsp;&nbsp;&nbsp;ibit/8&nbsp;确定是第几个data
&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;data[ibit/8]&lt;&lt;=1;
&nbsp;&nbsp;&nbsp;&nbsp;/*
&nbsp;&nbsp;&nbsp;&nbsp;根据传输时高电平占用时间的count来确定这个bit是0还是1
&nbsp;&nbsp;&nbsp;&nbsp;THRESHOLD阈值根据不同的情况来确定，1的时间长，count大。0的时间短。count小。确定
&nbsp;&nbsp;&nbsp;&nbsp;一个中间的值即可&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;if(bitsz[ibit]&gt;THRESHOLD)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果超过了阈值。说明这一位是1。否则什么都不做。默认就是0了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data[ibit/8]|=1;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
&nbsp;&nbsp;//检查校验码。查看整个数据是否传输准确了
&nbsp;&nbsp;if(data[4]!=(data[3]+data[2]+data[1]+data[0])&amp;0xff)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;bret;
&nbsp;&nbsp;}
&nbsp;&nbsp;/*
&nbsp;&nbsp;由于dht11设备默认小数位为0，没有小数位.所以这里小数位就不要了。只有整数位的温度和湿度。
&nbsp;&nbsp;否则就是(%d.%d&nbsp;data[0].data[1])湿度&nbsp;(%d.%d&nbsp;data[2].data[3])温度
&nbsp;&nbsp;*/
&nbsp;&nbsp;*ptemp=data[2]*1.0;
&nbsp;&nbsp;*phumi=data[0]*1.0;
&nbsp;&nbsp;return&nbsp;true;
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">THRESHOLD和 MAX_COUNT的确定要根据实际的代码来修改。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">比如THRESHOLD，如果loopCheckUntilStateChange 没有delayMicroseconds(1)。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">count=loopCheckUntilStateChange(HIGH);打印40次</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">得到的count结果如下。</span></p><p style="text-align:center"><img src="http://p5.qhimg.com/t018bfdbbda0500b44d.png" title="t0192f8ff2ec95fc2e6.png" alt="http://p1.qhimg.com/t0192f8ff2ec95fc2e6.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可以看到count基本分为两类。一类是120-130左右，一类是370-380左右。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此代表0的26-28us的高电平时间对应的count就是120-130 ，代表1的70us的高电平count就是370-380。所以阈值可以设置为200。超过200就是1。小于200就是0。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果加上了delayMicroseconds(1)。那么40次count的结果如下，前面指令都是跑CPU，因此count比较大，这里延时了1us，count就变小了。</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t01d5fd43f465f2f81c.png" title="t018d79f4b72fce1098.png" alt="http://p8.qhimg.com/t018d79f4b72fce1098.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">明显看到一类是 10 左右，代表传输0。一类是30左右,代表传输1。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此阈值设置为20。大于20是1，小于20是0。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这一部分代码的数据读取准确度不是很高，可能还需要稍作调整使得读取准确率更高，我是按照最好理解的方式写的。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2. 接入中移动的物联网开放平台</span></strong></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><a href="http://open.iot.10086.cn" _src="http://open.iot.10086.cn">http://open.iot.10086.cn</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">/ 是中移动推出的物联网平台，开放一些免费的接口可以开发应用，具体可以去官网查看更多资料，篇幅有限就不多介绍了，<a href="http://open.iot.10086.cn/doc/" _src="http://open.iot.10086.cn/doc/">http://open.iot.10086.cn/doc/</a>里面有详细文档文档。下面简单介绍一下使用步骤。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">主要步骤参考<a href="http://open.iot.10086.cn/doc/art190.html#43" _src="http://open.iot.10086.cn/doc/art190.html#43">http://open.iot.10086.cn/doc/art190.html#43</a></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">1. 注册账号并登陆。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">2. 页面中进入开发者中心，并创建一个产品。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t01389a491369be2e5d.png" title="t01cb65a79d06404c4b.png" alt="http://p1.qhimg.com/t01cb65a79d06404c4b.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">创建产品。</span></p><p style="text-align:center"><img src="http://p5.qhimg.com/t01d116e426eb09103a.png" title="t018b0ec460e45a8546.png" alt="http://p9.qhimg.com/t018b0ec460e45a8546.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">填写简单资料。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01130077a68009c48b.png" title="t0174cde24a344ea91b.png" alt="http://p0.qhimg.com/t0174cde24a344ea91b.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">其他的默认，并且使用http传输协议数据。</span></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3. 添加一个设备</span></strong></p><p style="text-align:center"><img src="http://p4.qhimg.com/t0196973ca8f3103b1f.png" title="t016482c54832c0cb79.png" alt="http://p2.qhimg.com/t016482c54832c0cb79.png"/></p><p style="text-align:center"><img src="http://p4.qhimg.com/t01b77f91c8356ce151.png" title="t0170e10774397a3038.png" alt="http://p9.qhimg.com/t0170e10774397a3038.png"/></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4. 为设备添加数据流</span></strong></p><p style="text-align:center"><img src="http://p2.qhimg.com/t01768adde9b33387b4.png" title="t018719cd995fb0d1a3.png" alt="http://p7.qhimg.com/t018719cd995fb0d1a3.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">点开设备。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t01f85cd93545684fae.png" title="t01c827b445f781cce0.png" alt="http://p2.qhimg.com/t01c827b445f781cce0.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">操作栏中点击添加数据流。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t017a62e81c2579722f.png" title="t01153cfcf565d13dc5.png" alt="http://p4.qhimg.com/t01153cfcf565d13dc5.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">注意数据流的id用英文比较好。后续我们post数据需要用这个英文的id，中文容易出各种编码问题。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们添加两个。一个是humi 湿度。一个是temp温度。</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t0158b3659cf13765b8.png" title="t012e38000254efe0ab.png" alt="http://p0.qhimg.com/t012e38000254efe0ab.png"/></p><p style="text-indent: 2em; text-align: left;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5. 添加一个应用</span></strong></p><p style="text-align:center"><img src="http://p8.qhimg.com/t01f8fbf2d103fc1d82.png" title="t01fbef43b0b9a4171a.png" alt="http://p6.qhimg.com/t01fbef43b0b9a4171a.png"/></p><p style="text-align:center"><img src="http://p0.qhimg.com/t010b154a7130cb80fc.png" title="t01749cd9f60c31de7c.png" alt="http://p6.qhimg.com/t01749cd9f60c31de7c.png"/></p><p style="text-align:center"><img src="http://p3.qhimg.com/t0114bc7628dfb46373.png" title="t0177f38872c3920eab.png" alt="http://p2.qhimg.com/t0177f38872c3920eab.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">添加两个仪表盘。设备选择raspberry，数据流一个选择humi,一个选择temp。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0197f85e321a5c19be.png" title="t0120e121cf3536936a.png" alt="http://p3.qhimg.com/t0120e121cf3536936a.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">保存应用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">web端的设置基本上就完毕了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">参看<a href="http://open.iot.10086.cn/doc/art190.html#43" _src="http://open.iot.10086.cn/doc/art190.html#43">http://open.iot.10086.cn/doc/art190.html#43</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">的协议文档。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了上传温度和湿度，我们需要几个关键的数据。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">1. 设备id。这个从设备详情页可以拿到。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">2. appkey 。这个可以从appkey页面使用默认的</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0125e16911af644ec5.png" title="t01c02002056226f6fe.png" alt="http://p2.qhimg.com/t01c02002056226f6fe.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">3. 数据的id。也就是之前添加数据流的时候使用的humi和temp。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们需要post的数据类似于</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);"></span></p><pre class="brush:plain;toolbar:false">POST&nbsp;/devices/YOURDEVICEID/datapoints?type=3&nbsp;HTTP/1.1
Host:api.heclouds.com
api-key:YOURAPIKEY
content-type:application/json
{
&nbsp;&nbsp;“temp”:25,“humi”:60
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用libcurl关键部分代码如下(记得替换YOURDEVICEID 以及YOURAPPKEY )。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">代码:</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:cpp;toolbar:false">#define&nbsp;POST_URL&nbsp;&quot;http://api.heclouds.com/devices/YOURDEVICEID/datapoints?type=3&quot;
void&nbsp;postData(float&nbsp;temp,float&nbsp;humi)
{
&nbsp;&nbsp;CURL&nbsp;*curl;
&nbsp;&nbsp;char&nbsp;jsonData[512];
&nbsp;&nbsp;struct&nbsp;curl_slist*&nbsp;header=NULL;
&nbsp;&nbsp;printf(&quot;humi=%.2f&nbsp;temp=%.2f\n&quot;,humi,temp);
&nbsp;&nbsp;curl&nbsp;=&nbsp;curl_easy_init();&nbsp;&nbsp;
&nbsp;&nbsp;curl_easy_setopt(curl,&nbsp;CURLOPT_URL,&nbsp;POST_URL);&nbsp;&nbsp;
&nbsp;&nbsp;header=curl_slist_append(NULL,&quot;api-key:YOURAPPKEY&quot;);
&nbsp;&nbsp;curl_slist_append(header,&quot;content-type:application/json&quot;);
&nbsp;&nbsp;sprintf(jsonData,&quot;{\&quot;temp\&quot;:\&quot;%.2f\&quot;,\&quot;humi\&quot;:\&quot;%.2f\&quot;}&quot;,temp,humi);
&nbsp;&nbsp;curl_easy_setopt(curl,&nbsp;CURLOPT_POSTFIELDS,&nbsp;jsonData);&nbsp;
&nbsp;&nbsp;curl_easy_setopt(curl,&nbsp;CURLOPT_WRITEFUNCTION,&nbsp;showResponse);&nbsp;
&nbsp;&nbsp;curl_easy_setopt(curl,&nbsp;CURLOPT_HTTPHEADER,&nbsp;header);&nbsp;&nbsp;
&nbsp;&nbsp;curl_easy_setopt(curl,&nbsp;CURLOPT_COOKIEFILE,&nbsp;&quot;/tmp/iotpost.cookie&quot;);&nbsp;&nbsp;
&nbsp;&nbsp;curl_easy_perform(curl);&nbsp;
&nbsp;&nbsp;curl_slist_free_all(header);
&nbsp;&nbsp;curl_easy_cleanup(curl);
};
//如果将上传的结果打印出来
size_t&nbsp;showResponse(void&nbsp;*buffer,&nbsp;size_t&nbsp;size,&nbsp;size_t&nbsp;nmemb,&nbsp;void&nbsp;*userp)
{
&nbsp;&nbsp;char*&nbsp;response=NULL;
&nbsp;&nbsp;if(!buffer||!size||!nmemb)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;no&nbsp;response\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;}
&nbsp;&nbsp;response=(char*)malloc(size*nmemb+1);
&nbsp;&nbsp;memcpy(response,buffer,size*nmemb);
&nbsp;&nbsp;response[size*nmemb]=0;
&nbsp;&nbsp;printf(&quot;response:&nbsp;%s\n\n&quot;,response);
&nbsp;&nbsp;free((void*)response);
};</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">如果成功会输出：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 176, 80);"></span></p><pre class="brush:plain;toolbar:false">{
&quot;errno&quot;:&nbsp;0,
&quot;error&quot;:“succ”,
}</pre><p style="text-align:center"><img src="http://p8.qhimg.com/t017b8861cf5f73c03a.png" title="t016378e25f7fa8b63d.png" alt="http://p5.qhimg.com/t016378e25f7fa8b63d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用libcurl发送post请求。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">首先需要安装libcurl</span></p><pre class="brush:plain;toolbar:false">sudo&nbsp;apt-get&nbsp;install&nbsp;libcurl4-gnutls-dev</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">编译的时候也要加上-lcurl</span></p><pre class="brush:plain;toolbar:false">gcc&nbsp;-o&nbsp;dht11&nbsp;dht11.c&nbsp;-lwiringPi&nbsp;-lcurl</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">具体的代码参看<span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(0, 176, 80);">dht11.c</span></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果成功提交post数据。可以在应用的页面看到你家庭的温度和湿度。将发布链接转给别人，人家就能看到你家庭的温度湿度了。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t018c691fe7ddc0264f.png" title="t018863a5f3e41f3b3d.png" alt="http://p9.qhimg.com/t018863a5f3e41f3b3d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">附件</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">infrared.c：</span><a href="https://yunpan.cn/cvxEVQghJVqZW" _src="https://yunpan.cn/cvxEVQghJVqZW" style="text-indent: 2em; white-space: normal; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-decoration: none;">https://yunpan.cn/cvxEVQghJVqZW</a><span style="text-indent: 2em; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（提取码：906c）</span><span style="text-indent: 2em;"></span></p><p style="text-indent: 2em; text-align: left;"><span style="text-indent: 2em; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-decoration: none;">dht11.c：<a href="https://yunpan.cn/cvx5JxcQwdDGm" target="_self">https://yunpan.cn/cvx5JxcQwdDGm</a></span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">（提取码：63ce）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></p><p style="white-space: normal; text-indent: 2em;"><strong><span style="line-height: 25px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; background-color: rgb(255, 255, 255);">传送门</span></strong></p><hr style="white-space: normal;"/><p style="white-space: normal;"><a href="http://bobao.360.cn/learning/detail/3051.html" _src="http://bobao.360.cn/learning/detail/3051.html"></a></p><p style="margin-top: 0px; margin-bottom: 0px; white-space: normal; padding: 0px; font-size: 18px; line-height: 32px; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); text-decoration: underline;"></span></p><p style="white-space: normal; text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3085.html" target="_blank" textvalue="【技术分享】初玩树莓派B（一） 基本介绍&amp;安装操作系统" style="text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（一） 基本介绍&amp;安装操作系统</strong></span></a></p><p style="white-space: normal; text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3087.html" target="_blank" style="text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（二） 实用配置(vnc和串口)&amp;GPIO操作点亮LED灯</strong></span></a></p><p style="text-indent: 2em;"><a href="http://bobao.360.cn/learning/detail/3093.html" target="_blank" style="text-indent: 32px; white-space: normal; text-decoration: none;"><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><strong>【技术分享】初玩树莓派B（三） 控制蜂鸣器演奏乐曲</strong></span></a></p><p style="text-align: center; text-indent: 0em;"><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 IamHuskar@看雪论坛<br/><a class="text-more" href="http://bbs.pediy.com/showthread.php?t=212957" target="_blank">原文链接：http://bbs.pediy.com/showthread.php?t=212957</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】初玩树莓派B（四） 人体红外感应报警&物联网温湿度监控 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3096" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
