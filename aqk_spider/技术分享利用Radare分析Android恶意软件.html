<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】利用Radare分析Android 恶意软件 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="Radare,Android 恶意软件,Koodous"/>
    
        <meta name="description" content="本文将以Triada木马作为样本，详细介绍如何使用Radare分析Android恶意软件分析。通过阅读本文，您将了解如何使用Radare2反汇编Android二进制文件，如何识别可疑或恶意应用程序的行为，以及Radare2在分析Android恶意软件方面的优缺点。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】利用Radare分析Android 恶意软件</h2>
                <div class="article-msg">
                    <span class="time">2016-11-25 10:04:21</span>
                    
                                        <span class="read">阅读：23036次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3220"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3220" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://www.nowsecure.com/blog/2016/11/21/android-malware-analysis-radare-triada-trojan/"
                             target="_blank">来源： nowsecure</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2522399780" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2522399780" style="color:#848e99;">shan66</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p5.qhimg.com/t011e54182e92eb4e92.jpg" title="t01befca877c28e3944.jpg" alt="http://p9.qhimg.com/t01befca877c28e3944.jpg"/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">翻译：</span></strong></span><a href="http://bobao.360.cn/member/contribute?uid=2522399780" target="_blank" style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192); text-decoration: none;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192);"><strong>shan66</strong></span></a></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">稿费：200RMB（不服你也来投稿啊！）</span></strong></span></p><p style="white-space: normal; text-indent: 2em;"><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">投稿方式：发送邮件至linwei#360.cn，或登陆</span></strong></span><a href="http://bobao.360.cn/contribute/index" target="_blank" style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192); text-decoration: none;"><strong>网页版</strong></a><span style="font-size: 18px; color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在线投稿</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">前言</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(255, 0, 0);">本文将以Triada木马作为样本，详细介绍如何使用Radare分析Android恶意软件分析。</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">通过阅读本文，您将了解如何使用Radare2反汇编Android二进制文件，如何识别可疑或恶意应用程序的行为，以及Radare2在分析Android恶意软件方面的优缺点。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">识别可疑的安卓应用&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Android恶意软件的样本并不少见，但我想要的，是那些有趣的样本。为此，我到Android恶意软件研究平台Koodous上面搜索了一下关键词“free download”，并找到一个名为“Free Youtube Video Download”的应用程序。该应用程序立刻引起了我的怀疑，因为它的截屏都是来自另一个应用程序，并且官方图标被换了。于是，我下载了该程序，开始我的分析之旅。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192);"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">目标：判断可疑Android应用是否为恶意软体&nbsp;</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在评估可疑文件的时候，最好首先了解一下其他人是否已经研究过这个文件，具体方法是使用病毒解决方案（如VirusTotal）来扫描这个文件。于是，我上传了这个样本，VirusTotal报告的检测率为34/55，并将其标识为Triada Android木马。很明显，该应用程序已经被感染。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">但是别忘了，反病毒技术有时也会出现误判，因为恶意软件的发展速度很快，经常把反病毒供应商的启发式或签名过滤技术甩在后面。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了从反病毒引擎之外进一步收集更多信息，我又利用YARA规则对这个样本进行了检查，这里使用的是来自Koodous团队编写的Androguard YARA模块。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">虽然该样本是在2016年3月发现的，但是到目前为止，仍然没有公开可用的技术分析报告。当时，卡巴斯基实验室将Triada列为当前最先进的Android恶意软件，并将其与Windows恶意软件的复杂性进行了相应的比较。若要进一步了解该恶意软件所使用的感染技术，请参阅文章“Attack on Zygote: a new twist in the evolution of mobile threats”。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于我打算深入研究这个应用，所以在Koodous的搜索框中使用相同的YARA规则继续搜索更多的样本，并找到了另外三个与该规则相匹配的.apks。虽然我收集到了符合YARA规则的多个样本，但我不能确定它们是否属于同一系列的变体。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">探索Android恶意软件的功能&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在分析可疑的Android应用时，我们需要评估以下因素：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">混淆技术：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">混淆不仅可以用于保护知识产权，同时还会被用于隐藏恶意代码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">过多的权限：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果该应用要求过多的权限，它可能只是开发者的无心之过，同时，也可能是攻击者为了不可告人的目的故意而为之。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">设备上的奇怪文件：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">可能是垃圾文件、二进制资源或加密的有效荷载。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">模拟器检测：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">需要对这个应用程序打补丁或使用实际设备进行分析。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">仅限ARM使用的库：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使得该应用程序无法在x86模拟器上运行。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">指向系统二进制文件的字符串：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这可能是合法的root权限检测机制，也可能是提权利用代码的一部分。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">二进制文件中的硬编码的IP：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这些可能是用于测试服务器的IP地址，只是开发人员忘记删除了；也可能是（僵尸网络）命令和控制服务器的IP地址。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">指向APK的链接：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">开发人员可能忘记删除测试目的的这些链接，同时，这些链接也可能指向第二阶段的有效荷载。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">访问SMS/短信功能：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这可能是合法的，可用于双因素身份验证，同时，也可能用于恶意目的，例如未经授权的订阅付款服务或窃取银行付款的验证码等。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">篡改过的合法应用程序：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">恶意用户会定期修改合法应用，以便在其中保存/隐藏恶意软件的有效荷载。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">应用程序来源的可靠性：</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果这个.apk来自其他Android市场或是未知的，那么你不知道该应用程序是否经过了相应的安全审查。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果该应用程序的来源非常可疑，那么您应该信任来自官方市场（通常会记录其审核过程）的应用程序版本，同时，要对来源可疑的应用展开更深入的分析，以检查是否存在恶意的意图。同样，如果应用程序要求过多的权限，那就要提高警惕，避免安装它，并做更多的分析。我们不妨从手动分析.apk中的文件开始下手，这样能够帮助我们了解该应用程序的意图和功能。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当您分析恶意软件样本时，需要确定哪些代码是原始应用程序的一部分而不是恶意软件本身，哪些代码是保护程序、广告或跟踪系统，这将是一个非常大的挑战。通常在同一应用程序中会发现大量统计SDK，它们通常用于收集有关设备和用户行为的各种数据。此外，你还会发现许多在引导期间启动的各种服务，每次重新启动后都会启动它们。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本例中，我发现该样本生成了一个JSON文件，它会枚举所有已经安装的、具有NFC的主机卡仿真（HCE）权限的应用程序。此外，该样本还会动态加载两个加密的blob，并引用具有APK Protect保护的另一个.apk。要想提取这些代码片断需要进行动态分析，所以我计划在将来的文章中进行相应的介绍。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t016c6ea3cd091b2fd2.png" title="t0162ec8df69bab0b93.png" alt="http://p5.qhimg.com/t0162ec8df69bab0b93.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">详尽的分析工作已经超出了本文的范围，不过我将给出完整的分析过程，读者可以以此作为起点，进行更深入分析。我将介绍的步骤包括：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1.	提取有关恶意软件的详细信息，如权限列表、二进制文件类型、函数名称、导入的符号、类、二进制文件中包含的字符串等。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.	针对应用程序中的可疑二进制代码进行静态分析，以了解这些代码对第一步中识别出来的资源做了什么。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.	在基于QEMU的Android环境中对样本进行仿真，以跟踪程序的执行并识别系统事件和行为。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于大多数移动恶意软件无法在非ARM或模拟环境上运行，因此我直接在物理硬件设备上分析该样本代码，这些设备的固件是重新刷新过的，所以非常干净。</span></p><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">AndroidManifest.xml</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">虽然扩展名为.xml，但AndroidManifest.xml不是人类可读的文本形式。它是一种仅用于Android的二进制XML格式，您可以使用Ruby脚本Axml2xml.rb（也可通过r2pm -i axml2xml）将其转换为可读格式。</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t01c7b76260050134bb.png" title="t016cbf8928c91930ac.png" alt="http://p6.qhimg.com/t016cbf8928c91930ac.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">您还可以使用Radare中的rafind2程序从文件中提取感兴趣的字符串（请注意，这些字符串根本不工作）：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">$&nbsp;rafind2&nbsp;-ZS&nbsp;android&nbsp;AndroidManifest.xml
$&nbsp;rafind2&nbsp;-ZS&nbsp;permissions&nbsp;AndroidManifest.xml
$&nbsp;rafind2&nbsp;-ZS&nbsp;intent&nbsp;AndroidManifest.xml</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">恶意软件使用的一些常见权限包括：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">permission.CHANGE_WIFI_STATE
permission.CHANGE_NETWORK_STATE
permission.INSTALL_PACKAGES
permission.INSTALL_SHORTCUT
permission.SYSTEM_OVERLAY_WINDOW
permission.ACCESS_DOWNLOAD_MANAGER
permission.MOUNT_UNMOUNT_FILESYSTEMS
permission.RECORD_AUDIO
permission.RECEIVE_BOOT_COMPLETED
permission.KILL_BACKGROUND_PROCESSES
permission.ACCESS_MTK_MMHW
permission.DISABLE_KEYGUARD
permission.SYSTEM_ALERT_WINDOW/
permission.GET_TASKS
...</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Classes.dex</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">这个文件包含有该应用程序的Dalvik代码。所有应用程序的原始Java代码都转换为Dalvik并装配到DEX文件中，该文件可以在无堆栈的基于注册的虚拟机上运行。某些版本的Android将直接从.dex文件中模拟执行代码，另一些版本的Android将通过JIT技术将其转换为真正的机器代码，大多数现代版本的Android都会将大部分代码预编译为针对ART的AOT可执行代码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">您可以使用Radare2从.dex文件中提取信息，具体命令如下所示：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&gt;&nbsp;icq&nbsp;#&nbsp;enumerate&nbsp;classnames
&gt;&nbsp;iiq&nbsp;#&nbsp;imports&nbsp;(external&nbsp;methods)
&gt;&nbsp;ic&nbsp;#&nbsp;enumerate&nbsp;classes&nbsp;and&nbsp;their&nbsp;methods
&gt;&nbsp;izq&nbsp;#&nbsp;list&nbsp;all&nbsp;strings&nbsp;contained&nbsp;in&nbsp;the&nbsp;program</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">一个重要的提示是，请比较manifest文件所请求的权限和应用程序本身使用的权限之间的异同。在这种情况下，只要应用程序可以动态加载新代码，我们就无法了解其真正的目的，除非我们进行动态分析。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">检查classes.dex的导入信息，可以帮助我们了解应用程序使用哪些系统API。</span></p><pre class="brush:plain;toolbar:false">$&nbsp;rabin2&nbsp;-qi&nbsp;classes.dex&nbsp;|&nbsp;grep&nbsp;-i&nbsp;-e&nbsp;sms&nbsp;-e&nbsp;bluetooth&nbsp;-e&nbsp;install&nbsp;-e&nbsp;PackageManager&nbsp;-e&nbsp;Datagram&nbsp;-e&nbsp;Telephony&nbsp;-e&nbsp;nfc</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">此外，我们也可以使用dexdump来查看主dex中所有内容：&nbsp;</span></p><pre class="brush:plain;toolbar:false">$&nbsp;dexdump&nbsp;-d&nbsp;|&nbsp;grep&nbsp;‘“android.’&nbsp;|&nbsp;cut&nbsp;-d&nbsp;,&nbsp;-f&nbsp;2-&nbsp;|&nbsp;sort&nbsp;-u</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">一旦通过dexdump完成了反汇编，你就可以使用自己喜欢的编辑器，甚至纯grep来查找串常量调用了。但在Radare2中，您还可以使用/ r命令查找对字符串或方法的引用，以确定谁在使用这些可疑字符串及其目的了。</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t01a6c4d4629debddb7.png" title="t01ccf4c37f58eb1eff.png" alt="http://p9.qhimg.com/t01ccf4c37f58eb1eff.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对字符串进行过滤&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了过滤命令的输出，可以在Radare2的shell中使用~操作符。~操作类似于UNIX的grep实用程序，但它在内部运行，不需要任何单独的系统进程。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用以下字符串过滤器，您可以在classes.dex文件中找到一些有趣的东西：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">/system&nbsp;/data&nbsp;/bin/su&nbsp;…
http://
https://
.apk
%d.%d.%d.%d
Install
SMS
DexClassLoader&nbsp;InjectCall&nbsp;
application/vnd.android&nbsp;
==</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在恶意软件样本上进行字符串过滤之后，我发现了一些硬编码的IP，系统二进制文件（例如用于设备root检查的su）的路径，Dalvik代码注入调用，通常用于安装.apks的字符串，以及指向另一个名为 300010.apk的URL。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当反病毒软件供应商或研究人员发现链接到恶意软件的URL时，它们通常马上向相应的ISP发送禁用通知。此后，ISP将与托管恶意软件的服务器的所有者进行联系，或直接阻止这些服务器。所以我必须在300010.apk被删除之前得到它，只有这样才能进行进一步的分析。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于这个.apk使用了APK Protect进行保护，所以要想知道该应用程序正在做什么，必须对动态加载的代码进行解密。为此，我们可以求助于Android的脱壳工具。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这个.dex文件中，我还发现了一些base64编码的字符串，好在可以通过设置RABIN2_DEBASE64环境变量或在每个字符串上使用命令rax2 -D来自动解码。事实证明，一些base64编码字符串包含了二进制数据，其他则指向二进制文件内的一些有趣的位置，如loadLibrary()。</span></p><pre class="brush:plain;toolbar:false">$&nbsp;RABIN2_DEBASE64=1&nbsp;rabin2&nbsp;-qzz&nbsp;classes.dex</pre><p style="text-indent: 2em; text-align: left;"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对方法进行过滤&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Radare2的visual模式还支持交互式heads-up显示，能够从.dex文件中过滤所有的字符串、方法和类名。为了进入visual模式，请使用“V_”命令，并在visual模式下键入“_”。接下来，键入要突出显示的文本。当您按&lt;enter&gt;时，UI将跳转到反汇编器中的相应位置，以便您可以在上下文中查看相应文本。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">您可能想要搜索的一些相关文字包括：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">onReceive&nbsp;
Init&nbsp;
Password
Install
Dex
SMS</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">大多数时候，恶意软件都会利用ProGuard或其他模糊工具进行保护，这会使类/方法/字段名完全无用。在这种情况下，您需要深入分解或执行动态分析以恢复原始字符串，并了解每个方法的用途。</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t017425d55b5644555e.png" title="t014c686dfbcd7e1140.png" alt="http://p2.qhimg.com/t014c686dfbcd7e1140.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">进行反汇编&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">Radare2提供了一个visual模式（V命令）和Web用户界面（通过= H命令），从而允许您使用鼠标，同时与静态提示相比，具有更好的交互性。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了进行相应的分析，您可能需要将Radare2的输出与其他工具如Android SDK中dexdump -d的输出进行比较。在对付.dex二进制文件方面，Radare2是一个非常可靠的工具，所以当反编译和转码器无法使用是，它就是我们的不二之选。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t013311c605ce4a4ff8.png" title="t019e6249ba6cfdeef0.png" alt="http://p0.qhimg.com/t019e6249ba6cfdeef0.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">$&nbsp;r2pm&nbsp;-i&nbsp;dex2jar
$&nbsp;r2pm&nbsp;-r&nbsp;dex2jar&nbsp;classes.dex</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">一旦把.dex文件转换为Java类，我们就可以使用Radare2来反汇编JAR的内容了。通常来说，为相同代码建立多个视图以及阅读汇编代码未必是理解程序某些部分的最快方式，所以，您可能需要使用像jd-gui这样的反编译程序，这个程序是免费的，并且可以将所有的类同时加载到JAR文件。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">令人遗憾是，把Dalvik转换为Java字节码或反编译Java方法并不总是可行。许多工具都可能在自动拆卸时出现故障。因此，分析人员需要了解每个工具在反汇编方面的风险和弱点，并能够手动解决这些问题。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如，如果我们试图用dexdump反汇编300010.apk，我们将得到一个奇怪的分段错误（这个问题已经在Android 7 SDK中得到修复）：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;$&nbsp;dexdump&nbsp;-d&nbsp;classes.dex&nbsp;&nbsp;&gt;&nbsp;/dev/null
&nbsp;GLITCH:&nbsp;zero-width&nbsp;instruction&nbsp;at&nbsp;idx=0x0000
&nbsp;GLITCH:&nbsp;zero-width&nbsp;instruction&nbsp;at&nbsp;idx=0x0000
&nbsp;GLITCH:&nbsp;zero-width&nbsp;instruction&nbsp;at&nbsp;idx=0x0000
&nbsp;Segmentation&nbsp;fault:&nbsp;11</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">对Java的转译会部分失败：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;$&nbsp;r2pm&nbsp;-r&nbsp;dex2jar&nbsp;classes.dex&nbsp;2&gt;&amp;1&nbsp;|grep&nbsp;Error&nbsp;|&nbsp;wc&nbsp;-l
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40
Androguard将在异常后停止分析：&nbsp;
&nbsp;$&nbsp;androgui.py&nbsp;-i&nbsp;classes.dex
&nbsp;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):
&nbsp;&nbsp;&nbsp;File&nbsp;&quot;/Library/Python/2.7/site-packages/androguard/core/bytecodes/dvm.py&quot;,&nbsp;line&nbsp;7014,&nbsp;in&nbsp;get_raw_string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;self.__manage_item[&nbsp;&quot;TYPE_STRING_ID_ITEM&quot;&nbsp;][idx].get_string_data_off()
&nbsp;IndexError:&nbsp;list&nbsp;index&nbsp;out&nbsp;of&nbsp;range</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">有一次，在尝试利用IDA Pro打开.apk时候竟然导致了9,382个错误消息。在这样的情况下，像Radare2这样的低级反汇编程序可以帮上大忙。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">程序库&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">本机库通常使用JNI符号与Java进行交互，JNI符号在.apk的lib /子目录中的共享库中。这些库通常根据目标架构（例如，ARM，x86，ARM64，MIPS等）分为不同的子目录。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在本例中，我们只有ARM二进制文件，它们通常是在Thumb2模式下编译的。Radare2能够很好地加载这些二进制文件，但你的兴可能在ARM和Thumb模式之间上面：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&gt;&nbsp;e&nbsp;asm.bits=16&nbsp;&nbsp;#&nbsp;set&nbsp;thumb2&nbsp;mode
&nbsp;&gt;&nbsp;e&nbsp;asm.bits=32&nbsp;&nbsp;#&nbsp;set&nbsp;ARM&nbsp;mode</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">还有其他一些变量，如asm.cpu，在某些情况下对于正确进行反汇编非常有用，但这对大多数情况来说已经足够了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在visual模式中，我们还可以使用HUD模式（使用如前所述的&#39;_&#39;键）从二进制文件中收集信息，例如符号（isq），导入表（iiq）或字符串（izq）。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t01ed79230ddc3ed260.png" title="t01ccf4c37f58eb1eff.png" alt="http://p5.qhimg.com/t01ccf4c37f58eb1eff.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">运行这些命令后，您可以对程序库的用途进行有根据的猜测：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;lib/armeabi/libbspatch.so&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;bzip2&nbsp;+&nbsp;binary&nbsp;patch&nbsp;API,&nbsp;used&nbsp;by&nbsp;umeng&nbsp;API&nbsp;to&nbsp;update&nbsp;stuff
&nbsp;lib//armeabi/libcore.so&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;upay&nbsp;cryptography&nbsp;(Java_com_lem_sdk_util_CoreEnct_decrypt
&nbsp;lib//armeabi/libmagic.so&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;java&nbsp;code&nbsp;injection&nbsp;by&nbsp;using&nbsp;reflection&nbsp;methods</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">至少，它们看起来没有一个与下载YouTube视频有关。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了进行反汇编并理解代码正在做什么，你将需要模拟和分析代码。你也可以用Radare2做这些事情。Radare2的模拟功能是在ESIL（Evaluable Strings Intermediate Language）的基础上实现的，这是一个真正安全的虚拟机，与Dalvik或真正的硬件无关，所以你可以认为它就像静态分析一样安全。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">之所以利用模拟方法来反汇编ARM二进制文件，是因为一些指针是由多条指令计算得到的。这需要跟踪状态的变化并解析正确的字符串和方法引用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&gt;&nbsp;e&nbsp;asm.describe&nbsp;=&nbsp;true&nbsp;&nbsp;&nbsp;#&nbsp;show&nbsp;description&nbsp;of&nbsp;each&nbsp;ARM&nbsp;instruction
&nbsp;&gt;&nbsp;e&nbsp;asm.pseudo&nbsp;=&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;show&nbsp;pseudo&nbsp;instruction&nbsp;instead&nbsp;of&nbsp;assembly
&nbsp;&gt;&nbsp;e&nbsp;asm.emu&nbsp;=&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;emulate&nbsp;code&nbsp;using&nbsp;ESIL
&nbsp;&gt;&nbsp;e&nbsp;asm.emustr&nbsp;=&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;show&nbsp;string&nbsp;and&nbsp;method&nbsp;referenced&nbsp;in&nbsp;the&nbsp;emu&nbsp;comments
&nbsp;&gt;&nbsp;e&nbsp;anal.hasnext=true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;assume&nbsp;a&nbsp;new&nbsp;function&nbsp;is&nbsp;found&nbsp;after&nbsp;the&nbsp;last&nbsp;one</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">下面给出一些对恶意软件分析比较有帮助的命令，包括：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;&gt;&nbsp;aa&nbsp;&nbsp;-&nbsp;分析所有公共符号（使用aaa或aaaa等！）&nbsp;
&nbsp;&gt;&nbsp;afr&nbsp;&nbsp;-&nbsp;递归式的分析函数&nbsp;
&nbsp;&gt;&nbsp;aae&nbsp;&nbsp;-&nbsp;分析使用ESIL模拟计算的得到的所有代码引用&nbsp;
&nbsp;&gt;&nbsp;aac&nbsp;&nbsp;-&nbsp;分析所有函数调用的目的地</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">如果您对该代码的更高级的版本感兴趣，可以使用Radare2中的Retargetable Decompiler软件包，来充分利用<a href="http://www.retdec.com" _src="http://www.retdec.com">www.retdec.com</a>上提供的在线反编译服务。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t011c0b4394e7cb76c6.png" title="t01cf3e6bd09e27e7c6.png" alt="http://p0.qhimg.com/t01cf3e6bd09e27e7c6.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">完整的classes.dex引用径向图&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">资源文件&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">.apk文件包含了应用程序在运行时加载的几个配套文件。一些资源文件是图像，另一些是描述用户界面的XML文件。在恶意软件分析期间，您可能会发现可疑的配套文件，您想要仔细看看。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">您可以使用Radare2中的pm命令或文件工具，通过每个文件的魔法头部信息（the magic header information）来猜测文件的类型：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">&nbsp;$&nbsp;find&nbsp;.&nbsp;-type&nbsp;f&nbsp;-exec&nbsp;r2&nbsp;-qnci~^file&nbsp;-cpm&nbsp;‘{}’&nbsp;‘;’
&nbsp;$&nbsp;file&nbsp;assets/*</pre><p style="text-align:center"><img src="http://p9.qhimg.com/t01458af86990ca2f94.png" title="t01aa9a3e436410225f.png" alt="http://p0.qhimg.com/t01aa9a3e436410225f.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">之所以使用Radare2而不是GNU的内部魔法实现，主要是因为已知libmagic文件的某些漏洞可用于运行代码或使分析无效。RedHat在今年夏天修补了这个问题，但是其他一些发行版和Docker镜像仍然存在这个漏洞。Radare2的libmagic的实现来自OpenBSD，已经经过了fuzzed处理，同时得到了相应的加固处理。根据我的经验，Radare2更可靠，并且更容易修改——如果需要的话。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">除了pm命令，我们还可以使用/m命令，它将在每个偏移量上运行pm，以在原始文件上找到已知的魔法签名。这对于从内存转储、内核镜像等中切割文件很有用。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">当我考察包含在这个恶意软件样本中的文件的时候，我发现一些带有.png扩展名的文件似乎含有加密的数据。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">结论：Android木马Triada的功能&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在使用Google搜索其他研究人员发布的关于Tirada Android木马后，我开始了解这个恶意软件所带来的真正风险，以及它是如何危害用户的了：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">获取设备Root权限并更改Zygote&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">恢复出厂设置无法删除该恶意软件&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">似乎是针对KitKat之前的版本，但实际上会影响所有版本&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">可以通过一些模块化漏洞利用代码来提高权限&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">到目前为止，我已经解释了如何针对某些目标进行非常基本的静态分析。作为分析工作的一部分，我已经可以肯定这是一个模块化病毒，能够在运行时下载更多的二进制文件和应用程序。但是，我们对这个恶意软件的了解还远远不够，在加密组件、运行时加载的代码、其他应用程序的安装、网络通信等方面，仍有待我们进一步深入分析研究。</span></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://www.nowsecure.com/blog/2016/11/21/android-malware-analysis-radare-triada-trojan/" target="_blank">原文链接：https://www.nowsecure.com/blog/2016/11/21/android-malware-analysis-radare-triada-trojan/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】利用Radare分析Android 恶意软件 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3220" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
