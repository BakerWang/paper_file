<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>CS游戏分析第一回——如何做到孤独求败 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords"
          content="bobao,漏洞,漏洞平台,漏洞公告,漏洞信息,安全资讯,安全新闻,安全会议,安全知识,攻防大赛,安全大赛,黑客大赛,安全沙龙,vulnerability,exploit,安全趋势"/>
    
        <meta name="description" content="前言游戏安全一直是敏感的灰色话题，很多技术不会公开，从事游戏攻防的也很低调。这造成一个问题，对游戏安全感兴趣的人会无从下手，比如我，就不知道面对复杂的游戏如何分析。经过一些日子的思考学习，总算有了点思"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>CS游戏分析第一回——如何做到孤独求败</h2>
                <div class="article-msg">
                    <span class="time">2014-12-05 17:52:31</span>
                                        <span class="read">阅读：21510次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_125"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="125" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href=""
                             target="_blank">来源： 360安全播报</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><span style="color: rgb(0, 176, 240); font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; line-height: 30px; text-indent: 28px; background-color: rgb(255, 255, 255);">感谢白帽子<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">@</span><span style="font-family: 微软雅黑,&quot;Microsoft YaHei&quot;; font-size: 14px; line-height: 30px; text-indent: 28px; background-color: rgb(255, 255, 255); color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 255, 255); font-family: 微软雅黑,&quot;Microsoft YaHei&quot;; font-size: 14px; line-height: 30px; text-indent: 28px;">0x01</span>f</span>的投稿，</span><span style="color: rgb(0, 176, 240); font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; line-height: 30px; text-indent: 32px; background-color: rgb(255, 255, 255);">以下内容供安全爱好者参考学习，本文获得投稿奖励500元，即将打入作者账户，投稿请发送邮件至 huangyuan#360.cn。</span></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>前言</strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">游戏安全一直是敏感的灰色话题，很多技术不会公开，从事游戏攻防的也很低调。这造成一个问题，对游戏安全感兴趣的人会无从下手，比如我，就不知道面对复杂的游戏如何分析。经过一些日子的思考学习，总算有了点思路，就以CS为例，介绍如何分析游戏、辅助工具以及相应的安全防护。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">选择CS有几个原因：首先它是我第一次碰电脑就接触的东西，感情深厚；其次CS逻辑清晰易懂，没有复杂的反调试、加密等防护；最后就是基本所有人都玩过，写例子大家也容易理解。打算写一个小系列，从简单的不死、子弹不减到联网状态的数据包传输、找到各个功能实现call、人物画面渲染等，最后了解整个游戏结构，并写出防护软件来保护CS。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">今天写第一回，血量、子弹分析。涉及到的工具有CE、OD、IDA、PCHunter32、notepad++、CS1.6中文版、VS2005。最后实现自己不掉血、不减少子弹。假设读者有一定逆向基础，了解windows编程。并没有分析过CS，也不太了解游戏分析流程，毕竟求大神飘过无视。工具使用只会略作介绍。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>子弹不减</strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">打开CS，选fy_iceworld雪地，方便捡枪的图。先用手枪，刚开始20发子弹。打开CE，附加到CS，扫描4字节的精确十进制数20，这里我默认子弹数用四字节。首次扫描，找出了内存中所有值为20的4字节数据的地址，非常多，需要排除。打一枪，再扫描19，剩余197项；再来几枪，扫描子弹剩余数，这次都跟着变化了，如下图所示。所以挨着查看分析。</span></p><p style="text-align:center"><img style="width: 600px; height: 289px;" alt="t01c1f734e3c32095d4.png" src="http://p0.qhimg.com/t01c1f734e3c32095d4.png" title="t01c1f734e3c32095d4.png" height="289" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">先想想，实际上我们需要找到保存子弹数目的原始地址，这个地址的值是运算得来的。其它地方，比如用于显示图上“16|40”数字的地址，它的值应该是直接复制而来的。所以我们改原始地址的值，其它地方应该会相应的改变。这是一种假设，是我们设计程序的时候采用的方法。不妨试试挨着修改。</span></p><p style="text-align:center"><img style="width: 600px; height: 252px;" alt="t0152daafd7532e73ef.png" src="http://p2.qhimg.com/t0152daafd7532e73ef.png" title="t0152daafd7532e73ef.png" height="252" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">非常幸运，改地址列表中的第一个地址的值，就验证了我们的猜测。至于为什么能想到这个，我想这就是学习的目的吧。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">找到了需要的原始地址，接下来该确定什么代码改写了它。内存写断点可以实现。右键CE中我们找到的地址，选“找出什么改写了这个地址”，将CS载入CE内置的调试器并设好了内存写断点。然后我们打一枪，就能找到减少子弹的代码了。如下图：</span></p><p style="text-align:center"><img style="width: 600px; height: 309px;" alt="t01a86febbdae17a0d9.png" src="http://p8.qhimg.com/t01a86febbdae17a0d9.png" title="t01a86febbdae17a0d9.png" height="309" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">改变子弹数目的代码如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">mp.weapon_glock18+5EA&nbsp;-&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;dec&nbsp;eax
mp.weapon_glock18+5EB&nbsp;-&nbsp;8B&nbsp;CE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;mov&nbsp;ecx,esi
mp.weapon_glock18+5ED&nbsp;-&nbsp;89&nbsp;86&nbsp;CC000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;mov&nbsp;[esi+000000CC],eax</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">很明显dec eax，子弹减了一个。我最开始做到这一步的时候，非常高兴，马上用OD附加到CS，然后分析前后代码，纠结减少子弹和换弹夹的问题。而且上面代码的ESI明显是个对象或者结构体，试图确定每一个成员的作用。但是后来我发现那样有点事倍功半，CE的调试器很好的利用了CS的符号表，告诉我们一个非常明确的信息：现在是在mp模块的weapon_glock18部分，手枪的名字就是glock18咯。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">为了验证是不是每个武器都有一部分代码，我们换一把枪，用同样的方法（子弹数扫描并查找代码），找到了AK47的子弹处理部分：</span></p><p style="text-align:center"><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">跟上面手枪的处理非常相似。这个时候其实我们可以不必用OD动态调试了，完全可以用分析mp.dll，找到其中关于武器的代码：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">自动分析后看到如下函数：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">weapon_ak47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100011E0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_aug&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10001B40&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_awp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10002270&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_c4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10002950&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_deagle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10003410&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_elite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10003AD0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_famas&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100042E0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_fiveseven&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10004A80&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_flashbang&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100051A0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_g3sg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100059E0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_galil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10005FE0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_glock18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10006650&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_hegrenade&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10006FC0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_knife&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100076E0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_m249&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10008A90&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_m3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10009100&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_m4a1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10009870&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_mac10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000A190&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_mp5navy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000A780&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_p228&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000AD60&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_p90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000B3D0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_scout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000BA30&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_sg550&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000C0B0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_sg552&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000C830&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_shield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;10093170&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_smokegrenade&nbsp;.text&nbsp;1000CEE0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000D6D0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_ump45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000DCF0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_usp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000E2C0&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weapon_xm1014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;1000EC10&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.
weaponbox&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;100B8860&nbsp;0000004F&nbsp;R&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">同时还有更意外的发现，mp.dll就是CS的核心，不仅武器部分，甚至BOT的AI也是在这里实现的。我们可以看到很多有价值的函数，下面选取一部分：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">CAirtank::TankThink(void)&nbsp;&nbsp;&nbsp;
CAirtank::TankTouch(CBaseEntity)
CAmbientGeneric::RampThink(void)&nbsp;
CAmbientGeneric::ToggleUse(CBaseEntity*,CBaseEntity,USE_TYPE,float)
CArmoury::ArmouryTouch(CBaseEntity*)
CBaseButton::ButtonBackHome(void)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CBaseButton::ButtonTouch(CBaseEntity*)
CBaseDelay::DelayThink(void)
CBaseDoor::DoorTouch(CBaseEntity*)
CBaseMonster::CorpseFallThink(void)
CBasePlayer::PlayerDeathThink(void)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CBasePlayerAmmo::DefaultTouch(CBaseEntity*)
CBasePlayerItem::DestroyItem(void)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CBaseToggle::AngularMoveDone(void)
CBaseToggle::LinearMoveDone(void)&nbsp;&nbsp;
CBombTarget::BombTargetTouch(CBaseEntity*)&nbsp;&nbsp;&nbsp;
CBreakable::Die(void)&nbsp;
CBuyZone::BuyTouch(CBaseEntity*)&nbsp;&nbsp;
CCSBot::BotTouch(CBaseEntity*)&nbsp;
CEnvExplosion::Smoke(void)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CEnvSpark::SparkStart(CBaseEntity*,CBaseEntity*,USE_TYPE,float)
CWeaponBox::Kill(void)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">可以看到，只要把mp.dll分析清楚，CS基本就搞清楚了。了解这么多之后，可以回到最初的目标：子弹不减。其实只要简单的把dec eax改成 inc eax就行了。子弹就不会减少了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">这时候我们打枪子弹会增加，直到127，然后减少，变成0之后又增加。这也说明子弹数目是一个字节来保存的。具体的变化可以自己试一下，非常有意思。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">我们的第一个目标已经实现了：子弹不减。但是还有很多问题，难道我们每次换把枪都要用CE来这么一次？然后修改？这么搞都超时断开了。我们需要把武器和人物结合起来，这样就可以定点修改了。总不能敌人的子弹也不减少吧？</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>血量分析</strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">经过找子弹的简单练习，应该更坚信了能实现不死的效果。可能会觉得按照上述步骤，找血、扫描、修改然后找到原始地址就行了，但是实际上血量的查找和修改要复杂不少。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">还是用CE扫描，和找子弹类似，先扫描值为100的地址，然后自己跳楼减少血量，再次扫描。为什么跳楼呢？这应该是最方便的可控减血方式。这次用cs_assault图。和上述找子弹步骤类似，扫描几次之后确定了几个可能是血量保存地址的地方：</span></p><p style="text-align:center"><img style="width: 600px; height: 268px;" alt="t0197d8e07f42bee8c5.png" src="http://p8.qhimg.com/t0197d8e07f42bee8c5.png" title="t0197d8e07f42bee8c5.png" height="268" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">这次依然利用上一节方法，修改并观察其他的是否跟着改变。发现这几个只有一个可以修改，但是修改之后只是显示满血，一跳楼就又变成理论血量了，该死还是死。只是看起来好看一些。</span></p><p style="text-align:center"><img style="width: 600px; height: 277px;" alt="t0111238f438bd0243b.png" src="http://p4.qhimg.com/t0111238f438bd0243b.png" title="t0111238f438bd0243b.png" height="277" vspace="0" width="600" border="0"/></p><p style="text-align:center"><img style="width: 600px; height: 466px;" alt="t019ae22b6f051ec14e.png" src="http://p7.qhimg.com/t019ae22b6f051ec14e.png" title="t019ae22b6f051ec14e.png" height="466" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">虽然显示变成了100，但是实际血量正如其它地方显示的：24。跳楼之后果然成功挂掉。之前的猜测不管用了。只好换一个思路。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">肯
定有一个地址是与众不同的，它第一时间保存变化后的血量。其它的地址类似上面找子弹的路人甲乙丙丁地址，都是直接赋值而来。那么哪个是第一时间接收到变化
后的血量的呢？我们不妨看一下改变这些地址的代码，如果是路人甲，那么它应该被改写非常多的，即使血量不变化，也会有代码执行，毕竟得看初始地址眼色行
事，不积极一点就跟不上节奏了。所以我们就看血量不变化的情况下是这些地址有没有被写入。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">0011984C疯狂的被改写，明显是路人甲：</span></p><p style="text-align:center"><img style="width: 600px; height: 245px;" alt="t01ce1e0170364e57c6.png" src="http://p8.qhimg.com/t01ce1e0170364e57c6.png" title="t01ce1e0170364e57c6.png" height="245" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">0012BE74虽然不那么疯狂，但也是明显路人乙的节奏：</span></p><p style="text-align:center"><img style="width: 600px; height: 284px;" alt="t01800f6febacaeb154.png" src="http://p7.qhimg.com/t01800f6febacaeb154.png" title="t01800f6febacaeb154.png" height="284" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">接下来我们看到了主角：0096C5BC，明显的稳如泰山，血量不变化的情况下不被改写。</span></p><p style="text-align:center"><img style="width: 600px; height: 399px;" alt="t01e7fa724e52cfcb20.png" src="http://p1.qhimg.com/t01e7fa724e52cfcb20.png" title="t01e7fa724e52cfcb20.png" height="399" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">我们试着跳楼：</span></p><p style="text-align:center"><img style="width: 600px; height: 285px;" alt="t01d48954222443c9e0.png" src="http://p3.qhimg.com/t01d48954222443c9e0.png" title="t01d48954222443c9e0.png" height="285" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">看到只改写了一次，可以确定这就是我们要找的地址和代码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">仔细看截图会发现跳楼前后地址变了，确实是。写文章的过程中得自己调试着来，中间不小心卡死了，重来了一次，局部变量地址发生了变化，但是思路是连续的。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">目前为止，我们可以认为找到了改变血量的地址：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFF8 - fld dword ptr [edi+00000160]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFFE - call mp.worldspawn+26280</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: blue; font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DB003 - mov [esi+000005B4],eax</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DB009 - fld dword ptr [edi+000001BC]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DB00F - call mp.worldspawn+26280</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">为了方便使用，之后的调试我们使用OD。附加到CS并在61DB003处下断。跳楼减血顺利断下，可以看到EAX的值正是将要变成的血量：24。</span></p><p style="text-align:center"><img style="width: 600px; height: 302px;" alt="t01a25a355e5d0c4b10.png" src="http://p0.qhimg.com/t01a25a355e5d0c4b10.png" title="t01a25a355e5d0c4b10.png" height="302" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">现在我们的人物就是查找EAX从何而来。这里有个小技巧，我们在61DB003之前下断点，如果只有跳楼减血的时候断下，那说明这个地址的代码和61DB003是承接起来的一个流程，如果一直在断下或者跳楼也没断下，那这个地址和我们要确定的EAX来源关系应该不大。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">往上翻看代码，大致了解一下流程，建议倒着看，因为我就是倒着分析的，所以思考方式也是从结果往前推导。每段注释都是针对注释下面的语句：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">061DAF77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;83C4&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;ESP,14
061DAF7A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FF15&nbsp;6CA52A06&nbsp;&nbsp;&nbsp;CALL&nbsp;DWORD&nbsp;PTR&nbsp;DS:[62AA56C]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;cstrike.01D79590
061DAF80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;892D&nbsp;74A42A06&nbsp;&nbsp;&nbsp;MOV&nbsp;DWORD&nbsp;PTR&nbsp;DS:[62AA474],EBP
061DAF86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8B7E&nbsp;04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOV&nbsp;EDI,DWORD&nbsp;PTR&nbsp;DS:[ESI+4]</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">//&nbsp;&nbsp;&nbsp;&nbsp; </span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">这里又是一个将</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">[EDI+160]</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的值赋值到</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">st(0)</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的语句，同时</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">EDI = [ESI + 4]</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">，和我们下面看到的一样。如果当时我们纠结</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">ESI</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的来源，不往前看，就有可能忽略这里。下断看看这个时候</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">[EDI+160]</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">是不是已经变成了将要变成的血值。下断之后发现一直断下，而且</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">[EDI+160]</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的血值是之前的，而不是之后的。因为游戏刚开始的时候这里一直断下，根本走不开，而</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">[EDI+160]</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的值是</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">100.000</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">。那么我们有必要看看下面那个</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">call</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">，</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">6220AE0</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">。直觉告诉我们这里有可能是计算血量的地方。倒着看到这里，该看下一段代码了，也就是</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">6220AE0 call</span></em><em><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 13px;">的内部。</span></em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAF89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D987 60010000&nbsp;&nbsp; FLD DWORD PTR DS:[EDI+160]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAF8F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E8 4C5B0400&nbsp;&nbsp;&nbsp;&nbsp; CALL mp.06220AE0</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAF94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3B86 B4050000&nbsp;&nbsp; CMP EAX,DWORD PTR DS:[ESI+5B4]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAF9A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;74 6D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JE SHORT mp.<span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px; color: maroon;">061DB009</span></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>这个jmp</em><em>直接跳到了本段代码最后，所以正常的减血赋值操作应该不会跳转，所以说下面这条指令是会执行的。下个断点跳楼就足以证明。你可能已经猜到了，在这个地方 [EDI+160]</em><em>已经是将要变成的血量了，所以还得往前寻找。</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">061DAF9C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D987&nbsp;60010000&nbsp;&nbsp;&nbsp;FLD&nbsp;DWORD&nbsp;PTR&nbsp;DS:[EDI+160]
061DAFA2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D81D&nbsp;F0622306&nbsp;&nbsp;&nbsp;FCOMP&nbsp;DWORD&nbsp;PTR&nbsp;DS:[62362F0]
061DAFA8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DFE0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FSTSW&nbsp;AX
061DAFAA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25&nbsp;00410000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EAX,4100</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>下面两个判断分支加上几个全局call</em><em>的调用，暂时先不要陷入call</em><em>的追踪，还是先看看之前是不是已经有结果了。这是经验之谈，盲目的追踪一个call</em><em>只会浪费时间和让人越来越烦。在这里就可以试着下断，看看赋值减血的流程是跟着哪个步骤来的。经过在AFB1</em><em>和AFBD</em><em>下断，我发现AFB1</em><em>会断下，顺着走当然会跳过AFBD</em><em>的赋值0</em><em>操作。同时我发现在061DAFB1</em><em>这个地址处，[EDI+160]</em><em>的值已经是将要变成的血值了，也就是说下面叨咕半天的又是没用的，还得往前推。</em></span></p><p style="text-align:center"><img style="width: 600px; height: 215px;" alt="t0155adaefe96a2f855.png" src="http://p7.qhimg.com/t0155adaefe96a2f855.png" title="t0155adaefe96a2f855.png" height="215" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>一个未知全局call</em><em>，有可能改变 [EDI+160]</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFEF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF15 6CA52A06&nbsp;&nbsp; CALL DWORD PTR DS:[62AA56C]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; cstrike.01D79590</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; FLD </em><em>指令将 [EDI + 160]</em><em>装入 st(0)</em><em>，如果多一个心眼儿看看[EDI+160]</em><em>的浮点数，会发现是24.000</em><em>，这其实告诉我们下面那个CALL</em><em>和最终的血量没啥关系，如果提前考虑这个问题，就不必费心查看那个CALL</em><em>内部了。EDI = [ESI + 4]</em><em>，这个时候问题已经变成追踪ESI</em><em>了。</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFF5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8B7E 04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV EDI,DWORD PTR DS:[ESI+4]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D987 60010000&nbsp;&nbsp; FLD DWORD PTR DS:[EDI+160]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>调用了一个函数，可能返回将要变成的血量</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DAFFE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E8 DD5A0400&nbsp;&nbsp;&nbsp;&nbsp; CALL mp.06220AE0</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; EAX </em><em>是将要变成的血量</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">061DB003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8986 B4050000&nbsp;&nbsp; MOV DWORD PTR DS:[ESI+5B4],EAX</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 14px; color: maroon;">061DB009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>D987 BC010000&nbsp;&nbsp; FLD DWORD PTR DS:[EDI+1BC]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">我们看看全局call是什么功能。内部实现如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AE0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH EBP</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AE1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8BEC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV EBP,ESP</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AE3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 83C4 F4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD ESP,-0C</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AE6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WAIT</span></p><table width="294" cellpadding="0" cellspacing="0"><tbody><tr class="firstRow"><td style="border-width: 1px 1px 1px medium; border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; padding: 0px 7px;" width="126"><p style="margin-top: auto; margin-bottom: auto; text-align: left; text-indent: 2em;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">FSTCW dest</span></p></td><td style="border-width: 1px 1px 1px medium; border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; padding: 0px 7px;" width="168"><p style="margin-top: auto; margin-bottom: auto; text-align: left; text-indent: 2em;"><span style="font-size: 12px; font-family: 微软雅黑,Microsoft YaHei;">将FPU的控制字保存到dest</span></p></td></tr></tbody></table><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>执行 FSTCW </em><em>语句之后 [EBP-2]</em><em>的值变成027F</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AE7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D97D FE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSTCW WORD PTR SS:[EBP-2]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AEA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WAIT</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AEB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;66:8B45 FE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV AX,WORD PTR SS:[EBP-2]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AEF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 80CC 0C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OR AH,0C</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>这里做一个运算，把FPU</em><em>的控制字和C</em><em>做或运算，然后放到[EBP-4]</em><em>这个WORD</em><em>中。</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AF2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 66:8945 FC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV WORD PTR SS:[EBP-4],AX</span></p><table width="573" cellpadding="0" cellspacing="0"><tbody><tr class="firstRow"><td style="border-width: 1px 1px 1px medium; border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; padding: 0px 7px;" width="126"><p style="margin-top: auto; margin-bottom: auto; text-align: left; text-indent: 2em;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">FLDCW src</span></p></td><td style="border-width: 1px 1px 1px medium; border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; padding: 0px 7px;" width="168"><p style="margin-top: auto; margin-bottom: auto; text-align: left; text-indent: 2em;"><span style="font-size: 12px; font-family: 微软雅黑,Microsoft YaHei;">从src装入FPU的控制字</span></p></td><td style="border-width: 1px medium; border-style: solid none; border-color: windowtext -moz-use-text-color; padding: 0px 7px;" width="279"><p style="margin-top: auto; margin-bottom: auto; text-align: left; text-indent: 2em;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 12px;">FPU CW </span><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 16px;">&lt;-</span><span style="font-family: 微软雅黑,Microsoft YaHei; font-size: 12px;">src (mem16)</span></span></p></td></tr></tbody></table><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>将异或之后的值放入控制寄存器，整个过程相当于自己或。FPU = FPU | 0xC</em><em>，也就是将第12</em><em>为置位。这里貌似是改变进位设置，我也没有深究。</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AF6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D96D FC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FLDCW WORD PTR SS:[EBP-4]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>这里是将浮点栈的值放入 [EBP-C] </em><em>并出栈。可以看到浮点是是 QWORD </em><em>级别，8</em><em>个字节</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AF9 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DF7D F4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FISTP QWORD PTR SS:[EBP-C]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>控制字符串恢复</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AFC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D96D FE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FLDCW WORD PTR SS:[EBP-2]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><em>//&nbsp;&nbsp;&nbsp; </em><em>这个赋值可以看到这个函数相当于把浮点栈顶的值放到EAX</em><em>中。仔细看上面那段代码，这个call</em><em>执行之前的指令是FLD DWORD PTR DS:[EDI+160]</em><em>，也就是说这个函数的作用只是把 [EDI+160]</em><em>的值放入EAX</em><em>。</em></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220AFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8B45 F4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV EAX,DWORD PTR SS:[EBP-C]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220B02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8B55 F8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV EDX,DWORD PTR SS:[EBP-8]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220B05&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LEAVE</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">06220B06&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETN</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">看到这里应该明白那个跳转的意思了，CMP EAX,DWORD PTR DS:[ESI+5B4]，比较 [EDI+160]和 [ESI+5B4]的值，不相等就进入下面的处理流程，进行同步。在061DAF9C&nbsp;&nbsp;&nbsp; D987 60010000&nbsp;&nbsp; FLD DWORD PTR DS:[EDI+160] 这里下断，查看[ESI+5B4]和[EDI+5B4]的值。如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">[EDI+160]</span></p><p style="text-align:center"><img style="width: 600px; height: 210px;" alt="t01e8153505fc330bb8.png" src="http://p7.qhimg.com/t01e8153505fc330bb8.png" title="t01e8153505fc330bb8.png" height="210" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">[ESI+5B4]</span></p><p style="text-align:center"><img style="width: 600px; height: 198px;" alt="t014c9a3266ba899feb.png" src="http://p2.qhimg.com/t014c9a3266ba899feb.png" title="t014c9a3266ba899feb.png" height="198" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">高下立判。[EDI+160]才是真正的血量存储池。而我们找了半天的地方其实只是一个转换。现在才有资本去找真正改变血量的地方。既然[EDI+160]是改变血量的地方，那么就在该地址下内存写入断点。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">因为之前调试的时间问题，游戏可能会断开，这个时候重新开图。初始化的时候断了下来，完全的意外收获，我们找到了player初始化的地方：</span></p><p style="text-align:center"><img style="width: 600px; height: 496px;" alt="t019b960654a54c538c.png" src="http://p0.qhimg.com/t019b960654a54c538c.png" title="t019b960654a54c538c.png" height="496" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">此时EAX为03C31BFC。不妨先剧透一下，这个值是让我头疼了一天一夜的值。它是“你”的对象地址。“你”指的是玩家。New一个对象的时候最想分配到的就是03C31BFC，被“你”占用了。这段初始化代码可以告诉我们很多信息，比如初始血量，42C80000显然是100.000的浮点形式。而160这个偏移也让我们浮想联翩。没错，之前那个EDI也是player对象的首地址。因为本节的目的是不掉血，所以暂时跳过这段精彩的发现。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">接着运行，让游戏跑起来。然后我们跳楼，这时就会找到修改 对象+160处偏移的代码，也就是掉血的代码。因为下内存写断点会非常卡，要跳楼也是需要时间的。趁这点时间写几点无关的体会和经验：关注重点，不要随便进入一个call就分析；多注意关键代码的前后逻辑，多下断尝试，注意观察关键内存地址和寄存器的值；调CS的时候鼠标可能会跳出来，这个时候摁两下win键就OK了；mp.dll每次加载基址可能会变，所以需要记下偏移，最开始我就吃了这个大亏。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">好了，跳楼成功，断下在这里：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><p style="text-align:center"><img style="width: 600px; height: 159px;" alt="t012992d38ce3073202.png" src="http://p9.qhimg.com/t012992d38ce3073202.png" title="t012992d38ce3073202.png" height="159" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">可以看到经过一个简单的运算，算出一个减数，[ESP+54]，被减数为原血值。所以最最简单的方法就是把减数[ESP+54]变成0。这样理论上血值就不会减少了，一直是100。改一下试试：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><p style="text-align:center"><img style="width: 600px; height: 175px;" alt="t01af191d57704dd215.png" src="http://p6.qhimg.com/t01af191d57704dd215.png" title="t01af191d57704dd215.png" height="175" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">从这个简单运算中我们也可以对player对象更进一步的了解。比如偏移+1D8的值用于计算减少的血值。通过这个值我们还能找到血量变化的运算，进而找到跳楼、射击、炸弹等动作，这都是后话。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">现在改了之后所有人都是不死之身了，玩儿起来就是血腥，狂喷血，谁也死不了。发一张血腥的游戏截图，少儿不宜啊：</span></p><p style="text-align:center"><img style="width: 600px; height: 469px;" alt="t01b85d506675023019.png" src="http://p4.qhimg.com/t01b85d506675023019.png" title="t01b85d506675023019.png" height="469" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>分析几个参数和dll</strong><strong>注入实现最初的功能</strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">在我们修改代码的那里下断，每回掉血都会断下来，我们分析一下这几个参数。</span></p><p style="text-align:center"><img style="width: 600px; height: 111px;" alt="t01caec5d206cf9aaa3.png" src="http://p4.qhimg.com/t01caec5d206cf9aaa3.png" title="t01caec5d206cf9aaa3.png" height="111" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EAX和EBX造型差不多，而EAX我们非常熟悉，根据之前的剧透，这正是“我”的地址。既然这是一个掉血的过程，那么一个掉血，必然有一个砍刀的，不妨猜测EBX存储的是攻击者的对象首地址，EAX存储被攻击者的首地址。为什么这么猜测呢？因为我故意不动让BOT来砍我。换我射击BOT，断下来又是另一番情景：</span></p><p style="text-align:center"><img style="width: 600px; height: 111px;" alt="t012963764f75fd1b27.png" src="http://p1.qhimg.com/t012963764f75fd1b27.png" title="t012963764f75fd1b27.png" height="111" vspace="0" width="600" border="0"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EAX 和 EBX 值换了，再仔细分析其它几个寄存器的值，包括它们作为地址存储的值，分析之后得出以下结论：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EAX = 被攻击者首地址</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EBX =&nbsp; 攻击者首地址</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">ECX =&nbsp; EBX - 80</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EDX =&nbsp; [ESI]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EBP =&nbsp; ESI</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EDI =&nbsp; Kill or SelfKill</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EDI是怎么知道的呢？我发现跳楼和其他的情况到这里的时候EDI值不同，自杀是0x0002，他杀是0x1002。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">EBX在数据窗口跟随就可以看到“我”这个对象，还能找到坐标等有价值的值。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">现在我们改变一下HOOK方式，不修改代码，而是跳到一个地方，根据EAX的值进行相应的变化。之前提到过，初始化时把03C31BFC地址分配给自己，所以根据EAX的值选择血值不变还是照常减少，这样又可杀敌，又可保命。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">我选择远程写入方式，在CS进程分配地址并写入hook代码。根据mp.dll的加载地址和减血偏移，采用inline hook。代码如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:cpp;toolbar:false">#include&nbsp;&lt;windows.h&gt;
#include&nbsp;&lt;TlHelp32.h&gt;
#include&nbsp;&lt;stdio.h&gt;
#define&nbsp;BLOOD_OFFSET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x66EE8
#define&nbsp;BLOOD_ADDR(base)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((base)+BLOOD_OFFSET)&nbsp;&nbsp;&nbsp;
DWORD&nbsp;g_csProcessId&nbsp;=&nbsp;0;
DWORD&nbsp;g_mpBase&nbsp;=&nbsp;0;
DWORD&nbsp;g_bloodAddr&nbsp;=&nbsp;0;
BYTE&nbsp;g_originalBlood[10]&nbsp;=&nbsp;{0xD9,0x44,0x24,0x54,0xD8,0x80,0xD8,0x01,0x00,0x00};
BYTE&nbsp;g_patchedBlood[10]&nbsp;=&nbsp;{0xE9,0xAA,0xAA,0xAA,0xAA,0x90,0x90,0x90,0x90,0x90};
BYTE&nbsp;g_bloodShellcode[]&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x3D,0xFC,0x1B,0xC3,0x03,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CMP&nbsp;EAX,&nbsp;3C31BFC
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x74,0x0F,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;JE&nbsp;target:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xD9,0x44,0x24,0x54,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FLD&nbsp;DWORD&nbsp;PTR&nbsp;SS:[ESP+54]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xD8,0x80,0xD8,0x01,0x00,0x00,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;FADD&nbsp;DWORD&nbsp;PTR&nbsp;DS:[EAX+1D8]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xE9,0xAA,0xAA,0xAA,0xAA,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;jmp&nbsp;orig
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xC7,0x44,0x24,0x54,0x00,0x00,0x00,0x00,//&nbsp;target:&nbsp;MOV&nbsp;[ESP+54],0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xE9,0xAA,0xAA,0xAA,0xAA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;jmp&nbsp;orig
};
DWORD&nbsp;origOffset1&nbsp;=&nbsp;18;
DWORD&nbsp;origOffset2&nbsp;=&nbsp;31;
DWORD&nbsp;GetProcessIdByName(char&nbsp;*name)
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;snapshot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROCESSENTRY32&nbsp;processinfo;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processinfo.dwSize&nbsp;=&nbsp;sizeof(processinfo);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snapshot&nbsp;=&nbsp;CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,&nbsp;TH32CS_SNAPPROCESS);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(snapshot&nbsp;==&nbsp;INVALID_HANDLE_VALUE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Process32First(snapshot,&nbsp;&amp;processinfo))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(snapshot);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(stricmp(name,&nbsp;processinfo.szExeFile)==0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;processinfo.th32ProcessID;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}while&nbsp;(Process32Next(snapshot,&amp;processinfo));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;
}
BYTE*&nbsp;GetMPBase(DWORD&nbsp;pid,&nbsp;char*&nbsp;moduleName)
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hModuleSnap&nbsp;=&nbsp;INVALID_HANDLE_VALUE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODULEENTRY32&nbsp;me32;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hModuleSnap&nbsp;=&nbsp;CreateToolhelp32Snapshot(TH32CS_SNAPMODULE,&nbsp;pid);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hModuleSnap&nbsp;==&nbsp;INVALID_HANDLE_VALUE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me32.dwSize&nbsp;=&nbsp;sizeof(&nbsp;MODULEENTRY32&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Module32First(hModuleSnap,&nbsp;&amp;me32))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hModuleSnap);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(stricmp(me32.szModule,&nbsp;moduleName)&nbsp;==&nbsp;0)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;me32.modBaseAddr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while(Module32Next(hModuleSnap,&nbsp;&amp;me32));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hModuleSnap);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;
}
BOOL&nbsp;ChangeToUndead()
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hProcess;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVOID&nbsp;addrToJmp&nbsp;=&nbsp;NULL;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;ret,&nbsp;offset;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hProcess&nbsp;=&nbsp;OpenProcess(PROCESS_ALL_ACCESS,&nbsp;FALSE,&nbsp;g_csProcessId);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hProcess&nbsp;==&nbsp;NULL)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Get&nbsp;cstrike.exe&nbsp;handle&nbsp;error!\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addrToJmp&nbsp;=&nbsp;VirtualAllocEx(hProcess,&nbsp;0,&nbsp;50,&nbsp;MEM_COMMIT,&nbsp;PAGE_EXECUTE_READWRITE);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(addrToJmp&nbsp;==&nbsp;NULL)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;VirtualAllocEx&nbsp;in&nbsp;cs.exe&nbsp;error!\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hProcess);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;=&nbsp;(g_bloodAddr&nbsp;+&nbsp;10)&nbsp;-&nbsp;5&nbsp;-&nbsp;((DWORD)addrToJmp&nbsp;+&nbsp;origOffset1&nbsp;-1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy((g_bloodShellcode&nbsp;+&nbsp;origOffset1),&nbsp;&amp;offset,&nbsp;4);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;=&nbsp;(g_bloodAddr&nbsp;+&nbsp;10)&nbsp;-&nbsp;5&nbsp;-&nbsp;((DWORD)addrToJmp&nbsp;+&nbsp;origOffset2&nbsp;-1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy((g_bloodShellcode&nbsp;+&nbsp;origOffset2),&nbsp;&amp;offset,&nbsp;4);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory(hProcess,&nbsp;addrToJmp,&nbsp;g_bloodShellcode,&nbsp;sizeof(g_bloodShellcode),&nbsp;&amp;ret);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;!=&nbsp;sizeof(g_bloodShellcode))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;WriteProcessMemory&nbsp;error!\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualFreeEx(hProcess,&nbsp;addrToJmp,&nbsp;50,&nbsp;MEM_FREE);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hProcess);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;=&nbsp;(DWORD)addrToJmp&nbsp;-&nbsp;5&nbsp;-&nbsp;g_bloodAddr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(g_patchedBlood&nbsp;+&nbsp;1,&nbsp;&amp;offset,&nbsp;4);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory(hProcess,&nbsp;(PVOID)g_bloodAddr,&nbsp;g_patchedBlood,&nbsp;10,&nbsp;&amp;ret);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;!=&nbsp;10)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;WriteProcessMemory&nbsp;error!\n&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualFreeEx(hProcess,&nbsp;addrToJmp,&nbsp;50,&nbsp;MEM_FREE);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hProcess);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;
}
int&nbsp;main()
{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_csProcessId&nbsp;=&nbsp;GetProcessIdByName(&quot;cstrike.exe&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_mpBase&nbsp;=&nbsp;(DWORD)GetMPBase(g_csProcessId,&nbsp;&quot;mp.dll&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_bloodAddr&nbsp;=&nbsp;BLOOD_ADDR(g_mpBase);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChangeToUndead();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;%d&nbsp;0x%p\n&quot;,&nbsp;g_csProcessId,&nbsp;g_mpBase);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;BackToOriginalDead(g_bloodAddr,&nbsp;g_originalBlood,&nbsp;g_patchedBlood);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">编译运行之后csrike.exe进程就被patch了，这个时候只有自己是死不了的。我们的目标实现了。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>问题及后续</strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">有了这个代码，建立游戏就可以在局域网内狂虐小伙伴们了。但是如果你加入一个游戏，那就行不通了。也就是说我们之前找的都是服务器的代码段。客户端根本不会执行那些代码。现在以客户端的身份查找血值变化。只找到这么一个疑似代码段：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B80 - 8B 44 24 08&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov eax,[esp+08]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B84 - 8B 4C 24 0C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov ecx,[esp+0C]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B88 - 50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - push eax</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B89 - 51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - push ecx</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B8A - E8 A1F30000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - call 01957F30</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B8F - 83 C4 08&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - add esp,08</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B92 - E8 F9F30000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - call 01957F90</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B97 - 8B 15 747CA101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov edx,[01A17C74] : [00000001]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948B9D - 8B 0D 787CA101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov ecx,[01A17C78] : [00000052]</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BA3 - 83 CA 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - or edx,01</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BA6 - 3B C1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - cmp eax,ecx</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BA8 - 89 15 747CA101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov [01A17C74],edx</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BAE - 74 0F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - je 01948BBF</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BB0 - C7 05 847CA101 0000C842 - mov [01A17C84],42C80000</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: blue; font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BBA - A3 787CA101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov [01A17C78],eax</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BBF - B8 01000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - mov eax,00000001</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">01948BC4 - C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;- ret </span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">直接赋值操作。Eax存储的是变化后的血量。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">当前需要解决的问题有：人物和武器如何对应、服务器和客户端的功能，限于篇幅，这些内容下次再写。另外，不要忘记前言提到的几大目标。我们的目的是通过逆向CS，学习游戏攻防思路技巧，并不是真的要去做CS或者其他外挂。勿忘初心。</span></p><p><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 原创发布，如需转载请注明来源及本文地址。<br/>本文地址：http://bobao.360.cn/learning/detail/125.html
                </p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="CS游戏分析第一回——如何做到孤独求败 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="125" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src='http://p1.qhmsg.com/dm/48_48_100/t00df551a583a87f4e9.jpg'/>              
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="1176723363" class="response" data-bind-id="1176723363" data-target="273" user-name="ddloading" href="javascript:;">
                ddloading            </a>
                        <span class="comment-time">2014-12-14 17:51:38</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="1176723363" data-target="273">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_273" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">可能还有后文吧，CS本身是分服务器和客户端的。</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
<div class="clearfix re-comment">
    <div class="comment-quote">  
        <div class="comment-user">
            <a href="javascript:;" class="response" data-bind-id="0" data-target="196">DrKNa</a> <span class="comment-time">2014-12-08 07:57:24</span>            <div class="comment-action">                        <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="196">回复</a></span>&nbsp;|&nbsp;                        <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_196" data-type="comment">点赞</a></span>            </div>
            <p>这是一篇好文，说明一些游戏的基本调试技巧
可惜的是，当涉及到网路部份的时候就往往复杂得多了
写个穿墙跟这篇比的话也会差得太多
因为不只是搜数值这简单</p>
        </div>
    </div>
        </div>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src='http://p1.qhmsg.com/dm/48_48_100/t01e6e5b29659ba0c56.jpg'/>              
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="993254015" class="response" data-bind-id="993254015" data-target="199" user-name="迦南0x1" href="javascript:;">
                迦南0x1            </a>
                        <span class="comment-time">2014-12-08 14:10:06</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="993254015" data-target="199">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_199" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">当初打CS。。。。在QQ对战平台上被开挂的虐到不行</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/9x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="196" user-name="DrKNa" href="javascript:;">
                DrKNa            </a>
                        <span class="comment-time">2014-12-08 07:57:24</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="196">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_196" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">这是一篇好文，说明一些游戏的基本调试技巧
可惜的是，当涉及到网路部份的时候就往往复杂得多了
写个穿墙跟这篇比的话也会差得太多
因为不只是搜数值这简单</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>
<div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/9x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="194" user-name="tylovehhx" href="javascript:;">
                tylovehhx            </a>
                        <span class="comment-time">2014-12-05 23:16:32</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="194">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_194" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">围观一下~</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="125" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
