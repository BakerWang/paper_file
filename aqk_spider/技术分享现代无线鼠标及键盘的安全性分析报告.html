<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】现代无线鼠标及键盘的安全性分析报告 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="无线安全,现代无线鼠标及键盘的安全性分析报告"/>
    
        <meta name="description" content="桌面无线设备通常由无线鼠标、无线键盘以及USB收发器所组成，在过去的几年中，桌面无线设备已经越来越受广大人民群众的喜爱。与有线设备相比，这类无线设备更容易引起不怀好意的人们的兴趣，原因在于攻击者可以通过无线信号，从安全的距离远程攻击这类设备。我们会在本文中介绍这一方面的研究成果，也会介绍如何利用不同的安全漏洞，来攻击不同厂商生产的桌面无线设备。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】现代无线鼠标及键盘的安全性分析报告</h2>
                <div class="article-msg">
                    <span class="time">2017-06-15 15:27:14</span>
                    
                                        <span class="read">阅读：26940次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3986"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3986" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://www.exploit-db.com/docs/42109.pdf"
                             target="_blank">来源： exploit-db.com</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2819002922" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t0104d1b8b4ca36e961.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2819002922" style="color:#848e99;">興趣使然的小胃</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 0em;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><img src="http://p9.qhimg.com/t01208271b24311ee3d.jpg" title="t01f59a8086be44cb0c.jpg" alt="http://p7.qhimg.com/t01f59a8086be44cb0c.jpg"/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></strong></span></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">翻译：</span><a href="http://bobao.360.cn/member/contribute?uid=2819002922" target="_blank" textvalue="興趣使然的小胃"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">興趣使然的小胃</span></a></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">预估</span><span style="font-weight: 900; color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">稿费：300RMB</span></p><p style="margin: 0px 25px 8px; white-space: normal; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(0, 112, 192); font-size: 18px; font-weight: 900;">投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">一、前言</span></strong></span><br/></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">桌面无线设备通常由无线鼠标、无线键盘以及USB收发器所组成，在过去的几年中，桌面无线设备已经越来越受广大人民群众的喜爱。与有线设备相比，这类无线设备更容易引起不怀好意的人们的兴趣，原因在于攻击者可以通过无线信号，从安全的距离远程攻击这类设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者可以通过攻击桌面无线设备，夺取计算机系统的控制权，也能收集诸如密码之类的敏感信息，因此过去人们经常分析这类设备的安全漏洞，也有成功突破这类设备的真实案例。利用无线键盘漏洞的一个非常著名的案例，就是Dreamlab Technologies研发的开源无线键盘嗅探工具：KeyKeriki。KeyKeriki的首个版本于2009年推出，针对的是使用27MHz ISM频段的微软无线键盘。第二个版本于2010年推出，支持使用2.4GHz ISM频段的无线键盘[1]。在2015年，Samy Kamkar发布了一款基于Arduino的无线键盘嗅探器，针对的是存在已知安全漏洞的微软键盘，这个嗅探器拓展了KeyKeriki v2.0项目[2]以及Travis Goodspeed关于Nordic Semiconductor生产的nRF24系列产品的研究成果[3]。在2016年春季，MouseJack代表Bastille Networks Internet Security公布了多个桌面无线设备厂商生产的USB收发器中存在的一系列安全漏洞，这些漏洞导致设备容易受到按键注入攻击影响[4]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">SySS GmbH自2015年起启动了一个项目，开始研究使用AES加密算法的现代桌面无线设备的安全性，当时关于无线鼠标和键盘中的安全问题还没有公开可用的研究数据。到2016年5月为止，在我们的安全公告项目中已经发现并报告了许多厂商生产的现代桌面无线设备中存在的多个安全漏洞，这些厂商包括Microsoft、Cherry、Logitech、Fujitsu以及Perixx。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者可以根据各自的目的，在不同攻击场景中利用已有的安全漏洞实施攻击。从一方面来讲，有些安全漏洞需要攻击者物理接触键盘或USB设备，比如，攻击者需要接触这些设备来提取后续攻击或者修改设备固件所需的加密密钥。从另一方面来讲，有些安全漏洞可以通过无线通信技术来远程利用，比如，设备使用了不完善的AES数据加密通信方案导致其容易受到重放攻击或者按键注入攻击影响。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们的研究结果表明，不同厂商生产的现代桌面无线设备的安全等级并不相同，有些设备的安全程度比其他设备更高。此外，现实中并不存在没有任何安全问题的桌面无线设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们会在本文中介绍这一方面的研究成果，也会介绍如何利用不同的安全漏洞，来攻击不同厂商生产的桌面无线设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">二、测试对象及使用的测试技术</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在整个研究项目中，我们分析了不同厂商的5个桌面无线设备，包括键盘、鼠标以及USB收发器。这3类设备都包含无线收发单元以进行无线通信。图1展示了我们的测试设备之一：Microsoft Wireless Desktop 2000。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">被测试的5个桌面无线设备分别为：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、Microsoft Wireless Desktop 2000</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、Cherry AES B.UNLIMITED</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、Fujitsu Wireless Keyboard Set LX901</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、Logitech MK520</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、Perixx PERIDUO-710W</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">其中有4个设备使用了Nordic Semiconductor生产的低功耗2.4GHz nRF24收发器，1个设备使用了Cypress 生产的低功耗2.4GHz收发器以及低电压版的微控制器（CY7C60123-PVXC）。被测试的无线键盘以及USB设备所用的收发器或SoC（system on chip，片上系统）信息如表2所示。由于被测试的设备大多都使用了nRF24收发器，因此我们的研究重点也集中在这一点上。</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t0138e539f7c43d63dd.png" title="t01e55f67ebadda2151.png" alt="http://p6.qhimg.com/t01e55f67ebadda2151.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了分析设备所使用的无线通信，也为了向无线设备组件发送无线信号，我们使用了软件定义的无线电（如HackRF One[5]和USRP B200[6]）以及基于nRF24的USB无线电设备（Crazyradio PA[7]）。</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t01a7e48207ab4ec54f.png" title="t01c256266585b4154e.png" alt="http://p9.qhimg.com/t01c256266585b4154e.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们最开始使用的是Crazyradio PA以及Bastille发布的nRF研究固件[8]，在2016年2月MouseJack发布之后，我们开发了对应的Python工具，因为这个工具集的优先级高于当时我们所使用的工具，感谢Marc Newlin的研究成果。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">桌面无线设备的常用功能如图2所示，其中键盘及鼠标都会向插入计算机的USB收发器发送无线信号（带有按键信息或者鼠标动作的数据包）。如图所示，这种无线通信是双向的，因为USB收发器会对它所收到的数据包进行确认及反馈。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01c9e182ecf07f721e.png" title="t013f2346aa580ee8d7.png" alt="http://p7.qhimg.com/t013f2346aa580ee8d7.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">三、测试方法</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">对于被测试的桌面无线设备，我们使用以下三个步骤对其进行分析：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、硬件分析</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、固件分析</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、无线信号分析</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在硬件分析方面，我们打开了键盘、鼠标以及USB收发器的外壳，对设备的PCB板（printed circuit board，打印电路板）进行观察，标记出对设备功能起到关键作用的芯片，如无线传输器、接收器或者收发器。之后，我们详细阅读了相关芯片的文档，查找可以测试的触点，比如串行外设接口（serial peripheral interface，SPI）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如图3和图4所示，nRF24LE1收发器存在一个SPI接口。</span></p><p style="text-align:center"><img src="http://p5.qhimg.com/t0187a40629d44537f8.png" title="t011d26bea0f9820d2a.png" alt="http://p9.qhimg.com/t011d26bea0f9820d2a.png"/></p><p style="text-align:center"><img src="http://p9.qhimg.com/t01245d8eb11e675bd3.png" title="t0123e5b7ef96f466ff.png" alt="http://p4.qhimg.com/t0123e5b7ef96f466ff.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于基于nRF24的设备，如果所使用的芯片配置允许的话，设备可以使用SPI接口来读取和写入内部闪存。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">微软的某个无线键盘的PCB板背面如图5所示，其中4个SPI焊点都打上了准确的标记（FMISO、FMOSI、FCSN以及FSCK），这可以给我们节省许多时间（已禁用回读保护机制）。</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01cf33c8747c561992.png" title="t0176d77a08ab391224.png" alt="http://p4.qhimg.com/t0176d77a08ab391224.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在识别出被测试键盘及USB设备的SPI接口后，我们将某些线路焊接到已识别的触点或SoC引脚上，尝试导出设备固件以便进一步分析。为了完成这一任务，我们使用了Bus Pirate[9]以及nrfprog软件[10]。对Cherry无线键盘SPI接口的读写方式如图6所示。</span></p><p style="text-align:center"><img src="http://p3.qhimg.com/t0106301f42b8648070.png" title="t01ed6e3eab696c8967.png" alt="http://p7.qhimg.com/t01ed6e3eab696c8967.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对被测试的某些USB设备而言（如Cherry的某个USB设备），SPI接口在使用上有些难度，因为这类设备的PCB板上缺少SPI测试触点，并且所使用的nRF24LU1+的尺寸也比较小，如图7所示。感谢我们的同事Alexander Straßheim伸出援手，我们终于可以通过USB设备的SPI接口测试对设备闪存的读写访问。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t016da6b0e95abaf982.png" title="t01d53ed01be0069b64.png" alt="http://p5.qhimg.com/t01d53ed01be0069b64.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在成功读取被测试的某些设备的固件后，我们可以使用逆向工程方法对导出的设备固件进行分析，这类逆向方法包括使用IDA Pro进行静态代码分析[11]。nRF24 SoC拥有一个8051兼容的微控制器，可以在Nordic Semiconductor生产的nRF24LE产品说明书[12]中找到详细的说明。我们也仔细研读了Nordic Semiconductor在nRF24 SDK[13]中提供的示例代码，这些示例代码非常有用，可以理解基于nRF24的设备是如何被编程的，以及开发者可以使用哪些库。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在IDA Pro中，对Cherry的加密函数hal_aes_crypt的反汇编代码如图8所示。</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01dc99185c8d6b245b.png" title="t013f6c60f8742627f6.png" alt="http://p7.qhimg.com/t013f6c60f8742627f6.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了进一步了解nRF24 SoC，我们不仅阅读了SDK中公开的代码，同样也编写并分析了自己的示例代码，如实现memcpy功能的固件代码（如清单3.1所示）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;/*&nbsp;Really&nbsp;simple&nbsp;memory&nbsp;copy&nbsp;firmware&nbsp;*/
2
3&nbsp;#include&nbsp;&lt;Nordic\reg24le1.h&gt;
4&nbsp;#include&nbsp;&lt;hal_flash.h&gt;
5
6&nbsp;#define&nbsp;LENGTH&nbsp;512
7
8&nbsp;//&nbsp;data&nbsp;buffer
9&nbsp;static&nbsp;uint8_t&nbsp;xdata&nbsp;buffer[LENGTH];
10
11&nbsp;//&nbsp;Main&nbsp;routine
12&nbsp;void&nbsp;main()
13&nbsp;{
14&nbsp;uint16_t&nbsp;src_addr&nbsp;=&nbsp;0xFA00;&nbsp;//&nbsp;start&nbsp;of&nbsp;extended&nbsp;endurance&nbsp;data&nbsp;in&nbsp;NV&nbsp;memory
15&nbsp;uint16_t&nbsp;dest_addr&nbsp;=&nbsp;0xFC00;&nbsp;//&nbsp;start&nbsp;of&nbsp;normal&nbsp;endurance&nbsp;data&nbsp;in&nbsp;NV&nbsp;memory
16&nbsp;uint16_t&nbsp;len&nbsp;=&nbsp;LENGTH;
17
18&nbsp;//&nbsp;erase&nbsp;normal&nbsp;endurance&nbsp;memory&nbsp;pages&nbsp;(34&nbsp;and&nbsp;35)
19&nbsp;hal_flash_page_erase&nbsp;(34);
20&nbsp;hal_flash_page_erase&nbsp;(35);
21
22&nbsp;//&nbsp;read&nbsp;extended&nbsp;endurance&nbsp;data&nbsp;memory&nbsp;from&nbsp;0xFA00&nbsp;to&nbsp;buffer
23&nbsp;hal_flash_bytes_read(src_addr&nbsp;,&nbsp;buffer&nbsp;,&nbsp;len);
24
25&nbsp;//&nbsp;write&nbsp;buffer&nbsp;to&nbsp;to&nbsp;SPI&nbsp;-addressable&nbsp;NVM&nbsp;(normal&nbsp;endurance&nbsp;memory)
26&nbsp;hal_flash_bytes_write(dest_addr&nbsp;,&nbsp;buffer&nbsp;,&nbsp;len);
27
28&nbsp;//&nbsp;wait&nbsp;forever
29&nbsp;while(1)&nbsp;{}
30&nbsp;}</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">最后，我们也对无线设备的不同组件所使用的2.4GHz无线通信做了分析。首先，我们使用软件定义的无线电，结合开源的软件无线电（GNU Radio）[14]以及修改版的NRF24-BTLE-Decoder软件[15]来完成这一任务。之后，我们又使用了基于nRF24的Crazyradio PA USB设备，配合Bastille的nRF研究固件以及我们自研的Python脚本和工具来测试特定的目标设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了分析基于nRF的键盘和USB设备所发送的增强型ShockBurst数据报文，我们使用了修改版的NRF24-BTLE-Decoder，对应的GRC（GNU Radio Companion，又称GR小伙伴）流程图如图9所示。</span></p><p style="text-align:center"><img src="http://p1.qhimg.com/t0126d32150885dbc67.png" title="t01ccc683184cfadf18.png" alt="http://p9.qhimg.com/t01ccc683184cfadf18.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">带有AES加密载荷的Cherry无线键盘所产生的增强型ShockBurst数据报文如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;$&nbsp;cat&nbsp;/tmp/fifo&nbsp;|&nbsp;./nrf24-decoder&nbsp;-d&nbsp;1
2&nbsp;nrf24-decoder,&nbsp;decode&nbsp;NRF24L01+&nbsp;v0.1
3
4&nbsp;(...)
5&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
6&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
7&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
8&nbsp;(...)
9&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
10&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
11&nbsp;Address:&nbsp;0x6BB7E29E31&nbsp;length:16,&nbsp;pid:0,&nbsp;no_ack:0,&nbsp;CRC:0x2D58&nbsp;data:0294EF5368E70FB11AB685B818819388
12&nbsp;(...)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">使用Crazyradio PA对nRF24无线通信进行分析应该是一种最简单同时也是最可靠的方法。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">四、攻击面以及攻击场景</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">针对被测试的桌面无线设备，我们设计了两种攻击场景，一种场景是攻击者对无线设备拥有不受限制的物理访问权限，另一种场景是攻击者只能通过无线信号对无线设备进行攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在第一种场景中，可用的攻击面主要为SoC上引脚的排列组合。在第二种场景中，攻击面仅包含无线通信。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这两种攻击场景中，特定的安全威胁可能存在不同的攻击形式。在研究项目中，我们感兴趣的几个攻击点如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、可以物理接触桌面无线设备时：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（1）提取固件</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（2）篡改固件</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（3）提取加密密钥</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（4）篡改加密密钥</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、通过无线信号攻击桌面无线设备时：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（1）攻击未经加密和授权的无线通信</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（2）重放攻击</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（3）按键注入攻击</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">（4）解密经过加密的通信数据</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">五、安全漏洞</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在整个研究项目中，我们可以在使用AES加密机制的无线设备中找到以下5类安全漏洞：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、缺乏对代码（固件）以及数据（加密密钥）的保护。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、没有对通信数据进行加密和认证。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、没有对重放攻击的进行防护。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、对重放攻击防护不到位。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、其他加密问题。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们会在下文详细阐述我们发现的所有漏洞，同时也会在安全公告中提及受影响的相关设备 [16-29]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.1 缺乏对代码和数据的保护</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们的研究中，被测试的5个设备中有3个设备的固件和AES加密密钥可以被我们读取，这3个设备分别为AES B.UNLIMITED、Microsoft Wireless Desktop 2000以及Perixx PERIDUA-710W。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于这3个基于nRF24的设备而言，我们有可能能够使用nrfprog软件，通过SPI接口访问设备的闪存（如图6和图7所示）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Cherry的USB设备所导出的内存镜像中包含AES密钥，如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;(...)
2&nbsp;00007430:&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;3cdd&nbsp;9cc7&nbsp;db74
3&nbsp;00007440:&nbsp;675a&nbsp;c0b2&nbsp;9796&nbsp;a55b&nbsp;913c&nbsp;0000&nbsp;0000&nbsp;0000
4&nbsp;00007450:&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000&nbsp;0000
5&nbsp;(...)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">与之匹配的Cherry键盘所导出的内存镜像中也包含相同的AES密钥，如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;00000000:&nbsp;aa32&nbsp;1d98&nbsp;5ef9&nbsp;3cdd&nbsp;9cc7&nbsp;db74&nbsp;675a&nbsp;c0b2
2&nbsp;00000010:&nbsp;9796&nbsp;a55b&nbsp;913c&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff
3&nbsp;00000020:&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff&nbsp;ffff
4&nbsp;(...)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">与被测试的Microsoft以及Perixx键盘相比，Cherry键盘并没有将加密密钥保存在普通的耐久性内存中，而是将其保存在扩展的耐久性内存中。对nRF24LE1而言，1.5Kb大小的非易失性内存（non-volatile memory，NVM）被分为2个256字节大小的扩展耐久性页面以及两个512字节大小的普通耐久性页面，如参考资料[12]所述。而EENVM（extended endurance non-volatile memory，扩展耐久性非易失性内存）无法通过SPI接口进行访问，如图10所示。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t016008b01478b28973.png" title="t019d7bafad66feb107.png" alt="http://p0.qhimg.com/t019d7bafad66feb107.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此，为了访问Cherry键盘中包含加密密钥的EEM（extended endurance memory，扩展耐久内存），我们需要研发具备memcpy功能的固件，将EEM中特定的内存区域拷贝到SPI可以访问的普通数据内存中。示例固件代码如清单3.1所示。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">由于无线设备对自身的代码（固件）及数据（加密密钥）保护不到位，可以物理接触设备的攻击者能够在几分钟之内，对存在漏洞的桌面无线设备进行攻击，提取设备所使用的AES密钥，并在后续攻击中，利用这个密钥以无线攻击模式远程攻击设备，或者篡改设备固件，比如，攻击者可以弱化设备所使用的加密程度。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对被测试的Cherry和Perixx键盘而言，攻击者有可能随意读取或访问设备内存。但这种攻击对Microsoft键盘来说并不适用，因为它使用了nRF24LE1的一次性可编程版本。攻击者只能将该设备闪存中的比特位从1改为0，但并不能从0改为1。但不论如何，我们还是可以在某种程度上修改设备的代码以及数据信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对基于nRF24的设备而言，只需简单的方法就能实现对设备代码及数据的更好的保护，那就是使用已有的回读保护功能（Read DISable Main Block，RDISMB，禁止读取主存储区），如图11所示。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t01e76d443c7646b754.png" title="t013acdcbd153a45832.png" alt="http://p1.qhimg.com/t013acdcbd153a45832.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">被测试的基于nRF24的4个设备中，只有Logitech键盘使用了这种功能，避免攻击者通过SPI接口对设备闪存进行读写。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.2 鼠标欺骗攻击</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们研究项目进行期间，我们发现被测试的所有无线鼠标的无线通信都没有经过加密及认证。因此，如果知道设备所使用的鼠标数据协议，攻击者就能模拟并欺骗鼠标的动作（比如鼠标移动或者鼠标点击动作）。这种攻击并不新颖，许多研究人员已经在最近几年中，在不同的场合下报告并分析了这类问题，但这种攻击能够奏效还是让我们非常兴奋。你没有看错，带有加密功能的现代桌面无线设备依然仅对键盘进行加密和认证处理，并没有对鼠标通信进行加密及认证处理，这的确存在安全风险。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者可以通过伪造数据包，以未授权方式远程控制目标系统的鼠标指针。如果（采用启发式方法）对目标系统进行针对性的尝试，这种鼠标欺骗攻击有可能会导致目标系统的远程代码执行漏洞。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">启发式攻击需要解决如下几个问题：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、操作系统（屏幕布局及内容）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、语言设定（屏幕布局及内容）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、鼠标设定（鼠标指针加速）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、操作系统中的虚拟键盘设定（窗口位置）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">根据我们的经验，使用启发式方法时最好还是遵循系统的默认设置，Windows 7中默认的鼠标设置、虚拟键盘（on-screen keyboard，OSK）的默认窗口位置及尺寸设置如图12所示。</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t014a78a28418837f10.png" title="t010ad993e8ed232f47.png" alt="http://p1.qhimg.com/t010ad993e8ed232f47.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这个研究项目中，我们研发了一款名为Radioactive Mouse的概念验证软件，来演示鼠标欺骗攻击场景。这款软件属于我们nRF24工具集的一部分[31]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对鼠标指针实现像素级别的控制听起来比较简单，但目前在实际中还不能完美实现。在鼠标加速方面，我们还需要做更多的研究工作（如对系统实际使用的算法进行逆向分析），例如，我们需要理清不同的Windows系统所使用的鼠标加速策略（实现代码位于win32k.sys中），来完成预定的操作行为。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此，我们的概念验证软件目前仍需要配合手动干预及减缓鼠标的运动轨迹，以完成较为稳定的攻击过程。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们使用被测试的无线鼠标，配合Crazyradio PA无线USB设备以及Bastille的nrf固件，通过鼠标欺骗攻击成功实现了目标系统的代码执行攻击场景，如图13及图14所示。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t013f0180feb87a48a4.png" title="t01d82446d3be931649.png" alt="http://p2.qhimg.com/t01d82446d3be931649.png"/></p><p style="text-align:center"><img src="http://p8.qhimg.com/t012e6fd80bc044a851.png" title="t019d59aa4addf6267a.png" alt="http://p9.qhimg.com/t019d59aa4addf6267a.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击视频已上传到YouTube上，标题为“Radioactive Mouse States the Obvious”[30]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.3 重放攻击</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们研究项目中，我们发现所有被测试的无线键盘及鼠标都会受到重放攻击影响，原因在于它们没有或者缺乏足够的保护机制来防御这类攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Microsoft Wireless Desktop 2000使用了重放攻击保护机制，但根据我们的研究结果，设备所用的有效报文计数器的窗口非常大，如果重放攻击时录制动作和重放动作之间只有少数几次按键点击，那么这种情况下攻击者就可以利用足够大的窗口期来实施重放攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于桌面无线设备来说，攻击者可以通过重放攻击完成以下两种攻击：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、在无人看守时，获取处于屏幕锁定状态下的计算机的未授权访问权限。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、物理接触目标桌面无线设备的USB收发器时，能以明文形式恢复用户的按键信息，例如，可以获取用户输入的密码信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">攻击者在不知道实际的通信协议的情况下（即黑盒模式下），可以使用软件定义的无线电进行重放攻击。使用软件定义的无线电进行重放攻击时所需的实验设备如图15所示。</span></p><p style="text-align:center"><img src="http://p6.qhimg.com/t0186909000d1627843.png" title="t014697baad60d8beb3.png" alt="http://p4.qhimg.com/t014697baad60d8beb3.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">以Fujitsu桌面无线设备为目标，我们实施重放攻击时所使用的GRC流程图如图16所示。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t010aa6a52be4377312.png" title="t010fa73bf87389e84b.png" alt="http://p2.qhimg.com/t010fa73bf87389e84b.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">复杂状态下的重放攻击需要使用特定的数据报文，我们可以将Crazyradio PA以及Bastille的nrf研究固件结合使用，实现复杂情况下的重放攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在这个研究项目中，我们开发了一款Python工具，名为Simple Replay Tool，我们使用这款工具来演示5个被测设备没有或缺乏重放攻击防护机制。针对Microsoft Wireless 2000键盘的重发攻击输出结果如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;#&nbsp;python&nbsp;simple_replay.py&nbsp;-c&nbsp;25
2&nbsp;_____&nbsp;______&nbsp;___&nbsp;_&nbsp;_&nbsp;_____&nbsp;_&nbsp;_
3&nbsp;|&nbsp;__&nbsp;\|&nbsp;____|__&nbsp;\|&nbsp;||&nbsp;|&nbsp;|&nbsp;__&nbsp;\|&nbsp;|&nbsp;|&nbsp;|
4&nbsp;_&nbsp;__&nbsp;|&nbsp;|__)&nbsp;|&nbsp;|__&nbsp;)&nbsp;|&nbsp;||&nbsp;|_&nbsp;|&nbsp;|__)&nbsp;|&nbsp;|&nbsp;__&nbsp;_&nbsp;_&nbsp;_&nbsp;___&nbsp;___|&nbsp;|_
5&nbsp;|&nbsp;&#39;_&nbsp;\|&nbsp;_&nbsp;/|&nbsp;__|&nbsp;/&nbsp;/|__&nbsp;_|&nbsp;|&nbsp;___/|&nbsp;|/&nbsp;_`&nbsp;|&nbsp;|&nbsp;|&nbsp;/&nbsp;__|/&nbsp;_&nbsp;\&nbsp;__|
6&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;\&nbsp;\|&nbsp;|&nbsp;/&nbsp;/_&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;(_|&nbsp;|&nbsp;|_|&nbsp;\__&nbsp;\&nbsp;__/&nbsp;|_
7&nbsp;|_|&nbsp;|_|_|&nbsp;\_\_|&nbsp;|____|&nbsp;|_|&nbsp;|_|&nbsp;|_|\__,_|\__,&nbsp;|___/\___|\__|
8&nbsp;__/&nbsp;|
9&nbsp;|___/
10&nbsp;Simple&nbsp;Replay&nbsp;Tool&nbsp;v0.2&nbsp;by&nbsp;Matthias&nbsp;Deeg&nbsp;-&nbsp;SySS&nbsp;GmbH&nbsp;(c)&nbsp;2016
11&nbsp;[*]&nbsp;Configure&nbsp;nRF24&nbsp;radio
12&nbsp;[*]&nbsp;Scanning&nbsp;for&nbsp;wireless&nbsp;keyboard&nbsp;...
13&nbsp;[+]&nbsp;Received&nbsp;data:&nbsp;083816010100f32a
14&nbsp;[+]&nbsp;Found&nbsp;nRF24&nbsp;device&nbsp;with&nbsp;address&nbsp;A9:A9:8F:EB:CD&nbsp;on&nbsp;channel&nbsp;25
15&nbsp;[?]&nbsp;Attack&nbsp;this&nbsp;device&nbsp;(y/n)?&nbsp;y
16&nbsp;[*]&nbsp;Start&nbsp;recording&nbsp;(&lt;CTRL+C&gt;&nbsp;to&nbsp;stop&nbsp;recording)
17&nbsp;[+]&nbsp;Received&nbsp;data:&nbsp;09981601dea2f3157ec032fcfa34ce70dee330c9
18&nbsp;[+]&nbsp;Received&nbsp;data:&nbsp;09981601dea2f3157ec032fcfa34ce70dee330c9…
19&nbsp;()
20&nbsp;^C
21&nbsp;[*]&nbsp;Stop&nbsp;recording
22&nbsp;[*]&nbsp;Press&nbsp;&lt;ENTER&gt;&nbsp;to&nbsp;replay&nbsp;the&nbsp;recorded&nbsp;data&nbsp;packets&nbsp;or&nbsp;&lt;CTRL+C&gt;&nbsp;to&nbsp;quit&nbsp;...
23&nbsp;[+]&nbsp;Send&nbsp;data:&nbsp;09981601dea2f3157ec032fcfa34ce70dee330c9
24&nbsp;[+]&nbsp;Send&nbsp;data:&nbsp;09981601dea2f3157ec032fcfa34ce70dee330c9…
25&nbsp;()</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">通过这款概念验证软件，我们成功完成了本节开头描述的两种攻击形式。通过物理接触USB收发器，记录下键盘按键所对应的无线通信数据，我们成功搞定了处于屏幕锁定状态下计算机系统的未授权访问权限，也成功恢复了明文的按键信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5.4 按键注入攻击</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这5个测试设备中有3个存在加密问题，会受到按键注入攻击影响，这也是我们发现的最后一个安全漏洞（但并不意味着漏洞分量最轻）。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">被测试的Cherry、Perixx以及Logitech键盘在计数器模式中使用了AES加密方式，密钥位数为128位（AES-128-CTR）。通常情况下，初始化向量（IV）包含一个随机数（nonce）以及一个计数器（counter）。例如，被测Cherry键盘所使用的随机值包含11个NULL字节（即值为0x00的11个字节），所使用的计数值为一个随机的5字节数据。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们已经在基于无线电的分析中，看到过被测设备在无线通信中使用了AES加密算法，通过SPI接口篡改Cherry键盘的固件，我们可以对这一结果有更深入的分析及理解。为了分析设备固件，我们仔细研究了nRF24 SDK以及官方提供的源代码，这些资料都非常具有价值。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">比如，在lib_crypt.h源代码中，我们发现代码中有些注释非常有趣，比如有注释介绍了nRF24LU1以及nRF24LE1在加密库实现方式上的区别，以及nRF24LE1所用的计数器（LS5B）的相关信息，如清单5.1所示。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;/*
2&nbsp;(...)
3&nbsp;*&nbsp;@brief&nbsp;Example&nbsp;implementation&nbsp;for&nbsp;encrypting/decrypting&nbsp;data
4&nbsp;*
5&nbsp;*&nbsp;The&nbsp;encryption&nbsp;is&nbsp;based&nbsp;on&nbsp;AES&nbsp;counter&nbsp;mode&nbsp;(CTR)&nbsp;where&nbsp;a&nbsp;128&nbsp;bit&nbsp;hybrid&nbsp;counter
6&nbsp;*&nbsp;is&nbsp;used&nbsp;for&nbsp;encryption/decryption.&nbsp;The&nbsp;counter&nbsp;is&nbsp;split&nbsp;in&nbsp;two&nbsp;,&nbsp;11&nbsp;bytes&nbsp;as&nbsp;MS11B
7&nbsp;*&nbsp;and&nbsp;5&nbsp;bytes&nbsp;as&nbsp;LS5B.&nbsp;The&nbsp;LS5B&nbsp;part&nbsp;is&nbsp;not&nbsp;secret&nbsp;and&nbsp;tells&nbsp;the&nbsp;receiver&nbsp;how
8&nbsp;*&nbsp;to&nbsp;decrypt&nbsp;an&nbsp;encrypted&nbsp;message.
9&nbsp;(...)
10&nbsp;*&nbsp;Note&nbsp;that&nbsp;the&nbsp;security&nbsp;of&nbsp;the&nbsp;link&nbsp;will&nbsp;not&nbsp;be&nbsp;reduced&nbsp;as&nbsp;a&nbsp;consequence&nbsp;of&nbsp;sending
11&nbsp;*&nbsp;the&nbsp;counter&nbsp;value&nbsp;in&nbsp;plain&nbsp;text&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;following&nbsp;criteria&nbsp;are&nbsp;met:
12&nbsp;*
13&nbsp;*&nbsp;-&nbsp;Cipher&nbsp;key&nbsp;used&nbsp;for&nbsp;encryption/decryption&nbsp;must&nbsp;be&nbsp;kept&nbsp;secret.
14&nbsp;*&nbsp;-&nbsp;The&nbsp;plain&nbsp;text&nbsp;counter&nbsp;(LS5B)&nbsp;must&nbsp;be&nbsp;modified&nbsp;for&nbsp;each&nbsp;transfer.
15&nbsp;(...)
16&nbsp;*&nbsp;The&nbsp;library&nbsp;can&nbsp;be&nbsp;used&nbsp;on&nbsp;both&nbsp;nRF24LU1&nbsp;and&nbsp;nRF24LE1&nbsp;devices&nbsp;,&nbsp;but&nbsp;the&nbsp;implementation
17&nbsp;*&nbsp;is&nbsp;slightly&nbsp;different&nbsp;between&nbsp;these.&nbsp;In&nbsp;the&nbsp;nRF24LE1&nbsp;implementation&nbsp;the&nbsp;LS5B&nbsp;is&nbsp;not
18&nbsp;*&nbsp;a&nbsp;counter&nbsp;,&nbsp;but&nbsp;random&nbsp;values&nbsp;generated&nbsp;by&nbsp;the&nbsp;embedded&nbsp;random&nbsp;number&nbsp;generator.
19&nbsp;*&nbsp;The&nbsp;reason&nbsp;for&nbsp;this&nbsp;is&nbsp;that&nbsp;the&nbsp;counter&nbsp;value&nbsp;would&nbsp;have&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;data&nbsp;memory
20&nbsp;*&nbsp;in&nbsp;between&nbsp;each&nbsp;packet&nbsp;,&nbsp;which&nbsp;is&nbsp;not&nbsp;possible&nbsp;when&nbsp;residing&nbsp;in&nbsp;&quot;deep&nbsp;sleep&quot;&nbsp;power&nbsp;save
21&nbsp;*&nbsp;mode.
22&nbsp;(...)
23&nbsp;*/</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">此外，我们也阅读了SDK中的一些源码，分析了5字节的随机计数值（LS5B）的生成算法，如清单5.2所示。</span><br/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;(...)
2&nbsp;void&nbsp;lib_crypt_generate_ls5b(uint8_t&nbsp;*&nbsp;dest_buf)
3&nbsp;{
4&nbsp;uint8_t&nbsp;i;
5&nbsp;hal_rng_power_up(true);
6
7&nbsp;for(i=0;i&lt;5;i++)
8&nbsp;{
9&nbsp;while(!hal_rng_data_ready&nbsp;())
10&nbsp;{}
11&nbsp;dest_buf[i]&nbsp;=&nbsp;hal_rng_read();
12&nbsp;}
13
14&nbsp;hal_rng_power_up(false);
15&nbsp;}
16&nbsp;(...)</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们还发现明文形式的按键释放报文中只包含NULL字节，比如，对我们测试的Cherry键盘而言，明文报文中只包含11个NULL字节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此，在无线设备所使用的计数器模式加密流程中，攻击者能够得知设备发送的按键释放报文中的几项的信息，这几项信息已在图17中用红圈标出。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t0129dcd5f17d219237.png" title="t01ae9c98a762aa6899.png" alt="http://p1.qhimg.com/t01ae9c98a762aa6899.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对Cherry AES B.Unlimited这个设备而言，已知的问题如下所示：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、随机数被硬编码为11个NULL字节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、计数器为一个5字节的随机值，这个值可以被重复使用（参考5.3节所述的重放攻击内容），并且通过ShockBurst无线通信模式以明文形式发送这个数值。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、使用ShockBurst无线通信模式发送密文形式的按键释放报文。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、明文形式的按键释放报文为11个NULL字节。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、对于带有特定IV（随机值+计数器）的按键释放报文而言，其按键流（keystream）数据块为11个NULL字节（即按键释放报文的内容），因为任意x与0异或结果都为x。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">因此，攻击者可以任意篡改按键释放报文，实施按键注入攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">为了完成攻击任务，攻击者需要知道用于发送按键信息的实际数据格式。既然攻击者可以访问设备固件，通过分析固件的实际代码或不断的试错过程，他们有可能能够找出设备实际使用的数据格式，以及需要修改哪些比特位或者字节数据才能成功完成按键注入攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">例如，Cherry AES B.Unlimited键盘在按键数据中使用的USB HID数据格式如图18所示。</span></p><p style="text-align:center"><img src="http://p7.qhimg.com/t01ad1cbf4ad5ab55e7.png" title="t012aa992aa257b4f87.png" alt="http://p0.qhimg.com/t012aa992aa257b4f87.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这种USB HID数据格式所使用的修饰符及键盘代码如下所示：</span></p><p style="text-align:center"><img src="http://p9.qhimg.com/t01f289b39b4cd997ea.png" title="t01c8ae275d162f8f01.png" alt="http://p1.qhimg.com/t01c8ae275d162f8f01.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用大写字母A来进行按键注入攻击的案例如图19所示。</span></p><p style="text-align:center"><img src="http://p4.qhimg.com/t01809fea7885f2a94e.png" title="t011c268d5f0ae37964.png" alt="http://p1.qhimg.com/t011c268d5f0ae37964.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">通常情况下，攻击者只需要经过如下5个步骤就能实施按键注入攻击：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、找到目标设备（无线键盘）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、找到按键释放报文（通过启发式方法）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、做些简单的数学运算</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、发送修改过的按键释放报文，尝试按键注入</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、重复步骤3&amp;4，直至攻击成功</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们这个研究项目中，针对存在这类漏洞的目标设备，我们研发了几个概念验证软件来进行按键注入攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用我们的工具对Perixx键盘进行按键注入攻击的输出结果如下所示。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;#&nbsp;python&nbsp;keystroke_injector.py&nbsp;-c&nbsp;6&nbsp;11&nbsp;28&nbsp;32&nbsp;39&nbsp;65&nbsp;75&nbsp;80&nbsp;-d&nbsp;perixx
2&nbsp;_____&nbsp;______&nbsp;___&nbsp;_&nbsp;_&nbsp;_____&nbsp;_&nbsp;_
3&nbsp;|&nbsp;__&nbsp;\|&nbsp;____|__&nbsp;\|&nbsp;||&nbsp;|&nbsp;|&nbsp;__&nbsp;\|&nbsp;|&nbsp;|&nbsp;|
4&nbsp;_&nbsp;__&nbsp;|&nbsp;|__)&nbsp;|&nbsp;|__&nbsp;)&nbsp;|&nbsp;||&nbsp;|_&nbsp;|&nbsp;|__)&nbsp;|&nbsp;|&nbsp;__&nbsp;_&nbsp;_&nbsp;_&nbsp;___&nbsp;___|&nbsp;|_
5&nbsp;|&nbsp;&#39;_&nbsp;\|&nbsp;_&nbsp;/|&nbsp;__|&nbsp;/&nbsp;/|__&nbsp;_|&nbsp;|&nbsp;___/|&nbsp;|/&nbsp;_`&nbsp;|&nbsp;|&nbsp;|&nbsp;/&nbsp;__|/&nbsp;_&nbsp;\&nbsp;__|
6&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;\&nbsp;\|&nbsp;|&nbsp;/&nbsp;/_&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;|&nbsp;(_|&nbsp;|&nbsp;|_|&nbsp;\__&nbsp;\&nbsp;__/&nbsp;|_
7&nbsp;|_|&nbsp;|_|_|&nbsp;\_\_|&nbsp;|____|&nbsp;|_|&nbsp;|_|&nbsp;|_|\__,_|\__,&nbsp;|___/\___|\__|
8&nbsp;__/&nbsp;|
9&nbsp;|___/
10&nbsp;Keystroke&nbsp;Injector&nbsp;v0.7&nbsp;by&nbsp;Matthias&nbsp;Deeg&nbsp;-&nbsp;SySS&nbsp;GmbH&nbsp;(c)&nbsp;2016
11&nbsp;[*]&nbsp;Configure&nbsp;nRF24&nbsp;radio
12&nbsp;[*]&nbsp;Set&nbsp;keyboard:&nbsp;Perixx
13&nbsp;[*]&nbsp;Scanning&nbsp;for&nbsp;wireless&nbsp;keyboard&nbsp;...
14&nbsp;[+]&nbsp;Found&nbsp;nRF24&nbsp;device&nbsp;with&nbsp;address&nbsp;15:25:D8:AB:23&nbsp;on&nbsp;channel&nbsp;65
15&nbsp;[?]&nbsp;Attack&nbsp;this&nbsp;device&nbsp;(y/n)?&nbsp;y
16&nbsp;[*]&nbsp;Search&nbsp;for&nbsp;crypto&nbsp;key&nbsp;(actually&nbsp;a&nbsp;key&nbsp;release&nbsp;packet)&nbsp;...
17&nbsp;[+]&nbsp;Found&nbsp;crypto&nbsp;key
18&nbsp;[*]&nbsp;Please&nbsp;choose&nbsp;your&nbsp;attack&nbsp;vector&nbsp;(0&nbsp;to&nbsp;quit)
19&nbsp;1)&nbsp;Open&nbsp;calc.exe
20&nbsp;2)&nbsp;Open&nbsp;cmd.exe
21&nbsp;3)&nbsp;Classic&nbsp;download&nbsp;&amp;&nbsp;execute&nbsp;attack
22&nbsp;0)&nbsp;Exit
23&nbsp;[?]&nbsp;Select&nbsp;keystroke&nbsp;injection&nbsp;attack:&nbsp;3
24&nbsp;[*]&nbsp;Start&nbsp;keystroke&nbsp;injection&nbsp;...
25&nbsp;[*]&nbsp;Done.</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">我们使用自研的Cherry Attack概念验证工具对存在漏洞的Cherry键盘进行攻击，如图20所示。</span></p><p style="text-align:center"><img src="http://p8.qhimg.com/t010ef60ffbc6f3c6b1.png" title="t01e30ff0175dab6c71.png" alt="http://p9.qhimg.com/t01e30ff0175dab6c71.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">如何对AES计数器模式中存在的这种加密问题加以利用呢？其实这并不是一件难事，部分利用代码如清单5.3所示。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><pre class="brush:plain;toolbar:false">1&nbsp;def&nbsp;keyCommand(self&nbsp;,&nbsp;modifiers&nbsp;,&nbsp;keycode1&nbsp;,&nbsp;keycode2&nbsp;=&nbsp;KEY_NONE&nbsp;,&nbsp;keycode3&nbsp;=&nbsp;KEY_NONE&nbsp;,&nbsp;keycode4&nbsp;=&nbsp;KEY_NONE&nbsp;,&nbsp;keycode5&nbsp;=&nbsp;KEY_NONE&nbsp;,&nbsp;keycode6&nbsp;=&nbsp;KEY_NONE):
2&nbsp;&quot;&quot;&quot;&nbsp;Return&nbsp;AES&nbsp;encrypted&nbsp;keyboard&nbsp;data&quot;&quot;&quot;
3
4&nbsp;#&nbsp;generate&nbsp;HID&nbsp;keyboard&nbsp;data
5&nbsp;plaintext&nbsp;=&nbsp;pack(&quot;8B&quot;,&nbsp;modifiers&nbsp;,&nbsp;0,&nbsp;keycode1&nbsp;,&nbsp;keycode2&nbsp;,&nbsp;keycode3&nbsp;,
6&nbsp;keycode4&nbsp;,&nbsp;keycode5&nbsp;,&nbsp;keycode6)
7
8&nbsp;#&nbsp;encrypt&nbsp;the&nbsp;data&nbsp;with&nbsp;the&nbsp;set&nbsp;crypto&nbsp;key
9&nbsp;ciphertext&nbsp;=&nbsp;&quot;&quot;
10&nbsp;i&nbsp;=&nbsp;0
11for&nbsp;b&nbsp;in&nbsp;plaintext:
12&nbsp;ciphertext&nbsp;+=&nbsp;chr(ord(b)&nbsp;^&nbsp;ord(self.cryptoKey[i]))
13&nbsp;i&nbsp;+=&nbsp;1
14
15&nbsp;return&nbsp;ciphertext&nbsp;+&nbsp;self.counter</pre><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了演示我们所找到的按键注入漏洞，我们搭建了一个简单的设备，名为SySS Radio Hack Box[32]，这款设备的第一个原型版本如图21所示。</span><br/></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01f555e941b62578a7.png" title="t01b3bc76fe716dbf10.png" alt="http://p3.qhimg.com/t01b3bc76fe716dbf10.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这个原型设备是在树莓派的基础上搭建而成的，我们手动焊接了一个非常简单的树莓派扩展板，与带有自定义Python脚本的Crazyradio PA搭配使用，如图22所示。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t012de075c06197027c.png" title="t016a532df0a18431f1.png" alt="http://p7.qhimg.com/t016a532df0a18431f1.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们录制了如何使用SySS Radio Hack Box对无线设备实施按键重放注入攻击的视频，并将视频上传到YouTube网站上[33]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">六、设备厂商的声明及反馈</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">根据我们的漏洞披露计划，我们通过安全公告形式，向所有存在安全漏洞的设备所对应的厂商报告了相关的漏洞信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">根据我们的漏洞披露策略，我们在一段时间后向公众公布了所有的安全公告[34]。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们收到的设备厂商的声明及反馈如下文所述。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.1 Perixx</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于Perixx PERIDUO-710W桌面无线设备中存在的安全问题，Perixx没有任何反馈信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.2 Microsoft</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于Microsoft Wireless Desktop 2000中代码及数据缺乏安全防护的问题，微软的反馈信息如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“根据您在邮件里提供的信息，由于每个桌面无线设备所使用的加密密钥都不相同，因此这种攻击不具备普遍性。此外攻击需要物理接触键盘，同时还需要嗅探数据报文才能使用窃取的密钥来解密数据。如果攻击者可以打开键盘，导出闪存数据，攻击者同样也能够修改整个键盘。因此，这个漏洞不符合漏洞安全服务标准。我们会将这个问题提交给核心团队，评估是否需要在本产品的下个版本进行修改。”</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于鼠标欺骗攻击而言，微软的声明如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“这种行为符合我们的产品设计方案，因此我们不会对这个产品发布安全更新。”</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于重放攻击而言，微软的声明如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“我们正在验证对这个问题的修复措施是否能够生效，希望能够通过修复措施解决这一问题。由于这个问题存在于USB设备的固件中，我们仍在研究是否只能在后续生产的USB设备中解决这一问题，还是可以通过某种办法解决存在这一问题的所有USB设备。“</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.3 Logitech</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于Logitech MK520设备而言，罗技的反馈如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“非常感谢安全团队对这一产品的重视，请相信罗技会在未来的产品中提供更为安全的加密方案。“</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.4 Fujitsu</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于我们在Fujitsu LX901无线键盘中发现的重放攻击问题，富士通的反馈如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“非常感谢您对我们无线键盘安全问题的通知。正如我们前面提到过的那样，根据设备所使用的无线协议，您描述的攻击场景在现实生活中难以具体操作。我们销售产品的重点不是在于产品安全性上，而在于产品的易用性上（保证未加密的无线键盘不存在重大安全缺陷即可）。我们将在后续产品中考虑您提出的任何新意见 。“</span></p><p style="text-indent: 2em; text-align: left;"><span style="color: rgb(0, 112, 192); font-size: 18px;"><strong><span style="color: rgb(0, 112, 192); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6.5 Cherry</span></strong></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于我们在Cherry AES B.Unlimited中发现的安全漏洞，Chery的声明如下：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">“我们已经检查了您提交的‘安全漏洞’。我们决定未来在推广这个产品时，不再提及AES加密机制。目前，我们正在研究一款后续产品。正如我们一贯强调的那样，如果我们的客户在安全性上要求较高，我们推荐他们使用通过CC认证的有线产品。“</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">七、总结</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">在整个研究项目中，使用AES加密算法的5个现代桌面无线设备都存在安全漏洞。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">总的来说，我们发现了5类安全问题，可以用于实施特定的攻击：</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1、对代码（固件）及数据（加密密钥）保护不足</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">导致攻击者能够访问敏感数据。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2、通信数据没有经过加密或者认证</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">导致攻击者能够实施鼠标欺骗攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3、缺乏防御重放攻击的保护机制</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">导致攻击者能够实施重放攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4、对重放攻击保护不到位</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">导致攻击者能够实施重放攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5、加密问题</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">导致攻击者能够实施按键注入攻击。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">表6总结了我们的研究成果。</span></p><p style="text-align:center"><img src="http://p0.qhimg.com/t01a69dddb051ed867b.png" title="t01dde4b1246ec50d84.png" alt="http://p9.qhimg.com/t01dde4b1246ec50d84.png"/></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">√ 存在安全问题</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">× 不存在安全问题</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">? 可能存在安全问题（需要进一步调研）</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">* Bastille Networks首先向罗技报告了这个问题</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">根据我们的经验，我们认为所有发现的安全漏洞都能在现实世界的攻击场景中加以利用，而不单单局限于实验环境中。事实上，在过去的几个月内，我们已经在渗透测试中使用了其中一些安全漏洞。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">对于被测试的这几个版本的产品，厂商可能不会发布安全更新来修复这些安全漏洞，但有可能会在后续版本中修复这些问题。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">我们的研究结果表明，不同厂商的现代桌面无线设备的安全级别也有所不同，某些设备会比其他设备更为安全。然而，现实中并不存在没有任何安全问题的桌面无线设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">SySS不推荐人们在对安全有所要求的环境中使用存在已知安全漏洞的这些桌面无线设备。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">在我们的研究过程期间，Bastille威胁研究团队也独立地在几个桌面无线设备中发现了多个安全漏洞，这些设备是不同厂商生产的具备AES加密机制的无线设备。读者可以在他们的网站上找到一个名为KeyJack的研究项目[35]，了解更多信息。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2016年，我们在不同的IT安全大会上展示了我们的研究成果。例如，我们在Hack.lu 2016 IT安全大会上展示了无线鼠标和键盘上存在的安全问题，演讲主题为“现代桌面无线设备的安全性分析”，相关的汇报PPT及视频可以在[36, 37]中找到。</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-indent: 2em; text-align: left;"><span style="font-size: 18px;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">八、参考资料</span></strong></span></p><hr/><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">[1] Dreamlab Technologies, KeyKeriki v2.0 – 2.4 GHz, <a href="http://www.remote-exploit.org/articles/keykeriki_v2_0__8211_2_4ghz/" _src="http://www.remote-exploit.org/articles/keykeriki_v2_0__8211_2_4ghz/">http://www.remote-exploit.org/articles/keykeriki_v2_0__8211_2_4ghz/</a>&nbsp;, 2010 (Cited on page 1.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[2] Samy Kamkar, KeySweeper, <a href="http://samy.pl/keysweeper" _src="http://samy.pl/keysweeper">http://samy.pl/keysweeper</a>&nbsp;, 2015 (Cited on page 1.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[3] Travis Goodspeed, Promiscuity is the nRF24L01+’s Duty, <a href="http://travisgoodspeed.blogspot.de/2011/02/promiscuity-is-nrf24l01s-duty.html" _src="http://travisgoodspeed.blogspot.de/2011/02/promiscuity-is-nrf24l01s-duty.html">http://travisgoodspeed.blogspot.de/2011/02/promiscuity-is-nrf24l01s-duty.html</a>&nbsp;, 2011 (Cited on page 1.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[4] Bastille Networks Internet Security, MouseJack, <a href="https://www.mousejack.com/" _src="https://www.mousejack.com/">https://www.mousejack.com/</a>&nbsp;, 2016 (Cited on page 1.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[5] Great Scott Gadgets, HackRF One, <a href="https://greatscottgadgets.com/hackrf/" _src="https://greatscottgadgets.com/hackrf/">https://greatscottgadgets.com/hackrf/</a>&nbsp;(Cited on page 2.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[6] Ettus Research, USRP B200, <a href="https://www.ettus.com/product/details/UB200-KIT" _src="https://www.ettus.com/product/details/UB200-KIT">https://www.ettus.com/product/details/UB200-KIT</a>&nbsp;(Cited on page 2.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[7] Bitcraze, Crazyradio PA, <a href="https://www.bitcraze.io/crazyradio-pa/" _src="https://www.bitcraze.io/crazyradio-pa/">https://www.bitcraze.io/crazyradio-pa/</a>&nbsp;(Cited on page 2.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[8] Bastille Networks Internet Security, nrf-research-firmware, <a href="https://github.com/BastilleResearch/nrf-research-firmware" _src="https://github.com/BastilleResearch/nrf-research-firmware">https://github.com/BastilleResearch/nrf-research-firmware</a>&nbsp;, 2016 (Cited on page 3.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[9] Dangerous Prototypes, Bus Pirate, <a href="http://dangerousprototypes.com/docs/Bus_Pirate" _src="http://dangerousprototypes.com/docs/Bus_Pirate">http://dangerousprototypes.com/docs/Bus_Pirate</a>&nbsp;, (Cited on page 5.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[10] Dangerous Prototypes, nrfprog, <a href="https://github.com/JoseJX/nrfprog" _src="https://github.com/JoseJX/nrfprog">https://github.com/JoseJX/nrfprog</a>&nbsp;, (Cited on page 5.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[11] Hex-Rays, Interactive Disassembler Pro, <a href="https://www.hex-rays.com/products/ida/index.shtml" _src="https://www.hex-rays.com/products/ida/index.shtml">https://www.hex-rays.com/products/ida/index.shtml</a>&nbsp;(Cited on page 7.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[12] Nordic Semiconductor, Nordic Semiconductor nRF24LE Product Specification v1.6, <a href="http://www.nordicsemi.com/eng/content/download/2443/29442/file/nRF24LE1_Product_Specification_rev1_6.pdf" _src="http://www.nordicsemi.com/eng/content/download/2443/29442/file/nRF24LE1_Product_Specification_rev1_6.pdf">http://www.nordicsemi.com/eng/content/download/2443/29442/file/nRF24LE1_Product_Specification_rev1_6.pdf</a>&nbsp;(Cited on pages 4, 5, 7, and 12.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[13] Nordic Semiconductor, nRF24L01+ Evaluation Kit, <a href="https://www.nordicsemi.com/eng/nordic/download_resource/9620/7/85171947/2434" _src="https://www.nordicsemi.com/eng/nordic/download_resource/9620/7/85171947/2434">https://www.nordicsemi.com/eng/nordic/download_resource/9620/7/85171947/2434</a>&nbsp;(Cited on page 7.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[14] GNU Radio <a href="https://en.wikipedia.org/wiki/GNU_Radio" _src="https://en.wikipedia.org/wiki/GNU_Radio">https://en.wikipedia.org/wiki/GNU_Radio</a>&nbsp;(Cited on page 9.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[15] Omri Iluz, NRF24-BTLE-Decoder, https://github.com/omriiluz/NRF24-BTLE-Decoder, 2016 (Cited on page 9.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[16] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-031, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-031.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-031.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-031.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[17] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-032, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-032.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-032.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-032.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[18] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-033, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-033.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-033.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-033.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[19] Matthias Deeg and Gerhard Klostermeier SySS Security Advisory SYSS-2016-038, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-038.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-038.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-038.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[20] Matthias Deeg and Gerhard Klostermeier SySS Security Advisory SYSS-2016-043, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-043.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-043.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-043.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[21] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-044, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-044.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-044.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-044.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[22] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-045, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-045.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-045.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-045.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[23] Matthias Deeg and Gerhard Klostermeier, SySS Security Advisory SYSS-2016-046, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-046.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-046.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-046.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[24] Matthias Deeg and Gerhard Klostermeier, SySS Security Advisory SYSS-2016-047, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-047.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-047.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-047.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[25] Matthias Deeg and Gerhard Klostermeier, SySS Security Advisory SYSS-2016-058, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-058.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-058.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-058.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[26] Matthias Deeg and Gerhard Klostermeier, SySS Security Advisory SYSS-2016-059, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-059.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-059.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-059.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[27] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-060, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-060.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-060.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-060.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[28] Gerhard Klostermeier and Matthias Deeg, SySS Security Advisory SYSS-2016-061, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-061.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-061.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-061.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[29] Matthias Deeg and Gerhard Klostermeier, SySS Security Advisory SYSS-2016-068, <a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-068.txt" _src="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-068.txt">https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2016-068.txt</a>&nbsp;, 2016 (Cited on page 11.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[30] SySS GmbH, Radioactive Mouse States the Obvious – Proof-of-Concept Video, <a href="https://www.youtube.com/watch?v=PkR8EODee44" _src="https://www.youtube.com/watch?v=PkR8EODee44">https://www.youtube.com/watch?v=PkR8EODee44</a>&nbsp;, 2016 (Cited on page 15.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[31] Matthias Deeg and Gerhard Klostermeier, nRF24 Playset, <a href="https://github.com/SySS-Research/nrf24-playset" _src="https://github.com/SySS-Research/nrf24-playset">https://github.com/SySS-Research/nrf24-playset</a>&nbsp;, 2017 (Cited on page 13.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[32] Matthias Deeg and Gerhard Klostermeier, SySS Radio Hack Box, <a href="https://github.com/SySS-Research/radio-hackbox" _src="https://github.com/SySS-Research/radio-hackbox">https://github.com/SySS-Research/radio-hackbox</a>&nbsp;, 2017 (Cited on page 21.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[33] SySS GmbH, SySS Radio Hack Box a.k.a. SySS Cherry Picker Demo Video, <a href="https://www.youtube.com/watch?v=KMlmd-LhMmo" _src="https://www.youtube.com/watch?v=KMlmd-LhMmo">https://www.youtube.com/watch?v=KMlmd-LhMmo</a>&nbsp;, 2016 (Cited on page 22.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[34] SySS GmbH, SySS Responsible Disclosure Policy, <a href="https://www.syss.de/en/responsible-disclosure-policy/" _src="https://www.syss.de/en/responsible-disclosure-policy/">https://www.syss.de/en/responsible-disclosure-policy/</a>&nbsp;(Cited on page 23.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[35] Bastille Networks Internet Security, KeyJack, <a href="https://www.bastille.net/research/vulnerabilities/keyjack/keyjack-intro/" _src="https://www.bastille.net/research/vulnerabilities/keyjack/keyjack-intro/">https://www.bastille.net/research/vulnerabilities/keyjack/keyjack-intro/</a>&nbsp;, 2016 (Cited on page 27.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[36] Matthias Deeg and Gerhard Klostermeier, Of Mice and Keybords (Slides), Hack.lu 2016, <a href="http://archive.hack.lu/2016/Of_Mice_and_Keyboards-Hack.lu_2016.pdf" _src="http://archive.hack.lu/2016/Of_Mice_and_Keyboards-Hack.lu_2016.pdf">http://archive.hack.lu/2016/Of_Mice_and_Keyboards-Hack.lu_2016.pdf</a>&nbsp;, 2016 (Cited on page 27.)</span></p><p style="text-indent: 2em; text-align: left;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">[37] Matthias Deeg and Gerhard Klostermeier, Of Mice and Keybords (Talk), Hack.lu 2016, <a href="https://www.youtube.com/watch?v=Ja_VgUMz43Q" _src="https://www.youtube.com/watch?v=Ja_VgUMz43Q">https://www.youtube.com/watch?v=Ja_VgUMz43Q</a>&nbsp;, 2016 (Cited on page 27.)</span></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://www.exploit-db.com/docs/42109.pdf" target="_blank">原文链接：https://www.exploit-db.com/docs/42109.pdf</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】现代无线鼠标及键盘的安全性分析报告 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3986" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
