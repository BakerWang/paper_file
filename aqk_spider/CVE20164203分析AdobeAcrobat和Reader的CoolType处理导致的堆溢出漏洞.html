<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>CVE-2016-4203分析：Adobe Acrobat和Reader 的CoolType处理导致的堆溢出漏洞 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="CVE-2016-4203,分析,Adobe Acrobat,Reader,CoolType,堆溢出漏洞"/>
    
        <meta name="description" content="最近,Adobe公司修复了Adobe Acrobat和Reader中的一些安全漏洞。其中一个是我们近期发现的堆缓冲区溢出漏洞(CVE - 2016 - 4203)。本博客中,我们想分享一些我们对这个漏洞的分析。"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>CVE-2016-4203分析：Adobe Acrobat和Reader 的CoolType处理导致的堆溢出漏洞</h2>
                <div class="article-msg">
                    <span class="time">2016-07-21 16:59:39</span>
                    
                                        <span class="read">阅读：15547次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_2921"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="2921" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="https://blog.fortinet.com/2016/07/20/analysis-of-cve-2016-4203-adobe-acrobat-and-reader-cooltype-handling-heap-overflow-vulnerability"
                             target="_blank">来源： 360安全播报</a></span>
                    
                    
                    <div style="margin-top:10px; ">
                        <a href="/member/contribute?uid=2685139420" style="color:#848e99;">
                            <img src="http://p1.qhmsg.com/dm/150_150_100/t01db4a1d58aa0341cc.jpg" data-is-avatar="true"
                                 style="border: 1px solid #d5d5d5;padding: 2px; width: 80px;height: 80px;border-radius: 43px;"/>
                        </a>

                    </div>
                    <span class="orig">作者：<a href="/member/contribute?uid=2685139420" style="color:#848e99;">mpk_no1</a></span>
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-align: center; text-indent: 2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"><img src="http://p9.qhimg.com/t01759eccca65c61978.png" title="t017d61bc1d77d84720.png" alt="http://p4.qhimg.com/t017d61bc1d77d84720.png"/>&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="color: rgb(84, 141, 212); font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"><strong>综述</strong></span></p><p style="text-align:left;text-indent:2em;"><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(0, 176, 80);">最近,Adobe公司修复了Adobe Acrobat和Reader中的一些安全漏洞。其中一个是我们近期发现的堆缓冲区溢出漏洞(CVE - 2016 - 4203)。本博客中,我们想分享一些我们对这个漏洞的分析。</span></strong></p><hr/><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span></p><p style="text-align:left;text-indent:2em;"><span style="color:rgb(84,141,212);"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">概念验证</span></strong></span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">可以通过用Adobe Reader DC打开PoC文件“poc_minimized.pdf”的方式来重现这个漏洞。当打开该文件时,AcroRd32.exe就会崩溃,崩溃信息如下所示:</span></p><pre class="brush:cpp;toolbar:false">(8de0.6bc4):&nbsp;Access&nbsp;violation&nbsp;-&nbsp;code&nbsp;c0000005&nbsp;(first&nbsp;chance)
First&nbsp;chance&nbsp;exceptions&nbsp;are&nbsp;reported&nbsp;before&nbsp;any&nbsp;exception&nbsp;handling.
This&nbsp;exception&nbsp;may&nbsp;be&nbsp;expected&nbsp;and&nbsp;handled.
eax=097eeeed&nbsp;ebx=00000015&nbsp;ecx=097ef6e0&nbsp;edx=0000cc6c&nbsp;esi=2952d000&nbsp;edi=00000024
eip=0959a23c&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00010202
CoolType!CTInit+0x45ef1:
0959a23c&nbsp;0fb606&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;&nbsp;&nbsp;eax,byte&nbsp;ptr&nbsp;[esi]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds:002b:2952d000=??
&nbsp;
0:022&gt;&nbsp;kb
&nbsp;#&nbsp;ChildEBP&nbsp;RetAddr&nbsp;&nbsp;Args&nbsp;to&nbsp;Child&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WARNING:&nbsp;Stack&nbsp;unwind&nbsp;information&nbsp;not&nbsp;available.&nbsp;Following&nbsp;frames&nbsp;may&nbsp;be&nbsp;wrong.
00&nbsp;2911e608&nbsp;09598db1&nbsp;097eee15&nbsp;097ef564&nbsp;097ef44c&nbsp;CoolType!CTInit+0x45ef1
01&nbsp;2911e674&nbsp;095939a0&nbsp;17e9cc38&nbsp;17e9cd98&nbsp;17e9cd58&nbsp;CoolType!CTInit+0x44a66
02&nbsp;2911e6d0&nbsp;095935c3&nbsp;17e9cc38&nbsp;17e9cd98&nbsp;17e9cd58&nbsp;CoolType!CTInit+0x3f655
03&nbsp;2911e720&nbsp;0958d9a3&nbsp;17e9cc38&nbsp;17e9cd98&nbsp;17e9cd58&nbsp;CoolType!CTInit+0x3f278
04&nbsp;2911e784&nbsp;0958d79c&nbsp;00000001&nbsp;2911e7d8&nbsp;00000001&nbsp;CoolType!CTInit+0x39658
05&nbsp;2911e79c&nbsp;095a6cb0&nbsp;2911e8a8&nbsp;2911e7d8&nbsp;1a99cf68&nbsp;CoolType!CTInit+0x39451
06&nbsp;2911e8fc&nbsp;095a6996&nbsp;1a99cf68&nbsp;097f61a8&nbsp;2911ea88&nbsp;CoolType!CTInit+0x52965
07&nbsp;2911eac4&nbsp;095a614e&nbsp;2911ecb8&nbsp;00000000&nbsp;097f6480&nbsp;CoolType!CTInit+0x5264b
08&nbsp;2911eb90&nbsp;095a506f&nbsp;773dfa00&nbsp;00000000&nbsp;00000001&nbsp;CoolType!CTInit+0x51e03
09&nbsp;2911ef58&nbsp;095a468a&nbsp;00000025&nbsp;20f02fec&nbsp;00001088&nbsp;CoolType!CTInit+0x50d24
0a&nbsp;2911ef98&nbsp;095a3691&nbsp;20f02fe0&nbsp;00000002&nbsp;2911f028&nbsp;CoolType!CTInit+0x5033f
0b&nbsp;2911f100&nbsp;095a32c7&nbsp;2911f518&nbsp;2911f8ac&nbsp;0000044a&nbsp;CoolType!CTInit+0x4f346
0c&nbsp;2911f150&nbsp;0908a44c&nbsp;145aae2c&nbsp;2911f518&nbsp;2911f8ac&nbsp;CoolType!CTInit+0x4ef7c
0d&nbsp;2911f258&nbsp;0906bab0&nbsp;2911f34c&nbsp;00000000&nbsp;21d6629c&nbsp;AGM!AGMInitialize+0x51bf0
0e&nbsp;2911f268&nbsp;0906b98f&nbsp;00000000&nbsp;f7510c27&nbsp;20d6cf70&nbsp;AGM!AGMInitialize+0x33254
0f&nbsp;2911f280&nbsp;0906ba9c&nbsp;00000081&nbsp;21cb6d00&nbsp;21cb6d00&nbsp;AGM!AGMInitialize+0x33133
10&nbsp;2911f9ac&nbsp;0906182e&nbsp;090004ca&nbsp;00001fa0&nbsp;2911fa01&nbsp;AGM!AGMInitialize+0x33240
11&nbsp;2911f9bc&nbsp;09080a4d&nbsp;21d76fe8&nbsp;00000053&nbsp;00000000&nbsp;AGM!AGMInitialize+0x28fd2
12&nbsp;2911fa01&nbsp;00000000&nbsp;c8000000&nbsp;5021ca6f&nbsp;0027c3d2&nbsp;AGM!AGMInitialize+0x481f1
&nbsp;
0:022&gt;&nbsp;!heap&nbsp;-p&nbsp;-a&nbsp;esi
&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;2952d000&nbsp;found&nbsp;in
&nbsp;&nbsp;&nbsp;&nbsp;_DPH_HEAP_ROOT&nbsp;@&nbsp;3d01000
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;busy&nbsp;allocation&nbsp;(&nbsp;&nbsp;DPH_HEAP_BLOCK:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserSize&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtSize)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;293c3924:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952cf40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952c000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2000
&nbsp;&nbsp;&nbsp;&nbsp;6a749abc&nbsp;verifier!AVrfDebugPageHeapAllocate+0x0000023c
&nbsp;&nbsp;&nbsp;&nbsp;7749d836&nbsp;ntdll!RtlDebugAllocateHeap+0x0000003c
&nbsp;&nbsp;&nbsp;&nbsp;773ffb40&nbsp;ntdll!RtlpAllocateHeap+0x000000f0
&nbsp;&nbsp;&nbsp;&nbsp;773fdecb&nbsp;ntdll!RtlpAllocateHeapInternal+0x0000027b
&nbsp;&nbsp;&nbsp;&nbsp;773fdc2e&nbsp;ntdll!RtlAllocateHeap+0x0000002e
&nbsp;&nbsp;&nbsp;&nbsp;6854ed63&nbsp;MSVCR120!malloc+0x00000049&nbsp;[f:\dd\vctools\crt\crtw32\heap\malloc.c&nbsp;@&nbsp;92]
&nbsp;&nbsp;&nbsp;&nbsp;095550fc&nbsp;CoolType!CTInit+0x00000db1
&nbsp;&nbsp;&nbsp;&nbsp;095589db&nbsp;CoolType!CTInit+0x00004690</pre><p style="text-indent: 2em;"><strong style="color: rgb(84, 141, 212); text-indent: 2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">分析</span></strong></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">这个漏洞是堆缓冲区溢出漏洞的一个实例。让我们先看看这个特别制作的PDF文件。我们将这个最小化的PoC文件和正常的PDF文件进行了对比，如下所示。</span></p><p style="text-align:center;"><img title="t01f46f39d84e569361.png" alt="http://p6.qhimg.com/t01f46f39d84e569361.png" src="http://p6.qhimg.com/t01e3ce33d88318d1b0.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图1：PoC文件与原始PDF文件</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:center;"><img title="t01d6c0e0a3bf6859f2.png" alt="http://p9.qhimg.com/t01d6c0e0a3bf6859f2.png" src="http://p8.qhimg.com/t01c1cf35ee2ff5fda7.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图2.用010编辑器对PoC文件的解析</span></p><p style="text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span>&nbsp;</p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">从图1和图2我们可以看到，PoC文件和原始PDF文件的唯一区别是位于obj 17上的偏移值为0x30e3上的一个字节。该对象的结构如下所示：</span></p><p style="color: rgb(153, 153, 153); line-height: 25px; white-space: normal;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 14px;"></span></p><pre class="brush:cpp;toolbar:false">17&nbsp;0&nbsp;obj
&lt;
/Length&nbsp;14790
/Filter&nbsp;[/FlateDecode]
/DecodeParms&nbsp;[null]
&gt;&gt;&nbsp;
stream
…
endstream
endobj</pre><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">问题是该对象到底存储了什么类型的数据？我们在PDF文件中发现了引用obj 17的对象，如下所示:</span></p><pre class="brush:cpp;toolbar:false">8&nbsp;0&nbsp;obj
&lt;
/FontFile2&nbsp;17&nbsp;0&nbsp;R
/FontName&nbsp;/AAAAAA+ComicSansMS
/Flags&nbsp;32
/ItalicAngle&nbsp;0
/Ascent&nbsp;1102
/Descent&nbsp;-312
/CapHeight&nbsp;0
/StemV&nbsp;0
/Type&nbsp;/FontDescriptor
/CIDSet&nbsp;19&nbsp;0&nbsp;R
&gt;&gt;&nbsp;
endobj</pre><p style="text-align:left;text-indent:2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 14px; text-indent: 2em;">从字段“/ FontFile2 17 0 R”中我们可以知道obj 17存储了一个字体文件。该字体文件的数据编码使用了obj 17中的FlateDecode。想要了解数据压缩的更多信息,请参阅https://tools.ietf.org/html/rfc1951。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">Zlib是一个C语言库,实现了数据压缩算法。我们可以用它来解压obj 17中的数据。PoC文件中的obj 17解压数据存储在output.dat文件中，长度为0x4650。原始PDF文件中的obj 17解压数据存储在output_original.dat文件中，长度也是0x4650。下面是output.dat文件和output_original.dat文件之间的对比：</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span>&nbsp;</p><p style="text-align:center;"><img title="t01494e7d54d24ec863.png" alt="http://p9.qhimg.com/t01494e7d54d24ec863.png" src="http://p5.qhimg.com/t01795886fa04f5e187.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图3.PoC的字体文件(output.dat)与原始字体文件(output_original.dat)的对比</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">我们可以看到有大约一百个字节是不相同的。那么,下一个问题是找出到底是什么数据触发了这个漏洞。这需要一些调试技巧，让我们先回到Windbg。</span></p><pre class="brush:cpp;toolbar:false">0:022&gt;&nbsp;r
eax=097eeeed&nbsp;ebx=00000015&nbsp;ecx=097ef6e0&nbsp;edx=0000cc6c&nbsp;esi=2952d000&nbsp;edi=00000024
eip=0959a23c&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00010202
CoolType!CTInit+0x45ef1:
0959a23c&nbsp;0fb606&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;&nbsp;&nbsp;eax,byte&nbsp;ptr&nbsp;[esi]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds:002b:2952d000=??
&nbsp;
0:022&gt;&nbsp;!heap&nbsp;-p&nbsp;-a&nbsp;esi
&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;2952d000&nbsp;found&nbsp;in
&nbsp;&nbsp;&nbsp;&nbsp;_DPH_HEAP_ROOT&nbsp;@&nbsp;3d01000
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;busy&nbsp;allocation&nbsp;(&nbsp;&nbsp;DPH_HEAP_BLOCK:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserSize&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtSize)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;293c3924:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952cf40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952c000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2000
&nbsp;&nbsp;&nbsp;&nbsp;6a749abc&nbsp;verifier!AVrfDebugPageHeapAllocate+0x0000023c
&nbsp;&nbsp;&nbsp;&nbsp;7749d836&nbsp;ntdll!RtlDebugAllocateHeap+0x0000003c
&nbsp;&nbsp;&nbsp;&nbsp;773ffb40&nbsp;ntdll!RtlpAllocateHeap+0x000000f0
&nbsp;&nbsp;&nbsp;&nbsp;773fdecb&nbsp;ntdll!RtlpAllocateHeapInternal+0x0000027b
&nbsp;&nbsp;&nbsp;&nbsp;773fdc2e&nbsp;ntdll!RtlAllocateHeap+0x0000002e
&nbsp;&nbsp;&nbsp;&nbsp;6854ed63&nbsp;MSVCR120!malloc+0x00000049&nbsp;[f:\dd\vctools\crt\crtw32\heap\malloc.c&nbsp;@&nbsp;92]
&nbsp;&nbsp;&nbsp;&nbsp;095550fc&nbsp;CoolType!CTInit+0x00000db1
&nbsp;&nbsp;&nbsp;&nbsp;095589db&nbsp;CoolType!CTInit+0x00004690
&nbsp;&nbsp;&nbsp;&nbsp;…
&nbsp;
0:022&gt;&nbsp;db&nbsp;2952cf40&nbsp;Lc0
2952cf40&nbsp;&nbsp;00&nbsp;02&nbsp;00&nbsp;b3&nbsp;ff&nbsp;fb&nbsp;01&nbsp;bf-05&nbsp;da&nbsp;00&nbsp;0b&nbsp;00&nbsp;23&nbsp;00&nbsp;55&nbsp;&nbsp;.............#.U
2952cf50&nbsp;&nbsp;40&nbsp;36&nbsp;06&nbsp;38&nbsp;00&nbsp;1e&nbsp;12&nbsp;1e-06&nbsp;20&nbsp;25&nbsp;30&nbsp;25&nbsp;50&nbsp;25&nbsp;c0&nbsp;&nbsp;@6.8.....&nbsp;%0%P%.
2952cf60&nbsp;&nbsp;25&nbsp;04&nbsp;80&nbsp;25&nbsp;90&nbsp;25&nbsp;a0&nbsp;25-03&nbsp;09&nbsp;38&nbsp;03&nbsp;18&nbsp;15&nbsp;1b&nbsp;18&nbsp;&nbsp;%..%.%.%..8.....
2952cf70&nbsp;&nbsp;38&nbsp;0f&nbsp;21&nbsp;1f&nbsp;25&nbsp;2f&nbsp;25&nbsp;3f-25&nbsp;7f&nbsp;25&nbsp;04&nbsp;1f&nbsp;0c&nbsp;bf&nbsp;0c&nbsp;&nbsp;8.!.%/%?%.%.....
2952cf80&nbsp;&nbsp;02&nbsp;50&nbsp;0c&nbsp;7f&nbsp;0c&nbsp;02&nbsp;0c&nbsp;25-10&nbsp;d6&nbsp;5d&nbsp;71&nbsp;5d&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;&nbsp;.P.....%..]q]}..
2952cf90&nbsp;&nbsp;18&nbsp;fd&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;18&nbsp;10&nbsp;7d-d4&nbsp;18&nbsp;ed&nbsp;5d&nbsp;71&nbsp;00&nbsp;3f&nbsp;2f&nbsp;&nbsp;..}....}...]q.?/
2952cfa0&nbsp;&nbsp;10&nbsp;d6&nbsp;ed&nbsp;31&nbsp;30&nbsp;01&nbsp;22&nbsp;26-35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;00&nbsp;ed&nbsp;&nbsp;...10.&quot;&amp;54632...
2952cfb0&nbsp;&nbsp;02&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;ed&nbsp;06&nbsp;23-22&nbsp;26&nbsp;35&nbsp;34&nbsp;26&nbsp;35&nbsp;34&nbsp;12&nbsp;&nbsp;.......#&quot;&amp;54&amp;54.
2952cfc0&nbsp;&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;00&nbsp;ed-02&nbsp;01&nbsp;4a&nbsp;30&nbsp;46&nbsp;46&nbsp;30&nbsp;30&nbsp;&nbsp;54632.....J0FF00
2952cfd0&nbsp;&nbsp;45&nbsp;45&nbsp;03&nbsp;07&nbsp;36&nbsp;2c&nbsp;2b&nbsp;37-07&nbsp;14&nbsp;37&nbsp;2b&nbsp;2b&nbsp;37&nbsp;14&nbsp;04&nbsp;&nbsp;EE..6,+7..7++7..
2952cfe0&nbsp;&nbsp;f2&nbsp;44&nbsp;30&nbsp;30&nbsp;44&nbsp;44&nbsp;30&nbsp;30-44&nbsp;fc&nbsp;d4&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;2c&nbsp;38&nbsp;&nbsp;.D00DD00D..&lt;.&lt;,8
2952cff0&nbsp;&nbsp;38&nbsp;2c&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;5e&nbsp;01&nbsp;19-5e&nbsp;2d&nbsp;38&nbsp;38&nbsp;2d&nbsp;5e&nbsp;fe&nbsp;e7&nbsp;&nbsp;8,&lt;.&lt;^..^-88-^..</pre><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">从上面的输出中可以看到,当对一个起始位置为0x2952cf40，大小为0xc0的堆缓冲区进行操作时，触发了一个界外内存访问。接下来,我们从这个堆缓冲区中搜索一些数据,比如output.dat文件中的| 00 02 00 b3|。</span></p><p style="text-align:center;"><img title="t015cf66ecb7ea491f6.png" alt="http://p3.qhimg.com/t015cf66ecb7ea491f6.png" src="http://p7.qhimg.com/t0191a09afcf9728d9e.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图4.output.dat中的数据搜索结果</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">我们在偏移值为0x2d0b的地方发现了它,而且它只出现了一次。然后,我们使用010编辑器中的TTFTemplate.bt解析了这个字体文件,并在“glyp”表中找到了| 00 02 00 B3 |。接下来,我们相应的分别从output.dat和output_original.dat的“glyp”表中提取大小为0xc0的数据。下面是它们之间的比较：</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span>&nbsp;</p><p style="text-align:center;"><img title="t018bbf6b4b891004d0.png" alt="http://p2.qhimg.com/t018bbf6b4b891004d0.png" src="http://p5.qhimg.com/t01fa6fb84361282dd6.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图5.glyph_poc.dat和glyph_original.dat之间的比较</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">如您所见, 它们之间有三个不同的地方。“glyf”表包含的数据定义了字体的字形符号的外观。这包括描述组成一个字形符号轮廓的点的规范和描述字形符号的网格的指令。“glyf”表支持简单的符号和复合符号的定义,也就是说,支持字形符号由其他符号组合而成。字体的字形符号数量仅由“head”表的值限制。字体中符号的放置顺序是任意的。</span></p><p style="text-indent: 2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 14px; text-indent: 2em;">每个字形的开始带有以下头信息:</span></p><p style="text-align:left;text-indent:2em;">&nbsp;</p><p style="text-align:center;"><img title="t0154f8936dd04b5d60.png" alt="http://p3.qhimg.com/t0154f8936dd04b5d60.png" src="http://p3.qhimg.com/t0102c459c1dd780b5e.png"/></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span>&nbsp;</p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">显然,glyph_poc.dat存储了一个简单的字形符号,因为前两个字节的值0x0002大于零。</span></p><p style="text-indent: 2em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 14px; text-indent: 2em;">一个简单的字形符号的结构如下所示:</span></p><p style="text-align:left;text-indent:2em;">&nbsp;</p><p style="text-align:center;"><img title="t017ede7eeed8bd7574.png" alt="http://p9.qhimg.com/t017ede7eeed8bd7574.png" src="http://p7.qhimg.com/t01575d3f65597c33f9.png"/></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">基于上面的“字形”表的规范,我们尝试着对它进行了解析，并用不同的颜色进行标记，如下所示：</span></p><p style="text-align:left;text-indent:2em;">&nbsp;</p><p style="text-align:center;"><img title="t01f2e3a88440d1190e.png" alt="http://p5.qhimg.com/t01f2e3a88440d1190e.png" src="http://p4.qhimg.com/t0115ea295749ae256c.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图6.解析简单字形</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">然后我们跟踪Adobe Reader是如何处理这个简单字形的，我们在Windbg中设置了以下断点：</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">bu CoolType!CTInit+0x44a61 &quot; .if((poi(poi(poi(esp+0xc))) &amp; 0x0`ffffffff) = 0x0`b3000200) { .printf \&quot;hit:\\n\&quot;;} .else {gc}&quot;</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">当运行到该断点时,我们得到了以下调试信息:</span></p><pre class="brush:cpp;toolbar:false">0:021&gt;&nbsp;g
(8de0.6bc4):&nbsp;C++&nbsp;EH&nbsp;exception&nbsp;-&nbsp;code&nbsp;e06d7363&nbsp;(first&nbsp;chance)
hit:
eax=097ef6e0&nbsp;ebx=097ef6d0&nbsp;ecx=097eeda0&nbsp;edx=2911e6fc&nbsp;esi=097ef758&nbsp;edi=097ef756
eip=09598dac&nbsp;esp=2911e610&nbsp;ebp=2911e674&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;zr&nbsp;na&nbsp;pe&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000246
CoolType!CTInit+0x44a61:
09598dac&nbsp;e8f1110000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;CoolType!CTInit+0x45c57&nbsp;(09599fa2)
&nbsp;
0:022&gt;&nbsp;dds&nbsp;esp
2911e610&nbsp;&nbsp;097eee00&nbsp;CoolType!CTGetVersion+0x1dd1c8&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param1
2911e614&nbsp;&nbsp;097ef510&nbsp;CoolType!CTGetVersion+0x1dd8d8&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param2
2911e618&nbsp;&nbsp;097ef3bc&nbsp;CoolType!CTGetVersion+0x1dd784&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param3
2911e61c&nbsp;&nbsp;097ef6e0&nbsp;CoolType!CTGetVersion+0x1ddaa8&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param4
2911e620&nbsp;&nbsp;17e9cd98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param5
2911e624&nbsp;&nbsp;00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param6
2911e628&nbsp;&nbsp;00000002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;param7
2911e62c&nbsp;&nbsp;097eee58&nbsp;CoolType!CTGetVersion+0x1dd220
2911e630&nbsp;&nbsp;097eee60&nbsp;CoolType!CTGetVersion+0x1dd228
2911e634&nbsp;&nbsp;097ef756&nbsp;CoolType!CTGetVersion+0x1ddb1e
2911e638&nbsp;&nbsp;097ef758&nbsp;CoolType!CTGetVersion+0x1ddb20
2911e63c&nbsp;&nbsp;2911e6c4
2911e640&nbsp;&nbsp;2911e6c8
2911e644&nbsp;&nbsp;097ef6d0&nbsp;CoolType!CTGetVersion+0x1dda98
2911e648&nbsp;&nbsp;17e9cdc4
2911e64c&nbsp;&nbsp;17e9cf84
2911e650&nbsp;&nbsp;00000015
…
&nbsp;
0:022&gt;&nbsp;dd&nbsp;097ef6e0&nbsp;L4
097ef6e0&nbsp;&nbsp;2952cf40&nbsp;2952cf4a&nbsp;2952d000&nbsp;00000000
&nbsp;
0:022&gt;&nbsp;db&nbsp;2952cf40&nbsp;&nbsp;lc0
2952cf40&nbsp;&nbsp;00&nbsp;02&nbsp;00&nbsp;b3&nbsp;ff&nbsp;fb&nbsp;01&nbsp;bf-05&nbsp;da&nbsp;00&nbsp;0b&nbsp;00&nbsp;23&nbsp;00&nbsp;55&nbsp;&nbsp;.............#.U
2952cf50&nbsp;&nbsp;40&nbsp;36&nbsp;06&nbsp;38&nbsp;00&nbsp;1e&nbsp;12&nbsp;1e-06&nbsp;20&nbsp;25&nbsp;30&nbsp;25&nbsp;50&nbsp;25&nbsp;c0&nbsp;&nbsp;@6.8.....&nbsp;%0%P%.
2952cf60&nbsp;&nbsp;25&nbsp;04&nbsp;80&nbsp;25&nbsp;90&nbsp;25&nbsp;a0&nbsp;25-03&nbsp;09&nbsp;38&nbsp;03&nbsp;18&nbsp;15&nbsp;1b&nbsp;18&nbsp;&nbsp;%..%.%.%..8.....
2952cf70&nbsp;&nbsp;38&nbsp;0f&nbsp;21&nbsp;1f&nbsp;25&nbsp;2f&nbsp;25&nbsp;3f-25&nbsp;7f&nbsp;25&nbsp;04&nbsp;1f&nbsp;0c&nbsp;bf&nbsp;0c&nbsp;&nbsp;8.!.%/%?%.%.....
2952cf80&nbsp;&nbsp;02&nbsp;50&nbsp;0c&nbsp;7f&nbsp;0c&nbsp;02&nbsp;0c&nbsp;25-10&nbsp;d6&nbsp;5d&nbsp;71&nbsp;5d&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;&nbsp;.P.....%..]q]}..
2952cf90&nbsp;&nbsp;18&nbsp;fd&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;18&nbsp;10&nbsp;7d-d4&nbsp;18&nbsp;ed&nbsp;5d&nbsp;71&nbsp;00&nbsp;3f&nbsp;2f&nbsp;&nbsp;..}....}...]q.?/
2952cfa0&nbsp;&nbsp;10&nbsp;d6&nbsp;ed&nbsp;31&nbsp;30&nbsp;01&nbsp;22&nbsp;26-35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;00&nbsp;ed&nbsp;&nbsp;...10.&quot;&amp;54632...
2952cfb0&nbsp;&nbsp;02&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;ed&nbsp;06&nbsp;23-22&nbsp;26&nbsp;35&nbsp;34&nbsp;26&nbsp;35&nbsp;34&nbsp;12&nbsp;&nbsp;.......#&quot;&amp;54&amp;54.
2952cfc0&nbsp;&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;00&nbsp;ed-02&nbsp;01&nbsp;4a&nbsp;30&nbsp;46&nbsp;46&nbsp;30&nbsp;30&nbsp;&nbsp;54632.....J0FF00
2952cfd0&nbsp;&nbsp;45&nbsp;45&nbsp;03&nbsp;07&nbsp;36&nbsp;2c&nbsp;2b&nbsp;37-07&nbsp;14&nbsp;37&nbsp;2b&nbsp;2b&nbsp;37&nbsp;14&nbsp;04&nbsp;&nbsp;EE..6,+7..7++7..
2952cfe0&nbsp;&nbsp;f2&nbsp;44&nbsp;30&nbsp;30&nbsp;44&nbsp;44&nbsp;30&nbsp;30-44&nbsp;fc&nbsp;d4&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;2c&nbsp;38&nbsp;&nbsp;.D00DD00D..&lt;.&lt;,8
2952cff0&nbsp;&nbsp;38&nbsp;2c&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;5e&nbsp;01&nbsp;19-5e&nbsp;2d&nbsp;38&nbsp;38&nbsp;2d&nbsp;5e&nbsp;fe&nbsp;e7&nbsp;&nbsp;8,&lt;.&lt;^..^-88-^..
&nbsp;
0:022&gt;&nbsp;!heap&nbsp;-p&nbsp;-a&nbsp;2952cf40&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;2952cf40&nbsp;found&nbsp;in
&nbsp;&nbsp;&nbsp;&nbsp;_DPH_HEAP_ROOT&nbsp;@&nbsp;3d01000
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;busy&nbsp;allocation&nbsp;(&nbsp;&nbsp;DPH_HEAP_BLOCK:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserSize&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtAddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtSize)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;293c3924:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952cf40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952c000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2000
&nbsp;&nbsp;&nbsp;&nbsp;6a749abc&nbsp;verifier!AVrfDebugPageHeapAllocate+0x0000023c
&nbsp;&nbsp;&nbsp;&nbsp;7749d836&nbsp;ntdll!RtlDebugAllocateHeap+0x0000003c
&nbsp;&nbsp;&nbsp;&nbsp;773ffb40&nbsp;ntdll!RtlpAllocateHeap+0x000000f0
&nbsp;&nbsp;&nbsp;&nbsp;773fdecb&nbsp;ntdll!RtlpAllocateHeapInternal+0x0000027b
&nbsp;&nbsp;&nbsp;&nbsp;773fdc2e&nbsp;ntdll!RtlAllocateHeap+0x0000002e
&nbsp;&nbsp;&nbsp;&nbsp;6854ed63&nbsp;MSVCR120!malloc+0x00000049&nbsp;[f:\dd\vctools\crt\crtw32\heap\malloc.c&nbsp;@&nbsp;92]
&nbsp;&nbsp;&nbsp;&nbsp;095550fc&nbsp;CoolType!CTInit+0x00000db1
&nbsp;&nbsp;&nbsp;&nbsp;095589db&nbsp;CoolType!CTInit+0x00004690
&nbsp;&nbsp;&nbsp;&nbsp;...</pre><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">从上面的输出中可以看到,堆缓冲区的地址0x2952cf40处存储了大小为0xc0的简单字形。这与glyph_poc.dat中的数据相匹配。地址0x2952cf4a指向endPtsOfContours[2]，而地址0x2952d000指向简单字形的结尾。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">以下是简单字形的一些字段的值：</span></p><pre class="brush:cpp;toolbar:false">endPtsOfContours&nbsp;[0]:&nbsp;&nbsp;&nbsp;00&nbsp;0b&nbsp;&nbsp;
endPtsOfContours&nbsp;[1]:&nbsp;&nbsp;00&nbsp;23
instructionLength:&nbsp;00&nbsp;55&nbsp;
instructions[n]:&nbsp;&nbsp;&nbsp;40&nbsp;36&nbsp;06&nbsp;38&nbsp;00&nbsp;1e&nbsp;12&nbsp;1e-06&nbsp;20&nbsp;25&nbsp;30&nbsp;25&nbsp;50&nbsp;25&nbsp;c0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25&nbsp;04&nbsp;80&nbsp;25&nbsp;90&nbsp;25&nbsp;a0&nbsp;25-03&nbsp;09&nbsp;38&nbsp;03&nbsp;18&nbsp;15&nbsp;1b&nbsp;18
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;38&nbsp;0f&nbsp;21&nbsp;1f&nbsp;25&nbsp;2f&nbsp;25&nbsp;3f-25&nbsp;7f&nbsp;25&nbsp;04&nbsp;1f&nbsp;0c&nbsp;bf&nbsp;0c
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;02&nbsp;50&nbsp;0c&nbsp;7f&nbsp;0c&nbsp;02&nbsp;0c&nbsp;25-10&nbsp;d6&nbsp;5d&nbsp;71&nbsp;5d&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;fd&nbsp;7d&nbsp;c4&nbsp;c4&nbsp;18&nbsp;10&nbsp;7d-d4&nbsp;18&nbsp;ed&nbsp;5d&nbsp;71&nbsp;00&nbsp;3f&nbsp;2f&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;d6&nbsp;ed&nbsp;31&nbsp;30
Flags[]:&nbsp;……
xCoordinates[&nbsp;]:&nbsp;…….
yCoordinates[&nbsp;]:&nbsp;…….</pre><p style="text-align:left;text-indent:2em;"><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; text-indent: 2em;">我们继续跟踪简单字形中的“Flags”字段是如何处理的。在IDA Pro中,下面是处理“Flags”字段的代码分支。它的长度是0x24(endPtsOfContours[1]+ 1 = 0x23 + 0x1 = 0 x24)。</span><br/><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span></p><p style="text-align:left;text-indent:2em;">&nbsp;</p><p style="text-align:center;"><img title="t012e61de60cd6fb263.png" alt="http://p9.qhimg.com/t012e61de60cd6fb263.png" src="http://p4.qhimg.com/t01cf25404036dd4e3b.png"/></p><p style="text-align:center;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">图7.处理“Flags”字段的分支</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">&nbsp;</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">在Windbg中,我们得到以下调试信息:</span></p><p><br/></p><pre class="brush:cpp;toolbar:false">0:022&gt;&nbsp;bu&nbsp;0959a132
&nbsp;
0:022&gt;&nbsp;g
Breakpoint&nbsp;1&nbsp;hit
eax=0000004d&nbsp;ebx=097eee00&nbsp;ecx=00000000&nbsp;edx=00000024&nbsp;esi=2952cfa5&nbsp;edi=00000000
eip=0959a132&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;ng&nbsp;nz&nbsp;ac&nbsp;pe&nbsp;cy
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000297
CoolType!CTInit+0x45de7:
0959a132&nbsp;8bca&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ecx,edx
&nbsp;
0:022&gt;&nbsp;db&nbsp;esi
2952cfa5&nbsp;&nbsp;01&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32-1f&nbsp;00&nbsp;ed&nbsp;02&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;&nbsp;.&quot;&amp;54632........
2952cfb5&nbsp;&nbsp;ed&nbsp;06&nbsp;23&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;26-35&nbsp;34&nbsp;12&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;&nbsp;..#&quot;&amp;54&amp;54.54632
2952cfc5&nbsp;&nbsp;1f&nbsp;00&nbsp;ed&nbsp;02&nbsp;01&nbsp;4a&nbsp;30&nbsp;46-46&nbsp;30&nbsp;30&nbsp;45&nbsp;45&nbsp;03&nbsp;07&nbsp;36&nbsp;&nbsp;.....J0FF00EE..6
2952cfd5&nbsp;&nbsp;2c&nbsp;2b&nbsp;37&nbsp;07&nbsp;14&nbsp;37&nbsp;2b&nbsp;2b-37&nbsp;14&nbsp;04&nbsp;f2&nbsp;44&nbsp;30&nbsp;30&nbsp;44&nbsp;&nbsp;,+7..7++7...D00D
2952cfe5&nbsp;&nbsp;44&nbsp;30&nbsp;30&nbsp;44&nbsp;fc&nbsp;d4&nbsp;3c&nbsp;ef-3c&nbsp;2c&nbsp;38&nbsp;38&nbsp;2c&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;&nbsp;D00D..&lt;.&lt;,88,&lt;.&lt;
2952cff5&nbsp;&nbsp;5e&nbsp;01&nbsp;19&nbsp;5e&nbsp;2d&nbsp;38&nbsp;38&nbsp;2d-5e&nbsp;fe&nbsp;e7&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;^..^-88-^..?????
2952d005&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
2952d015&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
&nbsp;
0:022&gt;&nbsp;db&nbsp;ebx
097eee00&nbsp;&nbsp;01&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee10&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee20&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee30&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee40&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee50&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;0c&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................
097eee60&nbsp;&nbsp;0b&nbsp;00&nbsp;23&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;..#.............
097eee70&nbsp;&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;................</pre><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">缓冲区的地址0 x097eee00用于存储解析“Flags”字段的结果。</span></p><p style="text-align:left;text-indent:2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;">下面的C代码来自IDA Pro的sub_8049FA2函数，用来处理“Flags”字段:</span></p><pre class="brush:cpp;toolbar:false">//parse&nbsp;the&nbsp;Flags&nbsp;field&nbsp;which&nbsp;length&nbsp;is&nbsp;0x24,&nbsp;the&nbsp;result&nbsp;is&nbsp;stored&nbsp;in&nbsp;param&nbsp;a1.&nbsp;&nbsp;v20&nbsp;points&nbsp;to&nbsp;the&nbsp;offset&nbsp;of&nbsp;data&nbsp;in&nbsp;the&nbsp;glyph&nbsp;object.
do&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v14&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v28&nbsp;-=&nbsp;v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v54&nbsp;=&nbsp;v28;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v28&nbsp;&lt;&nbsp;0&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v14&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOBYTE(v50)&nbsp;=&nbsp;*(v27&nbsp;-&nbsp;1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(v27,&nbsp;v50,&nbsp;v14);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v27&nbsp;+=&nbsp;v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;v14&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v28&nbsp;=&nbsp;v54;</pre><p style="text-align: left; text-indent: 2em;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"></span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">下面的C代码来自IDA Pro的sub_8049FA2函数，用来处理“Flags”字段:</span>&nbsp;</p><pre class="brush:bash;toolbar:false">//parse&nbsp;the&nbsp;Flags&nbsp;field&nbsp;which&nbsp;length&nbsp;is&nbsp;0x24,&nbsp;the&nbsp;result&nbsp;is&nbsp;stored&nbsp;in&nbsp;param&nbsp;a1.&nbsp;&nbsp;v20&nbsp;points&nbsp;to&nbsp;the&nbsp;offset&nbsp;of&nbsp;data&nbsp;in&nbsp;the&nbsp;glyph&nbsp;object.
do&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v14&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v28&nbsp;-=&nbsp;v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v54&nbsp;=&nbsp;v28;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v28&nbsp;&lt;&nbsp;0&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v14&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOBYTE(v50)&nbsp;=&nbsp;*(v27&nbsp;-&nbsp;1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(v27,&nbsp;v50,&nbsp;v14);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v27&nbsp;+=&nbsp;v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--v14;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;v14&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v28&nbsp;=&nbsp;v54;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v29&nbsp;=&nbsp;*(_BYTE&nbsp;*)v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*v27&nbsp;=&nbsp;*(_BYTE&nbsp;*)v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v29&nbsp;&amp;&nbsp;8&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;++v20&nbsp;&gt;&nbsp;*(_DWORD&nbsp;*)(a4&nbsp;+&nbsp;8)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v14&nbsp;=&nbsp;*(_BYTE&nbsp;*)v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++v27;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--v28;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v20&nbsp;&gt;&nbsp;*(_DWORD&nbsp;*)(a4&nbsp;+&nbsp;8)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;v28&nbsp;&gt;&nbsp;0&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v14&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5121;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v30&nbsp;=&nbsp;v55;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v31&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v32&nbsp;=&nbsp;(char&nbsp;*)a1;&nbsp;&nbsp;//&nbsp;a1&nbsp;stores&nbsp;the&nbsp;result&nbsp;of&nbsp;parsing&nbsp;Flags&nbsp;field.&nbsp;|01&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;23&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;26&nbsp;35&nbsp;34&nbsp;12&nbsp;35&nbsp;34&nbsp;36&nbsp;33|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v33&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v51&nbsp;=&nbsp;a1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v48&nbsp;=&nbsp;0;</pre><p>&nbsp;</p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">在解析完“Flags”字段之后,我们看到了以下调试信息:</span></p><p>&nbsp;</p><pre class="brush:bash;toolbar:false">0:022&gt;&nbsp;t
eax=097ef6e0&nbsp;ebx=097eee24&nbsp;ecx=00000000&nbsp;edx=00000006&nbsp;esi=2952cfc4&nbsp;edi=00060000
eip=0959a1ab&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;zr&nbsp;na&nbsp;pe&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000246
CoolType!CTInit+0x45e60:
0959a1ab&nbsp;8b7d30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edi,dword&nbsp;ptr&nbsp;[ebp+30h]&nbsp;ss:002b:2911e638=00000024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
0:022&gt;&nbsp;db&nbsp;ebx-24&nbsp;L30
097eee00&nbsp;&nbsp;01&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32-1f&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;&nbsp;.&quot;&amp;54632........
097eee10&nbsp;&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;23-22&nbsp;26&nbsp;35&nbsp;34&nbsp;26&nbsp;35&nbsp;34&nbsp;12&nbsp;&nbsp;.......#&quot;&amp;54&amp;54.
097eee20&nbsp;&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;00&nbsp;00&nbsp;00&nbsp;00-00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;5463............&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
0:022&gt;&nbsp;db&nbsp;esi
2952cfc4&nbsp;&nbsp;32&nbsp;1f&nbsp;00&nbsp;ed&nbsp;02&nbsp;01&nbsp;4a&nbsp;30-46&nbsp;46&nbsp;30&nbsp;30&nbsp;45&nbsp;45&nbsp;03&nbsp;07&nbsp;&nbsp;2.....J0FF00EE..
2952cfd4&nbsp;&nbsp;36&nbsp;2c&nbsp;2b&nbsp;37&nbsp;07&nbsp;14&nbsp;37&nbsp;2b-2b&nbsp;37&nbsp;14&nbsp;04&nbsp;f2&nbsp;44&nbsp;30&nbsp;30&nbsp;&nbsp;6,+7..7++7...D00
2952cfe4&nbsp;&nbsp;44&nbsp;44&nbsp;30&nbsp;30&nbsp;44&nbsp;fc&nbsp;d4&nbsp;3c-ef&nbsp;3c&nbsp;2c&nbsp;38&nbsp;38&nbsp;2c&nbsp;3c&nbsp;ef&nbsp;&nbsp;DD00D..&lt;.&lt;,88,&lt;.
2952cff4&nbsp;&nbsp;3c&nbsp;5e&nbsp;01&nbsp;19&nbsp;5e&nbsp;2d&nbsp;38&nbsp;38-2d&nbsp;5e&nbsp;fe&nbsp;e7&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;&lt;^..^-88-^..????
2952d004&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
2952d014&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
2952d024&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
2952d034&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????</pre><p>&nbsp;</p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">从图5我们可以看到在“Flags”字段中存在三种不同字节，这将导致一个完全不同的结果。</span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">结果存储在一个起始地址为0x097eee00，大小为0x24的缓冲区中。然后这个缓冲区用来解析xCoordinates[]和yCoordinates[]字段。下面的C代码来自IDA Pro的sub_8049FA2函数，用来处理xCoordinates[]字段:</span></p><p>&nbsp;</p><pre class="brush:bash;toolbar:false">v48&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v55&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;&nbsp;//handling&nbsp;xCoordinates,&nbsp;the&nbsp;result&nbsp;is&nbsp;stored&nbsp;in&nbsp;param&nbsp;a3.&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v34&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v35&nbsp;=&nbsp;*v32;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v35&nbsp;&amp;&nbsp;2&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v36&nbsp;=&nbsp;(v35&nbsp;&amp;&nbsp;0x10)&nbsp;==&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v37&nbsp;=&nbsp;*(_BYTE&nbsp;*)v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v36&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v34&nbsp;-=&nbsp;v37;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v34&nbsp;+=&nbsp;v37;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;!(v35&nbsp;&amp;&nbsp;0x10)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v38&nbsp;=&nbsp;*(_BYTE&nbsp;*)(v20&nbsp;+&nbsp;1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v34&nbsp;+=&nbsp;_byteswap_ushort(*(_WORD&nbsp;*)v20);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v33&nbsp;=&nbsp;v48;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v20&nbsp;+=&nbsp;2;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(_DWORD&nbsp;*)a3&nbsp;=&nbsp;v34;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a3&nbsp;+=&nbsp;4;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v32&nbsp;=&nbsp;(char&nbsp;*)v51&nbsp;+&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v51&nbsp;=&nbsp;(char&nbsp;*)v51&nbsp;+&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v30&nbsp;=&nbsp;v55;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v20&nbsp;&gt;&nbsp;*(_DWORD&nbsp;*)(a4&nbsp;+&nbsp;8)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v48&nbsp;=&nbsp;++v33;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;v33&nbsp;&lt;&nbsp;v55&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">处理完“xCoordinates”后,我们发现以下调试信息:</span></p><p>&nbsp;</p><pre class="brush:bash;toolbar:false">0:022&gt;&nbsp;t
eax=097eee24&nbsp;ebx=00000000&nbsp;ecx=00000024&nbsp;edx=0000efeb&nbsp;esi=2952cfeb&nbsp;edi=00000024
eip=0959a224&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;zr&nbsp;na&nbsp;pe&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000246
CoolType!CTInit+0x45ed9:
0959a224&nbsp;895d28&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dword&nbsp;ptr&nbsp;[ebp+28h],ebx&nbsp;ss:002b:2911e630=097eee24
&nbsp;
0:022&gt;&nbsp;db&nbsp;esi
2952cfeb&nbsp;&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;2c&nbsp;38&nbsp;38&nbsp;2c&nbsp;3c-ef&nbsp;3c&nbsp;5e&nbsp;01&nbsp;19&nbsp;5e&nbsp;2d&nbsp;38&nbsp;&nbsp;&lt;.&lt;,88,&lt;.&lt;^..^-8
2952cffb&nbsp;&nbsp;38&nbsp;2d&nbsp;5e&nbsp;fe&nbsp;e7&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;8-^..???????????
2952d00b&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
2952d01b&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????
&nbsp;
0:022&gt;&nbsp;dd&nbsp;097ef3bc&nbsp;L40
097ef3bc&nbsp;&nbsp;0000321f&nbsp;0000321f&nbsp;00003132&nbsp;00003132
097ef3cc&nbsp;&nbsp;00003132&nbsp;00003134&nbsp;00003135&nbsp;0000317f
097ef3dc&nbsp;&nbsp;000031af&nbsp;000077f5&nbsp;ffffa825&nbsp;ffffed6a
097ef3ec&nbsp;&nbsp;ffffed67&nbsp;ffffed67&nbsp;ffffed6e&nbsp;0000239a
097ef3fc&nbsp;&nbsp;00004ed1&nbsp;000055e5&nbsp;ffff8d10&nbsp;ffffb847
097ef40c&nbsp;&nbsp;ffffcc4b&nbsp;ffffbe8f&nbsp;ffffeebf&nbsp;ffffee7b
097ef41c&nbsp;&nbsp;ffffee37&nbsp;ffffee07&nbsp;ffffee07&nbsp;ffffee07
097ef42c&nbsp;&nbsp;ffffedd7&nbsp;ffffedd7&nbsp;ffffedd7&nbsp;ffffee1b
097ef43c&nbsp;&nbsp;ffffee1b&nbsp;ffffee1b&nbsp;ffffef17&nbsp;ffffefeb
097ef44c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef45c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef46c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef47c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef48c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef49c&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef4ac&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000</pre><p>&nbsp;</p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">接下来,下面的C代码来自IDA Pro的sub_8049FA2函数，用来处理yCoordinates[]字段:</span></p><p>&nbsp;</p><pre class="brush:bash;toolbar:false">if&nbsp;(&nbsp;v30&nbsp;&gt;&nbsp;0&nbsp;)&nbsp;&nbsp;&nbsp;//&nbsp;handle&nbsp;yCoordinates,&nbsp;the&nbsp;result&nbsp;is&nbsp;stored&nbsp;in&nbsp;param&nbsp;a2.&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;//v20&nbsp;points&nbsp;to&nbsp;the&nbsp;following&nbsp;buffer.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952cfeb&nbsp;&nbsp;3c&nbsp;ef&nbsp;3c&nbsp;2c&nbsp;38&nbsp;38&nbsp;2c&nbsp;3c-ef&nbsp;3c&nbsp;5e&nbsp;01&nbsp;19&nbsp;5e&nbsp;2d&nbsp;38&nbsp;&nbsp;&lt;.&lt;,88,&lt;.&lt;^..^-8
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2952cffb&nbsp;&nbsp;38&nbsp;2d&nbsp;5e&nbsp;fe&nbsp;e7&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;8-^..???????????
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v39&nbsp;=&nbsp;(char&nbsp;*)a1;&nbsp;//&nbsp;a1&nbsp;stores&nbsp;the&nbsp;result&nbsp;of&nbsp;parsing&nbsp;the&nbsp;Flags&nbsp;field.&nbsp;|01&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;36&nbsp;33&nbsp;32&nbsp;1f&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;03&nbsp;14&nbsp;16&nbsp;00&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;ed&nbsp;23&nbsp;22&nbsp;26&nbsp;35&nbsp;34&nbsp;26&nbsp;35&nbsp;34&nbsp;12&nbsp;35&nbsp;34&nbsp;36&nbsp;33|
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v40&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v41&nbsp;=&nbsp;a4;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v42&nbsp;=&nbsp;*v39;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v42&nbsp;&amp;&nbsp;4&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v36&nbsp;=&nbsp;(v42&nbsp;&amp;&nbsp;0x20)&nbsp;==&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v43&nbsp;=&nbsp;*(_BYTE&nbsp;*)v20;&nbsp;&nbsp;&nbsp;//crash&nbsp;here!
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v36&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v40&nbsp;-=&nbsp;v43;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v40&nbsp;+=&nbsp;v43;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++v20;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;!(v42&nbsp;&amp;&nbsp;0x20)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v44&nbsp;=&nbsp;*(_BYTE&nbsp;*)(v20&nbsp;+&nbsp;1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v40&nbsp;+=&nbsp;_byteswap_ushort(*(_WORD&nbsp;*)v20);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v41&nbsp;=&nbsp;a4;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v20&nbsp;+=&nbsp;2;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v45&nbsp;=&nbsp;(_DWORD&nbsp;*)a2;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a2&nbsp;+=&nbsp;4;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*v45&nbsp;=&nbsp;v40;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(_BYTE&nbsp;*)a1&nbsp;&amp;=&nbsp;1u;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v39&nbsp;=&nbsp;(char&nbsp;*)a1&nbsp;+&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;=&nbsp;(char&nbsp;*)a1&nbsp;+&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;v20&nbsp;&gt;&nbsp;*(_DWORD&nbsp;*)(v41&nbsp;+&nbsp;8)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;5133;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;++v31&nbsp;&lt;&nbsp;v55&nbsp;);&nbsp;&nbsp;//v55&nbsp;is&nbsp;0x24
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p>&nbsp;</p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">发生崩溃时,我们看到了下面的调试信息:</span></p><p>&nbsp;</p><pre class="brush:bash;toolbar:false">0:022&gt;&nbsp;t
eax=097eeeed&nbsp;ebx=00000015&nbsp;ecx=097ef6e0&nbsp;edx=0000cc6c&nbsp;esi=2952d000&nbsp;edi=00000024
eip=0959a23c&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00000202
CoolType!CTInit+0x45ef1:
0959a23c&nbsp;0fb606&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;&nbsp;&nbsp;eax,byte&nbsp;ptr&nbsp;[esi]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds:002b:2952d000=??
&nbsp;
0:022&gt;&nbsp;t
(8de0.6bc4):&nbsp;Access&nbsp;violation&nbsp;-&nbsp;code&nbsp;c0000005&nbsp;(first&nbsp;chance)
First&nbsp;chance&nbsp;exceptions&nbsp;are&nbsp;reported&nbsp;before&nbsp;any&nbsp;exception&nbsp;handling.
This&nbsp;exception&nbsp;may&nbsp;be&nbsp;expected&nbsp;and&nbsp;handled.
eax=097eeeed&nbsp;ebx=00000015&nbsp;ecx=097ef6e0&nbsp;edx=0000cc6c&nbsp;esi=2952d000&nbsp;edi=00000024
eip=0959a23c&nbsp;esp=2911e5f8&nbsp;ebp=2911e608&nbsp;iopl=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nv&nbsp;up&nbsp;ei&nbsp;pl&nbsp;nz&nbsp;na&nbsp;po&nbsp;nc
cs=0023&nbsp;&nbsp;ss=002b&nbsp;&nbsp;ds=002b&nbsp;&nbsp;es=002b&nbsp;&nbsp;fs=0053&nbsp;&nbsp;gs=002b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;efl=00010202
CoolType!CTInit+0x45ef1:
0959a23c&nbsp;0fb606&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;&nbsp;&nbsp;eax,byte&nbsp;ptr&nbsp;[esi]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds:002b:2952d000=??
&nbsp;
0:022&gt;&nbsp;dd&nbsp;097ef510
097ef510&nbsp;&nbsp;00003cef&nbsp;00003cef&nbsp;00003d2b&nbsp;00003d57
097ef520&nbsp;&nbsp;00003d8f&nbsp;00003dc7&nbsp;00003dc7&nbsp;00003dc7
097ef530&nbsp;&nbsp;00003d9b&nbsp;00003dd7&nbsp;00003ec6&nbsp;00003f02
097ef540&nbsp;&nbsp;ffff9d03&nbsp;ffff9cea&nbsp;ffff9c8c&nbsp;ffffc9c4
097ef550&nbsp;&nbsp;ffffc9fc&nbsp;ffffca29&nbsp;ffffca87&nbsp;ffffcb85
097ef560&nbsp;&nbsp;ffffcc6c&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef570&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
097ef580&nbsp;&nbsp;00000000&nbsp;00000000&nbsp;00000000&nbsp;00000000
&nbsp;
0:022&gt;&nbsp;db&nbsp;esi&nbsp;L10
2952d000&nbsp;&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??-??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;??&nbsp;&nbsp;????????????????</pre><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">因为ebx小于edi,循环条件仍然是正确的,程序会继续解析yCoordinates[]字段。虽然esi指向简单符号的结尾,但是它会导致一个界外内存访问。</span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;"><br/></span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">总之,这个漏洞是一个典型的堆缓冲区溢出漏洞。特别的是,这个漏洞是由一个精心制作的PDF文件引发的。该PDF文件包括一个无效字体文件，由于操作数组指针时不当的边界检查，它会导致一个界外内存访问。攻击者可以通过越界访问来达到意想不到的读,写或释放,甚至导致恶意代码插入、控制流劫持或信息泄露攻击。</span></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px; color: rgb(84, 141, 212);">缓解措施</span></strong></p><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; font-size: 14px;">鼓励所有Adobe Acrobat和Reader的用户都升级到该软件的最新版本。此外,部署Fortinet IPS解决方案的组织机构也已经免受这个签名为Adobe.Acrobat.Reader.CoolType.TTF.Memory.Corruption的漏洞威胁。</span></p><p style="text-align: left; text-indent: 2em;"><br/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="https://blog.fortinet.com/2016/07/20/analysis-of-cve-2016-4203-adobe-acrobat-and-reader-cooltype-handling-heap-overflow-vulnerability" target="_blank">原文链接：https://blog.fortinet.com/2016/07/20/analysis-of-cve-2016-4203-adobe-acrobat-and-reader-cooltype-handling-heap-overflow-vulnerability</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="CVE-2016-4203分析：Adobe Acrobat和Reader 的CoolType处理导致的堆溢出漏洞 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="2921" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="ea3898fb4df38673fdeb61c458234054">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment">
    <div class="avatar">
        <a href="javascript:;">
                                    <img src="/img/photo/1x48x48.png">
                    </a>
    </div>
    <div class="comment-main">
        <div class="comment-user">
                        <a user-id="0" class="response" data-bind-id="0" data-target="3848" user-name="Ox9A82" href="javascript:;">
                Ox9A82            </a>
                        <span class="comment-time">2016-07-22 13:53:01</span>
            <div class="comment-action">
                <span class="comment-response"><a href="javascript:;" class="response" data-bind-id="0" data-target="3848">回复</a></span>&nbsp;|&nbsp;
                <span><a href="javascript:;"  class="good" data-target="/comment/good" data-value="g_3848" data-type="comment">点赞</a></span>
            </div>
        </div>

        <p class="content">道理我都懂，能不能给一份POC?</p>
        <style>
    .comment-user p{font-size: 13px; margin: 0;}
</style>
    </div>
    <div>

    </div>
</div>
<div class="clearfix"></div>

        <a class="more-long comment-more" href="javascript:;" data-target="/comment/more" data-type="learning" data-source-id="2921" data-page="2">查看更多</a>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
                                <li><a href="/learning/detail/4417.html" alt="【知识】9月15日 - 每日安全知识热点" target="_blank">【知识】9月15日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
