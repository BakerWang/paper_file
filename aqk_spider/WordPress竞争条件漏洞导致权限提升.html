<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wb="http://open.weibo.com/wb" xml:lang="en" lang="en">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="shortcut icon" href="http://bobao.360.cn/favicon.ico?v=1.1"/>
    <link rel="alternate" title="安全资讯" href="/rss?type=news" type="application/rss+xml"/>
    <link rel="alternate" title="安全知识" href="/rss?type=learning" type="application/rss+xml"/>
    <link rel="alternate" title="安全圈活动" href="/rss?type=activity" type="application/rss+xml"/>
    <link rel="alternate" title="所有漏洞" href="/rss?type=vul" type="application/rss+xml"/>
    <link rel="alternate" title="通用型漏洞" href="/rss?type=commonvul" type="application/rss+xml"/>
    <link rel="alternate" title="事件型漏洞" href="/rss?type=eventvul" type="application/rss+xml"/>
    <link rel="alternate" title="热门漏洞" href="/rss?type=hotvul" type="application/rss+xml"/>

        <title>WordPress竞争条件漏洞导致权限提升 - 安全客 - 有思想的安全新媒体</title>
    
        <meta name="keywords" content="WordPress,漏洞,权限提升,竞争条件"/>
    
        <meta name="description" content="WordPress竞争条件漏洞导致权限提升 在这本系列文章中，Check Point公司的漏洞研究员Netanel Rubin将通过三篇文章，为大家详细讲述漏洞挖掘的故事：在WordPress核心代码"/>
        <meta property="wb:webmaster" content="224437c7be31d633"/>

    <script type="text/javascript" src="http://s7.qhimg.com/!56caa871/xpc_sync_height.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="/css/common_new.css?v=4.4.2.1" />
    <link rel="stylesheet" type="text/css" href="/css/jquery.notyfy.css" />
    <link rel="stylesheet" type="text/css" href="/css/notyfy.theme.default.css" />
    <link rel="stylesheet" type="text/css" href="/css/s_common.css?v=2.2.7" media="only screen and
    (max-device-width:900px), only screen and (max-width:900px)" />
    <script type="text/javascript" src="/js/jquery.min.js?v=3.1"></script>
    <script type="text/javascript" src="/js/jquery.notyfy.js"></script>
    <script type="text/javascript" src="/js/iscroll.js"></script>
    <script src="http://js.passport.qihucdn.com/5.0.3.js"></script>
    <script type="text/javascript">
        var myScroll, myNavScroll;

        function iscrollLoaded() {
            myScroll = new IScroll('#wrapper',
                {
                    scrollX: true,
                    scrollY: false,
                    bounceEasing: 'circular',
                    eventPassthrough: true,
                    preventDefault: false,
                    bounceTime: 500
                }
            );
        }

        $(function () {

            //导航横向滚动


            function setNavWidth() {

                /* 计算导航宽度 */
                var allWidth = $(window).width();
                var scroller = $('#scroller');

                if (allWidth > 900) {
                    scroller.find('ul').add(scroller.find('.scroll')).removeAttr('style');
                    scroller.css('overflow', 'visible');
                    if (myNavScroll) myNavScroll.destroy();
                } else {

                    var width = 0;
                    scroller.find('.scroll').children('ul').children('li').each(function (index, el) {
                        if (!$(this).hasClass('mobile-hide')) {
                            width += $(this).outerWidth();
                        }
                    });
                    scroller.find('ul').add(scroller.find('.scroll')).width(width);

                    if (myNavScroll) myNavScroll.destroy();

                    myNavScroll = new IScroll('#scroller', {
                        scrollX: true,
                        scrollY: false,
                        momentum: false,
                        click: true
                    });

                }

            }

            setNavWidth();
            $(window).resize(function (event) {
                setNavWidth();
            });

        });

    </script>
</head>
<body onload="iscrollLoaded();">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src=""/>
</div>

<div id="is-mobile"></div>
<div class="container">
        <div class="mobile-header">
        <div class="header clearfix">
            <div class="header-wrapper clearfix">
                <a href="/index/index" class="logo"><img class="slogan" src="/img/logo.png?v=1.5"/></a>
                                <form id="search" class="search-box" action="/search/index" method="GET">
                    <input class="keys" name="keywords" type="text" placeholder="搜索漏洞" required="required">
                    <input class="icon" type="submit" value="">
                    <input type="hidden" name="type" value=""/>
                </form>
                <div class="bug">
                    <div class="name"><span class="seled">全部</span><i class="arrow"></i></div>
                    <ul class="typelist">
                        <li data-index="3"><a href="javascript:void(0);">全部</a></li>
                        <li data-index="0"><a href="javascript:void(0);">漏洞</a></li>
                        <li data-index="1"><a href="javascript:void(0);">资讯</a></li>
                        <li data-index="2"><a href="javascript:void(0);">知识</a></li>
                    </ul>
                </div>
                                <div class="logNreg mobile-hide">
                    <div class="unlog">
                        <i></i>
                        <a href="log.html" class="log">登录</a>
                        <span>|</span>
                        <a href="reg.html" class="reg">注册</a>
                    </div>
                    <div class="loged">
                        <a href="/member/profile" class="user-center"><i></i><span class="user-name-tag">个人中心</span></a>
                        <div class="user-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting"><a href="http://i.360.cn/profile/accountmanage"
                                                               target="_blank"><i></i><span>账号设置</span></a></li>
                                <li class="alert-setting"><a href="/keywords/index"
                                                             target="_blank"><i></i><span>告警设置</span></a></li>
                                <li class="bug-alert"><a href="/myalarm/index" target="_blank"><i></i><span>漏洞告警</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mylearn/index" target="_blank"><i></i><span>我的知识</span></a>
                                </li>
                                <li class="my-knowl"><a href="/mycourse/index" target="_blank"><i></i><span>我的课堂</span></a>
                                </li>
                                <li class="my-exit"><a
                                            href="http://login.360.cn/?src=pcw_adlab&op=logout&destUrl=http://bobao.360.cn"><i></i><span>退出系统</span></a>
                                </li>
                            </ul>
                        </div>

                        <a href="/message" class="message-center" target="_blank"><i></i><span>我的消息</span></a>
                        <div class="message-links">
                            <span class="arrow"></span>
                            <ul>
                                <li class="account-setting" style="display:none;"><a href="/myres/index"
                                                                                     target="_blank"><i></i><span>回复我的</span></a>
                                </li>
                                <li class="my-bug"><a href="/myvul/index"
                                                      target="_blank"><i></i><span>我的漏洞</span></a></li>
                                <!--<li class="my-bug"><a href="/myres/index" target="_blank"><i></i><span>我的评论</span></a></li>-->
                                <!--<li class="alert-setting"><a href="###" target="_blank"><i></i><span>提到我的</span></a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style type="text/css">
            .nav {
                overflow: hidden;
            }

            .nav .scroll {
                width: auto;
            }
        </style>
        <div id="wrapper">
            <div id="scroller" class="nav">
                <div class="scroll">
                    <ul class="nav-list">
                        <li ><a class="link-nav"
                                                                                 href="/index/index">首页</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/vul/index">漏洞</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/introduce/list">招聘</a>
                        </li>
                        <li >
                        <a class="link-nav" href="/news/index">资讯</a><!--<i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/introduce/list">招聘</a></li>
                        </ul>
			-->
                        </li>
                        <li class="cur">
                        <a class="link-nav" href="/learning/index">知识</a><i class="arrow mobile-hide"></i>
                        <ul class="subnav-list mobile-hide">
                            <li><a class="link-subnav" href="/course/index">学院</a></li>
                        </ul>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/activity/index">活动</a></li>
                        <li class="mobile-hide "><a class="link-nav"
                                                                                                   href="/ctf/index">CTF训练营</a>
                        </li>
                        <li ><a class="link-nav"
                                                               href="/interref/list">安全内参</a></li>
                        <li ><a class="link-nav" href="/app/index">APP</a></li>

                        <!--<li ><a href="/course/index">学院</a></li>-->
                        <!--<li ><a href="/introduce/list">招聘</a></li>-->
                        <!--<li  class="mobile-hide"><a href="/ctf/index">CTF训练营</a></li>-->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mobile-content">
        <link rel="stylesheet" type="text/css" href="/css/news.css?v=3.5" />
<link rel="stylesheet" type="text/css" href="/ue/SyntaxHighlighter/shCoreDefault.css?v=1.0" />
<style>
    p .syntaxhighlighter {
        width: 80%;
    }
</style>

<div class="cur-pos w1000">当前位置：<a href="http://bobao.360.cn/">安全客</a> &gt;&gt; 知识详情</div>

<div class="content clearfix">
    <div class="main">
        <div class="article">
            <div id="article_box">
                <h2>WordPress竞争条件漏洞导致权限提升</h2>
                <div class="article-msg">
                    <span class="time">2015-08-06 10:50:06</span>
                                        <span class="read">阅读：10332次</span>
                    <span><a style="display: none;" class="good" href="javascript:;"
                             data-target="/learning/good" data-value="g_569"
                             data-type="learning">点赞(0)</a></span>
                    <span><a class="fav" href="javascript:;" data-target="/mylearning/add"
                             data-pk="569" data-type="learning">收藏</a></span>
                                        <span><a style="margin-left: 4px;" class="fav" href="http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/"
                             target="_blank">来源： 360安全播报</a></span>
                    
                                    </div>
                <hr size="1">
                <div class="article-msg">
                    <p><!-- JiaThis Button BEGIN -->

<!--
<span class="jiathis_style"><span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_renren"></a>
    <a class="jiathis_button_xiaoyou"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
</span>

-->
</p>
                </div>
                <p><p style="text-indent: 2em; text-align: center;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(0, 176, 80);"> </span></p><p style="text-align:center"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(0, 176, 80);"><img alt="http://p8.qhimg.com/t019ed20d6bbed34e16.png" src="http://p8.qhimg.com/t019ed20d6bbed34e16.png" title="t019ed20d6bbed34e16.png"/></span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(0, 176, 80);">在这本系列文章中，Check Point公司的漏洞研究员Netanel Rubin将通过三篇文章，为大家详细讲述漏洞挖掘的故事：在WordPress核心代码中发现缺陷和漏洞的曲折之旅，如何从只有可读权限的订阅用户开始，通过创建、编辑和删除帖子等手段，最终得以对世界上20%的web站点发起SQL注入和持久性XSS攻击。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-size: 16px; color: rgb(255, 0, 0);"><strong><span style="font-size: 16px; font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;;">内容提要</span></strong></span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">默认的WordPress安装中存在一些严重的安全漏洞，这使得上百万的网站时刻面临被黑的威胁。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">MITRE将这些漏洞记为CVE-2015-5623、CVE-2015-2213、CVE-2015-5714、CVE-2015-5715、CVE-2015-5716。而*CVE-2015-2212与CVE-2015-5623是重复的。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">对于上面列出的第一个漏洞，已经在最新的WordPress security release（4.2.3）中提供了相应的补丁。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">在这个安全更新发布的同时，该公司敦促没有启用自动更新的网站的管理员尽快更新网站。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">对于其他的安全补丁，请随时关注我们的博客以及WordPress即将推出的安全建议。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">Check Point的用户可以通过IPS签名为上述漏洞提供安全保护。</span></p><p style="text-indent:2em;text-align:left;"><span style="color: rgb(255, 0, 0);"><strong><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 16px;">序言</span></strong></span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">WordPress是一个基于PHP的内容管理系统(CMS)，同时也是当今互联网上影响最为突出的Web平台。 据估计，全球最大的1000000个网站中，有超过20%的站点都是基于该平台的。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">WordPress站点经常遭到网络犯罪分子和恶意黑客的攻击，因为只要得手，他们就能获得私人数据库和内部网络的访问权限。一般情况下，WordPress之所以会被攻陷，通常都是过时的插件组件中的漏洞所致。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">WordPress如此流行，自然成为世界上最受关注软件之一，在安全评估和脆弱性研究方面，每天都会有成千上万的眼睛在盯着它的新特性、Bug补丁以及第三方插件。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">尽管如此，研究人员偶尔也会在第三方插件中发现一些安全漏洞，这些插件都是由第三方编写的，并其是由网站管理员单独安装的。像这样的漏洞，每周都会通过各种渠道公之于众，例如邮寄列表等。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">虽然第三方插件代码中经常发现漏洞，但是WordPress自身的代码却很少出现这种情况，这是因为WordPress的核心开发人员不仅训练有素，并且对所有代码的安全性都能保持高度的警惕。我们可以证实，在审计源代码期间，我们发现开发人员不但没有给攻击者“留下任何机会”，而且还针对大部分攻击向量提供了多重安全保护措施。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">面对如此复杂的软件，却能保证如此高的安全特性，WordPress的开发者所付出的努力理应受到倍加称赞，尤其考虑到这是用安全方面臭名昭著的PHP所开发，更是令人肃然起敬。Check Point的漏洞研究人员通常都是以这类备受瞩目的平台为研究目标，努力提高这些通用软件的安全性。 我们所发现的安全漏洞在公开披露之前，会首先提交给软件供应商以尽快修复漏洞，从而为保护世界各地的用户作出贡献。此外，Check Point的客户还可以通过我们的产品线优先受到相应的保护（因为有时我们的补丁会先于厂商发布）。 因此，我们之所以审计WordPress并发现了这些严重的安全漏洞，也就不足为奇了。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">我们打算在WordPress发布所有补丁之后，再公开这些漏洞的技术细节。WordPress 团队已经对此作出了回应，并发布了相应的安全警告，目前，他们正在赶着修补所有这些漏洞。 由于CVE-2015-5623已经提供了相应的安全补丁，所以我们就先从它开始，介绍我们的漏洞猎捕三部曲。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">WordPress采用了一种功能丰富、易于扩展的角色和能力模型，其中每个用户都被指定一种角色，从权限最低的订阅者到有无限权力的超级管理员。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">我们知道，即使订阅者也是有权访问WordPress管理员控制面板的，该面板位于/admin目录。相对于管理员而言，订阅者可以使用的面板选项极为有限，因为会受到相应权限的限制。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">在默认情况下，订阅者只有“read_page”和“read_post”权限，可以读取文章和网页。 但是，对于管理员来说，他具有所有的权限，能够创建/编辑文章，上传文件并管理配置等。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">每当用户试图利用current_user_can()函数完成一项动作时，WordPress都会检查他们的备案的权限。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">函数current_user_can()在收到所请求的能力后，会将其映射为用户完成某一动作所需的实际权限。 为此，它需要以相应的能力作为参数来调用map_meta_cap()函数，该函数将返回一个数组，其中包含具备这种能力所需的实际权限。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">然后，current_user_can()遍历数组，同时检查用户是否具备这些权限。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">作为攻击者，我们首先假定只具有订阅者角色的权限。一般情况下，WordPress网站都允许用户免费注册，新用户的默认角色就是订阅者。 作为订阅者，我们只能够读取页面和文章，但是作为攻击者，我们想要做的事情肯定要比这些有趣的多。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">为了了解能力是如何映射为实际权限的，我们不妨先来考察一下map_meta_cap()中的相关代码：</span></p><p style="text-align:center;"><img alt="http://p6.qhimg.com/t01783b7ff32d91773a.png" src="http://p6.qhimg.com/t01783b7ff32d91773a.png" title="t01783b7ff32d91773a.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">就像我们看到的，对于edit_post/edit_page能力，需要对相应文章进行必要的检查，即查看我们输入的文章ID是否存在（相应代码已经高亮显示）。 上述代码中，最有趣的部分是用来处理文章不存在的情况的，它没有给 $caps分配任何能力，并且数组返回值为空。谁曾想到，正由于没有设置任何能力，这个函数反而可以像不需要任何能力一样肆意而为，并且返回true。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">这就意味着，在理论上我们可以通过一个无效的文章ID来绕过能力检查。为了利用这一点，我们需要这样的代码：一是它会调用这个检查函数，二是在调用之前无需验证该文章ID。 令人遗憾的是，真正符合要求的并不多见。不过，我们可以重点考察一下函数edit_post()。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">这个函数可以用来更新文章。它首先会解析用于更新的输入内容，然后添加所需的元数据，插入格式，并且，所有这些工作都是在更新数据库中该文章对应数据项之前完成的。 该函数一旦解析完输入内容，就会调用wp_update_post()函数，该函数用于更新数据库中的相应的文章，以及其他次要事情，比如设置属性的缺省值。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">尽管edit_post()没有验证我们的文章ID，但是wp_update_post()却会这么做。也就是说，即使我们绕过了第一次的权限检查，也逃不过第二次，因为我们的ID在数据库中根本就不存在。 虽然我们无法编辑数据库中实际的文章，却几乎通过了edit_post检查的所有代码。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">下面，我们来考察代码中的一些有趣的东西：</span></p><p style="text-align:center;"><img alt="http://p8.qhimg.com/t01d6803b66d5ebebaf.png" src="http://p8.qhimg.com/t01d6803b66d5ebebaf.png" title="t01d6803b66d5ebebaf.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">可以看出，除了不能设置文章类型之外，我们可以控制$post_data中的任何值。 这就是说（尽管无法看到之前的代码），我们可以尝试更新文章的元数据或分类目录，从而进一步扩大我们的攻击面。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">为此，我们首先需要能够达到这个函数。调用这个函数的代码有多处，但是它们不是检查其他能力，就是检查我们试图编辑的文章是否存在。 所以，我们唯一可以利用的只有管理页面post.php了，其中会用到下列代码：</span></p><p style="text-align:center;"><img alt="http://p1.qhimg.com/t018702d7967ef48ebf.png" src="http://p1.qhimg.com/t018702d7967ef48ebf.png" title="t018702d7967ef48ebf.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">看起来，这段代码对于我们来说非常合适，它既不检查能力，也不验证文章ID，这正是我们所需要的。然而，我们还面临着另外一个问题，即调用check_admin_referer()函数。 这个函数会对系统指定给我们的CSRF令牌进行检查。这个令牌使用的是服务器随机生成的哈希值和当前时间，因此，攻击者很难猜到，也很难修改它们。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">为了访问edit_post()，我们首先需要得到这个令牌。观察代码我们发现，系统所预期的令牌格式为add-[POST_TYPE]，其中POST_TYPE就是我们试图编辑的文章的类型。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">我们试图通过一个不存在的文章ID绕过能力检查，来创建一个令牌动作“add-”，而不存在的文章是没有文章类型的。幸运的是，这里的代码首先会通过GET来获取该文章ID，并且只有当检索值为空时才会从post字段检索文章ID。 就是说我们有机会发送2个文章ID：把有效的文章ID放在GET参数中，把无效的文章ID放到POST参数中，这样，我们就能过使用两个令牌字符串来绕过能力检查。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">因为我们已经可以使用令牌字符串“add-post”，所以只需要找到可以访问的、能够生成这个令牌的代码即可。虽然这个任务听上去很简单，但是由于我们缺乏能力，这严重限制了我们所能访问的其他动作。 再说一遍，目前我们所需的只是这样一个位置而已，而它正好在wp_dashboard_quick_press()函数中找到了。 这段代码可以在其他行动中为我们生成一个有效的管理令牌。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">当一个缺乏必要能力的用户试图保存新的草稿的时候，这个函数就会被调用，具体看下列代码：</span></p><p style="text-align:center;"><img alt="http://p5.qhimg.com/t01f7667b9d2c392d7b.png" src="http://p5.qhimg.com/t01f7667b9d2c392d7b.png" title="t01f7667b9d2c392d7b.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">很明显，如果用户没有提供正确的令牌，或者缺乏edit_post能力，这个函数就会被触发，这样我们就会收到一个有效的管理令牌add-post。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">有了这个令牌，我们就能够在edit_post函数中肆意而为了，即使我们提供的是一个无效的文章ID。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">截至目前为止，我们已经能够在并不存在的文章中创建和添加不受保护的元数据，并选择分类目录及其他次要事情了。尽管这些看起来不错，但是对于攻击者的目标来说还相距甚远，我们希望真正能够编辑实际存在的文章，这要求能够访问受到edit_post能力检查保护的代码。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">下面，我们重新审视用于能力检查的代码：</span></p><p style="text-align:center;"><img alt="http://p6.qhimg.com/t01c8250c80c5dbcdf0.png" src="http://p6.qhimg.com/t01c8250c80c5dbcdf0.png" title="t01c8250c80c5dbcdf0.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">请注意我们高亮显示的代码——如果用户是文章的作者，并且文章目前标记为删除，这是就不需要任何能力了。这简直就是通向编辑权限的阳光大道。 但是，我们如何才能变成文章的作者，并将其状态设置为“trash”呢？</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">第一个问题比较容易，只要创建一篇文章，我们自然就会变成它的作者了。为此，我们只要调用wp_dashboard_quick_press()函数即可，这与创建令牌没有多大区别。 除了创建管理令牌之外，这个函数还检查先前的自动生成的草稿是否为当前用户所建。如果没有检测到草稿，那么这个函数就会调用get_default_post_to_edit()，该函数含有下列代码：</span></p><p style="text-align:center;"><img alt="http://p4.qhimg.com/t011dd6a0c1b8d223cd.png" src="http://p4.qhimg.com/t011dd6a0c1b8d223cd.png" title="t011dd6a0c1b8d223cd.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">可以看出，上面的代码会获取文章的标题、内容，并摘录请求参数，然后，如果得到允许，就会在数据库中创建文章。调用wp_insert_post()时，参数中没有包括文章作者，因此，系统会假设作者就是当前用户。 尽管变量$create_in_db默认值为false，但是在我们这里，wp_dashboard_quick_press()将其赋值为true，因此，会在数据库中创建一份自动生成的草稿。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">现在，我们在数据库中拥有了自己的文章，即我们是该文章的作者，下面我们将其状态改为“trash”。 下面，我们需要应用一些黑魔法。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">当我们进入edit_post()函数时，我们要编辑的文章ID必须不存在于DB中，否则能力检查失败并且脚本将停止执行，但当我们进入wp_update_post()函数(它用于修改数据库中的文章) 时，文章ID必须有效且存在于数据库中，否则改函数将返回错误消息“post does not exist”。我们怎样才能同时满足这两个相互矛盾的条件呢？</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">实际上，非常简单。 我们可以利用竞争条件。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">当我们进入edit_post()函数时，我们使用下一篇文章的ID。因为这些ID会自动递增，所以只要给出上一篇文章的ID，我们可以轻松猜出下一篇的。 这时候，我们的ID并不存在于数据库之中，所以我们能够通过能力检查，不会出现任何问题。然后，在这个函数执行期间，我们直接发送另一个请求，像前面介绍的那样新建一个快速草稿，这样就能在数据库中创建ID了。 一旦edit_post()函数想调用wp_update_post()从数据库中取出文章，这种情况就会发生，代码会一直呆在那里，这是毋庸置疑的。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">但是问题是，发送两个不同的请求（编辑文章请求，然后是创建文章请求）的具体方式，在这种情况下，我们必须精心调整时机才能使这个策略奏效。显然，我们必须延迟脚本的运行。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">下面，我们再来看看edit_post()的相关代码：</span></p><p style="text-align:center;"><img alt="http://p0.qhimg.com/t01b31dc3c303c8b648.png" src="http://p0.qhimg.com/t01b31dc3c303c8b648.png" title="t01b31dc3c303c8b648.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">我们看到，通过用逗号分割字符串，（我们可控的）变量$terms被转换成了一个数组。然后，代码会遍历这个数组，将每个元素视为一个分类目录名称，并尝试通过SELECT语句从数据库中取出它。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">虽然每个SELECT语句在管理有序、功能强大的服务器上只要几微秒就能执行完毕，但是别忘了，我们实际上要查询16MB（PHP对POST参数的硬性规定）的检索词，需要执行大约1.6亿次这样的查询，所以要耗费很多的时间。对于我本机上的一个空数据库，采用1GB的RAM和i7处理器，仅执行了10万次左右的查询就导致了30秒的延迟 。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">这给我们利用竞争条件提供了一种既有确定性又强大的手段，但是，事情还没有结束：为了能够有把握地充分利用安装在世界各地的所有WordPress上的这个漏洞，我们还有两项任务必须完成。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">对于调用edit_post()的代码来说，需要用到管理令牌；而为了取得管理令牌，我们又必须调用wp_dashboard_quick_press()，因此在这个过程中，我们实际上会创建一个快速草稿。正如前面所说，wp_dashboard_quick_press()只有在没有草稿的情况下才会新建一个，同时，当edit_post()被延迟时，为了创建文章我们需要再次调用同一个函数，就是说，前面所说的过程是不会发生的。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">那么，在已经存在一个草稿的情况下，我们如何新建草稿呢？ 实际上，由wp_dashboard_quick_press()创建的草稿与普通的草稿是不同的，它叫做快速草稿（QuickDraft），它具有自动保存功能。 就这点而论，草稿只是临时存放文章文本的一种方式，以防止数据突然丢失。由于这些草稿被视为临时内容，因此会在一周内自动删除。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">也就是说，为了利用这个漏洞，我们需要整整等上一周时间，因为一周后草稿才被删除。幸运的是，令牌通常延续24小时，这使得我们能够在预期删除日期的前一天获得令牌，并在草稿被删除后使用它来进入edit_post()函数。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">最后，通过令牌验证、权限验证、基本管理员验证、文章ID验证后，这时只要发送一个HTTP参数就能轻轻松松地把文章状态改为“trash”。真是谢天谢地。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">将这些绕过验证的手段结合起来，我们就可以利用成打的bug、有缺陷的权限验证系统以及验证系统中出现的各种错误的假设来获得部分编辑权限。当然，这根本就算不上什么严重漏洞，不过故事才刚刚开始，最终你会发现一个SQLi和XSS，这些我们放到后续的文章介绍。</span></p><p style="text-indent:2em;text-align:left;"><span style="font-size: 16px; color: rgb(255, 0, 0);"><strong><span style="font-size: 16px; font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;;">POC</span></strong></span></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">取得管理令牌/创建文章</span></p><p style="text-align:center;"><img alt="http://p8.qhimg.com/t01e4d97d60e30cc5eb.png" src="http://p8.qhimg.com/t01e4d97d60e30cc5eb.png" title="t01e4d97d60e30cc5eb.png"/></p><p style="text-indent:2em;text-align:left;"><span style="font-family: &quot;微软雅黑&quot;,&quot;Microsoft YaHei&quot;; font-size: 14px; color: rgb(38, 38, 38);">竞争条件</span></p><p style="text-align: center;"><img alt="http://p5.qhimg.com/t01060417eeabc35164.png" src="http://p5.qhimg.com/t01060417eeabc35164.png" title="t01060417eeabc35164.png"/></p></p>
                <hr/>
                <p style="text-align: center;">
                    <img src="http://bobao.360.cn/img/app.jpeg"/>
                    <img src="http://bobao.360.cn/img/weixin.jpeg"/>
                </p>
                                <p>本文由 安全客 翻译，转载请注明“转自安全客”，并附上链接。<br/><a class="text-more" href="http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/" target="_blank">原文链接：http://blog.checkpoint.com/2015/08/04/wordpress-vulnerabilities-1/</a></p>
                            </div>
            <div style="margin-top: 20px;background-color:#FFFFFF">
    <input type="hidden" id="detail_title" name="detail_title" value="WordPress竞争条件漏洞导致权限提升 - 安全客 - 有思想的安全新媒体" />
    <input type="hidden" id="use_nickname" name="use_nickname" value="0" />
    <a name="mao"></a>
    <div class="reg-log mobile-hiden">
        <div class="" id="userTo">   
            <div id="to-list" class="input-text" style="">
                <textarea disabled="disabled" class="hide"  id="comment-content" to="to"></textarea>
                <ul id="preadded" style="display:none">       
                </ul>
                <div id="to-auto" style="width: 200px">
                    <ul id="feed">
                    </ul>
                </div>
            </div>
        </div>
        <input type="hidden" id="source-id" value="569" />
        <input type="hidden" id="source-type" value="learning" />
        <input type="hidden" id="post-comment-url" value="/comment/add" />
        <input type="hidden" id="post-nickname-url-ajax" value="/comment/randnicknameajax" />
        <input type="hidden" id="post-check-login-url-ajax" value="/comment/checklogin" />
        <input type="hidden" id="stoken_comment_set" value="64d932c9bb50dc5a83db601d9b02e735">                 <span class="join">参与讨论，请先 <a href="javascript:;" class="comment-login">登录</a> | <a href="javascript:;" class="comment-reg">注册</a> |  <a href="javascript:;" class="anonymous-comment">匿名评论</a></span>
            </div>
    <div class="mobile-hide" style="width: 870px; margin: 0 auto;">
        <label style="vertical-align:middle;" for="use_nickname">匿名</label> 
        <input style="vertical-align:middle;" id="trigger-nickname" name="use_nickname" class="use_nickname" type="checkbox" value="0" />

        <a href="javascript:;" class="apply-use button" id="submit-comment" data-target="/comment/add">发布</a>
    </div>


    <div class="clearfix"></div>
    <div class="comments">
        <div class="comments-head">
            <span class="title">用户评论</span>
        </div>
                <div class="comment-none alarm-info bg-primary">无任何评论</div>
            </div>
</div>
<script>
    $(function () {
        $('.anonymous-comment').click(function () {
            $(".join").hide();
            $(".reg-log textarea").first().removeAttr("disabled").show();
            $('#use_nickname').val('1');
//            $('#trigger-nickname').attr('checked', true);
            $('#trigger-nickname').trigger('click');
        });
        //为所有复选框绑定事件
//        checkbox_on_click();
        //ajax随机获取昵称
//        randnicknameajax(0);
        //ajax检测登录状态
        comment_check_login();
    });



    function input_checkbox(flag) {
        $('input:checkbox').each(function () {
            var value = flag ? 1 : 0;
            $(this).prop('checked', flag);
            $(this).val(value);
        });
    }

//ajax随机获取昵称
    function randnicknameajax(flag) {
        $.ajax({
            type: 'POST',
            url: $('#post-nickname-url-ajax').val(),
            data: {limit: 1, flag: flag},
            dataType: "json",
            success: function (data) {
                $('#nick-name').val(data.data[0]);
                _nick_name=data.data[0];
            }
        });
    }
    $();
//ajax检测登录状态
    function comment_check_login() {
        $.ajax({
            type: 'POST',
            url: $('#post-check-login-url-ajax').val(),
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    $('.join').hide();
                    $(".reg-log textarea").first().removeAttr("disabled").show();
                    $("#span_use_nickname").show();
                    $('#use_nickname').val('0');
                    $('#use_nickname').attr('checked', false);
                }
            }
        });
    }
</script>        </div>
    </div>
    <div class="side-bar">
        <div class="mod hot-news">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-hot"></i><span>热门知识</span></h2>
    </div>
    <ul class="links-list">
                                <li><a href="/learning/detail/4411.html" alt="【漏洞预警】一个换行符引发的奥斯卡0day漏洞(CVE-2017-8759)重现——最新的Office高级威胁攻击预警" target="_blank">【漏洞预警】一个换行符引发的奥斯卡...</a></li>
                                <li><a href="/learning/detail/4416.html" alt="【漏洞预警】Microsoft .NET Framework漏洞（CVE–2017–8759）预警" target="_blank">【漏洞预警】Microsoft .NE...</a></li>
                                <li><a href="/learning/detail/4414.html" alt="【技术分享】妙用JavaScript绕过XSS过滤" target="_blank">【技术分享】妙用JavaScrip...</a></li>
                                <li><a href="/learning/detail/4425.html" alt="【安全报告】XShellGhost事件技术回顾报告" target="_blank">【安全报告】XShellGhost事件...</a></li>
                                <li><a href="/learning/detail/4424.html" alt="【知识】9月16日 - 每日安全知识热点" target="_blank">【知识】9月16日 - 每日安全知识热...</a></li>
                                <li><a href="/learning/detail/4418.html" alt="【技术分享】利用威胁情报数据平台拓展APT攻击线索一例" target="_blank">【技术分享】利用威胁情报数据平台拓...</a></li>
            </ul>
</div>        <!-- 友情链接 -->
        <div class="mod blog-links mobile-hide">
    <div class="head-bar clearfix">
        <h2><i class="icon icon-link"></i><span>友情链接</span></h2>
        <a href="/links/index.html" class="more">更多<i></i></a>
    </div>
        <ul class="links-list">
                <li><a href="http://bbs.360safe.com" alt="360安全社区" target="_blank">360安全社区</a></li>
                <li><a href="http://zhuji.360.cn" alt="360主机卫士" target="_blank">360主机卫士</a></li>
                <li><a href="http://blogs.360.cn/" alt="奇虎360技术博客" target="_blank">奇虎360技术博客</a></li>
                <li><a href="http://wangzhan.360.cn/" alt="360网站卫士" target="_blank">360网站卫士</a></li>
                <li><a href="http://webscan.360.cn/" alt="360网站安全检测" target="_blank">360网站安全检测</a></li>
                <li><a href="http://research.360.cn/report/" alt="360研究报告" target="_blank">360研究报告</a></li>
                <li><a href="http://unicorn.360.cn/" alt="360 Unicorn Team" target="_blank">360 Unicorn Team</a></li>
                <li><a href="http://appscan.360.cn/" alt="360捉虫猎手" target="_blank">360捉虫猎手</a></li>
                <li><a href="https://threathunter.org/" alt="ThreatHunter社区" target="_blank">ThreatHunter社区</a></li>
                <li><a href="http://security.360.cn/" alt="360安全应急响应中心" target="_blank">360安全应急响应中心</a></li>
            </ul>
    </div>
        <!-- 联系我们 -->
        <div class="mod contact mobile-hide" style="text-align:center">
    <div class="head-bar clearfix">
        <h2><i></i><span>关注我们</span></h2>
    </div>
    <!-- 微信关注 -->
    <ul class="contact-way">
        <li><a>微信关注</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/qrcode_adlab_weixin.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
    <!-- APP下载 -->
    <ul class="contact-way">
        <li><a>安全播报APP</a></li>
    </ul>
    <div style="padding-left:20px;padding-bottom:15px;">
    <img src="/img/scan_code_big.png?v=1.1"  width="145px" height="145px;"/>
    </div>
    
</div>

    </div>
</div>

<script type="text/javascript" src="/js/jquery-ui.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/jquery.noty.packaged.min.js?v=3.0"></script>
<script type="text/javascript" src="/js/common.js?v=4.5"></script>
<script>$(function() {sync_count('comment');});</script>


<!-- 语法高亮 -->
<script type="text/javascript" src="/ue/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();sync_count('vul');sync_count('news');sync_count('learning');sync_count('activity');sync_count('course');sync_count('ctf');</script>
    </div>

        <div class="footer">
        <div class="friend-link">
            <a href="http://www.360.cn/" target="_blank">360首页</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">关于我们</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">联系我们</a>
            <span>|</span>
            <a href="/links/index.html" target="_blank">友情链接</a>
            <span>|</span>
            <a href="/introduce/index" target="_blank">招贤纳士</a>
        </div>
        <div class="copy">
            Copyright &copy; 360网络攻防实验室 All Rights Reserved <span class="copy_icp">京ICP证080047号[京ICP备08010314号-6]</span>
        </div>
    </div>
    
</div>

<!--奇舞团统计-->

<script src='https://s.ssl.qhimg.com/static/f5407c785655e6a1/monitor_analytic.js'></script>
<script>
    monitor.setProject('QH_171_1').getTrack().getClickAndKeydown().getClickHeatmap(10, 1);
</script>

<div class="hide">
    <script src="https://s95.cnzz.com/z_stat.php?id=1253147824&web_id=1253147824" language="JavaScript"></script>
</div>
<div class="backToTop_wrap off">
    <a id="back_to_top" class="backToTop" href="javascript:;" title="返回顶部"></a>
</div>
<script>
    var $backToTop_wrap = $(".backToTop_wrap"),
        $backToTop_btn = $("#back_to_top");

    if ($(window).scrollTop() > 100) {
        $backToTop_wrap.removeClass("off");
    }
    else {
        $backToTop_wrap.addClass("off");
    }

    $(window).on("scroll", function () {
        if ($(this).scrollTop() > 100) {
            $backToTop_wrap.removeClass("off");
        }
        else {
            $backToTop_wrap.addClass("off");
        }
    });

    $backToTop_btn.on("click", function () {
        $("html, body").animate({scrollTop: 0}, 120);
    });

    $(function () {
        var navlist = $('.nav-list > li');

        navlist.each(function () {
            $(this).on('mouseenter', function () {
                $(this).addClass('selected');
            });

            $(this).on('mouseleave', function () {
                $(this).removeClass('selected');
            });
        });
    })
</script>



</body>
</html>
