<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>macOS软件安全系列-软件内幕篇：Mach-O文件格式 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; macOS软件安全系列-软件内幕篇：Mach-O文件格式评论Feed" href="http://www.mottoin.com/95673.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='macOS软件安全系列-软件内幕篇：macOS平台软件的下载与安装' href='http://www.mottoin.com/95667.html' />
<link rel='next' title='JSONP注入实践' href='http://www.mottoin.com/95682.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=95673' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="macOS,macOS软件,macOS软件安全，软件内幕，Mach-O文件格式,软件安全">
<meta name="description" content="0x1通用二进制格式虽然macOS系统使用了很多UNIX上的特性，但它并没有使用ELF作为系统的可执行文件格式，而是使用自家独创的Mach-O文件格式。macOS系统一路走来，支持的CPU及硬件平台都有了很大的变化，从早期的PowerPC平台，到后来的x86，再到现在主流的arm、x86-64平台。软件开发人员为了做到不同硬件平台的兼容性，如果需要为每一个平台编译一个可执行文件，这将是非常繁琐的。">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-95673 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item current-post-ancestor current-menu-parent current-post-parent"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-95673" class="post-95673 post type-post status-publish format-standard has-post-thumbnail hentry category-topic tag-macos tag-macosmach-o tag-2634">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">macOS软件安全系列-软件内幕篇：Mach-O文件格式</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/nonworm/">非虫</a>
                                <span class="dot">•</span>
                                <span>2017年1月19日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/sole/topic" rel="category tag">专题</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 3512</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <h2>0x1 通用二进制格式</h2>
<p>虽然macOS系统使用了很多UNIX上的特性，但它并没有使用ELF作为系统的可执行文件格式，而是使用自家独创的Mach-O文件格式。</p>
<p>macOS系统一路走来，支持的CPU及硬件平台都有了很大的变化，从早期的PowerPC平台，到后来的x86，再到现在主流的arm、x86-64平台。软件开发人员为了做到不同硬件平台的兼容性，如果需要为每一个平台编译一个可执行文件，这将是非常繁琐的。为了解决软件在多个硬件平台上的兼容性问题，苹果开发了一个通用的二进制文件格式（Universal Binary）。又称为胖二进制（Fat Binary），通用二进制文件中将多个支持不同CPU架构的二进制文件打包成一个文件，系统在加载运行该程序时，会根据通用二进制文件中提供的多个架构来与当前系统平台做匹配，运行适合当前系统的那个版本。</p>
<p>苹果自家系统中存在着很多通用二进制文件。比如/usr/bin/python，在终端中执行file命令可以查看它的信息：</p>
<pre>$ file /usr/bin/python
/usr/bin/python: Mach-O universal binary with 2 architectures
/usr/bin/python (for architecture x86_64): Mach-O 64-bit executable x86_64
/usr/bin/python (for architecture i386): Mach-O executable i386</pre>
<p>系统提供了一个命令行工具lipo来操作通用二进制文件。它可以添加、提取、删除以及替换通用二进制文件中特定架构的二进制版本。例如提取python中x86_64版本的二进制文件可以执行：</p>
<pre>lipo /usr/bin/python -extract x86_64 -output ~/Desktop/python.x64</pre>
<p>删除x86版本的二进制文件可以执行：</p>
<pre>lipo /usr/bin/python -remove i386 -output ~/Desktop/python.x64</pre>
<p>或者直接瘦身为x86_64版本：</p>
<pre>lipo /usr/bin/python -thin x86_64 -output ~/Desktop/python.x64</pre>
<p>通用二进制的“通用”不止针对可以直接运行的可执行程序，系统中的动态库dylib、静态库.a文件以及框架等都可以是通用二进制文件，对它们也可以同样使用lipo命令来进行管理。</p>
<p>下来看一下通用二进制的文件格式。安装好macOS程序开发的SDK后，或者在xnu的内核源码中，都可以在&lt;mach-o/fat.h&gt;文件中找到通用二进制文件格式的声明。从文件命名上看，将通用二进制称为胖二进制更方便一些。胖二进制头部结构fat_header定义如下：</p>
<pre>#define FAT_MAGIC 0xcafebabe
#define FAT_CIGAM 0xbebafeca /* NXSwapLong(FAT_MAGIC) */

struct fat_header {
 uint32_t magic; /* FAT_MAGIC */
 uint32_t nfat_arch; /* number of structs that follow */
};</pre>
<p>magic字段被定义为常量FAT_MAGIC，它的取值是固定的0xcafebabe，表示这是一个通用的二进制文件。nfat_arch字段指明了通用二进制中包含多少个Mach-O文件。</p>
<p>每个通用二进制架构信息都使用fat_arch结构表示，在fat_header结构体之后，紧接着的是一个或多个连续的fat_arch结构体，它的定义如下：</p>
<pre>struct fat_arch {
 cpu_type_t cputype; /* cpu specifier (int) */
 cpu_subtype_t cpusubtype; /* machine specifier (int) */
 uint32_t offset; /* file offset to this object file */
 uint32_t size; /* size of this object file */
 uint32_t align; /* alignment as a power of 2 */
};</pre>
<p>cputype指定了具体的cpu类型，它的类型是cpu_type_t，定义位于mach/machine.h中。cpu的常用类型主要有如下几种：</p>
<pre>#define CPU_TYPE_X86 ((cpu_type_t) 7)
#define CPU_TYPE_I386 CPU_TYPE_X86 
#define CPU_TYPE_X86_64 (CPU_TYPE_X86 | CPU_ARCH_ABI64)
#define CPU_TYPE_MC98000 ((cpu_type_t) 10)
#define CPU_TYPE_HPPA ((cpu_type_t) 11)
#define CPU_TYPE_ARM ((cpu_type_t) 12)
#define CPU_TYPE_ARM64 (CPU_TYPE_ARM | CPU_ARCH_ABI64)
#define CPU_TYPE_MC88000 ((cpu_type_t) 13)
#define CPU_TYPE_SPARC ((cpu_type_t) 14)
#define CPU_TYPE_I860 ((cpu_type_t) 15)
#define CPU_TYPE_POWERPC ((cpu_type_t) 18)
#define CPU_TYPE_POWERPC64 (CPU_TYPE_POWERPC | CPU_ARCH_ABI64</pre>
<p>macOS平台上的CPU类型一般为CPU_TYPE_X86_64。</p>
<p>cpusubtype指定了cpu的子类型。它的类型是cpu_subtype_t。cpu子类型主要有如下几种：</p>
<pre>#define CPU_SUBTYPE_MASK 0xff000000
#define CPU_SUBTYPE_LIB64 0x80000000
#define CPU_SUBTYPE_X86_ALL ((cpu_subtype_t)3)
#define CPU_SUBTYPE_X86_64_ALL ((cpu_subtype_t)3)
#define CPU_SUBTYPE_X86_ARCH1 ((cpu_subtype_t)4)
#define CPU_SUBTYPE_X86_64_H ((cpu_subtype_t)8)
......</pre>
<p>cpu子类型一般CPU_SUBTYPE_LIB64与CPU_SUBTYPE_X86_64_ALL比较常见。</p>
<p>offset字段指明了当前cpu架构数据相对于当前文件开头的偏移值。size字段指明了数据的大小。</p>
<p>align字段指明了数据的内存对齐边界，取值必须是2的次方，它确保了当前cpu架构的目标文件加载到内存中时，数据是经过内存优化对齐的。</p>
<p>可以使用otool工具打印本机安装的python程序的fat_header信息。如下：</p>
<pre>otool -f -V /usr/bin/python
Fat headers
fat_magic FAT_MAGIC
nfat_arch 2
architecture i386
 cputype CPU_TYPE_I386
 cpusubtype CPU_SUBTYPE_I386_ALL
 capabilities 0x0
 offset 4096
 size 29632
 align 2^12 (4096)
architecture x86_64
 cputype CPU_TYPE_X86_64
 cpusubtype CPU_SUBTYPE_X86_64_ALL
 capabilities CPU_SUBTYPE_LIB64
 offset 36864
 size 29872
 align 2^12 (4096)</pre>
<p>如果你是UNIX的使用者，经常使用GNU里面binutils提供的objdump查看可执行文件信息的话，在macOS上可以使用它的移植版本gobjdump，使用HomeBrew运行以下命令进行安装：</p>
<pre>$ brew install binutils</pre>
<p>完装完成后，执行下面的命令也可以查看python程序的fat_header信息：</p>
<pre>$ gobjdump -f /usr/bin/python
In archive /usr/bin/python:

i386: file format mach-o-i386
architecture: i386, flags 0x00000012:
EXEC_P, HAS_SYMS
start address 0x00001be0

i386:x86-64: file format mach-o-x86-64
architecture: i386:x86-64, flags 0x00000012:
EXEC_P, HAS_SYMS
start address 0x0000000100000e20</pre>
<p>在fat_arch结构体往下就是具体的Mach-O文件格式了，它的内容复杂得多，将在下一小节进行讨论。</p>
<h2>0x2 Mach-O文件格式简介</h2>
<p>Mach-O（Mach Object File Format）描述了macOS系统上可执行文件的格式。熟悉Mach-O文件格式，有助于了解苹果底层软件运行机制，更好的掌握dyld加载Mach-O的步骤，为自己动手开发Mach-O相关的加解密工具打下基础。</p>
<p>一个典型的Mach-O文件格式如图所示：</p>
<p><img class="alignnone size-full wp-image-95674 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-35f7008ce676b29129f9ec8bed3c464f_b.png" alt="v2-35f7008ce676b29129f9ec8bed3c464f_b" width="600" height="311" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-35f7008ce676b29129f9ec8bed3c464f_b.png 600w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-35f7008ce676b29129f9ec8bed3c464f_b-300x156.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>通过上图，可以看出Mach-O主要由以下三部分组成：</p>
<ul>
<li>Mach-O头部（mach header）。描述了Mach-O的cpu架构、文件类型以及加载命令等信息。</li>
<li>加载命令（load command）。描述了文件中数据的具体组织结构，不同的数据类型使用不同的加载命令表示。</li>
<li>Data。Data中的每个段（segment）的数据都保存在这里，段的概念与ELF文件中段的概念类似。每个段都有一个或多个Section，它们存放了具体的数据与代码。</li>
</ul>
<h2>0x3 Mach-O头部</h2>
<p>与Mach-O文件格式有关的结构体，都可以直接或间接的在”mach-o/loader.h“文件中找到。</p>
<p>针对32位与64位架构的cpu，分别使用了mach_header与mach_header_64结构体来描述Mach-O头部。</p>
<p>mach_header结构体的定义如下：</p>
<pre>struct mach_header {
 uint32_t magic; /* mach magic number identifier */
 cpu_type_t cputype; /* cpu specifier */
 cpu_subtype_t cpusubtype; /* machine specifier */
 uint32_t filetype; /* type of file */
 uint32_t ncmds; /* number of load commands */
 uint32_t sizeofcmds; /* the size of all the load commands */
 uint32_t flags; /* flags */
};</pre>
<p>magic字段与fat_header结构体中的magic字段一样，表示Mach-O文件的魔数值，对于32位架构的程序来说，它的取值是MH_MAGIC，固定为0xfeedface。</p>
<p>cputype与cpusubtype字段与fat_header结构体中的含义完全相同。</p>
<p>filetype字段表示Mach-O的具体文件类型。它的取值有：</p>
<pre>#define MH_OBJECT 0x1 /* relocatable object file */
#define MH_EXECUTE 0x2 /* demand paged executable file */
#define MH_FVMLIB 0x3 /* fixed VM shared library file */
#define MH_CORE 0x4 /* core file */
#define MH_PRELOAD 0x5 /* preloaded executable file */
#define MH_DYLIB 0x6 /* dynamically bound shared library */
#define MH_DYLINKER 0x7 /* dynamic link editor */
#define MH_BUNDLE 0x8 /* dynamically bound bundle file */
#define MH_DYLIB_STUB 0x9 /* shared library stub for static */
 /* linking only, no section contents */
#define MH_DSYM 0xa /* companion file with only debug sections */
#define MH_KEXT_BUNDLE 0xb /* x86_64 kexts */</pre>
<p>这里主要关注MH_EXECUTE、MH_DYLIB与MH_DYLIB这3个文件格式。</p>
<p>接下来的ncmds指明了Mach-O文件中加载命令（load commands）的数量。</p>
<p>sizeofcmds字段指明了Mach-O文件加载命令（load commands）所占的总字节大小。</p>
<p>flags字段表示文件标志，它是一个含有一组位标志的整数，指明了Mach-O文件的一些标志信息。可用的值有：</p>
<pre>#define MH_NOUNDEFS 0x1
#define MH_INCRLINK 0x2
#define MH_DYLDLINK 0x4
#define MH_LAZY_INIT 0x40
#define MH_TWOLEVEL 0x80
#define MH_PIE 0x200000
......</pre>
<p>针对64位Mach-O的mach_header_64结构体定义如下：</p>
<pre>struct mach_header_64 {
 uint32_t magic; /* mach magic number identifier */
 cpu_type_t cputype; /* cpu specifier */
 cpu_subtype_t cpusubtype; /* machine specifier */
 uint32_t filetype; /* type of file */
 uint32_t ncmds; /* number of load commands */
 uint32_t sizeofcmds; /* the size of all the load commands */
 uint32_t flags; /* flags */
 uint32_t reserved; /* reserved */
};</pre>
<p>相比mach_header，它多出了一个reserved字段，目前它的取值系统保留。mach_header_64结构体中的字段与mach_header中的基本一致，除了magic字段的取值是MH_MAGIC_64，固定的值为0xfeedfacf。</p>
<p>学习Mach-o文件格式时，可以使用辅助工具查看具体的文件结构，这样效果更加直观。</p>
<p>下图是MachOView查看optool程序Mach64 Header的效果：</p>
<p><img class="alignnone size-full wp-image-95675 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-a149716ef25810937e196f02d5d7c1a1_r.png" alt="v2-a149716ef25810937e196f02d5d7c1a1_r" width="1800" height="880" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-a149716ef25810937e196f02d5d7c1a1_r.png 1800w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-a149716ef25810937e196f02d5d7c1a1_r-300x147.png 300w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-a149716ef25810937e196f02d5d7c1a1_r-768x375.png 768w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-a149716ef25810937e196f02d5d7c1a1_r-1024x501.png 1024w" sizes="(max-width: 1800px) 100vw, 1800px" /></p>
<p>下图是010 Editor查看optool程序Mach64 Header的效果：</p>
<p><img class="alignnone size-full wp-image-95676 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-6e4998d2c3e845469bd58992c28e9803_r.png" alt="v2-6e4998d2c3e845469bd58992c28e9803_r" width="2310" height="1154" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-6e4998d2c3e845469bd58992c28e9803_r.png 2310w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6e4998d2c3e845469bd58992c28e9803_r-300x150.png 300w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6e4998d2c3e845469bd58992c28e9803_r-768x384.png 768w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6e4998d2c3e845469bd58992c28e9803_r-1024x512.png 1024w" sizes="(max-width: 2310px) 100vw, 2310px" /></p>
<p>这三款工具对于学习Mach-O文件格式都是非常有帮助的，读者在实际分析时可以多多使用。</p>
<h2>0x4 加载命令</h2>
<p>在mach_header之后的是Load Command加载命令，这些加载命令在Mach-O文件加载解析时，被内核加载器或者动态链接器调用，基本的加载命令的数据结构如下：</p>
<pre>struct load_command {
 uint32_t cmd; /* type of load command */
 uint32_t cmdsize; /* total size of command in bytes */
};</pre>
<p>此结构对应的成员只有2个：cmd字段代表当前加载命令的类型。cmdsize字段代表当前加载命令的大小。</p>
<p>cmd的类型不同，所代表的加载命令的类型就不同，它的结构体也会有所不一样，对于不同类型的加载命令，它们都会在load_command结构体后面加上一个或多个字段来表示自己特定的结构体信息。</p>
<p>macOS系统在进化的过程中，加载命令算是比较频繁被更新的一个数据结构体，截止到macOS 10.12系统，加载命令的类型cmd的取值共有48种。它们的部分定义如下：</p>
<pre>#define LC_SEGMENT 0x1 /* segment of this file to be mapped */
#define LC_SYMTAB 0x2 /* link-edit stab symbol table info */
#define LC_SYMSEG 0x3 /* link-edit gdb symbol table info (obsolete) */
#define LC_THREAD 0x4 /* thread */
#define LC_UNIXTHREAD 0x5 /* unix thread (includes a stack) */
#define LC_LOADFVMLIB 0x6 /* load a specified fixed VM shared library */
#define LC_IDFVMLIB 0x7 /* fixed VM shared library identification */
#define LC_IDENT 0x8 /* object identification info (obsolete) */
#define LC_FVMFILE 0x9 /* fixed VM file inclusion (internal use) */
#define LC_PREPAGE 0xa /* prepage command (internal use) */
#define LC_DYSYMTAB 0xb /* dynamic link-edit symbol table info */
#define LC_LOAD_DYLIB 0xc /* load a dynamically linked shared library */
......
#define LC_ENCRYPTION_INFO_64 0x2C /* 64-bit encrypted segment information */
#define LC_LINKER_OPTION 0x2D /* linker options in MH_OBJECT files */
#define LC_LINKER_OPTIMIZATION_HINT 0x2E /* optimization hints in MH_OBJECT files */
#ifndef __OPEN_SOURCE__
#define LC_VERSION_MIN_TVOS 0x2F /* build for AppleTV min OS version */
#endif /* __OPEN_SOURCE__ */
#define LC_VERSION_MIN_WATCHOS 0x30 /* build for Watch min OS version */</pre>
<p>所有的这些加载命令由系统内核加载器直接使用，或由动态链接器处理。其中几个常见的加载命令有LC_SEGMENT、LC_LOAD_DYLINKER、LC_LOAD_DYLIB、LC_MAIN、LC_CODE_SIGNATURE、LC_ENCRYPTION_INFO等。</p>
<p>LC_SEGMENT：表示这是一个段加载命令，需要将它加载到对应的进程空间上去。段加载命令将在下一小节进行讨论。</p>
<p>LC_LOAD_DYLIB：表示这是一个需要动态加载的链接库。它使用dylib_command结构体表示。定义如下：</p>
<pre>struct dylib_command {
 uint32_t cmd; /* LC_ID_DYLIB, LC_LOAD_{,WEAK_}DYLIB,LC_REEXPORT_DYLIB */
 uint32_t cmdsize; /* includes pathname string */
 struct dylib dylib; /* the library identification */
};</pre>
<p>当cmd类型时LC_ID_DYLIB、LC_LOAD_DYLIB、LC_LOAD_WEAK_DYLIB与LC_REEXPORT_DYLIB时，统一使用dylib_command结构体表示。</p>
<p>它使用dylib结构体来存储要加载的动态库的具体信息。如下：</p>
<pre>struct dylib {
 union lc_str name; /* library's path name */
 uint32_t timestamp; /* library's build time stamp */
 uint32_t current_version; /* library's current version number */
 uint32_t compatibility_version; /* library's compatibility vers number*/
};</pre>
<p>name字段是动态库的完整路径，动态链接器在加载动态库时，通用此路径来进行加载它。</p>
<p>timestamp字段描述了动态库构建时的时间戳。current_version与compatibility_version指明了前当版本与兼容的版本号。</p>
<p>LC_MAIN：此加载命令记录了可执行文件的主函数main()的位置。它使用entry_point_command结构体表示。定义如下：</p>
<pre>struct entry_point_command {
 uint32_t cmd; /* LC_MAIN only used in MH_EXECUTE filetypes */
 uint32_t cmdsize; /* 24 */
 uint64_t entryoff; /* file (__TEXT) offset of main() */
 uint64_t stacksize;/* if not zero, initial stack size */
};</pre>
<p>entryoff字段中就指定了main()函数的文件偏移。stacksize指定了初始的堆栈大小。</p>
<h2>0x5 LC_CODE_SIGNATURE与代码签名过程分析</h2>
<p>LC_CODE_SIGNATURE：代码签名加载命令。描述了Mach-O的代码签名信息，它属于链接信息，使用linkedit_data_command结构体表示。定义如下：</p>
<pre>struct linkedit_data_command {
 uint32_t cmd; /* LC_CODE_SIGNATURE, LC_SEGMENT_SPLIT_INFO,
 LC_FUNCTION_STARTS, LC_DATA_IN_CODE,
 LC_DYLIB_CODE_SIGN_DRS or
 LC_LINKER_OPTIMIZATION_HINT. */
 uint32_t cmdsize; /* sizeof(struct linkedit_data_command) */
 uint32_t dataoff; /* file offset of data in __LINKEDIT segment */
 uint32_t datasize; /* file size of data in __LINKEDIT segment */
};</pre>
<p>dataoff字段指明了相对于__LINKEDIT段的文件偏移位置，datasize字段指明了数据的大小。<br />
由于dataoff与datasize分别指明了代码签名的位置与大小，那么笔者在此提个问：如何删除Mach-O中包含的代码签名信息？</p>
<p>与代码签名相关的数据定义可以在xnu内核代码的“bsd/sys/codesign.h”文件中找到。整个代码签名部分的头部使用一个CS_SuperBlob结构体定义，它的原型如下：</p>
<pre>typedef struct __SC_SuperBlob {
 uint32_t magic; /* magic number */
 uint32_t length; /* total length of SuperBlob */
 uint32_t count; /* number of index entries following */
 CS_BlobIndex index[]; /* (count) entries */
 /* followed by Blobs in no particular order as indicated by offsets in index */
} CS_SuperBlob;</pre>
<p>magic字段指明了Blob的类型，可选值如下：</p>
<pre>enum {
 CSMAGIC_REQUIREMENT = 0xfade0c00, /* single Requirement blob */
 CSMAGIC_REQUIREMENTS = 0xfade0c01, /* Requirements vector (internal requirements) */
 CSMAGIC_CODEDIRECTORY = 0xfade0c02, /* CodeDirectory blob */
 CSMAGIC_EMBEDDED_SIGNATURE = 0xfade0cc0, /* embedded form of signature data */
 CSMAGIC_EMBEDDED_SIGNATURE_OLD = 0xfade0b02, /* XXX */
 CSMAGIC_EMBEDDED_ENTITLEMENTS = 0xfade7171, /* embedded entitlements */
 CSMAGIC_DETACHED_SIGNATURE = 0xfade0cc1, /* multi-arch collection of embedded signatures */
 CSMAGIC_BLOBWRAPPER = 0xfade0b01, /* CMS Signature, among other things */
}</pre>
<p>对于第一个Blob来说，它的值必定是CSMAGIC_EMBEDDED_SIGNATURE，表示代码签名采用的嵌入式的签名信息。</p>
<p>length字段指明了整个SuperBlob的大小，其中包含马上的介绍的CodeDirectory、Requirement、Entitlement的大小。</p>
<p>count字段指明了接下来会有多少个子条目。</p>
<p>从index开始，就是每一个字条目的索引了，它的结构是CS_BlobIndex，定义如下：</p>
<pre>typedef struct __BlobIndex {
 uint32_t type; /* type of entry */
 uint32_t offset; /* offset of entry */
} CS_BlobIndex;</pre>
<p>type指明了子条目的类型，可选值如下：</p>
<pre>CSSLOT_CODEDIRECTORY = 0, /* slot index for CodeDirectory */
CSSLOT_INFOSLOT = 1,
CSSLOT_REQUIREMENTS = 2,
CSSLOT_RESOURCEDIR = 3,
CSSLOT_APPLICATION = 4,
CSSLOT_ENTITLEMENTS = 5,
CSSLOT_SIGNATURESLOT = 0x10000, /* CMS Signature */</pre>
<p>offset字段指明了子条目距离代码签名数据起始的文件偏移。</p>
<p>通常，签名后的程序，签名数据的第一个子条目指向的是一个type为CSSLOT_CODEDIRECTORY的结构，它是一个CS_CodeDirectory结构体，定义如下：</p>
<pre>typedef struct __CodeDirectory {
 uint32_t magic; /* magic number (CSMAGIC_CODEDIRECTORY) */
 uint32_t length; /* total length of CodeDirectory blob */
 uint32_t version; /* compatibility version */
 uint32_t flags; /* setup and mode flags */
 uint32_t hashOffset; /* offset of hash slot element at index zero */
 uint32_t identOffset; /* offset of identifier string */
 uint32_t nSpecialSlots; /* number of special hash slots */
 uint32_t nCodeSlots; /* number of ordinary (code) hash slots */
 uint32_t codeLimit; /* limit to main image signature range */
 uint8_t hashSize; /* size of each hash in bytes */
 uint8_t hashType; /* type of hash (cdHashType* constants) */
 uint8_t platform; /* platform identifier; zero if not platform binary */
 uint8_t pageSize; /* log2(page size in bytes); 0 =&gt; infinite */
 uint32_t spare2; /* unused (must be zero) */
 /* Version 0x20100 */
 uint32_t scatterOffset; /* offset of optional scatter vector */
 /* Version 0x20200 */
 uint32_t teamOffset; /* offset of optional team identifier */
 /* followed by dynamic content as located by offset fields above */
} CS_CodeDirectory;</pre>
<p>该结构体数据字段较多，此处只关注与签名相关的字段。hashOffset指明了Hash数据的文件相对偏移，注意是相对于当前结构体CS_CodeDirectory，hashType与hashSize指明了代码签名时使用的算法与每一项签名数据的长度，目前macOS使用的签名算法是SHA-1，长度为20字节。</p>
<p>nSpecialSlots与nCodeSlots指定的代码签名数据条目的个数，前者是针对代码签名中所有的Blob，后者针对程序文件内容。codesign程序在对程序进行签名时，会对SuperBlob中每个子条目进行签名，即对Blob的内容调用SHA-1算法取Hash值，nSpecialSlots的值就是子条目Blob的个数；同时，codesign会以pageSize字段指定的页大小为单位（通常取值是0x1000），对程序数据进行签名，每一页签名后生成一条签名数据，nCodeSlots的值就是签名数据的页数，即程序数据大小除以pageSize字段后的值。</p>
<p>在CS_CodeDirectory之后，就是Requirements了，它是一个CS_SuperBlob结构体，指明了Requirement的个数与每一个的偏移。接下来就是每一个Requirement数据了，它是一个CS_GenericBlob结构体，定义如下：</p>
<pre>typedef struct __SC_GenericBlob {
 uint32_t magic; /* magic number */
 uint32_t length; /* total length of blob */
 char data[];
} CS_GenericBlob;</pre>
<p>可以看到，它的前两个字段与CS_SuperBlob是一样的，只是后面多出一个data字段，用来存放Blob的数据长度。<br />
在Requirement数据下面，就是Entitlement了，它同样是CS_GenericBlob结构。拿本机Calculator计算器程序来说，它的Entitlement的数据内容是一个xml文件，提取出来内容如下：</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
 &lt;key&gt;com.apple.security.app-sandbox&lt;/key&gt;
 &lt;true/&gt;
 &lt;key&gt;com.apple.security.files.user-selected.read-write&lt;/key&gt;
 &lt;true/&gt;
 &lt;key&gt;com.apple.security.network.client&lt;/key&gt;
 &lt;true/&gt;
 &lt;key&gt;com.apple.security.print&lt;/key&gt;
 &lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;</pre>
<p>最后一个Blob通常是签名使用的证书了，Certificates签名证书也是CS_GenericBlob结构，提取它的证书数据后保存为cer文件，使用macOS的文件预览证书内容，效果如图所示：</p>
<p><img class="alignnone size-full wp-image-95677 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-5b1d71c9ddec02bf03421dbbcb0329b7_b.png" alt="v2-5b1d71c9ddec02bf03421dbbcb0329b7_b" width="600" height="844" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-5b1d71c9ddec02bf03421dbbcb0329b7_b.png 600w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-5b1d71c9ddec02bf03421dbbcb0329b7_b-213x300.png 213w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>下面再来看看，系统是如何实施代码签名验证的！内核加载解析Mach-O加载命令的函数是parse_machfile()，位于内核代码”/bsd/kern/mach_loader.c“文件中，部分代码片断如下：</p>
<pre>static load_return_t parse_machfile(
 struct vnode *vp, 
 vm_map_t map,
 thread_t thread,
 struct mach_header *header,
 off_t file_offset,
 off_t macho_size,
 int depth,
 int64_t aslr_offset,
 int64_t dyld_aslr_offset,
 load_result_t *result
)
{
 uint32_t ncmds;
 struct load_command *lcp;
 struct dylinker_command *dlp = 0;
 integer_t dlarchbits = 0;
 void * control;
 load_return_t ret = LOAD_SUCCESS;
 caddr_t addr;
 void * kl_addr;
 vm_size_t size,kl_size;
 size_t offset;
 size_t oldoffset; /* for overflow check */
 int pass;
 proc_t p = current_proc(); /* XXXX */
 int error;
 int resid=0;
 size_t mach_header_sz = sizeof(struct mach_header);
 boolean_t abi64;
 boolean_t got_code_signatures = FALSE;
 int64_t slide = 0;

if (header-&gt;magic == MH_MAGIC_64 ||
 header-&gt;magic == MH_CIGAM_64) {
 mach_header_sz = sizeof(struct mach_header_64);
 }
 ......

case LC_CODE_SIGNATURE:
 /* CODE SIGNING */
 if (pass != 1)
 break;
 /* pager -&gt; uip -&gt;
 load signatures &amp; store in uip
 set VM object "signed_pages"
 */
 ret = load_code_signature(
 (struct linkedit_data_command *) lcp,
 vp,
 file_offset,
 macho_size,
 header-&gt;cputype,
 result);
 if (ret != LOAD_SUCCESS) {
 printf("proc %d: load code signature error %d "
 "for file \"%s\"\n",
 p-&gt;p_pid, ret, vp-&gt;v_name);
 /*
 * Allow injections to be ignored on devices w/o enforcement enabled
 */
 if (!cs_enforcement(NULL))
 ret = LOAD_SUCCESS; /* ignore error */

} else {
 got_code_signatures = TRUE;
 }

if (got_code_signatures) {
 unsigned tainted = CS_VALIDATE_TAINTED;
 boolean_t valid = FALSE;
 struct cs_blob *blobs;
 vm_size_t off = 0;

if (cs_debug &gt; 10)
 printf("validating initial pages of %s\n", vp-&gt;v_name);
 blobs = ubc_get_cs_blobs(vp);

while (off &lt; size &amp;&amp; ret == LOAD_SUCCESS) {
 tainted = CS_VALIDATE_TAINTED;

valid = cs_validate_page(blobs,
 NULL,
 file_offset + off,
 addr + off,
 &amp;tainted);
 if (!valid || (tainted &amp; CS_VALIDATE_TAINTED)) {
 if (cs_debug)
 printf("CODE SIGNING: %s[%d]: invalid initial page at offset %lld validated:%d tainted:%d csflags:0x%x\n",
 vp-&gt;v_name, p-&gt;p_pid, (long long)(file_offset + off), valid, tainted, result-&gt;csflags);
 if (cs_enforcement(NULL) ||
 (result-&gt;csflags &amp; (CS_HARD|CS_KILL|CS_ENFORCEMENT))) {
 ret = LOAD_FAILURE;
 }
 result-&gt;csflags &amp;= ~CS_VALID;
 }
 off += PAGE_SIZE;
 }
 }
 ......</pre>
<p>整个代码签名的验证过程大致分为load_code_signature()与cs_validate_page()两步，前者负责加载代码签名，后者负责验证数据页面。load_code_signature()在加载代码签名时，通过调用ubc_cs_blob_get()来获取特定CPU的cs_blob指针，ubc_cs_blob_get()第一次调用时，返回的cs_blob指针为空，会调用ubc_cs_blob_add()来加载与验证文件中的Blob信息，以后再调用ubc_cs_blob_get()，就会返回内存中的cs_blob指针，当然不是直接返回，系统会再次判断内存中的cs_blob指针是否损坏或遭到篡改，具体方法是调用ubc_cs_generation_check()做初步的检查，之后调用ubc_cs_blob_revalidate()对blob做重验证。load_code_signature()`函数代码如下：</p>
<pre>static load_return_t
load_code_signature(
 struct linkedit_data_command *lcp,
 struct vnode *vp,
 off_t macho_offset,
 off_t macho_size,
 cpu_type_t cputype,
 load_result_t *result)
{
 int ret;
 kern_return_t kr;
 vm_offset_t addr;
 int resid;
 struct cs_blob *blob;
 int error;
 vm_size_t blob_size;

addr = 0;
 blob = NULL;

if (lcp-&gt;cmdsize != sizeof (struct linkedit_data_command) ||
 lcp-&gt;dataoff + lcp-&gt;datasize &gt; macho_size) {
 ret = LOAD_BADMACHO;
 goto out;
 }

blob = ubc_cs_blob_get(vp, cputype, macho_offset);
 if (blob != NULL) {
 /* we already have a blob for this vnode and cputype */
 if (blob-&gt;csb_cpu_type == cputype &amp;&amp;
 blob-&gt;csb_base_offset == macho_offset &amp;&amp;
 blob-&gt;csb_mem_size == lcp-&gt;datasize) {
 /* it matches the blob we want here, lets verify the version */
 if(0 != ubc_cs_generation_check(vp)) {
 if (0 != ubc_cs_blob_revalidate(vp, blob, 0)) {
 ret = LOAD_FAILURE; /* set error same as from ubc_cs_blob_add */
 goto out;
 }
 }
 ret = LOAD_SUCCESS;
 } else {
 /* the blob has changed for this vnode: fail ! */
 ret = LOAD_BADMACHO;
 }
 goto out;
 }

blob_size = lcp-&gt;datasize;
 kr = ubc_cs_blob_allocate(&amp;addr, &amp;blob_size);
 if (kr != KERN_SUCCESS) {
 ret = LOAD_NOSPACE;
 goto out;
 }

resid = 0;
 error = vn_rdwr(UIO_READ,
 vp,
 (caddr_t) addr,
 lcp-&gt;datasize,
 macho_offset + lcp-&gt;dataoff,
 UIO_SYSSPACE,
 0,
 kauth_cred_get(),
 &amp;resid,
 current_proc());
 if (error || resid != 0) {
 ret = LOAD_IOERROR;
 goto out;
 }

if (ubc_cs_blob_add(vp,
 cputype,
 macho_offset,
 addr,
 lcp-&gt;datasize,
 0)) {
 ret = LOAD_FAILURE;
 goto out;
 } else {
 /* ubc_cs_blob_add() has consumed "addr" */
 addr = 0;
 }

#if CHECK_CS_VALIDATION_BITMAP
 ubc_cs_validation_bitmap_allocate( vp );
#endif

blob = ubc_cs_blob_get(vp, cputype, macho_offset);

ret = LOAD_SUCCESS;
out:
 if (ret == LOAD_SUCCESS) {
 result-&gt;csflags |= blob-&gt;csb_flags;
 result-&gt;platform_binary = blob-&gt;csb_platform_binary;
 result-&gt;cs_end_offset = blob-&gt;csb_end_offset;
 }
 if (addr != 0) {
 ubc_cs_blob_deallocate(addr, blob_size);
 addr = 0;
 }

return ret;
}</pre>
<p>注意，上面提到的cs_blob指针，其实就是代码签名数据中的CS_SuperBlob指针类型。</p>
<p>ubc_cs_blob_add()的代码比较长，它主要做了三个工作：一是调用cs_validate_csblob()验证cs_blob指针的合法性，cs_validate_csblob()会对CSMAGIC_EMBEDDED_SIGNATURE与CSMAGIC_CODEDIRECTORY做相应的验证处理，包括调用cs_validate_codedirectory()验证CS_CodeDirectory结构体的合法性，以及调用cs_validate_blob()来验证CS_SuperBlob中每一个CS_GenericBlob是否合法有效；二是调用mac_vnode_check_signature()验证Blob块的代码签名，也就是比较Blob块的SHA1哈希值是否与计算的值相同；三是加载所有的代码签名Hash信息，填充cs_blobs字段，为下一步的内存页签名验证做准备。</p>
<p>ubc_cs_blob_revalidate()做着与ubc_cs_blob_add()几乎相同的验证检查，但前者因为已经有了一些缓存信息，因此检查时会快一些。</p>
<p>load_code_signature()完事以后，会调用ubc_get_cs_blobs()获取cs_blobs指针，最后调用cs_validate_page()以逐页的形式验证文件中每一页的数据的签名。</p>
<p>以上检查做完后，LC_CODE_SIGNATURE就处理完了，没有错误发生就表示代码签名验证通过了。</p>
<p>讲完了代码签名，再讲讲代码加密。Mach-O程序如果使用了代码加密技术，在加载命令列表中会有一个LC_ENCRYPTION_INFO加载命令。它存储了Mach-O的加密信息。关于此加载命令，对于搞过iOS程序逆向的读者应该不会感到陌生。iOS系统由于安全机制的原因，会对App Store中上架的应用默认开启数据加密。</p>
<p>被加密过的App文件，部分段的数据内容是经过加密的，而记录加密数据的关键就是LC_ENCRYPTION_INFO加载命令。分析人员要想对加密过的App进行逆向分析，必须先经过一次解密（俗称“砸壳”）操作。</p>
<p>LC_ENCRYPTION_INFO使用encryption_info_command结构体表示。定义如下（LC_ENCRYPTION_INFO_64使用encryption_info_command_64表示）：</p>
<pre>struct encryption_info_command {
 uint32_t cmd; /* LC_ENCRYPTION_INFO */
 uint32_t cmdsize; /* sizeof(struct encryption_info_command) */
 uint32_t cryptoff; /* file offset of encrypted range */
 uint32_t cryptsize; /* file size of encrypted range */
 uint32_t cryptid; /* which enryption system, 0 means not-encrypted yet */
};</pre>
<p>cryptoff与cryptsize字段分别指明了加密数据的文件偏移与大小。cryptid指定了使用的加密系统。</p>
<p>聪明的安全研究人员，根据Mach-O在内存中被加载完后即解密完成的特点，开发了针对iOS平台App的代码解密工具dumpdecrypted，</p>
<p>下载地址是：stefanesser/dumpdecrypted 。通过将内存中解密后的数据写回原位置，并将cryptid置0来达到解密App的目的。</p>
<p>再来看看系统是如何处理LC_ENCRYPTION_INFO的，它的解析函数也是parse_machfile()，代码片断如下：</p>
<pre>static load_return_t parse_machfile(
 struct vnode *vp, 
 vm_map_t map,
 thread_t thread,
 struct mach_header *header,
 off_t file_offset,
 off_t macho_size,
 int depth,
 int64_t aslr_offset,
 int64_t dyld_aslr_offset,
 load_result_t *result
)
{
 ......

#if CONFIG_CODE_DECRYPTION
 case LC_ENCRYPTION_INFO:
 case LC_ENCRYPTION_INFO_64:
 if (pass != 3)
 break;
 ret = set_code_unprotect(
 (struct encryption_info_command *) lcp,
 addr, map, slide, vp,
 header-&gt;cputype, header-&gt;cpusubtype);
 if (ret != LOAD_SUCCESS) {
 printf("proc %d: set_code_unprotect() error %d "
 "for file \"%s\"\n",
 p-&gt;p_pid, ret, vp-&gt;v_name);
 /*
 * Don't let the app run if it's
 * encrypted but we failed to set up the
 * decrypter. If the keys are missing it will
 * return LOAD_DECRYPTFAIL.
 */
 if (ret == LOAD_DECRYPTFAIL) {
 /* failed to load due to missing FP keys */
 proc_lock(p);
 p-&gt;p_lflag |= P_LTERM_DECRYPTFAIL;
 proc_unlock(p);
 }
 psignal(p, SIGKILL);
 }
 break;
#endif
 default:
 /* Other commands are ignored by the kernel */
 ret = LOAD_SUCCESS;
 break;

......</pre>
<p>当系统内核被配置为启用代码解密，即定义了CONFIG_CODE_DECRYPTION之后，parse_machfile()函数会解析LC_ENCRYPTION_INFO与LC_ENCRYPTION_INFO_64加载命令。</p>
<p>最终是调用了set_code_unprotect()函数来对代码进行解密。该函数通过encryption_info_command中的cryptid来确定使用的加密系统，然后对代码进行内存解密。它的代码片断如下：</p>
<pre>#if CONFIG_CODE_DECRYPTION

static load_return_t
set_code_unprotect(
 struct encryption_info_command *eip,
 caddr_t addr, 
 vm_map_t map,
 int64_t slide,
 struct vnode *vp,
 cpu_type_t cputype,
 cpu_subtype_t cpusubtype)
{
 ......
 if (eip-&gt;cmdsize &lt; sizeof(*eip)) return LOAD_BADMACHO;

switch(eip-&gt;cryptid) {
 case 0:
 /* not encrypted, just an empty load command */
 return LOAD_SUCCESS;
 case 1:
 cryptname="com.apple.unfree";
 break;
 case 0x10:
 /* some random cryptid that you could manually put into
 * your binary if you want NULL */
 cryptname="com.apple.null";
 break;
 default:
 return LOAD_BADMACHO;
 }

if (map == VM_MAP_NULL) return (LOAD_SUCCESS);
 if (NULL == text_crypter_create) return LOAD_FAILURE;

......

/* set up decrypter first */
 crypt_file_data_t crypt_data = {
 .filename = vpath,
 .cputype = cputype,
 .cpusubtype = cpusubtype};
 kr=text_crypter_create(&amp;crypt_info, cryptname, (void*)&amp;crypt_data);
 FREE_ZONE(vpath, MAXPATHLEN, M_NAMEI);

......

offset = mach_header_sz;
 uint32_t ncmds = header-&gt;ncmds;
 while (ncmds--) {
 /*
 * Get a pointer to the command.
 */
 struct load_command *lcp = (struct load_command *)(addr + offset);
 offset += lcp-&gt;cmdsize;

switch(lcp-&gt;cmd) {
 case LC_SEGMENT_64:
 seg64 = (struct segment_command_64 *)lcp;
 if ((seg64-&gt;fileoff &lt;= eip-&gt;cryptoff) &amp;&amp;
 (seg64-&gt;fileoff+seg64-&gt;filesize &gt;=
 eip-&gt;cryptoff+eip-&gt;cryptsize)) {
 map_offset = seg64-&gt;vmaddr + eip-&gt;cryptoff - seg64-&gt;fileoff + slide;
 map_size = eip-&gt;cryptsize;
 goto remap_now;
 }
 case LC_SEGMENT:
 seg32 = (struct segment_command *)lcp;
 if ((seg32-&gt;fileoff &lt;= eip-&gt;cryptoff) &amp;&amp;
 (seg32-&gt;fileoff+seg32-&gt;filesize &gt;=
 eip-&gt;cryptoff+eip-&gt;cryptsize)) {
 map_offset = seg32-&gt;vmaddr + eip-&gt;cryptoff - seg32-&gt;fileoff + slide;
 map_size = eip-&gt;cryptsize;
 goto remap_now;
 }
 }
 }

/* if we get here, did not find anything */
 return LOAD_BADMACHO;

remap_now:
 /* now remap using the decrypter */
 kr = vm_map_apple_protected(map, map_offset, map_offset+map_size, &amp;crypt_info);
 if(kr) {
 printf("set_code_unprotect(): mapping failed with %x\n", kr);
 crypt_info.crypt_end(crypt_info.crypt_ops);
 return LOAD_PROTECT;
 }

return LOAD_SUCCESS;
}

#endif</pre>
<p>text_crypter_create()是一个全局的text_crypter_create_hook_t类型的指针，在内核代码“osfmk/kern/page_decrypt.c”文件中通过text_crypter_create_hook_set()进行设置。</p>
<p>text_crypter_create()在填充完解密所需的信息crypt_info后，会再次计算需要重新解密映射到内存的地址与大小，调用vm_map_apple_protected()进行解密操作。</p>
<p>由于内核的代码可以直接审阅，数据加密在macOS系统上显得意义不大，在目前最新的macOS 10.12系统上，苹果没有启用代码解密功能，LC_ENCRYPTION_INFO与LC_ENCRYPTION_INFO_64加载命令也就没那么常见了。</p>
<p>最后，可以使用otool命令行工具来查看Mach-O文件的加载命令信息：</p>
<pre>otool -l /usr/bin/python
/usr/bin/python:
Load command 0
 cmd LC_SEGMENT_64
 cmdsize 72
 segname __PAGEZERO
 vmaddr 0x0000000000000000
 vmsize 0x0000000100000000
 fileoff 0
 filesize 0
 maxprot 0x00000000
 initprot 0x00000000
 nsects 0
 flags 0x0
Load command 1
 cmd LC_SEGMENT_64
 ......
Load command 15
 cmd LC_DATA_IN_CODE
 cmdsize 16
 dataoff 17776
 datasize 0
Load command 16
 cmd LC_CODE_SIGNATURE
 cmdsize 16
 dataoff 20528
 datasize 9344</pre>
<p>也可以使用MachOView查看，效果如图所示：</p>
<p><img class="alignnone size-full wp-image-95678 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-e34102eb91dd801500f7a68b31044b5f_r.png" alt="v2-e34102eb91dd801500f7a68b31044b5f_r" width="1800" height="880" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-e34102eb91dd801500f7a68b31044b5f_r.png 1800w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-e34102eb91dd801500f7a68b31044b5f_r-300x147.png 300w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-e34102eb91dd801500f7a68b31044b5f_r-768x375.png 768w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-e34102eb91dd801500f7a68b31044b5f_r-1024x501.png 1024w" sizes="(max-width: 1800px) 100vw, 1800px" /></p>
<h2>0x6 LC_SEGMENT</h2>
<p>段加载命令LC_SEGMENT，描述了32位Mach-O文件的段的信息，使用segment_command结构体来表示，它的定义如下：</p>
<pre>struct segment_command { /* for 32-bit architectures */
 uint32_t cmd; /* LC_SEGMENT */
 uint32_t cmdsize; /* includes sizeof section structs */
 char segname[16]; /* segment name */
 uint32_t vmaddr; /* memory address of this segment */
 uint32_t vmsize; /* memory size of this segment */
 uint32_t fileoff; /* file offset of this segment */
 uint32_t filesize; /* amount to map from the file */
 vm_prot_t maxprot; /* maximum VM protection */
 vm_prot_t initprot; /* initial VM protection */
 uint32_t nsects; /* number of sections in segment */
 uint32_t flags; /* flags */
};</pre>
<ul>
<li>segname字段是一个16字节大小的空间，用来存储段的名称。</li>
<li>vmaddr字段指明了段要加载的虚拟内存地址。</li>
<li>vmsize字段指明了段所占的虚拟内存的大小。</li>
<li>fileoff字段指明了段数据所在文件中偏移地址。</li>
<li>filesize字段指明了段数据实际的大小。</li>
<li>maxprot字段指明了页面所需要的最高内存保护。</li>
<li>initprot字段指明了页面初始的内存保护。</li>
<li>nsects字段指明了段所包含的节区（section）。</li>
<li>flags字段指明了段的标志信息。</li>
</ul>
<p>与LC_SEGMENT对应的是LC_SEGMENT_64，它使用segment_command_64结构体表示，描述了64位Mach-O文件的段的基本信息，定义如下：</p>
<pre>struct segment_command_64 { /* for 64-bit architectures */
 uint32_t cmd; /* LC_SEGMENT_64 */
 uint32_t cmdsize; /* includes sizeof section_64 structs */
 char segname[16]; /* segment name */
 uint64_t vmaddr; /* memory address of this segment */
 uint64_t vmsize; /* memory size of this segment */
 uint64_t fileoff; /* file offset of this segment */
 uint64_t filesize; /* amount to map from the file */
 vm_prot_t maxprot; /* maximum VM protection */
 vm_prot_t initprot; /* initial VM protection */
 uint32_t nsects; /* number of sections in segment */
 uint32_t flags; /* flags */
};</pre>
<p>所有的字段含义与32位基本一致。主要讨论一下它最后4个字段。</p>
<p>一个编译后可能执行的程序分成了多个段，不同的类型的数据放入了不同的段中。如程序的代码被称作代码段，<br />
放入一个名为__TEXT的段中，代码段的maxprot字段在编译时被设置成VM_PROT_READ（可读）、VM_PROT_WRITE（可写）、VM_PROT_EXECUTE（可执行），initprot字段被设置成VM_PROT_READ（可读）与VM_PROT_EXECUTE（可执行），这样做是合理的，一个普通的应用程序，它的代码段部分通常是不可写的，特殊需求的程序，如果要求代码段可写，必须在编译时设置它的initprot字段为VM_PROT_WRITE（可写）。</p>
<p>nsects字段指定了段加载命令包含几个节区（section），一个段可以包含0个或多个节区。如__PAGEZERO段就不包含任何节区，该段被称为空指针陷阱段，映射到虚拟内存空间的第一页，用于捕捉对NULL指针的引用。</p>
<p>当一个段包含多个节区时，节区信息会以数组形式紧随着存储在段加载命令后面。节区使用结构体section表示（64位使用section_64表示），定义如下：</p>
<pre>struct section { /* for 32-bit architectures */
 char sectname[16]; /* name of this section */
 char segname[16]; /* segment this section goes in */
 uint32_t addr; /* memory address of this section */
 uint32_t size; /* size in bytes of this section */
 uint32_t offset; /* file offset of this section */
 uint32_t align; /* section alignment (power of 2) */
 uint32_t reloff; /* file offset of relocation entries */
 uint32_t nreloc; /* number of relocation entries */
 uint32_t flags; /* flags (section type and attributes)*/
 uint32_t reserved1; /* reserved (for offset or index) */
 uint32_t reserved2; /* reserved (for count or sizeof) */
};</pre>
<p>sectname字段表示节区的名称，segname字段表示节区所在的段名，addr与size指明了节区所在的内存地址与大小，offset指明了区取所在的文件偏移，align表示节区的内存对齐边界，reloff指明了重定位信息的文件偏移，nreloc表示重定位条目的数目，flags则是节区的一些标志属性。</p>
<p>段加载命令的最后一个字段flags存储了段的一些标志属性，它的取值有如下：</p>
<pre>#define SG_HIGHVM 0x1
#define SG_FVMLIB 0x2
#define SG_NORELOC 0x4
#define SG_PROTECTED_VERSION_1 0x8</pre>
<p>值得关注的是SG_PROTECTED_VERSION_1，当段被设置了该标志位，表示段是经过加密的！在macOS版本10.6以前，系统使用AES算法进行段的加密与解密，10.6的时候，则使用的Blowfish加密算法，著名的iOS逆向工具class-dump（地址：nygard/class-dump） 提供了一个静态数据段解密工具deprotect，有兴趣的读者可以参看它的代码来了解段解密的部分。</p>
<p>最后，使用MachOView工具查看系统python程序的__TEXT段的信息如图所示：</p>
<p><img class="alignnone size-full wp-image-95679 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/01/v2-6c684f20d0c9b9bc02d482a42045e2b5_r.png" alt="v2-6c684f20d0c9b9bc02d482a42045e2b5_r" width="1800" height="1170" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/01/v2-6c684f20d0c9b9bc02d482a42045e2b5_r.png 1800w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6c684f20d0c9b9bc02d482a42045e2b5_r-300x195.png 300w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6c684f20d0c9b9bc02d482a42045e2b5_r-768x499.png 768w, http://www.mottoin.com/wp-content/uploads/2017/01/v2-6c684f20d0c9b9bc02d482a42045e2b5_r-1024x666.png 1024w" sizes="(max-width: 1800px) 100vw, 1800px" /></p>
<p>&nbsp;</p>
<p style="text-align: center;"><span style="color: #ff0000;"><strong>*作者：<a style="color: #ff0000;" href="https://zhuanlan.zhihu.com/p/24858664">非虫</a>，MottoIN授权发布。转载请注明来自MottoIN</strong></span></p>
<p>&nbsp;</p>
                                                        <div class="entry-copyright"><p>原创文章，作者：非虫，如若转载，请注明出处：http://www.mottoin.com/95673.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/macos" rel="tag">macOS</a><a href="http://www.mottoin.com/tag/macos%e8%bd%af%e4%bb%b6" rel="tag">macOS软件</a><a href="http://www.mottoin.com/tag/macos%e8%bd%af%e4%bb%b6%e5%ae%89%e5%85%a8%ef%bc%8c%e8%bd%af%e4%bb%b6%e5%86%85%e5%b9%95%ef%bc%8cmach-o%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f" rel="tag">macOS软件安全，软件内幕，Mach-O文件格式</a><a href="http://www.mottoin.com/tag/%e8%bd%af%e4%bb%b6%e5%ae%89%e5%85%a8" rel="tag">软件安全</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="95673"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="370" target="_blank" href="http://www.mottoin.com/user/nonworm/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="非虫" />                                                非虫                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="95673"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/95673.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F95673.html&title=macOS%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97-%E8%BD%AF%E4%BB%B6%E5%86%85%E5%B9%95%E7%AF%87%EF%BC%9AMach-O%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F95673.html&title=macOS%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97-%E8%BD%AF%E4%BB%B6%E5%86%85%E5%B9%95%E7%AF%87%EF%BC%9AMach-O%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/97460.html" title="小白客带你走进黑客世界2之漏洞的形成">小白客带你走进黑客世界2之漏洞的形成</a></li><li><a href="http://www.mottoin.com/84794.html" title="Redis Getshell自动化实践之SSH key">Redis Getshell自动化实践之SSH key</a></li><li><a href="http://www.mottoin.com/101911.html" title="小白客带你走进黑客世界16之小心公共wifi（kali linux下的无线攻击技术）">小白客带你走进黑客世界16之小心公共wifi（kali linux下的无线攻击技术）</a></li><li><a href="http://www.mottoin.com/100719.html" title="小白客带你走进黑客世界15kali linux下的信息收集技术">小白客带你走进黑客世界15kali linux下的信息收集技术</a></li><li><a href="http://www.mottoin.com/95560.html" title="从隐匿的地下中文网络社区来看互联网安全">从隐匿的地下中文网络社区来看互联网安全</a></li><li><a href="http://www.mottoin.com/94468.html" title="使用docker搭建开发环境">使用docker搭建开发环境</a></li><li><a href="http://www.mottoin.com/87685.html" title="隐写技巧——利用PNG文件格式隐藏Payload(一)">隐写技巧——利用PNG文件格式隐藏Payload(一)</a></li><li><a href="http://www.mottoin.com/92259.html" title="BurpSuite实战指南（七）">BurpSuite实战指南（七）</a></li><li><a href="http://www.mottoin.com/87826.html" title="隐写技巧——利用PNG文件格式隐藏Payload(三)">隐写技巧——利用PNG文件格式隐藏Payload(三)</a></li><li><a href="http://www.mottoin.com/95510.html" title="大数据应用安全检测与防御（二）">大数据应用安全检测与防御（二）</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/95673.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/nonworm/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="非虫" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">非虫</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/95967.html" title="Android免Root环境下Hook框架Legend原理分析">Android免Root环境下Hook框架Legend原理分析</a></li>
                                    <li><a href="http://www.mottoin.com/95673.html" title="macOS软件安全系列-软件内幕篇：Mach-O文件格式">macOS软件安全系列-软件内幕篇：Mach-O文件格式</a></li>
                                    <li><a href="http://www.mottoin.com/95667.html" title="macOS软件安全系列-软件内幕篇：macOS平台软件的下载与安装">macOS软件安全系列-软件内幕篇：macOS平台软件的下载与安装</a></li>
                                    <li><a href="http://www.mottoin.com/89035.html" title="常见app加固厂商脱壳方法研究">常见app加固厂商脱壳方法研究</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>