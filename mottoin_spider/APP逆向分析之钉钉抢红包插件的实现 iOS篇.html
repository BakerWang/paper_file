<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>APP逆向分析之钉钉抢红包插件的实现-iOS篇 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; APP逆向分析之钉钉抢红包插件的实现-iOS篇评论Feed" href="http://www.mottoin.com/93727.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Dedsploit：网络协议分析框架' href='http://www.mottoin.com/93677.html' />
<link rel='next' title='MS16-063补丁分析（JSCRIPT9.DLL）' href='http://www.mottoin.com/93762.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=93727' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="APP逆向,iOS,钉钉抢红包插件">
<meta name="description" content="网络上关于微信红包的分析文章已经非常多了,基本上照着做就可以弄个微信抢红包插件出来,不过,随着阿里巴巴的钉钉在企业中的流行,很多企业现在都采用钉钉来办公了,顺带着,也就使用钉钉来发红包了,学习了那么多逆向的理论后,需要拿一个东西来练练手,刚好,钉钉就符合这个要求,于是,便有了下面的这篇文章.套用腾讯的何兆林在文章移动App入侵与逆向破解技术－iOS篇说的一段话&quot;破解有时候很耗时，和程序开发正好相反">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-93727 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item current-post-ancestor current-menu-parent current-post-parent"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-93727" class="post-93727 post type-post status-publish format-standard has-post-thumbnail hentry category-terminal tag-app tag-ios tag-2206">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">APP逆向分析之钉钉抢红包插件的实现-iOS篇</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/msbuild/">Exp1oi7ss</a>
                                <span class="dot">•</span>
                                <span>2016年12月13日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/article/terminal" rel="category tag">终端安全</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 1254</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <blockquote><p>网络上关于微信红包的分析文章已经非常多了,基本上照着做就可以弄个微信抢红包插件出来,不过,随着阿里巴巴的钉钉在企业中的流行,很多企业现在都采用钉钉来办公了,顺带着,也就使用钉钉来发红包了,学习了那么多逆向的理论后,需要拿一个东西来练练手,刚好,钉钉就符合这个要求,于是,便有了下面的这篇文章.套用腾讯的何兆林在文章 <a href="http://mp.weixin.qq.com/s?__biz=MzA3NTYzODYzMg%3Cmark%3E&amp;mid=2653577384&amp;idx=1&amp;sn=b44a9c9651bf09c5bea7e0337031c53c&amp;scene=0#wechat_redirect">移动App入侵与逆向破解技术－iOS篇</a>说的一段话</p>
<p>&#8220;破解有时候很耗时，和程序开发正好相反，它耗时不是耗在写代码上，而是耗在寻找注入点和逆向工程上，有可能你花了3天时间去找程序的破绽，但是最终的破解代码可能就2行，不到一分钟就搞定了；但是你也需要做好面对失败的准备，如果路选错了，有可能你这3天完全是在浪费脑细胞&#8221;</p></blockquote>
<p>本文的源码放在我的gitHub上 <a href="https://github.com/yohunl/DingTalkNoJailTweak">DingTalkNoJailTweak</a> ,,其ReadMe文件说明了其中相关的代码是起什么作用的.</p>
<p>当然了,这篇文件会涉及比较多的逆向的东西,这些理论等前序知识,可以参考网上的,网上的资料比较多了,比如TheOS的开发环境的搭建,Hopper逆向分析软件的使用,ida Pro等,<a href="http://mp.weixin.qq.com/s?__biz=MzA3NTYzODYzMg%3C/mark%3E&amp;mid=2653577384&amp;idx=1&amp;sn=b44a9c9651bf09c5bea7e0337031c53c&amp;scene=0#wechat_redirect">移动App入侵与逆向破解技术－iOS篇</a>上就有很不错的前序理论知识的介绍.</p>
<p>好了,闲话不多说,直接进入正题.</p>
<h2>相关工具和环境</h2>
<p>一台越狱的手机,虽然不越狱的手机也可以用来分析,但是,那样将会大大的减慢整个分析过程,因为非越狱的只能通过注入后打log日志来分析,耗时耗力,所以,越狱手机是必备</p>
<h3>越狱的手机上安装了</h3>
<p><strong>cycript</strong></p>
<p>从cydia中安装</p>
<p><strong>FlexInjected</strong></p>
<p>从cydia中安装,在cydia中搜索Flipboard FLEX loader</p>
<p><strong>clutch</strong></p>
<p><a href="https://github.com/KJCracks/Clutch">https://github.com/KJCracks/Clutch</a> clutch下载</p>
<p>下载后,按照上面的指示, Clone the repo</p>
<p><img class="alignnone size-full wp-image-93730 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/20161213092659.png" alt="20161213092659" width="1038" height="211" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/20161213092659.png 1038w, http://www.mottoin.com/wp-content/uploads/2016/12/20161213092659-300x61.png 300w, http://www.mottoin.com/wp-content/uploads/2016/12/20161213092659-768x156.png 768w, http://www.mottoin.com/wp-content/uploads/2016/12/20161213092659-1024x208.png 1024w" sizes="(max-width: 1038px) 100vw, 1038px" /></p>
<p>当然你可以使用同步助手,PP助手,iFunBox,iTools Pro来安装到手机的/usr/bin下 如果不是用SSH从电脑上登陆手机的命令行的话,你可以cydia下载MTerminal,然后使用su切换用户到root,再使用命令 chmod +x clutch来提升权限</p>
<p><strong>MTerminal</strong></p>
<p>cydia中下载,可以方便的在你的手机上使用终端命令行.</p>
<h3>一台MAC电脑安装了</h3>
<p><strong>class-dump</strong></p>
<p><a href="https://github.com/nygard/class-dump">class-dump</a>,用来dump出二进制的头文件.</p>
<p><a href="https://github.com/theos/theos"><strong>Theos</strong></a></p>
<p>可以参考我的另外一篇文章来安装 <a href="https://yohunl.com/ios-yue-yu-de-tweakkai-fa/">iOS 越狱的Tweak开发</a></p>
<p><strong>Hopper Disassembler v3 或者ida Pro</strong></p>
<p>用来进行汇编分析的</p>
<p><strong>xcode</strong></p>
<p><strong>insert_dylib</strong></p>
<p><strong>iTools Pro</strong></p>
<p><a href="http://pro.itools.cn/pro_mac/">iTools</a> 方便的用来拷贝.浏览手机上的所有文件</p>
<h2>砸壳</h2>
<p>砸壳,是为了能够使用class-dump来导出所有的头文件,有了头文件,我们分析起来才是有可能的. ssh连上你的越狱手机/或者像我一样直接在手机上的Terminal中操作,调用clutch来进行砸壳</p>
<pre>YohunlIp6:~ root# clutch 
Usage: clutch [OPTIONS] 
-b --binary-dump &lt;value&gt; Only dump binary files from specified bundleID 
-d --dump &lt;value&gt; Dump specified bundleID into .ipa file 
-i --print-installed Print installed applications 
 --clean Clean /var/tmp/clutch directory 
 --version Display version and exit 
-? --help Display this help and exit 
-n --no-color Print with colors disabled 
-v --verbose Print verbose messages</pre>
<p>以上是clutch支持的命令 其中的 -b就是 用来砸壳的,需要一个参数是要被砸壳的应用的bundleid,获取钉钉的bundleid有很多方法,你可以直接使用 clutch -i 输出手机上所有已经安装的应用,找到bundleid.钉钉的bundleid是com.laiwang.DingTalk 开始砸壳</p>
<p><img class="alignnone size-full wp-image-93732 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/46128c4ae48259cab12a3cc4f7151.png" alt="46128c4ae48259cab12a3cc4f7151" width="752" height="270" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/46128c4ae48259cab12a3cc4f7151.png 752w, http://www.mottoin.com/wp-content/uploads/2016/12/46128c4ae48259cab12a3cc4f7151-300x108.png 300w" sizes="(max-width: 752px) 100vw, 752px" /></p>
<p>稍等一会,砸壳完毕,会输出砸完壳后的存放路径</p>
<p>使用iTool Pro/PP助手等工具,将砸完壳的钉钉拷贝到电脑上</p>
<h2>导出头文件</h2>
<p>在电脑上,将砸壳后的文件中读取出头文件, DingTalk是从砸壳后的ipa包中提取出来的钉钉的可执行文件,这个文件比较好找,一般都是没有后缀的,大小最大的那个.</p>
<pre>class-dump -H DingTalk -o DingTalkHeaders</pre>
<blockquote><p>class-dump的简单使用方式 最简单的使用方式 class-dump -H DDMMerchant -o yicommonHeaders</p>
<p>class-dump -H Payload/WeChat.app/WeChat -o wechatHeaders</p>
<p>还可以加上 -S -s来对生成的方法,类都进行排序 class-dump -S -s -H Payload/WeChat.app/WeChat -o wechatHeaders</p>
<p>一定要写 -H,不然,都是在命令行输出的,不会将内容输入到文件夹下!!</p></blockquote>
<p>导出头文件后,新建一个xcode工程,将所有的头文件都导出到工程中,为什么做这一步呢,因为,Xcode的搜索能力还是不错的,方便我们去查看这些头文件.当然,由于一次性导入xcode工程的文件量比较大,在导入的过程中,xcode可能会假死,稍微耐心一点.</p>
<h2>开始分析</h2>
<p>在这里,强烈的推荐<a href="https://github.com/Flipboard/FLEX">Flipboard的FLEX</a>,这个简直就是iOS分析界的神器啊.以前还要用命令才能一步步的将界面所对应的视图,以及相应的ViewController分析出来,现在有了它,这个过程可以大大加速了.</p>
<p>如果你安装了FlexInjected,打开设置那里FlexInjected中钉钉的开关,这样,当钉钉启动的时候,就加载了Flex了,加载了Flex后,会在钉钉中出现Flex的界面,点击界面可以进行相应的操作. 首先,第一步,我们先要找到抢红包的视图所对应的对象以及相应的VC,这个事情利用Flex还是很简单的.</p>
<p><img class="alignnone size-full wp-image-93735 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/60f2d267b71fcafaae2df79b94113.jpg" alt="60f2d267b71fcafaae2df79b94113" width="502" height="711" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/60f2d267b71fcafaae2df79b94113.jpg 502w, http://www.mottoin.com/wp-content/uploads/2016/12/60f2d267b71fcafaae2df79b94113-212x300.jpg 212w" sizes="(max-width: 502px) 100vw, 502px" /></p>
<p><img class="alignnone size-full wp-image-93737 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/987991fe3564a24ac1b0632e66919.jpg" alt="987991fe3564a24ac1b0632e66919" width="503" height="851" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/987991fe3564a24ac1b0632e66919.jpg 503w, http://www.mottoin.com/wp-content/uploads/2016/12/987991fe3564a24ac1b0632e66919-177x300.jpg 177w" sizes="(max-width: 503px) 100vw, 503px" /></p>
<p>打开钉钉,就会出现Flex的菜单了,Flex的基本操作,可以参考FLex官网的.</p>
<p><img class="alignnone size-full wp-image-93740 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/9fc4a741496216378b3bc7336d553.jpg" alt="9fc4a741496216378b3bc7336d553" width="500" height="868" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/9fc4a741496216378b3bc7336d553.jpg 500w, http://www.mottoin.com/wp-content/uploads/2016/12/9fc4a741496216378b3bc7336d553-173x300.jpg 173w" sizes="(max-width: 500px) 100vw, 500px" /></p>
<p>通过Flex,我们很容易的得到下面的结果 1 聊天页面的红包视图的View是DTMessageBubbleRedEnvelopView</p>
<p><img class="alignnone size-full wp-image-93741 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/c668e27c3c46f564505ecd7ea23bd.jpg" alt="c668e27c3c46f564505ecd7ea23bd" width="500" height="868" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/c668e27c3c46f564505ecd7ea23bd.jpg 500w, http://www.mottoin.com/wp-content/uploads/2016/12/c668e27c3c46f564505ecd7ea23bd-173x300.jpg 173w" sizes="(max-width: 500px) 100vw, 500px" /></p>
<p>2 点击后,抢红包的页面的视图是</p>
<p>DTOpenLuckyMoneyView<br />
&#8212;-DTOpenLuckyMoneyEntityView</p>
<p><img class="alignnone size-full wp-image-93742 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/a98c2f2bb3cdb69cf8ac9292c4f3e.png" alt="a98c2f2bb3cdb69cf8ac9292c4f3e" width="1158" height="1335" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/a98c2f2bb3cdb69cf8ac9292c4f3e.png 1158w, http://www.mottoin.com/wp-content/uploads/2016/12/a98c2f2bb3cdb69cf8ac9292c4f3e-260x300.png 260w, http://www.mottoin.com/wp-content/uploads/2016/12/a98c2f2bb3cdb69cf8ac9292c4f3e-768x885.png 768w, http://www.mottoin.com/wp-content/uploads/2016/12/a98c2f2bb3cdb69cf8ac9292c4f3e-888x1024.png 888w" sizes="(max-width: 1158px) 100vw, 1158px" /></p>
<p>3 所有的聊天的会话的控制器是DTConversationListViewController.</p>
<p>我们已经知道了抢红包的关键视图是DTOpenLuckyMoneyEntityView 和DTOpenLuckyMoneyView.打开我们dump出来的所有的头文件,查看DTOpenLuckyMoneyEntityView头文件定义<br />
DTOpenLuckyMoneyEntityView的定义(截取我们需要的关键部分)</p>
<pre>@interface DTOpenLuckyMoneyEntityView : UIView &lt;DTUserNameLabelDelegate&gt;{
 id &lt;DTOpenLuckyMoneyEntityViewDelegate&gt; _delegate;
 ....
}
@property(nonatomic) __weak id &lt;DTOpenLuckyMoneyEntityViewDelegate&gt; delegate;
- (void)didClickOpenLuckyMoneyBtn:(UIButton *)arg1;
......
@end</pre>
<p>DTOpenLuckyMoneyEntityViewDelegate</p>
<pre>@protocol DTOpenLuckyMoneyEntityViewDelegate &lt;NSObject&gt;
- (void)didClickViewMore:(DTOpenLuckyMoneyEntityView *)arg1;
- (void)didClickOpenLuckyMoney:(DTOpenLuckyMoneyEntityView *)arg1;
@end</pre>
<p>DTOpenLuckyMoneyView的定义(截取我们需要的关键部分)</p>
<pre>@interface DTOpenLuckyMoneyView : UIView &lt;DTOpenLuckyMoneyEntityViewDelegate&gt;
//通过此方法,构造出来视图
+ (void)showLuckyMoneyWithPickingStatus:(DTBizRedEnvelopClusterPickingStatus *)arg1 withController:
(DTMessageOTOViewController *)arg2 delegate:(id &lt;DTOpenLuckyMoneyViewDelegate&gt;)arg3;
- (void)didClickOpenLuckyMoney:(DTOpenLuckyMoneyEntityView *)arg1;
@end</pre>
<p>通过上面的两个类和一个协议的方法定义,我们很容易的就可以得出它们之间的关系大概是如下这样的</p>
<p>当用户点击了拆红包按钮时</p>
<pre>DTOpenLuckyMoneyEntityView中的button的响应事件 
- (void)didClickOpenLuckyMoneyBtn:(id)arg1;
 其中 先获取id &lt;DTOpenLuckyMoneyEntityViewDelegate&gt; _delegate; (取值是 DTOpenLuckyMoneyView 
(@interface DTOpenLuckyMoneyView : UIView &lt;DTOpenLuckyMoneyEntityViewDelegate&gt;))
 
转给其方法 - (void)didClickViewMore:(DTOpenLuckyMoneyEntityView *)arg1;
也就是 
DTOpenLuckyMoneyEntityView 
- (void)didClickOpenLuckyMoneyBtn:(id)sender {
 [self.delegate didClickOpenLuckyMoney:self];//_delegate; (取值是 DTOpenLuckyMoneyView
}</pre>
<p>这只是大概的流程,我们可以进一步细化这个流程,这个时候就要用到Hopper Disassembler或者iDA Pro了,用Hopper打开钉钉的可执行文件,等待分析完毕,打开DTOpenLuckyMoneyView的didClickViewMore实现,(这里我只截取了部分)</p>
<p><img class="alignnone size-full wp-image-93744 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/c13d5a8c70447646f96029725e3d5.jpg" alt="c13d5a8c70447646f96029725e3d5" width="1253" height="724" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/c13d5a8c70447646f96029725e3d5.jpg 1253w, http://www.mottoin.com/wp-content/uploads/2016/12/c13d5a8c70447646f96029725e3d5-300x173.jpg 300w, http://www.mottoin.com/wp-content/uploads/2016/12/c13d5a8c70447646f96029725e3d5-768x444.jpg 768w, http://www.mottoin.com/wp-content/uploads/2016/12/c13d5a8c70447646f96029725e3d5-1024x592.jpg 1024w" sizes="(max-width: 1253px) 100vw, 1253px" /></p>
<p>从这个方法的汇编代码中,我们大体上可以得到如下的信息:</p>
<pre>DTOpenLuckyMoneyView didClickOpenLuckyMoney:(DTOpenLuckyMoneyEntityView *)arg1; 
 [self statusModel]; //DTBizRedEnvelopClusterPickingStatus *statusModel,其中有一个属性是
 DTBizRedEnvelopCluster,包含了红红包的相关信息,看上面的截图
 [self utOpenRedEnvelop:statusModel]
 [self beginLoading]//其中会调用DTOpenLuckyMoneyEntityView的loading方法等
 [DTRedEnvelopServiceFactory defaultServiceIMP]获取一个 DTRedEnvelopServiceIMP
 self redEnvelopCluster
 serverFormatWithCountryCode:number:
 clusterId
 luckyMoneyEntityView
 //DTRedEnvelopServiceIMP - (void)pickRedEnvelopCluster:(long long)arg1 clusterId:(id)arg2 successBlock:
 (CDUnknownBlockType)arg3 failureBlock:(CDUnknownBlockType)arg4;
 pickRedEnvelopCluster:clusterId:successBlock:failureBlock:</pre>
<p>我们看到其中有 DTRedEnvelopServiceFactory这个类,还有pickRedEnvelopCluster方法,在头文件中搜索pickRedEnvelopCluster,可以得到</p>
<p><img class="alignnone size-full wp-image-93745 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/ad7429890c3257a1985062f067fc6.jpg" alt="ad7429890c3257a1985062f067fc6" width="477" height="546" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/ad7429890c3257a1985062f067fc6.jpg 477w, http://www.mottoin.com/wp-content/uploads/2016/12/ad7429890c3257a1985062f067fc6-262x300.jpg 262w" sizes="(max-width: 477px) 100vw, 477px" /></p>
<p>我们又得到了几个关联的类,尤其是其中的DTRedEnvelopService.</p>
<p>到这里,你可能还是很迷惑,下步该做什么?</p>
<p>不要紧,TheOS给我们提供了一个logify.pl脚本(theos/bin/logify),这个脚本可以将一个类中的所有方法都加上日志. 大概的使用方式就是</p>
<pre>$THEOS/bin/logify.pl ./DTMessageMTMViewController.h 在终端显示结果
$THEOS/bin/logify.pl ./DTMessageMTMViewController.h &gt; /out/to/DTMessageMTMViewController.xm</pre>
<p>我们使用Theos建立一个tweak,这个tweak的作用就是输出日志,有关theos的安装和使用,可以参考我的另外一篇博客<a href="https://yohunl.com/ios-yue-yu-de-tweakkai-fa/">iOS 越狱的Tweak开发</a>,我们将我们觉得可疑的类都加上日志,编译一个tweak,安装到手机上. 你的这个tweak.xm文件中的内容应该是大致如下</p>
<pre>%hook DTOpenLuckyMoneyView
+ (void)showLuckyMoneyWithPickingStatus:(NSObject *)arg1 withController:(id)arg2 delegate:(id)arg3 
{ 
 NSLog(@"WithPickingStatus = %@,className = %@",arg1,NSStringFromClass(arg1.class));
 %log; %orig;
}
+ (void)queryAndOpenPageWithClusterId:(id)arg1 senderId:(long long)arg2 withController:(id)arg3 { %log; %orig; }
........

%end</pre>
<p>接着,你在钉钉中,让别人发一个红包,然后你点击拆红包,拆掉红包,将整个的Log输出,复制出来,用于分析. 这里,我将某一次的日志部分放出来,让你对这个日志有个概念</p>
<pre>&lt;Warning&gt;: &lt;L_UI&gt; -[DTMessageBubbleTapHandler messageBubbleViewCell:didTappedWithGestureRecognizer:] #81 [INFO] tap msg mid = 12685858885 , msgType = 902 
[m +[&lt;DTRedEnvelopServiceFactory: 0x103303bd8&gt; defaultServiceIMP]
[m -[&lt;DTRedEnvelopServicePersistenceIMP: 0x14de243b0&gt; initWithDbConnection:&lt;OpenDatabase: 0x14f247e00&gt;]
[m = &lt;DTRedEnvelopServicePersistenceIMP: 0x14de243b0&gt;
[m +[&lt;DTRedEnvelopServiceFactory: 0x103303bd8&gt; createServiceIMPWithPersistence:&lt;DTRedEnvelopServicePersistenceIMP: 0x14de243b0&gt; network:&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt;]
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; init]
[m = &lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt;
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; setPersistenceIMP:&lt;DTRedEnvelopServicePersistenceIMP: 0x14de243b0&gt;]
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; setNetworkIMP:&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt;]
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; sendInitAlipay]
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; getBindAlipaySuccessBlock:(null) failureBlock:(null)]
[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; networkIMP]
[m = 0x&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt;
[m -[&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt; getBindAlipaySuccessBlock:&lt;__NSStackBlock__: 0x16fdb5310&gt; failureBlock:&lt;__NSStackBlock__: 0x16fdb52e8&gt;]
[m = &lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt;
[m = &lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt;
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:239[m [0;30;46mDEBUG:[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; checkRedEnvelopClusterPickingStatus:88160518 clusterId:5PnAJfRG successBlock:&lt;__NSStackBlock__: 0x16fdb5638&gt; failureBlock:&lt;__NSStackBlock__: 0x16fdb5608&gt;] 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPTransactionService enqueue:] #154 [Info] enqueue uri=/r/Adaptor/DingPayI/getBindAlipay [mid:1df66b00] 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:211[m [0;30;46mDEBUG:[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; networkIMP] 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:211[m [0;30;46mDEBUG:[m = 0x&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt; 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:265[m [0;30;46mDEBUG:[m -[&lt;DTRedEnvelopServiceNetworkIMP: 0x14fa743c0&gt; checkRedEnvelopClusterPickingStatus:88160518 clusterId:5PnAJfRG successBlock:&lt;__NSStackBlock__: 0x16fdb5518&gt; failureBlock:&lt;__NSStackBlock__: 0x16fdb54e0&gt;] 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPMessenger lwpConnection:willSendMessage:isFirstMessage:] #1075 [Info] willSend [0][[id:85b80100(addr:0x14f2461c0, idx:0) - Master]]: 1df66b00 0 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:172[m [0;30;46mDEBUG:[m +[&lt;DTRedEnvelopPickIService: 0x1033227b8&gt; _serviceKey__] 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:172[m [0;30;46mDEBUG:[m = Adaptor/RedEnvelopPickIService 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:171[m [0;30;46mDEBUG:[m +[&lt;DTRedEnvelopPickIService: 0x1033227b8&gt; _appname__] 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:171[m [0;30;46mDEBUG:[m = (null) 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPTransactionService enqueue:] #154 [Info] enqueue uri=/r/Adaptor/RedEnvelopPickI/checkRedEnvelopClusterPickingStatus [mid:7e426c00] 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPMessenger lwpConnection:willSendMessage:isFirstMessage:] #1075 [Info] willSend [0][[id:85b80100(addr:0x14f2461c0, idx:0) - Master]]: 7e426c00 0 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:206[m [0;30;46mDEBUG:[m -[&lt;DTRedEnvelopServiceIMP: 0x14fec6a70&gt; setBindAlipayAccount:yoh***@163.com] 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPTransactionService destoryV2:withError:withResponse:] #258 [Info] destory: mid:1df66b00 200 
&lt;Warning&gt;: &lt;L_LWP&gt; -[LWPTransactionService destoryV2:withError:withResponse:] #258 [Info] destory: mid:7e426c00 200 
&lt;Warning&gt;: __98-[DTRedEnvelopServiceIMP checkRedEnvelopClusterPickingStatus:clusterId:successBlock:failureBlock:]_block_invoke #280 [INFO] clusterId=(null), flowCount=0 pickMoney=0 pickstatus=0 
&lt;Warning&gt;: WithPickingStatus = &lt;DTBizRedEnvelopClusterPickingStatus: 0x14deac5a0&gt;,className = DTBizRedEnvelopClusterPickingStatus 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:109[m [0;30;46mDEBUG:[m +[&lt;DTOpenLuckyMoneyView: 0x1032edd10&gt; showLuckyMoneyWithPickingStatus:&lt;DTBizRedEnvelopClusterPickingStatus: 0x14deac5a0&gt; withController:&lt;DTMessageOTOViewController: 0x14eb6d400&gt; delegate:&lt;DTMessageOTOViewController: 0x14eb6d400&gt;] 
&lt;Notice&gt;: [1;36m[DingTalkTweak] [m[0;36mTweak.xm:116[m [0;30;46mDEBUG:[m +[&lt;DTOpenLuckyMoneyView: 0x1032edd10&gt; viewWithDelegate:&lt;DTMessageOTOViewController: 0x14eb6d400&gt;]</pre>
<p>当然了,这个分析日志的过程,你可能会持续非常多的次数,因为在分析的过程中,你可能会发现另外的某个对象可能是你要的分析,你就要再修改tweak.xm文件中的hook,将这个对象的方法全hook住,反反复复</p>
<p>这个时候,你应该能够得到如下的关键信息</p>
<pre>&lt;DTRedEnvelopServiceFactory: 0x103303bd8&gt; defaultServiceIMP]</pre>
<p>DTRedEnvelopServiceFactory通过方法defaultServiceIMP构造了一个DTRedEnvelopServiceIMP对象,然后通过这个DTRedEnvelopServiceIMP对象的pickRedEnvelopCluster: clusterId: successBlock: failureBlock方法去拆红包</p>
<pre>&lt;DTRedEnvelopServiceFactory: 0x103303bd8&gt; defaultServiceIMP] 
DTRedEnvelopServiceIMP - (void)pickRedEnvelopCluster:(long long)arg1 clusterId:(id)arg2 successBlock:
(CDUnknownBlockType)arg3 failureBlock:(CDUnknownBlockType)arg4;</pre>
<p>这个方法就是最后的拆红包功能的方法,到此 拆红包这个就很简答了,由于[DTRedEnvelopServiceFactory defaultServiceIMP]是一个类方法,所以不需要我们构造的,那么现在的问题是,在[DTRedEnvelopServiceFactory defaultServiceIMP]周后,有没有调用其它的方法来配置这个构造出来的DTRedEnvelopServiceIMP对象呢?<br />
我们可以继续根据输出的日志来分析&#8230;.</p>
<p>这里,我直接告诉你分析的结果 [DTRedEnvelopServiceFactory defaultServiceIMP]方法中,会初始化一个全局的DTRedEnvelopServiceIMP对象.并且配置好它,例如绑定支付信息等等 (你可以从汇编中大概看一下).返回给的DTRedEnvelopServiceIMP对象就是一个完全可用的对象了,只要调用这个对象的pickRedEnvelopCluster: clusterId: successBlock: failureBlock方法,就可以完成拆红包这个动作了.</p>
<p>那么,自动拆红包这个,就变为你怎么拿到这个方法所需的4个参数了,后两个block,一看就知道可以传nil的,因为我们对成功失败的回调不感兴趣,问题就变为怎么拿到前两个参数了. 第一个参数是一个 long long类型,第二个是一个 NSString.</p>
<p>FLex有一个非常好用的功能,是其中带有的Heap Objects,这个可以用来查看当前内存中有哪些方法.结合我们上面的日志分析,会发现<br />
DTOpenLuckyMoneyEntityView 对象中的方法 &#8211; (DTBizRedEnvelopCluster *)currentCluster;<br />
其中包含了我们需要的红包的相关信息</p>
<p><img class="alignnone size-full wp-image-93747 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/1cfaf658208458b534fadb3bcb97b.png" alt="1cfaf658208458b534fadb3bcb97b" width="750" height="1334" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/1cfaf658208458b534fadb3bcb97b.png 750w, http://www.mottoin.com/wp-content/uploads/2016/12/1cfaf658208458b534fadb3bcb97b-169x300.png 169w, http://www.mottoin.com/wp-content/uploads/2016/12/1cfaf658208458b534fadb3bcb97b-576x1024.png 576w" sizes="(max-width: 750px) 100vw, 750px" /></p>
<p>接下来,我们让别人再发一个红包,然后,点击出现拆红包视图,这个时候,利用Flex的Heap Objects查内存中的DTBizRedEnvelopCluster方法,从中看到@property(copy, nonatomic) NSString *clusterId;和@property(nonatomic) long long sender,记下来</p>
<p>再搜寻 DTRedEnvelopServiceIMP对象,Flex可以直接调用搜寻出来的某个对象,在Flex中直接调用方法pickRedEnvelopCluster,传递给其,注意,这里在Flex中第二个参数是字符串,使用&#8221;&#8221;而不是@&#8221;&#8221;.</p>
<p><img class="alignnone size-full wp-image-93748 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/c306dfcf24d7aa5acbc289e2ed306.png" alt="c306dfcf24d7aa5acbc289e2ed306" width="750" height="1334" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/c306dfcf24d7aa5acbc289e2ed306.png 750w, http://www.mottoin.com/wp-content/uploads/2016/12/c306dfcf24d7aa5acbc289e2ed306-169x300.png 169w, http://www.mottoin.com/wp-content/uploads/2016/12/c306dfcf24d7aa5acbc289e2ed306-576x1024.png 576w" sizes="(max-width: 750px) 100vw, 750px" /></p>
<p>点击右上角的call,调用这个方法,不出意外,你会发现,红包已经被拆了,到此,验证了,的确是这个方法,而且也知道了参数怎么拿到的.</p>
<p>OK,问题又来了,如果没有出现拆红包视图,那么就没有这个DTBizRedEnvelopCluster类呀,那怎么获取其中的两个参数出来呢?</p>
<p>这的确是个问题,你要再回到汇编和头文件中,去分析了&#8230;.</p>
<p>每当来一个新消息,消息的列表页面就已经收到了,这说明在这个页面的时候,应该已经获取到了抢红包所需要的相关信息了.我们接下来找到他们之间的联系</p>
<p>我们平时看到的聊天的集合信息页是 DTConversationListController,浏览头文件,看到DTConversationListDataSource *_dataSource; 进入DTConversationListDataSource,看到其中有</p>
<pre>@property(retain, nonatomic) NSMutableArray&lt;DTBizConversation * WKBizConversation *等&gt; 
*conversationList</pre>
<p>从Heap Object进去,查看这个conversationList对象中的内容,可以看到其中存放的大概是DTBizConversation或者是WKBizConversation,继续浏览 我们看到DTBizConversation中,有一个对象 @property(retain, nonatomic) DTBizMessage *lastMessage; 进一步浏览内存中的这个对象,你就会发现 ,我靠,踏破铁下无觅处,红包信息就在这了.其中的 attachmentsJson中存放了完整的 附件信息的json字符串 大体上如下</p>
<pre>{
 "contentType" : 901,
 "@Type" : "WKIDLContentModel",
 "attachments" : [
 {
 "@Type" : "WKIDLAttachmentModel",
 "size" : 0,
 "type" : 0,
 "extension" : {
 "amount" : "0.01",
 "clusterid" : "5PnPxu8C",
 "sname" : "XXX",
 "size" : "1",
 "congrats" : "恭喜发财，大吉大利！",
 "sid" : "45049990",
 "type" : "0",
 "oid" : "0"
 },
 "isPreload" : false
 }
 ]
}</pre>
<p>经过各种分析&#8230;,可以知道,红包的contentType为901或者902.</p>
<p>整理下思路, DTConversationListController &#8212;&gt;DTConversationListDataSource *_dataSource &#8212;&gt; @property(retain, nonatomic) NSMutableArray *conversationList &#8212;&gt; DTBizConversation &#8212;&gt; DTBizMessage &#8212;&gt; attachmentsJson</p>
<p>DTConversationListController,只要我们开启钉钉,第一个页面就是,所以可以认为这个是单例,它的_dataSource也是一直存在的.</p>
<p>所以我们要拿到红包的信息结构就很简单了.</p>
<p>接下来,最后一个问题了. 那么我们怎么知道什么时候,分析这个DTConversationListController的dataSource的conversationList的DTBizConversation的DTBizMessage的attachmentsJson呢?也就是什么时候触发我们的自动抢红包动作呢??</p>
<p>比较容易想到的肯定是 当来新信息的时候.<br />
经过再一次的日志分析等各种分析(应该是一个比较漫长,繁琐的过程),你可以得到 每当有新消息来的收,DTConversationListDataSource的</p>
<pre>- (void)controller:(id)arg1 didChangeObject:(id)arg2 atIndex:(unsigned long long)arg3 forChangeType:(long 
long)arg4 newIndex:(unsigned long long)arg5;</pre>
<p>方法会被调用,经过日志输出,我们可以得到,其第二个参数就是要插入到datasouce中的WKBizConversation/DTBizConversation</p>
<p>所以,只要我们hook这个方法,就可以在这触发我们的抢红包动作了.</p>
<h2>核心源码</h2>
<pre>@implementation YLHongBaoViewController
+ (void)load {

static dispatch_once_t onceToken;
 dispatch_once(&amp;onceToken, ^{
 Class class = objc_getClass("DTConversationListDataSource") ;//[self class];
 //- (void)controller:(id)arg1 didChangeObject:(id)arg2 atIndex:(unsigned long long)arg3 forChangeType:(long long)arg4 newIndex:(unsigned long long)arg5;

void (^hook_block)(id&lt;AspectInfo&gt; aspectinfo,id controller,id didChangeObject,unsigned long long atIndex,long long forChangeType,unsigned long long newIndex) = ^(id&lt;AspectInfo&gt; aspectinfo,id controller,id didChangeObject,unsigned long long atIndex,long long forChangeType,unsigned long long newIndex){
 if (![YLHongBaoViewController isEnabled]) {
 NSLog(@" 红包分析 走原来的逻辑");
 return;
 }
 NSMutableArray *attachArr = [DingTalkRedEnvelop disposeConversation:didChangeObject];
 [attachArr enumerateObjectsUsingBlock:^(NSDictionary *obj, NSUInteger idx, BOOL * _Nonnull stop) {
 DTRedEnvelopServiceIMP *imp = [objc_getClass("DTRedEnvelopServiceFactory") defaultServiceIMP];
 long long sid = [obj[@"sid"] longLongValue];
 NSString *cluseId = obj[@"clusterid"];
 NSLog(@"lingdaiping_sid = %lld,cluseid = %@",sid,cluseId);
 if (cluseId.length &gt; 0){
 [imp pickRedEnvelopCluster:sid clusterId:cluseId successBlock:nil failureBlock:nil];
 }

}];


 };
 aspect_add(class, @selector(controller:didChangeObject:atIndex:forChangeType:newIndex:), AspectPositionAfter, hook_block, nil);
 });
}


+ (NSMutableArray *)disposeConversation:(WKBizConversation *)converdation {
 NSLog(@"disposeConversation_sation = %@", converdation);
 //WKBizConversation *converdation = sation;
 NSMutableArray *retArr = [NSMutableArray new];
 NSLog(@"disposeConversation_converdation.latestMessage = %@", converdation.latestMessage);
 NSString *attachmentsJson = converdation.latestMessage.attachmentsJson;
 NSLog(@"disposeConversation_attachmentsJson = %@", attachmentsJson);
 if (attachmentsJson.length &gt; 0) {
 NSData* jsonData = [attachmentsJson dataUsingEncoding:NSUTF8StringEncoding];
 NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:jsonData options:NSJSONReadingMutableLeaves error:nil];
 NSLog(@"disposeConversation_dict = %@", dict);
 NSNumber *contentType = dict[@"contentType"];
 NSLog(@"disposeConversation_contentType = %@", contentType);
 if (contentType.integerValue == 902 || contentType.integerValue == 901) {//红包
 NSMutableDictionary *retDict = [NSMutableDictionary new];
 retDict[@"contentType"] = contentType;
 NSArray *arr = dict[@"attachments"];
 NSLog(@"disposeConversation_arr = %@", arr);
 if (arr.count &gt; 0) {
 [arr enumerateObjectsUsingBlock:^(NSDictionary *attachmentDict, NSUInteger idx, BOOL * _Nonnull stop) {
 NSDictionary *extension = attachmentDict[@"extension"];
 NSLog(@"disposeConversation_extension = %@", extension);
 retDict[@"clusterid"] = extension[@"clusterid"];
 retDict[@"sid"] = extension[@"sid"];
 NSLog(@"disposeConversation_retDict = %@", retDict);
 [retArr addObject:retDict];
 }];
 }

}
 }
 return retArr; 
}</pre>
<h2>备注</h2>
<p>本文的源码放在本文的源码放在我的gitHub上 <a href="https://github.com/yohunl/DingTalkNoJailTweak">DingTalkNoJailTweak </a>有关源码怎么使用,请参考源码的Redeme.此源码可以用在越狱环境中,也可以使用在非越狱环境中.</p>
<h2>源码说明</h2>
<p>参见github上的源码说明 <a href="https://github.com/yohunl/DingTalkNoJailTweak">https://github.com/yohunl/DingTalkNoJailTweak</a></p>
<p>&nbsp;</p>
<p style="text-align: center;"><span style="color: #ff0000;"><strong>*作者：<a style="color: #ff0000;" href="https://yohunl.com/ding-ding-qiang-hong-bao-cha-jian-iospian/">yohunl</a>，MottoIN小编整理发布</strong></span></p>
                                                        <div class="entry-copyright"><p>原创文章，作者：exp1oi7ss，如若转载，请注明出处：http://www.mottoin.com/93727.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/app%e9%80%86%e5%90%91" rel="tag">APP逆向</a><a href="http://www.mottoin.com/tag/ios" rel="tag">iOS</a><a href="http://www.mottoin.com/tag/%e9%92%89%e9%92%89%e6%8a%a2%e7%ba%a2%e5%8c%85%e6%8f%92%e4%bb%b6" rel="tag">钉钉抢红包插件</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="93727"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="138" target="_blank" href="http://www.mottoin.com/user/msbuild/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="Exp1oi7ss" />                                                Exp1oi7ss                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="93727"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/93727.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F93727.html&title=APP%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E4%B9%8B%E9%92%89%E9%92%89%E6%8A%A2%E7%BA%A2%E5%8C%85%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0-iOS%E7%AF%87" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F93727.html&title=APP%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E4%B9%8B%E9%92%89%E9%92%89%E6%8A%A2%E7%BA%A2%E5%8C%85%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0-iOS%E7%AF%87" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/92388.html" title="使用DNX.EXE绕过应用白名单">使用DNX.EXE绕过应用白名单</a></li><li><a href="http://www.mottoin.com/99707.html" title="Cognitoys Dino玩具XSS漏洞分析">Cognitoys Dino玩具XSS漏洞分析</a></li><li><a href="http://www.mottoin.com/94230.html" title="基于文件特征的Android模拟器检测（附代码下载）">基于文件特征的Android模拟器检测（附代码下载）</a></li><li><a href="http://www.mottoin.com/101307.html" title="基于BIOS的Rootkit">基于BIOS的Rootkit</a></li><li><a href="http://www.mottoin.com/99718.html" title="华硕RT-AC66U路由器的几个漏洞分析">华硕RT-AC66U路由器的几个漏洞分析</a></li><li><a href="http://www.mottoin.com/88697.html" title="色情应用暗藏杀机，宅男福利竟成“灾难降临”">色情应用暗藏杀机，宅男福利竟成“灾难降临”</a></li><li><a href="http://www.mottoin.com/84616.html" title="浅谈权限滥用的防御">浅谈权限滥用的防御</a></li><li><a href="http://www.mottoin.com/101225.html" title="Linksys Smart Wi-Fi 路由器（ EA3500 系列）中发现存在 10 个漏洞">Linksys Smart Wi-Fi 路由器（ EA3500 系列）中发现存在 10 个漏洞</a></li><li><a href="http://www.mottoin.com/99144.html" title="对AIX系统的渗透测试">对AIX系统的渗透测试</a></li><li><a href="http://www.mottoin.com/95897.html" title="当EFBFBD和它的朋友相遇：研究字符数组转换字符串">当EFBFBD和它的朋友相遇：研究字符数组转换字符串</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/93727.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/msbuild/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="Exp1oi7ss" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">Exp1oi7ss</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/100871.html" title="Edge浏览器：滥用阅读模式导致SOP绕过">Edge浏览器：滥用阅读模式导致SOP绕过</a></li>
                                    <li><a href="http://www.mottoin.com/100929.html" title="Apache日志记录组件Log4j反序列化漏洞影响所有2.x版本">Apache日志记录组件Log4j反序列化漏洞影响所有2.x版本</a></li>
                                    <li><a href="http://www.mottoin.com/98030.html" title="浅谈SAML攻击与防御">浅谈SAML攻击与防御</a></li>
                                    <li><a href="http://www.mottoin.com/96841.html" title="MobSF框架及源代码分析">MobSF框架及源代码分析</a></li>
                                    <li><a href="http://www.mottoin.com/96036.html" title="【漏洞预警】360发现QEMU严重漏洞 影响国内大部分公有云">【漏洞预警】360发现QEMU严重漏洞 影响国内大部分公有云</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>