<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>Android免Root环境下Hook框架Legend原理分析 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; Android免Root环境下Hook框架Legend原理分析评论Feed" href="http://www.mottoin.com/95967.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Node.js 反序列化远程命令执行漏洞分析' href='http://www.mottoin.com/95916.html' />
<link rel='next' title='Web安全扫描器Netsparker 4.8.0.13139版本发布' href='http://www.mottoin.com/95973.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=95967' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="Android,Hook框架,Legend原理,root">
<meta name="description" content="title:Android免Root环境下Hook框架Legend原理分析date:2017-02-1213:37:22tags:Android软件安全post_asset_folder:true0x1应用场景现如今，免Root环境下的逆向分析已经成为一种潮流！在2015年之前的iOS软件逆向工程领域，要想对iOS平台上的软件进行逆向工程分析，越狱iOS设备与安装Cydia是必须的！几乎绝大多数的">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-95967 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item current-post-ancestor current-menu-parent current-post-parent"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-95967" class="post-95967 post type-post status-publish format-standard has-post-thumbnail hentry category-terminal tag-android tag-hook tag-legend tag-root">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">Android免Root环境下Hook框架Legend原理分析</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/nonworm/">非虫</a>
                                <span class="dot">•</span>
                                <span>2017年2月13日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/article/terminal" rel="category tag">终端安全</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 472</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <blockquote><p>title: Android免Root环境下Hook框架Legend原理分析</p>
<p>date: 2017-02-12 13:37:22</p>
<p>tags: Android软件安全</p>
<p>post_asset_folder: true</p></blockquote>
<h2>0x1 应用场景</h2>
<p>现如今，免Root环境下的逆向分析已经成为一种潮流！</p>
<p>在2015年之前的iOS软件逆向工程领域，要想对iOS平台上的软件进行逆向工程分析，越狱iOS设备与安装Cydia是必须的！几乎绝大多数的逆向相关的动态调试工具、Hook注入框架都依赖于获取IOS设备的最高访问权限，就技术本身上而言，对当前程序进行Hook与动态调试，只需要拥有与当前程序相同的权限即可，理论上无需对设备进行Root越狱，实际上，在2015年就出现了在非越狱设备上进行插件开发的实用案例，2016年的iOS软件逆向工程界，更是一发不可收拾，各种名越狱环境下的逆向工具与逆向技巧被安全人员所发掘，在没有越狱的iOS设备上进行软件的动态调试与逆向工程已经是主流的趋势胃。这样的情况下，最直接的影响是安全研究人员不再对iOS设备越狱有着强烈的追求了，越狱需求的下降可能会直接影响到iOS设备越狱工具的发布与技术的更新迭代。</p>
<p>同样的，在Android设备的免Root环境下，进行软件动态调试与逆向工程分析的需求更加强烈。免Root环境下动态调试与逆向工程就技术本质而言是可行的，安全研究人员的智慧更是有力的证明了这一点，LBE发布免Root环境下APK双开工具平行空间就是最好的例子，它是打破逆向工程技术的原始格局的第一个大锤！随后的，各种APK多开框架、免Root环境下的Hook、免Root环境下的动态调试等技术都被研究人员公开，这是Android软件逆向工程界的福音，逆向工程人员在以后的逆向分析过程中，可能再也不需要为自己的手机能否越狱而感到苦恼，手上在吃灰淘汰的Android小米机可能就是你的逆向必备工具之一。</p>
<p>好了，说了这么多，无非是告诉大家，开发技术在更新迭代，软件的逆向工程技术也在不停的更新，各位研究软件安全的朋友们，你们跟上了时代的脚步吗？！</p>
<h2>0x2 Legend框架简介</h2>
<p>Legend是Lody开源的一个Android免Root环境下的一个APK Hook框架，代码放在github上：asLody/legend。 该框架代码设计简洁，通用性高，适合逆向工程时一些Hook场景。</p>
<p>先来看看如何使用它。框架提供了两种使用方法：基于Annotation注解与代码直接调用。基于Annotation注解的Hook技术不是第一次被发现了，在Java开发的世界里，这种技术被广泛使用，大名鼎鼎的基于AOP开发的Aspectj就大量使用这种技术。使用Annotation方式编写的Java代码有着很强的灵活与扩展性。Legend中Annotation方式的Hook这样使用：</p>
<pre>@Hook("android.app.Activity::startActivity@android.content.Intent")
public static void Activity_startActivity(Activity thiz, Intent intent) {
 if (!ALLOW_LAUNCH_ACTIVITY) {
 Toast.makeText(thiz, "I am sorry to turn your Activity down :)", Toast.LENGTH_SHORT).show();
 } else {
 HookManager.getDefault().callSuper(thiz, intent);
 }
}</pre>
<p>@Hook(&#8220;xxx&#8221;)部分指明需要Hook的类与方法以及方法的签名，此处的Activity_startActivity()是自己实现的替换android.app.Activity::startActivity()的方法，HookManager.getDefault().callSuper(thiz, intent);调用是调用原方法。</p>
<p>这种方式Hook的方法，需要执行一次Hook应用操作来激活所有注解Hook，方法是执行下面的方法，传入的YourClass.class是包含了注解的类：</p>
<pre>HookManager.getDefault().applyHooks(YourClass.class);</pre>
<p>另一种代码方式进行Hook使用起来更简单，Hook操作只需要一行代码：</p>
<pre>HookManager.getDefault().hookMethod(originMethod, hookMethod);</pre>
<p>这是Legend提供的demo展示的一个完整实例：</p>
<pre>package com.legend.demo;

import android.app.Activity;
import android.app.Application;
import android.content.Context;
import android.content.Intent;
import android.telephony.TelephonyManager;
import android.widget.Toast;

import com.lody.legend.Hook;
import com.lody.legend.HookManager;

/**
 * @author Lody
 * @version 1.0
 */
public class App extends Application {

public static boolean ENABLE_TOAST = true;
 public static boolean ALLOW_LAUNCH_ACTIVITY = true;

@Override
 protected void attachBaseContext(Context base) {
 super.attachBaseContext(base);
 HookManager.getDefault().applyHooks(App.class);

}

@Hook("android.app.Application::onCreate")
 public static void Application_onCreate(Application app) {
 Toast.makeText(app, "Application =&gt; onCreate()", Toast.LENGTH_SHORT).show();
 HookManager.getDefault().callSuper(app);
 }

@Hook("android.telephony.TelephonyManager::getSimSerialNumber")
 public static String TelephonyManager_getSimSerialNumber(TelephonyManager thiz) {
 return "110";
 }

@Hook("android.widget.Toast::show")
 public static void Toast_show(Toast toast) {
 if (ENABLE_TOAST) {
 HookManager.getDefault().callSuper(toast);
 }
 }

@Hook("android.app.Activity::startActivity@android.content.Intent")
 public static void Activity_startActivity(Activity activity, Intent intent) {
 if (!ALLOW_LAUNCH_ACTIVITY) {
 Toast.makeText(activity, "I am sorry to turn your Activity down :)", Toast.LENGTH_SHORT).show();
 }else {
 HookManager.getDefault().callSuper(activity, intent);
 }
 }

}</pre>
<h2>0x3 原理分析</h2>
<p>先来看看Hook注解的实现：</p>
<pre>// Legend/legendCore/src/main/java/com/lody/legend/Hook.java

package com.lody.legend;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * @author Lody
 * @version 1.0
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Hook {
 String value() default "";
}</pre>
<p>｀@Target(ElementType.METHOD)｀指明Hook注解用于修饰类中的Method，与之类似的还有@Target(ElementType.FIELD)用来修饰类中的Field。如果想让注解同时修饰类的Field与Method，可以这么写：</p>
<pre>@Target({ElementType.FIELD, ElementType.METHOD})
public @interface Hook{}
 ......</pre>
<p>@Retention(RetentionPolicy.RUNTIME)指明Hook注解以何种形式进行保留。RetentionPolicy是一个enum类型，声明如下：</p>
<pre>public enum RetentionPolicy { 
 SOURCE, 
 CLASS, 
 RUNTIME 
 }</pre>
<p>｀SOURCE｀表明该注解类型的信息只保留在程序源码里，源码经过编译之后，注解的数据就会消失;CLASS表明注解类型的信息除了保留在程序源码里，同时也保留在编译好的class文件里面，但在执行的时候，并不会把这些信息加载到内存中去；RUNTIME是最大范围的保留，表示同时在源码与编译好的class文件中保留信息，并且在执行的时候会把这些信息加载到内存中去。</p>
<p>定义好了Hook注解，看它是如何使用的，这就是HookManager.getDefault().applyHooks()方法要做的工作，它的代码如下：</p>
<pre>// Legend/legendCore/src/main/java/com/lody/legend/HookManager.java
public void applyHooks(Class&lt;?&gt; holdClass) {
 for (Method hookMethod : holdClass.getDeclaredMethods()) {
 Hook hook = hookMethod.getAnnotation(Hook.class);
 if (hook != null) {
 String statement = hook.value();
 String[] splitValues = statement.split("::");
 if (splitValues.length == 2) {
 String className = splitValues[0];
 String[] methodNameWithSignature = splitValues[1].split("@");
 if (methodNameWithSignature.length &lt;= 2) {
 String methodName = methodNameWithSignature[0];
 String signature = methodNameWithSignature.length == 2 ? methodNameWithSignature[1] : "";
 String[] paramList = signature.split("#");
 if (paramList[0].equals("")) {
 paramList = new String[0];
 }
 try {
 Class&lt;?&gt; clazz = Class.forName(className);
 boolean isResolve = false;
 for (Method method : clazz.getDeclaredMethods()) {
 if (method.getName().equals(methodName)) {
 Class&lt;?&gt;[] types = method.getParameterTypes();
 if (paramList.length == types.length) {
 boolean isMatch = true;
 for (int N = 0; N &lt; types.length; N++) {
 if (!types[N].getName().equals(paramList[N])) {
 isMatch = false;
 break;
 }
 }
 if (isMatch) {
 hookMethod(method, hookMethod);
 isResolve = true;
 Logger.d("[+++] %s have hooked.", method.getName());
 }
 }
 }
 if (isResolve) {
 break;
 }
 }
 if (!isResolve) {
 Logger.e("[---] Cannot resolve Method : %s.", Arrays.toString(methodNameWithSignature));
 }
 } catch (Throwable e) {
 Logger.e("[---] Error to Load Hook Method From : %s." , hookMethod.getName());
 e.printStackTrace();
 }

}else {
 Logger.e("[---] Can't split method and signature : %s.", Arrays.toString(methodNameWithSignature));
 }
 }else {
 Logger.e("[---] Can't understand your statement : [%s].", statement);
 }
 }
 }
}</pre>
<p>该方法遍历类的所有方法，查找匹配注解信息中指定的方法，方法是：对于需要Hook的Class类holdClass，调用它的getDeclaredMethods()获取所有声明的方法，依次调用每个类的方法的getAnnotation()获取注解信息，取到的注解信息保存在String类型的statement变量中，类与完整的方法签名以“::”进行分隔，方法签名中的方法名与参数签名使用“@”进行分隔，参数签名中每个参数之间使用“#”进行分隔，取完一个方法所有的信息后，与类中的方法进行比较，如果完全匹配说明找到了需要Hook的方法，这个时候，调用hookMethod()方法进行Hook操作，注意这里的hookMethod()方法，即Legend框架支持的第二种Hook方式。</p>
<p>hookMethod()调用Runtime.isArt()判断当前代码执行在Art还是Dalvik模式，如果是Art模式，执行hookMethodArt()来完成Hook操作，如果是Dalvik模式，执行hookMethodDalvik()完成Hook。</p>
<p>Runtime.isArt()的代码只有一行，即判断虚拟机版本字符串是否以字符2开头，如下：</p>
<pre>public static boolean isArt() {
 return getVmVersion().startsWith("2");
}

public static String getVmVersion() {
 return System.getProperty("java.vm.version");
}</pre>
<p>执行完Hook后会返回一个backupMethod，这是一个原始方法的备份，最后将backupMethod放入以methodName命令的backupList，在methodNameToBackupMethodsMap备份就完事了。</p>
<p>接下来看看hookMethodArt()都干了啥：</p>
<pre>private static Method hookMethodArt(Method origin, Method hook) {
 ArtMethod artOrigin = ArtMethod.of(origin);
 ArtMethod artHook = ArtMethod.of(hook);
 Method backup = artOrigin.backup().getMethod();
 backup.setAccessible(true);
 long originPointFromQuickCompiledCode = artOrigin.getEntryPointFromQuickCompiledCode();
 long originEntryPointFromJni = artOrigin.getEntryPointFromJni();
 long originEntryPointFromInterpreter = artOrigin.getEntryPointFromInterpreter();
 long originDeclaringClass = artOrigin.getDeclaringClass();
 long originAccessFlags = artOrigin.getAccessFlags();
 long originDexCacheResolvedMethods = artOrigin.getDexCacheResolvedMethods();
 long originDexCacheResolvedTypes = artOrigin.getDexCacheResolvedTypes();
 long originDexCodeItemOffset = artOrigin.getDexCodeItemOffset();
 long originDexMethodIndex = artOrigin.getDexMethodIndex();

long hookPointFromQuickCompiledCode = artHook.getEntryPointFromQuickCompiledCode();
 long hookEntryPointFromJni = artHook.getEntryPointFromJni();
 long hookEntryPointFromInterpreter = artHook.getEntryPointFromInterpreter();
 long hookDeclaringClass = artHook.getDeclaringClass();
 long hookAccessFlags = artHook.getAccessFlags();
 long hookDexCacheResolvedMethods = artHook.getDexCacheResolvedMethods();
 long hookDexCacheResolvedTypes = artHook.getDexCacheResolvedTypes();
 long hookDexCodeItemOffset = artHook.getDexCodeItemOffset();
 long hookDexMethodIndex = artHook.getDexMethodIndex();

ByteBuffer hookInfo = ByteBuffer.allocate(ART_HOOK_INFO_SIZE);
 hookInfo.putLong(originPointFromQuickCompiledCode);
 hookInfo.putLong(originEntryPointFromJni);
 hookInfo.putLong(originEntryPointFromInterpreter);
 hookInfo.putLong(originDeclaringClass);
 hookInfo.putLong(originAccessFlags);
 hookInfo.putLong(originDexCacheResolvedMethods);
 hookInfo.putLong(originDexCacheResolvedTypes);
 hookInfo.putLong(originDexCodeItemOffset);
 hookInfo.putLong(originDexMethodIndex);

hookInfo.putLong(hookPointFromQuickCompiledCode);
 hookInfo.putLong(hookEntryPointFromJni);
 hookInfo.putLong(hookEntryPointFromInterpreter);
 hookInfo.putLong(hookDeclaringClass);
 hookInfo.putLong(hookAccessFlags);
 hookInfo.putLong(hookDexCacheResolvedMethods);
 hookInfo.putLong(hookDexCacheResolvedTypes);
 hookInfo.putLong(hookDexCodeItemOffset);
 hookInfo.putLong(hookDexMethodIndex);

artOrigin.setEntryPointFromQuickCompiledCode(hookPointFromQuickCompiledCode);
 artOrigin.setEntryPointFromInterpreter(hookEntryPointFromInterpreter);
 artOrigin.setDeclaringClass(hookDeclaringClass);
 artOrigin.setDexCacheResolvedMethods(hookDexCacheResolvedMethods);
 artOrigin.setDexCacheResolvedTypes(hookDexCacheResolvedTypes);
 artOrigin.setDexCodeItemOffset((int) hookDexCodeItemOffset);
 artOrigin.setDexMethodIndex((int) hookDexMethodIndex);

int accessFlags = origin.getModifiers();
 if (Modifier.isNative(accessFlags)) {
 accessFlags &amp;= ~ Modifier.NATIVE;
 artOrigin.setAccessFlags(accessFlags);
 }
 long memoryAddress = Memory.alloc(ART_HOOK_INFO_SIZE);
 Memory.write(memoryAddress,hookInfo.array());
 artOrigin.setEntryPointFromJni(memoryAddress);

return backup;
 }</pre>
<p>原方法与替换的方法分别为artOrigin与artHook，执行artOrigin的backup()完成方法的备份操作，backup()内部通过反射获取AbstractMethod类的artMethod字段，然后使用当前类的method进行填充，实际的操作就是复制一份当前类的method，此处不展开它的代码。</p>
<p>接下来的代码是获取artOrigin与artHook的重要字段，然后构造ByteBuffer类型的hookInfo，最后调用以下三行代码来完成Hook：</p>
<pre>long memoryAddress = Memory.alloc(ART_HOOK_INFO_SIZE);
Memory.write(memoryAddress,hookInfo.array());
artOrigin.setEntryPointFromJni(memoryAddress);</pre>
<p>ArtMethod在底层的内存结构定义仅次于Android源码的“art/runtime/art_method.h”文件，不同系统版本的Android这个结构体都可能会发现变化，为了保持兼容性，Legend在Java层手动定义保存了它们的字段偏移信息，与“Legend/legendCore/src/main/java/com/lody/legend/art/ArtMethod.java”文件保存在同一目录，在调用ArtMethod::of()方法构造ArtMethod时，会根据不同的系统版本来构造不同的对象。</p>
<p>Memory.write()方法底层调用的LegendNative.memput()，它是一个native方法，对应的实现是android_memput()，代码如下：</p>
<pre>// Legend/Native/jni/legend_native.cpp
void android_memput(JNIEnv * env, jclass clazz, jlong dest, jbyteArray src) {
 jbyte *srcPnt = env-&gt;GetByteArrayElements(src, 0);
 jsize length = env-&gt;GetArrayLength(src);
 unsigned char * destPnt = (unsigned char *)dest;
 for(int i = 0; i &lt; length; ++i) {
 destPnt[i] = srcPnt[i];
 }
 env-&gt;ReleaseByteArrayElements(src, srcPnt, 0);
}</pre>
<p>可以看出，馐的内存写操作是直接使用底层指定长度的字节流覆盖的，简单与暴力，而能够这样操作的原因，是当前操作的内存是自己的内存，想怎么干就怎么干！</p>
<p>setEntryPointFromJni()直接将原方法起始地址的指针内容，通过构造的memoryAddress覆盖写入！如此这般，Art模式下的Hook就完成了，当然，这其中很多小细节没有讲到，读者可以看行阅读它的代码。</p>
<p>接下来看看Dalvik下的Hook方法hookMethodDalvik()都干了啥：</p>
<pre>// Legend/legendCore/src/main/java/com/lody/legend/HookManager.java
private static Method hookMethodDalvik(Method origin, Method hook) {
 DalvikMethodStruct dvmOriginMethod = DalvikMethodStruct.of(origin);
 DalvikMethodStruct dvmHookMethod = DalvikMethodStruct.of(hook);

byte[] originClassData = dvmOriginMethod.clazz.read();
 byte[] originInsnsData = dvmOriginMethod.insns.read();
 byte[] originInsSizeData = dvmOriginMethod.insSize.read();
 byte[] originRegisterSizeData = dvmOriginMethod.registersSize.read();
 byte[] originAccessFlags = dvmOriginMethod.accessFlags.read();
 byte[] originNativeFunc = dvmOriginMethod.nativeFunc.read();

byte[] hookClassData = dvmHookMethod.clazz.read();
 byte[] hookInsnsData = dvmHookMethod.insns.read();
 byte[] hookInsSizeData = dvmHookMethod.insSize.read();
 byte[] hookRegisterSizeData = dvmHookMethod.registersSize.read();
 byte[] hookAccessFlags = dvmHookMethod.accessFlags.read();
 byte[] hookNativeFunc = dvmHookMethod.nativeFunc.read();

dvmOriginMethod.clazz.write(hookClassData);
 dvmOriginMethod.insns.write(hookInsnsData);
 dvmOriginMethod.insSize.write(hookInsSizeData);
 dvmOriginMethod.registersSize.write(hookRegisterSizeData);
 dvmOriginMethod.accessFlags.write(hookAccessFlags);

ByteBuffer byteBuffer = ByteBuffer.allocate(DVM_HOOK_INFO_SIZE);
 byteBuffer.put(originClassData);
 byteBuffer.put(originInsnsData);
 byteBuffer.put(originInsSizeData);
 byteBuffer.put(originRegisterSizeData);
 byteBuffer.put(originAccessFlags);
 byteBuffer.put(originNativeFunc);
 //May leak
 long memoryAddress = Memory.alloc(DVM_HOOK_INFO_SIZE);
 Memory.write(memoryAddress, byteBuffer.array());
 dvmOriginMethod.nativeFunc.write(memoryAddress);
 return origin;
}</pre>
<p>分析完Art模式，Dalvik下的就不难看懂的，DalvikMethodStruct.of()会返回DalvikMethodStruct类型结构体，它是Dalvik虚拟机内部DalvikMethod结构体的内线性布局表示。</p>
<p>dvmOriginMethod与dvmHookMethod分别代表原方法与Hook替换的方法，同样的，使用底层内存的写操作，对所有需要替换的字段进行替换。</p>
<p>最后就是Hook后的方法调用原方法了，它的代码如下：</p>
<pre>// Legend/legendCore/src/main/java/com/lody/legend/HookManager.java
public &lt;T&gt; T callSuper(Object who, Object... args) {
 StackTraceElement[] traceElements = Thread.currentThread().getStackTrace();
 StackTraceElement currentInvoking = traceElements[3];
 String invokingClassName = currentInvoking.getClassName();
 String invokingMethodName = currentInvoking.getMethodName();
 Map&lt;String,List&lt;Method&gt;&gt; methodNameToBackupMethodsMap = classToBackupMethodsMapping.get(invokingClassName);
 if (methodNameToBackupMethodsMap != null) {
 List&lt;Method&gt; methodList = methodNameToBackupMethodsMap.get(invokingMethodName);
 if (methodList != null) {
 Method method = matchSimilarMethod(methodList, args);
 if (method != null) {
 try {
 if (Runtime.isArt()) {
 return callSuperArt(method, who, args);
 }else {
 return callSuperDalvik(method, who, args);
 }
 } catch (Throwable e) {
 Logger.e("[---] Call super method with error : %s, detail message please see the [Logcat :system.err].", 
e.getMessage());
 e.printStackTrace();
 }
 }else {
 Logger.e("[---] Super method cannot found in backup map.");
 }
 }
 }
 return null;
}</pre>
<p>这段代码是在之前保存的methodNameToBackupMethodsMap中查找备份的方法，找到后对Art与Dalvik模式分别调用callSuperArt()与callSuperDalvik()，前者比较简单，只是调用方法的invoke()就完事，而Dalvik模式由于没有像Art那样做备份，所以多出了一个字段回替换的操作，完事也是调用的invoke()来执行原方法。</p>
<h2>0x4 一些感想</h2>
<p>分析完上面的代码，可以出来Legend尽管实现了Art与Dalvik双模式下的Hook，但在实际逆向Hook中，还是有一些不足：</p>
<ol>
<li>不能Hook字段。在很多应用场景中可能会用到，这里有一个迂回的替代的方案是：在字段较敏感的方法中对方法做Hook，然后在Hook代码中反射操作字段。</li>
<li>Hook自定义的类加载器加载的类方法。由于反射查找的类的方法列表依赖于类的查找，对于部分自定义ClassLoader的情况，获取Class本身就存在着难度，更别说Hook它的方法了。</li>
<li>兼容性。只支持4.2到6.0，当然，根据技术原理，从2.3到7.1应该都是可以做到的。</li>
<li>稳定性。与该框架技术原理类似的还有很多，比较alibaba的AndFix，在系统自定义修改较多的情况下，框加要的稳定性存疑，当然，逆向工程时使用的稳定性远没有做产品要求的高，一些全新思路的Hook修改方案如Tinker可能也是一个不错的选择，留待以后测试了！</li>
</ol>
<p>最后，讲完了它的原理，并没有讲如何在逆向工程中使用，这个交给聪明的安全研究人员作为思维发散。</p>
<p style="text-align: center;">
<p style="text-align: center;"><span style="color: #ff0000;"><strong>*作者：<a style="color: #ff0000;" href="https://zhuanlan.zhihu.com/p/25200724">非虫</a>，转载请注明来自MottoIN</strong></span></p>
                                                        <div class="entry-copyright"><p>原创文章，作者：非虫，如若转载，请注明出处：http://www.mottoin.com/95967.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/android" rel="tag">Android</a><a href="http://www.mottoin.com/tag/hook%e6%a1%86%e6%9e%b6" rel="tag">Hook框架</a><a href="http://www.mottoin.com/tag/legend%e5%8e%9f%e7%90%86" rel="tag">Legend原理</a><a href="http://www.mottoin.com/tag/root" rel="tag">root</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="95967"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="370" target="_blank" href="http://www.mottoin.com/user/nonworm/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="非虫" />                                                非虫                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="95967"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/95967.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F95967.html&title=Android%E5%85%8DRoot%E7%8E%AF%E5%A2%83%E4%B8%8BHook%E6%A1%86%E6%9E%B6Legend%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F95967.html&title=Android%E5%85%8DRoot%E7%8E%AF%E5%A2%83%E4%B8%8BHook%E6%A1%86%E6%9E%B6Legend%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/99689.html" title="Annke SP1高清无线摄像机XSS漏洞">Annke SP1高清无线摄像机XSS漏洞</a></li><li><a href="http://www.mottoin.com/98372.html" title="如何从内存中恢复丢失的Python代码">如何从内存中恢复丢失的Python代码</a></li><li><a href="http://www.mottoin.com/94150.html" title="msiexec 绕过应用程序白名单">msiexec 绕过应用程序白名单</a></li><li><a href="http://www.mottoin.com/102035.html" title="隔空取物——揭秘网络设备的物理隔离攻击技术">隔空取物——揭秘网络设备的物理隔离攻击技术</a></li><li><a href="http://www.mottoin.com/95897.html" title="当EFBFBD和它的朋友相遇：研究字符数组转换字符串">当EFBFBD和它的朋友相遇：研究字符数组转换字符串</a></li><li><a href="http://www.mottoin.com/91246.html" title="IoT: 物联网安全测试经验总结">IoT: 物联网安全测试经验总结</a></li><li><a href="http://www.mottoin.com/99707.html" title="Cognitoys Dino玩具XSS漏洞分析">Cognitoys Dino玩具XSS漏洞分析</a></li><li><a href="http://www.mottoin.com/84082.html" title="移动安全之Android安全检测工具大全">移动安全之Android安全检测工具大全</a></li><li><a href="http://www.mottoin.com/100358.html" title="[CVE-2017-3881]思科Catalyst 交换机RCE漏洞分析">[CVE-2017-3881]思科Catalyst 交换机RCE漏洞分析</a></li><li><a href="http://www.mottoin.com/86821.html" title="从栈溢出到简单的shellcode开发">从栈溢出到简单的shellcode开发</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/95967.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/nonworm/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="非虫" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">非虫</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/95967.html" title="Android免Root环境下Hook框架Legend原理分析">Android免Root环境下Hook框架Legend原理分析</a></li>
                                    <li><a href="http://www.mottoin.com/95673.html" title="macOS软件安全系列-软件内幕篇：Mach-O文件格式">macOS软件安全系列-软件内幕篇：Mach-O文件格式</a></li>
                                    <li><a href="http://www.mottoin.com/95667.html" title="macOS软件安全系列-软件内幕篇：macOS平台软件的下载与安装">macOS软件安全系列-软件内幕篇：macOS平台软件的下载与安装</a></li>
                                    <li><a href="http://www.mottoin.com/89035.html" title="常见app加固厂商脱壳方法研究">常见app加固厂商脱壳方法研究</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>