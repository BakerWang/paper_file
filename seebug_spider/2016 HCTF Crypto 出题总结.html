<!DOCTYPE html>


<html xmlns:wb="http://open.weibo.com/wb">

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta property="wb:webmaster" content="ccd3e79934f3322d"/>
  <title>2016 HCTF Crypto 出题总结</title>
  <meta name="keywords" content="漏洞文档,漏洞分析,安全技术"/>
  <meta name="description" content=""/>

  <meta name="HandheldFriendly" content="True"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="shortcut icon" href="/static/images/favicon.ico">
  <link rel="stylesheet" type="text/css" href="/static/css/screen.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/font.css"/>
  <link rel="stylesheet"
        href="//libs.baidu.com/fontawesome/4.0.3/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/monokai.css" media="screen"/>
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css?t=20170821"/>
  <link rel="stylesheet" type="text/css" href="/static/css/print.css?t=20170821" media="print"/>
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?ef67a70a7641da3b52452a05b3bbecae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body class="home-template">
<div class="weixin-share-img" style="display: none">
  <img src="/static/images/weixin-share.png" alt="Paper"/>
</div>

<div id="wrapper" class="">

<div id="sidebar">
  <button type="button" class="hamburger is-closed" data-toggle="offcanvas">
    <span class="hamb-top"></span>
    <span class="hamb-middle"></span>
    <span class="hamb-bottom"></span>
  </button>
  <div id="sidebar-content" class="inner">
    <h2 class="blog-title"><a href="/">Paper</a></h2>
    <h3 class="blog-description">安全技术精粹</h3>

    <form id="search" action="/">
      <button type="submit" style="background: #13313f; border: #13313f; position: absolute; right: -4px; margin-top: -3px;">
        <i class="fa fa-search search-button" style="position: absolute;right:10px; margin-top:6px;" > </i>
      </button>
      <input id="search-field" name="keyword" value="" placeholder="Search"/>

    </form>
    <div class="overlay"></div>
    <div id="sidebar-links">
      <ul id="subscription-links">
        <li><a target="_blank" href="/rss/"><i class="fa fa-rss"></i>RSS 订阅</a>
        </li>
        <li><a href="https://www.seebug.org/contribute/paper"><i
            class="fa fa-envelope-o"></i>投稿</a></li>
      </ul>
      <ul id="navigation">
        <li class="nav-" role="presentation"><a href="/"><i
            class="fa fa-angle-right"></i>首页</a></li>
        
  <li class="nav-" role="presentation"><a href="/category/vul-analysis/"><i
      class="fa fa-angle-right"></i>漏洞分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/tools/"><i
      class="fa fa-angle-right"></i>安全工具&amp;安全开发</a></li>

  <li class="nav-" role="presentation"><a href="/category/information/"><i
      class="fa fa-angle-right"></i>情报分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/experience/"><i
      class="fa fa-angle-right"></i>经验心得</a></li>

  <li class="nav-" role="presentation"><a href="/category/web-security/"><i
      class="fa fa-angle-right"></i>Web安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/bin-security/"><i
      class="fa fa-angle-right"></i>二进制安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/mobile-security/"><i
      class="fa fa-angle-right"></i>移动安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/paper-archive/"><i
      class="fa fa-angle-right"></i>纸篓</a></li>

  <li class="nav-" role="presentation"><a href="/category/prime/"><i
      class="fa fa-angle-right"></i>安全基础&amp;教学篇</a></li>


        <li class="nav-" role="presentation"><a href="/call-for-paper/"><i
            class="fa fa-angle-right"></i>如何投稿</a></li>
        <li class="nav-" role="presentation"><a href="https://paper.seebug.org/papers/"><i
            class="fa fa-angle-right"></i>归档文件</a></li>
      </ul>
      <ul id="sidebar-external">
      </ul>
    </div>

    <footer class="site-footer">
      <section class="copyright">Copyright @ 404 Team from Knownsec.</section>
    </footer>
  </div>
</div>

<main>
  <div class="main-inner">
    <section id="results"></section>
    
  <article class="">
    <header class="post-header">

      <h1 class="post-title">2016 HCTF Crypto 出题总结</h1>

      <span class="post-print">
        <a href="javascript:window.print()">
        <i class="fa fa-print fa-2x" aria-hidden="true"></i>
        </a>
      </span>
      <section class="post-meta">
        <span class="post-time">
          <i class='fa fa-calendar'></i>
          <time datetime="2016-11-29" class="timeago">9 月，3 周 之前</time>
          <time datetime="2016-11-29" class="fulldate">十一月 29, 2016</time>
        </span>
        
          <br>
          <i class='fa fa-tag'></i>
          
            <a href="/category/experience/">经验心得</a>
            
          
        








      </section>
    </header>

    <section class="post-content">
      <p>Author：<a href="http://0x48.pw/">Hcamael</a></p>
<p>date： 2016-11-28 20:26:26</p>
<p>注：更多 HCTF 题目可以在此找到：https://github.com/hduisa/HCTF2016</p>
<p>今年犯懒了所以只出了3题RSA的密码学题目, 出题思路来源于协会上一届的学长 @Mystery Of Panda 关于RSA后门的毕业设计.</p>
<!--more-->

<h2>Crypto So Interesting</h2>
<p>题目: <a href="https://github.com/Hcamael/ctf-library/tree/master/RSA1">https://github.com/Hcamael/ctf-library/tree/master/RSA1</a></p>
<p>payload: <a href="https://github.com/Hcamael/ctf-library/blob/master/RSA1/rsa1_payload.py">https://github.com/Hcamael/ctf-library/blob/master/RSA1/rsa1_payload.py</a></p>
<p>出题时预测的分数在300分左右, 不过看完选手的wp后发现这题出现了重大失误, 现在来看, 这题只值150分左右, 但是实际情况只有23个队解出了该题.</p>
<p>本题思路来源: 基于隐藏指数的RSA-HSDβ算法, 全称为隐藏小私有指数δ的RSA后门密钥生成算法.</p>
<p>该算法依赖于<a href="https://github.com/pablocelayes/rsa-wiener-attack">wiener</a>小指数攻击方法</p>
<p>后门生成流程:</p>
<p><img alt="hctf_rsa1" src="http://qn.lazysheep.cc/img/hctf_rsa_1.png" /></p>
<p>其中<code>β</code>是在<code>2^(k-1) ± 2^(k/2)</code>范围内的素数, 转置函数的作用是在<code>β</code>非常大的情况下, 返回值可以认为是PRP(Pseudo-Random Permutation). 转置函数可以有好几种形式, 我选取的是一种比较简单的转置函数.</p>
<p>从上面的流程可以看出这题非常的简单, 要逆向也是很容易的, 所以该题为本届HCTF密码学的签到题</p>
<p>逆向思路:</p>
<p><img alt="hctf_rsa1_2" src="http://qn.lazysheep.cc/img/hctf_rsa1_2.png" /></p>
<p>从上图可以看出本题只涉及到了wiener算法, 难度差不多是150左右</p>
<hr />
<p>出题时本来是准备考两种算法的, 一种是wiener算法, 一种是<a href="https://www.cs.cmu.edu/~glmiller/Publications/Papers/Mi76.pdf">Riemann's hypothesis and tests for primality</a>, payload中的<code>divide_pq</code>函数, 已知e, d, n质因数分解p和q(<a href="http://www.di-mgt.com.au/rsa_factorize_n.html">http://www.di-mgt.com.au/rsa_factorize_n.html</a>)</p>
<p>原本设计着算出<code>(ϵ, δ)</code>后, 根据<code>(ϵ, δ, n)</code>分解出<code>q</code>和<code>p</code>, 但是出题失误, 导致只需要wiener算法就能getflag</p>
<p>PS1: 不过还是出现了非预期, ROIS的dalao利用wiener算法分解出<code>p</code>和<code>q</code>, <a href="https://github.com/Hcamael/ctf-library/blob/master/RSA1/rsa_s.py">https://github.com/Hcamael/ctf-library/blob/master/RSA1/rsa_s.py</a></p>
<p>PS2: 基于隐藏指数的RSA后门生成算法除了本题涉及的还有<code>RSA-HSPEβ</code>和<code>RSA-HSEβ</code></p>
<h2>Crypto So Cool</h2>
<p>题目: <a href="https://github.com/Hcamael/ctf-library/tree/master/RSA2">https://github.com/Hcamael/ctf-library/tree/master/RSA2</a>
payload:</p>
<ul>
<li><a href="https://github.com/Hcamael/ctf-library/blob/master/RSA2/rsa2_payload.py">https://github.com/Hcamael/ctf-library/blob/master/RSA2/rsa2_payload.py</a></li>
<li><a href="https://github.com/Hcamael/ctf-library/blob/master/RSA2/rsa2_payload.sage">https://github.com/Hcamael/ctf-library/blob/master/RSA2/rsa2_payload.sage</a></li>
</ul>
<p>出题时预测的分数在400分左右, 实际情况只有7个队解出了该题. 和预测差不多, 最后放了一波hint, 要不然可能会更少.</p>
<p>本题思路来源: 基于隐藏素数因子的RSA-HPβ算法</p>
<p>该后门算法依赖于<code>Coppersmith partial information attack</code>算法, <a href="http://inaz2.hatenablog.com/entries/2016/01/20">sage实现该算法</a></p>
<p>后门生成流程:
<img alt="hctf_rsa2_1" src="http://qn.lazysheep.cc/img/hctf_rsa2_1.png" /></p>
<p>该算法的核心在于把p的前半部分比特隐写到n中</p>
<p>τ的长度为k/16比特</p>
<p>μ的长度为5k/16比特</p>
<p>λ的长度为5k/8比特</p>
<p>所以n的长度为k比特</p>
<p><code>p * (q xor random(k/8比特长度))</code>的前3k/8比特的值是不变的</p>
<p>所以可以成功把τ, μ隐写到n中</p>
<p>逆向思路:</p>
<p><img alt="hctf_rsa2_2" src="http://qn.lazysheep.cc/img/hctf_rsa2_2.png" /></p>
<p>该题的难点主要在于<code>Coppersmith partial information attack</code>算法, 能在放hint前做出的队伍都是在github上找到了该算法的脚本
<a href="https://github.com/Gao-Chuan/RSA-and-LLL-attacks">https://github.com/Gao-Chuan/RSA-and-LLL-attacks</a></p>
<h2>Crypto So Amazing</h2>
<p>题目: <a href="https://github.com/Hcamael/ctf-library/tree/master/RSA3">https://github.com/Hcamael/ctf-library/tree/master/RSA3</a></p>
<p>payload:</p>
<ul>
<li><a href="https://github.com/Hcamael/ctf-library/blob/master/RSA3/rsa3_payload.py">https://github.com/Hcamael/ctf-library/blob/master/RSA3/rsa3_payload.py</a></li>
<li><a href="https://github.com/Hcamael/ctf-library/blob/master/RSA3/rsa3.sage">https://github.com/Hcamael/ctf-library/blob/master/RSA3/rsa3.sage</a></li>
</ul>
<p>出题时预测的分数在450分左右, 不过却没有能做出来, 我知道的几个队都是被上一题的脚本给坑了</p>
<p>本题思路来源: 基于有限域F(2^m)上椭圆曲线的RSA后门生成算法</p>
<p>流程图懒得画了, 上一题的后门算法看懂了, 这题去看代码也不难, 主要是通过<code>Diffie–Hellman key exchange</code>算法生成私钥作为种子生成伪随机数, 私钥很好求, 本题的难点跟上题一样同样在于<code>Coppersmith partial information attack</code>算法</p>
<p>上一题我故意改简单了, 已知p的前640比特, 所以可以很容易通过<a href="https://github.com/Gao-Chuan/RSA-and-LLL-attacks">https://github.com/Gao-Chuan/RSA-and-LLL-attacks</a>这个脚本恢复出完整的p</p>
<p>但是这题已知p的前576bit, github上的那个脚本就跑不出来了</p>
<p>这部分是出题时无意间挖出的坑, 因为我并不知道github上的这个脚本, 在我预想中能做出rsa2的基本都是能做出rsa3的</p>
<p>这题还有一个坑点</p>
<p><img alt="hctf_rsa_keng2" src="http://qn.lazysheep.cc/img/hctf_rsa_keng2.png" />
<img alt="hctf_rsa_keng1" src="http://qn.lazysheep.cc/img/hctf_rsa_keng1.png" /></p>
<p>sage和python 用相同的seed生成的随机数不一样, 所以在payload中我使用了python生成随机数</p>
<h2>总结</h2>
<p>本届HCTF的Crypto计划的考点是<code>Coppersmith partial information attack</code>算法和<code>Riemann's hypothesis and tests for primality</code>算法, 不过无奈由于出题失误第二个算法没考成</p>
<p>RSA后门相关的论文可参考: </p>
<ul>
<li>Crépeau C, Slakmon A. Simple backdoors for RSA key generation[J]. Topics in Cryptology—CT-RSA 2003, 2003, 2612: 403-416.</li>
<li>Young, A., Yung, M. A Space Efficient Backdoor in RSA and its Applications[J]. Preneel, B., Tavares, S. (eds.) SAC 2005, 2005, 3897: 128-143.</li>
<li>Tzung-Her Chen, Tsung-Hao Hung. A Comprehensive Study of Backdoors f or RSA Key Generation[R]. Cryptology and Information Security Conference, 2010.</li>
</ul>
      
<hr>
<p><img src="https://images.seebug.org/content/images/2017/08/0e69b04c-e31f-4884-8091-24ec334fbd7e.jpeg" alt="Paper" style="width: 220px">
本文由 Seebug Paper 发布，如需转载请注明来源。本文地址：<a href="https://paper.seebug.org/128/">https://paper.seebug.org/128/</a></p>
            
    </section>

  <nav class="pagination" role="navigation" style="padding: 3rem;">
    
      <a class="newer-posts" href="/127/"><span aria-hidden="true">&larr;</span> UAC 攻击剖析</a>
    
    
      <a class="older-posts" href="/129/">JSON-handle DomXSS Vulnerab... <span aria-hidden="true">&rarr;</span></a>
    
  </nav>


    

      
    
    <br>
    <section class="plugin_comment">
    </section>

  </article>
  <section class="plugin_feedback"></section>


  </div>
</main>
</div>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<script type="text/javascript" src="/static/js/prism-loader.js"></script>
<script type="text/javascript" src="/static/js/prism.js"></script>
<script type="text/javascript" src="/static/js/jquery.ghostHunter.js"></script>
<script type="text/javascript" src="/static/js/js.cookie.js"></script>
<script type="text/javascript" src="/static/js/custom.js?t=20170821"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/comment_main.js"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/plugin_feedback.js"></script>
</body>

</html>
