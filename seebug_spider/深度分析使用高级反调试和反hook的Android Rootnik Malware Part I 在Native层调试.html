<!DOCTYPE html>


<html xmlns:wb="http://open.weibo.com/wb">

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta property="wb:webmaster" content="ccd3e79934f3322d"/>
  <title>深度分析使用高级反调试和反hook的Android Rootnik Malware，Part I：在Native层调试</title>
  <meta name="keywords" content="漏洞文档,漏洞分析,安全技术"/>
  <meta name="description" content=""/>

  <meta name="HandheldFriendly" content="True"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="shortcut icon" href="/static/images/favicon.ico">
  <link rel="stylesheet" type="text/css" href="/static/css/screen.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/font.css"/>
  <link rel="stylesheet"
        href="//libs.baidu.com/fontawesome/4.0.3/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/monokai.css" media="screen"/>
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css?t=20170821"/>
  <link rel="stylesheet" type="text/css" href="/static/css/print.css?t=20170821" media="print"/>
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?ef67a70a7641da3b52452a05b3bbecae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body class="home-template">
<div class="weixin-share-img" style="display: none">
  <img src="/static/images/weixin-share.png" alt="Paper"/>
</div>

<div id="wrapper" class="">

<div id="sidebar">
  <button type="button" class="hamburger is-closed" data-toggle="offcanvas">
    <span class="hamb-top"></span>
    <span class="hamb-middle"></span>
    <span class="hamb-bottom"></span>
  </button>
  <div id="sidebar-content" class="inner">
    <h2 class="blog-title"><a href="/">Paper</a></h2>
    <h3 class="blog-description">安全技术精粹</h3>

    <form id="search" action="/">
      <button type="submit" style="background: #13313f; border: #13313f; position: absolute; right: -4px; margin-top: -3px;">
        <i class="fa fa-search search-button" style="position: absolute;right:10px; margin-top:6px;" > </i>
      </button>
      <input id="search-field" name="keyword" value="" placeholder="Search"/>

    </form>
    <div class="overlay"></div>
    <div id="sidebar-links">
      <ul id="subscription-links">
        <li><a target="_blank" href="/rss/"><i class="fa fa-rss"></i>RSS 订阅</a>
        </li>
        <li><a href="https://www.seebug.org/contribute/paper"><i
            class="fa fa-envelope-o"></i>投稿</a></li>
      </ul>
      <ul id="navigation">
        <li class="nav-" role="presentation"><a href="/"><i
            class="fa fa-angle-right"></i>首页</a></li>
        
  <li class="nav-" role="presentation"><a href="/category/vul-analysis/"><i
      class="fa fa-angle-right"></i>漏洞分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/tools/"><i
      class="fa fa-angle-right"></i>安全工具&amp;安全开发</a></li>

  <li class="nav-" role="presentation"><a href="/category/information/"><i
      class="fa fa-angle-right"></i>情报分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/experience/"><i
      class="fa fa-angle-right"></i>经验心得</a></li>

  <li class="nav-" role="presentation"><a href="/category/web-security/"><i
      class="fa fa-angle-right"></i>Web安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/bin-security/"><i
      class="fa fa-angle-right"></i>二进制安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/mobile-security/"><i
      class="fa fa-angle-right"></i>移动安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/paper-archive/"><i
      class="fa fa-angle-right"></i>纸篓</a></li>

  <li class="nav-" role="presentation"><a href="/category/prime/"><i
      class="fa fa-angle-right"></i>安全基础&amp;教学篇</a></li>


        <li class="nav-" role="presentation"><a href="/call-for-paper/"><i
            class="fa fa-angle-right"></i>如何投稿</a></li>
        <li class="nav-" role="presentation"><a href="https://paper.seebug.org/papers/"><i
            class="fa fa-angle-right"></i>归档文件</a></li>
      </ul>
      <ul id="sidebar-external">
      </ul>
    </div>

    <footer class="site-footer">
      <section class="copyright">Copyright @ 404 Team from Knownsec.</section>
    </footer>
  </div>
</div>

<main>
  <div class="main-inner">
    <section id="results"></section>
    
  <article class="">
    <header class="post-header">

      <h1 class="post-title">深度分析使用高级反调试和反hook的Android Rootnik Malware，Part I：在Native层调试</h1>

      <span class="post-print">
        <a href="javascript:window.print()">
        <i class="fa fa-print fa-2x" aria-hidden="true"></i>
        </a>
      </span>
      <section class="post-meta">
        <span class="post-time">
          <i class='fa fa-calendar'></i>
          <time datetime="2017-02-04" class="timeago">7 月，2 周 之前</time>
          <time datetime="2017-02-04" class="fulldate">二月 04, 2017</time>
        </span>
        
          <br>
          <i class='fa fa-tag'></i>
          
            <a href="/category/mobile-security/">移动安全</a>
            
          
        








      </section>
    </header>

    <section class="post-content">
      <p>原作者：Kai Lu</p>
<p>译者：<a href="http://www.kejidi.net">BlackTrace</a></p>
<blockquote>
<p><a href="https://blog.fortinet.com/2017/01/24/deep-analysis-of-android-rootnik-malware-using-advanced-anti-debug-and-anti-hook-part-i-debugging-in-the-scope-of-native-layer">原文链接</a></p>
<p>最近，我们发现了一个新的android rootnik 恶意app，它使用了开源的Android root漏洞利用工具和来自dashi root工具里的MTK root方案在Android设备上获取root权限。这个恶意软件把自己伪装成文件管理app(file helper app),其次还使用了很高级的反调试和反hook技来防止被逆向工程。它还使用了多个dex的方案去加载第二个dex文件。在成功获取了设备的root权限后，rootnik恶意app能执行多个恶意行为，例如，app和广告的推广，色情的推广，在主屏幕上创建快捷方式，静默安装app，推送通知等。在这个博客，我将深度分析这个恶意app。</p>
</blockquote>
<h2>快速浏览这个恶意app</h2>
<p>这个恶意app 看起来像你android手机里管理你的文件或者其他存储的资源的合法文件管理器（file helper app）。</p>
<p><img alt="恶意app的安装后的图标" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1001.png-w331s" /></p>
<p>图1. 恶意app的安装后的图标</p>
<p><img alt="恶意app的界面" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1003.png-w331s" /></p>
<p>图2. 恶意app的界面</p>
<p>我们来反编译这个apk文件，结果如图3</p>
<p><img alt="反编译结果" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1005.png-w331s" /></p>
<p>图3. 反编译后的文件</p>
<p>它的包名是com.web.sdfile。首先让我们来看一下它的AndroidManifest.xml文件。
<img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1007.png-w331s" /></p>
<p>图4. 这个app里面的AndroidManifest.xml文件</p>
<p>我们并没有在main activity中找到图4中的com.sd.clip.activity.FileManagerActivity, service class, broadcast class。很明显，这个文件管理器（file helper app）的主要逻辑代码并没有在这个classes.dex。经过分析后返现，这个恶意app使用了multidex方案去动态加载和运行第二个dex。</p>
<h2>Rootnik是如何工作的？</h2>
<h3>I. Rootnik工作流程</h3>
<p>下图是这个Android rootnik malware的工作流程</p>
<p><img alt="Android rootnik malware的工作流程" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1009.png-w331s" /></p>
<p>图5. Android rootnik malware的工作流程</p>
<h3>II. 深度分析第一个dex文件</h3>
<p>下图是SecAppWrapper类的代码片段</p>
<p><img alt="SecAppWrapper类的代码片段" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1011.png-w331s" /></p>
<p>图6. SecAppWrapper类的代码片段</p>
<p>这个执行流程如下</p>
<blockquote>
<p>静态代码块 -&gt; attachBaseContext -&gt; onCreate</p>
</blockquote>
<p>静态代码快加载动态链接库 libSecShell.so到assets文件夹，并进入native层执行多个反调试操作，解密第二个dex文件，然后使用multidex方案去加载解密后的第二个dex文件，解密后的第二个dex文件，才是真正的程序主逻辑。</p>
<p>类Dexinstall其实是类MultiDex，关于Multidex的资料<a href="https://android.googlesource.com/platform/frameworks/multidex/+/d79604bd38c101b54e41745f85ddc2e04d978af2/library/src/android/support/multidex/MultiDex.java">https://android.googlesource.com/platform/frameworks/multidex/+/d79604bd38c101b54e41745f85ddc2e04d978af2/library/src/android/support/multidex/MultiDex.java</a></p>
<p>这个程序调用Dexinstall里面的install方法去加载第二个dex文件。这个install方法是在native层调用的。</p>
<p><img alt="安装第二个dex" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1013.png-w331s" />
图7 安装第二个dex</p>
<p>这个程序在attachBaseContext方法里加载了第二个dex的运行入口class com.sd.clip.base.MyApplication。这个Helper类的attach是native方法。
接着程序运行了类com.sd.clip.base.MyApplication里的onCreate方法。好了就这些了，第一个dex文件相当简单的。接下来，我们将深度分析native层的代码，这是非常复杂和棘手的。</p>
<h3>III.native层的代码</h3>
<p>上面说过，native层使用了一些高级的反调试和反hook技术，并且还使用了几种解密算法对一些字节数组进行解密以得到纯文本字符串。</p>
<p>下图8是libSecShell.so的导出函数。它混淆了函数名使分析变得更加困难，更加费劲。</p>
<p><img alt="图8 libSecShell.so的导出函数" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1015.png-w331s" /></p>
<p>图8.libSecShell.so的导出函数</p>
<p>所有的反调试代码都在JNI_Onload函数里面</p>
<p>在上一节说过，java层中的Helper类的attach方法是native方法。这个程序是在native层动态注册这个方法。下图是程序在native层动态注册这个native方法的ARM汇编代码片段。
<img alt="图9 动态注册native方法" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1017.png-w331s" /></p>
<p>图9 动态注册native方法</p>
<p>RegisterNatives方法是用来注册native方法的，这个方法的原型如下</p>
<blockquote>
<p>jint RegisterNatives(JNIEnv *env,jclass clazz, const JNINativeMethod* methods,jint nMethods)</p>
</blockquote>
<p>JNINativeMethod结构定义如下</p>
<blockquote>
<p>typedef struct {
const char<em> name;
const char</em> signature;
void* fnPtr;
} JNINativeMethod;
第一个变量name是指在java层调用的name，这里是"attach",第三个变量是fnPtr空指针是一个函数指针，指向要动态注册的C代码的函数</p>
</blockquote>
<p>我们需要找到这个反调试代码的位置并且绕过它。还要分析第二个dex文件是如何解密的，并且在内存中dump出解密后的第二个dex文件。</p>
<p>让我们在IDA中看一下接下来的代码
<img alt="反调试代码附近" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1019.png-w331s" /></p>
<p>图10. 反调试代码附近</p>
<p>经过我们的深度分析，在地址0xF832这里的这里的指令是跳转到地址loc_F924,跟过去后，我们找到了反调试代码。</p>
<p><img alt="图11 反调试代码的位置" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1021.png-w331s" />
<img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1023.png-w331s" /></p>
<p>图11.反调试代码的位置</p>
<p>在p7E7056598F77DFCC42AE68DF7F0151CA()里执行了反调试的操作。</p>
<p>在IDA的graphic中看一下执行流程，如下图，可以看出，这个流程是相当复杂的。</p>
<p><img alt="图12 反调试的执行流程" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1025.png-w331s" /></p>
<p>图12.反调试的执行流程</p>
<p>下面是这个恶意app里使用的一些反调试和反hook的方法。</p>
<p>1. 检测一些流行的hook框架，如 Xposed, substrate, adbi, ddi, dexposed。一旦发现，流行hook框架hook了它，它将结束相关的进程。
<img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1027.png-w331s" />
<img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1031.png-w331s" /></p>
<p>图14. 查找hook框架</p>
<p>2. 使用一种多进程ptrace来实现反调试，这还是有点棘手的。在这里我们不提供这种反调试的实现机制的详细分析，但是我们会给一些简单的解释。</p>
<p>我们在这里看见了名字为com.web.sdfile的两个进程。
<img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1033.png-w331s" /></p>
<p>图15. 进程名为com.web.sdfile的两个进程</p>
<p>下图是多进程反调试代码片段</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1035.png-w331s" /></p>
<p>图16. 反调试代码片段</p>
<p>3. 这个程序还使用了inotify来监控内存和主进程的pagemag，当内存dump不完整，这两个进程将使用pipe互相通知对方。</p>
<p>总之，这些反调试和反hook给逆向工程创造了很大的障碍，所以我们绕过这些反调试和反hook方法是我们的首要任务。</p>
<p>让我们尝试绕过它们。</p>
<p>在图10中，在偏移0x0000F832的指令是跳转到loc_F924,然后程序执行反调试代码。当我们动态调试的时候，我们可以修改一些寄存器的值或者是ARM指令来改变执行流程。当程序运行到偏移0xF828的<code>SUBS R1, R0, #0</code>时，我们可以把R0寄存器的值修改为非0值，使得指令<code>BNE  loc_F834</code>的条件成立。这将允许这个程序跳转到loc_F834。</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1037.png-w331s" /></p>
<p>图17. 如何绕过反调试代码</p>
<p>接下来，我们动态调试它，绕过反调试并且dump解密后的第二个dex文件。动态调试过程如下</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1039.png-w331s" /></p>
<p>图18 修改R0寄存器的值为非0值</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1041.png-w331s" /></p>
<p>图19 跳转到local_75178834</p>
<p>接着跳转到local_751788D8，如下</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1043.png-w331s" /></p>
<p>图20. 解密第二个dex的函数</p>
<p>函数p34D946B85C4E13BE6E95110517F61C41就是解密函数，R0寄存器指向内存中存储的加密的dex文件，R1寄存器里存着这个文件的大小，文件大小等于0x94A3E(608830)。解密dex文件是在apk包里的assets文件夹下的secData0.jar文件。下图是secData0.jar</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1045.png-w331s" /></p>
<p>图21.这个文件secData0.jar是在assets文件夹下。</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1047.png-w331s" /></p>
<p>图22. 内存中解密后的第二个apk的内容</p>
<p>我们现在把解密后的文件dump到decrypt.dump中。</p>
<p>这个解密后的文件是zip的格式，它包含了第二个dex文件。解密后，这个程序解压这个解密后的apk文件到dex文件。方法p3CBBD6F30D91F38FCD0A378BE7E54877是用来解压这个文件的。
接下来，unk_75176334方法调用com.secshell.shellwrapper.DexInstall类的java方法install加载第二个dex。</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1049.png-w331s" /></p>
<p>图23. 解压解密后的apk文件并且加载第二个dex文件</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/02/Rootnikpt1051.png-w331s" /></p>
<p>图24. 通过JNI调用方法安装</p>
<p>这里，我们完成了native层的分析并且得到解密后的第二个apk文件，然后我们将分析这个apk文件在这个博客的part II 。</p>
<h2>Native层的secData0.jar的解密方法</h2>
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">sub_7518394C</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">,</span> <span class="n">_BYTE</span> <span class="o">*</span><span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// r1@1</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// r3@5</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// r3@7</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// r6@7</span>
  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// r5@7</span>
  <span class="kt">char</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// r2@8</span>
  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// r4@9</span>
  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// r3@9</span>
  <span class="kt">int</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// r7@11</span>
  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v12</span><span class="p">;</span> <span class="c1">// r6@12</span>
  <span class="kt">int</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// r4@13</span>
  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v14</span><span class="p">;</span> <span class="c1">// r1@15</span>
  <span class="kt">int</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// [sp+0h] [bp-138h]@1</span>
  <span class="kt">int</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// [sp+4h] [bp-134h]@1</span>
  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v17</span><span class="p">;</span> <span class="c1">// [sp+8h] [bp-130h]@1</span>
  <span class="kt">int</span> <span class="n">v18</span><span class="p">;</span> <span class="c1">// [sp+10h] [bp-128h]@5</span>
  <span class="kt">char</span> <span class="n">v19</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="c1">// [sp+1Ch] [bp-11Ch]@6</span>
  <span class="kt">int</span> <span class="n">v20</span><span class="p">;</span> <span class="c1">// [sp+11Ch] [bp-1Ch]@1</span>

  <span class="n">v17</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">v20</span> <span class="o">=</span> <span class="n">_stack_chk_guard</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="mh">0x1FFFF</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="mh">0x20000</span> <span class="o">-</span> <span class="n">result</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="mh">0x20000</span> <span class="o">-</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="n">a3</span> <span class="p">)</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>
    <span class="n">v15</span> <span class="o">=</span> <span class="n">a3</span> <span class="o">-</span> <span class="n">v3</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v18</span> <span class="o">=</span> <span class="n">dword_751AF650</span><span class="p">;</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">do</span>
      <span class="p">{</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">v4</span><span class="p">]</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
        <span class="o">++</span><span class="n">v4</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">256</span> <span class="p">);</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">do</span>
      <span class="p">{</span>
        <span class="n">v6</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v18</span> <span class="o">+</span> <span class="n">v5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v19</span><span class="p">[</span><span class="n">v7</span><span class="p">]</span> <span class="o">+</span> <span class="n">v6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">v8</span> <span class="o">=</span> <span class="n">v19</span><span class="p">[</span><span class="n">v7</span><span class="p">];</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">-</span><span class="p">((</span><span class="n">v5</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">v5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">));</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">v7</span><span class="p">]</span> <span class="o">=</span> <span class="n">v19</span><span class="p">[</span><span class="n">v6</span><span class="p">];</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">v6</span><span class="p">]</span> <span class="o">=</span> <span class="n">v8</span><span class="p">;</span>
        <span class="o">++</span><span class="n">v7</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">v7</span> <span class="o">!=</span> <span class="mi">256</span> <span class="p">);</span>
      <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">!=</span> <span class="n">v16</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v10</span> <span class="o">=</span> <span class="p">(</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">v11</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v19</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
        <span class="o">++</span><span class="n">v9</span><span class="p">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">v11</span> <span class="o">+</span> <span class="n">result</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">=</span> <span class="n">v19</span><span class="p">[</span><span class="n">result</span><span class="p">];</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">v11</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">v12</span> <span class="o">=</span> <span class="n">v17</span><span class="p">;</span>
      <span class="k">do</span>
      <span class="p">{</span>
        <span class="n">v10</span> <span class="o">=</span> <span class="p">(</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">v13</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v19</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span> <span class="o">+</span> <span class="n">v13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">=</span> <span class="n">v19</span><span class="p">[</span><span class="n">result</span><span class="p">];</span>
        <span class="n">v19</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">v13</span><span class="p">;</span>
        <span class="o">*</span><span class="n">v12</span><span class="o">++</span> <span class="o">^=</span> <span class="n">v19</span><span class="p">[(</span><span class="n">v13</span> <span class="o">+</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v19</span><span class="p">[</span><span class="n">v10</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span> <span class="n">v12</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">v17</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v15</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v14</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v17</span><span class="p">[</span><span class="n">v3</span><span class="p">];</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">v14</span><span class="p">;</span>
    <span class="k">do</span>
      <span class="o">*</span><span class="n">v14</span><span class="o">++</span> <span class="o">^=</span> <span class="mh">0xACu</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v14</span><span class="p">[</span><span class="o">-</span><span class="n">result</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v15</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v20</span> <span class="o">!=</span> <span class="n">_stack_chk_guard</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="n">unk_75173E48</span><span class="p">)();</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<hr />
<p>第一次翻译，难免会有错误，还请指正。万分感谢    --BlackTrace</p>
      
<hr>
<p><img src="https://images.seebug.org/content/images/2017/08/0e69b04c-e31f-4884-8091-24ec334fbd7e.jpeg" alt="Paper" style="width: 220px">
本文由 Seebug Paper 发布，如需转载请注明来源。本文地址：<a href="https://paper.seebug.org/204/">https://paper.seebug.org/204/</a></p>
            
    </section>

  <nav class="pagination" role="navigation" style="padding: 3rem;">
    
      <a class="newer-posts" href="/203/"><span aria-hidden="true">&larr;</span> 实用工具：免费Zend 5.2 5.3 5.4解密工具</a>
    
    
      <a class="older-posts" href="/205/">利用漏洞解锁锤子T1/2手机的bootloader <span aria-hidden="true">&rarr;</span></a>
    
  </nav>


    

      
    
    <br>
    <section class="plugin_comment">
    </section>

  </article>
  <section class="plugin_feedback"></section>


  </div>
</main>
</div>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<script type="text/javascript" src="/static/js/prism-loader.js"></script>
<script type="text/javascript" src="/static/js/prism.js"></script>
<script type="text/javascript" src="/static/js/jquery.ghostHunter.js"></script>
<script type="text/javascript" src="/static/js/js.cookie.js"></script>
<script type="text/javascript" src="/static/js/custom.js?t=20170821"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/comment_main.js"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/plugin_feedback.js"></script>
</body>

</html>
